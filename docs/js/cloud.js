var a0_0xd6f201=a0_0x470a;function a0_0x5c7e(){var _0x17c0ab=['No\x20refresh\x20token','application/x-www-form-urlencoded','Cloud\x20login\x20required!','substring','send','log','blob','19606180qmlbiU','uId','Do\x20you\x20want\x20to\x20restore\x20','9695112gIXtaA','Upload\x20failed,\x20unknown\x20http\x20status:\x20','gba','exec','access_token','Content-Type','&client_secret=','endsWith','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','&token_access_type=','Restore\x20canceled\x20by\x20user.','toUpperCase','knh3uz2mx2hp2eu','uploadSaveOrSaveState','stringify','alert','setItem','classList','.ss3','lastIndexOf','Do\x20you\x20want\x20to\x20logout?','7daBLhn','accessToken','save','active','&client_id=','replace','.gba_imageState','split','.gba_dateState','DOMContentLoaded','3863274htzbNf','POST','length','overwrite','.tag','code','slice','filter','Refreshing\x20token...','Kabu\x20storage\x20↦\x20Cloud\x20◆','&redirect_uri=','https://api.dropboxapi.com/2/files/list_folder','.txt','remove','2103336dcqzxx','https://content.dropboxapi.com/2/files/download','href','.ss0','refreshToken','getItem','code=','&grant_type=','status:\x20','10RMGnJd','addEventListener','confirm','https://www.dropbox.com/oauth2/authorize?client_id=','20HLgMmv','.gba_slot','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Error\x20while\x20refreshing\x20token:','43yLjkfc','downloadFileInCloud','entries','error','file','.ss5','location','state','list','\x20files\x20in\x20Kabu?','Restoring...','.ss7','Bearer\x20','click','setRequestHeader','https://api.dropbox.com/oauth2/token','41498CUKgDT','Cloud\x20↦\x20Kabu\x20storage\x20◆','Download\x20failed,\x20unknown\x20http\x20status:','40176fMkCqP','.ss2','refresh_token=','&response_type=','=([^&#]*)','nwb3dnfh09rhs31','146396pOWSUk','https://api.dropboxapi.com/oauth2/token','application/octet-stream','Unable\x20to\x20refresh\x20token','Backing\x20up...','[\x5c?&#]','name','onload','charAt','parse','Failed\x20to\x20refresh\x20Dropbox\x20token.','json','status','error_description','open'];a0_0x5c7e=function(){return _0x17c0ab;};return a0_0x5c7e();}(function(_0x5b2b0f,_0x2c0f29){var _0x5cdaf2=a0_0x470a,_0x3b3773=_0x5b2b0f();while(!![]){try{var _0xc5a872=parseInt(_0x5cdaf2(0x1b0))/0x1*(parseInt(_0x5cdaf2(0x150))/0x2)+parseInt(_0x5cdaf2(0x153))/0x3+parseInt(_0x5cdaf2(0x159))/0x4*(parseInt(_0x5cdaf2(0x1ac))/0x5)+parseInt(_0x5cdaf2(0x191))/0x6+-parseInt(_0x5cdaf2(0x187))/0x7*(-parseInt(_0x5cdaf2(0x172))/0x8)+-parseInt(_0x5cdaf2(0x19f))/0x9*(parseInt(_0x5cdaf2(0x1a8))/0xa)+-parseInt(_0x5cdaf2(0x16f))/0xb;if(_0xc5a872===_0x2c0f29)break;else _0x3b3773['push'](_0x3b3773['shift']());}catch(_0x4eea26){_0x3b3773['push'](_0x3b3773['shift']());}}}(a0_0x5c7e,0xd9b1f));function a0_0x470a(_0x540684,_0x2939e2){var _0x5c7e63=a0_0x5c7e();return a0_0x470a=function(_0x470ab1,_0x5e14a7){_0x470ab1=_0x470ab1-0x14f;var _0x340508=_0x5c7e63[_0x470ab1];return _0x340508;},a0_0x470a(_0x540684,_0x2939e2);}import*as a0_0x2d4a49 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0xd6f201(0x17e),clientSecret=a0_0xd6f201(0x158);function authorizeWithDropbox(){var _0x30a17a=a0_0xd6f201,_0x2fe365=window[_0x30a17a(0x1b6)]['href'][_0x30a17a(0x18e)]('?')[0x0],_0x35d9e2=_0x30a17a(0x196),_0x13c9f0='offline',_0x35466c=_0x30a17a(0x1ab)+clientId+_0x30a17a(0x156)+_0x35d9e2+_0x30a17a(0x17b)+_0x13c9f0+'&redirect_uri='+encodeURIComponent(_0x2fe365);window['location']['href']=_0x35466c;}function handleDropboxCallback(){var _0x4c3947=a0_0xd6f201,_0x4a5288=getUrlParameter('code');_0x4a5288?(getAccessToken(_0x4a5288),console['log']('Authorization\x20Code:',_0x4a5288)):console[_0x4c3947(0x16d)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0xf6ac00){var _0x53c1fc=a0_0xd6f201;_0xf6ac00=_0xf6ac00[_0x53c1fc(0x18c)](/[\[]/,'\x5c[')[_0x53c1fc(0x18c)](/[\]]/,'\x5c]');var _0x21ca4b=new RegExp(_0x53c1fc(0x15e)+_0xf6ac00+_0x53c1fc(0x157)),_0x1e961c=_0x21ca4b[_0x53c1fc(0x175)](location['search']);return _0x1e961c===null?'':decodeURIComponent(_0x1e961c[0x1][_0x53c1fc(0x18c)](/\+/g,'\x20'));}function getAccessToken(_0x4663e8){var _0x4fa90d=a0_0xd6f201,_0x325c7d='authorization_code',_0x5d2b35=window[_0x4fa90d(0x1b6)][_0x4fa90d(0x1a1)][_0x4fa90d(0x18e)]('?')[0x0],_0x105bb1=new XMLHttpRequest();_0x105bb1[_0x4fa90d(0x167)](_0x4fa90d(0x192),_0x4fa90d(0x14f)),_0x105bb1[_0x4fa90d(0x1be)](_0x4fa90d(0x177),_0x4fa90d(0x169)),_0x105bb1[_0x4fa90d(0x160)]=function(){var _0x1d57fb=_0x4fa90d;if(_0x105bb1[_0x1d57fb(0x165)]===0xc8){var _0x1a95ec=JSON[_0x1d57fb(0x162)](_0x105bb1['responseText']),_0x1f6662=_0x1a95ec[_0x1d57fb(0x176)],_0x19de03=_0x1a95ec['refresh_token'],_0xbc347=_0x1a95ec['uid'];localStorage[_0x1d57fb(0x182)](_0x1d57fb(0x188),_0x1f6662),localStorage[_0x1d57fb(0x182)](_0x1d57fb(0x1a3),_0x19de03),localStorage[_0x1d57fb(0x182)](_0x1d57fb(0x170),_0xbc347);}else console['log'](_0x1d57fb(0x17a));},_0x105bb1[_0x4fa90d(0x16c)](_0x4fa90d(0x1a5)+_0x4663e8+_0x4fa90d(0x1a6)+_0x325c7d+_0x4fa90d(0x18b)+clientId+_0x4fa90d(0x178)+clientSecret+_0x4fa90d(0x19b)+encodeURIComponent(_0x5d2b35));}export async function dpRefreshToken(){var _0xcfaace=a0_0xd6f201;if(!localStorage[_0xcfaace(0x1a4)](_0xcfaace(0x1a3)))throw _0xcfaace(0x168);try{const _0x56223c=await fetch(_0xcfaace(0x15a),{'method':_0xcfaace(0x192),'headers':{'Content-Type':_0xcfaace(0x169)},'body':_0xcfaace(0x155)+localStorage[_0xcfaace(0x1a4)](_0xcfaace(0x1a3))+_0xcfaace(0x1ae)}),_0x2796f4=await _0x56223c[_0xcfaace(0x164)]();if(!_0x2796f4[_0xcfaace(0x1b3)])return localStorage[_0xcfaace(0x182)](_0xcfaace(0x188),_0x2796f4['access_token']),await lockNoti('',_0xcfaace(0x199),0xbb8),await delay(0x3e8),!![];else alert(_0x2796f4[_0xcfaace(0x166)]||_0xcfaace(0x163));}catch(_0x2d6193){console[_0xcfaace(0x1b3)](_0xcfaace(0x1af),_0x2d6193);}return![];}export async function dpUploadFile(_0x1460ba,_0x173852){var _0x30713a=a0_0xd6f201;const _0x46bf69=localStorage[_0x30713a(0x1a4)]('uId');var _0x4e1c93=JSON['stringify']({'autorename':!![],'mode':_0x30713a(0x194),'mute':!![],'strict_conflict':![],'path':'/'+_0x46bf69+'/'+_0x1460ba}),_0x17c5ab=new Blob([_0x173852],{'type':'application/octet-stream'});for(var _0x4acc9f=0x0;_0x4acc9f<0x2;_0x4acc9f++){var _0x386b37=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x30713a(0x192),'headers':{'Authorization':_0x30713a(0x1bc)+localStorage['getItem'](_0x30713a(0x188)),'Dropbox-API-Arg':_0x4e1c93,'Content-Type':_0x30713a(0x15b)},'body':_0x17c5ab});if(_0x386b37[_0x30713a(0x165)]!=0xc8){if(_0x386b37[_0x30713a(0x165)]==0x191){var _0x26e2a5=await dpRefreshToken();if(!_0x26e2a5)throw _0x30713a(0x15c);continue;}else throw _0x30713a(0x173)+_0x386b37['status'];}else{var _0x34b293=await _0x386b37[_0x30713a(0x164)]();return console[_0x30713a(0x16d)](_0x30713a(0x19a),_0x1460ba),_0x34b293;}}return![];}async function dpDownloadFile(_0x2b856c){var _0x22e048=a0_0xd6f201;const _0x26548d=localStorage['getItem'](_0x22e048(0x170));var _0xcfcf87=JSON[_0x22e048(0x180)]({'path':'/'+_0x26548d+'/'+_0x2b856c});for(var _0x16a5c6=0x0;_0x16a5c6<0x2;_0x16a5c6++){var _0x3c4515=await fetch(_0x22e048(0x1a0),{'method':'POST','headers':{'Authorization':_0x22e048(0x1bc)+localStorage[_0x22e048(0x1a4)](_0x22e048(0x188)),'Dropbox-API-Arg':_0xcfcf87}});if(_0x3c4515[_0x22e048(0x165)]!=0xc8){if(_0x3c4515[_0x22e048(0x165)]==0x191){var _0x181664=await dpRefreshToken();if(!_0x181664)throw _0x22e048(0x15c);continue;}else throw _0x22e048(0x152)+_0x3c4515[_0x22e048(0x165)];}const _0x4ece51=new File([await _0x3c4515[_0x22e048(0x16e)]()],_0x2b856c);console[_0x22e048(0x16d)](_0x22e048(0x151),_0x4ece51[_0x22e048(0x15f)]);if(_0x2b856c[_0x22e048(0x179)]('.txt')){const _0x2c2411=await _0x4ece51['text'](),[_0x4fd588,_0x28834c]=_0x2c2411[_0x22e048(0x18e)]('\x0a\x0a'),_0x5e1ebc=_0x2b856c['substring'](0x0,_0x2b856c[_0x22e048(0x185)](_0x22e048(0x174))+0x3),_0x9476d7=_0x2b856c['charAt'](_0x2b856c[_0x22e048(0x193)]-0x5);localStorage[_0x22e048(0x182)](_0x5e1ebc+'_dateState'+_0x9476d7,_0x28834c),localStorage[_0x22e048(0x182)](_0x5e1ebc+'_imageState'+_0x9476d7,_0x4fd588);}else a0_0x2d4a49[_0x22e048(0x17f)](_0x4ece51,()=>{localStorageFile(),Module['FSSync']();});return _0x4ece51;}return![];}document[a0_0xd6f201(0x1a9)](a0_0xd6f201(0x190),function(){var _0x4c0a18=a0_0xd6f201;dropboxRestore['addEventListener'](_0x4c0a18(0x1bd),async function(){var _0x43f686=_0x4c0a18;const _0x56ad9c=localStorage['getItem'](_0x43f686(0x170));if(_0x56ad9c===null||_0x56ad9c==='')window[_0x43f686(0x181)]('Cloud\x20login\x20required!');else{var _0xbfb122={'path':'/'+_0x56ad9c};for(var _0x2ce69b=0x0;_0x2ce69b<0x2;_0x2ce69b++){var _0x41f042=await fetch(_0x43f686(0x19c),{'method':_0x43f686(0x192),'headers':{'Authorization':_0x43f686(0x1bc)+localStorage[_0x43f686(0x1a4)](_0x43f686(0x188)),'Content-Type':'application/json'},'body':JSON[_0x43f686(0x180)](_0xbfb122)});console[_0x43f686(0x16d)](_0x43f686(0x1a7),_0x41f042[_0x43f686(0x165)]);if(_0x41f042[_0x43f686(0x165)]!=0xc8){if(_0x41f042['status']==0x191){var _0x32c40f=await dpRefreshToken();if(!_0x32c40f)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:\x20'+_0x41f042[_0x43f686(0x165)];}else{const _0x1ed025=await _0x41f042[_0x43f686(0x164)](),_0x37e5d5=_0x1ed025[_0x43f686(0x1b2)][_0x43f686(0x198)](_0x420ffe=>_0x420ffe[_0x43f686(0x195)]===_0x43f686(0x1b4))[_0x43f686(0x193)],_0x492278=_0x43f686(0x171)+_0x37e5d5+'\x20files\x20in\x20Cloud?';if(window[_0x43f686(0x1aa)](_0x492278))for(const _0x44473d of _0x1ed025['entries']){_0x44473d['.tag']===_0x43f686(0x1b4)&&(await lockNoti(_0x43f686(0x1ba),_0x44473d['name'],0xbb8),await dpDownloadFile(_0x44473d[_0x43f686(0x15f)]));}else console['log'](_0x43f686(0x17c));return!![];}}return![];}}),dropboxBackup['addEventListener'](_0x4c0a18(0x1bd),async function(){var _0x5be873=_0x4c0a18;const _0x15feca=localStorage['getItem']('uId');if(_0x15feca===null||_0x15feca==='')window[_0x5be873(0x181)](_0x5be873(0x16a));else{const _0x3ee4bf=[_0x5be873(0x1b7),_0x5be873(0x189)];let _0x446864=0x0;for(const _0x59b377 of _0x3ee4bf){const _0x4225c6=a0_0x2d4a49['list'+(_0x59b377[_0x5be873(0x161)](0x0)[_0x5be873(0x17d)]()+_0x59b377[_0x5be873(0x197)](0x1))]();_0x446864+=_0x4225c6[_0x5be873(0x193)];}if(window[_0x5be873(0x1aa)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x446864+_0x5be873(0x1b9)))for(const _0x2b2c25 of _0x3ee4bf){const _0x3f05c9=a0_0x2d4a49[_0x5be873(0x1b8)+(_0x2b2c25[_0x5be873(0x161)](0x0)[_0x5be873(0x17d)]()+_0x2b2c25['slice'](0x1))]();for(const _0x2b09db of _0x3f05c9){const _0x556eb1=await a0_0x2d4a49[_0x5be873(0x1b1)]('/data/'+_0x2b2c25+'s/'+_0x2b09db);try{await lockNoti(_0x5be873(0x15d),_0x2b09db,0xbb8),await dpUploadFile(_0x2b09db,_0x556eb1);if(_0x2b09db['endsWith'](_0x5be873(0x1a2))||_0x2b09db[_0x5be873(0x179)]('.ss1')||_0x2b09db[_0x5be873(0x179)](_0x5be873(0x154))||_0x2b09db[_0x5be873(0x179)](_0x5be873(0x184))||_0x2b09db['endsWith']('.ss4')||_0x2b09db[_0x5be873(0x179)](_0x5be873(0x1b5))||_0x2b09db[_0x5be873(0x179)]('.ss6')||_0x2b09db['endsWith'](_0x5be873(0x1bb))){const _0x515b62=_0x2b09db[_0x5be873(0x16b)](0x0,_0x2b09db[_0x5be873(0x185)]('.')),_0x1863ca=_0x2b09db[_0x5be873(0x161)](_0x2b09db[_0x5be873(0x193)]-0x1),_0x12f671=localStorage['getItem'](_0x515b62+_0x5be873(0x18d)+_0x1863ca),_0x469fa0=localStorage[_0x5be873(0x1a4)](_0x515b62+_0x5be873(0x18f)+_0x1863ca);if(_0x12f671!==null){const _0x372f7d=_0x12f671+'\x0a\x0a'+_0x469fa0,_0x18a95f=new Blob([_0x372f7d],{'type':'text/plain'});await lockNoti(_0x5be873(0x15d),_0x515b62+_0x5be873(0x1ad)+_0x1863ca+_0x5be873(0x19d),0xbb8),await dpUploadFile(_0x515b62+_0x5be873(0x1ad)+_0x1863ca+_0x5be873(0x19d),_0x18a95f);}}}catch(_0x46d54c){console[_0x5be873(0x1b3)]('Failed\x20to\x20upload\x20file\x20'+_0x2b09db+':',_0x46d54c);}}}else console[_0x5be873(0x16d)](_0x5be873(0x17c));}}),dropboxCloud['addEventListener'](_0x4c0a18(0x1bd),function(){var _0x1c6ada=_0x4c0a18;const _0x5561e5=localStorage[_0x1c6ada(0x1a4)]('uId');_0x5561e5===null||_0x5561e5===''?authorizeWithDropbox():window[_0x1c6ada(0x1aa)](_0x1c6ada(0x186))&&(localStorage[_0x1c6ada(0x182)](_0x1c6ada(0x170),''),dropboxRestore[_0x1c6ada(0x183)][_0x1c6ada(0x19e)](_0x1c6ada(0x18a)),dropboxBackup[_0x1c6ada(0x183)]['remove'](_0x1c6ada(0x18a)),dropboxCloud[_0x1c6ada(0x183)]['remove'](_0x1c6ada(0x18a)));}),handleDropboxCallback();});