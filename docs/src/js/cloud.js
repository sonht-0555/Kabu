var a0_0x5e11b0=a0_0x1816;function a0_0x1816(_0x4a7258,_0x3c594b){var _0x63092e=a0_0x6309();return a0_0x1816=function(_0x18167d,_0x2f64b1){_0x18167d=_0x18167d-0xe8;var _0xada34f=_0x63092e[_0x18167d];return _0xada34f;},a0_0x1816(_0x4a7258,_0x3c594b);}(function(_0x4492b1,_0x433eb0){var _0x5af20e=a0_0x1816,_0x1c2cde=_0x4492b1();while(!![]){try{var _0x1e9aa4=parseInt(_0x5af20e(0xfd))/0x1+-parseInt(_0x5af20e(0xf6))/0x2*(parseInt(_0x5af20e(0x134))/0x3)+-parseInt(_0x5af20e(0x13c))/0x4+parseInt(_0x5af20e(0x113))/0x5+-parseInt(_0x5af20e(0x118))/0x6*(-parseInt(_0x5af20e(0x126))/0x7)+parseInt(_0x5af20e(0xec))/0x8+-parseInt(_0x5af20e(0x123))/0x9;if(_0x1e9aa4===_0x433eb0)break;else _0x1c2cde['push'](_0x1c2cde['shift']());}catch(_0x8a3361){_0x1c2cde['push'](_0x1c2cde['shift']());}}}(a0_0x6309,0xf241a));import*as a0_0x43070a from'./main.js';import{localStorageFile}from'./storage.js';function a0_0x6309(){var _0x38a450=['&token_access_type=','map','1687502gwqoDa','href','&response_type=','send','onload','Restoring...','error','application/x-www-form-urlencoded','replace','name','https://api.dropboxapi.com/oauth2/token','https://api.dropbox.com/oauth2/token','open','uploadFileInCloud','split','accessToken','file','responseText','Do\x20not\x20receive\x20authorization','getItem','save','refresh_token=','3342170nNwSJY','nwb3dnfh09rhs31','https://api.dropboxapi.com/2/files/list_folder','application/json','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','3096jKmRUp','Upload\x20failed,\x20unknown\x20http\x20status:\x20','length','addEventListener','setItem','classList','Do\x20you\x20want\x20to\x20logout?','overwrite','remove','filter','confirm','23156667jpjdeX','refresh_token','Unable\x20to\x20refresh\x20token','23807vYKbAi','https://content.dropboxapi.com/2/files/upload','knh3uz2mx2hp2eu','alert','&redirect_uri=','&grant_type=','uId','access_token','=([^&#]*)','\x20files\x20in\x20Kabu?','listFiles','Bearer\x20','parse','downloadFileInCloud','1852281beXbMp','Error\x20creating\x20folder\x20','Error\x20while\x20refreshing\x20token:','No\x20files\x20found\x20to\x20restore.','Folder\x20already\x20exists','Cloud\x20login\x20required!','code','Restore\x20canceled\x20by\x20user.','3388620bStwft','POST','offline','Kabu\x20storage\x20↦\x20Cloud\x20◆','.tag','screenshot','click','log','search','setRequestHeader','Do\x20you\x20want\x20to\x20backup\x20','Content-Type','json','https://www.dropbox.com/oauth2/authorize?client_id=','[\x5c?&#]','Download\x20failed\x20for\x20','Cloud\x20↦\x20Kabu\x20storage\x20◆','application/octet-stream','7351800BQVzMl','Do\x20you\x20want\x20to\x20restore\x20','location','entries','status','active','&client_secret=','Backing\x20up...','&client_id=','Wait\x20a\x20little\x20bit...','2xLlmyW','stringify','\x20files\x20from\x20Cloud?','refreshToken','state'];a0_0x6309=function(){return _0x38a450;};return a0_0x6309();}var clientId=a0_0x5e11b0(0x128),clientSecret=a0_0x5e11b0(0x114);function authorizeWithDropbox(){var _0x48bc05=a0_0x5e11b0,_0x2db87a=window[_0x48bc05(0xee)][_0x48bc05(0xfe)][_0x48bc05(0x10b)]('?')[0x0],_0x405e87=_0x48bc05(0x13a),_0x844eb3=_0x48bc05(0x13e),_0x4f1e58=_0x48bc05(0x149)+clientId+_0x48bc05(0xff)+_0x405e87+_0x48bc05(0xfb)+_0x844eb3+_0x48bc05(0x12a)+encodeURIComponent(_0x2db87a);window[_0x48bc05(0xee)][_0x48bc05(0xfe)]=_0x4f1e58;}function handleDropboxCallback(){var _0x241c35=a0_0x5e11b0,_0x10087b=getUrlParameter(_0x241c35(0x13a));_0x10087b?(getAccessToken(_0x10087b),console[_0x241c35(0x143)]('Authorization\x20Code:',_0x10087b)):console[_0x241c35(0x143)](_0x241c35(0x10f));}function getUrlParameter(_0x5209c9){var _0x25a508=a0_0x5e11b0;_0x5209c9=_0x5209c9['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x267de0=new RegExp(_0x25a508(0xe8)+_0x5209c9+_0x25a508(0x12e)),_0x3efa58=_0x267de0['exec'](location[_0x25a508(0x144)]);return _0x3efa58===null?'':decodeURIComponent(_0x3efa58[0x1][_0x25a508(0x105)](/\+/g,'\x20'));}function getAccessToken(_0x1b8a35){var _0x1eb3b6=a0_0x5e11b0,_0x9a8342='authorization_code',_0x5bde37=window[_0x1eb3b6(0xee)]['href']['split']('?')[0x0],_0x32ef01=new XMLHttpRequest();_0x32ef01[_0x1eb3b6(0x109)](_0x1eb3b6(0x13d),_0x1eb3b6(0x108)),_0x32ef01[_0x1eb3b6(0x145)](_0x1eb3b6(0x147),_0x1eb3b6(0x104)),_0x32ef01[_0x1eb3b6(0x101)]=function(){var _0x341eb0=_0x1eb3b6;if(_0x32ef01[_0x341eb0(0xf0)]===0xc8){var _0x5a2466=JSON[_0x341eb0(0x132)](_0x32ef01[_0x341eb0(0x10e)]),_0x4a0d82=_0x5a2466['access_token'],_0x56dd14=_0x5a2466[_0x341eb0(0x124)],_0x195e49=_0x5a2466['uid'];localStorage[_0x341eb0(0x11c)]('accessToken',_0x4a0d82),localStorage[_0x341eb0(0x11c)]('refreshToken',_0x56dd14),localStorage['setItem'](_0x341eb0(0x12c),_0x195e49);}else console[_0x341eb0(0x143)](_0x341eb0(0x117));},_0x32ef01[_0x1eb3b6(0x100)]('code='+_0x1b8a35+_0x1eb3b6(0x12b)+_0x9a8342+_0x1eb3b6(0xf4)+clientId+_0x1eb3b6(0xf2)+clientSecret+_0x1eb3b6(0x12a)+encodeURIComponent(_0x5bde37));}export async function dpCreateFolder(_0x2f0ec7){var _0x5eb279=a0_0x5e11b0;const _0x36bcec=localStorage['getItem']('uId');let _0x4c25ee=localStorage[_0x5eb279(0x110)](_0x5eb279(0x10c));const _0x204ffc='/'+_0x36bcec+'/'+_0x2f0ec7,_0x10752c=JSON['stringify']({'path':_0x204ffc,'autorename':![]});for(let _0xc31364=0x0;_0xc31364<0x2;_0xc31364++){try{const _0x501bbd=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x5eb279(0x13d),'headers':{'Authorization':_0x5eb279(0x131)+_0x4c25ee,'Content-Type':_0x5eb279(0x116)},'body':_0x10752c});if(_0x501bbd['status']===0x191){const _0x15625b=await dpRefreshToken();if(!_0x15625b)throw new Error('Unable\x20to\x20refresh\x20token');_0x4c25ee=localStorage[_0x5eb279(0x110)](_0x5eb279(0x10c));continue;}if(_0x501bbd[_0x5eb279(0xf0)]===0x199)return{'message':_0x5eb279(0x138),'path':_0x2f0ec7};if(!_0x501bbd['ok'])throw new Error(_0x5eb279(0x135)+_0x2f0ec7);const _0x2d9055=await _0x501bbd['json']();return await lockNoti('Folder\x20created','',0xbb8),_0x2d9055;}catch(_0x39318f){if(_0xc31364===0x1)throw _0x39318f;}}return![];}export async function dpRefreshToken(){var _0xcdfd85=a0_0x5e11b0;if(!localStorage['getItem']('refreshToken'))throw'No\x20refresh\x20token';try{const _0x1fdcce=await fetch(_0xcdfd85(0x107),{'method':'POST','headers':{'Content-Type':_0xcdfd85(0x104)},'body':_0xcdfd85(0x112)+localStorage[_0xcdfd85(0x110)](_0xcdfd85(0xf9))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x5387ad=await _0x1fdcce[_0xcdfd85(0x148)]();if(!_0x5387ad['error'])return localStorage[_0xcdfd85(0x11c)](_0xcdfd85(0x10c),_0x5387ad[_0xcdfd85(0x12d)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x5387ad['error_description']||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x1881e6){console['error'](_0xcdfd85(0x136),_0x1881e6);}return![];}export async function dpUploadFile(_0x1637a7,_0x2b20b7,_0x500780){var _0x177813=a0_0x5e11b0;const _0x102e52=localStorage[_0x177813(0x110)](_0x177813(0x12c));var _0x5199e5=JSON['stringify']({'autorename':!![],'mode':_0x177813(0x11f),'mute':!![],'strict_conflict':![],'path':'/'+_0x102e52+'/'+_0x500780+'/'+_0x1637a7}),_0x35fc95=new Blob([_0x2b20b7],{'type':_0x177813(0xeb)});for(var _0x157d68=0x0;_0x157d68<0x2;_0x157d68++){var _0x490346=await fetch(_0x177813(0x127),{'method':_0x177813(0x13d),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x177813(0x110)](_0x177813(0x10c)),'Dropbox-API-Arg':_0x5199e5,'Content-Type':_0x177813(0xeb)},'body':_0x35fc95});if(_0x490346[_0x177813(0xf0)]!=0xc8){if(_0x490346[_0x177813(0xf0)]==0x191){var _0x1d58ab=await dpRefreshToken();if(!_0x1d58ab)throw _0x177813(0x125);continue;}else throw _0x177813(0x119)+_0x490346[_0x177813(0xf0)];}else{var _0x39ede6=await _0x490346[_0x177813(0x148)]();return console[_0x177813(0x143)](_0x177813(0x13f),_0x1637a7),_0x39ede6;}}return![];}export async function dpDownloadFile(_0x3ab80f,_0x3d8a0c){var _0x267833=a0_0x5e11b0;const _0x48976f=localStorage[_0x267833(0x110)]('uId');var _0x513749=JSON[_0x267833(0xf7)]({'path':'/'+_0x48976f+'/'+_0x3d8a0c+'/'+_0x3ab80f});for(var _0x378716=0x0;_0x378716<0x2;_0x378716++){var _0x197e2d=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x267833(0x13d),'headers':{'Authorization':_0x267833(0x131)+localStorage[_0x267833(0x110)](_0x267833(0x10c)),'Dropbox-API-Arg':_0x513749}});if(_0x197e2d['status']!=0xc8){if(_0x197e2d[_0x267833(0xf0)]==0x191){var _0x5d49ff=await dpRefreshToken();if(!_0x5d49ff)throw _0x267833(0x125);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x197e2d[_0x267833(0xf0)];}const _0x410213=new File([await _0x197e2d['blob']()],_0x3ab80f);return console[_0x267833(0x143)](_0x267833(0xea),_0x410213['name']),a0_0x43070a[_0x267833(0x10a)](_0x410213,()=>{}),_0x410213;}return![];}document[a0_0x5e11b0(0x11b)]('DOMContentLoaded',function(){var _0x668152=a0_0x5e11b0;dropboxRestore[_0x668152(0x11b)](_0x668152(0x142),async function(){var _0x212172=_0x668152;await lockNoti(_0x212172(0xf5),'',0x1388);const _0xbd0252=localStorage['getItem'](_0x212172(0x12c)),_0x672cf=[_0x212172(0xfa),_0x212172(0x111),_0x212172(0x141)];if(!_0xbd0252){window[_0x212172(0x129)](_0x212172(0x139));return;}let _0x331a70=[];for(const _0x2a8882 of _0x672cf){let _0x447e6b={'path':'/'+_0xbd0252+'/'+_0x2a8882};for(let _0x5e9d38=0x0;_0x5e9d38<0x2;_0x5e9d38++){let _0x135548=await fetch(_0x212172(0x115),{'method':'POST','headers':{'Authorization':_0x212172(0x131)+localStorage[_0x212172(0x110)](_0x212172(0x10c)),'Content-Type':_0x212172(0x116)},'body':JSON['stringify'](_0x447e6b)});if(_0x135548[_0x212172(0xf0)]===0xc8){let _0x9e6616=await _0x135548[_0x212172(0x148)](),_0x51cd0d=_0x9e6616[_0x212172(0xef)][_0x212172(0x121)](_0x543cd6=>_0x543cd6[_0x212172(0x140)]===_0x212172(0x10d));_0x51cd0d['length']>0x0&&_0x331a70['push'](..._0x51cd0d[_0x212172(0xfc)](_0x5e2ec0=>({'name':_0x5e2ec0[_0x212172(0x106)],'folder':_0x2a8882})));break;}else{if(_0x135548[_0x212172(0xf0)]===0x191){let _0x3a3d94=await dpRefreshToken();if(!_0x3a3d94)throw _0x212172(0x125);}else{console[_0x212172(0x103)](_0x212172(0xe9)+_0x2a8882+',\x20status:\x20'+_0x135548[_0x212172(0xf0)]);break;}}}}if(_0x331a70[_0x212172(0x11a)]>0x0){const _0x53cb92=_0x212172(0xed)+_0x331a70['length']+_0x212172(0xf8);if(window[_0x212172(0x122)](_0x53cb92))for(const _0x3b73d1 of _0x331a70){await lockNoti(_0x212172(0x102),_0x3b73d1['name'],0xbb8),await dpDownloadFile(_0x3b73d1['name'],_0x3b73d1['folder']);}else console['log']('Restore\x20canceled\x20by\x20user.');}else console[_0x212172(0x143)](_0x212172(0x137));}),dropboxBackup[_0x668152(0x11b)]('click',async function(){var _0x4a1f0f=_0x668152;await lockNoti(_0x4a1f0f(0xf5),'',0x1388);const _0x2fbb40=localStorage['getItem'](_0x4a1f0f(0x12c));if(_0x2fbb40===null||_0x2fbb40==='')window[_0x4a1f0f(0x129)]('Cloud\x20login\x20required!');else{const _0x322694=[_0x4a1f0f(0xfa),_0x4a1f0f(0x111),_0x4a1f0f(0x141)];for(const _0x3df9d5 of _0x322694){await dpCreateFolder(_0x3df9d5);}let _0x3a090f=0x0;for(const _0x2e2916 of _0x322694){const _0x254c1d=a0_0x43070a[_0x4a1f0f(0x130)](_0x2e2916+'s');_0x3a090f+=_0x254c1d['length'];}if(window[_0x4a1f0f(0x122)](_0x4a1f0f(0x146)+_0x3a090f+_0x4a1f0f(0x12f)))for(const _0x522bb1 of _0x322694){const _0x47232a=a0_0x43070a[_0x4a1f0f(0x130)](_0x522bb1+'s');for(const _0x1d4e48 of _0x47232a){const _0x33949b=await a0_0x43070a[_0x4a1f0f(0x133)]('/data/'+_0x522bb1+'s/'+_0x1d4e48);try{await lockNoti(_0x4a1f0f(0xf3),_0x1d4e48,0xbb8),await dpUploadFile(_0x1d4e48,_0x33949b,_0x522bb1);}catch(_0x55148d){console[_0x4a1f0f(0x103)]('Failed\x20to\x20upload\x20file\x20'+_0x1d4e48+':',_0x55148d);}}}else console[_0x4a1f0f(0x143)](_0x4a1f0f(0x13b));}}),dropboxCloud[_0x668152(0x11b)](_0x668152(0x142),function(){var _0x31e4a9=_0x668152;const _0x36ba59=localStorage['getItem'](_0x31e4a9(0x12c));_0x36ba59===null||_0x36ba59===''?authorizeWithDropbox():window[_0x31e4a9(0x122)](_0x31e4a9(0x11e))&&(localStorage[_0x31e4a9(0x11c)](_0x31e4a9(0x12c),''),dropboxRestore[_0x31e4a9(0x11d)][_0x31e4a9(0x120)](_0x31e4a9(0xf1)),dropboxBackup['classList']['remove']('active'),dropboxCloud['classList']['remove'](_0x31e4a9(0xf1)));}),handleDropboxCallback();});