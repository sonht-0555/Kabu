var a0_0x865c0e=a0_0x12ff;(function(_0x18a32,_0x4dd4d1){var _0x25e7d5=a0_0x12ff,_0x533550=_0x18a32();while(!![]){try{var _0x55d139=parseInt(_0x25e7d5(0x141))/0x1+parseInt(_0x25e7d5(0x12a))/0x2+-parseInt(_0x25e7d5(0x144))/0x3+-parseInt(_0x25e7d5(0x15c))/0x4+parseInt(_0x25e7d5(0x13f))/0x5*(parseInt(_0x25e7d5(0x143))/0x6)+-parseInt(_0x25e7d5(0x15b))/0x7*(parseInt(_0x25e7d5(0x11d))/0x8)+-parseInt(_0x25e7d5(0x168))/0x9;if(_0x55d139===_0x4dd4d1)break;else _0x533550['push'](_0x533550['shift']());}catch(_0x54ddae){_0x533550['push'](_0x533550['shift']());}}}(a0_0x433b,0xd9dbc));import*as a0_0x2229d4 from'./main.js';function a0_0x12ff(_0x2df8af,_0x194671){var _0x433bbd=a0_0x433b();return a0_0x12ff=function(_0x12ff56,_0x3b6fb1){_0x12ff56=_0x12ff56-0x100;var _0x28fbb8=_0x433bbd[_0x12ff56];return _0x28fbb8;},a0_0x12ff(_0x2df8af,_0x194671);}function a0_0x433b(){var _0x42c5b2=['Do\x20you\x20want\x20to\x20backup\x20','classList','access_token','Upload\x20failed,\x20unknown\x20http\x20status:\x20','getItem','file','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','DOMContentLoaded','error_description','overwrite','Unable\x20to\x20refresh\x20token','application/json','.ss6','.ss0','application/x-www-form-urlencoded','Content-Type','substring','slice','.gba_imageState','&redirect_uri=','text/plain','&client_secret=','8UpAujy','&client_id=','offline','uid','\x20files\x20in\x20Cloud?','Restoring...','confirm','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','No\x20refresh\x20token','.txt','Cloud\x20login\x20required!','.tag','_imageState','3417828VDTeXl','endsWith','https://content.dropboxapi.com/2/files/upload','refresh_token=','Backing\x20up...','text','POST','Download\x20failed,\x20unknown\x20http\x20status:\x20','addEventListener','alert','save','active','stringify','status:\x20','toUpperCase','lastIndexOf','status','.gba_slot','&grant_type=','setRequestHeader','log','8388060jokDSZ','filter','991177qpnViZ','Bearer\x20','6CxesWy','5064657FmJqnI','&token_access_type=','https://content.dropboxapi.com/2/files/download','Restore\x20canceled\x20by\x20user.','error','parse','.ss1','list','entries','refreshToken','authorization_code','code','=([^&#]*)','href','FSSync','json','application/octet-stream','Failed\x20to\x20upload\x20file\x20','Do\x20you\x20want\x20to\x20logout?','Cloud\x20↦\x20Kabu\x20storage\x20◆','remove','length','location','2945999FBsWZA','1090372SwVKqU','gba','Error\x20while\x20refreshing\x20token:','https://www.dropbox.com/oauth2/authorize?client_id=','Do\x20not\x20receive\x20authorization','\x20files\x20in\x20Kabu?','&response_type=','knh3uz2mx2hp2eu','exec','uId','replace','send','9933174jyxfVa','[\x5c?&#]','split','click','.gba_dateState','name','blob','.ss5','.ss3','charAt','https://api.dropbox.com/oauth2/token','accessToken','onload','https://api.dropboxapi.com/2/files/list_folder','code=','uploadSaveOrSaveState','setItem'];a0_0x433b=function(){return _0x42c5b2;};return a0_0x433b();}import{localStorageFile}from'./storage.js';var clientId=a0_0x865c0e(0x163),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x3e4223=a0_0x865c0e,_0x2f7d40=window[_0x3e4223(0x15a)][_0x3e4223(0x151)][_0x3e4223(0x16a)]('?')[0x0],_0x19f964=_0x3e4223(0x14f),_0x49ce70=_0x3e4223(0x11f),_0x277b4d=_0x3e4223(0x15f)+clientId+_0x3e4223(0x162)+_0x19f964+_0x3e4223(0x145)+_0x49ce70+_0x3e4223(0x11a)+encodeURIComponent(_0x2f7d40);window[_0x3e4223(0x15a)][_0x3e4223(0x151)]=_0x277b4d;}function handleDropboxCallback(){var _0x1d3251=a0_0x865c0e,_0x47d474=getUrlParameter(_0x1d3251(0x14f));_0x47d474?(getAccessToken(_0x47d474),console[_0x1d3251(0x13e)]('Authorization\x20Code:',_0x47d474)):console['log'](_0x1d3251(0x160));}function getUrlParameter(_0x2d37ac){var _0x548ffb=a0_0x865c0e;_0x2d37ac=_0x2d37ac['replace'](/[\[]/,'\x5c[')[_0x548ffb(0x166)](/[\]]/,'\x5c]');var _0x3fb116=new RegExp(_0x548ffb(0x169)+_0x2d37ac+_0x548ffb(0x150)),_0x248f03=_0x3fb116[_0x548ffb(0x164)](location['search']);return _0x248f03===null?'':decodeURIComponent(_0x248f03[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x42f4f9){var _0x5e4f7e=a0_0x865c0e,_0x26dcfc=_0x5e4f7e(0x14e),_0x48e01e=window[_0x5e4f7e(0x15a)][_0x5e4f7e(0x151)][_0x5e4f7e(0x16a)]('?')[0x0],_0x2aac0a=new XMLHttpRequest();_0x2aac0a['open'](_0x5e4f7e(0x130),_0x5e4f7e(0x100)),_0x2aac0a[_0x5e4f7e(0x13d)](_0x5e4f7e(0x116),_0x5e4f7e(0x115)),_0x2aac0a[_0x5e4f7e(0x102)]=function(){var _0x57a8e9=_0x5e4f7e;if(_0x2aac0a[_0x57a8e9(0x13a)]===0xc8){var _0x19fb65=JSON[_0x57a8e9(0x149)](_0x2aac0a['responseText']),_0x3d1e1f=_0x19fb65[_0x57a8e9(0x109)],_0x2ee50b=_0x19fb65['refresh_token'],_0x4266d7=_0x19fb65[_0x57a8e9(0x120)];localStorage[_0x57a8e9(0x106)](_0x57a8e9(0x101),_0x3d1e1f),localStorage[_0x57a8e9(0x106)](_0x57a8e9(0x14d),_0x2ee50b),localStorage['setItem'](_0x57a8e9(0x165),_0x4266d7);}else console[_0x57a8e9(0x13e)](_0x57a8e9(0x10d));},_0x2aac0a[_0x5e4f7e(0x167)](_0x5e4f7e(0x104)+_0x42f4f9+_0x5e4f7e(0x13c)+_0x26dcfc+_0x5e4f7e(0x11e)+clientId+_0x5e4f7e(0x11c)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x48e01e));}export async function dpRefreshToken(){var _0x499316=a0_0x865c0e;if(!localStorage[_0x499316(0x10b)](_0x499316(0x14d)))throw _0x499316(0x125);try{const _0x52bdb6=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x499316(0x130),'headers':{'Content-Type':_0x499316(0x115)},'body':_0x499316(0x12d)+localStorage['getItem'](_0x499316(0x14d))+_0x499316(0x124)}),_0x499a84=await _0x52bdb6[_0x499316(0x153)]();if(!_0x499a84[_0x499316(0x148)])return localStorage['setItem'](_0x499316(0x101),_0x499a84['access_token']),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0x499a84[_0x499316(0x10f)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x4b1663){console[_0x499316(0x148)](_0x499316(0x15e),_0x4b1663);}return![];}export async function dpUploadFile(_0x3575f7,_0x42c2ca){var _0xca1403=a0_0x865c0e;const _0x10bb19=localStorage[_0xca1403(0x10b)]('uId');var _0xb0ad2c=JSON['stringify']({'autorename':!![],'mode':_0xca1403(0x110),'mute':!![],'strict_conflict':![],'path':'/'+_0x10bb19+'/'+_0x3575f7}),_0x57ff57=new Blob([_0x42c2ca],{'type':_0xca1403(0x154)});for(var _0x4e0bab=0x0;_0x4e0bab<0x2;_0x4e0bab++){var _0x16fad3=await fetch(_0xca1403(0x12c),{'method':_0xca1403(0x130),'headers':{'Authorization':_0xca1403(0x142)+localStorage[_0xca1403(0x10b)](_0xca1403(0x101)),'Dropbox-API-Arg':_0xb0ad2c,'Content-Type':_0xca1403(0x154)},'body':_0x57ff57});if(_0x16fad3[_0xca1403(0x13a)]!=0xc8){if(_0x16fad3[_0xca1403(0x13a)]==0x191){var _0x341b95=await dpRefreshToken();if(!_0x341b95)throw _0xca1403(0x111);continue;}else throw _0xca1403(0x10a)+_0x16fad3[_0xca1403(0x13a)];}else{var _0x318043=await _0x16fad3[_0xca1403(0x153)]();return console[_0xca1403(0x13e)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x3575f7),_0x318043;}}return![];}async function dpDownloadFile(_0x232328){var _0xfc3251=a0_0x865c0e;const _0x29d8d6=localStorage[_0xfc3251(0x10b)]('uId');var _0x4bb9de=JSON['stringify']({'path':'/'+_0x29d8d6+'/'+_0x232328});for(var _0x5f6fc8=0x0;_0x5f6fc8<0x2;_0x5f6fc8++){var _0x4da75c=await fetch(_0xfc3251(0x146),{'method':_0xfc3251(0x130),'headers':{'Authorization':'Bearer\x20'+localStorage[_0xfc3251(0x10b)](_0xfc3251(0x101)),'Dropbox-API-Arg':_0x4bb9de}});if(_0x4da75c['status']!=0xc8){if(_0x4da75c['status']==0x191){var _0x4f27b3=await dpRefreshToken();if(!_0x4f27b3)throw _0xfc3251(0x111);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x4da75c[_0xfc3251(0x13a)];}const _0x24f16b=new File([await _0x4da75c[_0xfc3251(0x16e)]()],_0x232328);console[_0xfc3251(0x13e)](_0xfc3251(0x157),_0x24f16b[_0xfc3251(0x16d)]);if(_0x232328[_0xfc3251(0x12b)](_0xfc3251(0x126))){const _0x20648f=await _0x24f16b[_0xfc3251(0x12f)](),[_0x51d6fd,_0x42f29b]=_0x20648f['split']('\x0a\x0a'),_0x5b57c2=_0x232328[_0xfc3251(0x117)](0x0,_0x232328[_0xfc3251(0x139)](_0xfc3251(0x15d))+0x3),_0x371fcd=_0x232328[_0xfc3251(0x171)](_0x232328[_0xfc3251(0x159)]-0x5);localStorage[_0xfc3251(0x106)](_0x5b57c2+'_dateState'+_0x371fcd,_0x42f29b),localStorage[_0xfc3251(0x106)](_0x5b57c2+_0xfc3251(0x129)+_0x371fcd,_0x51d6fd);}else a0_0x2229d4[_0xfc3251(0x105)](_0x24f16b,()=>{var _0x418452=_0xfc3251;localStorageFile(),Module[_0x418452(0x152)]();});return _0x24f16b;}return![];}document[a0_0x865c0e(0x132)](a0_0x865c0e(0x10e),function(){var _0x414a75=a0_0x865c0e;dropboxRestore[_0x414a75(0x132)](_0x414a75(0x16b),async function(){var _0x53cb1b=_0x414a75;const _0xf82aab=localStorage[_0x53cb1b(0x10b)]('uId');if(_0xf82aab===null||_0xf82aab==='')window[_0x53cb1b(0x133)](_0x53cb1b(0x127));else{var _0x4e44a1={'path':'/'+_0xf82aab};for(var _0x1fcf90=0x0;_0x1fcf90<0x2;_0x1fcf90++){var _0x5bf9ea=await fetch(_0x53cb1b(0x103),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x53cb1b(0x101)),'Content-Type':_0x53cb1b(0x112)},'body':JSON[_0x53cb1b(0x136)](_0x4e44a1)});console[_0x53cb1b(0x13e)](_0x53cb1b(0x137),_0x5bf9ea[_0x53cb1b(0x13a)]);if(_0x5bf9ea[_0x53cb1b(0x13a)]!=0xc8){if(_0x5bf9ea[_0x53cb1b(0x13a)]==0x191){var _0x4c0c1e=await dpRefreshToken();if(!_0x4c0c1e)throw _0x53cb1b(0x111);continue;}else throw _0x53cb1b(0x131)+_0x5bf9ea['status'];}else{const _0x4ce4ea=await _0x5bf9ea['json'](),_0x43216b=_0x4ce4ea['entries'][_0x53cb1b(0x140)](_0x2a2099=>_0x2a2099[_0x53cb1b(0x128)]===_0x53cb1b(0x10c))[_0x53cb1b(0x159)],_0x1388a9='Do\x20you\x20want\x20to\x20restore\x20'+_0x43216b+_0x53cb1b(0x121);if(window['confirm'](_0x1388a9))for(const _0x3118b0 of _0x4ce4ea[_0x53cb1b(0x14c)]){_0x3118b0[_0x53cb1b(0x128)]===_0x53cb1b(0x10c)&&(await lockNoti(_0x53cb1b(0x122),_0x3118b0[_0x53cb1b(0x16d)],0xbb8),await dpDownloadFile(_0x3118b0[_0x53cb1b(0x16d)]));}else console['log'](_0x53cb1b(0x147));return!![];}}return![];}}),dropboxBackup['addEventListener'](_0x414a75(0x16b),async function(){var _0x2f6404=_0x414a75;const _0x440e68=localStorage[_0x2f6404(0x10b)]('uId');if(_0x440e68===null||_0x440e68==='')window['alert'](_0x2f6404(0x127));else{const _0x1aa889=['state',_0x2f6404(0x134)];let _0x551d7b=0x0;for(const _0x2417ea of _0x1aa889){const _0x4becef=a0_0x2229d4['list'+(_0x2417ea[_0x2f6404(0x171)](0x0)[_0x2f6404(0x138)]()+_0x2417ea[_0x2f6404(0x118)](0x1))]();_0x551d7b+=_0x4becef['length'];}if(window[_0x2f6404(0x123)](_0x2f6404(0x107)+_0x551d7b+_0x2f6404(0x161)))for(const _0x287350 of _0x1aa889){const _0x5214cc=a0_0x2229d4[_0x2f6404(0x14b)+(_0x287350[_0x2f6404(0x171)](0x0)[_0x2f6404(0x138)]()+_0x287350[_0x2f6404(0x118)](0x1))]();for(const _0x5ec896 of _0x5214cc){const _0x148b6b=await a0_0x2229d4['downloadFileInCloud']('/data/'+_0x287350+'s/'+_0x5ec896);try{await lockNoti('Backing\x20up...',_0x5ec896,0xbb8),await dpUploadFile(_0x5ec896,_0x148b6b);if(_0x5ec896[_0x2f6404(0x12b)](_0x2f6404(0x114))||_0x5ec896[_0x2f6404(0x12b)](_0x2f6404(0x14a))||_0x5ec896[_0x2f6404(0x12b)]('.ss2')||_0x5ec896[_0x2f6404(0x12b)](_0x2f6404(0x170))||_0x5ec896[_0x2f6404(0x12b)]('.ss4')||_0x5ec896[_0x2f6404(0x12b)](_0x2f6404(0x16f))||_0x5ec896[_0x2f6404(0x12b)](_0x2f6404(0x113))||_0x5ec896[_0x2f6404(0x12b)]('.ss7')){const _0x277bff=_0x5ec896[_0x2f6404(0x117)](0x0,_0x5ec896[_0x2f6404(0x139)]('.')),_0x4a9049=_0x5ec896[_0x2f6404(0x171)](_0x5ec896[_0x2f6404(0x159)]-0x1),_0x411dce=localStorage[_0x2f6404(0x10b)](_0x277bff+_0x2f6404(0x119)+_0x4a9049),_0x19f857=localStorage[_0x2f6404(0x10b)](_0x277bff+_0x2f6404(0x16c)+_0x4a9049);if(_0x411dce!==null){const _0x2d6099=_0x411dce+'\x0a\x0a'+_0x19f857,_0x39de9a=new Blob([_0x2d6099],{'type':_0x2f6404(0x11b)});await lockNoti(_0x2f6404(0x12e),_0x277bff+_0x2f6404(0x13b)+_0x4a9049+_0x2f6404(0x126),0xbb8),await dpUploadFile(_0x277bff+_0x2f6404(0x13b)+_0x4a9049+'.txt',_0x39de9a);}}}catch(_0x92d2e2){console[_0x2f6404(0x148)](_0x2f6404(0x155)+_0x5ec896+':',_0x92d2e2);}}}else console[_0x2f6404(0x13e)](_0x2f6404(0x147));}}),dropboxCloud['addEventListener'](_0x414a75(0x16b),function(){var _0x16be33=_0x414a75;const _0x555496=localStorage[_0x16be33(0x10b)](_0x16be33(0x165));_0x555496===null||_0x555496===''?authorizeWithDropbox():window[_0x16be33(0x123)](_0x16be33(0x156))&&(localStorage['setItem'](_0x16be33(0x165),''),dropboxRestore[_0x16be33(0x108)]['remove'](_0x16be33(0x135)),dropboxBackup[_0x16be33(0x108)][_0x16be33(0x158)]('active'),dropboxCloud[_0x16be33(0x108)][_0x16be33(0x158)](_0x16be33(0x135)));}),handleDropboxCallback();});