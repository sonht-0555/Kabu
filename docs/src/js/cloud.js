var a0_0x249317=a0_0x4b96;(function(_0x18ea58,_0x457aec){var _0x53ce04=a0_0x4b96,_0x54019e=_0x18ea58();while(!![]){try{var _0x5bf663=parseInt(_0x53ce04(0x1d5))/0x1*(-parseInt(_0x53ce04(0x1d0))/0x2)+parseInt(_0x53ce04(0x1e2))/0x3*(parseInt(_0x53ce04(0x1ef))/0x4)+-parseInt(_0x53ce04(0x1e0))/0x5+parseInt(_0x53ce04(0x1f8))/0x6*(parseInt(_0x53ce04(0x1f5))/0x7)+-parseInt(_0x53ce04(0x1c0))/0x8+parseInt(_0x53ce04(0x1a8))/0x9+-parseInt(_0x53ce04(0x1ca))/0xa;if(_0x5bf663===_0x457aec)break;else _0x54019e['push'](_0x54019e['shift']());}catch(_0x384dba){_0x54019e['push'](_0x54019e['shift']());}}}(a0_0x2027,0xab371));import*as a0_0x122eee from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x249317(0x207),clientSecret=a0_0x249317(0x1e4);function authorizeWithDropbox(){var _0x6e0c05=a0_0x249317,_0x342f92=window[_0x6e0c05(0x1c5)][_0x6e0c05(0x1e7)][_0x6e0c05(0x1d7)]('?')[0x0],_0x34f0c2=_0x6e0c05(0x1fd),_0x7935da='offline',_0x3e9ed9=_0x6e0c05(0x1e1)+clientId+'&response_type='+_0x34f0c2+_0x6e0c05(0x208)+_0x7935da+_0x6e0c05(0x1ba)+encodeURIComponent(_0x342f92);window['location']['href']=_0x3e9ed9;}function handleDropboxCallback(){var _0x214e3e=a0_0x249317,_0x1255bf=getUrlParameter('code');_0x1255bf?(getAccessToken(_0x1255bf),console[_0x214e3e(0x1e5)](_0x214e3e(0x1d3),_0x1255bf)):console[_0x214e3e(0x1e5)]('Do\x20not\x20receive\x20authorization');}function a0_0x4b96(_0x17bd8e,_0x5368e0){var _0x202700=a0_0x2027();return a0_0x4b96=function(_0x4b9694,_0x27b308){_0x4b9694=_0x4b9694-0x1a6;var _0xdc8435=_0x202700[_0x4b9694];return _0xdc8435;},a0_0x4b96(_0x17bd8e,_0x5368e0);}function getUrlParameter(_0x2d2e42){var _0x315daa=a0_0x249317;_0x2d2e42=_0x2d2e42['replace'](/[\[]/,'\x5c[')[_0x315daa(0x1f3)](/[\]]/,'\x5c]');var _0x726840=new RegExp(_0x315daa(0x1c7)+_0x2d2e42+'=([^&#]*)'),_0x4fa4ac=_0x726840[_0x315daa(0x1d9)](location[_0x315daa(0x1be)]);return _0x4fa4ac===null?'':decodeURIComponent(_0x4fa4ac[0x1][_0x315daa(0x1f3)](/\+/g,'\x20'));}function getAccessToken(_0x453fd9){var _0x2a7360=a0_0x249317,_0x36fae3=_0x2a7360(0x1ed),_0x366dd1=window[_0x2a7360(0x1c5)][_0x2a7360(0x1e7)]['split']('?')[0x0],_0x4da302=new XMLHttpRequest();_0x4da302['open'](_0x2a7360(0x205),_0x2a7360(0x1c3)),_0x4da302[_0x2a7360(0x1d2)]('Content-Type',_0x2a7360(0x1ec)),_0x4da302[_0x2a7360(0x1f4)]=function(){var _0x2c8c91=_0x2a7360;if(_0x4da302[_0x2c8c91(0x1f7)]===0xc8){var _0x18aeb2=JSON[_0x2c8c91(0x1a7)](_0x4da302[_0x2c8c91(0x1f2)]),_0x3c3cdf=_0x18aeb2[_0x2c8c91(0x1f6)],_0x40da07=_0x18aeb2['refresh_token'],_0x7fed5d=_0x18aeb2[_0x2c8c91(0x1b5)];localStorage[_0x2c8c91(0x1cb)]('accessToken',_0x3c3cdf),localStorage[_0x2c8c91(0x1cb)](_0x2c8c91(0x1df),_0x40da07),localStorage['setItem'](_0x2c8c91(0x200),_0x7fed5d);}else console[_0x2c8c91(0x1e5)](_0x2c8c91(0x1bd));},_0x4da302[_0x2a7360(0x1b3)](_0x2a7360(0x1e9)+_0x453fd9+_0x2a7360(0x1c1)+_0x36fae3+_0x2a7360(0x1b0)+clientId+_0x2a7360(0x1de)+clientSecret+_0x2a7360(0x1ba)+encodeURIComponent(_0x366dd1));}function a0_0x2027(){var _0x4f1505=['click','650122XsWmPV','Unable\x20to\x20refresh\x20token','setRequestHeader','Authorization\x20Code:','https://api.dropboxapi.com/oauth2/token','1GoofIa','https://api.dropboxapi.com/2/files/list_folder','split','classList','exec','name','Cloud\x20↦\x20Kabu\x20storage\x20◆','getItem','Error\x20creating\x20folder\x20','&client_secret=','refreshToken','1795180ZVagkV','https://www.dropbox.com/oauth2/authorize?client_id=','20892BJyFaj','https://api.dropboxapi.com/2/files/create_folder_v2','nwb3dnfh09rhs31','log','map','href','Restore\x20canceled\x20by\x20user.','code=','stringify','confirm','application/x-www-form-urlencoded','authorization_code','Failed\x20to\x20upload\x20file\x20','580gHRHYt','remove','state','responseText','replace','onload','140zIADUg','access_token','status','244164lFFJjY','length','active','application/octet-stream','overwrite','code','Do\x20you\x20want\x20to\x20restore\x20','Cloud\x20login\x20required!','uId','screenshot','application/json','uploadFileInCloud',',\x20status:\x20','POST','push','knh3uz2mx2hp2eu','&token_access_type=','Download\x20failed\x20for\x20','parse','11242863tVTraN','Download\x20failed,\x20unknown\x20http\x20status:','error','Wait\x20a\x20little\x20bit...','\x20files\x20in\x20Kabu?','listFiles','save','accessToken','&client_id=','error_description','Do\x20you\x20want\x20to\x20logout?','send','https://content.dropboxapi.com/2/files/download','uid','Kabu\x20storage\x20↦\x20Cloud\x20◆','Upload\x20failed,\x20unknown\x20http\x20status:\x20','folder','https://content.dropboxapi.com/2/files/upload','&redirect_uri=','No\x20files\x20found\x20to\x20restore.','refresh_token=','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','search','DOMContentLoaded','3469112zuiUlc','&grant_type=','Folder\x20created','https://api.dropbox.com/oauth2/token','addEventListener','location','alert','[\x5c?&#]','Bearer\x20','entries','12538340MwbWLc','setItem','\x20files\x20from\x20Cloud?','json','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'];a0_0x2027=function(){return _0x4f1505;};return a0_0x2027();}export async function dpCreateFolder(_0x22d7a1){var _0x20b1ea=a0_0x249317;const _0x1f79b4=localStorage[_0x20b1ea(0x1dc)]('uId');let _0x50bf9e=localStorage['getItem']('accessToken');const _0x1c4023='/'+_0x1f79b4+'/'+_0x22d7a1,_0xa59a7=JSON[_0x20b1ea(0x1ea)]({'path':_0x1c4023,'autorename':![]});for(let _0x1b7e1f=0x0;_0x1b7e1f<0x2;_0x1b7e1f++){try{const _0x1b8f88=await fetch(_0x20b1ea(0x1e3),{'method':_0x20b1ea(0x205),'headers':{'Authorization':_0x20b1ea(0x1c8)+_0x50bf9e,'Content-Type':_0x20b1ea(0x202)},'body':_0xa59a7});if(_0x1b8f88['status']===0x191){const _0x2fc084=await dpRefreshToken();if(!_0x2fc084)throw new Error(_0x20b1ea(0x1d1));_0x50bf9e=localStorage[_0x20b1ea(0x1dc)](_0x20b1ea(0x1af));continue;}if(_0x1b8f88['status']===0x199)return{'message':'Folder\x20already\x20exists','path':_0x22d7a1};if(!_0x1b8f88['ok'])throw new Error(_0x20b1ea(0x1dd)+_0x22d7a1);const _0x3dccf0=await _0x1b8f88[_0x20b1ea(0x1cd)]();return await lockNoti(_0x20b1ea(0x1c2),'',0xbb8),_0x3dccf0;}catch(_0xfb66c5){if(_0x1b7e1f===0x1)throw _0xfb66c5;}}return![];}export async function dpRefreshToken(){var _0x230445=a0_0x249317;if(!localStorage[_0x230445(0x1dc)](_0x230445(0x1df)))throw'No\x20refresh\x20token';try{const _0x443ed6=await fetch(_0x230445(0x1d4),{'method':_0x230445(0x205),'headers':{'Content-Type':_0x230445(0x1ec)},'body':_0x230445(0x1bc)+localStorage[_0x230445(0x1dc)](_0x230445(0x1df))+_0x230445(0x1ce)}),_0x402023=await _0x443ed6['json']();if(!_0x402023[_0x230445(0x1aa)])return localStorage[_0x230445(0x1cb)]('accessToken',_0x402023[_0x230445(0x1f6)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x402023[_0x230445(0x1b1)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x10e5b7){console['error']('Error\x20while\x20refreshing\x20token:',_0x10e5b7);}return![];}export async function dpUploadFile(_0x257643,_0x1ad1e4,_0x4285d7){var _0x3d639b=a0_0x249317;const _0x29a20a=localStorage[_0x3d639b(0x1dc)](_0x3d639b(0x200));var _0x1b949f=JSON['stringify']({'autorename':!![],'mode':_0x3d639b(0x1fc),'mute':!![],'strict_conflict':![],'path':'/'+_0x29a20a+'/'+_0x4285d7+'/'+_0x257643}),_0x126900=new Blob([_0x1ad1e4],{'type':_0x3d639b(0x1fb)});for(var _0x412957=0x0;_0x412957<0x2;_0x412957++){var _0x2d9703=await fetch(_0x3d639b(0x1b9),{'method':_0x3d639b(0x205),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x3d639b(0x1dc)](_0x3d639b(0x1af)),'Dropbox-API-Arg':_0x1b949f,'Content-Type':_0x3d639b(0x1fb)},'body':_0x126900});if(_0x2d9703[_0x3d639b(0x1f7)]!=0xc8){if(_0x2d9703['status']==0x191){var _0x14560d=await dpRefreshToken();if(!_0x14560d)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x3d639b(0x1b7)+_0x2d9703[_0x3d639b(0x1f7)];}else{var _0xa5927b=await _0x2d9703['json']();return console[_0x3d639b(0x1e5)](_0x3d639b(0x1b6),_0x257643),_0xa5927b;}}return![];}export async function dpDownloadFile(_0x263d16,_0x564a72){var _0x32c331=a0_0x249317;const _0x4b38f7=localStorage[_0x32c331(0x1dc)]('uId');var _0x20b352=JSON[_0x32c331(0x1ea)]({'path':'/'+_0x4b38f7+'/'+_0x564a72+'/'+_0x263d16});for(var _0x19052e=0x0;_0x19052e<0x2;_0x19052e++){var _0x3e2570=await fetch(_0x32c331(0x1b4),{'method':'POST','headers':{'Authorization':_0x32c331(0x1c8)+localStorage[_0x32c331(0x1dc)](_0x32c331(0x1af)),'Dropbox-API-Arg':_0x20b352}});if(_0x3e2570[_0x32c331(0x1f7)]!=0xc8){if(_0x3e2570['status']==0x191){var _0x173de4=await dpRefreshToken();if(!_0x173de4)throw _0x32c331(0x1d1);continue;}else throw _0x32c331(0x1a9)+_0x3e2570[_0x32c331(0x1f7)];}const _0x294a57=new File([await _0x3e2570['blob']()],_0x263d16);return console[_0x32c331(0x1e5)](_0x32c331(0x1db),_0x294a57[_0x32c331(0x1da)]),a0_0x122eee[_0x32c331(0x203)](_0x294a57,()=>{}),_0x294a57;}return![];}document[a0_0x249317(0x1c4)](a0_0x249317(0x1bf),function(){var _0x9b3e42=a0_0x249317;dropboxRestore['addEventListener']('click',async function(){var _0xc7e1e7=a0_0x4b96;await lockNoti(_0xc7e1e7(0x1ab),'',0x1388);const _0x578c2d=localStorage['getItem'](_0xc7e1e7(0x200)),_0x1f331c=[_0xc7e1e7(0x1f1),_0xc7e1e7(0x1ae),_0xc7e1e7(0x201)];if(!_0x578c2d){window[_0xc7e1e7(0x1c6)](_0xc7e1e7(0x1ff));return;}let _0x55937b=[];for(const _0x46ff63 of _0x1f331c){let _0x33e54c={'path':'/'+_0x578c2d+'/'+_0x46ff63};for(let _0xe70991=0x0;_0xe70991<0x2;_0xe70991++){let _0x1f7615=await fetch(_0xc7e1e7(0x1d6),{'method':_0xc7e1e7(0x205),'headers':{'Authorization':_0xc7e1e7(0x1c8)+localStorage['getItem'](_0xc7e1e7(0x1af)),'Content-Type':_0xc7e1e7(0x202)},'body':JSON[_0xc7e1e7(0x1ea)](_0x33e54c)});if(_0x1f7615['status']===0xc8){let _0x1ad8cd=await _0x1f7615[_0xc7e1e7(0x1cd)](),_0x5c6339=_0x1ad8cd[_0xc7e1e7(0x1c9)]['filter'](_0x3d6685=>_0x3d6685['.tag']==='file');_0x5c6339[_0xc7e1e7(0x1f9)]>0x0&&_0x55937b[_0xc7e1e7(0x206)](..._0x5c6339[_0xc7e1e7(0x1e6)](_0x5af115=>({'name':_0x5af115['name'],'folder':_0x46ff63})));break;}else{if(_0x1f7615['status']===0x191){let _0x29f7ee=await dpRefreshToken();if(!_0x29f7ee)throw _0xc7e1e7(0x1d1);}else{console['error'](_0xc7e1e7(0x1a6)+_0x46ff63+_0xc7e1e7(0x204)+_0x1f7615[_0xc7e1e7(0x1f7)]);break;}}}}if(_0x55937b['length']>0x0){const _0x4ff16c=_0xc7e1e7(0x1fe)+_0x55937b[_0xc7e1e7(0x1f9)]+_0xc7e1e7(0x1cc);if(window[_0xc7e1e7(0x1eb)](_0x4ff16c))for(const _0x245f7d of _0x55937b){await lockNoti('Restoring...',_0x245f7d[_0xc7e1e7(0x1da)],0xbb8),await dpDownloadFile(_0x245f7d[_0xc7e1e7(0x1da)],_0x245f7d[_0xc7e1e7(0x1b8)]);}else console[_0xc7e1e7(0x1e5)](_0xc7e1e7(0x1e8));}else console[_0xc7e1e7(0x1e5)](_0xc7e1e7(0x1bb));}),dropboxBackup['addEventListener'](_0x9b3e42(0x1cf),async function(){var _0x9ea164=_0x9b3e42;await lockNoti(_0x9ea164(0x1ab),'',0x1388);const _0x503e77=localStorage['getItem'](_0x9ea164(0x200));if(_0x503e77===null||_0x503e77==='')window['alert'](_0x9ea164(0x1ff));else{const _0x476187=[_0x9ea164(0x1f1),_0x9ea164(0x1ae),'screenshot'];for(const _0x51e311 of _0x476187){await dpCreateFolder(_0x51e311);}let _0x22a8c6=0x0;for(const _0x1ee14c of _0x476187){const _0x22bc55=a0_0x122eee['listFiles'](_0x1ee14c+'s');_0x22a8c6+=_0x22bc55[_0x9ea164(0x1f9)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x22a8c6+_0x9ea164(0x1ac)))for(const _0x42ad1f of _0x476187){const _0x2ecb33=a0_0x122eee[_0x9ea164(0x1ad)](_0x42ad1f+'s');for(const _0x150b44 of _0x2ecb33){const _0x33faf9=await a0_0x122eee['downloadFileInCloud']('/data/'+_0x42ad1f+'s/'+_0x150b44);try{await lockNoti('Backing\x20up...',_0x150b44,0xbb8),await dpUploadFile(_0x150b44,_0x33faf9,_0x42ad1f);}catch(_0x5a86cf){console[_0x9ea164(0x1aa)](_0x9ea164(0x1ee)+_0x150b44+':',_0x5a86cf);}}}else console[_0x9ea164(0x1e5)](_0x9ea164(0x1e8));}}),dropboxCloud['addEventListener']('click',function(){var _0x264cc9=_0x9b3e42;const _0x289866=localStorage[_0x264cc9(0x1dc)](_0x264cc9(0x200));_0x289866===null||_0x289866===''?authorizeWithDropbox():window[_0x264cc9(0x1eb)](_0x264cc9(0x1b2))&&(localStorage['setItem'](_0x264cc9(0x200),''),dropboxRestore[_0x264cc9(0x1d8)][_0x264cc9(0x1f0)](_0x264cc9(0x1fa)),dropboxBackup[_0x264cc9(0x1d8)]['remove'](_0x264cc9(0x1fa)),dropboxCloud[_0x264cc9(0x1d8)][_0x264cc9(0x1f0)]('active'));}),handleDropboxCallback();});