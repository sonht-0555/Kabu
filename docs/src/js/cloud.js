var a0_0x38efae=a0_0x1659;(function(_0x4c5ad0,_0x7f1a10){var _0x494763=a0_0x1659,_0x3493a2=_0x4c5ad0();while(!![]){try{var _0x45acd7=parseInt(_0x494763(0x1cc))/0x1+parseInt(_0x494763(0x1e0))/0x2*(parseInt(_0x494763(0x1d2))/0x3)+parseInt(_0x494763(0x1c1))/0x4*(-parseInt(_0x494763(0x1c3))/0x5)+parseInt(_0x494763(0x209))/0x6+-parseInt(_0x494763(0x1b8))/0x7+parseInt(_0x494763(0x20a))/0x8*(-parseInt(_0x494763(0x1f2))/0x9)+parseInt(_0x494763(0x201))/0xa;if(_0x45acd7===_0x7f1a10)break;else _0x3493a2['push'](_0x3493a2['shift']());}catch(_0x4c40ff){_0x3493a2['push'](_0x3493a2['shift']());}}}(a0_0x2ec2,0x7304a));import*as a0_0x93312 from'./main.js';function a0_0x2ec2(){var _0xedd8f4=['DOMContentLoaded','overwrite','error_description','/data/','application/json','downloadFileInCloud','href','active','Do\x20not\x20receive\x20authorization','uid','replace','save','4052111lDBJsB','Folder\x20already\x20exists','&grant_type=','getItem','addEventListener','application/x-www-form-urlencoded','error','Error\x20while\x20refreshing\x20token:','https://api.dropboxapi.com/oauth2/token','8Rupycq','[\x5c?&#]','1477415mfQfOV','push','open','code','Unable\x20to\x20refresh\x20token','\x20files\x20from\x20Cloud?','map','knh3uz2mx2hp2eu','status','431064RSXuEO','confirm','Cloud\x20login\x20required!','offline','filter','refreshToken','432933NLyMna','.tag','https://api.dropboxapi.com/2/files/create_folder_v2','json','length','Download\x20failed\x20for\x20','accessToken','parse','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','access_token','Restoring...','uId','Kabu\x20storage\x20↦\x20Cloud\x20◆','code=','2ZfwQOi','setRequestHeader','&client_secret=','Backing\x20up...','Failed\x20to\x20upload\x20file\x20','&token_access_type=','location','Bearer\x20',',\x20status:\x20','stringify','Wait\x20a\x20little\x20bit...','application/octet-stream','No\x20files\x20found\x20to\x20restore.','Error\x20creating\x20folder\x20','&response_type=','click','https://www.dropbox.com/oauth2/authorize?client_id=','setItem','477Cyvpig','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Do\x20you\x20want\x20to\x20logout?','screenshot','POST','Upload\x20failed,\x20unknown\x20http\x20status:\x20','https://content.dropboxapi.com/2/files/download','blob','Refreshing\x20token...','Cloud\x20↦\x20Kabu\x20storage\x20◆','send','listFiles','Restore\x20canceled\x20by\x20user.','authorization_code','=([^&#]*)','6373360xSIuAD','nwb3dnfh09rhs31','Folder\x20created','classList','Do\x20you\x20want\x20to\x20restore\x20','Authorization\x20Code:','name','alert','5191680VoUiNG','65968Bhlhwb','https://content.dropboxapi.com/2/files/upload','log','state','uploadFileInCloud','split','remove'];a0_0x2ec2=function(){return _0xedd8f4;};return a0_0x2ec2();}import{localStorageFile}from'./storage.js';function a0_0x1659(_0x5b4556,_0x1c5d0b){var _0x2ec25a=a0_0x2ec2();return a0_0x1659=function(_0x165944,_0x273376){_0x165944=_0x165944-0x1b2;var _0x19a8c8=_0x2ec25a[_0x165944];return _0x19a8c8;},a0_0x1659(_0x5b4556,_0x1c5d0b);}var clientId=a0_0x38efae(0x1ca),clientSecret=a0_0x38efae(0x202);function authorizeWithDropbox(){var _0x3f8401=a0_0x38efae,_0x1fa25a=window[_0x3f8401(0x1e6)][_0x3f8401(0x1b2)][_0x3f8401(0x20f)]('?')[0x0],_0x486d84='code',_0x922ca=_0x3f8401(0x1cf),_0x354042=_0x3f8401(0x1f0)+clientId+_0x3f8401(0x1ee)+_0x486d84+_0x3f8401(0x1e5)+_0x922ca+'&redirect_uri='+encodeURIComponent(_0x1fa25a);window[_0x3f8401(0x1e6)]['href']=_0x354042;}function handleDropboxCallback(){var _0x1e1359=a0_0x38efae,_0x1a9817=getUrlParameter(_0x1e1359(0x1c6));_0x1a9817?(getAccessToken(_0x1a9817),console['log'](_0x1e1359(0x206),_0x1a9817)):console[_0x1e1359(0x20c)](_0x1e1359(0x1b4));}function getUrlParameter(_0x618bfa){var _0x344f74=a0_0x38efae;_0x618bfa=_0x618bfa[_0x344f74(0x1b6)](/[\[]/,'\x5c[')[_0x344f74(0x1b6)](/[\]]/,'\x5c]');var _0x374b7c=new RegExp(_0x344f74(0x1c2)+_0x618bfa+_0x344f74(0x200)),_0x5b6aff=_0x374b7c['exec'](location['search']);return _0x5b6aff===null?'':decodeURIComponent(_0x5b6aff[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x39911f){var _0x487532=a0_0x38efae,_0x498279=_0x487532(0x1ff),_0x23c264=window[_0x487532(0x1e6)][_0x487532(0x1b2)][_0x487532(0x20f)]('?')[0x0],_0x4752df=new XMLHttpRequest();_0x4752df[_0x487532(0x1c5)](_0x487532(0x1f6),'https://api.dropbox.com/oauth2/token'),_0x4752df[_0x487532(0x1e1)]('Content-Type',_0x487532(0x1bd)),_0x4752df['onload']=function(){var _0x595803=_0x487532;if(_0x4752df['status']===0xc8){var _0x3c8652=JSON[_0x595803(0x1d9)](_0x4752df['responseText']),_0x28b409=_0x3c8652['access_token'],_0x4a1fec=_0x3c8652['refresh_token'],_0x372856=_0x3c8652[_0x595803(0x1b5)];localStorage[_0x595803(0x1f1)](_0x595803(0x1d8),_0x28b409),localStorage[_0x595803(0x1f1)]('refreshToken',_0x4a1fec),localStorage[_0x595803(0x1f1)](_0x595803(0x1dd),_0x372856);}else console['log'](_0x595803(0x1da));},_0x4752df[_0x487532(0x1fc)](_0x487532(0x1df)+_0x39911f+_0x487532(0x1ba)+_0x498279+'&client_id='+clientId+_0x487532(0x1e2)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x23c264));}export async function dpCreateFolder(_0x4dec90){var _0x347bf1=a0_0x38efae;const _0xf8e58=localStorage[_0x347bf1(0x1bb)](_0x347bf1(0x1dd));let _0x897378=localStorage[_0x347bf1(0x1bb)](_0x347bf1(0x1d8));const _0x5197c8='/'+_0xf8e58+'/'+_0x4dec90,_0x6cb662=JSON[_0x347bf1(0x1e9)]({'path':_0x5197c8,'autorename':![]});for(let _0x5ea528=0x0;_0x5ea528<0x2;_0x5ea528++){try{const _0x3cc8ff=await fetch(_0x347bf1(0x1d4),{'method':'POST','headers':{'Authorization':_0x347bf1(0x1e7)+_0x897378,'Content-Type':'application/json'},'body':_0x6cb662});if(_0x3cc8ff[_0x347bf1(0x1cb)]===0x191){const _0x539855=await dpRefreshToken();if(!_0x539855)throw new Error(_0x347bf1(0x1c7));_0x897378=localStorage['getItem'](_0x347bf1(0x1d8));continue;}if(_0x3cc8ff['status']===0x199)return{'message':_0x347bf1(0x1b9),'path':_0x4dec90};if(!_0x3cc8ff['ok'])throw new Error(_0x347bf1(0x1ed)+_0x4dec90);const _0x5652f5=await _0x3cc8ff['json']();return await lockNoti(_0x347bf1(0x203),'',0xbb8),_0x5652f5;}catch(_0x226561){if(_0x5ea528===0x1)throw _0x226561;}}return![];}export async function dpRefreshToken(){var _0x1f5d58=a0_0x38efae;if(!localStorage[_0x1f5d58(0x1bb)](_0x1f5d58(0x1d1)))throw'No\x20refresh\x20token';try{const _0x2dc4a2=await fetch(_0x1f5d58(0x1c0),{'method':'POST','headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x1f5d58(0x1bb)](_0x1f5d58(0x1d1))+_0x1f5d58(0x1f3)}),_0x307753=await _0x2dc4a2[_0x1f5d58(0x1d5)]();if(!_0x307753[_0x1f5d58(0x1be)])return localStorage[_0x1f5d58(0x1f1)](_0x1f5d58(0x1d8),_0x307753[_0x1f5d58(0x1db)]),await lockNoti(_0x1f5d58(0x1fa),'',0xbb8),await delay(0x3e8),!![];else alert(_0x307753[_0x1f5d58(0x213)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x2c3a5d){console['error'](_0x1f5d58(0x1bf),_0x2c3a5d);}return![];}export async function dpUploadFile(_0x3c8aa2,_0x4223b5,_0x7b34ef){var _0x9a2621=a0_0x38efae;const _0x298230=localStorage[_0x9a2621(0x1bb)]('uId');var _0xcb0e88=JSON[_0x9a2621(0x1e9)]({'autorename':!![],'mode':_0x9a2621(0x212),'mute':!![],'strict_conflict':![],'path':'/'+_0x298230+'/'+_0x7b34ef+'/'+_0x3c8aa2}),_0x321e51=new Blob([_0x4223b5],{'type':_0x9a2621(0x1eb)});for(var _0xa0d126=0x0;_0xa0d126<0x2;_0xa0d126++){var _0x47a667=await fetch(_0x9a2621(0x20b),{'method':'POST','headers':{'Authorization':_0x9a2621(0x1e7)+localStorage[_0x9a2621(0x1bb)](_0x9a2621(0x1d8)),'Dropbox-API-Arg':_0xcb0e88,'Content-Type':'application/octet-stream'},'body':_0x321e51});if(_0x47a667[_0x9a2621(0x1cb)]!=0xc8){if(_0x47a667['status']==0x191){var _0x2d5b75=await dpRefreshToken();if(!_0x2d5b75)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x9a2621(0x1f7)+_0x47a667['status'];}else{var _0x17aab9=await _0x47a667['json']();return console[_0x9a2621(0x20c)](_0x9a2621(0x1de),_0x3c8aa2),_0x17aab9;}}return![];}export async function dpDownloadFile(_0x472add,_0x264127){var _0x55d55a=a0_0x38efae;const _0x2f780c=localStorage[_0x55d55a(0x1bb)](_0x55d55a(0x1dd));var _0x47f691=JSON[_0x55d55a(0x1e9)]({'path':'/'+_0x2f780c+'/'+_0x264127+'/'+_0x472add});for(var _0x3dd88f=0x0;_0x3dd88f<0x2;_0x3dd88f++){var _0x5c85ca=await fetch(_0x55d55a(0x1f8),{'method':_0x55d55a(0x1f6),'headers':{'Authorization':_0x55d55a(0x1e7)+localStorage[_0x55d55a(0x1bb)]('accessToken'),'Dropbox-API-Arg':_0x47f691}});if(_0x5c85ca[_0x55d55a(0x1cb)]!=0xc8){if(_0x5c85ca[_0x55d55a(0x1cb)]==0x191){var _0xf6f043=await dpRefreshToken();if(!_0xf6f043)throw _0x55d55a(0x1c7);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x5c85ca[_0x55d55a(0x1cb)];}const _0x8f8a6c=new File([await _0x5c85ca[_0x55d55a(0x1f9)]()],_0x472add);return console[_0x55d55a(0x20c)](_0x55d55a(0x1fb),_0x8f8a6c[_0x55d55a(0x207)]),a0_0x93312[_0x55d55a(0x20e)](_0x8f8a6c,()=>{}),_0x8f8a6c;}return![];}document['addEventListener'](a0_0x38efae(0x211),function(){var _0x22a407=a0_0x38efae;dropboxRestore['addEventListener'](_0x22a407(0x1ef),async function(){var _0x61fbc7=_0x22a407;await lockNoti(_0x61fbc7(0x1ea),'',0x1388);const _0x4ed877=localStorage[_0x61fbc7(0x1bb)](_0x61fbc7(0x1dd)),_0x48f0ae=[_0x61fbc7(0x20d),_0x61fbc7(0x1b7),_0x61fbc7(0x1f5)];if(!_0x4ed877){window[_0x61fbc7(0x208)](_0x61fbc7(0x1ce));return;}let _0xec11ff=[];for(const _0x3d9576 of _0x48f0ae){let _0x97e7e8={'path':'/'+_0x4ed877+'/'+_0x3d9576};for(let _0xd54c1b=0x0;_0xd54c1b<0x2;_0xd54c1b++){let _0x764e86=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x61fbc7(0x1f6),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem']('accessToken'),'Content-Type':_0x61fbc7(0x215)},'body':JSON[_0x61fbc7(0x1e9)](_0x97e7e8)});if(_0x764e86[_0x61fbc7(0x1cb)]===0xc8){let _0x496c80=await _0x764e86[_0x61fbc7(0x1d5)](),_0x42e654=_0x496c80['entries'][_0x61fbc7(0x1d0)](_0x43f6c3=>_0x43f6c3[_0x61fbc7(0x1d3)]==='file');_0x42e654['length']>0x0&&_0xec11ff[_0x61fbc7(0x1c4)](..._0x42e654[_0x61fbc7(0x1c9)](_0x326d59=>({'name':_0x326d59['name'],'folder':_0x3d9576})));break;}else{if(_0x764e86[_0x61fbc7(0x1cb)]===0x191){let _0x28f337=await dpRefreshToken();if(!_0x28f337)throw _0x61fbc7(0x1c7);}else{console[_0x61fbc7(0x1be)](_0x61fbc7(0x1d7)+_0x3d9576+_0x61fbc7(0x1e8)+_0x764e86[_0x61fbc7(0x1cb)]);break;}}}}if(_0xec11ff[_0x61fbc7(0x1d6)]>0x0){const _0x47ad4a=_0x61fbc7(0x205)+_0xec11ff[_0x61fbc7(0x1d6)]+_0x61fbc7(0x1c8);if(window[_0x61fbc7(0x1cd)](_0x47ad4a))for(const _0x2e216f of _0xec11ff){await lockNoti(_0x61fbc7(0x1dc),_0x2e216f[_0x61fbc7(0x207)],0xbb8),await dpDownloadFile(_0x2e216f[_0x61fbc7(0x207)],_0x2e216f['folder']);}else console[_0x61fbc7(0x20c)](_0x61fbc7(0x1fe));}else console[_0x61fbc7(0x20c)](_0x61fbc7(0x1ec));}),dropboxBackup[_0x22a407(0x1bc)]('click',async function(){var _0x249c20=_0x22a407;await lockNoti(_0x249c20(0x1ea),'',0x1388);const _0x4b021e=localStorage[_0x249c20(0x1bb)](_0x249c20(0x1dd));if(_0x4b021e===null||_0x4b021e==='')window[_0x249c20(0x208)]('Cloud\x20login\x20required!');else{const _0x1934a6=[_0x249c20(0x20d),_0x249c20(0x1b7),_0x249c20(0x1f5)];for(const _0x2d066d of _0x1934a6){await dpCreateFolder(_0x2d066d);}let _0xd6251e=0x0;for(const _0x405b09 of _0x1934a6){const _0xa19c4d=a0_0x93312['listFiles'](_0x405b09+'s');_0xd6251e+=_0xa19c4d[_0x249c20(0x1d6)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0xd6251e+'\x20files\x20in\x20Kabu?'))for(const _0x583b9f of _0x1934a6){const _0x2ed25a=a0_0x93312[_0x249c20(0x1fd)](_0x583b9f+'s');for(const _0x15c62c of _0x2ed25a){const _0x806f9f=await a0_0x93312[_0x249c20(0x216)](_0x249c20(0x214)+_0x583b9f+'s/'+_0x15c62c);try{await lockNoti(_0x249c20(0x1e3),_0x15c62c,0xbb8),await dpUploadFile(_0x15c62c,_0x806f9f,_0x583b9f);}catch(_0x248114){console[_0x249c20(0x1be)](_0x249c20(0x1e4)+_0x15c62c+':',_0x248114);}}}else console[_0x249c20(0x20c)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x22a407(0x1bc)](_0x22a407(0x1ef),function(){var _0x595b16=_0x22a407;const _0x2ff4cd=localStorage[_0x595b16(0x1bb)]('uId');_0x2ff4cd===null||_0x2ff4cd===''?authorizeWithDropbox():window[_0x595b16(0x1cd)](_0x595b16(0x1f4))&&(localStorage[_0x595b16(0x1f1)](_0x595b16(0x1dd),''),dropboxRestore[_0x595b16(0x204)][_0x595b16(0x210)](_0x595b16(0x1b3)),dropboxBackup[_0x595b16(0x204)][_0x595b16(0x210)]('active'),dropboxCloud[_0x595b16(0x204)][_0x595b16(0x210)](_0x595b16(0x1b3)));}),handleDropboxCallback();});