var a0_0x2e1023=a0_0x47b8;(function(_0x34ccf8,_0x4391ef){var _0x4f4eed=a0_0x47b8,_0x49edd6=_0x34ccf8();while(!![]){try{var _0x34c1d7=-parseInt(_0x4f4eed(0xc3))/0x1*(-parseInt(_0x4f4eed(0xdf))/0x2)+-parseInt(_0x4f4eed(0xb0))/0x3*(-parseInt(_0x4f4eed(0xb6))/0x4)+-parseInt(_0x4f4eed(0x90))/0x5+parseInt(_0x4f4eed(0xc7))/0x6*(parseInt(_0x4f4eed(0xba))/0x7)+-parseInt(_0x4f4eed(0xbf))/0x8*(parseInt(_0x4f4eed(0x80))/0x9)+-parseInt(_0x4f4eed(0xc4))/0xa+parseInt(_0x4f4eed(0xdd))/0xb;if(_0x34c1d7===_0x4391ef)break;else _0x49edd6['push'](_0x49edd6['shift']());}catch(_0x2dec41){_0x49edd6['push'](_0x49edd6['shift']());}}}(a0_0x4457,0xa40ec));import*as a0_0x5f5694 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x2e1023(0x9c);function authorizeWithDropbox(){var _0x2f66d6=a0_0x2e1023,_0x413947=window[_0x2f66d6(0x84)]['href']['split']('?')[0x0],_0x36bcb1=_0x2f66d6(0x91),_0x54e9c3='offline',_0xeae093=_0x2f66d6(0xe0)+clientId+'&response_type='+_0x36bcb1+_0x2f66d6(0xb9)+_0x54e9c3+_0x2f66d6(0xd3)+encodeURIComponent(_0x413947);window[_0x2f66d6(0x84)][_0x2f66d6(0xa7)]=_0xeae093;}function a0_0x47b8(_0x4bb054,_0x29908d){var _0x445749=a0_0x4457();return a0_0x47b8=function(_0x47b8e2,_0x5de4aa){_0x47b8e2=_0x47b8e2-0x7f;var _0xe376e8=_0x445749[_0x47b8e2];return _0xe376e8;},a0_0x47b8(_0x4bb054,_0x29908d);}function a0_0x4457(){var _0x18cef0=['access_token','folder','code=','file','48zxWYkV','Download\x20failed,\x20unknown\x20http\x20status:','Refreshing\x20token...','application/json','replace','\x20files\x20in\x20Kabu?','145528LJowlB','alert','setItem','&token_access_type=','28SLKjfZ','blob','name','split','Download\x20failed\x20for\x20','656qbMFZw','log','state','Do\x20not\x20receive\x20authorization','3UEEyqQ','222560KbkiLq','listFiles','refreshToken','1855650NxeDWA','Unable\x20to\x20refresh\x20token','Restoring...','.tag','stringify','search','Authorization\x20Code:','Wait\x20a\x20little\x20bit...','active','Kabu\x20storage\x20↦\x20Cloud\x20◆','refresh_token=','Do\x20you\x20want\x20to\x20logout?','&redirect_uri=','Restore\x20canceled\x20by\x20user.','Cloud\x20login\x20required!','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','status','length','parse','push','POST','responseText','572803fOKFJx','uploadFileInCloud','320690EaEELL','https://www.dropbox.com/oauth2/authorize?client_id=','Do\x20you\x20want\x20to\x20backup\x20','addEventListener','exec','Cloud\x20↦\x20Kabu\x20storage\x20◆','41823PsPKCR','json','application/octet-stream','No\x20refresh\x20token','location','Error\x20creating\x20folder\x20','https://content.dropboxapi.com/2/files/download','Bearer\x20','&client_secret=','=([^&#]*)','https://api.dropboxapi.com/oauth2/token','Failed\x20to\x20refresh\x20Dropbox\x20token.','classList','remove','getItem','Folder\x20already\x20exists','6385150mYWbbM','code','map','downloadFileInCloud','uId','Backing\x20up...','onload','click','save','Upload\x20failed,\x20unknown\x20http\x20status:\x20','https://api.dropboxapi.com/2/files/create_folder_v2','error','nwb3dnfh09rhs31','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','authorization_code','screenshot','DOMContentLoaded',',\x20status:\x20','confirm','https://api.dropbox.com/oauth2/token','https://content.dropboxapi.com/2/files/upload','send','uid','href','application/x-www-form-urlencoded','&client_id=','error_description','accessToken'];a0_0x4457=function(){return _0x18cef0;};return a0_0x4457();}function handleDropboxCallback(){var _0x34bb55=a0_0x2e1023,_0x41a492=getUrlParameter(_0x34bb55(0x91));_0x41a492?(getAccessToken(_0x41a492),console[_0x34bb55(0xc0)](_0x34bb55(0xcd),_0x41a492)):console[_0x34bb55(0xc0)](_0x34bb55(0xc2));}function getUrlParameter(_0x4f96ac){var _0x4691b8=a0_0x2e1023;_0x4f96ac=_0x4f96ac['replace'](/[\[]/,'\x5c[')[_0x4691b8(0xb4)](/[\]]/,'\x5c]');var _0x22aef5=new RegExp('[\x5c?&#]'+_0x4f96ac+_0x4691b8(0x89)),_0xe8b4f8=_0x22aef5[_0x4691b8(0xe3)](location[_0x4691b8(0xcc)]);return _0xe8b4f8===null?'':decodeURIComponent(_0xe8b4f8[0x1][_0x4691b8(0xb4)](/\+/g,'\x20'));}function getAccessToken(_0x3c9ac0){var _0x4030d5=a0_0x2e1023,_0x5e14a1=_0x4030d5(0x9e),_0x115aa3=window[_0x4030d5(0x84)][_0x4030d5(0xa7)][_0x4030d5(0xbd)]('?')[0x0],_0x5875cb=new XMLHttpRequest();_0x5875cb['open'](_0x4030d5(0xdb),_0x4030d5(0xa3)),_0x5875cb['setRequestHeader']('Content-Type',_0x4030d5(0xa8)),_0x5875cb[_0x4030d5(0x96)]=function(){var _0x3ffca1=_0x4030d5;if(_0x5875cb[_0x3ffca1(0xd7)]===0xc8){var _0x2e191d=JSON[_0x3ffca1(0xd9)](_0x5875cb[_0x3ffca1(0xdc)]),_0x5d873c=_0x2e191d[_0x3ffca1(0xac)],_0x1cc41=_0x2e191d['refresh_token'],_0x5b8f3a=_0x2e191d[_0x3ffca1(0xa6)];localStorage[_0x3ffca1(0xb8)]('accessToken',_0x5d873c),localStorage[_0x3ffca1(0xb8)](_0x3ffca1(0xc6),_0x1cc41),localStorage['setItem'](_0x3ffca1(0x94),_0x5b8f3a);}else console[_0x3ffca1(0xc0)](_0x3ffca1(0x9d));},_0x5875cb[_0x4030d5(0xa5)](_0x4030d5(0xae)+_0x3c9ac0+'&grant_type='+_0x5e14a1+_0x4030d5(0xa9)+clientId+_0x4030d5(0x88)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x115aa3));}export async function dpCreateFolder(_0x18c916){var _0x1babeb=a0_0x2e1023;const _0x4441c6=localStorage[_0x1babeb(0x8e)](_0x1babeb(0x94));let _0x324531=localStorage[_0x1babeb(0x8e)](_0x1babeb(0xab));const _0x3306d2='/'+_0x4441c6+'/'+_0x18c916,_0x54988d=JSON[_0x1babeb(0xcb)]({'path':_0x3306d2,'autorename':![]});for(let _0x2de8ae=0x0;_0x2de8ae<0x2;_0x2de8ae++){try{const _0x375993=await fetch(_0x1babeb(0x9a),{'method':_0x1babeb(0xdb),'headers':{'Authorization':_0x1babeb(0x87)+_0x324531,'Content-Type':'application/json'},'body':_0x54988d});if(_0x375993['status']===0x191){const _0x4fcbd5=await dpRefreshToken();if(!_0x4fcbd5)throw new Error(_0x1babeb(0xc8));_0x324531=localStorage[_0x1babeb(0x8e)]('accessToken');continue;}if(_0x375993[_0x1babeb(0xd7)]===0x199)return{'message':_0x1babeb(0x8f),'path':_0x18c916};if(!_0x375993['ok'])throw new Error(_0x1babeb(0x85)+_0x18c916);const _0xbd35b8=await _0x375993[_0x1babeb(0x81)]();return await lockNoti('Folder\x20created','',0xbb8),_0xbd35b8;}catch(_0x181ba3){if(_0x2de8ae===0x1)throw _0x181ba3;}}return![];}export async function dpRefreshToken(){var _0x28487d=a0_0x2e1023;if(!localStorage[_0x28487d(0x8e)](_0x28487d(0xc6)))throw _0x28487d(0x83);try{const _0x5afb40=await fetch(_0x28487d(0x8a),{'method':_0x28487d(0xdb),'headers':{'Content-Type':_0x28487d(0xa8)},'body':_0x28487d(0xd1)+localStorage[_0x28487d(0x8e)](_0x28487d(0xc6))+_0x28487d(0xd6)}),_0x425ff8=await _0x5afb40['json']();if(!_0x425ff8[_0x28487d(0x9b)])return localStorage[_0x28487d(0xb8)](_0x28487d(0xab),_0x425ff8[_0x28487d(0xac)]),await lockNoti(_0x28487d(0xb2),'',0xbb8),await delay(0x3e8),!![];else alert(_0x425ff8[_0x28487d(0xaa)]||_0x28487d(0x8b));}catch(_0x3ad7d2){console[_0x28487d(0x9b)]('Error\x20while\x20refreshing\x20token:',_0x3ad7d2);}return![];}export async function dpUploadFile(_0xd725b3,_0x5553ec,_0x56412d){var _0x31f2f7=a0_0x2e1023;const _0x3dbb53=localStorage[_0x31f2f7(0x8e)](_0x31f2f7(0x94));var _0x2e8ebe=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x3dbb53+'/'+_0x56412d+'/'+_0xd725b3}),_0x211e66=new Blob([_0x5553ec],{'type':_0x31f2f7(0x82)});for(var _0x314f77=0x0;_0x314f77<0x2;_0x314f77++){var _0x1bbf84=await fetch(_0x31f2f7(0xa4),{'method':_0x31f2f7(0xdb),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem']('accessToken'),'Dropbox-API-Arg':_0x2e8ebe,'Content-Type':_0x31f2f7(0x82)},'body':_0x211e66});if(_0x1bbf84[_0x31f2f7(0xd7)]!=0xc8){if(_0x1bbf84['status']==0x191){var _0xaf2fbb=await dpRefreshToken();if(!_0xaf2fbb)throw _0x31f2f7(0xc8);continue;}else throw _0x31f2f7(0x99)+_0x1bbf84[_0x31f2f7(0xd7)];}else{var _0x6d6b21=await _0x1bbf84['json']();return console[_0x31f2f7(0xc0)](_0x31f2f7(0xd0),_0xd725b3),_0x6d6b21;}}return![];}export async function dpDownloadFile(_0x37fef8,_0x5587db){var _0x3a719b=a0_0x2e1023;const _0xffec07=localStorage['getItem'](_0x3a719b(0x94));var _0x277eb2=JSON[_0x3a719b(0xcb)]({'path':'/'+_0xffec07+'/'+_0x5587db+'/'+_0x37fef8});for(var _0x571318=0x0;_0x571318<0x2;_0x571318++){var _0x53dd13=await fetch(_0x3a719b(0x86),{'method':_0x3a719b(0xdb),'headers':{'Authorization':_0x3a719b(0x87)+localStorage[_0x3a719b(0x8e)](_0x3a719b(0xab)),'Dropbox-API-Arg':_0x277eb2}});if(_0x53dd13[_0x3a719b(0xd7)]!=0xc8){if(_0x53dd13[_0x3a719b(0xd7)]==0x191){var _0x2e85fb=await dpRefreshToken();if(!_0x2e85fb)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x3a719b(0xb1)+_0x53dd13[_0x3a719b(0xd7)];}const _0x3e65c6=new File([await _0x53dd13[_0x3a719b(0xbb)]()],_0x37fef8);return console[_0x3a719b(0xc0)](_0x3a719b(0x7f),_0x3e65c6[_0x3a719b(0xbc)]),a0_0x5f5694[_0x3a719b(0xde)](_0x3e65c6,()=>{}),_0x3e65c6;}return![];}document['addEventListener'](a0_0x2e1023(0xa0),function(){var _0xa33133=a0_0x2e1023;dropboxRestore[_0xa33133(0xe2)](_0xa33133(0x97),async function(){var _0x38b025=_0xa33133;await lockNoti(_0x38b025(0xce),'',0x1388);const _0x2e323b=localStorage[_0x38b025(0x8e)]('uId'),_0x80ccb0=[_0x38b025(0xc1),_0x38b025(0x98),_0x38b025(0x9f)];if(!_0x2e323b){window[_0x38b025(0xb7)](_0x38b025(0xd5));return;}let _0x195924=[];for(const _0x215bc2 of _0x80ccb0){let _0x5cf288={'path':'/'+_0x2e323b+'/'+_0x215bc2};for(let _0x218d87=0x0;_0x218d87<0x2;_0x218d87++){let _0x363550=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x38b025(0xdb),'headers':{'Authorization':_0x38b025(0x87)+localStorage[_0x38b025(0x8e)](_0x38b025(0xab)),'Content-Type':_0x38b025(0xb3)},'body':JSON['stringify'](_0x5cf288)});if(_0x363550[_0x38b025(0xd7)]===0xc8){let _0x363368=await _0x363550['json'](),_0x54ebb7=_0x363368['entries']['filter'](_0x40007e=>_0x40007e[_0x38b025(0xca)]===_0x38b025(0xaf));_0x54ebb7[_0x38b025(0xd8)]>0x0&&_0x195924[_0x38b025(0xda)](..._0x54ebb7[_0x38b025(0x92)](_0x68cef1=>({'name':_0x68cef1[_0x38b025(0xbc)],'folder':_0x215bc2})));break;}else{if(_0x363550['status']===0x191){let _0x3dd7d7=await dpRefreshToken();if(!_0x3dd7d7)throw _0x38b025(0xc8);}else{console['error'](_0x38b025(0xbe)+_0x215bc2+_0x38b025(0xa1)+_0x363550[_0x38b025(0xd7)]);break;}}}}if(_0x195924[_0x38b025(0xd8)]>0x0){const _0x2c31c2='Do\x20you\x20want\x20to\x20restore\x20'+_0x195924[_0x38b025(0xd8)]+'\x20files\x20from\x20Cloud?';if(window['confirm'](_0x2c31c2))for(const _0xa7721e of _0x195924){await lockNoti(_0x38b025(0xc9),_0xa7721e[_0x38b025(0xbc)],0xbb8),await dpDownloadFile(_0xa7721e[_0x38b025(0xbc)],_0xa7721e[_0x38b025(0xad)]);}else console['log'](_0x38b025(0xd4));}else console[_0x38b025(0xc0)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup['addEventListener'](_0xa33133(0x97),async function(){var _0x1e9907=_0xa33133;await lockNoti(_0x1e9907(0xce),'',0x1388);const _0x375aa2=localStorage[_0x1e9907(0x8e)](_0x1e9907(0x94));if(_0x375aa2===null||_0x375aa2==='')window[_0x1e9907(0xb7)](_0x1e9907(0xd5));else{const _0x38c08c=[_0x1e9907(0xc1),_0x1e9907(0x98),_0x1e9907(0x9f)];for(const _0x751e72 of _0x38c08c){await dpCreateFolder(_0x751e72);}let _0x38ace6=0x0;for(const _0x588d14 of _0x38c08c){const _0x46b440=a0_0x5f5694[_0x1e9907(0xc5)](_0x588d14+'s');_0x38ace6+=_0x46b440['length'];}if(window[_0x1e9907(0xa2)](_0x1e9907(0xe1)+_0x38ace6+_0x1e9907(0xb5)))for(const _0x9bad34 of _0x38c08c){const _0x52789d=a0_0x5f5694[_0x1e9907(0xc5)](_0x9bad34+'s');for(const _0x1ae68f of _0x52789d){const _0x10ea86=await a0_0x5f5694[_0x1e9907(0x93)]('/data/'+_0x9bad34+'s/'+_0x1ae68f);try{await lockNoti(_0x1e9907(0x95),_0x1ae68f,0xbb8),await dpUploadFile(_0x1ae68f,_0x10ea86,_0x9bad34);}catch(_0x20f9da){console[_0x1e9907(0x9b)]('Failed\x20to\x20upload\x20file\x20'+_0x1ae68f+':',_0x20f9da);}}}else console[_0x1e9907(0xc0)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0xa33133(0xe2)](_0xa33133(0x97),function(){var _0x3db858=_0xa33133;const _0x920ca4=localStorage[_0x3db858(0x8e)](_0x3db858(0x94));_0x920ca4===null||_0x920ca4===''?authorizeWithDropbox():window[_0x3db858(0xa2)](_0x3db858(0xd2))&&(localStorage[_0x3db858(0xb8)](_0x3db858(0x94),''),dropboxRestore['classList'][_0x3db858(0x8d)]('active'),dropboxBackup[_0x3db858(0x8c)][_0x3db858(0x8d)](_0x3db858(0xcf)),dropboxCloud[_0x3db858(0x8c)][_0x3db858(0x8d)](_0x3db858(0xcf)));}),handleDropboxCallback();});