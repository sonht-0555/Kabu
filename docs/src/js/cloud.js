var a0_0xbd6ee0=a0_0x35b7;(function(_0x23079e,_0x2e308b){var _0x2e78e1=a0_0x35b7,_0x3213ee=_0x23079e();while(!![]){try{var _0x4fca08=-parseInt(_0x2e78e1(0x1c5))/0x1*(parseInt(_0x2e78e1(0x20e))/0x2)+parseInt(_0x2e78e1(0x1e2))/0x3*(parseInt(_0x2e78e1(0x1c1))/0x4)+-parseInt(_0x2e78e1(0x1ba))/0x5+parseInt(_0x2e78e1(0x1d8))/0x6*(parseInt(_0x2e78e1(0x1bb))/0x7)+-parseInt(_0x2e78e1(0x1e3))/0x8*(-parseInt(_0x2e78e1(0x1bf))/0x9)+parseInt(_0x2e78e1(0x1ca))/0xa+-parseInt(_0x2e78e1(0x213))/0xb*(parseInt(_0x2e78e1(0x1e4))/0xc);if(_0x4fca08===_0x2e308b)break;else _0x3213ee['push'](_0x3213ee['shift']());}catch(_0x4c5b0c){_0x3213ee['push'](_0x3213ee['shift']());}}}(a0_0x4bab,0xa7ec0));import*as a0_0x14750a from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0xbd6ee0(0x1f2),clientSecret=a0_0xbd6ee0(0x208);function authorizeWithDropbox(){var _0x284dff=a0_0xbd6ee0,_0x164d5a=window['location'][_0x284dff(0x20a)][_0x284dff(0x201)]('?')[0x0],_0x41a18b=_0x284dff(0x1c2),_0x246cdc=_0x284dff(0x1db),_0x3f2684=_0x284dff(0x21a)+clientId+_0x284dff(0x1f4)+_0x41a18b+_0x284dff(0x1ea)+_0x246cdc+_0x284dff(0x1c8)+encodeURIComponent(_0x164d5a);window['location'][_0x284dff(0x20a)]=_0x3f2684;}function handleDropboxCallback(){var _0x69a6b2=a0_0xbd6ee0,_0x45a418=getUrlParameter(_0x69a6b2(0x1c2));_0x45a418?(getAccessToken(_0x45a418),console[_0x69a6b2(0x200)](_0x69a6b2(0x1b8),_0x45a418)):console[_0x69a6b2(0x200)](_0x69a6b2(0x1f1));}function getUrlParameter(_0x4f6ae4){var _0x29b67d=a0_0xbd6ee0;_0x4f6ae4=_0x4f6ae4[_0x29b67d(0x20c)](/[\[]/,'\x5c[')[_0x29b67d(0x20c)](/[\]]/,'\x5c]');var _0x26e3c9=new RegExp(_0x29b67d(0x206)+_0x4f6ae4+_0x29b67d(0x1d5)),_0x422b1=_0x26e3c9[_0x29b67d(0x1b4)](location[_0x29b67d(0x1f6)]);return _0x422b1===null?'':decodeURIComponent(_0x422b1[0x1][_0x29b67d(0x20c)](/\+/g,'\x20'));}function getAccessToken(_0x119b51){var _0xe3cb63=a0_0xbd6ee0,_0x2b8010=_0xe3cb63(0x203),_0x4d8457=window[_0xe3cb63(0x207)][_0xe3cb63(0x20a)][_0xe3cb63(0x201)]('?')[0x0],_0x5127bc=new XMLHttpRequest();_0x5127bc['open'](_0xe3cb63(0x202),'https://api.dropbox.com/oauth2/token'),_0x5127bc['setRequestHeader']('Content-Type',_0xe3cb63(0x1f3)),_0x5127bc[_0xe3cb63(0x1cf)]=function(){var _0xfc27bc=_0xe3cb63;if(_0x5127bc['status']===0xc8){var _0x2a7dc1=JSON['parse'](_0x5127bc[_0xfc27bc(0x215)]),_0x49e809=_0x2a7dc1[_0xfc27bc(0x1ef)],_0x4a5214=_0x2a7dc1[_0xfc27bc(0x210)],_0x2ee3e0=_0x2a7dc1[_0xfc27bc(0x1dc)];localStorage[_0xfc27bc(0x1d4)](_0xfc27bc(0x1f9),_0x49e809),localStorage[_0xfc27bc(0x1d4)](_0xfc27bc(0x20b),_0x4a5214),localStorage[_0xfc27bc(0x1d4)]('uId',_0x2ee3e0);}else console[_0xfc27bc(0x200)](_0xfc27bc(0x209));},_0x5127bc[_0xe3cb63(0x1de)](_0xe3cb63(0x1e9)+_0x119b51+_0xe3cb63(0x219)+_0x2b8010+_0xe3cb63(0x1c9)+clientId+_0xe3cb63(0x1d7)+clientSecret+_0xe3cb63(0x1c8)+encodeURIComponent(_0x4d8457));}export async function dpCreateFolder(_0x45d95a){var _0x1c314c=a0_0xbd6ee0;const _0x34ef78=localStorage[_0x1c314c(0x212)]('uId');let _0x2bff66=localStorage[_0x1c314c(0x212)]('accessToken');const _0x5cbdde='/'+_0x34ef78+'/'+_0x45d95a,_0x1a7472=JSON[_0x1c314c(0x1ff)]({'path':_0x5cbdde,'autorename':![]});for(let _0x50277a=0x0;_0x50277a<0x2;_0x50277a++){try{const _0x217ab0=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x1c314c(0x202),'headers':{'Authorization':'Bearer\x20'+_0x2bff66,'Content-Type':_0x1c314c(0x20f)},'body':_0x1a7472});if(_0x217ab0['status']===0x191){const _0x2d8369=await dpRefreshToken();if(!_0x2d8369)throw new Error(_0x1c314c(0x1e6));_0x2bff66=localStorage[_0x1c314c(0x212)](_0x1c314c(0x1f9));continue;}if(_0x217ab0[_0x1c314c(0x1cc)]===0x199)return{'message':_0x1c314c(0x1f8),'path':_0x45d95a};if(!_0x217ab0['ok'])throw new Error(_0x1c314c(0x1ec)+_0x45d95a);const _0x5f29c8=await _0x217ab0[_0x1c314c(0x1cb)]();return await lockNoti(_0x1c314c(0x1f0),'',0xbb8),_0x5f29c8;}catch(_0x72e8da){if(_0x50277a===0x1)throw _0x72e8da;}}return![];}export async function dpRefreshToken(){var _0x153d6e=a0_0xbd6ee0;if(!localStorage[_0x153d6e(0x212)](_0x153d6e(0x20b)))throw _0x153d6e(0x1e8);try{const _0x5a423f=await fetch(_0x153d6e(0x1e0),{'method':_0x153d6e(0x202),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x153d6e(0x1e7)+localStorage[_0x153d6e(0x212)](_0x153d6e(0x20b))+_0x153d6e(0x1d1)}),_0x5b41c1=await _0x5a423f[_0x153d6e(0x1cb)]();if(!_0x5b41c1[_0x153d6e(0x1ce)])return localStorage[_0x153d6e(0x1d4)](_0x153d6e(0x1f9),_0x5b41c1[_0x153d6e(0x1ef)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x5b41c1['error_description']||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x1ecd1c){console[_0x153d6e(0x1ce)](_0x153d6e(0x1e5),_0x1ecd1c);}return![];}export async function dpUploadFile(_0x1af4b8,_0x155a15,_0x2e686c){var _0x43972a=a0_0xbd6ee0;const _0x2e6770=localStorage[_0x43972a(0x212)](_0x43972a(0x1b9));var _0xe1543e=JSON[_0x43972a(0x1ff)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x2e6770+'/'+_0x2e686c+'/'+_0x1af4b8}),_0x55c570=new Blob([_0x155a15],{'type':'application/octet-stream'});for(var _0x501109=0x0;_0x501109<0x2;_0x501109++){var _0xb90332=await fetch(_0x43972a(0x1bd),{'method':_0x43972a(0x202),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x43972a(0x212)](_0x43972a(0x1f9)),'Dropbox-API-Arg':_0xe1543e,'Content-Type':_0x43972a(0x1fb)},'body':_0x55c570});if(_0xb90332[_0x43972a(0x1cc)]!=0xc8){if(_0xb90332[_0x43972a(0x1cc)]==0x191){var _0x17515c=await dpRefreshToken();if(!_0x17515c)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0xb90332[_0x43972a(0x1cc)];}else{var _0x3ef296=await _0xb90332['json']();return console[_0x43972a(0x200)](_0x43972a(0x216),_0x1af4b8),_0x3ef296;}}return![];}export async function dpDownloadFile(_0x3f81cc,_0xfe35e3){var _0x3a1cef=a0_0xbd6ee0;const _0x8c0649=localStorage['getItem']('uId');var _0x4b3c6b=JSON[_0x3a1cef(0x1ff)]({'path':'/'+_0x8c0649+'/'+_0xfe35e3+'/'+_0x3f81cc});for(var _0x44831d=0x0;_0x44831d<0x2;_0x44831d++){var _0x456c93=await fetch(_0x3a1cef(0x1cd),{'method':_0x3a1cef(0x202),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x3a1cef(0x1f9)),'Dropbox-API-Arg':_0x4b3c6b}});if(_0x456c93[_0x3a1cef(0x1cc)]!=0xc8){if(_0x456c93[_0x3a1cef(0x1cc)]==0x191){var _0x57fad4=await dpRefreshToken();if(!_0x57fad4)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x3a1cef(0x218)+_0x456c93[_0x3a1cef(0x1cc)];}const _0x336155=new File([await _0x456c93[_0x3a1cef(0x211)]()],_0x3f81cc);return console[_0x3a1cef(0x200)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x336155[_0x3a1cef(0x1be)]),a0_0x14750a[_0x3a1cef(0x1bc)](_0x336155,()=>{}),_0x336155;}return![];}function a0_0x35b7(_0x83baf,_0x587464){var _0x4babed=a0_0x4bab();return a0_0x35b7=function(_0x35b78c,_0x2d5d1c){_0x35b78c=_0x35b78c-0x1b4;var _0x468f2b=_0x4babed[_0x35b78c];return _0x468f2b;},a0_0x35b7(_0x83baf,_0x587464);}function a0_0x4bab(){var _0xd0d5ec=['209jbCMdv','Do\x20you\x20want\x20to\x20logout?','responseText','Kabu\x20storage\x20↦\x20Cloud\x20◆','Failed\x20to\x20upload\x20file\x20','Download\x20failed,\x20unknown\x20http\x20status:','&grant_type=','https://www.dropbox.com/oauth2/authorize?client_id=','length','exec','alert','Cloud\x20login\x20required!','active','Authorization\x20Code:','uId','2495845jelygl','7wIzNLT','uploadFileInCloud','https://content.dropboxapi.com/2/files/upload','name','106461YrJexR','Restoring...','6188jAGUAY','code','.tag',',\x20status:\x20','468112GZbhxd','remove','Do\x20you\x20want\x20to\x20backup\x20','&redirect_uri=','&client_id=','2771010bHVkAV','json','status','https://content.dropboxapi.com/2/files/download','error','onload','Do\x20you\x20want\x20to\x20restore\x20','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','screenshot','No\x20files\x20found\x20to\x20restore.','setItem','=([^&#]*)','entries','&client_secret=','5922774UpXxYz','classList','/data/','offline','uid','state','send','file','https://api.dropboxapi.com/oauth2/token','downloadFileInCloud','1359DVlMqd','232cVuNYv','412404hrwSbq','Error\x20while\x20refreshing\x20token:','Unable\x20to\x20refresh\x20token','refresh_token=','No\x20refresh\x20token','code=','&token_access_type=','confirm','Error\x20creating\x20folder\x20','https://api.dropboxapi.com/2/files/list_folder','DOMContentLoaded','access_token','Folder\x20created','Do\x20not\x20receive\x20authorization','knh3uz2mx2hp2eu','application/x-www-form-urlencoded','&response_type=','click','search','addEventListener','Folder\x20already\x20exists','accessToken','folder','application/octet-stream','Bearer\x20','Download\x20failed\x20for\x20','Restore\x20canceled\x20by\x20user.','stringify','log','split','POST','authorization_code','Wait\x20a\x20little\x20bit...','listFiles','[\x5c?&#]','location','nwb3dnfh09rhs31','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','href','refreshToken','replace','save','2XoggIj','application/json','refresh_token','blob','getItem'];a0_0x4bab=function(){return _0xd0d5ec;};return a0_0x4bab();}document['addEventListener'](a0_0xbd6ee0(0x1ee),function(){var _0x438ead=a0_0xbd6ee0;dropboxRestore[_0x438ead(0x1f7)](_0x438ead(0x1f5),async function(){var _0x229aa5=_0x438ead;await lockNoti(_0x229aa5(0x204),'',0x1388);const _0x261a11=localStorage[_0x229aa5(0x212)]('uId'),_0x884916=[_0x229aa5(0x1dd),_0x229aa5(0x20d),'screenshot'];if(!_0x261a11){window[_0x229aa5(0x1b5)](_0x229aa5(0x1b6));return;}let _0x3378b1=[];for(const _0x4513cf of _0x884916){let _0x17a94e={'path':'/'+_0x261a11+'/'+_0x4513cf};for(let _0xc96de=0x0;_0xc96de<0x2;_0xc96de++){let _0x3123b0=await fetch(_0x229aa5(0x1ed),{'method':'POST','headers':{'Authorization':_0x229aa5(0x1fc)+localStorage[_0x229aa5(0x212)](_0x229aa5(0x1f9)),'Content-Type':_0x229aa5(0x20f)},'body':JSON[_0x229aa5(0x1ff)](_0x17a94e)});if(_0x3123b0[_0x229aa5(0x1cc)]===0xc8){let _0x42e6d9=await _0x3123b0['json'](),_0x4de2d7=_0x42e6d9[_0x229aa5(0x1d6)]['filter'](_0x5d637f=>_0x5d637f[_0x229aa5(0x1c3)]===_0x229aa5(0x1df));_0x4de2d7[_0x229aa5(0x21b)]>0x0&&_0x3378b1['push'](..._0x4de2d7['map'](_0x148d78=>({'name':_0x148d78[_0x229aa5(0x1be)],'folder':_0x4513cf})));break;}else{if(_0x3123b0['status']===0x191){let _0x4b3a8e=await dpRefreshToken();if(!_0x4b3a8e)throw _0x229aa5(0x1e6);}else{console[_0x229aa5(0x1ce)](_0x229aa5(0x1fd)+_0x4513cf+_0x229aa5(0x1c4)+_0x3123b0[_0x229aa5(0x1cc)]);break;}}}}if(_0x3378b1[_0x229aa5(0x21b)]>0x0){const _0x21f16f=_0x229aa5(0x1d0)+_0x3378b1[_0x229aa5(0x21b)]+'\x20files\x20from\x20Cloud?';if(window[_0x229aa5(0x1eb)](_0x21f16f))for(const _0x1d9682 of _0x3378b1){await lockNoti(_0x229aa5(0x1c0),_0x1d9682[_0x229aa5(0x1be)],0xbb8),await dpDownloadFile(_0x1d9682[_0x229aa5(0x1be)],_0x1d9682[_0x229aa5(0x1fa)]);}else console[_0x229aa5(0x200)](_0x229aa5(0x1fe));}else console[_0x229aa5(0x200)](_0x229aa5(0x1d3));}),dropboxBackup[_0x438ead(0x1f7)](_0x438ead(0x1f5),async function(){var _0x3bb805=_0x438ead;await lockNoti(_0x3bb805(0x204),'',0x1388);const _0x390a42=localStorage[_0x3bb805(0x212)](_0x3bb805(0x1b9));if(_0x390a42===null||_0x390a42==='')window[_0x3bb805(0x1b5)](_0x3bb805(0x1b6));else{const _0xf2ab3a=['state',_0x3bb805(0x20d),_0x3bb805(0x1d2)];for(const _0xacd8b3 of _0xf2ab3a){await dpCreateFolder(_0xacd8b3);}let _0x23a38c=0x0;for(const _0x27a307 of _0xf2ab3a){const _0x1d49d9=a0_0x14750a[_0x3bb805(0x205)](_0x27a307+'s');_0x23a38c+=_0x1d49d9[_0x3bb805(0x21b)];}if(window[_0x3bb805(0x1eb)](_0x3bb805(0x1c7)+_0x23a38c+'\x20files\x20in\x20Kabu?'))for(const _0x337e0b of _0xf2ab3a){const _0x53c751=a0_0x14750a[_0x3bb805(0x205)](_0x337e0b+'s');for(const _0x393b13 of _0x53c751){const _0xdc6a3a=await a0_0x14750a[_0x3bb805(0x1e1)](_0x3bb805(0x1da)+_0x337e0b+'s/'+_0x393b13);try{await lockNoti('Backing\x20up...',_0x393b13,0xbb8),await dpUploadFile(_0x393b13,_0xdc6a3a,_0x337e0b);}catch(_0x4ca5b8){console[_0x3bb805(0x1ce)](_0x3bb805(0x217)+_0x393b13+':',_0x4ca5b8);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x438ead(0x1f7)](_0x438ead(0x1f5),function(){var _0x32419a=_0x438ead;const _0x39d383=localStorage['getItem'](_0x32419a(0x1b9));_0x39d383===null||_0x39d383===''?authorizeWithDropbox():window[_0x32419a(0x1eb)](_0x32419a(0x214))&&(localStorage['setItem'](_0x32419a(0x1b9),''),dropboxRestore[_0x32419a(0x1d9)][_0x32419a(0x1c6)](_0x32419a(0x1b7)),dropboxBackup[_0x32419a(0x1d9)][_0x32419a(0x1c6)](_0x32419a(0x1b7)),dropboxCloud[_0x32419a(0x1d9)][_0x32419a(0x1c6)](_0x32419a(0x1b7)));}),handleDropboxCallback();});