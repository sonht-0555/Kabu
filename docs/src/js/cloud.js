var a0_0x2089fa=a0_0x47e5;(function(_0x44802d,_0x3322ad){var _0x194b69=a0_0x47e5,_0x3966e0=_0x44802d();while(!![]){try{var _0x2b5e32=parseInt(_0x194b69(0x17a))/0x1+-parseInt(_0x194b69(0x191))/0x2+-parseInt(_0x194b69(0x17d))/0x3*(-parseInt(_0x194b69(0x1af))/0x4)+-parseInt(_0x194b69(0x17e))/0x5+-parseInt(_0x194b69(0x18d))/0x6*(parseInt(_0x194b69(0x19b))/0x7)+-parseInt(_0x194b69(0x1b1))/0x8*(parseInt(_0x194b69(0x1bc))/0x9)+parseInt(_0x194b69(0x1a0))/0xa;if(_0x2b5e32===_0x3322ad)break;else _0x3966e0['push'](_0x3966e0['shift']());}catch(_0x48fb77){_0x3966e0['push'](_0x3966e0['shift']());}}}(a0_0x96bf,0x1bce2));import*as a0_0x632690 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x2089fa(0x1a5);function authorizeWithDropbox(){var _0x25e1f1=a0_0x2089fa,_0x45385d=window['location'][_0x25e1f1(0x195)][_0x25e1f1(0x178)]('?')[0x0],_0x1defcd=_0x25e1f1(0x16e),_0x520d01=_0x25e1f1(0x1b7),_0x26108c=_0x25e1f1(0x162)+clientId+_0x25e1f1(0x1b9)+_0x1defcd+_0x25e1f1(0x168)+_0x520d01+_0x25e1f1(0x1a4)+encodeURIComponent(_0x45385d);window[_0x25e1f1(0x1b2)]['href']=_0x26108c;}function handleDropboxCallback(){var _0xedcae6=a0_0x2089fa,_0x15cf6a=getUrlParameter(_0xedcae6(0x16e));_0x15cf6a?(getAccessToken(_0x15cf6a),console[_0xedcae6(0x18f)](_0xedcae6(0x197),_0x15cf6a)):console[_0xedcae6(0x18f)](_0xedcae6(0x16a));}function getUrlParameter(_0x3a695b){var _0x1e5650=a0_0x2089fa;_0x3a695b=_0x3a695b[_0x1e5650(0x19c)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x14c859=new RegExp(_0x1e5650(0x179)+_0x3a695b+'=([^&#]*)'),_0x56627d=_0x14c859[_0x1e5650(0x164)](location[_0x1e5650(0x1ba)]);return _0x56627d===null?'':decodeURIComponent(_0x56627d[0x1][_0x1e5650(0x19c)](/\+/g,'\x20'));}function getAccessToken(_0x2c5afc){var _0x1b0198=a0_0x2089fa,_0x5b7149=_0x1b0198(0x173),_0x11387c=window[_0x1b0198(0x1b2)][_0x1b0198(0x195)][_0x1b0198(0x178)]('?')[0x0],_0x1393df=new XMLHttpRequest();_0x1393df[_0x1b0198(0x177)]('POST','https://api.dropbox.com/oauth2/token'),_0x1393df[_0x1b0198(0x172)](_0x1b0198(0x19a),'application/x-www-form-urlencoded'),_0x1393df['onload']=function(){var _0x3b3175=_0x1b0198;if(_0x1393df[_0x3b3175(0x184)]===0xc8){var _0x13f39d=JSON[_0x3b3175(0x18e)](_0x1393df[_0x3b3175(0x1a2)]),_0x20a33e=_0x13f39d[_0x3b3175(0x17f)],_0x34a971=_0x13f39d[_0x3b3175(0x1a3)],_0x45fb0c=_0x13f39d[_0x3b3175(0x163)];localStorage[_0x3b3175(0x1c3)](_0x3b3175(0x1b8),_0x20a33e),localStorage[_0x3b3175(0x1c3)](_0x3b3175(0x17c),_0x34a971),localStorage[_0x3b3175(0x1c3)](_0x3b3175(0x185),_0x45fb0c);}else console[_0x3b3175(0x18f)](_0x3b3175(0x1c0));},_0x1393df[_0x1b0198(0x18b)]('code='+_0x2c5afc+_0x1b0198(0x16c)+_0x5b7149+_0x1b0198(0x1a8)+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0x11387c));}function a0_0x47e5(_0x21d46d,_0x31a98e){var _0x96bf99=a0_0x96bf();return a0_0x47e5=function(_0x47e5cd,_0x1eb260){_0x47e5cd=_0x47e5cd-0x162;var _0x372ede=_0x96bf99[_0x47e5cd];return _0x372ede;},a0_0x47e5(_0x21d46d,_0x31a98e);}export async function dpCreateFolder(_0x2c1519){var _0x3711d5=a0_0x2089fa;const _0x194107=localStorage[_0x3711d5(0x18c)](_0x3711d5(0x185));let _0x1725e8=localStorage['getItem'](_0x3711d5(0x1b8));const _0x419b2b='/'+_0x194107+'/'+_0x2c1519,_0x46d831=JSON[_0x3711d5(0x170)]({'path':_0x419b2b,'autorename':![]});for(let _0x4e7cb3=0x0;_0x4e7cb3<0x2;_0x4e7cb3++){try{const _0x349e21=await fetch(_0x3711d5(0x1aa),{'method':_0x3711d5(0x1ac),'headers':{'Authorization':'Bearer\x20'+_0x1725e8,'Content-Type':_0x3711d5(0x187)},'body':_0x46d831});if(_0x349e21[_0x3711d5(0x184)]===0x191){const _0x562d8c=await dpRefreshToken();if(!_0x562d8c)throw new Error(_0x3711d5(0x17b));_0x1725e8=localStorage[_0x3711d5(0x18c)](_0x3711d5(0x1b8));continue;}if(_0x349e21[_0x3711d5(0x184)]===0x199)return{'message':_0x3711d5(0x1c2),'path':_0x2c1519};if(!_0x349e21['ok'])throw new Error(_0x3711d5(0x1c7)+_0x2c1519);const _0x473eda=await _0x349e21[_0x3711d5(0x1b5)]();return await lockNoti('Folder\x20created','',0xbb8),_0x473eda;}catch(_0x1b6c48){if(_0x4e7cb3===0x1)throw _0x1b6c48;}}return![];}function a0_0x96bf(){var _0x5030b9=['access_token','refresh_token=','Bearer\x20','classList','remove','status','uId','addEventListener','application/json','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','name','active','send','getItem','6FMbPjE','parse','log','Restore\x20canceled\x20by\x20user.','16188oCqOIB','application/x-www-form-urlencoded','Failed\x20to\x20refresh\x20Dropbox\x20token.','downloadFileInCloud','href','length','Authorization\x20Code:','map','\x20files\x20in\x20Kabu?','Content-Type','1435595NSCSHh','replace','\x20files\x20from\x20Cloud?','Download\x20failed,\x20unknown\x20http\x20status:','Wait\x20a\x20little\x20bit...','4326630dzBcJs','error_description','responseText','refresh_token','&redirect_uri=','nwb3dnfh09rhs31','state','entries','&client_id=','overwrite','https://api.dropboxapi.com/2/files/create_folder_v2','application/octet-stream','POST','file','/data/','40QcqCyR','https://api.dropboxapi.com/2/files/list_folder','8ekQAOv','location','folder','Cloud\x20login\x20required!','json','confirm','offline','accessToken','&response_type=','search','blob','1067139TKjSSm','Kabu\x20storage\x20↦\x20Cloud\x20◆','screenshot','Failed\x20to\x20upload\x20file\x20','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token',',\x20status:\x20','Folder\x20already\x20exists','setItem','Do\x20you\x20want\x20to\x20logout?','https://content.dropboxapi.com/2/files/download','alert','Error\x20creating\x20folder\x20','https://www.dropbox.com/oauth2/authorize?client_id=','uid','exec','No\x20files\x20found\x20to\x20restore.','No\x20refresh\x20token','click','&token_access_type=','Restoring...','Do\x20not\x20receive\x20authorization','save','&grant_type=','push','code','https://content.dropboxapi.com/2/files/upload','stringify','Do\x20you\x20want\x20to\x20restore\x20','setRequestHeader','authorization_code','uploadFileInCloud','.tag','error','open','split','[\x5c?&#]','470iiFiWG','Unable\x20to\x20refresh\x20token','refreshToken','53052AUGHbl','821665SWiqce'];a0_0x96bf=function(){return _0x5030b9;};return a0_0x96bf();}export async function dpRefreshToken(){var _0xc9d6f2=a0_0x2089fa;if(!localStorage[_0xc9d6f2(0x18c)](_0xc9d6f2(0x17c)))throw _0xc9d6f2(0x166);try{const _0x46f591=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0xc9d6f2(0x1ac),'headers':{'Content-Type':_0xc9d6f2(0x192)},'body':_0xc9d6f2(0x180)+localStorage[_0xc9d6f2(0x18c)](_0xc9d6f2(0x17c))+_0xc9d6f2(0x188)}),_0xc3665b=await _0x46f591[_0xc9d6f2(0x1b5)]();if(!_0xc3665b[_0xc9d6f2(0x176)])return localStorage[_0xc9d6f2(0x1c3)](_0xc9d6f2(0x1b8),_0xc3665b['access_token']),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0xc3665b[_0xc9d6f2(0x1a1)]||_0xc9d6f2(0x193));}catch(_0x4cd3f3){console[_0xc9d6f2(0x176)]('Error\x20while\x20refreshing\x20token:',_0x4cd3f3);}return![];}export async function dpUploadFile(_0x9d6956,_0x3f9ae0,_0x2bb0f8){var _0x672a5f=a0_0x2089fa;const _0x1165c8=localStorage['getItem'](_0x672a5f(0x185));var _0x26e644=JSON[_0x672a5f(0x170)]({'autorename':!![],'mode':_0x672a5f(0x1a9),'mute':!![],'strict_conflict':![],'path':'/'+_0x1165c8+'/'+_0x2bb0f8+'/'+_0x9d6956}),_0x45f36c=new Blob([_0x3f9ae0],{'type':_0x672a5f(0x1ab)});for(var _0x26bcad=0x0;_0x26bcad<0x2;_0x26bcad++){var _0x3f65e3=await fetch(_0x672a5f(0x16f),{'method':_0x672a5f(0x1ac),'headers':{'Authorization':_0x672a5f(0x181)+localStorage['getItem'](_0x672a5f(0x1b8)),'Dropbox-API-Arg':_0x26e644,'Content-Type':_0x672a5f(0x1ab)},'body':_0x45f36c});if(_0x3f65e3[_0x672a5f(0x184)]!=0xc8){if(_0x3f65e3['status']==0x191){var _0x4e1e22=await dpRefreshToken();if(!_0x4e1e22)throw _0x672a5f(0x17b);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x3f65e3[_0x672a5f(0x184)];}else{var _0xe5b646=await _0x3f65e3['json']();return console[_0x672a5f(0x18f)](_0x672a5f(0x1bd),_0x9d6956),_0xe5b646;}}return![];}export async function dpDownloadFile(_0x589705,_0x5886da){var _0x22f896=a0_0x2089fa;const _0x1480a0=localStorage['getItem'](_0x22f896(0x185));var _0x70fcb=JSON['stringify']({'path':'/'+_0x1480a0+'/'+_0x5886da+'/'+_0x589705});for(var _0x4185b1=0x0;_0x4185b1<0x2;_0x4185b1++){var _0x1719c8=await fetch(_0x22f896(0x1c5),{'method':'POST','headers':{'Authorization':_0x22f896(0x181)+localStorage[_0x22f896(0x18c)]('accessToken'),'Dropbox-API-Arg':_0x70fcb}});if(_0x1719c8[_0x22f896(0x184)]!=0xc8){if(_0x1719c8['status']==0x191){var _0x205cc6=await dpRefreshToken();if(!_0x205cc6)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x22f896(0x19e)+_0x1719c8[_0x22f896(0x184)];}const _0x303662=new File([await _0x1719c8[_0x22f896(0x1bb)]()],_0x589705);return console[_0x22f896(0x18f)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x303662[_0x22f896(0x189)]),a0_0x632690[_0x22f896(0x174)](_0x303662,()=>{}),_0x303662;}return![];}document['addEventListener']('DOMContentLoaded',function(){var _0x1f6d91=a0_0x2089fa;dropboxRestore['addEventListener'](_0x1f6d91(0x167),async function(){var _0x5be820=_0x1f6d91;await lockNoti(_0x5be820(0x19f),'',0x1388);const _0x38dcd8=localStorage[_0x5be820(0x18c)]('uId'),_0x289ba9=['state',_0x5be820(0x16b),_0x5be820(0x1be)];if(!_0x38dcd8){window[_0x5be820(0x1c6)](_0x5be820(0x1b4));return;}let _0x3089b9=[];for(const _0xae4f6b of _0x289ba9){let _0x24c3bc={'path':'/'+_0x38dcd8+'/'+_0xae4f6b};for(let _0x5aa9f6=0x0;_0x5aa9f6<0x2;_0x5aa9f6++){let _0x17da03=await fetch(_0x5be820(0x1b0),{'method':_0x5be820(0x1ac),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x5be820(0x18c)]('accessToken'),'Content-Type':_0x5be820(0x187)},'body':JSON[_0x5be820(0x170)](_0x24c3bc)});if(_0x17da03['status']===0xc8){let _0x35923e=await _0x17da03[_0x5be820(0x1b5)](),_0x1eceee=_0x35923e[_0x5be820(0x1a7)]['filter'](_0x2e3589=>_0x2e3589[_0x5be820(0x175)]===_0x5be820(0x1ad));_0x1eceee[_0x5be820(0x196)]>0x0&&_0x3089b9[_0x5be820(0x16d)](..._0x1eceee[_0x5be820(0x198)](_0x53d477=>({'name':_0x53d477[_0x5be820(0x189)],'folder':_0xae4f6b})));break;}else{if(_0x17da03[_0x5be820(0x184)]===0x191){let _0x50187a=await dpRefreshToken();if(!_0x50187a)throw _0x5be820(0x17b);}else{console[_0x5be820(0x176)]('Download\x20failed\x20for\x20'+_0xae4f6b+_0x5be820(0x1c1)+_0x17da03[_0x5be820(0x184)]);break;}}}}if(_0x3089b9[_0x5be820(0x196)]>0x0){const _0x1a4fdc=_0x5be820(0x171)+_0x3089b9[_0x5be820(0x196)]+_0x5be820(0x19d);if(window[_0x5be820(0x1b6)](_0x1a4fdc))for(const _0x4b511a of _0x3089b9){await lockNoti(_0x5be820(0x169),_0x4b511a[_0x5be820(0x189)],0xbb8),await dpDownloadFile(_0x4b511a['name'],_0x4b511a[_0x5be820(0x1b3)]);}else console[_0x5be820(0x18f)](_0x5be820(0x190));}else console[_0x5be820(0x18f)](_0x5be820(0x165));}),dropboxBackup['addEventListener'](_0x1f6d91(0x167),async function(){var _0xf16776=_0x1f6d91;await lockNoti(_0xf16776(0x19f),'',0x1388);const _0x5c21ce=localStorage[_0xf16776(0x18c)](_0xf16776(0x185));if(_0x5c21ce===null||_0x5c21ce==='')window['alert'](_0xf16776(0x1b4));else{const _0x3d3dbf=[_0xf16776(0x1a6),_0xf16776(0x16b),_0xf16776(0x1be)];for(const _0x3b31f0 of _0x3d3dbf){await dpCreateFolder(_0x3b31f0);}let _0x5439a9=0x0;for(const _0x58963c of _0x3d3dbf){const _0x36fe9b=a0_0x632690['listFiles'](_0x58963c+'s');_0x5439a9+=_0x36fe9b[_0xf16776(0x196)];}if(window[_0xf16776(0x1b6)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x5439a9+_0xf16776(0x199)))for(const _0x4766a2 of _0x3d3dbf){const _0x52fd1a=a0_0x632690['listFiles'](_0x4766a2+'s');for(const _0x772e8d of _0x52fd1a){const _0x50630b=await a0_0x632690[_0xf16776(0x194)](_0xf16776(0x1ae)+_0x4766a2+'s/'+_0x772e8d);try{await lockNoti('Backing\x20up...',_0x772e8d,0xbb8),await dpUploadFile(_0x772e8d,_0x50630b,_0x4766a2);}catch(_0x5d8175){console[_0xf16776(0x176)](_0xf16776(0x1bf)+_0x772e8d+':',_0x5d8175);}}}else console[_0xf16776(0x18f)](_0xf16776(0x190));}}),dropboxCloud[_0x1f6d91(0x186)]('click',function(){var _0xd6c332=_0x1f6d91;const _0xecc334=localStorage[_0xd6c332(0x18c)](_0xd6c332(0x185));_0xecc334===null||_0xecc334===''?authorizeWithDropbox():window[_0xd6c332(0x1b6)](_0xd6c332(0x1c4))&&(localStorage[_0xd6c332(0x1c3)](_0xd6c332(0x185),''),dropboxRestore['classList']['remove'](_0xd6c332(0x18a)),dropboxBackup[_0xd6c332(0x182)][_0xd6c332(0x183)](_0xd6c332(0x18a)),dropboxCloud[_0xd6c332(0x182)][_0xd6c332(0x183)](_0xd6c332(0x18a)));}),handleDropboxCallback();});