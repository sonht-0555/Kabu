var a0_0x3bed7d=a0_0x33f8;(function(_0x36264d,_0x25e75a){var _0xd6b426=a0_0x33f8,_0x9300c4=_0x36264d();while(!![]){try{var _0x23d2d3=-parseInt(_0xd6b426(0xb6))/0x1*(-parseInt(_0xd6b426(0x98))/0x2)+parseInt(_0xd6b426(0x91))/0x3+parseInt(_0xd6b426(0xa6))/0x4+parseInt(_0xd6b426(0xbe))/0x5+parseInt(_0xd6b426(0xc5))/0x6*(-parseInt(_0xd6b426(0x8f))/0x7)+-parseInt(_0xd6b426(0x96))/0x8+parseInt(_0xd6b426(0xd1))/0x9*(parseInt(_0xd6b426(0xd3))/0xa);if(_0x23d2d3===_0x25e75a)break;else _0x9300c4['push'](_0x9300c4['shift']());}catch(_0x2e03e9){_0x9300c4['push'](_0x9300c4['shift']());}}}(a0_0x4fee,0xbbff6));import*as a0_0x5cca0c from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x3bed7d(0xbf),clientSecret=a0_0x3bed7d(0x81);function a0_0x4fee(){var _0x27912c=['authorization_code','length','&client_secret=','href','active','6eqNnoR','Folder\x20already\x20exists','alert','accessToken','uId','error_description','Cloud\x20↦\x20Kabu\x20storage\x20◆','refresh_token=','=([^&#]*)','Wait\x20a\x20little\x20bit...','folder','remove','144fxNVkL','application/x-www-form-urlencoded','814250Mcvfux','Folder\x20created','send','search','&grant_type=','.tag','push','map','DOMContentLoaded','setItem','POST','save','uploadFileInCloud','https://api.dropboxapi.com/2/files/create_folder_v2','uid','getItem','Restoring...','nwb3dnfh09rhs31','https://content.dropboxapi.com/2/files/upload','Bearer\x20','Backing\x20up...','Do\x20not\x20receive\x20authorization','error','Kabu\x20storage\x20↦\x20Cloud\x20◆','addEventListener','Unable\x20to\x20refresh\x20token','state','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Do\x20you\x20want\x20to\x20logout?','Error\x20creating\x20folder\x20','confirm','9264647EbAtvA','responseText','1626798hEPtCe','application/json','screenshot','log','\x20files\x20from\x20Cloud?','10150728uLhiye','name','836012KaJMDX','Cloud\x20login\x20required!','Do\x20you\x20want\x20to\x20restore\x20','No\x20refresh\x20token','offline','&response_type=','https://api.dropboxapi.com/2/files/list_folder','Restore\x20canceled\x20by\x20user.','status','Failed\x20to\x20refresh\x20Dropbox\x20token.','https://api.dropboxapi.com/oauth2/token','open','location','json','652128gEyYrO','&redirect_uri=','overwrite','access_token','\x20files\x20in\x20Kabu?','click','Authorization\x20Code:','/data/','listFiles','refreshToken','replace','No\x20files\x20found\x20to\x20restore.','https://api.dropbox.com/oauth2/token','split','file','stringify','2MXFJOa','onload','classList','filter','Failed\x20to\x20upload\x20file\x20','Content-Type','application/octet-stream','downloadFileInCloud','2591450maARcA','knh3uz2mx2hp2eu'];a0_0x4fee=function(){return _0x27912c;};return a0_0x4fee();}function a0_0x33f8(_0x470b3a,_0x22f86){var _0x4fee10=a0_0x4fee();return a0_0x33f8=function(_0x33f88a,_0x17131b){_0x33f88a=_0x33f88a-0x71;var _0x106c97=_0x4fee10[_0x33f88a];return _0x106c97;},a0_0x33f8(_0x470b3a,_0x22f86);}function authorizeWithDropbox(){var _0x561baf=a0_0x3bed7d,_0xd64cac=window[_0x561baf(0xa4)][_0x561baf(0xc3)][_0x561baf(0xb3)]('?')[0x0],_0x11ba07='code',_0x2ab6cd=_0x561baf(0x9c),_0x55b21a='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x561baf(0x9d)+_0x11ba07+'&token_access_type='+_0x2ab6cd+_0x561baf(0xa7)+encodeURIComponent(_0xd64cac);window['location'][_0x561baf(0xc3)]=_0x55b21a;}function handleDropboxCallback(){var _0x348dfa=a0_0x3bed7d,_0x1a9dcd=getUrlParameter('code');_0x1a9dcd?(getAccessToken(_0x1a9dcd),console[_0x348dfa(0x94)](_0x348dfa(0xac),_0x1a9dcd)):console[_0x348dfa(0x94)](_0x348dfa(0x85));}function getUrlParameter(_0x23a60d){var _0x1ff12d=a0_0x3bed7d;_0x23a60d=_0x23a60d[_0x1ff12d(0xb0)](/[\[]/,'\x5c[')[_0x1ff12d(0xb0)](/[\]]/,'\x5c]');var _0x39adb6=new RegExp('[\x5c?&#]'+_0x23a60d+_0x1ff12d(0xcd)),_0x546539=_0x39adb6['exec'](location[_0x1ff12d(0x73)]);return _0x546539===null?'':decodeURIComponent(_0x546539[0x1][_0x1ff12d(0xb0)](/\+/g,'\x20'));}function getAccessToken(_0x1699db){var _0x3e72ce=a0_0x3bed7d,_0x1f7077=_0x3e72ce(0xc0),_0x1594a9=window[_0x3e72ce(0xa4)][_0x3e72ce(0xc3)]['split']('?')[0x0],_0x4cf5ab=new XMLHttpRequest();_0x4cf5ab[_0x3e72ce(0xa3)](_0x3e72ce(0x7a),_0x3e72ce(0xb2)),_0x4cf5ab['setRequestHeader'](_0x3e72ce(0xbb),_0x3e72ce(0xd2)),_0x4cf5ab[_0x3e72ce(0xb7)]=function(){var _0x4aa35f=_0x3e72ce;if(_0x4cf5ab[_0x4aa35f(0xa0)]===0xc8){var _0x42f5c2=JSON['parse'](_0x4cf5ab[_0x4aa35f(0x90)]),_0x4b1b78=_0x42f5c2[_0x4aa35f(0xa9)],_0x2ed4f4=_0x42f5c2['refresh_token'],_0x4a304c=_0x42f5c2[_0x4aa35f(0x7e)];localStorage[_0x4aa35f(0x79)](_0x4aa35f(0xc8),_0x4b1b78),localStorage[_0x4aa35f(0x79)]('refreshToken',_0x2ed4f4),localStorage[_0x4aa35f(0x79)](_0x4aa35f(0xc9),_0x4a304c);}else console[_0x4aa35f(0x94)](_0x4aa35f(0x8b));},_0x4cf5ab[_0x3e72ce(0x72)]('code='+_0x1699db+_0x3e72ce(0x74)+_0x1f7077+'&client_id='+clientId+_0x3e72ce(0xc2)+clientSecret+_0x3e72ce(0xa7)+encodeURIComponent(_0x1594a9));}export async function dpCreateFolder(_0x5a94ff){var _0x115bc1=a0_0x3bed7d;const _0x45446f=localStorage[_0x115bc1(0x7f)](_0x115bc1(0xc9));let _0x4f7f15=localStorage[_0x115bc1(0x7f)](_0x115bc1(0xc8));const _0x41e50d='/'+_0x45446f+'/'+_0x5a94ff,_0x5a50ce=JSON[_0x115bc1(0xb5)]({'path':_0x41e50d,'autorename':![]});for(let _0x6bfc9f=0x0;_0x6bfc9f<0x2;_0x6bfc9f++){try{const _0x3042bd=await fetch(_0x115bc1(0x7d),{'method':_0x115bc1(0x7a),'headers':{'Authorization':_0x115bc1(0x83)+_0x4f7f15,'Content-Type':_0x115bc1(0x92)},'body':_0x5a50ce});if(_0x3042bd[_0x115bc1(0xa0)]===0x191){const _0x1f801b=await dpRefreshToken();if(!_0x1f801b)throw new Error(_0x115bc1(0x89));_0x4f7f15=localStorage[_0x115bc1(0x7f)]('accessToken');continue;}if(_0x3042bd[_0x115bc1(0xa0)]===0x199)return{'message':_0x115bc1(0xc6),'path':_0x5a94ff};if(!_0x3042bd['ok'])throw new Error(_0x115bc1(0x8d)+_0x5a94ff);const _0x593a91=await _0x3042bd[_0x115bc1(0xa5)]();return await lockNoti(_0x115bc1(0x71),'',0xbb8),_0x593a91;}catch(_0x113b85){if(_0x6bfc9f===0x1)throw _0x113b85;}}return![];}export async function dpRefreshToken(){var _0x5ba84f=a0_0x3bed7d;if(!localStorage[_0x5ba84f(0x7f)](_0x5ba84f(0xaf)))throw _0x5ba84f(0x9b);try{const _0x22d1a0=await fetch(_0x5ba84f(0xa2),{'method':_0x5ba84f(0x7a),'headers':{'Content-Type':_0x5ba84f(0xd2)},'body':_0x5ba84f(0xcc)+localStorage[_0x5ba84f(0x7f)](_0x5ba84f(0xaf))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x59b192=await _0x22d1a0[_0x5ba84f(0xa5)]();if(!_0x59b192['error'])return localStorage[_0x5ba84f(0x79)](_0x5ba84f(0xc8),_0x59b192[_0x5ba84f(0xa9)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x59b192[_0x5ba84f(0xca)]||_0x5ba84f(0xa1));}catch(_0x2f0736){console[_0x5ba84f(0x86)]('Error\x20while\x20refreshing\x20token:',_0x2f0736);}return![];}export async function dpUploadFile(_0xc44e44,_0x1498a0,_0x188d95){var _0x56ad32=a0_0x3bed7d;const _0x5a58c4=localStorage['getItem'](_0x56ad32(0xc9));var _0x292afe=JSON[_0x56ad32(0xb5)]({'autorename':!![],'mode':_0x56ad32(0xa8),'mute':!![],'strict_conflict':![],'path':'/'+_0x5a58c4+'/'+_0x188d95+'/'+_0xc44e44}),_0x2d261e=new Blob([_0x1498a0],{'type':_0x56ad32(0xbc)});for(var _0x1e0573=0x0;_0x1e0573<0x2;_0x1e0573++){var _0x4730ab=await fetch(_0x56ad32(0x82),{'method':_0x56ad32(0x7a),'headers':{'Authorization':_0x56ad32(0x83)+localStorage[_0x56ad32(0x7f)](_0x56ad32(0xc8)),'Dropbox-API-Arg':_0x292afe,'Content-Type':_0x56ad32(0xbc)},'body':_0x2d261e});if(_0x4730ab[_0x56ad32(0xa0)]!=0xc8){if(_0x4730ab[_0x56ad32(0xa0)]==0x191){var _0x435e62=await dpRefreshToken();if(!_0x435e62)throw _0x56ad32(0x89);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x4730ab['status'];}else{var _0x3b7cbf=await _0x4730ab[_0x56ad32(0xa5)]();return console[_0x56ad32(0x94)](_0x56ad32(0x87),_0xc44e44),_0x3b7cbf;}}return![];}export async function dpDownloadFile(_0x5c3448,_0x22512b){var _0x4faad8=a0_0x3bed7d;const _0x6795cb=localStorage[_0x4faad8(0x7f)](_0x4faad8(0xc9));var _0x542fa6=JSON[_0x4faad8(0xb5)]({'path':'/'+_0x6795cb+'/'+_0x22512b+'/'+_0x5c3448});for(var _0x1900f4=0x0;_0x1900f4<0x2;_0x1900f4++){var _0x183ba9=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x4faad8(0x7a),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x4faad8(0xc8)),'Dropbox-API-Arg':_0x542fa6}});if(_0x183ba9[_0x4faad8(0xa0)]!=0xc8){if(_0x183ba9[_0x4faad8(0xa0)]==0x191){var _0x4e4fc4=await dpRefreshToken();if(!_0x4e4fc4)throw _0x4faad8(0x89);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x183ba9[_0x4faad8(0xa0)];}const _0x5f0dd3=new File([await _0x183ba9['blob']()],_0x5c3448);return console[_0x4faad8(0x94)](_0x4faad8(0xcb),_0x5f0dd3['name']),a0_0x5cca0c[_0x4faad8(0x7c)](_0x5f0dd3,()=>{}),_0x5f0dd3;}return![];}document['addEventListener'](a0_0x3bed7d(0x78),function(){var _0x46b0e4=a0_0x3bed7d;dropboxRestore[_0x46b0e4(0x88)](_0x46b0e4(0xab),async function(){var _0x216f8d=_0x46b0e4;await lockNoti(_0x216f8d(0xce),'',0x1388);const _0x289f86=localStorage[_0x216f8d(0x7f)](_0x216f8d(0xc9)),_0x4dd4c4=[_0x216f8d(0x8a),_0x216f8d(0x7b),_0x216f8d(0x93)];if(!_0x289f86){window[_0x216f8d(0xc7)](_0x216f8d(0x99));return;}let _0x31c181=[];for(const _0x3f6085 of _0x4dd4c4){let _0x1a244b={'path':'/'+_0x289f86+'/'+_0x3f6085};for(let _0x35f856=0x0;_0x35f856<0x2;_0x35f856++){let _0x3efba2=await fetch(_0x216f8d(0x9e),{'method':'POST','headers':{'Authorization':_0x216f8d(0x83)+localStorage[_0x216f8d(0x7f)](_0x216f8d(0xc8)),'Content-Type':_0x216f8d(0x92)},'body':JSON['stringify'](_0x1a244b)});if(_0x3efba2[_0x216f8d(0xa0)]===0xc8){let _0x27ca52=await _0x3efba2[_0x216f8d(0xa5)](),_0x47f117=_0x27ca52['entries'][_0x216f8d(0xb9)](_0x59c9d3=>_0x59c9d3[_0x216f8d(0x75)]===_0x216f8d(0xb4));_0x47f117['length']>0x0&&_0x31c181[_0x216f8d(0x76)](..._0x47f117[_0x216f8d(0x77)](_0x53aea2=>({'name':_0x53aea2[_0x216f8d(0x97)],'folder':_0x3f6085})));break;}else{if(_0x3efba2['status']===0x191){let _0x2ea361=await dpRefreshToken();if(!_0x2ea361)throw _0x216f8d(0x89);}else{console[_0x216f8d(0x86)]('Download\x20failed\x20for\x20'+_0x3f6085+',\x20status:\x20'+_0x3efba2[_0x216f8d(0xa0)]);break;}}}}if(_0x31c181[_0x216f8d(0xc1)]>0x0){const _0x32193c=_0x216f8d(0x9a)+_0x31c181[_0x216f8d(0xc1)]+_0x216f8d(0x95);if(window['confirm'](_0x32193c))for(const _0x3c9177 of _0x31c181){await lockNoti(_0x216f8d(0x80),_0x3c9177[_0x216f8d(0x97)],0xbb8),await dpDownloadFile(_0x3c9177['name'],_0x3c9177[_0x216f8d(0xcf)]);}else console['log']('Restore\x20canceled\x20by\x20user.');}else console[_0x216f8d(0x94)](_0x216f8d(0xb1));}),dropboxBackup[_0x46b0e4(0x88)](_0x46b0e4(0xab),async function(){var _0x28b07e=_0x46b0e4;await lockNoti(_0x28b07e(0xce),'',0x1388);const _0xefd223=localStorage[_0x28b07e(0x7f)](_0x28b07e(0xc9));if(_0xefd223===null||_0xefd223==='')window[_0x28b07e(0xc7)](_0x28b07e(0x99));else{const _0x5efd5a=[_0x28b07e(0x8a),_0x28b07e(0x7b),_0x28b07e(0x93)];for(const _0x46eb83 of _0x5efd5a){await dpCreateFolder(_0x46eb83);}let _0x30801f=0x0;for(const _0x49e2b2 of _0x5efd5a){const _0x505353=a0_0x5cca0c[_0x28b07e(0xae)](_0x49e2b2+'s');_0x30801f+=_0x505353['length'];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x30801f+_0x28b07e(0xaa)))for(const _0x30158f of _0x5efd5a){const _0x22e10a=a0_0x5cca0c[_0x28b07e(0xae)](_0x30158f+'s');for(const _0x578e9e of _0x22e10a){const _0x22ca32=await a0_0x5cca0c[_0x28b07e(0xbd)](_0x28b07e(0xad)+_0x30158f+'s/'+_0x578e9e);try{await lockNoti(_0x28b07e(0x84),_0x578e9e,0xbb8),await dpUploadFile(_0x578e9e,_0x22ca32,_0x30158f);}catch(_0x4a66bd){console[_0x28b07e(0x86)](_0x28b07e(0xba)+_0x578e9e+':',_0x4a66bd);}}}else console[_0x28b07e(0x94)](_0x28b07e(0x9f));}}),dropboxCloud[_0x46b0e4(0x88)](_0x46b0e4(0xab),function(){var _0x5c3097=_0x46b0e4;const _0x3b2301=localStorage[_0x5c3097(0x7f)](_0x5c3097(0xc9));_0x3b2301===null||_0x3b2301===''?authorizeWithDropbox():window[_0x5c3097(0x8e)](_0x5c3097(0x8c))&&(localStorage['setItem'](_0x5c3097(0xc9),''),dropboxRestore[_0x5c3097(0xb8)][_0x5c3097(0xd0)](_0x5c3097(0xc4)),dropboxBackup[_0x5c3097(0xb8)][_0x5c3097(0xd0)]('active'),dropboxCloud[_0x5c3097(0xb8)][_0x5c3097(0xd0)](_0x5c3097(0xc4)));}),handleDropboxCallback();});