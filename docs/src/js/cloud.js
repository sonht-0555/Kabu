var a0_0xfc5f83=a0_0x17bc;(function(_0x24e645,_0x45710c){var _0x225878=a0_0x17bc,_0x576481=_0x24e645();while(!![]){try{var _0x2edd66=parseInt(_0x225878(0x17a))/0x1*(-parseInt(_0x225878(0x160))/0x2)+parseInt(_0x225878(0x180))/0x3*(-parseInt(_0x225878(0x147))/0x4)+parseInt(_0x225878(0x177))/0x5*(-parseInt(_0x225878(0x198))/0x6)+parseInt(_0x225878(0x18a))/0x7*(parseInt(_0x225878(0x191))/0x8)+-parseInt(_0x225878(0x194))/0x9+parseInt(_0x225878(0x173))/0xa+parseInt(_0x225878(0x17d))/0xb*(parseInt(_0x225878(0x18d))/0xc);if(_0x2edd66===_0x45710c)break;else _0x576481['push'](_0x576481['shift']());}catch(_0x39ca78){_0x576481['push'](_0x576481['shift']());}}}(a0_0xf590,0xee987));import*as a0_0x4d7753 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0xfc5f83(0x168),clientSecret=a0_0xfc5f83(0x16c);function authorizeWithDropbox(){var _0x424907=a0_0xfc5f83,_0x732578=window[_0x424907(0x15a)][_0x424907(0x15d)][_0x424907(0x19e)]('?')[0x0],_0x5590b6='code',_0x48436d=_0x424907(0x162),_0x55b6f6=_0x424907(0x14c)+clientId+'&response_type='+_0x5590b6+_0x424907(0x197)+_0x48436d+_0x424907(0x183)+encodeURIComponent(_0x732578);window[_0x424907(0x15a)][_0x424907(0x15d)]=_0x55b6f6;}function handleDropboxCallback(){var _0xecb3a6=a0_0xfc5f83,_0x416cd4=getUrlParameter(_0xecb3a6(0x157));_0x416cd4?(getAccessToken(_0x416cd4),console['log'](_0xecb3a6(0x15f),_0x416cd4)):console[_0xecb3a6(0x151)](_0xecb3a6(0x16b));}function getUrlParameter(_0x1199ad){var _0x9fd295=a0_0xfc5f83;_0x1199ad=_0x1199ad['replace'](/[\[]/,'\x5c[')[_0x9fd295(0x1ab)](/[\]]/,'\x5c]');var _0x3ca1f1=new RegExp('[\x5c?&#]'+_0x1199ad+_0x9fd295(0x189)),_0x27c8ca=_0x3ca1f1[_0x9fd295(0x170)](location['search']);return _0x27c8ca===null?'':decodeURIComponent(_0x27c8ca[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x5001b8){var _0x10222c=a0_0xfc5f83,_0x394537=_0x10222c(0x14f),_0x49df56=window['location'][_0x10222c(0x15d)][_0x10222c(0x19e)]('?')[0x0],_0x3722dd=new XMLHttpRequest();_0x3722dd['open']('POST','https://api.dropbox.com/oauth2/token'),_0x3722dd[_0x10222c(0x188)](_0x10222c(0x167),_0x10222c(0x1a1)),_0x3722dd[_0x10222c(0x156)]=function(){var _0xa2fc6c=_0x10222c;if(_0x3722dd[_0xa2fc6c(0x175)]===0xc8){var _0x1ebc35=JSON[_0xa2fc6c(0x19a)](_0x3722dd[_0xa2fc6c(0x1a6)]),_0x124e6e=_0x1ebc35[_0xa2fc6c(0x149)],_0x391f20=_0x1ebc35[_0xa2fc6c(0x195)],_0x592b56=_0x1ebc35[_0xa2fc6c(0x19f)];localStorage['setItem'](_0xa2fc6c(0x15c),_0x124e6e),localStorage[_0xa2fc6c(0x18e)](_0xa2fc6c(0x1a7),_0x391f20),localStorage['setItem'](_0xa2fc6c(0x172),_0x592b56);}else console['log']('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x3722dd[_0x10222c(0x166)](_0x10222c(0x16a)+_0x5001b8+_0x10222c(0x153)+_0x394537+_0x10222c(0x1aa)+clientId+_0x10222c(0x18c)+clientSecret+_0x10222c(0x183)+encodeURIComponent(_0x49df56));}function a0_0x17bc(_0x2bd1f0,_0x5bec1a){var _0xf5903e=a0_0xf590();return a0_0x17bc=function(_0x17bce3,_0x120406){_0x17bce3=_0x17bce3-0x146;var _0x24165e=_0xf5903e[_0x17bce3];return _0x24165e;},a0_0x17bc(_0x2bd1f0,_0x5bec1a);}export async function dpCreateFolder(_0x2e7318){var _0x2f0080=a0_0xfc5f83;const _0x564521=localStorage[_0x2f0080(0x182)](_0x2f0080(0x172));let _0x42f779=localStorage[_0x2f0080(0x182)]('accessToken');const _0x668258='/'+_0x564521+'/'+_0x2e7318,_0x46f250=JSON['stringify']({'path':_0x668258,'autorename':![]});for(let _0x229ef2=0x0;_0x229ef2<0x2;_0x229ef2++){try{const _0x286616=await fetch(_0x2f0080(0x14b),{'method':'POST','headers':{'Authorization':_0x2f0080(0x14a)+_0x42f779,'Content-Type':'application/json'},'body':_0x46f250});if(_0x286616[_0x2f0080(0x175)]===0x191){const _0x365ed6=await dpRefreshToken();if(!_0x365ed6)throw new Error('Unable\x20to\x20refresh\x20token');_0x42f779=localStorage['getItem'](_0x2f0080(0x15c));continue;}if(_0x286616['status']===0x199)return{'message':_0x2f0080(0x171),'path':_0x2e7318};if(!_0x286616['ok'])throw new Error(_0x2f0080(0x14e)+_0x2e7318);const _0x42e3aa=await _0x286616['json']();return await lockNoti(_0x2f0080(0x165),'',0xbb8),_0x42e3aa;}catch(_0x12890f){if(_0x229ef2===0x1)throw _0x12890f;}}return![];}export async function dpRefreshToken(){var _0x2d073b=a0_0xfc5f83;if(!localStorage['getItem'](_0x2d073b(0x1a7)))throw'No\x20refresh\x20token';try{const _0x221176=await fetch(_0x2d073b(0x1ae),{'method':_0x2d073b(0x161),'headers':{'Content-Type':_0x2d073b(0x1a1)},'body':'refresh_token='+localStorage[_0x2d073b(0x182)](_0x2d073b(0x1a7))+_0x2d073b(0x192)}),_0x171f6e=await _0x221176[_0x2d073b(0x19d)]();if(!_0x171f6e[_0x2d073b(0x1a3)])return localStorage['setItem'](_0x2d073b(0x15c),_0x171f6e[_0x2d073b(0x149)]),await lockNoti(_0x2d073b(0x150),'',0xbb8),await delay(0x3e8),!![];else alert(_0x171f6e[_0x2d073b(0x181)]||_0x2d073b(0x1ad));}catch(_0x59eabf){console[_0x2d073b(0x1a3)](_0x2d073b(0x16f),_0x59eabf);}return![];}function a0_0xf590(){var _0x5b8adf=['23605980VfJBjD','setItem','folder','name','1016ZLtfBH','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Do\x20you\x20want\x20to\x20logout?','9302481DNlsTF','refresh_token','Backing\x20up...','&token_access_type=','9291552InBxBK','filter','parse','Download\x20failed,\x20unknown\x20http\x20status:','downloadFileInCloud','json','split','uid','uploadFileInCloud','application/x-www-form-urlencoded','overwrite','error','Unable\x20to\x20refresh\x20token','screenshot','responseText','refreshToken','Kabu\x20storage\x20↦\x20Cloud\x20◆','listFiles','&client_id=','replace','stringify','Failed\x20to\x20refresh\x20Dropbox\x20token.','https://api.dropboxapi.com/oauth2/token','application/octet-stream','3388MStQJV','Restore\x20canceled\x20by\x20user.','access_token','Bearer\x20','https://api.dropboxapi.com/2/files/create_folder_v2','https://www.dropbox.com/oauth2/authorize?client_id=','Wait\x20a\x20little\x20bit...','Error\x20creating\x20folder\x20','authorization_code','Refreshing\x20token...','log','Do\x20you\x20want\x20to\x20backup\x20','&grant_type=','addEventListener','Failed\x20to\x20upload\x20file\x20','onload','code','Download\x20failed\x20for\x20','save','location','active','accessToken','href','DOMContentLoaded','Authorization\x20Code:','12vTqDqw','POST','offline','file','\x20files\x20in\x20Kabu?','Folder\x20created','send','Content-Type','knh3uz2mx2hp2eu','Upload\x20failed,\x20unknown\x20http\x20status:\x20','code=','Do\x20not\x20receive\x20authorization','nwb3dnfh09rhs31','Do\x20you\x20want\x20to\x20restore\x20','classList','Error\x20while\x20refreshing\x20token:','exec','Folder\x20already\x20exists','uId','17634400RUjvLv','confirm','status','state','5RnvqQj','map','alert','28901USBkbG',',\x20status:\x20','Cloud\x20login\x20required!','11IqqAUn','click','remove','1497REmIKw','error_description','getItem','&redirect_uri=','application/json','\x20files\x20from\x20Cloud?','Restoring...','length','setRequestHeader','=([^&#]*)','23422hwBIpg','https://api.dropboxapi.com/2/files/list_folder','&client_secret='];a0_0xf590=function(){return _0x5b8adf;};return a0_0xf590();}export async function dpUploadFile(_0x52aae0,_0x1aed07,_0x345e2f){var _0x18c473=a0_0xfc5f83;const _0x5da824=localStorage[_0x18c473(0x182)](_0x18c473(0x172));var _0x549b0f=JSON['stringify']({'autorename':!![],'mode':_0x18c473(0x1a2),'mute':!![],'strict_conflict':![],'path':'/'+_0x5da824+'/'+_0x345e2f+'/'+_0x52aae0}),_0x5c3222=new Blob([_0x1aed07],{'type':_0x18c473(0x146)});for(var _0x4ff177=0x0;_0x4ff177<0x2;_0x4ff177++){var _0x31743b=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':'POST','headers':{'Authorization':_0x18c473(0x14a)+localStorage[_0x18c473(0x182)](_0x18c473(0x15c)),'Dropbox-API-Arg':_0x549b0f,'Content-Type':'application/octet-stream'},'body':_0x5c3222});if(_0x31743b[_0x18c473(0x175)]!=0xc8){if(_0x31743b['status']==0x191){var _0x131cbb=await dpRefreshToken();if(!_0x131cbb)throw _0x18c473(0x1a4);continue;}else throw _0x18c473(0x169)+_0x31743b[_0x18c473(0x175)];}else{var _0x10ec40=await _0x31743b[_0x18c473(0x19d)]();return console[_0x18c473(0x151)](_0x18c473(0x1a8),_0x52aae0),_0x10ec40;}}return![];}export async function dpDownloadFile(_0x318633,_0x340421){var _0x5e1e46=a0_0xfc5f83;const _0x1c8d29=localStorage['getItem'](_0x5e1e46(0x172));var _0x164296=JSON[_0x5e1e46(0x1ac)]({'path':'/'+_0x1c8d29+'/'+_0x340421+'/'+_0x318633});for(var _0x3dc3ee=0x0;_0x3dc3ee<0x2;_0x3dc3ee++){var _0xe7da90=await fetch('https://content.dropboxapi.com/2/files/download',{'method':'POST','headers':{'Authorization':_0x5e1e46(0x14a)+localStorage[_0x5e1e46(0x182)]('accessToken'),'Dropbox-API-Arg':_0x164296}});if(_0xe7da90[_0x5e1e46(0x175)]!=0xc8){if(_0xe7da90[_0x5e1e46(0x175)]==0x191){var _0x583221=await dpRefreshToken();if(!_0x583221)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x5e1e46(0x19b)+_0xe7da90['status'];}const _0x2f06ab=new File([await _0xe7da90['blob']()],_0x318633);return console[_0x5e1e46(0x151)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x2f06ab['name']),a0_0x4d7753[_0x5e1e46(0x1a0)](_0x2f06ab,()=>{}),_0x2f06ab;}return![];}document[a0_0xfc5f83(0x154)](a0_0xfc5f83(0x15e),function(){var _0x52504c=a0_0xfc5f83;dropboxRestore[_0x52504c(0x154)](_0x52504c(0x17e),async function(){var _0x2cfb2c=_0x52504c;await lockNoti(_0x2cfb2c(0x14d),'',0x1388);const _0x39ed12=localStorage[_0x2cfb2c(0x182)](_0x2cfb2c(0x172)),_0x1f72eb=[_0x2cfb2c(0x176),_0x2cfb2c(0x159),'screenshot'];if(!_0x39ed12){window['alert']('Cloud\x20login\x20required!');return;}let _0x709fd0=[];for(const _0x28c683 of _0x1f72eb){let _0x439908={'path':'/'+_0x39ed12+'/'+_0x28c683};for(let _0x2d04b2=0x0;_0x2d04b2<0x2;_0x2d04b2++){let _0x1147b1=await fetch(_0x2cfb2c(0x18b),{'method':_0x2cfb2c(0x161),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem']('accessToken'),'Content-Type':_0x2cfb2c(0x184)},'body':JSON[_0x2cfb2c(0x1ac)](_0x439908)});if(_0x1147b1[_0x2cfb2c(0x175)]===0xc8){let _0x2be271=await _0x1147b1[_0x2cfb2c(0x19d)](),_0x1f3b84=_0x2be271['entries'][_0x2cfb2c(0x199)](_0x18feab=>_0x18feab['.tag']===_0x2cfb2c(0x163));_0x1f3b84[_0x2cfb2c(0x187)]>0x0&&_0x709fd0['push'](..._0x1f3b84[_0x2cfb2c(0x178)](_0x25f993=>({'name':_0x25f993[_0x2cfb2c(0x190)],'folder':_0x28c683})));break;}else{if(_0x1147b1[_0x2cfb2c(0x175)]===0x191){let _0x2ab6e0=await dpRefreshToken();if(!_0x2ab6e0)throw _0x2cfb2c(0x1a4);}else{console[_0x2cfb2c(0x1a3)](_0x2cfb2c(0x158)+_0x28c683+_0x2cfb2c(0x17b)+_0x1147b1[_0x2cfb2c(0x175)]);break;}}}}if(_0x709fd0[_0x2cfb2c(0x187)]>0x0){const _0x53d212=_0x2cfb2c(0x16d)+_0x709fd0[_0x2cfb2c(0x187)]+_0x2cfb2c(0x185);if(window['confirm'](_0x53d212))for(const _0x499379 of _0x709fd0){await lockNoti(_0x2cfb2c(0x186),_0x499379[_0x2cfb2c(0x190)],0xbb8),await dpDownloadFile(_0x499379[_0x2cfb2c(0x190)],_0x499379[_0x2cfb2c(0x18f)]);}else console[_0x2cfb2c(0x151)]('Restore\x20canceled\x20by\x20user.');}else console[_0x2cfb2c(0x151)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x52504c(0x154)]('click',async function(){var _0x1e4fef=_0x52504c;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x5af01a=localStorage['getItem'](_0x1e4fef(0x172));if(_0x5af01a===null||_0x5af01a==='')window[_0x1e4fef(0x179)](_0x1e4fef(0x17c));else{const _0x39ff25=[_0x1e4fef(0x176),_0x1e4fef(0x159),_0x1e4fef(0x1a5)];for(const _0x6da78d of _0x39ff25){await dpCreateFolder(_0x6da78d);}let _0x3b1836=0x0;for(const _0x11df5a of _0x39ff25){const _0x3304c3=a0_0x4d7753[_0x1e4fef(0x1a9)](_0x11df5a+'s');_0x3b1836+=_0x3304c3['length'];}if(window['confirm'](_0x1e4fef(0x152)+_0x3b1836+_0x1e4fef(0x164)))for(const _0x20a0e6 of _0x39ff25){const _0x601b86=a0_0x4d7753['listFiles'](_0x20a0e6+'s');for(const _0x4b6b95 of _0x601b86){const _0x3f5603=await a0_0x4d7753[_0x1e4fef(0x19c)]('/data/'+_0x20a0e6+'s/'+_0x4b6b95);try{await lockNoti(_0x1e4fef(0x196),_0x4b6b95,0xbb8),await dpUploadFile(_0x4b6b95,_0x3f5603,_0x20a0e6);}catch(_0x276735){console[_0x1e4fef(0x1a3)](_0x1e4fef(0x155)+_0x4b6b95+':',_0x276735);}}}else console[_0x1e4fef(0x151)](_0x1e4fef(0x148));}}),dropboxCloud[_0x52504c(0x154)](_0x52504c(0x17e),function(){var _0x35f812=_0x52504c;const _0x3fbb5b=localStorage[_0x35f812(0x182)](_0x35f812(0x172));_0x3fbb5b===null||_0x3fbb5b===''?authorizeWithDropbox():window[_0x35f812(0x174)](_0x35f812(0x193))&&(localStorage[_0x35f812(0x18e)](_0x35f812(0x172),''),dropboxRestore[_0x35f812(0x16e)][_0x35f812(0x17f)](_0x35f812(0x15b)),dropboxBackup[_0x35f812(0x16e)]['remove']('active'),dropboxCloud[_0x35f812(0x16e)][_0x35f812(0x17f)](_0x35f812(0x15b)));}),handleDropboxCallback();});