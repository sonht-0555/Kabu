var a0_0x4b1299=a0_0x290f;function a0_0x290f(_0x19e4a4,_0x53180e){var _0x280dd5=a0_0x280d();return a0_0x290f=function(_0x290f76,_0x4735ba){_0x290f76=_0x290f76-0x102;var _0x4b88af=_0x280dd5[_0x290f76];return _0x4b88af;},a0_0x290f(_0x19e4a4,_0x53180e);}(function(_0x152a59,_0xbcd9e7){var _0x19fce4=a0_0x290f,_0x32547f=_0x152a59();while(!![]){try{var _0x1a0986=parseInt(_0x19fce4(0x130))/0x1+parseInt(_0x19fce4(0x153))/0x2+-parseInt(_0x19fce4(0x152))/0x3+parseInt(_0x19fce4(0x143))/0x4+parseInt(_0x19fce4(0x102))/0x5*(-parseInt(_0x19fce4(0x10d))/0x6)+parseInt(_0x19fce4(0x12c))/0x7*(parseInt(_0x19fce4(0x15c))/0x8)+parseInt(_0x19fce4(0x118))/0x9;if(_0x1a0986===_0xbcd9e7)break;else _0x32547f['push'](_0x32547f['shift']());}catch(_0x10f66b){_0x32547f['push'](_0x32547f['shift']());}}}(a0_0x280d,0x3a748));import*as a0_0x57cb67 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x4b1299(0x107),clientSecret=a0_0x4b1299(0x14e);function authorizeWithDropbox(){var _0x1e14ea=a0_0x4b1299,_0x5601dc=window['location'][_0x1e14ea(0x123)][_0x1e14ea(0x12e)]('?')[0x0],_0x9c207=_0x1e14ea(0x11d),_0x5aa841=_0x1e14ea(0x138),_0x4fe2d7=_0x1e14ea(0x13a)+clientId+'&response_type='+_0x9c207+_0x1e14ea(0x14b)+_0x5aa841+_0x1e14ea(0x122)+encodeURIComponent(_0x5601dc);window[_0x1e14ea(0x105)][_0x1e14ea(0x123)]=_0x4fe2d7;}function handleDropboxCallback(){var _0x4a8482=a0_0x4b1299,_0x31173c=getUrlParameter(_0x4a8482(0x11d));_0x31173c?(getAccessToken(_0x31173c),console[_0x4a8482(0x145)]('Authorization\x20Code:',_0x31173c)):console[_0x4a8482(0x145)](_0x4a8482(0x128));}function a0_0x280d(){var _0x25b3f2=['stringify','setRequestHeader','https://api.dropboxapi.com/oauth2/token','offline','access_token','https://www.dropbox.com/oauth2/authorize?client_id=','click','Download\x20failed\x20for\x20','Unable\x20to\x20refresh\x20token','Folder\x20created','open','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Restore\x20canceled\x20by\x20user.','=([^&#]*)','76868mZudSd','exec','log','Restoring...','send','addEventListener','responseText','Wait\x20a\x20little\x20bit...','&token_access_type=','Cloud\x20login\x20required!','uploadFileInCloud','nwb3dnfh09rhs31','refreshToken','save','json','536292sjWkII','423958WuNraC','Do\x20you\x20want\x20to\x20restore\x20','Cloud\x20↦\x20Kabu\x20storage\x20◆','name','screenshot','DOMContentLoaded','classList','blob','https://api.dropboxapi.com/2/files/create_folder_v2','24Wztuyq','[\x5c?&#]','Bearer\x20','overwrite','10MpfEuJ','Content-Type','state','location','Upload\x20failed,\x20unknown\x20http\x20status:\x20','knh3uz2mx2hp2eu','No\x20refresh\x20token','status','Do\x20you\x20want\x20to\x20backup\x20','https://content.dropboxapi.com/2/files/upload','alert','252636repJBp','code=','&client_secret=','getItem','refresh_token=','downloadFileInCloud','setItem','/data/','uId','folder','accessToken','262548PNpIut','No\x20files\x20found\x20to\x20restore.','remove','Folder\x20already\x20exists','&client_id=','code','Failed\x20to\x20upload\x20file\x20','active','confirm','replace','&redirect_uri=','href','error_description','application/octet-stream','length','Download\x20failed,\x20unknown\x20http\x20status:','Do\x20not\x20receive\x20authorization','application/json','Backing\x20up...','map','465731NMKuHs','authorization_code','split','.tag','42441dLaEtx','\x20files\x20in\x20Kabu?','POST','error','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'];a0_0x280d=function(){return _0x25b3f2;};return a0_0x280d();}function getUrlParameter(_0x5e00b2){var _0x40cb71=a0_0x4b1299;_0x5e00b2=_0x5e00b2['replace'](/[\[]/,'\x5c[')[_0x40cb71(0x121)](/[\]]/,'\x5c]');var _0xd638af=new RegExp(_0x40cb71(0x15d)+_0x5e00b2+_0x40cb71(0x142)),_0x4d0607=_0xd638af[_0x40cb71(0x144)](location['search']);return _0x4d0607===null?'':decodeURIComponent(_0x4d0607[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x5f0922){var _0x53e9a7=a0_0x4b1299,_0xe3be0a=_0x53e9a7(0x12d),_0x52c1f8=window[_0x53e9a7(0x105)][_0x53e9a7(0x123)][_0x53e9a7(0x12e)]('?')[0x0],_0x44dbbb=new XMLHttpRequest();_0x44dbbb[_0x53e9a7(0x13f)]('POST','https://api.dropbox.com/oauth2/token'),_0x44dbbb[_0x53e9a7(0x136)](_0x53e9a7(0x103),'application/x-www-form-urlencoded'),_0x44dbbb['onload']=function(){var _0x505faf=_0x53e9a7;if(_0x44dbbb['status']===0xc8){var _0x44b03d=JSON['parse'](_0x44dbbb[_0x505faf(0x149)]),_0x65b66f=_0x44b03d[_0x505faf(0x139)],_0x5f3db0=_0x44b03d['refresh_token'],_0xa5708a=_0x44b03d['uid'];localStorage[_0x505faf(0x113)](_0x505faf(0x117),_0x65b66f),localStorage[_0x505faf(0x113)]('refreshToken',_0x5f3db0),localStorage['setItem'](_0x505faf(0x115),_0xa5708a);}else console[_0x505faf(0x145)](_0x505faf(0x140));},_0x44dbbb[_0x53e9a7(0x147)](_0x53e9a7(0x10e)+_0x5f0922+'&grant_type='+_0xe3be0a+_0x53e9a7(0x11c)+clientId+_0x53e9a7(0x10f)+clientSecret+_0x53e9a7(0x122)+encodeURIComponent(_0x52c1f8));}export async function dpCreateFolder(_0x188f4e){var _0x38f1a2=a0_0x4b1299;const _0x4dd2e6=localStorage[_0x38f1a2(0x110)]('uId');let _0x1ac2bf=localStorage[_0x38f1a2(0x110)](_0x38f1a2(0x117));const _0x236989='/'+_0x4dd2e6+'/'+_0x188f4e,_0x417eb1=JSON[_0x38f1a2(0x135)]({'path':_0x236989,'autorename':![]});for(let _0x4a7c8a=0x0;_0x4a7c8a<0x2;_0x4a7c8a++){try{const _0x40e18a=await fetch(_0x38f1a2(0x15b),{'method':_0x38f1a2(0x132),'headers':{'Authorization':'Bearer\x20'+_0x1ac2bf,'Content-Type':'application/json'},'body':_0x417eb1});if(_0x40e18a[_0x38f1a2(0x109)]===0x191){const _0x312139=await dpRefreshToken();if(!_0x312139)throw new Error(_0x38f1a2(0x13d));_0x1ac2bf=localStorage[_0x38f1a2(0x110)](_0x38f1a2(0x117));continue;}if(_0x40e18a[_0x38f1a2(0x109)]===0x199)return{'message':_0x38f1a2(0x11b),'path':_0x188f4e};if(!_0x40e18a['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x188f4e);const _0x2b2b31=await _0x40e18a[_0x38f1a2(0x151)]();return await lockNoti(_0x38f1a2(0x13e),'',0xbb8),_0x2b2b31;}catch(_0x1adc35){if(_0x4a7c8a===0x1)throw _0x1adc35;}}return![];}export async function dpRefreshToken(){var _0x3723cb=a0_0x4b1299;if(!localStorage[_0x3723cb(0x110)](_0x3723cb(0x14f)))throw _0x3723cb(0x108);try{const _0x399bf3=await fetch(_0x3723cb(0x137),{'method':'POST','headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x3723cb(0x111)+localStorage[_0x3723cb(0x110)](_0x3723cb(0x14f))+_0x3723cb(0x134)}),_0xf3d64=await _0x399bf3[_0x3723cb(0x151)]();if(!_0xf3d64[_0x3723cb(0x133)])return localStorage[_0x3723cb(0x113)](_0x3723cb(0x117),_0xf3d64[_0x3723cb(0x139)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0xf3d64[_0x3723cb(0x124)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x1e26f0){console[_0x3723cb(0x133)]('Error\x20while\x20refreshing\x20token:',_0x1e26f0);}return![];}export async function dpUploadFile(_0x49f0df,_0x458ffc,_0x4f3f3f){var _0x2d2000=a0_0x4b1299;const _0x407904=localStorage[_0x2d2000(0x110)](_0x2d2000(0x115));var _0x5ad9a6=JSON[_0x2d2000(0x135)]({'autorename':!![],'mode':_0x2d2000(0x15f),'mute':!![],'strict_conflict':![],'path':'/'+_0x407904+'/'+_0x4f3f3f+'/'+_0x49f0df}),_0x50974c=new Blob([_0x458ffc],{'type':_0x2d2000(0x125)});for(var _0x23555e=0x0;_0x23555e<0x2;_0x23555e++){var _0xb26afc=await fetch(_0x2d2000(0x10b),{'method':'POST','headers':{'Authorization':_0x2d2000(0x15e)+localStorage[_0x2d2000(0x110)](_0x2d2000(0x117)),'Dropbox-API-Arg':_0x5ad9a6,'Content-Type':'application/octet-stream'},'body':_0x50974c});if(_0xb26afc[_0x2d2000(0x109)]!=0xc8){if(_0xb26afc[_0x2d2000(0x109)]==0x191){var _0x27d381=await dpRefreshToken();if(!_0x27d381)throw _0x2d2000(0x13d);continue;}else throw _0x2d2000(0x106)+_0xb26afc[_0x2d2000(0x109)];}else{var _0x1ae605=await _0xb26afc[_0x2d2000(0x151)]();return console[_0x2d2000(0x145)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x49f0df),_0x1ae605;}}return![];}export async function dpDownloadFile(_0x390985,_0x50158d){var _0x467cc9=a0_0x4b1299;const _0x399651=localStorage[_0x467cc9(0x110)](_0x467cc9(0x115));var _0x3d672f=JSON[_0x467cc9(0x135)]({'path':'/'+_0x399651+'/'+_0x50158d+'/'+_0x390985});for(var _0x1492a1=0x0;_0x1492a1<0x2;_0x1492a1++){var _0x36d63d=await fetch('https://content.dropboxapi.com/2/files/download',{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x467cc9(0x117)),'Dropbox-API-Arg':_0x3d672f}});if(_0x36d63d['status']!=0xc8){if(_0x36d63d[_0x467cc9(0x109)]==0x191){var _0x47c724=await dpRefreshToken();if(!_0x47c724)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x467cc9(0x127)+_0x36d63d[_0x467cc9(0x109)];}const _0x59ff8d=new File([await _0x36d63d[_0x467cc9(0x15a)]()],_0x390985);return console[_0x467cc9(0x145)](_0x467cc9(0x155),_0x59ff8d['name']),a0_0x57cb67[_0x467cc9(0x14d)](_0x59ff8d,()=>{}),_0x59ff8d;}return![];}document[a0_0x4b1299(0x148)](a0_0x4b1299(0x158),function(){var _0x6d025e=a0_0x4b1299;dropboxRestore[_0x6d025e(0x148)](_0x6d025e(0x13b),async function(){var _0x35b072=_0x6d025e;await lockNoti(_0x35b072(0x14a),'',0x1388);const _0x499bbd=localStorage[_0x35b072(0x110)](_0x35b072(0x115)),_0x1fcc88=['state',_0x35b072(0x150),_0x35b072(0x157)];if(!_0x499bbd){window['alert'](_0x35b072(0x14c));return;}let _0x564cba=[];for(const _0x4f5545 of _0x1fcc88){let _0x1c1855={'path':'/'+_0x499bbd+'/'+_0x4f5545};for(let _0x4e5de4=0x0;_0x4e5de4<0x2;_0x4e5de4++){let _0xfe49a1=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x35b072(0x132),'headers':{'Authorization':_0x35b072(0x15e)+localStorage[_0x35b072(0x110)](_0x35b072(0x117)),'Content-Type':_0x35b072(0x129)},'body':JSON[_0x35b072(0x135)](_0x1c1855)});if(_0xfe49a1[_0x35b072(0x109)]===0xc8){let _0xa6bf2b=await _0xfe49a1[_0x35b072(0x151)](),_0x226f8a=_0xa6bf2b['entries']['filter'](_0x737874=>_0x737874[_0x35b072(0x12f)]==='file');_0x226f8a[_0x35b072(0x126)]>0x0&&_0x564cba['push'](..._0x226f8a[_0x35b072(0x12b)](_0x40f954=>({'name':_0x40f954['name'],'folder':_0x4f5545})));break;}else{if(_0xfe49a1[_0x35b072(0x109)]===0x191){let _0x2e10c1=await dpRefreshToken();if(!_0x2e10c1)throw _0x35b072(0x13d);}else{console[_0x35b072(0x133)](_0x35b072(0x13c)+_0x4f5545+',\x20status:\x20'+_0xfe49a1['status']);break;}}}}if(_0x564cba[_0x35b072(0x126)]>0x0){const _0x4cad56=_0x35b072(0x154)+_0x564cba['length']+'\x20files\x20from\x20Cloud?';if(window['confirm'](_0x4cad56))for(const _0x459b72 of _0x564cba){await lockNoti(_0x35b072(0x146),_0x459b72[_0x35b072(0x156)],0xbb8),await dpDownloadFile(_0x459b72[_0x35b072(0x156)],_0x459b72[_0x35b072(0x116)]);}else console['log'](_0x35b072(0x141));}else console['log'](_0x35b072(0x119));}),dropboxBackup[_0x6d025e(0x148)](_0x6d025e(0x13b),async function(){var _0x171452=_0x6d025e;await lockNoti(_0x171452(0x14a),'',0x1388);const _0x1164bd=localStorage[_0x171452(0x110)](_0x171452(0x115));if(_0x1164bd===null||_0x1164bd==='')window[_0x171452(0x10c)](_0x171452(0x14c));else{const _0x4b844f=[_0x171452(0x104),_0x171452(0x150),'screenshot'];for(const _0xc28d99 of _0x4b844f){await dpCreateFolder(_0xc28d99);}let _0x50268c=0x0;for(const _0x5f5bc3 of _0x4b844f){const _0x3081ce=a0_0x57cb67['listFiles'](_0x5f5bc3+'s');_0x50268c+=_0x3081ce[_0x171452(0x126)];}if(window[_0x171452(0x120)](_0x171452(0x10a)+_0x50268c+_0x171452(0x131)))for(const _0x4014ef of _0x4b844f){const _0x3fd54b=a0_0x57cb67['listFiles'](_0x4014ef+'s');for(const _0x4bcf5a of _0x3fd54b){const _0x4e477e=await a0_0x57cb67[_0x171452(0x112)](_0x171452(0x114)+_0x4014ef+'s/'+_0x4bcf5a);try{await lockNoti(_0x171452(0x12a),_0x4bcf5a,0xbb8),await dpUploadFile(_0x4bcf5a,_0x4e477e,_0x4014ef);}catch(_0x2a33bb){console[_0x171452(0x133)](_0x171452(0x11e)+_0x4bcf5a+':',_0x2a33bb);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener']('click',function(){var _0x26e4b4=_0x6d025e;const _0x5c3e32=localStorage[_0x26e4b4(0x110)](_0x26e4b4(0x115));_0x5c3e32===null||_0x5c3e32===''?authorizeWithDropbox():window[_0x26e4b4(0x120)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x26e4b4(0x113)]('uId',''),dropboxRestore['classList']['remove'](_0x26e4b4(0x11f)),dropboxBackup[_0x26e4b4(0x159)][_0x26e4b4(0x11a)](_0x26e4b4(0x11f)),dropboxCloud[_0x26e4b4(0x159)][_0x26e4b4(0x11a)]('active'));}),handleDropboxCallback();});