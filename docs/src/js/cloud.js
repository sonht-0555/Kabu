var a0_0x3ef7fa=a0_0x2090;(function(_0x439eb8,_0x1db9e5){var _0xdb960b=a0_0x2090,_0x37ab33=_0x439eb8();while(!![]){try{var _0x5ed615=-parseInt(_0xdb960b(0x11e))/0x1+-parseInt(_0xdb960b(0x12f))/0x2*(parseInt(_0xdb960b(0x111))/0x3)+-parseInt(_0xdb960b(0x154))/0x4*(-parseInt(_0xdb960b(0x115))/0x5)+parseInt(_0xdb960b(0x164))/0x6+-parseInt(_0xdb960b(0x126))/0x7*(-parseInt(_0xdb960b(0x152))/0x8)+parseInt(_0xdb960b(0x148))/0x9*(parseInt(_0xdb960b(0x166))/0xa)+-parseInt(_0xdb960b(0x10c))/0xb;if(_0x5ed615===_0x1db9e5)break;else _0x37ab33['push'](_0x37ab33['shift']());}catch(_0xebe6c2){_0x37ab33['push'](_0x37ab33['shift']());}}}(a0_0x39dc,0xf23fd));import*as a0_0x47ce25 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x3ef7fa(0x131);function a0_0x39dc(){var _0x29b743=['refresh_token','code','save','addEventListener','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Wait\x20a\x20little\x20bit...','classList','send','Unable\x20to\x20refresh\x20token','Kabu\x20storage\x20↦\x20Cloud\x20◆','117063UENpSe','setRequestHeader','open','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','offline','onload','search','Error\x20while\x20refreshing\x20token:','.tag','application/x-www-form-urlencoded','6500552duZQfc','error_description','4abuJmq','error','https://api.dropboxapi.com/oauth2/token','alert','screenshot','listFiles','\x20files\x20in\x20Kabu?','name','Error\x20creating\x20folder\x20','downloadFileInCloud','exec','uId','&grant_type=','accessToken','click','Refreshing\x20token...','7869642reEahp','refresh_token=','180pcdrQq','application/octet-stream','getItem','https://content.dropboxapi.com/2/files/download','=([^&#]*)','authorization_code','refreshToken','Download\x20failed\x20for\x20','7284222ewGARf','split','entries','blob','&token_access_type=','3501qnbAOp','log','status','https://www.dropbox.com/oauth2/authorize?client_id=','4967205oFhKZV','state','access_token',',\x20status:\x20','location','No\x20files\x20found\x20to\x20restore.','replace','length','uploadFileInCloud','1741971VGscFA','active','setItem','Bearer\x20','filter','Folder\x20created','map','https://api.dropboxapi.com/2/files/create_folder_v2','14JNNjxy','Do\x20you\x20want\x20to\x20backup\x20','&response_type=','uid','No\x20refresh\x20token','file','\x20files\x20from\x20Cloud?','stringify','code=','1316UihNPd','application/json','nwb3dnfh09rhs31','POST','json','&redirect_uri=','Cloud\x20login\x20required!','href','&client_id=','https://content.dropboxapi.com/2/files/upload','https://api.dropbox.com/oauth2/token','Folder\x20already\x20exists','Download\x20failed,\x20unknown\x20http\x20status:','push','Restore\x20canceled\x20by\x20user.'];a0_0x39dc=function(){return _0x29b743;};return a0_0x39dc();}function a0_0x2090(_0x43ffc5,_0x39de14){var _0x39dc14=a0_0x39dc();return a0_0x2090=function(_0x209035,_0x6747c8){_0x209035=_0x209035-0x105;var _0x51e65c=_0x39dc14[_0x209035];return _0x51e65c;},a0_0x2090(_0x43ffc5,_0x39de14);}function authorizeWithDropbox(){var _0x21ab4c=a0_0x3ef7fa,_0x769e=window[_0x21ab4c(0x119)][_0x21ab4c(0x136)][_0x21ab4c(0x10d)]('?')[0x0],_0x3f519e=_0x21ab4c(0x13f),_0x301d7b=_0x21ab4c(0x14c),_0x3fd14e=_0x21ab4c(0x114)+clientId+_0x21ab4c(0x128)+_0x3f519e+_0x21ab4c(0x110)+_0x301d7b+_0x21ab4c(0x134)+encodeURIComponent(_0x769e);window[_0x21ab4c(0x119)][_0x21ab4c(0x136)]=_0x3fd14e;}function handleDropboxCallback(){var _0x44384b=a0_0x3ef7fa,_0x3ca464=getUrlParameter(_0x44384b(0x13f));_0x3ca464?(getAccessToken(_0x3ca464),console[_0x44384b(0x112)]('Authorization\x20Code:',_0x3ca464)):console[_0x44384b(0x112)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x1bfff2){var _0x517d4e=a0_0x3ef7fa;_0x1bfff2=_0x1bfff2['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x36b762=new RegExp('[\x5c?&#]'+_0x1bfff2+_0x517d4e(0x108)),_0x429504=_0x36b762[_0x517d4e(0x15e)](location[_0x517d4e(0x14e)]);return _0x429504===null?'':decodeURIComponent(_0x429504[0x1][_0x517d4e(0x11b)](/\+/g,'\x20'));}function getAccessToken(_0x37f6d4){var _0x40471c=a0_0x3ef7fa,_0x34c444=_0x40471c(0x109),_0x17a4f6=window[_0x40471c(0x119)][_0x40471c(0x136)][_0x40471c(0x10d)]('?')[0x0],_0x252170=new XMLHttpRequest();_0x252170[_0x40471c(0x14a)](_0x40471c(0x132),_0x40471c(0x139)),_0x252170[_0x40471c(0x149)]('Content-Type',_0x40471c(0x151)),_0x252170[_0x40471c(0x14d)]=function(){var _0x4647e0=_0x40471c;if(_0x252170[_0x4647e0(0x113)]===0xc8){var _0x770a19=JSON['parse'](_0x252170['responseText']),_0x354d8e=_0x770a19[_0x4647e0(0x117)],_0x108744=_0x770a19[_0x4647e0(0x13e)],_0x514fc3=_0x770a19[_0x4647e0(0x129)];localStorage['setItem'](_0x4647e0(0x161),_0x354d8e),localStorage[_0x4647e0(0x120)](_0x4647e0(0x10a),_0x108744),localStorage[_0x4647e0(0x120)](_0x4647e0(0x15f),_0x514fc3);}else console[_0x4647e0(0x112)](_0x4647e0(0x14b));},_0x252170[_0x40471c(0x145)](_0x40471c(0x12e)+_0x37f6d4+_0x40471c(0x160)+_0x34c444+_0x40471c(0x137)+clientId+'&client_secret='+clientSecret+_0x40471c(0x134)+encodeURIComponent(_0x17a4f6));}export async function dpCreateFolder(_0x35b842){var _0x257e97=a0_0x3ef7fa;const _0x589ef6=localStorage[_0x257e97(0x106)](_0x257e97(0x15f));let _0x34b31c=localStorage[_0x257e97(0x106)](_0x257e97(0x161));const _0x5d61ea='/'+_0x589ef6+'/'+_0x35b842,_0x340225=JSON['stringify']({'path':_0x5d61ea,'autorename':![]});for(let _0x2360ff=0x0;_0x2360ff<0x2;_0x2360ff++){try{const _0xa82e8d=await fetch(_0x257e97(0x125),{'method':'POST','headers':{'Authorization':_0x257e97(0x121)+_0x34b31c,'Content-Type':_0x257e97(0x130)},'body':_0x340225});if(_0xa82e8d[_0x257e97(0x113)]===0x191){const _0x2eb13a=await dpRefreshToken();if(!_0x2eb13a)throw new Error(_0x257e97(0x146));_0x34b31c=localStorage[_0x257e97(0x106)]('accessToken');continue;}if(_0xa82e8d[_0x257e97(0x113)]===0x199)return{'message':_0x257e97(0x13a),'path':_0x35b842};if(!_0xa82e8d['ok'])throw new Error(_0x257e97(0x15c)+_0x35b842);const _0x5d8b4c=await _0xa82e8d[_0x257e97(0x133)]();return await lockNoti(_0x257e97(0x123),'',0xbb8),_0x5d8b4c;}catch(_0x120b31){if(_0x2360ff===0x1)throw _0x120b31;}}return![];}export async function dpRefreshToken(){var _0x2c4b52=a0_0x3ef7fa;if(!localStorage['getItem'](_0x2c4b52(0x10a)))throw _0x2c4b52(0x12a);try{const _0x13c47e=await fetch(_0x2c4b52(0x156),{'method':'POST','headers':{'Content-Type':_0x2c4b52(0x151)},'body':_0x2c4b52(0x165)+localStorage['getItem'](_0x2c4b52(0x10a))+_0x2c4b52(0x142)}),_0x784b9a=await _0x13c47e[_0x2c4b52(0x133)]();if(!_0x784b9a[_0x2c4b52(0x155)])return localStorage[_0x2c4b52(0x120)]('accessToken',_0x784b9a[_0x2c4b52(0x117)]),await lockNoti(_0x2c4b52(0x163),'',0xbb8),await delay(0x3e8),!![];else alert(_0x784b9a[_0x2c4b52(0x153)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x5c7f31){console['error'](_0x2c4b52(0x14f),_0x5c7f31);}return![];}export async function dpUploadFile(_0x24b66f,_0x12248c,_0x5a78f8){var _0x37b782=a0_0x3ef7fa;const _0x4dee51=localStorage[_0x37b782(0x106)](_0x37b782(0x15f));var _0x52d0de=JSON[_0x37b782(0x12d)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x4dee51+'/'+_0x5a78f8+'/'+_0x24b66f}),_0x1b72b0=new Blob([_0x12248c],{'type':'application/octet-stream'});for(var _0x406445=0x0;_0x406445<0x2;_0x406445++){var _0x55fa33=await fetch(_0x37b782(0x138),{'method':'POST','headers':{'Authorization':_0x37b782(0x121)+localStorage['getItem'](_0x37b782(0x161)),'Dropbox-API-Arg':_0x52d0de,'Content-Type':_0x37b782(0x105)},'body':_0x1b72b0});if(_0x55fa33[_0x37b782(0x113)]!=0xc8){if(_0x55fa33[_0x37b782(0x113)]==0x191){var _0x1f5ee6=await dpRefreshToken();if(!_0x1f5ee6)throw _0x37b782(0x146);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x55fa33[_0x37b782(0x113)];}else{var _0x5b6f18=await _0x55fa33['json']();return console[_0x37b782(0x112)](_0x37b782(0x147),_0x24b66f),_0x5b6f18;}}return![];}export async function dpDownloadFile(_0x2c446b,_0x1e3165){var _0x2ff051=a0_0x3ef7fa;const _0x36c7be=localStorage[_0x2ff051(0x106)]('uId');var _0x5e1140=JSON[_0x2ff051(0x12d)]({'path':'/'+_0x36c7be+'/'+_0x1e3165+'/'+_0x2c446b});for(var _0x75c585=0x0;_0x75c585<0x2;_0x75c585++){var _0x359fdc=await fetch(_0x2ff051(0x107),{'method':_0x2ff051(0x132),'headers':{'Authorization':_0x2ff051(0x121)+localStorage[_0x2ff051(0x106)](_0x2ff051(0x161)),'Dropbox-API-Arg':_0x5e1140}});if(_0x359fdc[_0x2ff051(0x113)]!=0xc8){if(_0x359fdc[_0x2ff051(0x113)]==0x191){var _0x37a62a=await dpRefreshToken();if(!_0x37a62a)throw _0x2ff051(0x146);continue;}else throw _0x2ff051(0x13b)+_0x359fdc[_0x2ff051(0x113)];}const _0x4a645f=new File([await _0x359fdc[_0x2ff051(0x10f)]()],_0x2c446b);return console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x4a645f[_0x2ff051(0x15b)]),a0_0x47ce25[_0x2ff051(0x11d)](_0x4a645f,()=>{}),_0x4a645f;}return![];}document[a0_0x3ef7fa(0x141)]('DOMContentLoaded',function(){var _0x53b2a6=a0_0x3ef7fa;dropboxRestore['addEventListener'](_0x53b2a6(0x162),async function(){var _0x5d870a=_0x53b2a6;await lockNoti(_0x5d870a(0x143),'',0x1388);const _0x429676=localStorage[_0x5d870a(0x106)]('uId'),_0x463456=[_0x5d870a(0x116),_0x5d870a(0x140),_0x5d870a(0x158)];if(!_0x429676){window['alert']('Cloud\x20login\x20required!');return;}let _0x5ce77a=[];for(const _0xb5108e of _0x463456){let _0x21828f={'path':'/'+_0x429676+'/'+_0xb5108e};for(let _0x59163e=0x0;_0x59163e<0x2;_0x59163e++){let _0xe5ef4b=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x5d870a(0x132),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x5d870a(0x106)](_0x5d870a(0x161)),'Content-Type':_0x5d870a(0x130)},'body':JSON[_0x5d870a(0x12d)](_0x21828f)});if(_0xe5ef4b[_0x5d870a(0x113)]===0xc8){let _0x2ee93=await _0xe5ef4b['json'](),_0x206179=_0x2ee93[_0x5d870a(0x10e)][_0x5d870a(0x122)](_0x483354=>_0x483354[_0x5d870a(0x150)]===_0x5d870a(0x12b));_0x206179[_0x5d870a(0x11c)]>0x0&&_0x5ce77a[_0x5d870a(0x13c)](..._0x206179[_0x5d870a(0x124)](_0x405443=>({'name':_0x405443[_0x5d870a(0x15b)],'folder':_0xb5108e})));break;}else{if(_0xe5ef4b[_0x5d870a(0x113)]===0x191){let _0x40f061=await dpRefreshToken();if(!_0x40f061)throw _0x5d870a(0x146);}else{console[_0x5d870a(0x155)](_0x5d870a(0x10b)+_0xb5108e+_0x5d870a(0x118)+_0xe5ef4b[_0x5d870a(0x113)]);break;}}}}if(_0x5ce77a['length']>0x0){const _0x367cfa='Do\x20you\x20want\x20to\x20restore\x20'+_0x5ce77a[_0x5d870a(0x11c)]+_0x5d870a(0x12c);if(window['confirm'](_0x367cfa))for(const _0x1c1045 of _0x5ce77a){await lockNoti('Restoring...',_0x1c1045[_0x5d870a(0x15b)],0xbb8),await dpDownloadFile(_0x1c1045['name'],_0x1c1045['folder']);}else console['log'](_0x5d870a(0x13d));}else console['log'](_0x5d870a(0x11a));}),dropboxBackup['addEventListener'](_0x53b2a6(0x162),async function(){var _0x21b066=_0x53b2a6;await lockNoti(_0x21b066(0x143),'',0x1388);const _0x3380bd=localStorage['getItem'](_0x21b066(0x15f));if(_0x3380bd===null||_0x3380bd==='')window[_0x21b066(0x157)](_0x21b066(0x135));else{const _0x2dab1a=[_0x21b066(0x116),_0x21b066(0x140),_0x21b066(0x158)];for(const _0x5cf46b of _0x2dab1a){await dpCreateFolder(_0x5cf46b);}let _0x56cb46=0x0;for(const _0x4af04a of _0x2dab1a){const _0xe1b605=a0_0x47ce25[_0x21b066(0x159)](_0x4af04a+'s');_0x56cb46+=_0xe1b605[_0x21b066(0x11c)];}if(window['confirm'](_0x21b066(0x127)+_0x56cb46+_0x21b066(0x15a)))for(const _0x5387b6 of _0x2dab1a){const _0x7b7abd=a0_0x47ce25[_0x21b066(0x159)](_0x5387b6+'s');for(const _0x92a727 of _0x7b7abd){const _0x279bd8=await a0_0x47ce25[_0x21b066(0x15d)]('/data/'+_0x5387b6+'s/'+_0x92a727);try{await lockNoti('Backing\x20up...',_0x92a727,0xbb8),await dpUploadFile(_0x92a727,_0x279bd8,_0x5387b6);}catch(_0x164fde){console[_0x21b066(0x155)]('Failed\x20to\x20upload\x20file\x20'+_0x92a727+':',_0x164fde);}}}else console['log'](_0x21b066(0x13d));}}),dropboxCloud[_0x53b2a6(0x141)](_0x53b2a6(0x162),function(){var _0x1e79d1=_0x53b2a6;const _0x47d83a=localStorage['getItem'](_0x1e79d1(0x15f));_0x47d83a===null||_0x47d83a===''?authorizeWithDropbox():window['confirm']('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x1e79d1(0x120)](_0x1e79d1(0x15f),''),dropboxRestore[_0x1e79d1(0x144)]['remove']('active'),dropboxBackup[_0x1e79d1(0x144)]['remove'](_0x1e79d1(0x11f)),dropboxCloud[_0x1e79d1(0x144)]['remove']('active'));}),handleDropboxCallback();});