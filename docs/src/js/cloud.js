var a0_0x416861=a0_0x3114;(function(_0x4b75aa,_0x4fd1ff){var _0x31232f=a0_0x3114,_0x5bf746=_0x4b75aa();while(!![]){try{var _0x9a0c01=parseInt(_0x31232f(0x20b))/0x1*(-parseInt(_0x31232f(0x1e7))/0x2)+parseInt(_0x31232f(0x1ed))/0x3*(parseInt(_0x31232f(0x221))/0x4)+-parseInt(_0x31232f(0x22f))/0x5*(parseInt(_0x31232f(0x1d8))/0x6)+parseInt(_0x31232f(0x1e0))/0x7+-parseInt(_0x31232f(0x1d6))/0x8+parseInt(_0x31232f(0x1f8))/0x9*(-parseInt(_0x31232f(0x200))/0xa)+parseInt(_0x31232f(0x219))/0xb*(parseInt(_0x31232f(0x22a))/0xc);if(_0x9a0c01===_0x4fd1ff)break;else _0x5bf746['push'](_0x5bf746['shift']());}catch(_0x16e785){_0x5bf746['push'](_0x5bf746['shift']());}}}(a0_0x1fc1,0xb740e));import*as a0_0xf1d4ac from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x416861(0x209),clientSecret=a0_0x416861(0x215);function authorizeWithDropbox(){var _0xcf039b=a0_0x416861,_0x5103f6=window['location'][_0xcf039b(0x1df)][_0xcf039b(0x22b)]('?')[0x0],_0x3b575e=_0xcf039b(0x20e),_0x13222e=_0xcf039b(0x1f0),_0x3fe4cb=_0xcf039b(0x211)+clientId+_0xcf039b(0x1ef)+_0x3b575e+_0xcf039b(0x1d4)+_0x13222e+_0xcf039b(0x21f)+encodeURIComponent(_0x5103f6);window[_0xcf039b(0x220)]['href']=_0x3fe4cb;}function a0_0x3114(_0x52b6da,_0x66a6ae){var _0x1fc1c6=a0_0x1fc1();return a0_0x3114=function(_0x311443,_0x1d91dc){_0x311443=_0x311443-0x1cd;var _0x3e8c0e=_0x1fc1c6[_0x311443];return _0x3e8c0e;},a0_0x3114(_0x52b6da,_0x66a6ae);}function handleDropboxCallback(){var _0x53ca43=a0_0x416861,_0x6486b0=getUrlParameter(_0x53ca43(0x20e));_0x6486b0?(getAccessToken(_0x6486b0),console[_0x53ca43(0x1e6)](_0x53ca43(0x1fc),_0x6486b0)):console['log'](_0x53ca43(0x213));}function getUrlParameter(_0x37c5dd){var _0x2560a9=a0_0x416861;_0x37c5dd=_0x37c5dd[_0x2560a9(0x225)](/[\[]/,'\x5c[')[_0x2560a9(0x225)](/[\]]/,'\x5c]');var _0x422eed=new RegExp(_0x2560a9(0x207)+_0x37c5dd+_0x2560a9(0x208)),_0xcfa24=_0x422eed[_0x2560a9(0x205)](location[_0x2560a9(0x1d3)]);return _0xcfa24===null?'':decodeURIComponent(_0xcfa24[0x1][_0x2560a9(0x225)](/\+/g,'\x20'));}function getAccessToken(_0x5144c0){var _0x168a86=a0_0x416861,_0x3888d7=_0x168a86(0x1f2),_0x1fd70d=window[_0x168a86(0x220)][_0x168a86(0x1df)][_0x168a86(0x22b)]('?')[0x0],_0x151e0d=new XMLHttpRequest();_0x151e0d['open'](_0x168a86(0x1f1),_0x168a86(0x1ce)),_0x151e0d['setRequestHeader'](_0x168a86(0x201),'application/x-www-form-urlencoded'),_0x151e0d[_0x168a86(0x1d7)]=function(){var _0x48ae0a=_0x168a86;if(_0x151e0d[_0x48ae0a(0x228)]===0xc8){var _0x28f380=JSON['parse'](_0x151e0d[_0x48ae0a(0x1db)]),_0x38ff2c=_0x28f380[_0x48ae0a(0x224)],_0x5c98f4=_0x28f380['refresh_token'],_0x4a7a43=_0x28f380[_0x48ae0a(0x21e)];localStorage[_0x48ae0a(0x22d)](_0x48ae0a(0x1e5),_0x38ff2c),localStorage[_0x48ae0a(0x22d)]('refreshToken',_0x5c98f4),localStorage[_0x48ae0a(0x22d)](_0x48ae0a(0x1d2),_0x4a7a43);}else console[_0x48ae0a(0x1e6)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x151e0d['send']('code='+_0x5144c0+_0x168a86(0x20a)+_0x3888d7+_0x168a86(0x1f4)+clientId+'&client_secret='+clientSecret+_0x168a86(0x21f)+encodeURIComponent(_0x1fd70d));}export async function dpCreateFolder(_0x23ae85){var _0x37a1d7=a0_0x416861;const _0x2514d5=localStorage[_0x37a1d7(0x204)](_0x37a1d7(0x1d2));let _0x1d6042=localStorage['getItem'](_0x37a1d7(0x1e5));const _0x160efa='/'+_0x2514d5+'/'+_0x23ae85,_0x367604=JSON[_0x37a1d7(0x218)]({'path':_0x160efa,'autorename':![]});for(let _0x2fe7cd=0x0;_0x2fe7cd<0x2;_0x2fe7cd++){try{const _0x5664cd=await fetch(_0x37a1d7(0x21a),{'method':_0x37a1d7(0x1f1),'headers':{'Authorization':'Bearer\x20'+_0x1d6042,'Content-Type':_0x37a1d7(0x217)},'body':_0x367604});if(_0x5664cd['status']===0x191){const _0x31943b=await dpRefreshToken();if(!_0x31943b)throw new Error(_0x37a1d7(0x1fa));_0x1d6042=localStorage['getItem']('accessToken');continue;}if(_0x5664cd[_0x37a1d7(0x228)]===0x199)return{'message':_0x37a1d7(0x1e2),'path':_0x23ae85};if(!_0x5664cd['ok'])throw new Error(_0x37a1d7(0x234)+_0x23ae85);const _0x5efba7=await _0x5664cd[_0x37a1d7(0x1cd)]();return await lockNoti(_0x37a1d7(0x1cf),'',0xbb8),_0x5efba7;}catch(_0x20c51d){if(_0x2fe7cd===0x1)throw _0x20c51d;}}return![];}export async function dpRefreshToken(){var _0x5ea9e0=a0_0x416861;if(!localStorage[_0x5ea9e0(0x204)](_0x5ea9e0(0x1f9)))throw _0x5ea9e0(0x21d);try{const _0x5489e4=await fetch(_0x5ea9e0(0x1e3),{'method':_0x5ea9e0(0x1f1),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x5ea9e0(0x204)](_0x5ea9e0(0x1f9))+_0x5ea9e0(0x1de)}),_0x3d6b6d=await _0x5489e4['json']();if(!_0x3d6b6d['error'])return localStorage[_0x5ea9e0(0x22d)](_0x5ea9e0(0x1e5),_0x3d6b6d['access_token']),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x3d6b6d[_0x5ea9e0(0x202)]||_0x5ea9e0(0x20f));}catch(_0x402a0b){console[_0x5ea9e0(0x203)](_0x5ea9e0(0x227),_0x402a0b);}return![];}export async function dpUploadFile(_0x959fa,_0x5d4e21,_0x37e068){var _0x29ffc4=a0_0x416861;const _0x4d78ad=localStorage[_0x29ffc4(0x204)](_0x29ffc4(0x1d2));var _0x3c69f7=JSON['stringify']({'autorename':!![],'mode':_0x29ffc4(0x22e),'mute':!![],'strict_conflict':![],'path':'/'+_0x4d78ad+'/'+_0x37e068+'/'+_0x959fa}),_0x182ceb=new Blob([_0x5d4e21],{'type':'application/octet-stream'});for(var _0x3838ec=0x0;_0x3838ec<0x2;_0x3838ec++){var _0x5e21ec=await fetch(_0x29ffc4(0x214),{'method':_0x29ffc4(0x1f1),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x29ffc4(0x204)](_0x29ffc4(0x1e5)),'Dropbox-API-Arg':_0x3c69f7,'Content-Type':_0x29ffc4(0x1d5)},'body':_0x182ceb});if(_0x5e21ec[_0x29ffc4(0x228)]!=0xc8){if(_0x5e21ec[_0x29ffc4(0x228)]==0x191){var _0x12a097=await dpRefreshToken();if(!_0x12a097)throw _0x29ffc4(0x1fa);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x5e21ec[_0x29ffc4(0x228)];}else{var _0x257186=await _0x5e21ec['json']();return console[_0x29ffc4(0x1e6)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x959fa),_0x257186;}}return![];}export async function dpDownloadFile(_0x13ff09,_0x256fc5){var _0x2ee91a=a0_0x416861;const _0x409262=localStorage[_0x2ee91a(0x204)](_0x2ee91a(0x1d2));var _0x9ef01c=JSON['stringify']({'path':'/'+_0x409262+'/'+_0x256fc5+'/'+_0x13ff09});for(var _0xd7ac1f=0x0;_0xd7ac1f<0x2;_0xd7ac1f++){var _0x389327=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x2ee91a(0x1f1),'headers':{'Authorization':_0x2ee91a(0x1f6)+localStorage[_0x2ee91a(0x204)]('accessToken'),'Dropbox-API-Arg':_0x9ef01c}});if(_0x389327[_0x2ee91a(0x228)]!=0xc8){if(_0x389327['status']==0x191){var _0x3e7359=await dpRefreshToken();if(!_0x3e7359)throw _0x2ee91a(0x1fa);continue;}else throw _0x2ee91a(0x231)+_0x389327['status'];}const _0x37e464=new File([await _0x389327[_0x2ee91a(0x1eb)]()],_0x13ff09);return console[_0x2ee91a(0x1e6)](_0x2ee91a(0x22c),_0x37e464[_0x2ee91a(0x1dd)]),a0_0xf1d4ac['uploadFileInCloud'](_0x37e464,()=>{}),_0x37e464;}return![];}function a0_0x1fc1(){var _0x18d841=['length','Error\x20creating\x20folder\x20','json','https://api.dropbox.com/oauth2/token','Folder\x20created','downloadFileInCloud','active','uId','search','&token_access_type=','application/octet-stream','6142848irbIsK','onload','4114752AUPRec','save','remove','responseText','file','name','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','href','6698755YGmHKy','click','Folder\x20already\x20exists','https://api.dropboxapi.com/oauth2/token','addEventListener','accessToken','log','27172UYNHRz','/data/','filter','Failed\x20to\x20upload\x20file\x20','blob','classList','2535iZhJqL','confirm','&response_type=','offline','POST','authorization_code','entries','&client_id=','\x20files\x20in\x20Kabu?','Bearer\x20','Wait\x20a\x20little\x20bit...','36342WABiSS','refreshToken','Unable\x20to\x20refresh\x20token','Restoring...','Authorization\x20Code:',',\x20status:\x20','Do\x20you\x20want\x20to\x20backup\x20','Backing\x20up...','1520nwsIyx','Content-Type','error_description','error','getItem','exec','listFiles','[\x5c?&#]','=([^&#]*)','knh3uz2mx2hp2eu','&grant_type=','107GpQrQL','state','Download\x20failed\x20for\x20','code','Failed\x20to\x20refresh\x20Dropbox\x20token.','https://api.dropboxapi.com/2/files/list_folder','https://www.dropbox.com/oauth2/authorize?client_id=','No\x20files\x20found\x20to\x20restore.','Do\x20not\x20receive\x20authorization','https://content.dropboxapi.com/2/files/upload','nwb3dnfh09rhs31','\x20files\x20from\x20Cloud?','application/json','stringify','418YcTaHC','https://api.dropboxapi.com/2/files/create_folder_v2','Do\x20you\x20want\x20to\x20logout?','screenshot','No\x20refresh\x20token','uid','&redirect_uri=','location','2700vJADhp','Do\x20you\x20want\x20to\x20restore\x20','Restore\x20canceled\x20by\x20user.','access_token','replace','DOMContentLoaded','Error\x20while\x20refreshing\x20token:','status','Cloud\x20login\x20required!','1083216pVQYMi','split','Cloud\x20↦\x20Kabu\x20storage\x20◆','setItem','overwrite','10fQEFtu','alert','Download\x20failed,\x20unknown\x20http\x20status:','map'];a0_0x1fc1=function(){return _0x18d841;};return a0_0x1fc1();}document['addEventListener'](a0_0x416861(0x226),function(){var _0x1a7e2=a0_0x416861;dropboxRestore['addEventListener'](_0x1a7e2(0x1e1),async function(){var _0x111e70=_0x1a7e2;await lockNoti(_0x111e70(0x1f7),'',0x1388);const _0x1c14a6=localStorage[_0x111e70(0x204)](_0x111e70(0x1d2)),_0x331a8c=[_0x111e70(0x20c),_0x111e70(0x1d9),_0x111e70(0x21c)];if(!_0x1c14a6){window['alert'](_0x111e70(0x229));return;}let _0x5ce158=[];for(const _0x5e2046 of _0x331a8c){let _0x54292d={'path':'/'+_0x1c14a6+'/'+_0x5e2046};for(let _0x373d6f=0x0;_0x373d6f<0x2;_0x373d6f++){let _0xbc6fdb=await fetch(_0x111e70(0x210),{'method':_0x111e70(0x1f1),'headers':{'Authorization':_0x111e70(0x1f6)+localStorage[_0x111e70(0x204)](_0x111e70(0x1e5)),'Content-Type':_0x111e70(0x217)},'body':JSON[_0x111e70(0x218)](_0x54292d)});if(_0xbc6fdb['status']===0xc8){let _0x2a8e26=await _0xbc6fdb[_0x111e70(0x1cd)](),_0x42801e=_0x2a8e26[_0x111e70(0x1f3)][_0x111e70(0x1e9)](_0x1e0acf=>_0x1e0acf['.tag']===_0x111e70(0x1dc));_0x42801e[_0x111e70(0x233)]>0x0&&_0x5ce158['push'](..._0x42801e[_0x111e70(0x232)](_0x3303b7=>({'name':_0x3303b7['name'],'folder':_0x5e2046})));break;}else{if(_0xbc6fdb[_0x111e70(0x228)]===0x191){let _0x2fa103=await dpRefreshToken();if(!_0x2fa103)throw _0x111e70(0x1fa);}else{console[_0x111e70(0x203)](_0x111e70(0x20d)+_0x5e2046+_0x111e70(0x1fd)+_0xbc6fdb['status']);break;}}}}if(_0x5ce158[_0x111e70(0x233)]>0x0){const _0x1c1b66=_0x111e70(0x222)+_0x5ce158[_0x111e70(0x233)]+_0x111e70(0x216);if(window[_0x111e70(0x1ee)](_0x1c1b66))for(const _0x329b4a of _0x5ce158){await lockNoti(_0x111e70(0x1fb),_0x329b4a['name'],0xbb8),await dpDownloadFile(_0x329b4a[_0x111e70(0x1dd)],_0x329b4a['folder']);}else console[_0x111e70(0x1e6)](_0x111e70(0x223));}else console[_0x111e70(0x1e6)](_0x111e70(0x212));}),dropboxBackup[_0x1a7e2(0x1e4)](_0x1a7e2(0x1e1),async function(){var _0x2ff32b=_0x1a7e2;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x39f12a=localStorage['getItem']('uId');if(_0x39f12a===null||_0x39f12a==='')window[_0x2ff32b(0x230)](_0x2ff32b(0x229));else{const _0x545612=['state',_0x2ff32b(0x1d9),_0x2ff32b(0x21c)];for(const _0x4311ed of _0x545612){await dpCreateFolder(_0x4311ed);}let _0x4300d0=0x0;for(const _0x453ba4 of _0x545612){const _0x5d8294=a0_0xf1d4ac['listFiles'](_0x453ba4+'s');_0x4300d0+=_0x5d8294[_0x2ff32b(0x233)];}if(window['confirm'](_0x2ff32b(0x1fe)+_0x4300d0+_0x2ff32b(0x1f5)))for(const _0x22f3fc of _0x545612){const _0x6bb6b5=a0_0xf1d4ac[_0x2ff32b(0x206)](_0x22f3fc+'s');for(const _0x1ac539 of _0x6bb6b5){const _0x4bf2a7=await a0_0xf1d4ac[_0x2ff32b(0x1d0)](_0x2ff32b(0x1e8)+_0x22f3fc+'s/'+_0x1ac539);try{await lockNoti(_0x2ff32b(0x1ff),_0x1ac539,0xbb8),await dpUploadFile(_0x1ac539,_0x4bf2a7,_0x22f3fc);}catch(_0x2ffc2f){console[_0x2ff32b(0x203)](_0x2ff32b(0x1ea)+_0x1ac539+':',_0x2ffc2f);}}}else console[_0x2ff32b(0x1e6)](_0x2ff32b(0x223));}}),dropboxCloud[_0x1a7e2(0x1e4)](_0x1a7e2(0x1e1),function(){var _0x1ec729=_0x1a7e2;const _0x3726bb=localStorage[_0x1ec729(0x204)](_0x1ec729(0x1d2));_0x3726bb===null||_0x3726bb===''?authorizeWithDropbox():window['confirm'](_0x1ec729(0x21b))&&(localStorage[_0x1ec729(0x22d)]('uId',''),dropboxRestore[_0x1ec729(0x1ec)]['remove'](_0x1ec729(0x1d1)),dropboxBackup['classList']['remove'](_0x1ec729(0x1d1)),dropboxCloud[_0x1ec729(0x1ec)][_0x1ec729(0x1da)](_0x1ec729(0x1d1)));}),handleDropboxCallback();});