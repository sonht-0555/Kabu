var a0_0x4a4589=a0_0x83e4;(function(_0x58bb90,_0x8026c0){var _0xf239df=a0_0x83e4,_0x22a7b8=_0x58bb90();while(!![]){try{var _0x404c03=-parseInt(_0xf239df(0x1b6))/0x1+-parseInt(_0xf239df(0x19d))/0x2+-parseInt(_0xf239df(0x1cf))/0x3*(-parseInt(_0xf239df(0x1b3))/0x4)+parseInt(_0xf239df(0x1a7))/0x5+parseInt(_0xf239df(0x1cc))/0x6+-parseInt(_0xf239df(0x1fa))/0x7+-parseInt(_0xf239df(0x1ae))/0x8;if(_0x404c03===_0x8026c0)break;else _0x22a7b8['push'](_0x22a7b8['shift']());}catch(_0x3d06e1){_0x22a7b8['push'](_0x22a7b8['shift']());}}}(a0_0x2980,0xa3827));import*as a0_0xa3951f from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x4a4589(0x1cb),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x219096=a0_0x4a4589,_0x254173=window[_0x219096(0x1c5)][_0x219096(0x1a1)]['split']('?')[0x0],_0x1881b6=_0x219096(0x1d9),_0x3c63aa=_0x219096(0x1cd),_0x4ea691=_0x219096(0x194)+clientId+'&response_type='+_0x1881b6+_0x219096(0x1e4)+_0x3c63aa+_0x219096(0x1c2)+encodeURIComponent(_0x254173);window[_0x219096(0x1c5)][_0x219096(0x1a1)]=_0x4ea691;}function handleDropboxCallback(){var _0x34e645=a0_0x4a4589,_0x3c66c9=getUrlParameter(_0x34e645(0x1d9));_0x3c66c9?(getAccessToken(_0x3c66c9),console[_0x34e645(0x1e7)](_0x34e645(0x196),_0x3c66c9)):console[_0x34e645(0x1e7)](_0x34e645(0x1a5));}function getUrlParameter(_0x354fc4){var _0x2f0ca1=a0_0x4a4589;_0x354fc4=_0x354fc4['replace'](/[\[]/,'\x5c[')[_0x2f0ca1(0x1df)](/[\]]/,'\x5c]');var _0x10255a=new RegExp(_0x2f0ca1(0x1bc)+_0x354fc4+_0x2f0ca1(0x1dd)),_0x2ca2f9=_0x10255a[_0x2f0ca1(0x1eb)](location[_0x2f0ca1(0x1d2)]);return _0x2ca2f9===null?'':decodeURIComponent(_0x2ca2f9[0x1][_0x2f0ca1(0x1df)](/\+/g,'\x20'));}function a0_0x2980(){var _0x522954=['substring','code','addEventListener','send','refresh_token=','=([^&#]*)','uId','replace','status:\x20','.txt','error_description','status','&token_access_type=','alert','file','log','entries','Do\x20you\x20want\x20to\x20logout?','open','exec','Unable\x20to\x20refresh\x20token','accessToken','Cloud\x20↦\x20Kabu\x20storage\x20◆','onload','&client_id=','name','lastIndexOf','endsWith','/data/','error','toUpperCase','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','DOMContentLoaded','Do\x20you\x20want\x20to\x20restore\x20','9320283yflOWK','classList','FSSync','application/json','stringify','&grant_type=','.ss0','https://www.dropbox.com/oauth2/authorize?client_id=','setItem','Authorization\x20Code:','list','confirm','Backing\x20up...','\x20files\x20in\x20Cloud?','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','.gba_slot','499782IKzvFg','application/octet-stream','Upload\x20failed,\x20unknown\x20http\x20status:\x20','split','href','Error\x20while\x20refreshing\x20token:','.ss3','text/plain','Do\x20not\x20receive\x20authorization','.gba_imageState','2683560PvbpZO','.tag','Restore\x20canceled\x20by\x20user.','slice','Failed\x20to\x20upload\x20file\x20','Bearer\x20','uid','1888816OtOJDm','Restoring...','refreshToken','active','Content-Type','4160XHWmQW','_imageState','Failed\x20to\x20refresh\x20Dropbox\x20token.','166067nrEcOT','blob','getItem','.ss1','remove','length','[\x5c?&#]','No\x20refresh\x20token','setRequestHeader','access_token','POST','Refreshing\x20token...','&redirect_uri=','\x20files\x20in\x20Kabu?','.ss4','location','https://content.dropboxapi.com/2/files/upload','filter','.ss6','Cloud\x20login\x20required!','uploadSaveOrSaveState','knh3uz2mx2hp2eu','6571632Nneilu','offline','json','2946bZOUKS','charAt','click','search','_dateState','.ss7','application/x-www-form-urlencoded','https://api.dropboxapi.com/oauth2/token','overwrite'];a0_0x2980=function(){return _0x522954;};return a0_0x2980();}function getAccessToken(_0x5072f4){var _0x39443b=a0_0x4a4589,_0x305b04='authorization_code',_0x19778e=window[_0x39443b(0x1c5)][_0x39443b(0x1a1)][_0x39443b(0x1a0)]('?')[0x0],_0x399991=new XMLHttpRequest();_0x399991[_0x39443b(0x1ea)](_0x39443b(0x1c0),'https://api.dropbox.com/oauth2/token'),_0x399991[_0x39443b(0x1be)](_0x39443b(0x1b2),_0x39443b(0x1d5)),_0x399991[_0x39443b(0x1ef)]=function(){var _0x422f64=_0x39443b;if(_0x399991['status']===0xc8){var _0x1264f1=JSON['parse'](_0x399991['responseText']),_0x486164=_0x1264f1['access_token'],_0x2cf0f8=_0x1264f1['refresh_token'],_0x494311=_0x1264f1[_0x422f64(0x1ad)];localStorage['setItem'](_0x422f64(0x1ed),_0x486164),localStorage[_0x422f64(0x195)](_0x422f64(0x1b0),_0x2cf0f8),localStorage[_0x422f64(0x195)](_0x422f64(0x1de),_0x494311);}else console['log'](_0x422f64(0x1f7));},_0x399991[_0x39443b(0x1db)]('code='+_0x5072f4+_0x39443b(0x192)+_0x305b04+_0x39443b(0x1f0)+clientId+'&client_secret='+clientSecret+_0x39443b(0x1c2)+encodeURIComponent(_0x19778e));}export async function dpRefreshToken(){var _0x232553=a0_0x4a4589;if(!localStorage[_0x232553(0x1b8)](_0x232553(0x1b0)))throw _0x232553(0x1bd);try{const _0x3ebef4=await fetch(_0x232553(0x1d6),{'method':'POST','headers':{'Content-Type':_0x232553(0x1d5)},'body':_0x232553(0x1dc)+localStorage[_0x232553(0x1b8)](_0x232553(0x1b0))+_0x232553(0x19b)}),_0x29331d=await _0x3ebef4['json']();if(!_0x29331d[_0x232553(0x1f5)])return localStorage[_0x232553(0x195)](_0x232553(0x1ed),_0x29331d[_0x232553(0x1bf)]),await lockNoti('',_0x232553(0x1c1),0xbb8),await delay(0x3e8),!![];else alert(_0x29331d[_0x232553(0x1e2)]||_0x232553(0x1b5));}catch(_0x33cbe5){console[_0x232553(0x1f5)](_0x232553(0x1a2),_0x33cbe5);}return![];}function a0_0x83e4(_0x4c63dd,_0x33cbdc){var _0x29801f=a0_0x2980();return a0_0x83e4=function(_0x83e471,_0x1908e5){_0x83e471=_0x83e471-0x190;var _0x22064f=_0x29801f[_0x83e471];return _0x22064f;},a0_0x83e4(_0x4c63dd,_0x33cbdc);}export async function dpUploadFile(_0x4ab02d,_0x2a8eb0){var _0x284331=a0_0x4a4589;const _0x4fa577=localStorage[_0x284331(0x1b8)](_0x284331(0x1de));var _0x482001=JSON[_0x284331(0x191)]({'autorename':!![],'mode':_0x284331(0x1d7),'mute':!![],'strict_conflict':![],'path':'/'+_0x4fa577+'/'+_0x4ab02d}),_0x2a6f22=new Blob([_0x2a8eb0],{'type':_0x284331(0x19e)});for(var _0x55425d=0x0;_0x55425d<0x2;_0x55425d++){var _0x27268f=await fetch(_0x284331(0x1c6),{'method':_0x284331(0x1c0),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem']('accessToken'),'Dropbox-API-Arg':_0x482001,'Content-Type':'application/octet-stream'},'body':_0x2a6f22});if(_0x27268f[_0x284331(0x1e3)]!=0xc8){if(_0x27268f[_0x284331(0x1e3)]==0x191){var _0x5890d7=await dpRefreshToken();if(!_0x5890d7)throw _0x284331(0x1ec);continue;}else throw _0x284331(0x19f)+_0x27268f[_0x284331(0x1e3)];}else{var _0x177140=await _0x27268f[_0x284331(0x1ce)]();return console[_0x284331(0x1e7)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x4ab02d),_0x177140;}}return![];}async function dpDownloadFile(_0x381eb1){var _0x4b1dc7=a0_0x4a4589;const _0xd93d4a=localStorage['getItem'](_0x4b1dc7(0x1de));var _0x2d4a8b=JSON[_0x4b1dc7(0x191)]({'path':'/'+_0xd93d4a+'/'+_0x381eb1});for(var _0x458631=0x0;_0x458631<0x2;_0x458631++){var _0x28ae1d=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x4b1dc7(0x1c0),'headers':{'Authorization':_0x4b1dc7(0x1ac)+localStorage[_0x4b1dc7(0x1b8)](_0x4b1dc7(0x1ed)),'Dropbox-API-Arg':_0x2d4a8b}});if(_0x28ae1d[_0x4b1dc7(0x1e3)]!=0xc8){if(_0x28ae1d[_0x4b1dc7(0x1e3)]==0x191){var _0x228a3a=await dpRefreshToken();if(!_0x228a3a)throw _0x4b1dc7(0x1ec);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x28ae1d[_0x4b1dc7(0x1e3)];}const _0x3042e0=new File([await _0x28ae1d[_0x4b1dc7(0x1b7)]()],_0x381eb1);console[_0x4b1dc7(0x1e7)](_0x4b1dc7(0x1ee),_0x3042e0[_0x4b1dc7(0x1f1)]);if(_0x381eb1[_0x4b1dc7(0x1f3)](_0x4b1dc7(0x1e1))){const _0x33ebcc=await _0x3042e0['text'](),[_0x2b9b0f,_0x5ed1df]=_0x33ebcc[_0x4b1dc7(0x1a0)]('\x0a\x0a'),_0xad5390=_0x381eb1[_0x4b1dc7(0x1d8)](0x0,_0x381eb1['lastIndexOf']('gba')+0x3),_0x675a72=_0x381eb1[_0x4b1dc7(0x1d0)](_0x381eb1[_0x4b1dc7(0x1bb)]-0x5);localStorage[_0x4b1dc7(0x195)](_0xad5390+_0x4b1dc7(0x1d3)+_0x675a72,_0x5ed1df),localStorage[_0x4b1dc7(0x195)](_0xad5390+_0x4b1dc7(0x1b4)+_0x675a72,_0x2b9b0f);}else a0_0xa3951f[_0x4b1dc7(0x1ca)](_0x3042e0,()=>{var _0x5ef1c1=_0x4b1dc7;localStorageFile(),Module[_0x5ef1c1(0x1fc)]();});return _0x3042e0;}return![];}document[a0_0x4a4589(0x1da)](a0_0x4a4589(0x1f8),function(){var _0x183903=a0_0x4a4589;dropboxRestore[_0x183903(0x1da)](_0x183903(0x1d1),async function(){var _0x1f4de0=_0x183903;const _0x4d0732=localStorage['getItem'](_0x1f4de0(0x1de));if(_0x4d0732===null||_0x4d0732==='')window['alert']('Cloud\x20login\x20required!');else{var _0x212359={'path':'/'+_0x4d0732};for(var _0x31f285=0x0;_0x31f285<0x2;_0x31f285++){var _0x300d36=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x1f4de0(0x1c0),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x1f4de0(0x1b8)](_0x1f4de0(0x1ed)),'Content-Type':_0x1f4de0(0x190)},'body':JSON['stringify'](_0x212359)});console[_0x1f4de0(0x1e7)](_0x1f4de0(0x1e0),_0x300d36[_0x1f4de0(0x1e3)]);if(_0x300d36[_0x1f4de0(0x1e3)]!=0xc8){if(_0x300d36[_0x1f4de0(0x1e3)]==0x191){var _0xe12105=await dpRefreshToken();if(!_0xe12105)throw _0x1f4de0(0x1ec);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:\x20'+_0x300d36[_0x1f4de0(0x1e3)];}else{const _0x5f0efa=await _0x300d36[_0x1f4de0(0x1ce)](),_0x4821f5=_0x5f0efa[_0x1f4de0(0x1e8)][_0x1f4de0(0x1c7)](_0x13a848=>_0x13a848[_0x1f4de0(0x1a8)]==='file')[_0x1f4de0(0x1bb)],_0x3000ab=_0x1f4de0(0x1f9)+_0x4821f5+_0x1f4de0(0x19a);if(window[_0x1f4de0(0x198)](_0x3000ab))for(const _0x49e1b0 of _0x5f0efa[_0x1f4de0(0x1e8)]){_0x49e1b0[_0x1f4de0(0x1a8)]===_0x1f4de0(0x1e6)&&(await lockNoti(_0x1f4de0(0x1af),_0x49e1b0[_0x1f4de0(0x1f1)],0xbb8),await dpDownloadFile(_0x49e1b0['name']));}else console[_0x1f4de0(0x1e7)]('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup[_0x183903(0x1da)](_0x183903(0x1d1),async function(){var _0x6fadb6=_0x183903;const _0x3b7d4d=localStorage['getItem'](_0x6fadb6(0x1de));if(_0x3b7d4d===null||_0x3b7d4d==='')window[_0x6fadb6(0x1e5)](_0x6fadb6(0x1c9));else{const _0x59e638=['state','save'];let _0x133693=0x0;for(const _0x365e87 of _0x59e638){const _0x424571=a0_0xa3951f[_0x6fadb6(0x197)+(_0x365e87[_0x6fadb6(0x1d0)](0x0)[_0x6fadb6(0x1f6)]()+_0x365e87[_0x6fadb6(0x1aa)](0x1))]();_0x133693+=_0x424571[_0x6fadb6(0x1bb)];}if(window[_0x6fadb6(0x198)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x133693+_0x6fadb6(0x1c3)))for(const _0x5ba833 of _0x59e638){const _0x3c166d=a0_0xa3951f[_0x6fadb6(0x197)+(_0x5ba833[_0x6fadb6(0x1d0)](0x0)[_0x6fadb6(0x1f6)]()+_0x5ba833[_0x6fadb6(0x1aa)](0x1))]();for(const _0x126d4e of _0x3c166d){const _0x4dc18b=await a0_0xa3951f['downloadFileInCloud'](_0x6fadb6(0x1f4)+_0x5ba833+'s/'+_0x126d4e);try{await lockNoti(_0x6fadb6(0x199),_0x126d4e,0xbb8),await dpUploadFile(_0x126d4e,_0x4dc18b);if(_0x126d4e[_0x6fadb6(0x1f3)](_0x6fadb6(0x193))||_0x126d4e[_0x6fadb6(0x1f3)](_0x6fadb6(0x1b9))||_0x126d4e[_0x6fadb6(0x1f3)]('.ss2')||_0x126d4e[_0x6fadb6(0x1f3)](_0x6fadb6(0x1a3))||_0x126d4e[_0x6fadb6(0x1f3)](_0x6fadb6(0x1c4))||_0x126d4e[_0x6fadb6(0x1f3)]('.ss5')||_0x126d4e['endsWith'](_0x6fadb6(0x1c8))||_0x126d4e[_0x6fadb6(0x1f3)](_0x6fadb6(0x1d4))){const _0x3584d8=_0x126d4e[_0x6fadb6(0x1d8)](0x0,_0x126d4e[_0x6fadb6(0x1f2)]('.')),_0x265f18=_0x126d4e[_0x6fadb6(0x1d0)](_0x126d4e['length']-0x1),_0x197343=localStorage['getItem'](_0x3584d8+_0x6fadb6(0x1a6)+_0x265f18),_0x38230e=localStorage[_0x6fadb6(0x1b8)](_0x3584d8+'.gba_dateState'+_0x265f18);if(_0x197343!==null){const _0x20af36=_0x197343+'\x0a\x0a'+_0x38230e,_0x4de3ed=new Blob([_0x20af36],{'type':_0x6fadb6(0x1a4)});await lockNoti(_0x6fadb6(0x199),_0x3584d8+_0x6fadb6(0x19c)+_0x265f18+_0x6fadb6(0x1e1),0xbb8),await dpUploadFile(_0x3584d8+'.gba_slot'+_0x265f18+_0x6fadb6(0x1e1),_0x4de3ed);}}}catch(_0x4a2b94){console[_0x6fadb6(0x1f5)](_0x6fadb6(0x1ab)+_0x126d4e+':',_0x4a2b94);}}}else console[_0x6fadb6(0x1e7)](_0x6fadb6(0x1a9));}}),dropboxCloud[_0x183903(0x1da)](_0x183903(0x1d1),function(){var _0x116b34=_0x183903;const _0x20dc42=localStorage['getItem'](_0x116b34(0x1de));_0x20dc42===null||_0x20dc42===''?authorizeWithDropbox():window[_0x116b34(0x198)](_0x116b34(0x1e9))&&(localStorage['setItem'](_0x116b34(0x1de),''),dropboxRestore[_0x116b34(0x1fb)][_0x116b34(0x1ba)](_0x116b34(0x1b1)),dropboxBackup[_0x116b34(0x1fb)]['remove']('active'),dropboxCloud['classList'][_0x116b34(0x1ba)](_0x116b34(0x1b1)));}),handleDropboxCallback();});