var a0_0x9b0ce=a0_0x2e67;(function(_0x17fb1f,_0x466c53){var _0x5d7ede=a0_0x2e67,_0x109fe6=_0x17fb1f();while(!![]){try{var _0x47ebe6=parseInt(_0x5d7ede(0x150))/0x1*(-parseInt(_0x5d7ede(0x170))/0x2)+-parseInt(_0x5d7ede(0x179))/0x3*(-parseInt(_0x5d7ede(0x143))/0x4)+parseInt(_0x5d7ede(0x17d))/0x5*(parseInt(_0x5d7ede(0x157))/0x6)+parseInt(_0x5d7ede(0x1a6))/0x7+-parseInt(_0x5d7ede(0x144))/0x8+-parseInt(_0x5d7ede(0x154))/0x9*(parseInt(_0x5d7ede(0x18b))/0xa)+-parseInt(_0x5d7ede(0x16d))/0xb*(parseInt(_0x5d7ede(0x16f))/0xc);if(_0x47ebe6===_0x466c53)break;else _0x109fe6['push'](_0x109fe6['shift']());}catch(_0x1c6e6b){_0x109fe6['push'](_0x109fe6['shift']());}}}(a0_0x5bf2,0xe99dd));import*as a0_0x2741ba from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x9b0ce(0x186);function authorizeWithDropbox(){var _0x4377fe=a0_0x9b0ce,_0x32d3ee=window[_0x4377fe(0x19b)][_0x4377fe(0x168)][_0x4377fe(0x159)]('?')[0x0],_0x4fa510=_0x4377fe(0x19a),_0x3ff471=_0x4377fe(0x164),_0x3da73d=_0x4377fe(0x18d)+clientId+_0x4377fe(0x14e)+_0x4fa510+'&token_access_type='+_0x3ff471+'&redirect_uri='+encodeURIComponent(_0x32d3ee);window['location']['href']=_0x3da73d;}function handleDropboxCallback(){var _0x2c01a3=a0_0x9b0ce,_0x541f8f=getUrlParameter('code');_0x541f8f?(getAccessToken(_0x541f8f),console['log'](_0x2c01a3(0x180),_0x541f8f)):console[_0x2c01a3(0x197)](_0x2c01a3(0x177));}function getUrlParameter(_0x68afb6){var _0x207092=a0_0x9b0ce;_0x68afb6=_0x68afb6[_0x207092(0x17a)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x14fca0=new RegExp(_0x207092(0x160)+_0x68afb6+'=([^&#]*)'),_0x294bfa=_0x14fca0['exec'](location[_0x207092(0x169)]);return _0x294bfa===null?'':decodeURIComponent(_0x294bfa[0x1][_0x207092(0x17a)](/\+/g,'\x20'));}function a0_0x2e67(_0x211e10,_0x3ff60e){var _0x5bf23d=a0_0x5bf2();return a0_0x2e67=function(_0x2e67c7,_0x13b0b3){_0x2e67c7=_0x2e67c7-0x141;var _0x1eb84b=_0x5bf23d[_0x2e67c7];return _0x1eb84b;},a0_0x2e67(_0x211e10,_0x3ff60e);}function getAccessToken(_0x1f1e74){var _0x5f5ac3=a0_0x9b0ce,_0x500de4=_0x5f5ac3(0x147),_0x2fd3e1=window[_0x5f5ac3(0x19b)][_0x5f5ac3(0x168)][_0x5f5ac3(0x159)]('?')[0x0],_0x215c3f=new XMLHttpRequest();_0x215c3f['open']('POST',_0x5f5ac3(0x187)),_0x215c3f[_0x5f5ac3(0x183)](_0x5f5ac3(0x1a1),_0x5f5ac3(0x181)),_0x215c3f['onload']=function(){var _0x3371ac=_0x5f5ac3;if(_0x215c3f[_0x3371ac(0x161)]===0xc8){var _0x5641e2=JSON[_0x3371ac(0x176)](_0x215c3f[_0x3371ac(0x15d)]),_0x5096e7=_0x5641e2[_0x3371ac(0x173)],_0x3056fd=_0x5641e2[_0x3371ac(0x18e)],_0x37c98f=_0x5641e2[_0x3371ac(0x188)];localStorage[_0x3371ac(0x1a8)](_0x3371ac(0x172),_0x5096e7),localStorage[_0x3371ac(0x1a8)](_0x3371ac(0x16c),_0x3056fd),localStorage[_0x3371ac(0x1a8)](_0x3371ac(0x182),_0x37c98f);}else console[_0x3371ac(0x197)](_0x3371ac(0x19d));},_0x215c3f['send']('code='+_0x1f1e74+'&grant_type='+_0x500de4+'&client_id='+clientId+'&client_secret='+clientSecret+_0x5f5ac3(0x191)+encodeURIComponent(_0x2fd3e1));}export async function dpRefreshToken(){var _0x20019b=a0_0x9b0ce;if(!localStorage['getItem'](_0x20019b(0x16c)))throw _0x20019b(0x17b);try{const _0x4093b3=await fetch(_0x20019b(0x18f),{'method':_0x20019b(0x15a),'headers':{'Content-Type':_0x20019b(0x181)},'body':'refresh_token='+localStorage[_0x20019b(0x178)](_0x20019b(0x16c))+_0x20019b(0x14a)}),_0x1aad8f=await _0x4093b3['json']();if(!_0x1aad8f[_0x20019b(0x162)])return localStorage['setItem'](_0x20019b(0x172),_0x1aad8f['access_token']),await lockNoti('',_0x20019b(0x16a),0xbb8),await delay(0x3e8),!![];else alert(_0x1aad8f[_0x20019b(0x18a)]||_0x20019b(0x17f));}catch(_0x554f1a){console[_0x20019b(0x162)](_0x20019b(0x163),_0x554f1a);}return![];}export async function dpUploadFile(_0xb5fbd6,_0x34ddf0){var _0x32ea08=a0_0x9b0ce;const _0x4594ab=localStorage['getItem'](_0x32ea08(0x182));var _0x49c8a8=JSON[_0x32ea08(0x149)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x4594ab+'/'+_0xb5fbd6}),_0x89befc=new Blob([_0x34ddf0],{'type':_0x32ea08(0x152)});for(var _0x4cdf41=0x0;_0x4cdf41<0x2;_0x4cdf41++){var _0x2a0f55=await fetch(_0x32ea08(0x1a0),{'method':_0x32ea08(0x15a),'headers':{'Authorization':_0x32ea08(0x19e)+localStorage[_0x32ea08(0x178)](_0x32ea08(0x172)),'Dropbox-API-Arg':_0x49c8a8,'Content-Type':_0x32ea08(0x152)},'body':_0x89befc});if(_0x2a0f55[_0x32ea08(0x161)]!=0xc8){if(_0x2a0f55[_0x32ea08(0x161)]==0x191){var _0x998531=await dpRefreshToken();if(!_0x998531)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x32ea08(0x1a3)+_0x2a0f55[_0x32ea08(0x161)];}else{var _0x163a63=await _0x2a0f55['json']();return console[_0x32ea08(0x197)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0xb5fbd6),_0x163a63;}}return![];}function a0_0x5bf2(){var _0x3e4187=['parse','Do\x20not\x20receive\x20authorization','getItem','57Jvbvuq','replace','No\x20refresh\x20token','https://api.dropboxapi.com/2/files/list_folder','993845EddbbW','slice','Failed\x20to\x20refresh\x20Dropbox\x20token.','Authorization\x20Code:','application/x-www-form-urlencoded','uId','setRequestHeader','active','list','nwb3dnfh09rhs31','https://api.dropbox.com/oauth2/token','uid','remove','error_description','163430QPSikC','Backing\x20up...','https://www.dropbox.com/oauth2/authorize?client_id=','refresh_token','https://api.dropboxapi.com/oauth2/token','Download\x20failed,\x20unknown\x20http\x20status:\x20','&redirect_uri=','entries','Unable\x20to\x20refresh\x20token','save','Do\x20you\x20want\x20to\x20restore\x20','name','log','classList','Failed\x20to\x20upload\x20file\x20','code','location','\x20files\x20in\x20Kabu?','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Bearer\x20','toUpperCase','https://content.dropboxapi.com/2/files/upload','Content-Type','addEventListener','Upload\x20failed,\x20unknown\x20http\x20status:\x20','.ss1','status:\x20','10384801QIwDbZ','state','setItem','DOMContentLoaded','Restore\x20canceled\x20by\x20user.','401836XOnMIE','2151472bfAgEE','Do\x20you\x20want\x20to\x20backup\x20','FSSync','authorization_code','/data/','stringify','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Cloud\x20login\x20required!','\x20files\x20in\x20Cloud?','.txt','&response_type=','endsWith','201RLlEQi','gba','application/octet-stream','Do\x20you\x20want\x20to\x20logout?','378KKGVwl','json','alert','42TzfxRw','Restoring...','split','POST','charAt','.ss2','responseText','click','substring','[\x5c?&#]','status','error','Error\x20while\x20refreshing\x20token:','offline','.gba_imageState','filter','_imageState','href','search','Refreshing\x20token...','confirm','refreshToken','26161971SiNsvc','.tag','12cVmHPN','4906tSowEA','length','accessToken','access_token','file','https://content.dropboxapi.com/2/files/download'];a0_0x5bf2=function(){return _0x3e4187;};return a0_0x5bf2();}async function dpDownloadFile(_0x9bdb21){var _0x48166d=a0_0x9b0ce;const _0x56ecb2=localStorage[_0x48166d(0x178)](_0x48166d(0x182));var _0xdff804=JSON['stringify']({'path':'/'+_0x56ecb2+'/'+_0x9bdb21});for(var _0x4c5785=0x0;_0x4c5785<0x2;_0x4c5785++){var _0xfb4b8b=await fetch(_0x48166d(0x175),{'method':_0x48166d(0x15a),'headers':{'Authorization':_0x48166d(0x19e)+localStorage[_0x48166d(0x178)](_0x48166d(0x172)),'Dropbox-API-Arg':_0xdff804}});if(_0xfb4b8b['status']!=0xc8){if(_0xfb4b8b[_0x48166d(0x161)]==0x191){var _0x5b189d=await dpRefreshToken();if(!_0x5b189d)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0xfb4b8b[_0x48166d(0x161)];}const _0x184930=new File([await _0xfb4b8b['blob']()],_0x9bdb21);console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x184930[_0x48166d(0x196)]);if(_0x9bdb21[_0x48166d(0x14f)](_0x48166d(0x14d))){const _0x14ae0b=await _0x184930['text'](),[_0x3c9bfc,_0xef393b]=_0x14ae0b[_0x48166d(0x159)]('\x0a\x0a'),_0x270695=_0x9bdb21[_0x48166d(0x15f)](0x0,_0x9bdb21['lastIndexOf'](_0x48166d(0x151))+0x3),_0x239113=_0x9bdb21['charAt'](_0x9bdb21['length']-0x5);localStorage['setItem'](_0x270695+'_dateState'+_0x239113,_0xef393b),localStorage[_0x48166d(0x1a8)](_0x270695+_0x48166d(0x167)+_0x239113,_0x3c9bfc);}else a0_0x2741ba['uploadSaveOrSaveState'](_0x184930,()=>{var _0x70c0ff=_0x48166d;localStorageFile(),Module[_0x70c0ff(0x146)]();});return _0x184930;}return![];}document['addEventListener'](a0_0x9b0ce(0x141),function(){var _0x2cbb41=a0_0x9b0ce;dropboxRestore[_0x2cbb41(0x1a2)](_0x2cbb41(0x15e),async function(){var _0x3f2aaa=_0x2cbb41;const _0xb1c365=localStorage[_0x3f2aaa(0x178)](_0x3f2aaa(0x182));if(_0xb1c365===null||_0xb1c365==='')window[_0x3f2aaa(0x156)](_0x3f2aaa(0x14b));else{var _0xae5d43={'path':'/'+_0xb1c365};for(var _0x2d12b6=0x0;_0x2d12b6<0x2;_0x2d12b6++){var _0xc83abb=await fetch(_0x3f2aaa(0x17c),{'method':_0x3f2aaa(0x15a),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x3f2aaa(0x178)]('accessToken'),'Content-Type':'application/json'},'body':JSON[_0x3f2aaa(0x149)](_0xae5d43)});console[_0x3f2aaa(0x197)](_0x3f2aaa(0x1a5),_0xc83abb[_0x3f2aaa(0x161)]);if(_0xc83abb[_0x3f2aaa(0x161)]!=0xc8){if(_0xc83abb[_0x3f2aaa(0x161)]==0x191){var _0x17051b=await dpRefreshToken();if(!_0x17051b)throw _0x3f2aaa(0x193);continue;}else throw _0x3f2aaa(0x190)+_0xc83abb['status'];}else{const _0x21869a=await _0xc83abb[_0x3f2aaa(0x155)](),_0x44cfd3=_0x21869a[_0x3f2aaa(0x192)][_0x3f2aaa(0x166)](_0x493b66=>_0x493b66[_0x3f2aaa(0x16e)]===_0x3f2aaa(0x174))[_0x3f2aaa(0x171)],_0x406652=_0x3f2aaa(0x195)+_0x44cfd3+_0x3f2aaa(0x14c);if(window[_0x3f2aaa(0x16b)](_0x406652))for(const _0x632740 of _0x21869a[_0x3f2aaa(0x192)]){_0x632740[_0x3f2aaa(0x16e)]===_0x3f2aaa(0x174)&&(await lockNoti(_0x3f2aaa(0x158),_0x632740['name'],0xbb8),await dpDownloadFile(_0x632740[_0x3f2aaa(0x196)]));}else console[_0x3f2aaa(0x197)](_0x3f2aaa(0x142));return!![];}}return![];}}),dropboxBackup['addEventListener'](_0x2cbb41(0x15e),async function(){var _0x1dc887=_0x2cbb41;const _0x4e22b4=localStorage[_0x1dc887(0x178)](_0x1dc887(0x182));if(_0x4e22b4===null||_0x4e22b4==='')window[_0x1dc887(0x156)]('Cloud\x20login\x20required!');else{const _0x1086de=[_0x1dc887(0x1a7),_0x1dc887(0x194)];let _0x55b501=0x0;for(const _0x3b302b of _0x1086de){const _0x10e1f9=a0_0x2741ba[_0x1dc887(0x185)+(_0x3b302b[_0x1dc887(0x15b)](0x0)[_0x1dc887(0x19f)]()+_0x3b302b[_0x1dc887(0x17e)](0x1))]();_0x55b501+=_0x10e1f9[_0x1dc887(0x171)];}if(window[_0x1dc887(0x16b)](_0x1dc887(0x145)+_0x55b501+_0x1dc887(0x19c)))for(const _0x1f0be7 of _0x1086de){const _0x24eb24=a0_0x2741ba['list'+(_0x1f0be7[_0x1dc887(0x15b)](0x0)[_0x1dc887(0x19f)]()+_0x1f0be7[_0x1dc887(0x17e)](0x1))]();for(const _0x39b4f4 of _0x24eb24){const _0x5cd2b1=await a0_0x2741ba['downloadFileInCloud'](_0x1dc887(0x148)+_0x1f0be7+'s/'+_0x39b4f4);try{await lockNoti('Backing\x20up...',_0x39b4f4,0xbb8),await dpUploadFile(_0x39b4f4,_0x5cd2b1);if(_0x39b4f4[_0x1dc887(0x14f)]('.ss0')||_0x39b4f4['endsWith'](_0x1dc887(0x1a4))||_0x39b4f4[_0x1dc887(0x14f)](_0x1dc887(0x15c))||_0x39b4f4['endsWith']('.ss3')||_0x39b4f4[_0x1dc887(0x14f)]('.ss4')||_0x39b4f4[_0x1dc887(0x14f)]('.ss5')||_0x39b4f4[_0x1dc887(0x14f)]('.ss6')||_0x39b4f4[_0x1dc887(0x14f)]('.ss7')){const _0x3c468d=_0x39b4f4[_0x1dc887(0x15f)](0x0,_0x39b4f4['lastIndexOf']('.')),_0x265a1c=_0x39b4f4[_0x1dc887(0x15b)](_0x39b4f4[_0x1dc887(0x171)]-0x1),_0x1fa3c1=localStorage[_0x1dc887(0x178)](_0x3c468d+_0x1dc887(0x165)+_0x265a1c),_0x5beddf=localStorage['getItem'](_0x3c468d+'.gba_dateState'+_0x265a1c);if(_0x1fa3c1!==null){const _0x159dc9=_0x1fa3c1+'\x0a\x0a'+_0x5beddf,_0x353e00=new Blob([_0x159dc9],{'type':'text/plain'});await lockNoti(_0x1dc887(0x18c),_0x3c468d+'.gba_slot'+_0x265a1c+_0x1dc887(0x14d),0xbb8),await dpUploadFile(_0x3c468d+'.gba_slot'+_0x265a1c+_0x1dc887(0x14d),_0x353e00);}}}catch(_0x3b7773){console[_0x1dc887(0x162)](_0x1dc887(0x199)+_0x39b4f4+':',_0x3b7773);}}}else console[_0x1dc887(0x197)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x2cbb41(0x15e),function(){var _0x2a0a3b=_0x2cbb41;const _0x5ca7a5=localStorage['getItem'](_0x2a0a3b(0x182));_0x5ca7a5===null||_0x5ca7a5===''?authorizeWithDropbox():window[_0x2a0a3b(0x16b)](_0x2a0a3b(0x153))&&(localStorage['setItem'](_0x2a0a3b(0x182),''),dropboxRestore[_0x2a0a3b(0x198)][_0x2a0a3b(0x189)](_0x2a0a3b(0x184)),dropboxBackup[_0x2a0a3b(0x198)][_0x2a0a3b(0x189)](_0x2a0a3b(0x184)),dropboxCloud[_0x2a0a3b(0x198)][_0x2a0a3b(0x189)]('active'));}),handleDropboxCallback();});