var a0_0x30be5d=a0_0x3640;(function(_0x390659,_0x50f66e){var _0x2d90e3=a0_0x3640,_0xdba5da=_0x390659();while(!![]){try{var _0x468902=-parseInt(_0x2d90e3(0xa7))/0x1*(-parseInt(_0x2d90e3(0xe8))/0x2)+-parseInt(_0x2d90e3(0xd2))/0x3+-parseInt(_0x2d90e3(0xc6))/0x4+-parseInt(_0x2d90e3(0xd9))/0x5+parseInt(_0x2d90e3(0xc1))/0x6+parseInt(_0x2d90e3(0xf1))/0x7+-parseInt(_0x2d90e3(0xc4))/0x8*(-parseInt(_0x2d90e3(0xe2))/0x9);if(_0x468902===_0x50f66e)break;else _0xdba5da['push'](_0xdba5da['shift']());}catch(_0x17c646){_0xdba5da['push'](_0xdba5da['shift']());}}}(a0_0x4e6c,0x2ce9f));import*as a0_0x1f5f79 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x30be5d(0xb5),clientSecret='nwb3dnfh09rhs31';function a0_0x4e6c(){var _0x44a34c=['log','map','setItem','listFiles','Restore\x20canceled\x20by\x20user.','Do\x20you\x20want\x20to\x20backup\x20','replace','1huPEPX','application/x-www-form-urlencoded','push','DOMContentLoaded','Refreshing\x20token...','status','Folder\x20created','error_description','entries','Kabu\x20storage\x20↦\x20Cloud\x20◆','No\x20files\x20found\x20to\x20restore.','split','folder','uid','knh3uz2mx2hp2eu','click','Do\x20not\x20receive\x20authorization','refresh_token','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','&client_id=','Cloud\x20↦\x20Kabu\x20storage\x20◆','.tag','uploadFileInCloud','access_token','application/octet-stream','/data/','1403154RFZmiv','Backing\x20up...','location','409648OBQykz','&redirect_uri=','263944hQXJuo','save','open','responseText','https://api.dropboxapi.com/oauth2/token','refreshToken','=([^&#]*)','onload','active','search','\x20files\x20in\x20Kabu?','Error\x20creating\x20folder\x20','843846yeFbfe','confirm','&grant_type=','downloadFileInCloud','json','error','[\x5c?&#]','1732790KBRNgU','setRequestHeader','uId','filter','No\x20refresh\x20token','https://api.dropboxapi.com/2/files/list_folder','Do\x20you\x20want\x20to\x20restore\x20','application/json','remove','36LVCYEA','Cloud\x20login\x20required!','stringify','Failed\x20to\x20refresh\x20Dropbox\x20token.','offline','code','292028wolEjG','parse','Bearer\x20','href','Download\x20failed,\x20unknown\x20http\x20status:','Restoring...','POST','name','Content-Type','2051672exkyJn','length','refresh_token=','classList','addEventListener','file','accessToken','&client_secret=','&token_access_type=','Wait\x20a\x20little\x20bit...','https://api.dropboxapi.com/2/files/create_folder_v2','state','Unable\x20to\x20refresh\x20token','Upload\x20failed,\x20unknown\x20http\x20status:\x20','getItem','send','Failed\x20to\x20upload\x20file\x20'];a0_0x4e6c=function(){return _0x44a34c;};return a0_0x4e6c();}function authorizeWithDropbox(){var _0x4084cd=a0_0x30be5d,_0x5403cd=window[_0x4084cd(0xc3)][_0x4084cd(0xeb)][_0x4084cd(0xb2)]('?')[0x0],_0x4fcc69=_0x4084cd(0xe7),_0x49d53a=_0x4084cd(0xe6),_0x306396='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+'&response_type='+_0x4fcc69+_0x4084cd(0x97)+_0x49d53a+_0x4084cd(0xc5)+encodeURIComponent(_0x5403cd);window[_0x4084cd(0xc3)][_0x4084cd(0xeb)]=_0x306396;}function handleDropboxCallback(){var _0x5687e4=a0_0x30be5d,_0x16ff55=getUrlParameter(_0x5687e4(0xe7));_0x16ff55?(getAccessToken(_0x16ff55),console[_0x5687e4(0xa0)]('Authorization\x20Code:',_0x16ff55)):console['log'](_0x5687e4(0xb7));}function getUrlParameter(_0x1ce97a){var _0x5d72e8=a0_0x30be5d;_0x1ce97a=_0x1ce97a[_0x5d72e8(0xa6)](/[\[]/,'\x5c[')[_0x5d72e8(0xa6)](/[\]]/,'\x5c]');var _0x2ccf25=new RegExp(_0x5d72e8(0xd8)+_0x1ce97a+_0x5d72e8(0xcc)),_0x4ec8bc=_0x2ccf25['exec'](location[_0x5d72e8(0xcf)]);return _0x4ec8bc===null?'':decodeURIComponent(_0x4ec8bc[0x1][_0x5d72e8(0xa6)](/\+/g,'\x20'));}function getAccessToken(_0xcafedd){var _0x6d7075=a0_0x30be5d,_0x5475ec='authorization_code',_0x288440=window[_0x6d7075(0xc3)][_0x6d7075(0xeb)][_0x6d7075(0xb2)]('?')[0x0],_0x581ca9=new XMLHttpRequest();_0x581ca9[_0x6d7075(0xc8)](_0x6d7075(0xee),'https://api.dropbox.com/oauth2/token'),_0x581ca9[_0x6d7075(0xda)](_0x6d7075(0xf0),_0x6d7075(0xa8)),_0x581ca9[_0x6d7075(0xcd)]=function(){var _0x432567=_0x6d7075;if(_0x581ca9[_0x432567(0xac)]===0xc8){var _0x193cf8=JSON[_0x432567(0xe9)](_0x581ca9[_0x432567(0xc9)]),_0x2e905d=_0x193cf8['access_token'],_0x3bbc1a=_0x193cf8[_0x432567(0xb8)],_0x291ffb=_0x193cf8[_0x432567(0xb4)];localStorage[_0x432567(0xa2)](_0x432567(0x95),_0x2e905d),localStorage[_0x432567(0xa2)](_0x432567(0xcb),_0x3bbc1a),localStorage[_0x432567(0xa2)](_0x432567(0xdb),_0x291ffb);}else console[_0x432567(0xa0)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x581ca9[_0x6d7075(0x9e)]('code='+_0xcafedd+_0x6d7075(0xd4)+_0x5475ec+_0x6d7075(0xba)+clientId+_0x6d7075(0x96)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x288440));}export async function dpCreateFolder(_0x4ef83c){var _0x30f884=a0_0x30be5d;const _0x4a0b1d=localStorage[_0x30f884(0x9d)](_0x30f884(0xdb));let _0x58bb75=localStorage[_0x30f884(0x9d)](_0x30f884(0x95));const _0x5b1911='/'+_0x4a0b1d+'/'+_0x4ef83c,_0x11b5f5=JSON[_0x30f884(0xe4)]({'path':_0x5b1911,'autorename':![]});for(let _0x5db9ce=0x0;_0x5db9ce<0x2;_0x5db9ce++){try{const _0x451fb6=await fetch(_0x30f884(0x99),{'method':'POST','headers':{'Authorization':_0x30f884(0xea)+_0x58bb75,'Content-Type':_0x30f884(0xe0)},'body':_0x11b5f5});if(_0x451fb6[_0x30f884(0xac)]===0x191){const _0x797b5f=await dpRefreshToken();if(!_0x797b5f)throw new Error(_0x30f884(0x9b));_0x58bb75=localStorage[_0x30f884(0x9d)](_0x30f884(0x95));continue;}if(_0x451fb6['status']===0x199)return{'message':'Folder\x20already\x20exists','path':_0x4ef83c};if(!_0x451fb6['ok'])throw new Error(_0x30f884(0xd1)+_0x4ef83c);const _0x3933ef=await _0x451fb6[_0x30f884(0xd6)]();return await lockNoti(_0x30f884(0xad),'',0xbb8),_0x3933ef;}catch(_0x11b096){if(_0x5db9ce===0x1)throw _0x11b096;}}return![];}export async function dpRefreshToken(){var _0x54879d=a0_0x30be5d;if(!localStorage[_0x54879d(0x9d)](_0x54879d(0xcb)))throw _0x54879d(0xdd);try{const _0x4186e3=await fetch(_0x54879d(0xca),{'method':_0x54879d(0xee),'headers':{'Content-Type':_0x54879d(0xa8)},'body':_0x54879d(0xf3)+localStorage[_0x54879d(0x9d)](_0x54879d(0xcb))+_0x54879d(0xb9)}),_0x5b23b=await _0x4186e3[_0x54879d(0xd6)]();if(!_0x5b23b[_0x54879d(0xd7)])return localStorage[_0x54879d(0xa2)](_0x54879d(0x95),_0x5b23b[_0x54879d(0xbe)]),await lockNoti(_0x54879d(0xab),'',0xbb8),await delay(0x3e8),!![];else alert(_0x5b23b[_0x54879d(0xae)]||_0x54879d(0xe5));}catch(_0x2475fb){console[_0x54879d(0xd7)]('Error\x20while\x20refreshing\x20token:',_0x2475fb);}return![];}export async function dpUploadFile(_0x570b48,_0x41bf4b,_0x5ab930){var _0x1a3d9c=a0_0x30be5d;const _0x2904d4=localStorage['getItem'](_0x1a3d9c(0xdb));var _0x1e00e0=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x2904d4+'/'+_0x5ab930+'/'+_0x570b48}),_0x5aae66=new Blob([_0x41bf4b],{'type':_0x1a3d9c(0xbf)});for(var _0x348c0f=0x0;_0x348c0f<0x2;_0x348c0f++){var _0x46b19b=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x1a3d9c(0xee),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x1a3d9c(0x9d)](_0x1a3d9c(0x95)),'Dropbox-API-Arg':_0x1e00e0,'Content-Type':_0x1a3d9c(0xbf)},'body':_0x5aae66});if(_0x46b19b[_0x1a3d9c(0xac)]!=0xc8){if(_0x46b19b[_0x1a3d9c(0xac)]==0x191){var _0x184ecc=await dpRefreshToken();if(!_0x184ecc)throw _0x1a3d9c(0x9b);continue;}else throw _0x1a3d9c(0x9c)+_0x46b19b[_0x1a3d9c(0xac)];}else{var _0x5999cc=await _0x46b19b['json']();return console[_0x1a3d9c(0xa0)](_0x1a3d9c(0xb0),_0x570b48),_0x5999cc;}}return![];}export async function dpDownloadFile(_0x385e32,_0x2574b6){var _0x322a74=a0_0x30be5d;const _0x3a2263=localStorage[_0x322a74(0x9d)](_0x322a74(0xdb));var _0x591b8b=JSON['stringify']({'path':'/'+_0x3a2263+'/'+_0x2574b6+'/'+_0x385e32});for(var _0x479b6b=0x0;_0x479b6b<0x2;_0x479b6b++){var _0x299416=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x322a74(0xee),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x322a74(0x9d)]('accessToken'),'Dropbox-API-Arg':_0x591b8b}});if(_0x299416[_0x322a74(0xac)]!=0xc8){if(_0x299416[_0x322a74(0xac)]==0x191){var _0x135035=await dpRefreshToken();if(!_0x135035)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x322a74(0xec)+_0x299416[_0x322a74(0xac)];}const _0x15503b=new File([await _0x299416['blob']()],_0x385e32);return console['log'](_0x322a74(0xbb),_0x15503b['name']),a0_0x1f5f79[_0x322a74(0xbd)](_0x15503b,()=>{}),_0x15503b;}return![];}function a0_0x3640(_0x96b9ef,_0x20016b){var _0x4e6ca0=a0_0x4e6c();return a0_0x3640=function(_0x3640ce,_0x578874){_0x3640ce=_0x3640ce-0x92;var _0x33eee5=_0x4e6ca0[_0x3640ce];return _0x33eee5;},a0_0x3640(_0x96b9ef,_0x20016b);}document[a0_0x30be5d(0x93)](a0_0x30be5d(0xaa),function(){var _0x4a0806=a0_0x30be5d;dropboxRestore[_0x4a0806(0x93)]('click',async function(){var _0x37d4ab=_0x4a0806;await lockNoti(_0x37d4ab(0x98),'',0x1388);const _0x31cd75=localStorage[_0x37d4ab(0x9d)](_0x37d4ab(0xdb)),_0xb3e1a4=[_0x37d4ab(0x9a),'save','screenshot'];if(!_0x31cd75){window['alert'](_0x37d4ab(0xe3));return;}let _0x5d61be=[];for(const _0x3a47eb of _0xb3e1a4){let _0x1d9075={'path':'/'+_0x31cd75+'/'+_0x3a47eb};for(let _0x2e1ea7=0x0;_0x2e1ea7<0x2;_0x2e1ea7++){let _0x2334e1=await fetch(_0x37d4ab(0xde),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x37d4ab(0x9d)](_0x37d4ab(0x95)),'Content-Type':_0x37d4ab(0xe0)},'body':JSON['stringify'](_0x1d9075)});if(_0x2334e1['status']===0xc8){let _0x5def3d=await _0x2334e1['json'](),_0x2e688c=_0x5def3d[_0x37d4ab(0xaf)][_0x37d4ab(0xdc)](_0x41faf1=>_0x41faf1[_0x37d4ab(0xbc)]===_0x37d4ab(0x94));_0x2e688c['length']>0x0&&_0x5d61be[_0x37d4ab(0xa9)](..._0x2e688c[_0x37d4ab(0xa1)](_0x34e817=>({'name':_0x34e817[_0x37d4ab(0xef)],'folder':_0x3a47eb})));break;}else{if(_0x2334e1[_0x37d4ab(0xac)]===0x191){let _0x4931ee=await dpRefreshToken();if(!_0x4931ee)throw _0x37d4ab(0x9b);}else{console['error']('Download\x20failed\x20for\x20'+_0x3a47eb+',\x20status:\x20'+_0x2334e1[_0x37d4ab(0xac)]);break;}}}}if(_0x5d61be[_0x37d4ab(0xf2)]>0x0){const _0x3c142a=_0x37d4ab(0xdf)+_0x5d61be[_0x37d4ab(0xf2)]+'\x20files\x20from\x20Cloud?';if(window['confirm'](_0x3c142a))for(const _0x4ec6fe of _0x5d61be){await lockNoti(_0x37d4ab(0xed),_0x4ec6fe[_0x37d4ab(0xef)],0xbb8),await dpDownloadFile(_0x4ec6fe[_0x37d4ab(0xef)],_0x4ec6fe[_0x37d4ab(0xb3)]);}else console[_0x37d4ab(0xa0)](_0x37d4ab(0xa4));}else console[_0x37d4ab(0xa0)](_0x37d4ab(0xb1));}),dropboxBackup[_0x4a0806(0x93)](_0x4a0806(0xb6),async function(){var _0x1d1a5f=_0x4a0806;await lockNoti(_0x1d1a5f(0x98),'',0x1388);const _0x26d28e=localStorage['getItem'](_0x1d1a5f(0xdb));if(_0x26d28e===null||_0x26d28e==='')window['alert']('Cloud\x20login\x20required!');else{const _0xd1f8d5=[_0x1d1a5f(0x9a),_0x1d1a5f(0xc7),'screenshot'];for(const _0x37c91c of _0xd1f8d5){await dpCreateFolder(_0x37c91c);}let _0x2ae2a0=0x0;for(const _0x3dbcef of _0xd1f8d5){const _0x36a85c=a0_0x1f5f79[_0x1d1a5f(0xa3)](_0x3dbcef+'s');_0x2ae2a0+=_0x36a85c[_0x1d1a5f(0xf2)];}if(window[_0x1d1a5f(0xd3)](_0x1d1a5f(0xa5)+_0x2ae2a0+_0x1d1a5f(0xd0)))for(const _0x422435 of _0xd1f8d5){const _0x43c98f=a0_0x1f5f79[_0x1d1a5f(0xa3)](_0x422435+'s');for(const _0x3d31b1 of _0x43c98f){const _0xc75245=await a0_0x1f5f79[_0x1d1a5f(0xd5)](_0x1d1a5f(0xc0)+_0x422435+'s/'+_0x3d31b1);try{await lockNoti(_0x1d1a5f(0xc2),_0x3d31b1,0xbb8),await dpUploadFile(_0x3d31b1,_0xc75245,_0x422435);}catch(_0xa30742){console['error'](_0x1d1a5f(0x9f)+_0x3d31b1+':',_0xa30742);}}}else console[_0x1d1a5f(0xa0)](_0x1d1a5f(0xa4));}}),dropboxCloud[_0x4a0806(0x93)](_0x4a0806(0xb6),function(){var _0x5ca40d=_0x4a0806;const _0x43aec9=localStorage[_0x5ca40d(0x9d)](_0x5ca40d(0xdb));_0x43aec9===null||_0x43aec9===''?authorizeWithDropbox():window[_0x5ca40d(0xd3)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x5ca40d(0xa2)](_0x5ca40d(0xdb),''),dropboxRestore[_0x5ca40d(0x92)][_0x5ca40d(0xe1)]('active'),dropboxBackup[_0x5ca40d(0x92)][_0x5ca40d(0xe1)]('active'),dropboxCloud[_0x5ca40d(0x92)][_0x5ca40d(0xe1)](_0x5ca40d(0xce)));}),handleDropboxCallback();});