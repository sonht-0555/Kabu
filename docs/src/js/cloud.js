var a0_0x2daabb=a0_0x5b56;(function(_0x6f7d4b,_0x221e79){var _0x74ea47=a0_0x5b56,_0x11e860=_0x6f7d4b();while(!![]){try{var _0x414658=parseInt(_0x74ea47(0x210))/0x1+-parseInt(_0x74ea47(0x20e))/0x2*(-parseInt(_0x74ea47(0x224))/0x3)+parseInt(_0x74ea47(0x252))/0x4*(-parseInt(_0x74ea47(0x22a))/0x5)+-parseInt(_0x74ea47(0x221))/0x6+parseInt(_0x74ea47(0x219))/0x7*(-parseInt(_0x74ea47(0x1f8))/0x8)+parseInt(_0x74ea47(0x226))/0x9+parseInt(_0x74ea47(0x1f4))/0xa;if(_0x414658===_0x221e79)break;else _0x11e860['push'](_0x11e860['shift']());}catch(_0x2ecf3a){_0x11e860['push'](_0x11e860['shift']());}}}(a0_0x4288,0x7590c));import*as a0_0x241418 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2daabb(0x23d),clientSecret=a0_0x2daabb(0x209);function authorizeWithDropbox(){var _0x3aaeb3=a0_0x2daabb,_0x1a1859=window[_0x3aaeb3(0x200)][_0x3aaeb3(0x1fc)][_0x3aaeb3(0x202)]('?')[0x0],_0x5b3712=_0x3aaeb3(0x232),_0x7cdd0e=_0x3aaeb3(0x212),_0x4dde7c='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x3aaeb3(0x23f)+_0x5b3712+'&token_access_type='+_0x7cdd0e+_0x3aaeb3(0x21c)+encodeURIComponent(_0x1a1859);window['location'][_0x3aaeb3(0x1fc)]=_0x4dde7c;}function handleDropboxCallback(){var _0x2d966e=a0_0x2daabb,_0xf1cddb=getUrlParameter('code');_0xf1cddb?(getAccessToken(_0xf1cddb),console['log'](_0x2d966e(0x1fe),_0xf1cddb)):console[_0x2d966e(0x235)](_0x2d966e(0x240));}function getUrlParameter(_0x113e86){var _0x4884eb=a0_0x2daabb;_0x113e86=_0x113e86[_0x4884eb(0x20a)](/[\[]/,'\x5c[')[_0x4884eb(0x20a)](/[\]]/,'\x5c]');var _0x2c3b68=new RegExp(_0x4884eb(0x229)+_0x113e86+'=([^&#]*)'),_0x26dcc2=_0x2c3b68[_0x4884eb(0x214)](location[_0x4884eb(0x20f)]);return _0x26dcc2===null?'':decodeURIComponent(_0x26dcc2[0x1][_0x4884eb(0x20a)](/\+/g,'\x20'));}function getAccessToken(_0xb6c1d1){var _0x2297df=a0_0x2daabb,_0x4729b1=_0x2297df(0x239),_0x1863ea=window['location'][_0x2297df(0x1fc)][_0x2297df(0x202)]('?')[0x0],_0x3614d2=new XMLHttpRequest();_0x3614d2[_0x2297df(0x242)](_0x2297df(0x21b),_0x2297df(0x21a)),_0x3614d2[_0x2297df(0x223)](_0x2297df(0x20d),_0x2297df(0x205)),_0x3614d2['onload']=function(){var _0x62ca4f=_0x2297df;if(_0x3614d2[_0x62ca4f(0x244)]===0xc8){var _0x1290d1=JSON['parse'](_0x3614d2[_0x62ca4f(0x22b)]),_0x15ecef=_0x1290d1[_0x62ca4f(0x217)],_0x966077=_0x1290d1[_0x62ca4f(0x23c)],_0x59eb86=_0x1290d1['uid'];localStorage[_0x62ca4f(0x238)](_0x62ca4f(0x231),_0x15ecef),localStorage[_0x62ca4f(0x238)](_0x62ca4f(0x1f3),_0x966077),localStorage[_0x62ca4f(0x238)](_0x62ca4f(0x246),_0x59eb86);}else console[_0x62ca4f(0x235)](_0x62ca4f(0x22d));},_0x3614d2['send'](_0x2297df(0x249)+_0xb6c1d1+_0x2297df(0x207)+_0x4729b1+'&client_id='+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0x1863ea));}export async function dpCreateFolder(_0x293e68){var _0xe77336=a0_0x2daabb;const _0x1e6875=localStorage[_0xe77336(0x213)]('uId');let _0x59897d=localStorage['getItem'](_0xe77336(0x231));const _0x55f224='/'+_0x1e6875+'/'+_0x293e68,_0x3efb18=JSON[_0xe77336(0x243)]({'path':_0x55f224,'autorename':![]});for(let _0x28f907=0x0;_0x28f907<0x2;_0x28f907++){try{const _0x303838=await fetch(_0xe77336(0x22c),{'method':_0xe77336(0x21b),'headers':{'Authorization':'Bearer\x20'+_0x59897d,'Content-Type':'application/json'},'body':_0x3efb18});if(_0x303838['status']===0x191){const _0x59324a=await dpRefreshToken();if(!_0x59324a)throw new Error(_0xe77336(0x20b));_0x59897d=localStorage[_0xe77336(0x213)](_0xe77336(0x231));continue;}if(_0x303838[_0xe77336(0x244)]===0x199)return{'message':_0xe77336(0x211),'path':_0x293e68};if(!_0x303838['ok'])throw new Error(_0xe77336(0x1f1)+_0x293e68);const _0x46e5c0=await _0x303838['json']();return await lockNoti(_0xe77336(0x22f),'',0xbb8),_0x46e5c0;}catch(_0x37a22b){if(_0x28f907===0x1)throw _0x37a22b;}}return![];}export async function dpRefreshToken(){var _0x5cc781=a0_0x2daabb;if(!localStorage[_0x5cc781(0x213)](_0x5cc781(0x1f3)))throw _0x5cc781(0x208);try{const _0xd3625f=await fetch(_0x5cc781(0x1f6),{'method':_0x5cc781(0x21b),'headers':{'Content-Type':_0x5cc781(0x205)},'body':'refresh_token='+localStorage[_0x5cc781(0x213)](_0x5cc781(0x1f3))+_0x5cc781(0x1fa)}),_0x20c174=await _0xd3625f[_0x5cc781(0x222)]();if(!_0x20c174['error'])return localStorage[_0x5cc781(0x238)](_0x5cc781(0x231),_0x20c174[_0x5cc781(0x217)]),await lockNoti(_0x5cc781(0x228),'',0xbb8),await delay(0x3e8),!![];else alert(_0x20c174['error_description']||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x44b4d0){console[_0x5cc781(0x23b)](_0x5cc781(0x248),_0x44b4d0);}return![];}function a0_0x5b56(_0xe49c1b,_0x16a588){var _0x4288bb=a0_0x4288();return a0_0x5b56=function(_0x5b5668,_0x2c0f58){_0x5b5668=_0x5b5668-0x1f1;var _0x230e72=_0x4288bb[_0x5b5668];return _0x230e72;},a0_0x5b56(_0xe49c1b,_0x16a588);}export async function dpUploadFile(_0x2a9b6e,_0x5d5f7e,_0x418795){var _0x192edf=a0_0x2daabb;const _0x322465=localStorage[_0x192edf(0x213)](_0x192edf(0x246));var _0x2dbada=JSON[_0x192edf(0x243)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x322465+'/'+_0x418795+'/'+_0x2a9b6e}),_0x3061d2=new Blob([_0x5d5f7e],{'type':_0x192edf(0x233)});for(var _0x1307c3=0x0;_0x1307c3<0x2;_0x1307c3++){var _0x587576=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x192edf(0x21b),'headers':{'Authorization':_0x192edf(0x1f5)+localStorage[_0x192edf(0x213)](_0x192edf(0x231)),'Dropbox-API-Arg':_0x2dbada,'Content-Type':_0x192edf(0x233)},'body':_0x3061d2});if(_0x587576[_0x192edf(0x244)]!=0xc8){if(_0x587576[_0x192edf(0x244)]==0x191){var _0x2a6292=await dpRefreshToken();if(!_0x2a6292)throw _0x192edf(0x20b);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x587576['status'];}else{var _0x540a77=await _0x587576[_0x192edf(0x222)]();return console['log'](_0x192edf(0x24a),_0x2a9b6e),_0x540a77;}}return![];}function a0_0x4288(){var _0x4bb23a=['offline','getItem','exec','click','DOMContentLoaded','access_token','Backing\x20up...','4446176ZFvQfq','https://api.dropbox.com/oauth2/token','POST','&redirect_uri=','application/json','Wait\x20a\x20little\x20bit...','https://content.dropboxapi.com/2/files/download','Download\x20failed,\x20unknown\x20http\x20status:','2727324WnHCgM','json','setRequestHeader','1713DaGvik','Failed\x20to\x20upload\x20file\x20','4057317QTAMSN','Cloud\x20↦\x20Kabu\x20storage\x20◆','Refreshing\x20token...','[\x5c?&#]','43715oBecfS','responseText','https://api.dropboxapi.com/2/files/create_folder_v2','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','state','Folder\x20created','listFiles','accessToken','code','application/octet-stream','file','log','blob','active','setItem','authorization_code','downloadFileInCloud','error','refresh_token','knh3uz2mx2hp2eu','https://api.dropboxapi.com/2/files/list_folder','&response_type=','Do\x20not\x20receive\x20authorization','Do\x20you\x20want\x20to\x20backup\x20','open','stringify','status','\x20files\x20from\x20Cloud?','uId','Restore\x20canceled\x20by\x20user.','Error\x20while\x20refreshing\x20token:','code=','Kabu\x20storage\x20↦\x20Cloud\x20◆','entries','length','alert','map','remove','addEventListener','save','300bzUVWM','Error\x20creating\x20folder\x20','name','refreshToken','10749320RiAeRc','Bearer\x20','https://api.dropboxapi.com/oauth2/token','classList','8wcjQor','uploadFileInCloud','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','No\x20files\x20found\x20to\x20restore.','href','Cloud\x20login\x20required!','Authorization\x20Code:','confirm','location','folder','split','filter','screenshot','application/x-www-form-urlencoded','Do\x20you\x20want\x20to\x20restore\x20','&grant_type=','No\x20refresh\x20token','nwb3dnfh09rhs31','replace','Unable\x20to\x20refresh\x20token','/data/','Content-Type','934mYCqod','search','434593kOvvGO','Folder\x20already\x20exists'];a0_0x4288=function(){return _0x4bb23a;};return a0_0x4288();}export async function dpDownloadFile(_0x150bbc,_0x402ed5){var _0x1c4336=a0_0x2daabb;const _0x3cdcc9=localStorage[_0x1c4336(0x213)]('uId');var _0x43a03d=JSON[_0x1c4336(0x243)]({'path':'/'+_0x3cdcc9+'/'+_0x402ed5+'/'+_0x150bbc});for(var _0x38c90b=0x0;_0x38c90b<0x2;_0x38c90b++){var _0x88f43a=await fetch(_0x1c4336(0x21f),{'method':_0x1c4336(0x21b),'headers':{'Authorization':_0x1c4336(0x1f5)+localStorage[_0x1c4336(0x213)](_0x1c4336(0x231)),'Dropbox-API-Arg':_0x43a03d}});if(_0x88f43a['status']!=0xc8){if(_0x88f43a[_0x1c4336(0x244)]==0x191){var _0x20ceb8=await dpRefreshToken();if(!_0x20ceb8)throw _0x1c4336(0x20b);continue;}else throw _0x1c4336(0x220)+_0x88f43a[_0x1c4336(0x244)];}const _0x452fb7=new File([await _0x88f43a[_0x1c4336(0x236)]()],_0x150bbc);return console[_0x1c4336(0x235)](_0x1c4336(0x227),_0x452fb7[_0x1c4336(0x1f2)]),a0_0x241418[_0x1c4336(0x1f9)](_0x452fb7,()=>{}),_0x452fb7;}return![];}document[a0_0x2daabb(0x250)](a0_0x2daabb(0x216),function(){var _0x2275cd=a0_0x2daabb;dropboxRestore['addEventListener'](_0x2275cd(0x215),async function(){var _0x5af10d=_0x2275cd;await lockNoti(_0x5af10d(0x21e),'',0x1388);const _0x8ff258=localStorage['getItem']('uId'),_0x415572=['state',_0x5af10d(0x251),'screenshot'];if(!_0x8ff258){window[_0x5af10d(0x24d)](_0x5af10d(0x1fd));return;}let _0x55900b=[];for(const _0xb0e327 of _0x415572){let _0x51d5e4={'path':'/'+_0x8ff258+'/'+_0xb0e327};for(let _0x50d2f0=0x0;_0x50d2f0<0x2;_0x50d2f0++){let _0xe66cb9=await fetch(_0x5af10d(0x23e),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x5af10d(0x213)](_0x5af10d(0x231)),'Content-Type':_0x5af10d(0x21d)},'body':JSON[_0x5af10d(0x243)](_0x51d5e4)});if(_0xe66cb9[_0x5af10d(0x244)]===0xc8){let _0x125264=await _0xe66cb9[_0x5af10d(0x222)](),_0x50d0ac=_0x125264[_0x5af10d(0x24b)][_0x5af10d(0x203)](_0x34d4b1=>_0x34d4b1['.tag']===_0x5af10d(0x234));_0x50d0ac[_0x5af10d(0x24c)]>0x0&&_0x55900b['push'](..._0x50d0ac[_0x5af10d(0x24e)](_0x467017=>({'name':_0x467017[_0x5af10d(0x1f2)],'folder':_0xb0e327})));break;}else{if(_0xe66cb9[_0x5af10d(0x244)]===0x191){let _0x2cb3c9=await dpRefreshToken();if(!_0x2cb3c9)throw _0x5af10d(0x20b);}else{console[_0x5af10d(0x23b)]('Download\x20failed\x20for\x20'+_0xb0e327+',\x20status:\x20'+_0xe66cb9['status']);break;}}}}if(_0x55900b[_0x5af10d(0x24c)]>0x0){const _0x4fdb7f=_0x5af10d(0x206)+_0x55900b[_0x5af10d(0x24c)]+_0x5af10d(0x245);if(window[_0x5af10d(0x1ff)](_0x4fdb7f))for(const _0x308630 of _0x55900b){await lockNoti('Restoring...',_0x308630[_0x5af10d(0x1f2)],0xbb8),await dpDownloadFile(_0x308630[_0x5af10d(0x1f2)],_0x308630[_0x5af10d(0x201)]);}else console['log'](_0x5af10d(0x247));}else console['log'](_0x5af10d(0x1fb));}),dropboxBackup[_0x2275cd(0x250)](_0x2275cd(0x215),async function(){var _0x2aa8fd=_0x2275cd;await lockNoti(_0x2aa8fd(0x21e),'',0x1388);const _0x2b40a5=localStorage[_0x2aa8fd(0x213)](_0x2aa8fd(0x246));if(_0x2b40a5===null||_0x2b40a5==='')window[_0x2aa8fd(0x24d)](_0x2aa8fd(0x1fd));else{const _0x2357f8=[_0x2aa8fd(0x22e),'save',_0x2aa8fd(0x204)];for(const _0x5bd6e3 of _0x2357f8){await dpCreateFolder(_0x5bd6e3);}let _0x47efa5=0x0;for(const _0x34d3fe of _0x2357f8){const _0x323de3=a0_0x241418[_0x2aa8fd(0x230)](_0x34d3fe+'s');_0x47efa5+=_0x323de3[_0x2aa8fd(0x24c)];}if(window[_0x2aa8fd(0x1ff)](_0x2aa8fd(0x241)+_0x47efa5+'\x20files\x20in\x20Kabu?'))for(const _0x4f0494 of _0x2357f8){const _0x52c0b0=a0_0x241418[_0x2aa8fd(0x230)](_0x4f0494+'s');for(const _0x368e26 of _0x52c0b0){const _0x47cab6=await a0_0x241418[_0x2aa8fd(0x23a)](_0x2aa8fd(0x20c)+_0x4f0494+'s/'+_0x368e26);try{await lockNoti(_0x2aa8fd(0x218),_0x368e26,0xbb8),await dpUploadFile(_0x368e26,_0x47cab6,_0x4f0494);}catch(_0x1410ed){console[_0x2aa8fd(0x23b)](_0x2aa8fd(0x225)+_0x368e26+':',_0x1410ed);}}}else console[_0x2aa8fd(0x235)](_0x2aa8fd(0x247));}}),dropboxCloud['addEventListener'](_0x2275cd(0x215),function(){var _0x5a2ed0=_0x2275cd;const _0x48f7cf=localStorage[_0x5a2ed0(0x213)](_0x5a2ed0(0x246));_0x48f7cf===null||_0x48f7cf===''?authorizeWithDropbox():window[_0x5a2ed0(0x1ff)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem'](_0x5a2ed0(0x246),''),dropboxRestore['classList'][_0x5a2ed0(0x24f)](_0x5a2ed0(0x237)),dropboxBackup['classList'][_0x5a2ed0(0x24f)]('active'),dropboxCloud[_0x5a2ed0(0x1f7)][_0x5a2ed0(0x24f)](_0x5a2ed0(0x237)));}),handleDropboxCallback();});