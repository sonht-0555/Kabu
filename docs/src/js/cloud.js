var a0_0x3cd7bc=a0_0x2eff;(function(_0x33ad2c,_0x117fdb){var _0x3edb43=a0_0x2eff,_0x44739c=_0x33ad2c();while(!![]){try{var _0x3b9619=-parseInt(_0x3edb43(0x9f))/0x1*(-parseInt(_0x3edb43(0xa8))/0x2)+parseInt(_0x3edb43(0x90))/0x3+-parseInt(_0x3edb43(0x96))/0x4*(-parseInt(_0x3edb43(0x82))/0x5)+parseInt(_0x3edb43(0xab))/0x6+-parseInt(_0x3edb43(0xd1))/0x7*(parseInt(_0x3edb43(0x92))/0x8)+-parseInt(_0x3edb43(0xa9))/0x9*(parseInt(_0x3edb43(0x86))/0xa)+-parseInt(_0x3edb43(0x87))/0xb;if(_0x3b9619===_0x117fdb)break;else _0x44739c['push'](_0x44739c['shift']());}catch(_0x2c43f3){_0x44739c['push'](_0x44739c['shift']());}}}(a0_0x53c3,0x351b4));function a0_0x53c3(){var _0x18633f=['application/octet-stream','responseText','272414tkjFNx','292473kuuVyM','file','1152612OwETxJ','click','remove','toUpperCase','.ss5','uid','Refreshing\x20token...','active','.gba_slot','Do\x20you\x20want\x20to\x20backup\x20','Failed\x20to\x20refresh\x20Dropbox\x20token.','list','\x20files\x20in\x20Kabu?','gba','log','Bearer\x20','https://api.dropboxapi.com/oauth2/token','replace','substring','blob','downloadFileInCloud','\x20files\x20in\x20Cloud?','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','endsWith','FSSync','Do\x20you\x20want\x20to\x20restore\x20','.txt','error','open','Error\x20while\x20refreshing\x20token:','Cloud\x20login\x20required!','parse','send','.gba_dateState','Download\x20failed,\x20unknown\x20http\x20status:','status','href','Unable\x20to\x20refresh\x20token','2891JnBWQs','Restore\x20canceled\x20by\x20user.','&redirect_uri=','stringify','getItem','classList','alert','refresh_token=','/data/','overwrite','Failed\x20to\x20upload\x20file\x20','Backing\x20up...','length','knh3uz2mx2hp2eu','_imageState','json','save','code','=([^&#]*)','error_description','text/plain','access_token','.ss0','addEventListener','accessToken','search','confirm','charAt','https://content.dropboxapi.com/2/files/download','&token_access_type=','split','setItem','.ss4','535655phcfhT','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','https://api.dropbox.com/oauth2/token','Cloud\x20↦\x20Kabu\x20storage\x20◆','10EsmUcO','404437SESFUo','https://api.dropboxapi.com/2/files/list_folder','https://www.dropbox.com/oauth2/authorize?client_id=','Content-Type','lastIndexOf','.ss6','.tag','&client_secret=','entries','335853PSlgVm','[\x5c?&#]','5048ELatFL','.gba_imageState','DOMContentLoaded','&grant_type=','4YwkWBw','application/json','refreshToken','location','&client_id=','Download\x20failed,\x20unknown\x20http\x20status:\x20','slice','text','No\x20refresh\x20token','1hmanBI','authorization_code','POST','uploadSaveOrSaveState','_dateState','uId','application/x-www-form-urlencoded'];a0_0x53c3=function(){return _0x18633f;};return a0_0x53c3();}import*as a0_0x3ee844 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x3cd7bc(0x6e),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x2f227a=a0_0x3cd7bc,_0x313f4d=window[_0x2f227a(0x99)]['href'][_0x2f227a(0x7f)]('?')[0x0],_0x408005=_0x2f227a(0x72),_0x4bd074='offline',_0x4cdf0e=_0x2f227a(0x89)+clientId+'&response_type='+_0x408005+_0x2f227a(0x7e)+_0x4bd074+_0x2f227a(0xd3)+encodeURIComponent(_0x313f4d);window[_0x2f227a(0x99)][_0x2f227a(0xcf)]=_0x4cdf0e;}function handleDropboxCallback(){var _0x1891e7=a0_0x3cd7bc,_0x10f34e=getUrlParameter(_0x1891e7(0x72));_0x10f34e?(getAccessToken(_0x10f34e),console[_0x1891e7(0xb9)]('Authorization\x20Code:',_0x10f34e)):console[_0x1891e7(0xb9)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x38f9be){var _0x5a1cd9=a0_0x3cd7bc;_0x38f9be=_0x38f9be['replace'](/[\[]/,'\x5c[')[_0x5a1cd9(0xbc)](/[\]]/,'\x5c]');var _0x161aaf=new RegExp(_0x5a1cd9(0x91)+_0x38f9be+_0x5a1cd9(0x73)),_0x325d54=_0x161aaf['exec'](location[_0x5a1cd9(0x7a)]);return _0x325d54===null?'':decodeURIComponent(_0x325d54[0x1][_0x5a1cd9(0xbc)](/\+/g,'\x20'));}function getAccessToken(_0x44a2c9){var _0x23ea94=a0_0x3cd7bc,_0x3e4cfd=_0x23ea94(0xa0),_0x1d8867=window[_0x23ea94(0x99)][_0x23ea94(0xcf)]['split']('?')[0x0],_0x4a08c3=new XMLHttpRequest();_0x4a08c3[_0x23ea94(0xc7)](_0x23ea94(0xa1),_0x23ea94(0x84)),_0x4a08c3['setRequestHeader'](_0x23ea94(0x8a),_0x23ea94(0xa5)),_0x4a08c3['onload']=function(){var _0x31b0ec=_0x23ea94;if(_0x4a08c3[_0x31b0ec(0xce)]===0xc8){var _0x56d973=JSON[_0x31b0ec(0xca)](_0x4a08c3[_0x31b0ec(0xa7)]),_0x4976a7=_0x56d973[_0x31b0ec(0x76)],_0x5b967a=_0x56d973['refresh_token'],_0x15626b=_0x56d973[_0x31b0ec(0xb0)];localStorage['setItem']('accessToken',_0x4976a7),localStorage['setItem'](_0x31b0ec(0x98),_0x5b967a),localStorage[_0x31b0ec(0x80)](_0x31b0ec(0xa4),_0x15626b);}else console[_0x31b0ec(0xb9)](_0x31b0ec(0xc1));},_0x4a08c3[_0x23ea94(0xcb)]('code='+_0x44a2c9+_0x23ea94(0x95)+_0x3e4cfd+_0x23ea94(0x9a)+clientId+_0x23ea94(0x8e)+clientSecret+_0x23ea94(0xd3)+encodeURIComponent(_0x1d8867));}export async function dpRefreshToken(){var _0x299c79=a0_0x3cd7bc;if(!localStorage['getItem'](_0x299c79(0x98)))throw _0x299c79(0x9e);try{const _0x14de6d=await fetch(_0x299c79(0xbb),{'method':_0x299c79(0xa1),'headers':{'Content-Type':_0x299c79(0xa5)},'body':_0x299c79(0x68)+localStorage[_0x299c79(0x65)]('refreshToken')+_0x299c79(0x83)}),_0x3fb1af=await _0x14de6d[_0x299c79(0x70)]();if(!_0x3fb1af['error'])return localStorage[_0x299c79(0x80)](_0x299c79(0x79),_0x3fb1af[_0x299c79(0x76)]),await lockNoti('',_0x299c79(0xb1),0xbb8),await delay(0x3e8),!![];else alert(_0x3fb1af[_0x299c79(0x74)]||_0x299c79(0xb5));}catch(_0x166834){console[_0x299c79(0xc6)](_0x299c79(0xc8),_0x166834);}return![];}export async function dpUploadFile(_0x2b5b15,_0x1fe6d3){var _0x518003=a0_0x3cd7bc;const _0xba9b9b=localStorage['getItem'](_0x518003(0xa4));var _0x48a5ac=JSON[_0x518003(0x64)]({'autorename':!![],'mode':_0x518003(0x6a),'mute':!![],'strict_conflict':![],'path':'/'+_0xba9b9b+'/'+_0x2b5b15}),_0x38188a=new Blob([_0x1fe6d3],{'type':_0x518003(0xa6)});for(var _0x54e286=0x0;_0x54e286<0x2;_0x54e286++){var _0x416e7a=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x518003(0xa1),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x518003(0x65)]('accessToken'),'Dropbox-API-Arg':_0x48a5ac,'Content-Type':_0x518003(0xa6)},'body':_0x38188a});if(_0x416e7a[_0x518003(0xce)]!=0xc8){if(_0x416e7a['status']==0x191){var _0x33ef18=await dpRefreshToken();if(!_0x33ef18)throw _0x518003(0xd0);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x416e7a[_0x518003(0xce)];}else{var _0x5b2e9e=await _0x416e7a[_0x518003(0x70)]();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x2b5b15),_0x5b2e9e;}}return![];}function a0_0x2eff(_0x39d191,_0x91fa05){var _0x53c385=a0_0x53c3();return a0_0x2eff=function(_0x2effa5,_0x274ba4){_0x2effa5=_0x2effa5-0x64;var _0x4ea804=_0x53c385[_0x2effa5];return _0x4ea804;},a0_0x2eff(_0x39d191,_0x91fa05);}async function dpDownloadFile(_0x552c4f){var _0x318ef6=a0_0x3cd7bc;const _0x2458bc=localStorage['getItem'](_0x318ef6(0xa4));var _0x311020=JSON[_0x318ef6(0x64)]({'path':'/'+_0x2458bc+'/'+_0x552c4f});for(var _0x3d6532=0x0;_0x3d6532<0x2;_0x3d6532++){var _0x42adb7=await fetch(_0x318ef6(0x7d),{'method':_0x318ef6(0xa1),'headers':{'Authorization':_0x318ef6(0xba)+localStorage['getItem'](_0x318ef6(0x79)),'Dropbox-API-Arg':_0x311020}});if(_0x42adb7[_0x318ef6(0xce)]!=0xc8){if(_0x42adb7[_0x318ef6(0xce)]==0x191){var _0x33cd76=await dpRefreshToken();if(!_0x33cd76)throw _0x318ef6(0xd0);continue;}else throw _0x318ef6(0xcd)+_0x42adb7['status'];}const _0x49de70=new File([await _0x42adb7[_0x318ef6(0xbe)]()],_0x552c4f);console[_0x318ef6(0xb9)](_0x318ef6(0x85),_0x49de70['name']);if(_0x552c4f[_0x318ef6(0xc2)](_0x318ef6(0xc5))){const _0xd528bb=await _0x49de70[_0x318ef6(0x9d)](),[_0x45f131,_0xeb0af6]=_0xd528bb[_0x318ef6(0x7f)]('\x0a\x0a'),_0x560d2b=_0x552c4f[_0x318ef6(0xbd)](0x0,_0x552c4f[_0x318ef6(0x8b)](_0x318ef6(0xb8))+0x3),_0x500587=_0x552c4f[_0x318ef6(0x7c)](_0x552c4f['length']-0x5);localStorage[_0x318ef6(0x80)](_0x560d2b+_0x318ef6(0xa3)+_0x500587,_0xeb0af6),localStorage[_0x318ef6(0x80)](_0x560d2b+_0x318ef6(0x6f)+_0x500587,_0x45f131);}else a0_0x3ee844[_0x318ef6(0xa2)](_0x49de70,()=>{var _0x5e25b4=_0x318ef6;localStorageFile(),Module[_0x5e25b4(0xc3)]();});return _0x49de70;}return![];}document[a0_0x3cd7bc(0x78)](a0_0x3cd7bc(0x94),function(){var _0x54357c=a0_0x3cd7bc;dropboxRestore[_0x54357c(0x78)](_0x54357c(0xac),async function(){var _0x528d82=_0x54357c;const _0x4d3d40=localStorage['getItem'](_0x528d82(0xa4));if(_0x4d3d40===null||_0x4d3d40==='')window[_0x528d82(0x67)](_0x528d82(0xc9));else{var _0x3da694={'path':'/'+_0x4d3d40};for(var _0x3d0eee=0x0;_0x3d0eee<0x2;_0x3d0eee++){var _0x46fef3=await fetch(_0x528d82(0x88),{'method':_0x528d82(0xa1),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x528d82(0x65)](_0x528d82(0x79)),'Content-Type':_0x528d82(0x97)},'body':JSON[_0x528d82(0x64)](_0x3da694)});console[_0x528d82(0xb9)]('status:\x20',_0x46fef3[_0x528d82(0xce)]);if(_0x46fef3['status']!=0xc8){if(_0x46fef3['status']==0x191){var _0x55e656=await dpRefreshToken();if(!_0x55e656)throw _0x528d82(0xd0);continue;}else throw _0x528d82(0x9b)+_0x46fef3[_0x528d82(0xce)];}else{const _0x333cb9=await _0x46fef3[_0x528d82(0x70)](),_0x3ea731=_0x333cb9[_0x528d82(0x8f)]['filter'](_0x27adf7=>_0x27adf7[_0x528d82(0x8d)]===_0x528d82(0xaa))[_0x528d82(0x6d)],_0x28bccc=_0x528d82(0xc4)+_0x3ea731+_0x528d82(0xc0);if(window[_0x528d82(0x7b)](_0x28bccc))for(const _0x3f050a of _0x333cb9[_0x528d82(0x8f)]){_0x3f050a['.tag']==='file'&&(await lockNoti('Restoring...',_0x3f050a['name'],0xbb8),await dpDownloadFile(_0x3f050a['name']));}else console['log'](_0x528d82(0xd2));return!![];}}return![];}}),dropboxBackup[_0x54357c(0x78)](_0x54357c(0xac),async function(){var _0x12d158=_0x54357c;const _0x4f48aa=localStorage[_0x12d158(0x65)](_0x12d158(0xa4));if(_0x4f48aa===null||_0x4f48aa==='')window[_0x12d158(0x67)](_0x12d158(0xc9));else{const _0x1021a2=['state',_0x12d158(0x71)];let _0x1c2ae4=0x0;for(const _0x1e3733 of _0x1021a2){const _0x379d30=a0_0x3ee844[_0x12d158(0xb6)+(_0x1e3733[_0x12d158(0x7c)](0x0)[_0x12d158(0xae)]()+_0x1e3733[_0x12d158(0x9c)](0x1))]();_0x1c2ae4+=_0x379d30[_0x12d158(0x6d)];}if(window[_0x12d158(0x7b)](_0x12d158(0xb4)+_0x1c2ae4+_0x12d158(0xb7)))for(const _0x4cfb32 of _0x1021a2){const _0x268869=a0_0x3ee844['list'+(_0x4cfb32[_0x12d158(0x7c)](0x0)[_0x12d158(0xae)]()+_0x4cfb32[_0x12d158(0x9c)](0x1))]();for(const _0x2c8d83 of _0x268869){const _0x461fcf=await a0_0x3ee844[_0x12d158(0xbf)](_0x12d158(0x69)+_0x4cfb32+'s/'+_0x2c8d83);try{await lockNoti(_0x12d158(0x6c),_0x2c8d83,0xbb8),await dpUploadFile(_0x2c8d83,_0x461fcf);if(_0x2c8d83['endsWith'](_0x12d158(0x77))||_0x2c8d83['endsWith']('.ss1')||_0x2c8d83['endsWith']('.ss2')||_0x2c8d83['endsWith']('.ss3')||_0x2c8d83[_0x12d158(0xc2)](_0x12d158(0x81))||_0x2c8d83['endsWith'](_0x12d158(0xaf))||_0x2c8d83[_0x12d158(0xc2)](_0x12d158(0x8c))||_0x2c8d83[_0x12d158(0xc2)]('.ss7')){const _0x4c97ea=_0x2c8d83[_0x12d158(0xbd)](0x0,_0x2c8d83[_0x12d158(0x8b)]('.')),_0x2dbe08=_0x2c8d83[_0x12d158(0x7c)](_0x2c8d83[_0x12d158(0x6d)]-0x1),_0x562000=localStorage['getItem'](_0x4c97ea+_0x12d158(0x93)+_0x2dbe08),_0x39c5b9=localStorage[_0x12d158(0x65)](_0x4c97ea+_0x12d158(0xcc)+_0x2dbe08);if(_0x562000!==null){const _0x3130eb=_0x562000+'\x0a\x0a'+_0x39c5b9,_0x392cba=new Blob([_0x3130eb],{'type':_0x12d158(0x75)});await lockNoti('Backing\x20up...',_0x4c97ea+_0x12d158(0xb3)+_0x2dbe08+'.txt',0xbb8),await dpUploadFile(_0x4c97ea+_0x12d158(0xb3)+_0x2dbe08+_0x12d158(0xc5),_0x392cba);}}}catch(_0x22e5eb){console[_0x12d158(0xc6)](_0x12d158(0x6b)+_0x2c8d83+':',_0x22e5eb);}}}else console[_0x12d158(0xb9)](_0x12d158(0xd2));}}),dropboxCloud[_0x54357c(0x78)](_0x54357c(0xac),function(){var _0x128a07=_0x54357c;const _0x3f0708=localStorage['getItem'](_0x128a07(0xa4));_0x3f0708===null||_0x3f0708===''?authorizeWithDropbox():window[_0x128a07(0x7b)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x128a07(0x80)]('uId',''),dropboxRestore['classList'][_0x128a07(0xad)]('active'),dropboxBackup[_0x128a07(0x66)][_0x128a07(0xad)](_0x128a07(0xb2)),dropboxCloud['classList'][_0x128a07(0xad)](_0x128a07(0xb2)));}),handleDropboxCallback();});