var a0_0x693f6b=a0_0x116c;(function(_0x336ef4,_0x4cd7e3){var _0x533f8b=a0_0x116c,_0x5c44af=_0x336ef4();while(!![]){try{var _0xea1d45=-parseInt(_0x533f8b(0xa2))/0x1+parseInt(_0x533f8b(0xbf))/0x2*(-parseInt(_0x533f8b(0xba))/0x3)+-parseInt(_0x533f8b(0xd1))/0x4+-parseInt(_0x533f8b(0xd7))/0x5*(parseInt(_0x533f8b(0x108))/0x6)+parseInt(_0x533f8b(0x100))/0x7*(parseInt(_0x533f8b(0xee))/0x8)+parseInt(_0x533f8b(0xfa))/0x9*(parseInt(_0x533f8b(0x109))/0xa)+parseInt(_0x533f8b(0xd9))/0xb;if(_0xea1d45===_0x4cd7e3)break;else _0x5c44af['push'](_0x5c44af['shift']());}catch(_0x4dd562){_0x5c44af['push'](_0x5c44af['shift']());}}}(a0_0x1886,0xa5803));import*as a0_0x48c991 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x693f6b(0xae);function authorizeWithDropbox(){var _0x249e07=a0_0x693f6b,_0x5056b7=window[_0x249e07(0xaa)]['href'][_0x249e07(0xce)]('?')[0x0],_0x337873=_0x249e07(0xd8),_0xcd55a3=_0x249e07(0xa7),_0x3936ae=_0x249e07(0xe7)+clientId+_0x249e07(0x10c)+_0x337873+_0x249e07(0xd3)+_0xcd55a3+_0x249e07(0x103)+encodeURIComponent(_0x5056b7);window[_0x249e07(0xaa)][_0x249e07(0xa3)]=_0x3936ae;}function handleDropboxCallback(){var _0x56c72d=a0_0x693f6b,_0x2a9d2e=getUrlParameter(_0x56c72d(0xd8));_0x2a9d2e?(getAccessToken(_0x2a9d2e),console[_0x56c72d(0xb5)](_0x56c72d(0xef),_0x2a9d2e)):console[_0x56c72d(0xb5)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x7206f8){var _0xa394ac=a0_0x693f6b;_0x7206f8=_0x7206f8[_0xa394ac(0x111)](/[\[]/,'\x5c[')[_0xa394ac(0x111)](/[\]]/,'\x5c]');var _0x4f65e4=new RegExp(_0xa394ac(0xad)+_0x7206f8+_0xa394ac(0xd5)),_0x5903e3=_0x4f65e4[_0xa394ac(0xe4)](location[_0xa394ac(0xfb)]);return _0x5903e3===null?'':decodeURIComponent(_0x5903e3[0x1][_0xa394ac(0x111)](/\+/g,'\x20'));}function a0_0x1886(){var _0x16c9ce=['2084109VfDICM','Upload\x20failed,\x20unknown\x20http\x20status:\x20','Content-Type','active','.gba_imageState','2NxYDzc','&client_secret=','parse','state','.ss4','charAt','toUpperCase','Do\x20you\x20want\x20to\x20logout?','https://api.dropbox.com/oauth2/token','gba','Do\x20you\x20want\x20to\x20restore\x20','_imageState','Cloud\x20login\x20required!','uploadSaveOrSaveState','slice','split','Kabu\x20storage\x20↦\x20Cloud\x20◆','.ss7','2079100aOCUqj','substring','&token_access_type=','\x20files\x20in\x20Kabu?','=([^&#]*)','classList','6220205AcxQAf','code','27844432uFbLcu','endsWith','&client_id=','Do\x20you\x20want\x20to\x20backup\x20','.ss2','code=','setRequestHeader','Unable\x20to\x20refresh\x20token','file','.tag','blob','exec','overwrite','addEventListener','https://www.dropbox.com/oauth2/authorize?client_id=','No\x20refresh\x20token','status:\x20','.gba_slot','Cloud\x20↦\x20Kabu\x20storage\x20◆','confirm','application/json','9736XGQkzj','Authorization\x20Code:','refreshToken','POST','click','save','error_description','text/plain','send','Download\x20failed,\x20unknown\x20http\x20status:','filter','DOMContentLoaded','12069NbIrak','search','lastIndexOf','.txt','entries','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','5810hKVqAO','status','/data/','&redirect_uri=','remove','name','access_token','Failed\x20to\x20upload\x20file\x20','6XXlfRu','990KiqyOw','\x20files\x20in\x20Cloud?','Bearer\x20','&response_type=','list','Restore\x20canceled\x20by\x20user.','length','open','replace','uid','error','https://content.dropboxapi.com/2/files/upload','responseText','537771cqZdpG','href','json','stringify','.gba_dateState','offline','application/x-www-form-urlencoded','text','location','https://content.dropboxapi.com/2/files/download','getItem','[\x5c?&#]','nwb3dnfh09rhs31','FSSync','uId','.ss6','setItem','.ss3','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','log','accessToken','Download\x20failed,\x20unknown\x20http\x20status:\x20','.ss1','Backing\x20up...'];a0_0x1886=function(){return _0x16c9ce;};return a0_0x1886();}function getAccessToken(_0x4240e1){var _0x596894=a0_0x693f6b,_0x2bd1f7='authorization_code',_0x736422=window[_0x596894(0xaa)][_0x596894(0xa3)][_0x596894(0xce)]('?')[0x0],_0x21b28b=new XMLHttpRequest();_0x21b28b[_0x596894(0x110)]('POST',_0x596894(0xc7)),_0x21b28b[_0x596894(0xdf)](_0x596894(0xbc),_0x596894(0xa8)),_0x21b28b['onload']=function(){var _0x147a27=_0x596894;if(_0x21b28b['status']===0xc8){var _0x3d4544=JSON[_0x147a27(0xc1)](_0x21b28b[_0x147a27(0xa1)]),_0x5bae89=_0x3d4544[_0x147a27(0x106)],_0x150eb6=_0x3d4544['refresh_token'],_0x2ae82d=_0x3d4544[_0x147a27(0x112)];localStorage[_0x147a27(0xb2)](_0x147a27(0xb6),_0x5bae89),localStorage[_0x147a27(0xb2)](_0x147a27(0xf0),_0x150eb6),localStorage['setItem'](_0x147a27(0xb0),_0x2ae82d);}else console[_0x147a27(0xb5)](_0x147a27(0xff));},_0x21b28b[_0x596894(0xf6)](_0x596894(0xde)+_0x4240e1+'&grant_type='+_0x2bd1f7+_0x596894(0xdb)+clientId+_0x596894(0xc0)+clientSecret+_0x596894(0x103)+encodeURIComponent(_0x736422));}function a0_0x116c(_0x2f8a0c,_0x3e0769){var _0x1886b1=a0_0x1886();return a0_0x116c=function(_0x116c9d,_0x23e641){_0x116c9d=_0x116c9d-0x9f;var _0x456c31=_0x1886b1[_0x116c9d];return _0x456c31;},a0_0x116c(_0x2f8a0c,_0x3e0769);}export async function dpRefreshToken(){var _0x3ed33f=a0_0x693f6b;if(!localStorage[_0x3ed33f(0xac)](_0x3ed33f(0xf0)))throw _0x3ed33f(0xe8);try{const _0x296d9e=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x3ed33f(0xf1),'headers':{'Content-Type':_0x3ed33f(0xa8)},'body':'refresh_token='+localStorage[_0x3ed33f(0xac)](_0x3ed33f(0xf0))+_0x3ed33f(0xb4)}),_0x351cb2=await _0x296d9e['json']();if(!_0x351cb2[_0x3ed33f(0x9f)])return localStorage[_0x3ed33f(0xb2)](_0x3ed33f(0xb6),_0x351cb2[_0x3ed33f(0x106)]),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0x351cb2[_0x3ed33f(0xf4)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0xc65049){console[_0x3ed33f(0x9f)]('Error\x20while\x20refreshing\x20token:',_0xc65049);}return![];}export async function dpUploadFile(_0x19adcd,_0x890034){var _0x86ad94=a0_0x693f6b;const _0x3524d5=localStorage[_0x86ad94(0xac)](_0x86ad94(0xb0));var _0xe1df6a=JSON[_0x86ad94(0xa5)]({'autorename':!![],'mode':_0x86ad94(0xe5),'mute':!![],'strict_conflict':![],'path':'/'+_0x3524d5+'/'+_0x19adcd}),_0x2f11ed=new Blob([_0x890034],{'type':'application/octet-stream'});for(var _0x5f023e=0x0;_0x5f023e<0x2;_0x5f023e++){var _0x1f7213=await fetch(_0x86ad94(0xa0),{'method':_0x86ad94(0xf1),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x86ad94(0xb6)),'Dropbox-API-Arg':_0xe1df6a,'Content-Type':'application/octet-stream'},'body':_0x2f11ed});if(_0x1f7213[_0x86ad94(0x101)]!=0xc8){if(_0x1f7213[_0x86ad94(0x101)]==0x191){var _0x1be068=await dpRefreshToken();if(!_0x1be068)throw _0x86ad94(0xe0);continue;}else throw _0x86ad94(0xbb)+_0x1f7213['status'];}else{var _0x18e73e=await _0x1f7213[_0x86ad94(0xa4)]();return console['log'](_0x86ad94(0xcf),_0x19adcd),_0x18e73e;}}return![];}async function dpDownloadFile(_0x3627a3){var _0x3837d0=a0_0x693f6b;const _0x3e0eb5=localStorage[_0x3837d0(0xac)](_0x3837d0(0xb0));var _0x450037=JSON['stringify']({'path':'/'+_0x3e0eb5+'/'+_0x3627a3});for(var _0x4f6b0d=0x0;_0x4f6b0d<0x2;_0x4f6b0d++){var _0x354009=await fetch(_0x3837d0(0xab),{'method':_0x3837d0(0xf1),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x3837d0(0xb6)),'Dropbox-API-Arg':_0x450037}});if(_0x354009[_0x3837d0(0x101)]!=0xc8){if(_0x354009[_0x3837d0(0x101)]==0x191){var _0x4ce6be=await dpRefreshToken();if(!_0x4ce6be)throw _0x3837d0(0xe0);continue;}else throw _0x3837d0(0xf7)+_0x354009['status'];}const _0xd0e73e=new File([await _0x354009[_0x3837d0(0xe3)]()],_0x3627a3);console['log'](_0x3837d0(0xeb),_0xd0e73e[_0x3837d0(0x105)]);if(_0x3627a3[_0x3837d0(0xda)](_0x3837d0(0xfd))){const _0x17ebbe=await _0xd0e73e[_0x3837d0(0xa9)](),[_0x2c83b8,_0x15b315]=_0x17ebbe['split']('\x0a\x0a'),_0x37355f=_0x3627a3[_0x3837d0(0xd2)](0x0,_0x3627a3[_0x3837d0(0xfc)](_0x3837d0(0xc8))+0x3),_0x5dad6e=_0x3627a3[_0x3837d0(0xc4)](_0x3627a3[_0x3837d0(0x10f)]-0x5);localStorage['setItem'](_0x37355f+'_dateState'+_0x5dad6e,_0x15b315),localStorage[_0x3837d0(0xb2)](_0x37355f+_0x3837d0(0xca)+_0x5dad6e,_0x2c83b8);}else a0_0x48c991[_0x3837d0(0xcc)](_0xd0e73e,()=>{var _0xb1b940=_0x3837d0;localStorageFile(),Module[_0xb1b940(0xaf)]();});return _0xd0e73e;}return![];}document[a0_0x693f6b(0xe6)](a0_0x693f6b(0xf9),function(){var _0x504d3a=a0_0x693f6b;dropboxRestore['addEventListener'](_0x504d3a(0xf2),async function(){var _0xe7db1b=_0x504d3a;const _0x217fce=localStorage[_0xe7db1b(0xac)](_0xe7db1b(0xb0));if(_0x217fce===null||_0x217fce==='')window['alert'](_0xe7db1b(0xcb));else{var _0x5bc9ec={'path':'/'+_0x217fce};for(var _0x5a0016=0x0;_0x5a0016<0x2;_0x5a0016++){var _0x1599ac=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':'POST','headers':{'Authorization':_0xe7db1b(0x10b)+localStorage[_0xe7db1b(0xac)](_0xe7db1b(0xb6)),'Content-Type':_0xe7db1b(0xed)},'body':JSON['stringify'](_0x5bc9ec)});console[_0xe7db1b(0xb5)](_0xe7db1b(0xe9),_0x1599ac['status']);if(_0x1599ac[_0xe7db1b(0x101)]!=0xc8){if(_0x1599ac['status']==0x191){var _0x409db5=await dpRefreshToken();if(!_0x409db5)throw _0xe7db1b(0xe0);continue;}else throw _0xe7db1b(0xb7)+_0x1599ac[_0xe7db1b(0x101)];}else{const _0x19b94c=await _0x1599ac[_0xe7db1b(0xa4)](),_0x1e84a4=_0x19b94c[_0xe7db1b(0xfe)][_0xe7db1b(0xf8)](_0x3bc273=>_0x3bc273[_0xe7db1b(0xe2)]==='file')['length'],_0x47f679=_0xe7db1b(0xc9)+_0x1e84a4+_0xe7db1b(0x10a);if(window[_0xe7db1b(0xec)](_0x47f679))for(const _0x3f4006 of _0x19b94c[_0xe7db1b(0xfe)]){_0x3f4006['.tag']===_0xe7db1b(0xe1)&&(await lockNoti('Restoring...',_0x3f4006[_0xe7db1b(0x105)],0xbb8),await dpDownloadFile(_0x3f4006['name']));}else console[_0xe7db1b(0xb5)](_0xe7db1b(0x10e));return!![];}}return![];}}),dropboxBackup[_0x504d3a(0xe6)]('click',async function(){var _0x5d5168=_0x504d3a;const _0xaa9c3=localStorage['getItem']('uId');if(_0xaa9c3===null||_0xaa9c3==='')window['alert'](_0x5d5168(0xcb));else{const _0x5e7121=[_0x5d5168(0xc2),_0x5d5168(0xf3)];let _0x5bc684=0x0;for(const _0x50fcf7 of _0x5e7121){const _0x2e5989=a0_0x48c991[_0x5d5168(0x10d)+(_0x50fcf7[_0x5d5168(0xc4)](0x0)[_0x5d5168(0xc5)]()+_0x50fcf7[_0x5d5168(0xcd)](0x1))]();_0x5bc684+=_0x2e5989[_0x5d5168(0x10f)];}if(window[_0x5d5168(0xec)](_0x5d5168(0xdc)+_0x5bc684+_0x5d5168(0xd4)))for(const _0x2062b6 of _0x5e7121){const _0x31d29c=a0_0x48c991[_0x5d5168(0x10d)+(_0x2062b6[_0x5d5168(0xc4)](0x0)[_0x5d5168(0xc5)]()+_0x2062b6[_0x5d5168(0xcd)](0x1))]();for(const _0x1243c4 of _0x31d29c){const _0xf09220=await a0_0x48c991['downloadFileInCloud'](_0x5d5168(0x102)+_0x2062b6+'s/'+_0x1243c4);try{await lockNoti(_0x5d5168(0xb9),_0x1243c4,0xbb8),await dpUploadFile(_0x1243c4,_0xf09220);if(_0x1243c4[_0x5d5168(0xda)]('.ss0')||_0x1243c4[_0x5d5168(0xda)](_0x5d5168(0xb8))||_0x1243c4[_0x5d5168(0xda)](_0x5d5168(0xdd))||_0x1243c4['endsWith'](_0x5d5168(0xb3))||_0x1243c4['endsWith'](_0x5d5168(0xc3))||_0x1243c4[_0x5d5168(0xda)]('.ss5')||_0x1243c4['endsWith'](_0x5d5168(0xb1))||_0x1243c4[_0x5d5168(0xda)](_0x5d5168(0xd0))){const _0x139b3e=_0x1243c4[_0x5d5168(0xd2)](0x0,_0x1243c4[_0x5d5168(0xfc)]('.')),_0x95c793=_0x1243c4[_0x5d5168(0xc4)](_0x1243c4[_0x5d5168(0x10f)]-0x1),_0x2f7d5c=localStorage[_0x5d5168(0xac)](_0x139b3e+_0x5d5168(0xbe)+_0x95c793),_0x420ece=localStorage[_0x5d5168(0xac)](_0x139b3e+_0x5d5168(0xa6)+_0x95c793);if(_0x2f7d5c!==null){const _0x342f58=_0x2f7d5c+'\x0a\x0a'+_0x420ece,_0x396e20=new Blob([_0x342f58],{'type':_0x5d5168(0xf5)});await lockNoti(_0x5d5168(0xb9),_0x139b3e+'.gba_slot'+_0x95c793+_0x5d5168(0xfd),0xbb8),await dpUploadFile(_0x139b3e+_0x5d5168(0xea)+_0x95c793+'.txt',_0x396e20);}}}catch(_0x1ea63d){console[_0x5d5168(0x9f)](_0x5d5168(0x107)+_0x1243c4+':',_0x1ea63d);}}}else console[_0x5d5168(0xb5)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x504d3a(0xe6)](_0x504d3a(0xf2),function(){var _0x37151d=_0x504d3a;const _0x5638e8=localStorage[_0x37151d(0xac)]('uId');_0x5638e8===null||_0x5638e8===''?authorizeWithDropbox():window[_0x37151d(0xec)](_0x37151d(0xc6))&&(localStorage['setItem'](_0x37151d(0xb0),''),dropboxRestore[_0x37151d(0xd6)]['remove']('active'),dropboxBackup[_0x37151d(0xd6)]['remove'](_0x37151d(0xbd)),dropboxCloud[_0x37151d(0xd6)][_0x37151d(0x104)](_0x37151d(0xbd)));}),handleDropboxCallback();});