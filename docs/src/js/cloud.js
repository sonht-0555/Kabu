var a0_0x220a4b=a0_0x617d;(function(_0x33fa88,_0x3b9f22){var _0x3ccceb=a0_0x617d,_0x1bccfa=_0x33fa88();while(!![]){try{var _0x22f701=parseInt(_0x3ccceb(0x1ac))/0x1+-parseInt(_0x3ccceb(0x19b))/0x2*(parseInt(_0x3ccceb(0x1a7))/0x3)+parseInt(_0x3ccceb(0x147))/0x4*(parseInt(_0x3ccceb(0x181))/0x5)+parseInt(_0x3ccceb(0x19c))/0x6+-parseInt(_0x3ccceb(0x192))/0x7+-parseInt(_0x3ccceb(0x15f))/0x8+parseInt(_0x3ccceb(0x1b2))/0x9;if(_0x22f701===_0x3b9f22)break;else _0x1bccfa['push'](_0x1bccfa['shift']());}catch(_0x4d3f03){_0x1bccfa['push'](_0x1bccfa['shift']());}}}(a0_0xf122,0x1932e));import*as a0_0xb70e18 from'./main.js';import{localStorageFile}from'./storage.js';function a0_0x617d(_0x5305f0,_0x381262){var _0xf1227f=a0_0xf122();return a0_0x617d=function(_0x617d03,_0x369841){_0x617d03=_0x617d03-0x147;var _0x531da4=_0xf1227f[_0x617d03];return _0x531da4;},a0_0x617d(_0x5305f0,_0x381262);}var clientId='knh3uz2mx2hp2eu',clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x4c28b9=a0_0x617d,_0x594060=window['location'][_0x4c28b9(0x14d)][_0x4c28b9(0x174)]('?')[0x0],_0x1739dc='code',_0x52d92a='offline',_0x580425=_0x4c28b9(0x191)+clientId+_0x4c28b9(0x168)+_0x1739dc+_0x4c28b9(0x163)+_0x52d92a+'&redirect_uri='+encodeURIComponent(_0x594060);window[_0x4c28b9(0x15d)]['href']=_0x580425;}function handleDropboxCallback(){var _0xb2f6d4=a0_0x617d,_0x3f63f5=getUrlParameter(_0xb2f6d4(0x1a1));_0x3f63f5?(getAccessToken(_0x3f63f5),console[_0xb2f6d4(0x177)](_0xb2f6d4(0x1af),_0x3f63f5)):console[_0xb2f6d4(0x177)](_0xb2f6d4(0x16c));}function getUrlParameter(_0x1fcd20){var _0x3b2db7=a0_0x617d;_0x1fcd20=_0x1fcd20[_0x3b2db7(0x1a9)](/[\[]/,'\x5c[')[_0x3b2db7(0x1a9)](/[\]]/,'\x5c]');var _0x49acdf=new RegExp('[\x5c?&#]'+_0x1fcd20+'=([^&#]*)'),_0x3fb112=_0x49acdf[_0x3b2db7(0x18d)](location[_0x3b2db7(0x176)]);return _0x3fb112===null?'':decodeURIComponent(_0x3fb112[0x1][_0x3b2db7(0x1a9)](/\+/g,'\x20'));}function getAccessToken(_0x3f0ff7){var _0x483b05=a0_0x617d,_0x2805a4=_0x483b05(0x19f),_0x1d0b58=window['location'][_0x483b05(0x14d)][_0x483b05(0x174)]('?')[0x0],_0x62ad20=new XMLHttpRequest();_0x62ad20[_0x483b05(0x185)]('POST',_0x483b05(0x18f)),_0x62ad20[_0x483b05(0x17f)](_0x483b05(0x16f),'application/x-www-form-urlencoded'),_0x62ad20['onload']=function(){var _0x34adad=_0x483b05;if(_0x62ad20[_0x34adad(0x19e)]===0xc8){var _0x118e63=JSON[_0x34adad(0x19d)](_0x62ad20[_0x34adad(0x190)]),_0x91d7cd=_0x118e63[_0x34adad(0x166)],_0x2934a5=_0x118e63['refresh_token'],_0x4546bd=_0x118e63[_0x34adad(0x16e)];localStorage[_0x34adad(0x148)]('accessToken',_0x91d7cd),localStorage[_0x34adad(0x148)]('refreshToken',_0x2934a5),localStorage[_0x34adad(0x148)](_0x34adad(0x1a3),_0x4546bd);}else console[_0x34adad(0x177)](_0x34adad(0x1a4));},_0x62ad20[_0x483b05(0x14e)](_0x483b05(0x1b4)+_0x3f0ff7+'&grant_type='+_0x2805a4+_0x483b05(0x189)+clientId+_0x483b05(0x164)+clientSecret+_0x483b05(0x187)+encodeURIComponent(_0x1d0b58));}export async function dpRefreshToken(){var _0x16816f=a0_0x617d;if(!localStorage[_0x16816f(0x18e)](_0x16816f(0x1a0)))throw _0x16816f(0x18c);try{const _0x11d72f=await fetch(_0x16816f(0x194),{'method':_0x16816f(0x14b),'headers':{'Content-Type':_0x16816f(0x182)},'body':_0x16816f(0x14c)+localStorage[_0x16816f(0x18e)](_0x16816f(0x1a0))+_0x16816f(0x1a8)}),_0x5914cd=await _0x11d72f['json']();if(!_0x5914cd['error'])return localStorage[_0x16816f(0x148)]('accessToken',_0x5914cd[_0x16816f(0x166)]),await lockNoti('',_0x16816f(0x186),0xbb8),await delay(0x3e8),!![];else alert(_0x5914cd[_0x16816f(0x159)]||_0x16816f(0x195));}catch(_0x493c90){console[_0x16816f(0x180)](_0x16816f(0x17c),_0x493c90);}return![];}export async function dpUploadFile(_0x57852c,_0x47a39c){var _0x4e72b0=a0_0x617d;const _0x10c7bc=localStorage['getItem'](_0x4e72b0(0x1a3));var _0x1ef5a0=JSON['stringify']({'autorename':!![],'mode':_0x4e72b0(0x14a),'mute':!![],'strict_conflict':![],'path':'/'+_0x10c7bc+'/'+_0x57852c}),_0x57560b=new Blob([_0x47a39c],{'type':_0x4e72b0(0x155)});for(var _0x448243=0x0;_0x448243<0x2;_0x448243++){var _0x48f08f=await fetch(_0x4e72b0(0x172),{'method':'POST','headers':{'Authorization':_0x4e72b0(0x154)+localStorage['getItem'](_0x4e72b0(0x162)),'Dropbox-API-Arg':_0x1ef5a0,'Content-Type':'application/octet-stream'},'body':_0x57560b});if(_0x48f08f[_0x4e72b0(0x19e)]!=0xc8){if(_0x48f08f['status']==0x191){var _0x36c316=await dpRefreshToken();if(!_0x36c316)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x4e72b0(0x175)+_0x48f08f[_0x4e72b0(0x19e)];}else{var _0x18af2e=await _0x48f08f['json']();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x57852c),_0x18af2e;}}return![];}async function dpDownloadFile(_0x60a481){var _0x7884b=a0_0x617d;const _0x41a275=localStorage[_0x7884b(0x18e)](_0x7884b(0x1a3));var _0x691320=JSON[_0x7884b(0x1ab)]({'path':'/'+_0x41a275+'/'+_0x60a481});for(var _0x1f55f1=0x0;_0x1f55f1<0x2;_0x1f55f1++){var _0x4f2b4e=await fetch('https://content.dropboxapi.com/2/files/download',{'method':'POST','headers':{'Authorization':_0x7884b(0x154)+localStorage[_0x7884b(0x18e)]('accessToken'),'Dropbox-API-Arg':_0x691320}});if(_0x4f2b4e[_0x7884b(0x19e)]!=0xc8){if(_0x4f2b4e[_0x7884b(0x19e)]==0x191){var _0x2abcb5=await dpRefreshToken();if(!_0x2abcb5)throw _0x7884b(0x17e);continue;}else throw _0x7884b(0x1aa)+_0x4f2b4e[_0x7884b(0x19e)];}const _0x55189a=new File([await _0x4f2b4e[_0x7884b(0x17b)]()],_0x60a481);console[_0x7884b(0x177)](_0x7884b(0x171),_0x55189a[_0x7884b(0x15b)]);if(_0x60a481[_0x7884b(0x179)](_0x7884b(0x15c))){const _0x423f52=await _0x55189a[_0x7884b(0x153)](),[_0x527993,_0x520c3d]=_0x423f52[_0x7884b(0x174)]('\x0a\x0a'),_0x541128=_0x60a481[_0x7884b(0x15a)](0x0,_0x60a481[_0x7884b(0x17d)](_0x7884b(0x197))+0x3),_0x4b3a6a=_0x60a481[_0x7884b(0x16d)](_0x60a481[_0x7884b(0x157)]-0x5);localStorage['setItem'](_0x541128+_0x7884b(0x198)+_0x4b3a6a,_0x520c3d),localStorage[_0x7884b(0x148)](_0x541128+'_imageState'+_0x4b3a6a,_0x527993);}else a0_0xb70e18[_0x7884b(0x1b6)](_0x55189a,()=>{var _0x35f313=_0x7884b;localStorageFile(),Module[_0x35f313(0x149)]();});return _0x55189a;}return![];}document[a0_0x220a4b(0x1b0)](a0_0x220a4b(0x16a),function(){var _0x127fb9=a0_0x220a4b;dropboxRestore[_0x127fb9(0x1b0)]('click',async function(){var _0x2ebe92=_0x127fb9;const _0x1505f5=localStorage[_0x2ebe92(0x18e)](_0x2ebe92(0x1a3));if(_0x1505f5===null||_0x1505f5==='')window['alert']('Cloud\x20login\x20required!');else{var _0x4685e3={'path':'/'+_0x1505f5};for(var _0x2d1a14=0x0;_0x2d1a14<0x2;_0x2d1a14++){var _0x2beebb=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x2ebe92(0x14b),'headers':{'Authorization':_0x2ebe92(0x154)+localStorage[_0x2ebe92(0x18e)](_0x2ebe92(0x162)),'Content-Type':'application/json'},'body':JSON[_0x2ebe92(0x1ab)](_0x4685e3)});console[_0x2ebe92(0x177)](_0x2ebe92(0x151),_0x2beebb[_0x2ebe92(0x19e)]);if(_0x2beebb['status']!=0xc8){if(_0x2beebb[_0x2ebe92(0x19e)]==0x191){var _0x23aa1e=await dpRefreshToken();if(!_0x23aa1e)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x2ebe92(0x199)+_0x2beebb['status'];}else{const _0x5064f6=await _0x2beebb[_0x2ebe92(0x184)](),_0x58a896=_0x5064f6[_0x2ebe92(0x152)][_0x2ebe92(0x1ae)](_0x51ca8e=>_0x51ca8e[_0x2ebe92(0x161)]===_0x2ebe92(0x19a))[_0x2ebe92(0x157)],_0x5d420f=_0x2ebe92(0x1ad)+_0x58a896+_0x2ebe92(0x1a6);if(window[_0x2ebe92(0x1b3)](_0x5d420f))for(const _0x332127 of _0x5064f6[_0x2ebe92(0x152)]){_0x332127[_0x2ebe92(0x161)]===_0x2ebe92(0x19a)&&(await lockNoti(_0x2ebe92(0x1a5),_0x332127[_0x2ebe92(0x15b)],0xbb8),await dpDownloadFile(_0x332127[_0x2ebe92(0x15b)]));}else console[_0x2ebe92(0x177)](_0x2ebe92(0x1b5));return!![];}}return![];}}),dropboxBackup[_0x127fb9(0x1b0)](_0x127fb9(0x1b1),async function(){var _0x236e18=_0x127fb9;const _0x48650e=localStorage['getItem'](_0x236e18(0x1a3));if(_0x48650e===null||_0x48650e==='')window[_0x236e18(0x173)](_0x236e18(0x169));else{const _0x451a33=['state','save'];let _0x53fc00=0x0;for(const _0x642f51 of _0x451a33){const _0x170453=a0_0xb70e18['list'+(_0x642f51[_0x236e18(0x16d)](0x0)['toUpperCase']()+_0x642f51[_0x236e18(0x193)](0x1))]();_0x53fc00+=_0x170453[_0x236e18(0x157)];}if(window[_0x236e18(0x1b3)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x53fc00+_0x236e18(0x170)))for(const _0x2c2579 of _0x451a33){const _0x357b58=a0_0xb70e18['list'+(_0x2c2579['charAt'](0x0)[_0x236e18(0x150)]()+_0x2c2579[_0x236e18(0x193)](0x1))]();for(const _0x4b783d of _0x357b58){const _0x2cbdf9=await a0_0xb70e18[_0x236e18(0x183)](_0x236e18(0x178)+_0x2c2579+'s/'+_0x4b783d);try{await lockNoti(_0x236e18(0x17a),_0x4b783d,0xbb8),await dpUploadFile(_0x4b783d,_0x2cbdf9);if(_0x4b783d[_0x236e18(0x179)](_0x236e18(0x160))||_0x4b783d['endsWith'](_0x236e18(0x1a2))||_0x4b783d['endsWith']('.ss2')||_0x4b783d['endsWith'](_0x236e18(0x165))||_0x4b783d[_0x236e18(0x179)](_0x236e18(0x15e))||_0x4b783d[_0x236e18(0x179)]('.ss5')||_0x4b783d[_0x236e18(0x179)](_0x236e18(0x158))||_0x4b783d[_0x236e18(0x179)](_0x236e18(0x167))){const _0xc1bf04=_0x4b783d[_0x236e18(0x15a)](0x0,_0x4b783d['lastIndexOf']('.')),_0x1d8454=_0x4b783d[_0x236e18(0x16d)](_0x4b783d[_0x236e18(0x157)]-0x1),_0x32df15=localStorage['getItem'](_0xc1bf04+_0x236e18(0x14f)+_0x1d8454),_0x208ebc=localStorage[_0x236e18(0x18e)](_0xc1bf04+_0x236e18(0x196)+_0x1d8454);if(_0x32df15!==null){const _0x1beb1e=_0x32df15+'\x0a\x0a'+_0x208ebc,_0x2accb5=new Blob([_0x1beb1e],{'type':_0x236e18(0x18a)});await lockNoti(_0x236e18(0x17a),_0xc1bf04+_0x236e18(0x16b)+_0x1d8454+_0x236e18(0x15c),0xbb8),await dpUploadFile(_0xc1bf04+_0x236e18(0x16b)+_0x1d8454+_0x236e18(0x15c),_0x2accb5);}}}catch(_0x55b064){console[_0x236e18(0x180)]('Failed\x20to\x20upload\x20file\x20'+_0x4b783d+':',_0x55b064);}}}else console['log'](_0x236e18(0x1b5));}}),dropboxCloud[_0x127fb9(0x1b0)]('click',function(){var _0x59cfd3=_0x127fb9;const _0x502c2b=localStorage['getItem'](_0x59cfd3(0x1a3));_0x502c2b===null||_0x502c2b===''?authorizeWithDropbox():window['confirm']('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x59cfd3(0x148)](_0x59cfd3(0x1a3),''),dropboxRestore[_0x59cfd3(0x156)][_0x59cfd3(0x188)](_0x59cfd3(0x18b)),dropboxBackup[_0x59cfd3(0x156)][_0x59cfd3(0x188)](_0x59cfd3(0x18b)),dropboxCloud[_0x59cfd3(0x156)][_0x59cfd3(0x188)](_0x59cfd3(0x18b)));}),handleDropboxCallback();});function a0_0xf122(){var _0xd89d61=['/data/','endsWith','Backing\x20up...','blob','Error\x20while\x20refreshing\x20token:','lastIndexOf','Unable\x20to\x20refresh\x20token','setRequestHeader','error','12235AAwMjz','application/x-www-form-urlencoded','downloadFileInCloud','json','open','Refreshing\x20token...','&redirect_uri=','remove','&client_id=','text/plain','active','No\x20refresh\x20token','exec','getItem','https://api.dropbox.com/oauth2/token','responseText','https://www.dropbox.com/oauth2/authorize?client_id=','353766gNeIwA','slice','https://api.dropboxapi.com/oauth2/token','Failed\x20to\x20refresh\x20Dropbox\x20token.','.gba_dateState','gba','_dateState','Download\x20failed,\x20unknown\x20http\x20status:\x20','file','57502UKCLmP','503934LxRdND','parse','status','authorization_code','refreshToken','code','.ss1','uId','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Restoring...','\x20files\x20in\x20Cloud?','6JnjSlL','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','replace','Download\x20failed,\x20unknown\x20http\x20status:','stringify','94776WQKAQf','Do\x20you\x20want\x20to\x20restore\x20','filter','Authorization\x20Code:','addEventListener','click','330201gLwrQq','confirm','code=','Restore\x20canceled\x20by\x20user.','uploadSaveOrSaveState','4JVsInX','setItem','FSSync','overwrite','POST','refresh_token=','href','send','.gba_imageState','toUpperCase','status:\x20','entries','text','Bearer\x20','application/octet-stream','classList','length','.ss6','error_description','substring','name','.txt','location','.ss4','53176qQGpWt','.ss0','.tag','accessToken','&token_access_type=','&client_secret=','.ss3','access_token','.ss7','&response_type=','Cloud\x20login\x20required!','DOMContentLoaded','.gba_slot','Do\x20not\x20receive\x20authorization','charAt','uid','Content-Type','\x20files\x20in\x20Kabu?','Cloud\x20↦\x20Kabu\x20storage\x20◆','https://content.dropboxapi.com/2/files/upload','alert','split','Upload\x20failed,\x20unknown\x20http\x20status:\x20','search','log'];a0_0xf122=function(){return _0xd89d61;};return a0_0xf122();}