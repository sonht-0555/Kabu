var a0_0x9200d1=a0_0xca0f;(function(_0x111702,_0x349721){var _0x546cce=a0_0xca0f,_0x327b36=_0x111702();while(!![]){try{var _0x315dcf=-parseInt(_0x546cce(0x1eb))/0x1*(parseInt(_0x546cce(0x1cf))/0x2)+-parseInt(_0x546cce(0x1ff))/0x3+-parseInt(_0x546cce(0x1d2))/0x4+parseInt(_0x546cce(0x1fa))/0x5*(-parseInt(_0x546cce(0x1cc))/0x6)+parseInt(_0x546cce(0x1fc))/0x7*(parseInt(_0x546cce(0x1d8))/0x8)+-parseInt(_0x546cce(0x1f2))/0x9+parseInt(_0x546cce(0x20a))/0xa;if(_0x315dcf===_0x349721)break;else _0x327b36['push'](_0x327b36['shift']());}catch(_0x547033){_0x327b36['push'](_0x327b36['shift']());}}}(a0_0x37fb,0x1e015));import*as a0_0x265714 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x9200d1(0x1e8),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x1877ad=a0_0x9200d1,_0x398591=window[_0x1877ad(0x1f1)][_0x1877ad(0x1ed)]['split']('?')[0x0],_0x3d0cfd=_0x1877ad(0x1e0),_0x236a00=_0x1877ad(0x208),_0x3ba4af=_0x1877ad(0x1bc)+clientId+_0x1877ad(0x1c2)+_0x3d0cfd+_0x1877ad(0x219)+_0x236a00+_0x1877ad(0x1d3)+encodeURIComponent(_0x398591);window[_0x1877ad(0x1f1)][_0x1877ad(0x1ed)]=_0x3ba4af;}function handleDropboxCallback(){var _0x1b5872=a0_0x9200d1,_0x484952=getUrlParameter(_0x1b5872(0x1e0));_0x484952?(getAccessToken(_0x484952),console['log'](_0x1b5872(0x215),_0x484952)):console[_0x1b5872(0x1bb)](_0x1b5872(0x206));}function a0_0xca0f(_0x4a16be,_0x1d9c49){var _0x37fb7b=a0_0x37fb();return a0_0xca0f=function(_0xca0f32,_0x951300){_0xca0f32=_0xca0f32-0x1ba;var _0x3a53b6=_0x37fb7b[_0xca0f32];return _0x3a53b6;},a0_0xca0f(_0x4a16be,_0x1d9c49);}function getUrlParameter(_0x4d141e){var _0x3e9b1a=a0_0x9200d1;_0x4d141e=_0x4d141e[_0x3e9b1a(0x1e3)](/[\[]/,'\x5c[')[_0x3e9b1a(0x1e3)](/[\]]/,'\x5c]');var _0xad55b5=new RegExp(_0x3e9b1a(0x216)+_0x4d141e+_0x3e9b1a(0x1de)),_0x47a591=_0xad55b5[_0x3e9b1a(0x1ea)](location[_0x3e9b1a(0x21c)]);return _0x47a591===null?'':decodeURIComponent(_0x47a591[0x1][_0x3e9b1a(0x1e3)](/\+/g,'\x20'));}function getAccessToken(_0xeab2f){var _0x274cda=a0_0x9200d1,_0x1baeaf=_0x274cda(0x20e),_0x863bd2=window['location'][_0x274cda(0x1ed)][_0x274cda(0x211)]('?')[0x0],_0x40ce8d=new XMLHttpRequest();_0x40ce8d[_0x274cda(0x21a)]('POST','https://api.dropbox.com/oauth2/token'),_0x40ce8d[_0x274cda(0x1df)](_0x274cda(0x1cd),'application/x-www-form-urlencoded'),_0x40ce8d[_0x274cda(0x21d)]=function(){var _0x425071=_0x274cda;if(_0x40ce8d['status']===0xc8){var _0x3e939c=JSON[_0x425071(0x21e)](_0x40ce8d[_0x425071(0x1fd)]),_0x44da25=_0x3e939c[_0x425071(0x1f0)],_0x2e6fd7=_0x3e939c[_0x425071(0x1e6)],_0x4ebc1c=_0x3e939c['uid'];localStorage['setItem'](_0x425071(0x1c7),_0x44da25),localStorage[_0x425071(0x1be)]('refreshToken',_0x2e6fd7),localStorage[_0x425071(0x1be)](_0x425071(0x20b),_0x4ebc1c);}else console[_0x425071(0x1bb)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x40ce8d[_0x274cda(0x1bf)](_0x274cda(0x1c8)+_0xeab2f+'&grant_type='+_0x1baeaf+_0x274cda(0x1d4)+clientId+'&client_secret='+clientSecret+_0x274cda(0x1d3)+encodeURIComponent(_0x863bd2));}function a0_0x37fb(){var _0x253264=['folder','Refreshing\x20token...','accessToken','code=','getItem','Do\x20you\x20want\x20to\x20backup\x20','https://api.dropboxapi.com/2/files/list_folder','5622ghWtoy','Content-Type','push','24782vycrVh','application/json','https://api.dropboxapi.com/2/files/create_folder_v2','108644PZzpgi','&redirect_uri=','&client_id=','Failed\x20to\x20upload\x20file\x20','alert','https://api.dropboxapi.com/oauth2/token','562984ZpRGkk','Restore\x20canceled\x20by\x20user.','Download\x20failed\x20for\x20','\x20files\x20from\x20Cloud?','Folder\x20already\x20exists','screenshot','=([^&#]*)','setRequestHeader','code','refresh_token=','application/octet-stream','replace','No\x20files\x20found\x20to\x20restore.','click','refresh_token','file','knh3uz2mx2hp2eu','refreshToken','exec','19UQTXKq','active','href','Wait\x20a\x20little\x20bit...','entries','access_token','location','1711539immcEw',',\x20status:\x20','.tag','Unable\x20to\x20refresh\x20token','addEventListener','overwrite','remove','status','895wrDsag','classList','14HTHshw','responseText','save','208428MMaQtT','No\x20refresh\x20token','Restoring...','DOMContentLoaded','name','map','Backing\x20up...','Do\x20not\x20receive\x20authorization','confirm','offline','state','6721150PhcYTH','uId','Do\x20you\x20want\x20to\x20logout?','POST','authorization_code','Kabu\x20storage\x20↦\x20Cloud\x20◆','length','split','Error\x20creating\x20folder\x20','https://content.dropboxapi.com/2/files/upload','filter','Authorization\x20Code:','[\x5c?&#]','Download\x20failed,\x20unknown\x20http\x20status:','Do\x20you\x20want\x20to\x20restore\x20','&token_access_type=','open','/data/','search','onload','parse','https://content.dropboxapi.com/2/files/download','log','https://www.dropbox.com/oauth2/authorize?client_id=','error','setItem','send','stringify','listFiles','&response_type=','json','Bearer\x20'];a0_0x37fb=function(){return _0x253264;};return a0_0x37fb();}export async function dpCreateFolder(_0xb57fff){var _0x4c334d=a0_0x9200d1;const _0x31711d=localStorage[_0x4c334d(0x1c9)]('uId');let _0x27909f=localStorage['getItem'](_0x4c334d(0x1c7));const _0x4e15bf='/'+_0x31711d+'/'+_0xb57fff,_0x39a467=JSON['stringify']({'path':_0x4e15bf,'autorename':![]});for(let _0x3a70a6=0x0;_0x3a70a6<0x2;_0x3a70a6++){try{const _0xb73232=await fetch(_0x4c334d(0x1d1),{'method':'POST','headers':{'Authorization':'Bearer\x20'+_0x27909f,'Content-Type':_0x4c334d(0x1d0)},'body':_0x39a467});if(_0xb73232['status']===0x191){const _0x73026c=await dpRefreshToken();if(!_0x73026c)throw new Error(_0x4c334d(0x1f5));_0x27909f=localStorage[_0x4c334d(0x1c9)](_0x4c334d(0x1c7));continue;}if(_0xb73232[_0x4c334d(0x1f9)]===0x199)return{'message':_0x4c334d(0x1dc),'path':_0xb57fff};if(!_0xb73232['ok'])throw new Error(_0x4c334d(0x212)+_0xb57fff);const _0x3301c3=await _0xb73232[_0x4c334d(0x1c3)]();return await lockNoti('Folder\x20created','',0xbb8),_0x3301c3;}catch(_0x4f85bf){if(_0x3a70a6===0x1)throw _0x4f85bf;}}return![];}export async function dpRefreshToken(){var _0x3ff29d=a0_0x9200d1;if(!localStorage[_0x3ff29d(0x1c9)](_0x3ff29d(0x1e9)))throw _0x3ff29d(0x200);try{const _0x417139=await fetch(_0x3ff29d(0x1d7),{'method':'POST','headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x3ff29d(0x1e1)+localStorage[_0x3ff29d(0x1c9)](_0x3ff29d(0x1e9))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x51a745=await _0x417139[_0x3ff29d(0x1c3)]();if(!_0x51a745[_0x3ff29d(0x1bd)])return localStorage[_0x3ff29d(0x1be)](_0x3ff29d(0x1c7),_0x51a745[_0x3ff29d(0x1f0)]),await lockNoti(_0x3ff29d(0x1c6),'',0xbb8),await delay(0x3e8),!![];else alert(_0x51a745['error_description']||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x4bd232){console['error']('Error\x20while\x20refreshing\x20token:',_0x4bd232);}return![];}export async function dpUploadFile(_0x57d599,_0x114447,_0x4a328c){var _0x574f0f=a0_0x9200d1;const _0x17f59e=localStorage['getItem']('uId');var _0x1998fa=JSON[_0x574f0f(0x1c0)]({'autorename':!![],'mode':_0x574f0f(0x1f7),'mute':!![],'strict_conflict':![],'path':'/'+_0x17f59e+'/'+_0x4a328c+'/'+_0x57d599}),_0x416713=new Blob([_0x114447],{'type':_0x574f0f(0x1e2)});for(var _0x4062e4=0x0;_0x4062e4<0x2;_0x4062e4++){var _0x1e5b1d=await fetch(_0x574f0f(0x213),{'method':_0x574f0f(0x20d),'headers':{'Authorization':_0x574f0f(0x1c4)+localStorage[_0x574f0f(0x1c9)](_0x574f0f(0x1c7)),'Dropbox-API-Arg':_0x1998fa,'Content-Type':_0x574f0f(0x1e2)},'body':_0x416713});if(_0x1e5b1d['status']!=0xc8){if(_0x1e5b1d[_0x574f0f(0x1f9)]==0x191){var _0x3d8df1=await dpRefreshToken();if(!_0x3d8df1)throw _0x574f0f(0x1f5);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x1e5b1d[_0x574f0f(0x1f9)];}else{var _0x2c080c=await _0x1e5b1d['json']();return console[_0x574f0f(0x1bb)](_0x574f0f(0x20f),_0x57d599),_0x2c080c;}}return![];}export async function dpDownloadFile(_0xea0ea3,_0x28c479){var _0x167e90=a0_0x9200d1;const _0x305e78=localStorage['getItem'](_0x167e90(0x20b));var _0x38f7c7=JSON[_0x167e90(0x1c0)]({'path':'/'+_0x305e78+'/'+_0x28c479+'/'+_0xea0ea3});for(var _0x14f2f2=0x0;_0x14f2f2<0x2;_0x14f2f2++){var _0x122c1a=await fetch(_0x167e90(0x1ba),{'method':_0x167e90(0x20d),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x167e90(0x1c9)](_0x167e90(0x1c7)),'Dropbox-API-Arg':_0x38f7c7}});if(_0x122c1a['status']!=0xc8){if(_0x122c1a['status']==0x191){var _0x329e8b=await dpRefreshToken();if(!_0x329e8b)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x167e90(0x217)+_0x122c1a[_0x167e90(0x1f9)];}const _0x297587=new File([await _0x122c1a['blob']()],_0xea0ea3);return console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x297587[_0x167e90(0x203)]),a0_0x265714['uploadFileInCloud'](_0x297587,()=>{}),_0x297587;}return![];}document[a0_0x9200d1(0x1f6)](a0_0x9200d1(0x202),function(){var _0x2b58e0=a0_0x9200d1;dropboxRestore[_0x2b58e0(0x1f6)]('click',async function(){var _0x105483=_0x2b58e0;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x285a06=localStorage[_0x105483(0x1c9)](_0x105483(0x20b)),_0x3b41a3=[_0x105483(0x209),'save',_0x105483(0x1dd)];if(!_0x285a06){window['alert']('Cloud\x20login\x20required!');return;}let _0x16cab5=[];for(const _0x5570a5 of _0x3b41a3){let _0x359ae0={'path':'/'+_0x285a06+'/'+_0x5570a5};for(let _0x51d72b=0x0;_0x51d72b<0x2;_0x51d72b++){let _0x1bf2ab=await fetch(_0x105483(0x1cb),{'method':_0x105483(0x20d),'headers':{'Authorization':_0x105483(0x1c4)+localStorage['getItem']('accessToken'),'Content-Type':'application/json'},'body':JSON[_0x105483(0x1c0)](_0x359ae0)});if(_0x1bf2ab[_0x105483(0x1f9)]===0xc8){let _0x431b04=await _0x1bf2ab[_0x105483(0x1c3)](),_0x35df9f=_0x431b04[_0x105483(0x1ef)][_0x105483(0x214)](_0x48b712=>_0x48b712[_0x105483(0x1f4)]===_0x105483(0x1e7));_0x35df9f[_0x105483(0x210)]>0x0&&_0x16cab5[_0x105483(0x1ce)](..._0x35df9f[_0x105483(0x204)](_0x481b2e=>({'name':_0x481b2e[_0x105483(0x203)],'folder':_0x5570a5})));break;}else{if(_0x1bf2ab[_0x105483(0x1f9)]===0x191){let _0x2175b9=await dpRefreshToken();if(!_0x2175b9)throw _0x105483(0x1f5);}else{console[_0x105483(0x1bd)](_0x105483(0x1da)+_0x5570a5+_0x105483(0x1f3)+_0x1bf2ab[_0x105483(0x1f9)]);break;}}}}if(_0x16cab5[_0x105483(0x210)]>0x0){const _0x11d817=_0x105483(0x218)+_0x16cab5[_0x105483(0x210)]+_0x105483(0x1db);if(window[_0x105483(0x207)](_0x11d817))for(const _0x2ac0b2 of _0x16cab5){await lockNoti(_0x105483(0x201),_0x2ac0b2[_0x105483(0x203)],0xbb8),await dpDownloadFile(_0x2ac0b2[_0x105483(0x203)],_0x2ac0b2[_0x105483(0x1c5)]);}else console[_0x105483(0x1bb)](_0x105483(0x1d9));}else console[_0x105483(0x1bb)](_0x105483(0x1e4));}),dropboxBackup['addEventListener']('click',async function(){var _0x1660af=_0x2b58e0;await lockNoti(_0x1660af(0x1ee),'',0x1388);const _0x11855e=localStorage[_0x1660af(0x1c9)]('uId');if(_0x11855e===null||_0x11855e==='')window[_0x1660af(0x1d6)]('Cloud\x20login\x20required!');else{const _0xaa5209=[_0x1660af(0x209),_0x1660af(0x1fe),_0x1660af(0x1dd)];for(const _0x3f1935 of _0xaa5209){await dpCreateFolder(_0x3f1935);}let _0x1e938d=0x0;for(const _0x369cb9 of _0xaa5209){const _0x29e5ee=a0_0x265714['listFiles'](_0x369cb9+'s');_0x1e938d+=_0x29e5ee[_0x1660af(0x210)];}if(window[_0x1660af(0x207)](_0x1660af(0x1ca)+_0x1e938d+'\x20files\x20in\x20Kabu?'))for(const _0x38c544 of _0xaa5209){const _0x147aa0=a0_0x265714[_0x1660af(0x1c1)](_0x38c544+'s');for(const _0x192736 of _0x147aa0){const _0x2b6b5b=await a0_0x265714['downloadFileInCloud'](_0x1660af(0x21b)+_0x38c544+'s/'+_0x192736);try{await lockNoti(_0x1660af(0x205),_0x192736,0xbb8),await dpUploadFile(_0x192736,_0x2b6b5b,_0x38c544);}catch(_0x25c351){console[_0x1660af(0x1bd)](_0x1660af(0x1d5)+_0x192736+':',_0x25c351);}}}else console[_0x1660af(0x1bb)](_0x1660af(0x1d9));}}),dropboxCloud['addEventListener'](_0x2b58e0(0x1e5),function(){var _0x42679f=_0x2b58e0;const _0x135fd2=localStorage['getItem'](_0x42679f(0x20b));_0x135fd2===null||_0x135fd2===''?authorizeWithDropbox():window[_0x42679f(0x207)](_0x42679f(0x20c))&&(localStorage[_0x42679f(0x1be)](_0x42679f(0x20b),''),dropboxRestore[_0x42679f(0x1fb)]['remove'](_0x42679f(0x1ec)),dropboxBackup[_0x42679f(0x1fb)][_0x42679f(0x1f8)](_0x42679f(0x1ec)),dropboxCloud[_0x42679f(0x1fb)][_0x42679f(0x1f8)](_0x42679f(0x1ec)));}),handleDropboxCallback();});