var a0_0xded9b3=a0_0x5047;(function(_0xa23682,_0x17bd99){var _0x4636f6=a0_0x5047,_0x432090=_0xa23682();while(!![]){try{var _0x4e982f=parseInt(_0x4636f6(0x101))/0x1+-parseInt(_0x4636f6(0xcf))/0x2*(-parseInt(_0x4636f6(0x103))/0x3)+parseInt(_0x4636f6(0xd8))/0x4+parseInt(_0x4636f6(0xce))/0x5+parseInt(_0x4636f6(0xd7))/0x6+parseInt(_0x4636f6(0xdd))/0x7+-parseInt(_0x4636f6(0xb1))/0x8*(parseInt(_0x4636f6(0xcd))/0x9);if(_0x4e982f===_0x17bd99)break;else _0x432090['push'](_0x432090['shift']());}catch(_0x2b4a2d){_0x432090['push'](_0x432090['shift']());}}}(a0_0x17a3,0x4f7d0));import*as a0_0x1d5074 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0xded9b3(0xc9),clientSecret=a0_0xded9b3(0xb8);function a0_0x5047(_0x270064,_0x2d8d0e){var _0x17a3b6=a0_0x17a3();return a0_0x5047=function(_0x504727,_0x35d81c){_0x504727=_0x504727-0xb1;var _0x536739=_0x17a3b6[_0x504727];return _0x536739;},a0_0x5047(_0x270064,_0x2d8d0e);}function authorizeWithDropbox(){var _0x19bff6=a0_0xded9b3,_0x3668b5=window['location'][_0x19bff6(0xee)]['split']('?')[0x0],_0x5c0864='code',_0x20a289=_0x19bff6(0xe7),_0x2f9c7d=_0x19bff6(0xc6)+clientId+_0x19bff6(0xf2)+_0x5c0864+_0x19bff6(0xfc)+_0x20a289+'&redirect_uri='+encodeURIComponent(_0x3668b5);window[_0x19bff6(0xe8)][_0x19bff6(0xee)]=_0x2f9c7d;}function handleDropboxCallback(){var _0x2fd141=a0_0xded9b3,_0x27d63e=getUrlParameter(_0x2fd141(0xbc));_0x27d63e?(getAccessToken(_0x27d63e),console[_0x2fd141(0xb4)](_0x2fd141(0xc8),_0x27d63e)):console[_0x2fd141(0xb4)](_0x2fd141(0xd1));}function getUrlParameter(_0x37ba0f){var _0x42a502=a0_0xded9b3;_0x37ba0f=_0x37ba0f[_0x42a502(0xc5)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x14b94c=new RegExp('[\x5c?&#]'+_0x37ba0f+_0x42a502(0x113)),_0x49d01f=_0x14b94c['exec'](location[_0x42a502(0xb9)]);return _0x49d01f===null?'':decodeURIComponent(_0x49d01f[0x1][_0x42a502(0xc5)](/\+/g,'\x20'));}function getAccessToken(_0x18e629){var _0x373aad=a0_0xded9b3,_0x58131f=_0x373aad(0x115),_0x125958=window[_0x373aad(0xe8)]['href'][_0x373aad(0xc2)]('?')[0x0],_0x354c84=new XMLHttpRequest();_0x354c84[_0x373aad(0xbe)](_0x373aad(0xf4),_0x373aad(0xff)),_0x354c84[_0x373aad(0xf1)]('Content-Type',_0x373aad(0xc3)),_0x354c84[_0x373aad(0xf8)]=function(){var _0x242c78=_0x373aad;if(_0x354c84[_0x242c78(0x102)]===0xc8){var _0x377de1=JSON[_0x242c78(0xe4)](_0x354c84[_0x242c78(0xe9)]),_0x2f0f00=_0x377de1[_0x242c78(0xe6)],_0x11b21a=_0x377de1[_0x242c78(0xec)],_0x54819f=_0x377de1[_0x242c78(0x107)];localStorage[_0x242c78(0x110)](_0x242c78(0x10d),_0x2f0f00),localStorage[_0x242c78(0x110)](_0x242c78(0xcc),_0x11b21a),localStorage[_0x242c78(0x110)]('uId',_0x54819f);}else console[_0x242c78(0xb4)](_0x242c78(0xd9));},_0x354c84[_0x373aad(0xfb)]('code='+_0x18e629+_0x373aad(0xf6)+_0x58131f+'&client_id='+clientId+_0x373aad(0x112)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x125958));}export async function dpCreateFolder(_0x2e4573){var _0x558d04=a0_0xded9b3;const _0x38aed4=localStorage[_0x558d04(0x10e)](_0x558d04(0xf7));let _0x51c562=localStorage['getItem'](_0x558d04(0x10d));const _0x4c4fae='/'+_0x38aed4+'/'+_0x2e4573,_0x1743e0=JSON[_0x558d04(0x109)]({'path':_0x4c4fae,'autorename':![]});for(let _0x137b80=0x0;_0x137b80<0x2;_0x137b80++){try{const _0x3d7f2a=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x558d04(0xf4),'headers':{'Authorization':_0x558d04(0xb5)+_0x51c562,'Content-Type':_0x558d04(0xf5)},'body':_0x1743e0});if(_0x3d7f2a[_0x558d04(0x102)]===0x191){const _0x5920c2=await dpRefreshToken();if(!_0x5920c2)throw new Error(_0x558d04(0xe1));_0x51c562=localStorage[_0x558d04(0x10e)](_0x558d04(0x10d));continue;}if(_0x3d7f2a[_0x558d04(0x102)]===0x199)return{'message':_0x558d04(0xd5),'path':_0x2e4573};if(!_0x3d7f2a['ok'])throw new Error(_0x558d04(0xc0)+_0x2e4573);const _0x1a7cca=await _0x3d7f2a['json']();return await lockNoti('Folder\x20created','',0xbb8),_0x1a7cca;}catch(_0x46c462){if(_0x137b80===0x1)throw _0x46c462;}}return![];}export async function dpRefreshToken(){var _0x56aed2=a0_0xded9b3;if(!localStorage[_0x56aed2(0x10e)]('refreshToken'))throw _0x56aed2(0xb3);try{const _0x5df657=await fetch(_0x56aed2(0xcb),{'method':_0x56aed2(0xf4),'headers':{'Content-Type':_0x56aed2(0xc3)},'body':_0x56aed2(0xf9)+localStorage[_0x56aed2(0x10e)](_0x56aed2(0xcc))+_0x56aed2(0xd0)}),_0x4f550e=await _0x5df657[_0x56aed2(0xbb)]();if(!_0x4f550e[_0x56aed2(0xe2)])return localStorage['setItem'](_0x56aed2(0x10d),_0x4f550e['access_token']),await lockNoti(_0x56aed2(0xb2),'',0xbb8),await delay(0x3e8),!![];else alert(_0x4f550e[_0x56aed2(0xdf)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0xe3f432){console[_0x56aed2(0xe2)]('Error\x20while\x20refreshing\x20token:',_0xe3f432);}return![];}export async function dpUploadFile(_0xedccf,_0x4aafdb,_0x1cf341){var _0xf7b715=a0_0xded9b3;const _0x2a752f=localStorage[_0xf7b715(0x10e)]('uId');var _0x1595db=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x2a752f+'/'+_0x1cf341+'/'+_0xedccf}),_0x578f1d=new Blob([_0x4aafdb],{'type':'application/octet-stream'});for(var _0xf2b8e1=0x0;_0xf2b8e1<0x2;_0xf2b8e1++){var _0x287321=await fetch(_0xf7b715(0xef),{'method':_0xf7b715(0xf4),'headers':{'Authorization':'Bearer\x20'+localStorage[_0xf7b715(0x10e)](_0xf7b715(0x10d)),'Dropbox-API-Arg':_0x1595db,'Content-Type':'application/octet-stream'},'body':_0x578f1d});if(_0x287321['status']!=0xc8){if(_0x287321['status']==0x191){var _0x15b447=await dpRefreshToken();if(!_0x15b447)throw _0xf7b715(0xe1);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x287321[_0xf7b715(0x102)];}else{var _0x488ab9=await _0x287321[_0xf7b715(0xbb)]();return console[_0xf7b715(0xb4)](_0xf7b715(0xca),_0xedccf),_0x488ab9;}}return![];}export async function dpDownloadFile(_0x7efcee,_0x5fa090){var _0x2b5cb4=a0_0xded9b3;const _0x4d1d0f=localStorage['getItem'](_0x2b5cb4(0xf7));var _0x55ff1e=JSON[_0x2b5cb4(0x109)]({'path':'/'+_0x4d1d0f+'/'+_0x5fa090+'/'+_0x7efcee});for(var _0x2c681e=0x0;_0x2c681e<0x2;_0x2c681e++){var _0x36d4be=await fetch('https://content.dropboxapi.com/2/files/download',{'method':'POST','headers':{'Authorization':_0x2b5cb4(0xb5)+localStorage[_0x2b5cb4(0x10e)](_0x2b5cb4(0x10d)),'Dropbox-API-Arg':_0x55ff1e}});if(_0x36d4be['status']!=0xc8){if(_0x36d4be['status']==0x191){var _0x238b5d=await dpRefreshToken();if(!_0x238b5d)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x36d4be['status'];}const _0x4fb6db=new File([await _0x36d4be[_0x2b5cb4(0xdc)]()],_0x7efcee);return console[_0x2b5cb4(0xb4)](_0x2b5cb4(0xd4),_0x4fb6db[_0x2b5cb4(0xdb)]),a0_0x1d5074[_0x2b5cb4(0x116)](_0x4fb6db,()=>{var _0x5f8180=_0x2b5cb4;localStorageFile(),Module[_0x5f8180(0xfa)]();}),_0x4fb6db;}return![];}function a0_0x17a3(){var _0x1889b0=['access_token','offline','location','responseText',',\x20status:\x20','Restore\x20canceled\x20by\x20user.','refresh_token','confirm','href','https://content.dropboxapi.com/2/files/upload','length','setRequestHeader','&response_type=','list','POST','application/json','&grant_type=','uId','onload','refresh_token=','FSSync','send','&token_access_type=','No\x20files\x20found\x20to\x20restore.','active','https://api.dropbox.com/oauth2/token','click','537166GqRwGw','status','994863waWFNE','\x20files\x20from\x20Cloud?','Do\x20you\x20want\x20to\x20restore\x20','https://api.dropboxapi.com/2/files/list_folder','uid','map','stringify','remove','toUpperCase','folder','accessToken','getItem','push','setItem','Wait\x20a\x20little\x20bit...','&client_secret=','=([^&#]*)','addEventListener','authorization_code','uploadFileInCloud','2924368IUPqOn','Refreshing\x20token...','No\x20refresh\x20token','log','Bearer\x20','filter','slice','nwb3dnfh09rhs31','search','Restoring...','json','code','entries','open','Failed\x20to\x20upload\x20file\x20','Error\x20creating\x20folder\x20','/data/','split','application/x-www-form-urlencoded','charAt','replace','https://www.dropbox.com/oauth2/authorize?client_id=','downloadFileInCloud','Authorization\x20Code:','knh3uz2mx2hp2eu','Kabu\x20storage\x20↦\x20Cloud\x20◆','https://api.dropboxapi.com/oauth2/token','refreshToken','45HlJUGJ','1839825vugybu','2whHJAp','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Do\x20not\x20receive\x20authorization','.tag','save','Cloud\x20↦\x20Kabu\x20storage\x20◆','Folder\x20already\x20exists','Backing\x20up...','1369218aBbNpp','1654264ZWEJlF','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Do\x20you\x20want\x20to\x20backup\x20','name','blob','1923551jzPiPz','classList','error_description','Download\x20failed\x20for\x20','Unable\x20to\x20refresh\x20token','error','screenshot','parse','Cloud\x20login\x20required!'];a0_0x17a3=function(){return _0x1889b0;};return a0_0x17a3();}document[a0_0xded9b3(0x114)]('DOMContentLoaded',function(){var _0x493df6=a0_0xded9b3;dropboxRestore[_0x493df6(0x114)](_0x493df6(0x100),async function(){var _0x272ac5=_0x493df6;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x214891=localStorage[_0x272ac5(0x10e)]('uId'),_0x41a2db=['state',_0x272ac5(0xd3),_0x272ac5(0xe3)];if(!_0x214891){window['alert']('Cloud\x20login\x20required!');return;}let _0x380d71=[];for(const _0x1a6699 of _0x41a2db){let _0x2b8556={'path':'/'+_0x214891+'/'+_0x1a6699};for(let _0x357a38=0x0;_0x357a38<0x2;_0x357a38++){let _0x260383=await fetch(_0x272ac5(0x106),{'method':_0x272ac5(0xf4),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x272ac5(0x10d)),'Content-Type':_0x272ac5(0xf5)},'body':JSON[_0x272ac5(0x109)](_0x2b8556)});if(_0x260383[_0x272ac5(0x102)]===0xc8){let _0x19bb81=await _0x260383[_0x272ac5(0xbb)](),_0x481e70=_0x19bb81[_0x272ac5(0xbd)][_0x272ac5(0xb6)](_0x1c4758=>_0x1c4758[_0x272ac5(0xd2)]==='file');_0x481e70[_0x272ac5(0xf0)]>0x0&&_0x380d71[_0x272ac5(0x10f)](..._0x481e70[_0x272ac5(0x108)](_0x224daa=>({'name':_0x224daa[_0x272ac5(0xdb)],'folder':_0x1a6699})));break;}else{if(_0x260383[_0x272ac5(0x102)]===0x191){let _0x1cb86d=await dpRefreshToken();if(!_0x1cb86d)throw _0x272ac5(0xe1);}else{console['error'](_0x272ac5(0xe0)+_0x1a6699+_0x272ac5(0xea)+_0x260383[_0x272ac5(0x102)]);break;}}}}if(_0x380d71['length']>0x0){const _0x3da08c=_0x272ac5(0x105)+_0x380d71[_0x272ac5(0xf0)]+_0x272ac5(0x104);if(window[_0x272ac5(0xed)](_0x3da08c))for(const _0x4733c9 of _0x380d71){await lockNoti(_0x272ac5(0xba),_0x4733c9['name'],0xbb8),await dpDownloadFile(_0x4733c9[_0x272ac5(0xdb)],_0x4733c9[_0x272ac5(0x10c)]);}else console[_0x272ac5(0xb4)]('Restore\x20canceled\x20by\x20user.');}else console[_0x272ac5(0xb4)](_0x272ac5(0xfd));}),dropboxBackup[_0x493df6(0x114)](_0x493df6(0x100),async function(){var _0x2c6159=_0x493df6;await lockNoti(_0x2c6159(0x111),'',0x1388);const _0x318b23=localStorage[_0x2c6159(0x10e)](_0x2c6159(0xf7));if(_0x318b23===null||_0x318b23==='')window['alert'](_0x2c6159(0xe5));else{const _0x51649a=['state',_0x2c6159(0xd3),'screenshot'];for(const _0x209325 of _0x51649a){await dpCreateFolder(_0x209325);}let _0x4bc154=0x0;for(const _0x5d69d5 of _0x51649a){const _0x537ac9=a0_0x1d5074[_0x2c6159(0xf3)+(_0x5d69d5[_0x2c6159(0xc4)](0x0)[_0x2c6159(0x10b)]()+_0x5d69d5['slice'](0x1))]();_0x4bc154+=_0x537ac9[_0x2c6159(0xf0)];}if(window[_0x2c6159(0xed)](_0x2c6159(0xda)+_0x4bc154+'\x20files\x20in\x20Kabu?'))for(const _0x1a6149 of _0x51649a){const _0x18166c=a0_0x1d5074['list'+(_0x1a6149['charAt'](0x0)[_0x2c6159(0x10b)]()+_0x1a6149[_0x2c6159(0xb7)](0x1))]();for(const _0x598b72 of _0x18166c){const _0x9efe85=await a0_0x1d5074[_0x2c6159(0xc7)](_0x2c6159(0xc1)+_0x1a6149+'s/'+_0x598b72);try{await lockNoti(_0x2c6159(0xd6),_0x598b72,0xbb8),await dpUploadFile(_0x598b72,_0x9efe85,_0x1a6149);}catch(_0x3393c9){console[_0x2c6159(0xe2)](_0x2c6159(0xbf)+_0x598b72+':',_0x3393c9);}}}else console[_0x2c6159(0xb4)](_0x2c6159(0xeb));}}),dropboxCloud[_0x493df6(0x114)](_0x493df6(0x100),function(){var _0x2b2002=_0x493df6;const _0x10eb65=localStorage[_0x2b2002(0x10e)](_0x2b2002(0xf7));_0x10eb65===null||_0x10eb65===''?authorizeWithDropbox():window[_0x2b2002(0xed)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem'](_0x2b2002(0xf7),''),dropboxRestore['classList'][_0x2b2002(0x10a)](_0x2b2002(0xfe)),dropboxBackup['classList'][_0x2b2002(0x10a)](_0x2b2002(0xfe)),dropboxCloud[_0x2b2002(0xde)]['remove'](_0x2b2002(0xfe)));}),handleDropboxCallback();});