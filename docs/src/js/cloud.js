function a0_0x2704(){var _0x21f447=['setRequestHeader','error_description','https://api.dropboxapi.com/2/files/list_folder','endsWith','.gba_dateState','168648tXDGKJ','charAt','lastIndexOf','FSSync','onload','substring','Download\x20failed,\x20unknown\x20http\x20status:','json','send','Kabu\x20storage\x20↦\x20Cloud\x20◆','3Kiqybq','location','text/plain','45jZFvHo','Failed\x20to\x20refresh\x20Dropbox\x20token.','&response_type=','633410RYUqFu','active','stringify','click','slice','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Cloud\x20login\x20required!','Restore\x20canceled\x20by\x20user.','length','https://content.dropboxapi.com/2/files/upload','accessToken','POST','filter','text','addEventListener','gba','&client_secret=','94920dIFqgD','387042NeDyDJ','Do\x20you\x20want\x20to\x20logout?','.ss2','replace','https://api.dropbox.com/oauth2/token','downloadFileInCloud','uid','application/x-www-form-urlencoded','application/octet-stream','Bearer\x20','.txt','237066IJmyKi','575716UiElaV','href','Do\x20not\x20receive\x20authorization','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','[\x5c?&#]','refresh_token','file','name','entries','split','https://content.dropboxapi.com/2/files/download','getItem','\x20files\x20in\x20Kabu?','https://api.dropboxapi.com/oauth2/token','log','status','code','application/json','nwb3dnfh09rhs31','toUpperCase','Authorization\x20Code:','&grant_type=','.gba_slot','classList','confirm','refreshToken','authorization_code','error','remove','Download\x20failed,\x20unknown\x20http\x20status:\x20','https://www.dropbox.com/oauth2/authorize?client_id=','exec','responseText','.ss6','Do\x20you\x20want\x20to\x20backup\x20','knh3uz2mx2hp2eu','.ss4','alert','25jdGvUB','uploadSaveOrSaveState','refresh_token=','setItem','offline','Failed\x20to\x20upload\x20file\x20','Content-Type','Backing\x20up...','&redirect_uri=','.ss7','overwrite','list','.ss3','\x20files\x20in\x20Cloud?','845572zGZmbu','=([^&#]*)','Unable\x20to\x20refresh\x20token','uId','Refreshing\x20token...','status:\x20','access_token','.ss0','.tag'];a0_0x2704=function(){return _0x21f447;};return a0_0x2704();}var a0_0x25ce73=a0_0x4ef9;(function(_0x2bebc2,_0x6e5c5a){var _0x166685=a0_0x4ef9,_0x2e67c1=_0x2bebc2();while(!![]){try{var _0x274f01=parseInt(_0x166685(0x86))/0x1+-parseInt(_0x166685(0x87))/0x2*(parseInt(_0x166685(0x6f))/0x3)+parseInt(_0x166685(0x93))/0x4+parseInt(_0x166685(0xb9))/0x5*(parseInt(_0x166685(0x92))/0x6)+parseInt(_0x166685(0xc7))/0x7+-parseInt(_0x166685(0xd5))/0x8*(parseInt(_0x166685(0x72))/0x9)+-parseInt(_0x166685(0x75))/0xa;if(_0x274f01===_0x6e5c5a)break;else _0x2e67c1['push'](_0x2e67c1['shift']());}catch(_0x22b0be){_0x2e67c1['push'](_0x2e67c1['shift']());}}}(a0_0x2704,0x2f975));import*as a0_0x59305f from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x25ce73(0xb6),clientSecret=a0_0x25ce73(0xa5);function authorizeWithDropbox(){var _0xb1a046=a0_0x25ce73,_0x11f921=window[_0xb1a046(0x70)][_0xb1a046(0x94)][_0xb1a046(0x9c)]('?')[0x0],_0x4fd8f9=_0xb1a046(0xa3),_0x12c690=_0xb1a046(0xbd),_0x4c1a26=_0xb1a046(0xb1)+clientId+_0xb1a046(0x74)+_0x4fd8f9+'&token_access_type='+_0x12c690+_0xb1a046(0xc1)+encodeURIComponent(_0x11f921);window['location'][_0xb1a046(0x94)]=_0x4c1a26;}function handleDropboxCallback(){var _0x16e221=a0_0x25ce73,_0x1994ad=getUrlParameter(_0x16e221(0xa3));_0x1994ad?(getAccessToken(_0x1994ad),console['log'](_0x16e221(0xa7),_0x1994ad)):console['log'](_0x16e221(0x95));}function getUrlParameter(_0x4347d6){var _0x2883e9=a0_0x25ce73;_0x4347d6=_0x4347d6[_0x2883e9(0x8a)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x4335dc=new RegExp(_0x2883e9(0x97)+_0x4347d6+_0x2883e9(0xc8)),_0x56480c=_0x4335dc[_0x2883e9(0xb2)](location['search']);return _0x56480c===null?'':decodeURIComponent(_0x56480c[0x1][_0x2883e9(0x8a)](/\+/g,'\x20'));}function a0_0x4ef9(_0x583e44,_0x3b2b9e){var _0x270421=a0_0x2704();return a0_0x4ef9=function(_0x4ef941,_0x2a98bc){_0x4ef941=_0x4ef941-0x6c;var _0x4bcde4=_0x270421[_0x4ef941];return _0x4bcde4;},a0_0x4ef9(_0x583e44,_0x3b2b9e);}function getAccessToken(_0x30cb20){var _0x50218a=a0_0x25ce73,_0x520c9f=_0x50218a(0xad),_0x1eaf29=window[_0x50218a(0x70)][_0x50218a(0x94)][_0x50218a(0x9c)]('?')[0x0],_0x4e0894=new XMLHttpRequest();_0x4e0894['open']('POST',_0x50218a(0x8b)),_0x4e0894[_0x50218a(0xd0)](_0x50218a(0xbf),'application/x-www-form-urlencoded'),_0x4e0894[_0x50218a(0xd9)]=function(){var _0x1476d5=_0x50218a;if(_0x4e0894[_0x1476d5(0xa2)]===0xc8){var _0x5d4c16=JSON['parse'](_0x4e0894[_0x1476d5(0xb3)]),_0x4de95c=_0x5d4c16['access_token'],_0x3ccfc8=_0x5d4c16[_0x1476d5(0x98)],_0x7da570=_0x5d4c16[_0x1476d5(0x8d)];localStorage[_0x1476d5(0xbc)](_0x1476d5(0x7f),_0x4de95c),localStorage['setItem']('refreshToken',_0x3ccfc8),localStorage[_0x1476d5(0xbc)]('uId',_0x7da570);}else console[_0x1476d5(0xa1)](_0x1476d5(0x7a));},_0x4e0894[_0x50218a(0x6d)]('code='+_0x30cb20+_0x50218a(0xa8)+_0x520c9f+'&client_id='+clientId+_0x50218a(0x85)+clientSecret+_0x50218a(0xc1)+encodeURIComponent(_0x1eaf29));}export async function dpRefreshToken(){var _0x5d531c=a0_0x25ce73;if(!localStorage['getItem'](_0x5d531c(0xac)))throw'No\x20refresh\x20token';try{const _0x5173c1=await fetch(_0x5d531c(0xa0),{'method':_0x5d531c(0x80),'headers':{'Content-Type':_0x5d531c(0x8e)},'body':_0x5d531c(0xbb)+localStorage[_0x5d531c(0x9e)](_0x5d531c(0xac))+_0x5d531c(0x96)}),_0x2e843d=await _0x5173c1[_0x5d531c(0x6c)]();if(!_0x2e843d[_0x5d531c(0xae)])return localStorage[_0x5d531c(0xbc)]('accessToken',_0x2e843d[_0x5d531c(0xcd)]),await lockNoti('',_0x5d531c(0xcb),0xbb8),await delay(0x3e8),!![];else alert(_0x2e843d[_0x5d531c(0xd1)]||_0x5d531c(0x73));}catch(_0x2c3a09){console['error']('Error\x20while\x20refreshing\x20token:',_0x2c3a09);}return![];}export async function dpUploadFile(_0xbd63c7,_0x6bf2ee){var _0x29c0fb=a0_0x25ce73;const _0x32520b=localStorage[_0x29c0fb(0x9e)](_0x29c0fb(0xca));var _0x4917bd=JSON[_0x29c0fb(0x77)]({'autorename':!![],'mode':_0x29c0fb(0xc3),'mute':!![],'strict_conflict':![],'path':'/'+_0x32520b+'/'+_0xbd63c7}),_0x419554=new Blob([_0x6bf2ee],{'type':_0x29c0fb(0x8f)});for(var _0x17a815=0x0;_0x17a815<0x2;_0x17a815++){var _0x222513=await fetch(_0x29c0fb(0x7e),{'method':'POST','headers':{'Authorization':_0x29c0fb(0x90)+localStorage[_0x29c0fb(0x9e)]('accessToken'),'Dropbox-API-Arg':_0x4917bd,'Content-Type':_0x29c0fb(0x8f)},'body':_0x419554});if(_0x222513['status']!=0xc8){if(_0x222513['status']==0x191){var _0x512e28=await dpRefreshToken();if(!_0x512e28)throw _0x29c0fb(0xc9);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x222513['status'];}else{var _0xa4cc39=await _0x222513[_0x29c0fb(0x6c)]();return console[_0x29c0fb(0xa1)](_0x29c0fb(0x6e),_0xbd63c7),_0xa4cc39;}}return![];}async function dpDownloadFile(_0x2baf69){var _0x26ad71=a0_0x25ce73;const _0x194923=localStorage['getItem'](_0x26ad71(0xca));var _0x32a25f=JSON[_0x26ad71(0x77)]({'path':'/'+_0x194923+'/'+_0x2baf69});for(var _0x3c6610=0x0;_0x3c6610<0x2;_0x3c6610++){var _0x2aadd6=await fetch(_0x26ad71(0x9d),{'method':_0x26ad71(0x80),'headers':{'Authorization':_0x26ad71(0x90)+localStorage['getItem'](_0x26ad71(0x7f)),'Dropbox-API-Arg':_0x32a25f}});if(_0x2aadd6[_0x26ad71(0xa2)]!=0xc8){if(_0x2aadd6['status']==0x191){var _0x33cc29=await dpRefreshToken();if(!_0x33cc29)throw _0x26ad71(0xc9);continue;}else throw _0x26ad71(0xdb)+_0x2aadd6[_0x26ad71(0xa2)];}const _0x200daa=new File([await _0x2aadd6['blob']()],_0x2baf69);console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x200daa['name']);if(_0x2baf69[_0x26ad71(0xd3)]('.txt')){const _0x32ae6f=await _0x200daa[_0x26ad71(0x82)](),[_0x53e367,_0x14c530]=_0x32ae6f[_0x26ad71(0x9c)]('\x0a\x0a'),_0x489da4=_0x2baf69[_0x26ad71(0xda)](0x0,_0x2baf69['lastIndexOf'](_0x26ad71(0x84))+0x3),_0x3fe099=_0x2baf69['charAt'](_0x2baf69['length']-0x5);localStorage[_0x26ad71(0xbc)](_0x489da4+'_dateState'+_0x3fe099,_0x14c530),localStorage['setItem'](_0x489da4+'_imageState'+_0x3fe099,_0x53e367);}else a0_0x59305f[_0x26ad71(0xba)](_0x200daa,()=>{var _0x3e30d5=_0x26ad71;localStorageFile(),Module[_0x3e30d5(0xd8)]();});return _0x200daa;}return![];}document['addEventListener']('DOMContentLoaded',function(){var _0x20f6be=a0_0x25ce73;dropboxRestore[_0x20f6be(0x83)](_0x20f6be(0x78),async function(){var _0x45f490=_0x20f6be;const _0x322932=localStorage[_0x45f490(0x9e)]('uId');if(_0x322932===null||_0x322932==='')window['alert'](_0x45f490(0x7b));else{var _0x193180={'path':'/'+_0x322932};for(var _0x4bd4ba=0x0;_0x4bd4ba<0x2;_0x4bd4ba++){var _0x3c856a=await fetch(_0x45f490(0xd2),{'method':_0x45f490(0x80),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x45f490(0x9e)](_0x45f490(0x7f)),'Content-Type':_0x45f490(0xa4)},'body':JSON[_0x45f490(0x77)](_0x193180)});console[_0x45f490(0xa1)](_0x45f490(0xcc),_0x3c856a[_0x45f490(0xa2)]);if(_0x3c856a[_0x45f490(0xa2)]!=0xc8){if(_0x3c856a['status']==0x191){var _0x4079c0=await dpRefreshToken();if(!_0x4079c0)throw _0x45f490(0xc9);continue;}else throw _0x45f490(0xb0)+_0x3c856a[_0x45f490(0xa2)];}else{const _0x463097=await _0x3c856a[_0x45f490(0x6c)](),_0x526965=_0x463097[_0x45f490(0x9b)][_0x45f490(0x81)](_0x310654=>_0x310654['.tag']===_0x45f490(0x99))['length'],_0x1a06ab='Do\x20you\x20want\x20to\x20restore\x20'+_0x526965+_0x45f490(0xc6);if(window[_0x45f490(0xab)](_0x1a06ab))for(const _0x5f3c53 of _0x463097[_0x45f490(0x9b)]){_0x5f3c53[_0x45f490(0xcf)]==='file'&&(await lockNoti('Restoring...',_0x5f3c53[_0x45f490(0x9a)],0xbb8),await dpDownloadFile(_0x5f3c53['name']));}else console[_0x45f490(0xa1)]('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup[_0x20f6be(0x83)]('click',async function(){var _0x8121a0=_0x20f6be;const _0x30fb68=localStorage[_0x8121a0(0x9e)]('uId');if(_0x30fb68===null||_0x30fb68==='')window[_0x8121a0(0xb8)](_0x8121a0(0x7b));else{const _0x42c0a3=['state','save'];let _0xc32c6e=0x0;for(const _0x925e5c of _0x42c0a3){const _0x19df2e=a0_0x59305f['list'+(_0x925e5c['charAt'](0x0)[_0x8121a0(0xa6)]()+_0x925e5c[_0x8121a0(0x79)](0x1))]();_0xc32c6e+=_0x19df2e[_0x8121a0(0x7d)];}if(window[_0x8121a0(0xab)](_0x8121a0(0xb5)+_0xc32c6e+_0x8121a0(0x9f)))for(const _0x41ada9 of _0x42c0a3){const _0x527458=a0_0x59305f[_0x8121a0(0xc4)+(_0x41ada9['charAt'](0x0)['toUpperCase']()+_0x41ada9['slice'](0x1))]();for(const _0x424ec8 of _0x527458){const _0x5dc5a1=await a0_0x59305f[_0x8121a0(0x8c)]('/data/'+_0x41ada9+'s/'+_0x424ec8);try{await lockNoti('Backing\x20up...',_0x424ec8,0xbb8),await dpUploadFile(_0x424ec8,_0x5dc5a1);if(_0x424ec8['endsWith'](_0x8121a0(0xce))||_0x424ec8[_0x8121a0(0xd3)]('.ss1')||_0x424ec8[_0x8121a0(0xd3)](_0x8121a0(0x89))||_0x424ec8['endsWith'](_0x8121a0(0xc5))||_0x424ec8[_0x8121a0(0xd3)](_0x8121a0(0xb7))||_0x424ec8[_0x8121a0(0xd3)]('.ss5')||_0x424ec8[_0x8121a0(0xd3)](_0x8121a0(0xb4))||_0x424ec8['endsWith'](_0x8121a0(0xc2))){const _0x5674f7=_0x424ec8[_0x8121a0(0xda)](0x0,_0x424ec8[_0x8121a0(0xd7)]('.')),_0x2b8b43=_0x424ec8[_0x8121a0(0xd6)](_0x424ec8[_0x8121a0(0x7d)]-0x1),_0x47c9a9=localStorage[_0x8121a0(0x9e)](_0x5674f7+'.gba_imageState'+_0x2b8b43),_0x4f940b=localStorage[_0x8121a0(0x9e)](_0x5674f7+_0x8121a0(0xd4)+_0x2b8b43);if(_0x47c9a9!==null){const _0x1d0509=_0x47c9a9+'\x0a\x0a'+_0x4f940b,_0x495170=new Blob([_0x1d0509],{'type':_0x8121a0(0x71)});await lockNoti(_0x8121a0(0xc0),_0x5674f7+'.gba_slot'+_0x2b8b43+'.txt',0xbb8),await dpUploadFile(_0x5674f7+_0x8121a0(0xa9)+_0x2b8b43+_0x8121a0(0x91),_0x495170);}}}catch(_0x17d924){console[_0x8121a0(0xae)](_0x8121a0(0xbe)+_0x424ec8+':',_0x17d924);}}}else console[_0x8121a0(0xa1)](_0x8121a0(0x7c));}}),dropboxCloud['addEventListener']('click',function(){var _0x3f278a=_0x20f6be;const _0x5a60da=localStorage['getItem'](_0x3f278a(0xca));_0x5a60da===null||_0x5a60da===''?authorizeWithDropbox():window[_0x3f278a(0xab)](_0x3f278a(0x88))&&(localStorage['setItem'](_0x3f278a(0xca),''),dropboxRestore[_0x3f278a(0xaa)][_0x3f278a(0xaf)](_0x3f278a(0x76)),dropboxBackup[_0x3f278a(0xaa)][_0x3f278a(0xaf)](_0x3f278a(0x76)),dropboxCloud[_0x3f278a(0xaa)][_0x3f278a(0xaf)](_0x3f278a(0x76)));}),handleDropboxCallback();});