var a0_0x14aa28=a0_0x5be1;(function(_0x16b6d9,_0x97c641){var _0x4038e3=a0_0x5be1,_0x1c7ef6=_0x16b6d9();while(!![]){try{var _0x1dabfb=parseInt(_0x4038e3(0x105))/0x1*(-parseInt(_0x4038e3(0xef))/0x2)+parseInt(_0x4038e3(0x131))/0x3*(-parseInt(_0x4038e3(0x137))/0x4)+-parseInt(_0x4038e3(0xda))/0x5+parseInt(_0x4038e3(0x10f))/0x6*(-parseInt(_0x4038e3(0x10a))/0x7)+-parseInt(_0x4038e3(0x138))/0x8*(-parseInt(_0x4038e3(0xf2))/0x9)+-parseInt(_0x4038e3(0xfd))/0xa+parseInt(_0x4038e3(0xf4))/0xb*(parseInt(_0x4038e3(0xf5))/0xc);if(_0x1dabfb===_0x97c641)break;else _0x1c7ef6['push'](_0x1c7ef6['shift']());}catch(_0x2ef974){_0x1c7ef6['push'](_0x1c7ef6['shift']());}}}(a0_0x3634,0xe5c52));import*as a0_0x222792 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x14aa28(0xf6);function a0_0x3634(){var _0x36d4df=['accessToken','uid','[\x5c?&#]','uId','length','status','&response_type=','/data/','Folder\x20created','replace','Cloud\x20login\x20required!','&redirect_uri=','name','blob','application/x-www-form-urlencoded','overwrite','classList','authorization_code','folder','search','Do\x20you\x20want\x20to\x20backup\x20','Download\x20failed,\x20unknown\x20http\x20status:','Authorization\x20Code:','getItem','downloadFileInCloud','Content-Type','Do\x20you\x20want\x20to\x20restore\x20','Kabu\x20storage\x20↦\x20Cloud\x20◆','Failed\x20to\x20upload\x20file\x20','Error\x20while\x20refreshing\x20token:','12810kLVKhK','push','No\x20refresh\x20token','DOMContentLoaded','stringify','location','1220uqaFjc','2804088HXVjpH','Failed\x20to\x20refresh\x20Dropbox\x20token.','exec','split','remove','uploadFileInCloud','\x20files\x20from\x20Cloud?','No\x20files\x20found\x20to\x20restore.','Restoring...','2285025vZOgan','addEventListener','onload','Unable\x20to\x20refresh\x20token','active','file','POST',',\x20status:\x20','https://api.dropboxapi.com/oauth2/token','screenshot','refreshToken','&client_id=','setRequestHeader','error','application/octet-stream','https://api.dropboxapi.com/2/files/list_folder','Bearer\x20','https://api.dropboxapi.com/2/files/create_folder_v2','alert','send','&token_access_type=','3058148lwcvUc','refresh_token','click','45MhtuzB','application/json','3806qARVwa','158016fbNuNR','nwb3dnfh09rhs31','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Restore\x20canceled\x20by\x20user.','https://api.dropbox.com/oauth2/token','.tag','href','Folder\x20already\x20exists','6074790nfLpJo','Download\x20failed\x20for\x20','Wait\x20a\x20little\x20bit...','Do\x20not\x20receive\x20authorization','https://www.dropbox.com/oauth2/authorize?client_id=','offline','json','save','1hIKsPE','Error\x20creating\x20folder\x20','access_token','map','=([^&#]*)','10301459tGRWFz','confirm','state','\x20files\x20in\x20Kabu?','log','6ggJKqI','code','open','setItem'];a0_0x3634=function(){return _0x36d4df;};return a0_0x3634();}function authorizeWithDropbox(){var _0x206fe7=a0_0x14aa28,_0x45ca5f=window[_0x206fe7(0x136)][_0x206fe7(0xfb)][_0x206fe7(0x13b)]('?')[0x0],_0x35b355=_0x206fe7(0x110),_0x91ed52=_0x206fe7(0x102),_0x295f5e=_0x206fe7(0x101)+clientId+_0x206fe7(0x119)+_0x35b355+_0x206fe7(0xee)+_0x91ed52+_0x206fe7(0x11e)+encodeURIComponent(_0x45ca5f);window[_0x206fe7(0x136)]['href']=_0x295f5e;}function handleDropboxCallback(){var _0x17fe13=a0_0x14aa28,_0x5218ee=getUrlParameter('code');_0x5218ee?(getAccessToken(_0x5218ee),console['log'](_0x17fe13(0x129),_0x5218ee)):console['log'](_0x17fe13(0x100));}function getUrlParameter(_0x426507){var _0x5e88a3=a0_0x14aa28;_0x426507=_0x426507['replace'](/[\[]/,'\x5c[')[_0x5e88a3(0x11c)](/[\]]/,'\x5c]');var _0x4caf2c=new RegExp(_0x5e88a3(0x115)+_0x426507+_0x5e88a3(0x109)),_0x40ae70=_0x4caf2c[_0x5e88a3(0x13a)](location[_0x5e88a3(0x126)]);return _0x40ae70===null?'':decodeURIComponent(_0x40ae70[0x1][_0x5e88a3(0x11c)](/\+/g,'\x20'));}function a0_0x5be1(_0x47cfa1,_0x40ac1d){var _0x363473=a0_0x3634();return a0_0x5be1=function(_0x5be1a5,_0x3b1f7e){_0x5be1a5=_0x5be1a5-0xda;var _0xeaafb7=_0x363473[_0x5be1a5];return _0xeaafb7;},a0_0x5be1(_0x47cfa1,_0x40ac1d);}function getAccessToken(_0x69e8bb){var _0x3b0434=a0_0x14aa28,_0x465f01=_0x3b0434(0x124),_0x278664=window[_0x3b0434(0x136)][_0x3b0434(0xfb)]['split']('?')[0x0],_0x241a3f=new XMLHttpRequest();_0x241a3f[_0x3b0434(0x111)](_0x3b0434(0xe0),_0x3b0434(0xf9)),_0x241a3f[_0x3b0434(0xe6)](_0x3b0434(0x12c),_0x3b0434(0x121)),_0x241a3f[_0x3b0434(0xdc)]=function(){var _0x261e26=_0x3b0434;if(_0x241a3f['status']===0xc8){var _0x105f01=JSON['parse'](_0x241a3f['responseText']),_0x5d6e95=_0x105f01[_0x261e26(0x107)],_0x4caa59=_0x105f01[_0x261e26(0xf0)],_0xa34cf6=_0x105f01[_0x261e26(0x114)];localStorage[_0x261e26(0x112)](_0x261e26(0x113),_0x5d6e95),localStorage[_0x261e26(0x112)](_0x261e26(0xe4),_0x4caa59),localStorage['setItem'](_0x261e26(0x116),_0xa34cf6);}else console[_0x261e26(0x10e)](_0x261e26(0xf7));},_0x241a3f[_0x3b0434(0xed)]('code='+_0x69e8bb+'&grant_type='+_0x465f01+_0x3b0434(0xe5)+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0x278664));}export async function dpCreateFolder(_0x481af4){var _0x563de9=a0_0x14aa28;const _0x3de610=localStorage[_0x563de9(0x12a)]('uId');let _0x53eb97=localStorage[_0x563de9(0x12a)](_0x563de9(0x113));const _0x2f295c='/'+_0x3de610+'/'+_0x481af4,_0x49b858=JSON['stringify']({'path':_0x2f295c,'autorename':![]});for(let _0x371258=0x0;_0x371258<0x2;_0x371258++){try{const _0x412012=await fetch(_0x563de9(0xeb),{'method':'POST','headers':{'Authorization':_0x563de9(0xea)+_0x53eb97,'Content-Type':_0x563de9(0xf3)},'body':_0x49b858});if(_0x412012[_0x563de9(0x118)]===0x191){const _0xbfcd23=await dpRefreshToken();if(!_0xbfcd23)throw new Error(_0x563de9(0xdd));_0x53eb97=localStorage['getItem']('accessToken');continue;}if(_0x412012['status']===0x199)return{'message':_0x563de9(0xfc),'path':_0x481af4};if(!_0x412012['ok'])throw new Error(_0x563de9(0x106)+_0x481af4);const _0x4d8572=await _0x412012[_0x563de9(0x103)]();return await lockNoti(_0x563de9(0x11b),'',0xbb8),_0x4d8572;}catch(_0x3b906a){if(_0x371258===0x1)throw _0x3b906a;}}return![];}export async function dpRefreshToken(){var _0x337ba7=a0_0x14aa28;if(!localStorage[_0x337ba7(0x12a)](_0x337ba7(0xe4)))throw _0x337ba7(0x133);try{const _0x4c4d6e=await fetch(_0x337ba7(0xe2),{'method':_0x337ba7(0xe0),'headers':{'Content-Type':_0x337ba7(0x121)},'body':'refresh_token='+localStorage[_0x337ba7(0x12a)](_0x337ba7(0xe4))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x5207b1=await _0x4c4d6e['json']();if(!_0x5207b1[_0x337ba7(0xe7)])return localStorage[_0x337ba7(0x112)](_0x337ba7(0x113),_0x5207b1[_0x337ba7(0x107)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x5207b1['error_description']||_0x337ba7(0x139));}catch(_0x2a8112){console[_0x337ba7(0xe7)](_0x337ba7(0x130),_0x2a8112);}return![];}export async function dpUploadFile(_0x5925cf,_0xcd0c85,_0x5b309b){var _0x1cf459=a0_0x14aa28;const _0x193de4=localStorage[_0x1cf459(0x12a)](_0x1cf459(0x116));var _0x24b483=JSON[_0x1cf459(0x135)]({'autorename':!![],'mode':_0x1cf459(0x122),'mute':!![],'strict_conflict':![],'path':'/'+_0x193de4+'/'+_0x5b309b+'/'+_0x5925cf}),_0x5ecca3=new Blob([_0xcd0c85],{'type':_0x1cf459(0xe8)});for(var _0x2f66a1=0x0;_0x2f66a1<0x2;_0x2f66a1++){var _0x443bfe=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x1cf459(0xe0),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x1cf459(0x12a)](_0x1cf459(0x113)),'Dropbox-API-Arg':_0x24b483,'Content-Type':_0x1cf459(0xe8)},'body':_0x5ecca3});if(_0x443bfe['status']!=0xc8){if(_0x443bfe[_0x1cf459(0x118)]==0x191){var _0x224b94=await dpRefreshToken();if(!_0x224b94)throw _0x1cf459(0xdd);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x443bfe['status'];}else{var _0x47f850=await _0x443bfe[_0x1cf459(0x103)]();return console[_0x1cf459(0x10e)](_0x1cf459(0x12e),_0x5925cf),_0x47f850;}}return![];}export async function dpDownloadFile(_0x56a1c7,_0x1eed38){var _0x3aa21f=a0_0x14aa28;const _0x27602f=localStorage[_0x3aa21f(0x12a)](_0x3aa21f(0x116));var _0x131aec=JSON[_0x3aa21f(0x135)]({'path':'/'+_0x27602f+'/'+_0x1eed38+'/'+_0x56a1c7});for(var _0x198545=0x0;_0x198545<0x2;_0x198545++){var _0x59084b=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x3aa21f(0xe0),'headers':{'Authorization':_0x3aa21f(0xea)+localStorage[_0x3aa21f(0x12a)](_0x3aa21f(0x113)),'Dropbox-API-Arg':_0x131aec}});if(_0x59084b['status']!=0xc8){if(_0x59084b['status']==0x191){var _0x48ca2c=await dpRefreshToken();if(!_0x48ca2c)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x3aa21f(0x128)+_0x59084b['status'];}const _0x22b629=new File([await _0x59084b[_0x3aa21f(0x120)]()],_0x56a1c7);return console[_0x3aa21f(0x10e)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x22b629[_0x3aa21f(0x11f)]),a0_0x222792[_0x3aa21f(0x13d)](_0x22b629,()=>{}),_0x22b629;}return![];}document[a0_0x14aa28(0xdb)](a0_0x14aa28(0x134),function(){var _0x11e139=a0_0x14aa28;dropboxRestore[_0x11e139(0xdb)](_0x11e139(0xf1),async function(){var _0x4a33f9=_0x11e139;await lockNoti(_0x4a33f9(0xff),'',0x1388);const _0x5ca263=localStorage[_0x4a33f9(0x12a)](_0x4a33f9(0x116)),_0x56a80a=['state',_0x4a33f9(0x104),_0x4a33f9(0xe3)];if(!_0x5ca263){window[_0x4a33f9(0xec)]('Cloud\x20login\x20required!');return;}let _0xecc9af=[];for(const _0x53daa0 of _0x56a80a){let _0x3c4aae={'path':'/'+_0x5ca263+'/'+_0x53daa0};for(let _0x5d5438=0x0;_0x5d5438<0x2;_0x5d5438++){let _0x40c2a4=await fetch(_0x4a33f9(0xe9),{'method':_0x4a33f9(0xe0),'headers':{'Authorization':_0x4a33f9(0xea)+localStorage[_0x4a33f9(0x12a)](_0x4a33f9(0x113)),'Content-Type':'application/json'},'body':JSON[_0x4a33f9(0x135)](_0x3c4aae)});if(_0x40c2a4[_0x4a33f9(0x118)]===0xc8){let _0x31e87a=await _0x40c2a4[_0x4a33f9(0x103)](),_0x85fe45=_0x31e87a['entries']['filter'](_0x5019b4=>_0x5019b4[_0x4a33f9(0xfa)]===_0x4a33f9(0xdf));_0x85fe45[_0x4a33f9(0x117)]>0x0&&_0xecc9af[_0x4a33f9(0x132)](..._0x85fe45[_0x4a33f9(0x108)](_0x30c6aa=>({'name':_0x30c6aa[_0x4a33f9(0x11f)],'folder':_0x53daa0})));break;}else{if(_0x40c2a4[_0x4a33f9(0x118)]===0x191){let _0x3c2ec3=await dpRefreshToken();if(!_0x3c2ec3)throw _0x4a33f9(0xdd);}else{console[_0x4a33f9(0xe7)](_0x4a33f9(0xfe)+_0x53daa0+_0x4a33f9(0xe1)+_0x40c2a4['status']);break;}}}}if(_0xecc9af[_0x4a33f9(0x117)]>0x0){const _0x3b46e9=_0x4a33f9(0x12d)+_0xecc9af[_0x4a33f9(0x117)]+_0x4a33f9(0x13e);if(window['confirm'](_0x3b46e9))for(const _0x239bfc of _0xecc9af){await lockNoti(_0x4a33f9(0x140),_0x239bfc[_0x4a33f9(0x11f)],0xbb8),await dpDownloadFile(_0x239bfc[_0x4a33f9(0x11f)],_0x239bfc[_0x4a33f9(0x125)]);}else console[_0x4a33f9(0x10e)](_0x4a33f9(0xf8));}else console['log'](_0x4a33f9(0x13f));}),dropboxBackup[_0x11e139(0xdb)]('click',async function(){var _0x1407dd=_0x11e139;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x1853e8=localStorage[_0x1407dd(0x12a)](_0x1407dd(0x116));if(_0x1853e8===null||_0x1853e8==='')window[_0x1407dd(0xec)](_0x1407dd(0x11d));else{const _0x5ccddc=[_0x1407dd(0x10c),_0x1407dd(0x104),_0x1407dd(0xe3)];for(const _0x45a051 of _0x5ccddc){await dpCreateFolder(_0x45a051);}let _0x3131b7=0x0;for(const _0x4563e8 of _0x5ccddc){const _0x241fff=a0_0x222792['listFiles'](_0x4563e8+'s');_0x3131b7+=_0x241fff['length'];}if(window[_0x1407dd(0x10b)](_0x1407dd(0x127)+_0x3131b7+_0x1407dd(0x10d)))for(const _0x5dd13 of _0x5ccddc){const _0x5cc165=a0_0x222792['listFiles'](_0x5dd13+'s');for(const _0x530d64 of _0x5cc165){const _0x5ee185=await a0_0x222792[_0x1407dd(0x12b)](_0x1407dd(0x11a)+_0x5dd13+'s/'+_0x530d64);try{await lockNoti('Backing\x20up...',_0x530d64,0xbb8),await dpUploadFile(_0x530d64,_0x5ee185,_0x5dd13);}catch(_0x5d9732){console[_0x1407dd(0xe7)](_0x1407dd(0x12f)+_0x530d64+':',_0x5d9732);}}}else console[_0x1407dd(0x10e)](_0x1407dd(0xf8));}}),dropboxCloud['addEventListener'](_0x11e139(0xf1),function(){var _0x2df811=_0x11e139;const _0x143249=localStorage['getItem'](_0x2df811(0x116));_0x143249===null||_0x143249===''?authorizeWithDropbox():window[_0x2df811(0x10b)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x2df811(0x112)](_0x2df811(0x116),''),dropboxRestore[_0x2df811(0x123)][_0x2df811(0x13c)](_0x2df811(0xde)),dropboxBackup[_0x2df811(0x123)]['remove'](_0x2df811(0xde)),dropboxCloud[_0x2df811(0x123)][_0x2df811(0x13c)](_0x2df811(0xde)));}),handleDropboxCallback();});