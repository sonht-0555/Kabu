var a0_0x4cc7f3=a0_0x54bd;function a0_0x1220(){var _0x17f339=['split','blob','\x20files\x20in\x20Kabu?','setItem','https://www.dropbox.com/oauth2/authorize?client_id=','.ss7','3152429xGGYvs','access_token','replace','list','2604414MTHsgz','Error\x20while\x20refreshing\x20token:','/data/','https://api.dropboxapi.com/2/files/list_folder','3825XCHyLF','.ss0','.ss1','location','=([^&#]*)','Authorization\x20Code:','stringify','error','refreshToken','905160dwSILw','&token_access_type=','.ss4','search','Download\x20failed,\x20unknown\x20http\x20status:\x20','Do\x20not\x20receive\x20authorization','entries','onload','DOMContentLoaded','https://api.dropboxapi.com/oauth2/token','accessToken','responseText','&response_type=','status','Cloud\x20login\x20required!','&client_secret=','Backing\x20up...','Do\x20you\x20want\x20to\x20restore\x20','https://content.dropboxapi.com/2/files/upload','error_description','Do\x20you\x20want\x20to\x20backup\x20','.ss5','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','remove','state','classList','Content-Type','refresh_token','Cloud\x20↦\x20Kabu\x20storage\x20◆','Restoring...','endsWith','[\x5c?&#]','1074725qGZiTa','send','.txt','uId','https://api.dropbox.com/oauth2/token','&redirect_uri=','&grant_type=','downloadFileInCloud','slice','Download\x20failed,\x20unknown\x20http\x20status:','offline','code','&client_id=','length','.tag','click','https://content.dropboxapi.com/2/files/download','Unable\x20to\x20refresh\x20token','Bearer\x20','log','knh3uz2mx2hp2eu','4bVQgyW','file','application/json','3041613DiPvkw','Kabu\x20storage\x20↦\x20Cloud\x20◆','text/plain','exec','text','.ss2','.gba_slot','_dateState','authorization_code','setRequestHeader','charAt','lastIndexOf','active','application/octet-stream','Do\x20you\x20want\x20to\x20logout?','filter','_imageState','Restore\x20canceled\x20by\x20user.','confirm','name','addEventListener','16foDoso','getItem','href','status:\x20','json','alert','.ss6','No\x20refresh\x20token','.gba_imageState','Upload\x20failed,\x20unknown\x20http\x20status:\x20','.ss3','POST','save','778860rMYgmc','\x20files\x20in\x20Cloud?','toUpperCase'];a0_0x1220=function(){return _0x17f339;};return a0_0x1220();}(function(_0x569278,_0x54e3de){var _0x5084b0=a0_0x54bd,_0x65afe1=_0x569278();while(!![]){try{var _0x173edc=-parseInt(_0x5084b0(0x1a2))/0x1+parseInt(_0x5084b0(0x1ab))/0x2+parseInt(_0x5084b0(0x191))/0x3+parseInt(_0x5084b0(0x16c))/0x4*(parseInt(_0x5084b0(0x157))/0x5)+parseInt(_0x5084b0(0x19e))/0x6+-parseInt(_0x5084b0(0x19a))/0x7+-parseInt(_0x5084b0(0x184))/0x8*(parseInt(_0x5084b0(0x16f))/0x9);if(_0x173edc===_0x54e3de)break;else _0x65afe1['push'](_0x65afe1['shift']());}catch(_0xb5e1c4){_0x65afe1['push'](_0x65afe1['shift']());}}}(a0_0x1220,0x386d8));import*as a0_0x497663 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x4cc7f3(0x16b),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x175104=a0_0x4cc7f3,_0x5eb57d=window[_0x175104(0x1a5)][_0x175104(0x186)][_0x175104(0x194)]('?')[0x0],_0x52b9c7=_0x175104(0x162),_0x45b267=_0x175104(0x161),_0x1589c7=_0x175104(0x198)+clientId+_0x175104(0x143)+_0x52b9c7+_0x175104(0x138)+_0x45b267+_0x175104(0x15c)+encodeURIComponent(_0x5eb57d);window[_0x175104(0x1a5)][_0x175104(0x186)]=_0x1589c7;}function handleDropboxCallback(){var _0x521a9c=a0_0x4cc7f3,_0x5061a7=getUrlParameter('code');_0x5061a7?(getAccessToken(_0x5061a7),console[_0x521a9c(0x16a)](_0x521a9c(0x1a7),_0x5061a7)):console['log'](_0x521a9c(0x13c));}function getUrlParameter(_0x149d24){var _0x1bc6ae=a0_0x4cc7f3;_0x149d24=_0x149d24[_0x1bc6ae(0x19c)](/[\[]/,'\x5c[')[_0x1bc6ae(0x19c)](/[\]]/,'\x5c]');var _0x42a90e=new RegExp(_0x1bc6ae(0x156)+_0x149d24+_0x1bc6ae(0x1a6)),_0x2d117b=_0x42a90e[_0x1bc6ae(0x172)](location[_0x1bc6ae(0x13a)]);return _0x2d117b===null?'':decodeURIComponent(_0x2d117b[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x3fecc7){var _0x1a162b=a0_0x4cc7f3,_0x3f8527=_0x1a162b(0x177),_0x1930f4=window['location'][_0x1a162b(0x186)][_0x1a162b(0x194)]('?')[0x0],_0x34a5b3=new XMLHttpRequest();_0x34a5b3['open'](_0x1a162b(0x18f),_0x1a162b(0x15b)),_0x34a5b3[_0x1a162b(0x178)](_0x1a162b(0x151),'application/x-www-form-urlencoded'),_0x34a5b3[_0x1a162b(0x13e)]=function(){var _0x2d901c=_0x1a162b;if(_0x34a5b3[_0x2d901c(0x144)]===0xc8){var _0x4f2db5=JSON['parse'](_0x34a5b3[_0x2d901c(0x142)]),_0x235e45=_0x4f2db5[_0x2d901c(0x19b)],_0x58192c=_0x4f2db5[_0x2d901c(0x152)],_0x2c30b5=_0x4f2db5['uid'];localStorage['setItem'](_0x2d901c(0x141),_0x235e45),localStorage[_0x2d901c(0x197)]('refreshToken',_0x58192c),localStorage[_0x2d901c(0x197)](_0x2d901c(0x15a),_0x2c30b5);}else console[_0x2d901c(0x16a)](_0x2d901c(0x14d));},_0x34a5b3[_0x1a162b(0x158)]('code='+_0x3fecc7+_0x1a162b(0x15d)+_0x3f8527+_0x1a162b(0x163)+clientId+_0x1a162b(0x146)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x1930f4));}export async function dpRefreshToken(){var _0x32c858=a0_0x4cc7f3;if(!localStorage[_0x32c858(0x185)](_0x32c858(0x1aa)))throw _0x32c858(0x18b);try{const _0xb69d7f=await fetch(_0x32c858(0x140),{'method':_0x32c858(0x18f),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x32c858(0x185)](_0x32c858(0x1aa))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x35f2a0=await _0xb69d7f[_0x32c858(0x188)]();if(!_0x35f2a0[_0x32c858(0x1a9)])return localStorage['setItem'](_0x32c858(0x141),_0x35f2a0[_0x32c858(0x19b)]),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0x35f2a0[_0x32c858(0x14a)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x27c4a2){console['error'](_0x32c858(0x19f),_0x27c4a2);}return![];}export async function dpUploadFile(_0x2d10af,_0x2b42f1){var _0x615ae4=a0_0x4cc7f3;const _0x242f21=localStorage[_0x615ae4(0x185)](_0x615ae4(0x15a));var _0x4fbecf=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x242f21+'/'+_0x2d10af}),_0x2664d5=new Blob([_0x2b42f1],{'type':_0x615ae4(0x17c)});for(var _0x4254aa=0x0;_0x4254aa<0x2;_0x4254aa++){var _0x3ccef3=await fetch(_0x615ae4(0x149),{'method':_0x615ae4(0x18f),'headers':{'Authorization':_0x615ae4(0x169)+localStorage[_0x615ae4(0x185)](_0x615ae4(0x141)),'Dropbox-API-Arg':_0x4fbecf,'Content-Type':'application/octet-stream'},'body':_0x2664d5});if(_0x3ccef3[_0x615ae4(0x144)]!=0xc8){if(_0x3ccef3['status']==0x191){var _0x379d15=await dpRefreshToken();if(!_0x379d15)throw _0x615ae4(0x168);continue;}else throw _0x615ae4(0x18d)+_0x3ccef3[_0x615ae4(0x144)];}else{var _0x3684f7=await _0x3ccef3['json']();return console[_0x615ae4(0x16a)](_0x615ae4(0x170),_0x2d10af),_0x3684f7;}}return![];}function a0_0x54bd(_0x469a5a,_0x1d22a3){var _0x1220fe=a0_0x1220();return a0_0x54bd=function(_0x54bd2d,_0x23db6a){_0x54bd2d=_0x54bd2d-0x138;var _0x39c321=_0x1220fe[_0x54bd2d];return _0x39c321;},a0_0x54bd(_0x469a5a,_0x1d22a3);}async function dpDownloadFile(_0x23650a){var _0x48cd38=a0_0x4cc7f3;const _0x211a79=localStorage['getItem'](_0x48cd38(0x15a));var _0x5a0ed9=JSON[_0x48cd38(0x1a8)]({'path':'/'+_0x211a79+'/'+_0x23650a});for(var _0x256ba7=0x0;_0x256ba7<0x2;_0x256ba7++){var _0x2c9dd0=await fetch(_0x48cd38(0x167),{'method':_0x48cd38(0x18f),'headers':{'Authorization':_0x48cd38(0x169)+localStorage[_0x48cd38(0x185)](_0x48cd38(0x141)),'Dropbox-API-Arg':_0x5a0ed9}});if(_0x2c9dd0[_0x48cd38(0x144)]!=0xc8){if(_0x2c9dd0[_0x48cd38(0x144)]==0x191){var _0x1376f9=await dpRefreshToken();if(!_0x1376f9)throw _0x48cd38(0x168);continue;}else throw _0x48cd38(0x160)+_0x2c9dd0[_0x48cd38(0x144)];}const _0x227b5b=new File([await _0x2c9dd0[_0x48cd38(0x195)]()],_0x23650a);console[_0x48cd38(0x16a)](_0x48cd38(0x153),_0x227b5b[_0x48cd38(0x182)]);if(_0x23650a[_0x48cd38(0x155)](_0x48cd38(0x159))){const _0x22227d=await _0x227b5b[_0x48cd38(0x173)](),[_0x160142,_0x8c3513]=_0x22227d[_0x48cd38(0x194)]('\x0a\x0a'),_0x4f980b=_0x23650a['substring'](0x0,_0x23650a[_0x48cd38(0x17a)]('gba')+0x3),_0x6b9169=_0x23650a[_0x48cd38(0x179)](_0x23650a[_0x48cd38(0x164)]-0x5);localStorage[_0x48cd38(0x197)](_0x4f980b+_0x48cd38(0x176)+_0x6b9169,_0x8c3513),localStorage[_0x48cd38(0x197)](_0x4f980b+_0x48cd38(0x17f)+_0x6b9169,_0x160142);}else a0_0x497663['uploadSaveOrSaveState'](_0x227b5b,()=>{localStorageFile(),Module['FSSync']();});return _0x227b5b;}return![];}document[a0_0x4cc7f3(0x183)](a0_0x4cc7f3(0x13f),function(){var _0x160f4f=a0_0x4cc7f3;dropboxRestore['addEventListener'](_0x160f4f(0x166),async function(){var _0x5c5d06=_0x160f4f;const _0x1028b4=localStorage['getItem'](_0x5c5d06(0x15a));if(_0x1028b4===null||_0x1028b4==='')window[_0x5c5d06(0x189)](_0x5c5d06(0x145));else{var _0x42fb1a={'path':'/'+_0x1028b4};for(var _0x2ede1a=0x0;_0x2ede1a<0x2;_0x2ede1a++){var _0x44251c=await fetch(_0x5c5d06(0x1a1),{'method':_0x5c5d06(0x18f),'headers':{'Authorization':_0x5c5d06(0x169)+localStorage[_0x5c5d06(0x185)](_0x5c5d06(0x141)),'Content-Type':_0x5c5d06(0x16e)},'body':JSON[_0x5c5d06(0x1a8)](_0x42fb1a)});console[_0x5c5d06(0x16a)](_0x5c5d06(0x187),_0x44251c[_0x5c5d06(0x144)]);if(_0x44251c['status']!=0xc8){if(_0x44251c[_0x5c5d06(0x144)]==0x191){var _0xc459e2=await dpRefreshToken();if(!_0xc459e2)throw _0x5c5d06(0x168);continue;}else throw _0x5c5d06(0x13b)+_0x44251c[_0x5c5d06(0x144)];}else{const _0x289c81=await _0x44251c[_0x5c5d06(0x188)](),_0x15a7ef=_0x289c81[_0x5c5d06(0x13d)][_0x5c5d06(0x17e)](_0x3c44e5=>_0x3c44e5['.tag']===_0x5c5d06(0x16d))[_0x5c5d06(0x164)],_0x4de918=_0x5c5d06(0x148)+_0x15a7ef+_0x5c5d06(0x192);if(window[_0x5c5d06(0x181)](_0x4de918))for(const _0x1eaeca of _0x289c81[_0x5c5d06(0x13d)]){_0x1eaeca[_0x5c5d06(0x165)]===_0x5c5d06(0x16d)&&(await lockNoti(_0x5c5d06(0x154),_0x1eaeca[_0x5c5d06(0x182)],0xbb8),await dpDownloadFile(_0x1eaeca[_0x5c5d06(0x182)]));}else console['log'](_0x5c5d06(0x180));return!![];}}return![];}}),dropboxBackup[_0x160f4f(0x183)](_0x160f4f(0x166),async function(){var _0x451de4=_0x160f4f;const _0x224f65=localStorage[_0x451de4(0x185)](_0x451de4(0x15a));if(_0x224f65===null||_0x224f65==='')window[_0x451de4(0x189)](_0x451de4(0x145));else{const _0x50f7a0=[_0x451de4(0x14f),_0x451de4(0x190)];let _0x191c57=0x0;for(const _0x2e6af1 of _0x50f7a0){const _0x1cb1f7=a0_0x497663[_0x451de4(0x19d)+(_0x2e6af1['charAt'](0x0)[_0x451de4(0x193)]()+_0x2e6af1[_0x451de4(0x15f)](0x1))]();_0x191c57+=_0x1cb1f7[_0x451de4(0x164)];}if(window[_0x451de4(0x181)](_0x451de4(0x14b)+_0x191c57+_0x451de4(0x196)))for(const _0x5ae488 of _0x50f7a0){const _0x5bbfee=a0_0x497663[_0x451de4(0x19d)+(_0x5ae488[_0x451de4(0x179)](0x0)[_0x451de4(0x193)]()+_0x5ae488[_0x451de4(0x15f)](0x1))]();for(const _0x2ab244 of _0x5bbfee){const _0x443689=await a0_0x497663[_0x451de4(0x15e)](_0x451de4(0x1a0)+_0x5ae488+'s/'+_0x2ab244);try{await lockNoti(_0x451de4(0x147),_0x2ab244,0xbb8),await dpUploadFile(_0x2ab244,_0x443689);if(_0x2ab244[_0x451de4(0x155)](_0x451de4(0x1a3))||_0x2ab244[_0x451de4(0x155)](_0x451de4(0x1a4))||_0x2ab244[_0x451de4(0x155)](_0x451de4(0x174))||_0x2ab244[_0x451de4(0x155)](_0x451de4(0x18e))||_0x2ab244['endsWith'](_0x451de4(0x139))||_0x2ab244[_0x451de4(0x155)](_0x451de4(0x14c))||_0x2ab244['endsWith'](_0x451de4(0x18a))||_0x2ab244[_0x451de4(0x155)](_0x451de4(0x199))){const _0x2bcc69=_0x2ab244['substring'](0x0,_0x2ab244['lastIndexOf']('.')),_0x1d1529=_0x2ab244[_0x451de4(0x179)](_0x2ab244[_0x451de4(0x164)]-0x1),_0x186b4e=localStorage[_0x451de4(0x185)](_0x2bcc69+_0x451de4(0x18c)+_0x1d1529),_0x410291=localStorage['getItem'](_0x2bcc69+'.gba_dateState'+_0x1d1529);if(_0x186b4e!==null){const _0x40cf90=_0x186b4e+'\x0a\x0a'+_0x410291,_0x54b76f=new Blob([_0x40cf90],{'type':_0x451de4(0x171)});await lockNoti('Backing\x20up...',_0x2bcc69+'.gba_slot'+_0x1d1529+'.txt',0xbb8),await dpUploadFile(_0x2bcc69+_0x451de4(0x175)+_0x1d1529+_0x451de4(0x159),_0x54b76f);}}}catch(_0x3635c6){console[_0x451de4(0x1a9)]('Failed\x20to\x20upload\x20file\x20'+_0x2ab244+':',_0x3635c6);}}}else console[_0x451de4(0x16a)](_0x451de4(0x180));}}),dropboxCloud[_0x160f4f(0x183)]('click',function(){var _0x1ad28b=_0x160f4f;const _0x4c7f4e=localStorage[_0x1ad28b(0x185)]('uId');_0x4c7f4e===null||_0x4c7f4e===''?authorizeWithDropbox():window[_0x1ad28b(0x181)](_0x1ad28b(0x17d))&&(localStorage['setItem']('uId',''),dropboxRestore[_0x1ad28b(0x150)][_0x1ad28b(0x14e)]('active'),dropboxBackup[_0x1ad28b(0x150)][_0x1ad28b(0x14e)](_0x1ad28b(0x17b)),dropboxCloud[_0x1ad28b(0x150)][_0x1ad28b(0x14e)](_0x1ad28b(0x17b)));}),handleDropboxCallback();});