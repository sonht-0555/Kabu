function a0_0x7464(_0x2d8f2e,_0x520575){var _0x3eadbc=a0_0x3ead();return a0_0x7464=function(_0x7464b9,_0x56f096){_0x7464b9=_0x7464b9-0xc3;var _0x760d8d=_0x3eadbc[_0x7464b9];return _0x760d8d;},a0_0x7464(_0x2d8f2e,_0x520575);}var a0_0x3af6b2=a0_0x7464;function a0_0x3ead(){var _0x2a9278=['[\x5c?&#]','split','Do\x20you\x20want\x20to\x20restore\x20','https://api.dropbox.com/oauth2/token','overwrite','error','error_description','=([^&#]*)','search','https://www.dropbox.com/oauth2/authorize?client_id=','application/json',',\x20status:\x20','Cloud\x20login\x20required!','Wait\x20a\x20little\x20bit...','Bearer\x20','6tZWaDv','remove','access_token','nwb3dnfh09rhs31','application/x-www-form-urlencoded','DOMContentLoaded','status','log','190uXLqtZ','parse','\x20files\x20from\x20Cloud?','POST','open','104448vVTLFD','click','refreshToken','blob','getItem','Restoring...','authorization_code','4116QipQqe','Upload\x20failed,\x20unknown\x20http\x20status:\x20','No\x20files\x20found\x20to\x20restore.','filter','setRequestHeader','2012VhQIMD','&response_type=','39681oEIxXE','length','map','Kabu\x20storage\x20↦\x20Cloud\x20◆','alert','classList','27500QGrDqS','save','Content-Type','984hPhjSg','uid','responseText','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','.tag','40dNdMFB','code','href','844530nAPKnC','Do\x20you\x20want\x20to\x20logout?','setItem','stringify','screenshot','&grant_type=','Error\x20while\x20refreshing\x20token:','name','Do\x20not\x20receive\x20authorization','Folder\x20created','exec','folder','uId','active','file','Folder\x20already\x20exists','3390wEjPIl','onload','state','Unable\x20to\x20refresh\x20token','https://api.dropboxapi.com/2/files/create_folder_v2','listFiles','location','Failed\x20to\x20upload\x20file\x20','replace','&redirect_uri=','uploadFileInCloud','Download\x20failed\x20for\x20','Failed\x20to\x20refresh\x20Dropbox\x20token.','1010891FEggMp','code=','application/octet-stream','send','https://api.dropboxapi.com/oauth2/token','addEventListener','json','confirm','&client_secret=','Backing\x20up...','No\x20refresh\x20token','/data/','&token_access_type=','accessToken'];a0_0x3ead=function(){return _0x2a9278;};return a0_0x3ead();}(function(_0x22ce79,_0x3b1d54){var _0x32092b=a0_0x7464,_0x20018f=_0x22ce79();while(!![]){try{var _0x1e29c3=parseInt(_0x32092b(0x10c))/0x1+parseInt(_0x32092b(0xc5))/0x2*(-parseInt(_0x32092b(0xff))/0x3)+parseInt(_0x32092b(0x118))/0x4*(parseInt(_0x32092b(0xd5))/0x5)+-parseInt(_0x32092b(0x113))/0x6+-parseInt(_0x32092b(0xe2))/0x7*(-parseInt(_0x32092b(0x128))/0x8)+-parseInt(_0x32092b(0x11a))/0x9*(parseInt(_0x32092b(0x107))/0xa)+parseInt(_0x32092b(0x120))/0xb*(parseInt(_0x32092b(0x123))/0xc);if(_0x1e29c3===_0x3b1d54)break;else _0x20018f['push'](_0x20018f['shift']());}catch(_0x4e2dad){_0x20018f['push'](_0x20018f['shift']());}}}(a0_0x3ead,0x6c4a8));import*as a0_0x18cd37 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x3af6b2(0x102);function authorizeWithDropbox(){var _0x51cbe4=a0_0x3af6b2,_0x424ce7=window['location'][_0x51cbe4(0xc4)][_0x51cbe4(0xf1)]('?')[0x0],_0x58d152=_0x51cbe4(0xc3),_0x402c84='offline',_0x1fdf3a=_0x51cbe4(0xf9)+clientId+_0x51cbe4(0x119)+_0x58d152+_0x51cbe4(0xee)+_0x402c84+_0x51cbe4(0xde)+encodeURIComponent(_0x424ce7);window[_0x51cbe4(0xdb)][_0x51cbe4(0xc4)]=_0x1fdf3a;}function handleDropboxCallback(){var _0x50f961=a0_0x3af6b2,_0xb3c5af=getUrlParameter(_0x50f961(0xc3));_0xb3c5af?(getAccessToken(_0xb3c5af),console['log']('Authorization\x20Code:',_0xb3c5af)):console['log'](_0x50f961(0xcd));}function getUrlParameter(_0x4ac1bc){var _0x423fad=a0_0x3af6b2;_0x4ac1bc=_0x4ac1bc['replace'](/[\[]/,'\x5c[')[_0x423fad(0xdd)](/[\]]/,'\x5c]');var _0x5dabbd=new RegExp(_0x423fad(0xf0)+_0x4ac1bc+_0x423fad(0xf7)),_0x4a28aa=_0x5dabbd[_0x423fad(0xcf)](location[_0x423fad(0xf8)]);return _0x4a28aa===null?'':decodeURIComponent(_0x4a28aa[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x345b28){var _0x1fc264=a0_0x3af6b2,_0x2f11ea=_0x1fc264(0x112),_0x4eed1a=window[_0x1fc264(0xdb)]['href'][_0x1fc264(0xf1)]('?')[0x0],_0x539fc0=new XMLHttpRequest();_0x539fc0[_0x1fc264(0x10b)](_0x1fc264(0x10a),_0x1fc264(0xf3)),_0x539fc0[_0x1fc264(0x117)](_0x1fc264(0x122),_0x1fc264(0x103)),_0x539fc0[_0x1fc264(0xd6)]=function(){var _0x334359=_0x1fc264;if(_0x539fc0[_0x334359(0x105)]===0xc8){var _0x3beee2=JSON[_0x334359(0x108)](_0x539fc0[_0x334359(0x125)]),_0x5d9b8c=_0x3beee2['access_token'],_0x191553=_0x3beee2['refresh_token'],_0x29910d=_0x3beee2[_0x334359(0x124)];localStorage[_0x334359(0xc7)](_0x334359(0xef),_0x5d9b8c),localStorage['setItem'](_0x334359(0x10e),_0x191553),localStorage['setItem']('uId',_0x29910d);}else console[_0x334359(0x106)](_0x334359(0x126));},_0x539fc0[_0x1fc264(0xe5)](_0x1fc264(0xe3)+_0x345b28+_0x1fc264(0xca)+_0x2f11ea+'&client_id='+clientId+_0x1fc264(0xea)+clientSecret+_0x1fc264(0xde)+encodeURIComponent(_0x4eed1a));}export async function dpCreateFolder(_0x19fbf9){var _0x36383e=a0_0x3af6b2;const _0x57115d=localStorage[_0x36383e(0x110)](_0x36383e(0xd1));let _0x4b6833=localStorage[_0x36383e(0x110)](_0x36383e(0xef));const _0x5663ab='/'+_0x57115d+'/'+_0x19fbf9,_0x311d82=JSON[_0x36383e(0xc8)]({'path':_0x5663ab,'autorename':![]});for(let _0x531496=0x0;_0x531496<0x2;_0x531496++){try{const _0xebc28=await fetch(_0x36383e(0xd9),{'method':'POST','headers':{'Authorization':_0x36383e(0xfe)+_0x4b6833,'Content-Type':_0x36383e(0xfa)},'body':_0x311d82});if(_0xebc28[_0x36383e(0x105)]===0x191){const _0x129eb2=await dpRefreshToken();if(!_0x129eb2)throw new Error(_0x36383e(0xd8));_0x4b6833=localStorage[_0x36383e(0x110)](_0x36383e(0xef));continue;}if(_0xebc28[_0x36383e(0x105)]===0x199)return{'message':_0x36383e(0xd4),'path':_0x19fbf9};if(!_0xebc28['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x19fbf9);const _0x15a042=await _0xebc28[_0x36383e(0xe8)]();return await lockNoti(_0x36383e(0xce),'',0xbb8),_0x15a042;}catch(_0xb13904){if(_0x531496===0x1)throw _0xb13904;}}return![];}export async function dpRefreshToken(){var _0x5923ee=a0_0x3af6b2;if(!localStorage[_0x5923ee(0x110)](_0x5923ee(0x10e)))throw _0x5923ee(0xec);try{const _0x3019e0=await fetch(_0x5923ee(0xe6),{'method':_0x5923ee(0x10a),'headers':{'Content-Type':_0x5923ee(0x103)},'body':'refresh_token='+localStorage[_0x5923ee(0x110)]('refreshToken')+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x5342ee=await _0x3019e0[_0x5923ee(0xe8)]();if(!_0x5342ee[_0x5923ee(0xf5)])return localStorage[_0x5923ee(0xc7)](_0x5923ee(0xef),_0x5342ee[_0x5923ee(0x101)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x5342ee[_0x5923ee(0xf6)]||_0x5923ee(0xe1));}catch(_0x2f036b){console[_0x5923ee(0xf5)](_0x5923ee(0xcb),_0x2f036b);}return![];}export async function dpUploadFile(_0x2d218e,_0x2520da,_0x27672b){var _0x38e8e3=a0_0x3af6b2;const _0x3892b6=localStorage[_0x38e8e3(0x110)](_0x38e8e3(0xd1));var _0x56f9a8=JSON['stringify']({'autorename':!![],'mode':_0x38e8e3(0xf4),'mute':!![],'strict_conflict':![],'path':'/'+_0x3892b6+'/'+_0x27672b+'/'+_0x2d218e}),_0x177164=new Blob([_0x2520da],{'type':_0x38e8e3(0xe4)});for(var _0x1f1237=0x0;_0x1f1237<0x2;_0x1f1237++){var _0x3d1113=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x38e8e3(0x10a),'headers':{'Authorization':_0x38e8e3(0xfe)+localStorage[_0x38e8e3(0x110)](_0x38e8e3(0xef)),'Dropbox-API-Arg':_0x56f9a8,'Content-Type':_0x38e8e3(0xe4)},'body':_0x177164});if(_0x3d1113[_0x38e8e3(0x105)]!=0xc8){if(_0x3d1113[_0x38e8e3(0x105)]==0x191){var _0x5e06d5=await dpRefreshToken();if(!_0x5e06d5)throw _0x38e8e3(0xd8);continue;}else throw _0x38e8e3(0x114)+_0x3d1113[_0x38e8e3(0x105)];}else{var _0x4e3271=await _0x3d1113[_0x38e8e3(0xe8)]();return console[_0x38e8e3(0x106)](_0x38e8e3(0x11d),_0x2d218e),_0x4e3271;}}return![];}export async function dpDownloadFile(_0x2d02c5,_0x4f3401){var _0x165c70=a0_0x3af6b2;const _0x3ab86f=localStorage[_0x165c70(0x110)](_0x165c70(0xd1));var _0x3b0ccd=JSON['stringify']({'path':'/'+_0x3ab86f+'/'+_0x4f3401+'/'+_0x2d02c5});for(var _0x2a2317=0x0;_0x2a2317<0x2;_0x2a2317++){var _0x3655d5=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x165c70(0x10a),'headers':{'Authorization':_0x165c70(0xfe)+localStorage[_0x165c70(0x110)](_0x165c70(0xef)),'Dropbox-API-Arg':_0x3b0ccd}});if(_0x3655d5[_0x165c70(0x105)]!=0xc8){if(_0x3655d5[_0x165c70(0x105)]==0x191){var _0x44df9a=await dpRefreshToken();if(!_0x44df9a)throw _0x165c70(0xd8);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x3655d5['status'];}const _0x238735=new File([await _0x3655d5[_0x165c70(0x10f)]()],_0x2d02c5);return console[_0x165c70(0x106)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x238735['name']),a0_0x18cd37[_0x165c70(0xdf)](_0x238735,()=>{}),_0x238735;}return![];}document['addEventListener'](a0_0x3af6b2(0x104),function(){var _0x565f8b=a0_0x3af6b2;dropboxRestore[_0x565f8b(0xe7)](_0x565f8b(0x10d),async function(){var _0x279148=_0x565f8b;await lockNoti(_0x279148(0xfd),'',0x1388);const _0x3a1faa=localStorage[_0x279148(0x110)](_0x279148(0xd1)),_0x397f41=[_0x279148(0xd7),_0x279148(0x121),'screenshot'];if(!_0x3a1faa){window[_0x279148(0x11e)](_0x279148(0xfc));return;}let _0x2db8c1=[];for(const _0x45d3f4 of _0x397f41){let _0x20d9db={'path':'/'+_0x3a1faa+'/'+_0x45d3f4};for(let _0x1ef5ac=0x0;_0x1ef5ac<0x2;_0x1ef5ac++){let _0x2bfb43=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x279148(0x10a),'headers':{'Authorization':_0x279148(0xfe)+localStorage['getItem']('accessToken'),'Content-Type':'application/json'},'body':JSON['stringify'](_0x20d9db)});if(_0x2bfb43[_0x279148(0x105)]===0xc8){let _0x5c886b=await _0x2bfb43[_0x279148(0xe8)](),_0x17abb6=_0x5c886b['entries'][_0x279148(0x116)](_0x1481d7=>_0x1481d7[_0x279148(0x127)]===_0x279148(0xd3));_0x17abb6['length']>0x0&&_0x2db8c1['push'](..._0x17abb6[_0x279148(0x11c)](_0x1d9357=>({'name':_0x1d9357[_0x279148(0xcc)],'folder':_0x45d3f4})));break;}else{if(_0x2bfb43[_0x279148(0x105)]===0x191){let _0x516e99=await dpRefreshToken();if(!_0x516e99)throw _0x279148(0xd8);}else{console[_0x279148(0xf5)](_0x279148(0xe0)+_0x45d3f4+_0x279148(0xfb)+_0x2bfb43[_0x279148(0x105)]);break;}}}}if(_0x2db8c1[_0x279148(0x11b)]>0x0){const _0x56b646=_0x279148(0xf2)+_0x2db8c1[_0x279148(0x11b)]+_0x279148(0x109);if(window[_0x279148(0xe9)](_0x56b646))for(const _0x240021 of _0x2db8c1){await lockNoti(_0x279148(0x111),_0x240021['name'],0xbb8),await dpDownloadFile(_0x240021['name'],_0x240021[_0x279148(0xd0)]);}else console[_0x279148(0x106)]('Restore\x20canceled\x20by\x20user.');}else console[_0x279148(0x106)](_0x279148(0x115));}),dropboxBackup[_0x565f8b(0xe7)]('click',async function(){var _0x5e1081=_0x565f8b;await lockNoti(_0x5e1081(0xfd),'',0x1388);const _0x5c86b4=localStorage[_0x5e1081(0x110)](_0x5e1081(0xd1));if(_0x5c86b4===null||_0x5c86b4==='')window[_0x5e1081(0x11e)](_0x5e1081(0xfc));else{const _0x4c98c8=[_0x5e1081(0xd7),'save',_0x5e1081(0xc9)];for(const _0x488bc2 of _0x4c98c8){await dpCreateFolder(_0x488bc2);}let _0x5a0df8=0x0;for(const _0x1497d7 of _0x4c98c8){const _0x2f1a34=a0_0x18cd37[_0x5e1081(0xda)](_0x1497d7+'s');_0x5a0df8+=_0x2f1a34[_0x5e1081(0x11b)];}if(window[_0x5e1081(0xe9)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x5a0df8+'\x20files\x20in\x20Kabu?'))for(const _0x54908e of _0x4c98c8){const _0x522463=a0_0x18cd37[_0x5e1081(0xda)](_0x54908e+'s');for(const _0x2120cb of _0x522463){const _0x3923d4=await a0_0x18cd37['downloadFileInCloud'](_0x5e1081(0xed)+_0x54908e+'s/'+_0x2120cb);try{await lockNoti(_0x5e1081(0xeb),_0x2120cb,0xbb8),await dpUploadFile(_0x2120cb,_0x3923d4,_0x54908e);}catch(_0x51217d){console[_0x5e1081(0xf5)](_0x5e1081(0xdc)+_0x2120cb+':',_0x51217d);}}}else console[_0x5e1081(0x106)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x565f8b(0xe7)](_0x565f8b(0x10d),function(){var _0x4c3647=_0x565f8b;const _0x24abf8=localStorage[_0x4c3647(0x110)](_0x4c3647(0xd1));_0x24abf8===null||_0x24abf8===''?authorizeWithDropbox():window['confirm'](_0x4c3647(0xc6))&&(localStorage[_0x4c3647(0xc7)]('uId',''),dropboxRestore[_0x4c3647(0x11f)][_0x4c3647(0x100)](_0x4c3647(0xd2)),dropboxBackup[_0x4c3647(0x11f)][_0x4c3647(0x100)](_0x4c3647(0xd2)),dropboxCloud[_0x4c3647(0x11f)][_0x4c3647(0x100)](_0x4c3647(0xd2)));}),handleDropboxCallback();});