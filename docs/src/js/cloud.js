var a0_0x574491=a0_0x3117;(function(_0x2527a2,_0xb52992){var _0x1d85e2=a0_0x3117,_0x21dbdd=_0x2527a2();while(!![]){try{var _0x22d43f=-parseInt(_0x1d85e2(0x195))/0x1*(-parseInt(_0x1d85e2(0x196))/0x2)+parseInt(_0x1d85e2(0x1df))/0x3+parseInt(_0x1d85e2(0x1a4))/0x4*(-parseInt(_0x1d85e2(0x18e))/0x5)+parseInt(_0x1d85e2(0x198))/0x6+-parseInt(_0x1d85e2(0x1da))/0x7*(-parseInt(_0x1d85e2(0x1ad))/0x8)+-parseInt(_0x1d85e2(0x1be))/0x9+-parseInt(_0x1d85e2(0x1db))/0xa;if(_0x22d43f===_0xb52992)break;else _0x21dbdd['push'](_0x21dbdd['shift']());}catch(_0x63fbd9){_0x21dbdd['push'](_0x21dbdd['shift']());}}}(a0_0x2403,0xb63a1));import*as a0_0x4b18df from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x574491(0x1a5),clientSecret=a0_0x574491(0x1cc);function a0_0x3117(_0x58bf0e,_0x5f489a){var _0x24031f=a0_0x2403();return a0_0x3117=function(_0x3117ff,_0x3b7c5f){_0x3117ff=_0x3117ff-0x17e;var _0xa022a4=_0x24031f[_0x3117ff];return _0xa022a4;},a0_0x3117(_0x58bf0e,_0x5f489a);}function authorizeWithDropbox(){var _0x2d8039=a0_0x574491,_0x42cdd6=window[_0x2d8039(0x1c0)][_0x2d8039(0x193)]['split']('?')[0x0],_0x13aea9=_0x2d8039(0x1d1),_0x293924=_0x2d8039(0x1d5),_0x3c6b69=_0x2d8039(0x1a0)+clientId+_0x2d8039(0x1c7)+_0x13aea9+_0x2d8039(0x186)+_0x293924+'&redirect_uri='+encodeURIComponent(_0x42cdd6);window[_0x2d8039(0x1c0)]['href']=_0x3c6b69;}function handleDropboxCallback(){var _0x2176e1=a0_0x574491,_0x9a7881=getUrlParameter(_0x2176e1(0x1d1));_0x9a7881?(getAccessToken(_0x9a7881),console[_0x2176e1(0x1b9)]('Authorization\x20Code:',_0x9a7881)):console[_0x2176e1(0x1b9)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x1b71f2){var _0x35baa7=a0_0x574491;_0x1b71f2=_0x1b71f2[_0x35baa7(0x1d4)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x5a3ae7=new RegExp(_0x35baa7(0x191)+_0x1b71f2+_0x35baa7(0x1de)),_0x47a135=_0x5a3ae7[_0x35baa7(0x1e1)](location[_0x35baa7(0x18d)]);return _0x47a135===null?'':decodeURIComponent(_0x47a135[0x1][_0x35baa7(0x1d4)](/\+/g,'\x20'));}function getAccessToken(_0x3c5f79){var _0x56394c=a0_0x574491,_0x1f8e1e=_0x56394c(0x1af),_0x45e797=window[_0x56394c(0x1c0)]['href'][_0x56394c(0x19f)]('?')[0x0],_0x2e5006=new XMLHttpRequest();_0x2e5006[_0x56394c(0x19c)](_0x56394c(0x1c2),_0x56394c(0x1a8)),_0x2e5006['setRequestHeader'](_0x56394c(0x18f),'application/x-www-form-urlencoded'),_0x2e5006[_0x56394c(0x1b2)]=function(){var _0x6b14cc=_0x56394c;if(_0x2e5006[_0x6b14cc(0x197)]===0xc8){var _0x30b666=JSON[_0x6b14cc(0x1bd)](_0x2e5006[_0x6b14cc(0x184)]),_0x544043=_0x30b666['access_token'],_0x585cee=_0x30b666[_0x6b14cc(0x1c6)],_0x12edd7=_0x30b666[_0x6b14cc(0x1d6)];localStorage['setItem'](_0x6b14cc(0x1d9),_0x544043),localStorage[_0x6b14cc(0x1aa)](_0x6b14cc(0x1a9),_0x585cee),localStorage[_0x6b14cc(0x1aa)]('uId',_0x12edd7);}else console[_0x6b14cc(0x1b9)](_0x6b14cc(0x18c));},_0x2e5006[_0x56394c(0x1a1)](_0x56394c(0x1bb)+_0x3c5f79+_0x56394c(0x18a)+_0x1f8e1e+_0x56394c(0x1ab)+clientId+_0x56394c(0x1c3)+clientSecret+_0x56394c(0x1b6)+encodeURIComponent(_0x45e797));}export async function dpCreateFolder(_0x34921c){var _0x35605f=a0_0x574491;const _0x35c81a=localStorage[_0x35605f(0x19e)]('uId');let _0x1593f5=localStorage[_0x35605f(0x19e)](_0x35605f(0x1d9));const _0x357619='/'+_0x35c81a+'/'+_0x34921c,_0x50525e=JSON['stringify']({'path':_0x357619,'autorename':![]});for(let _0x4ba49f=0x0;_0x4ba49f<0x2;_0x4ba49f++){try{const _0x3b98d0=await fetch(_0x35605f(0x181),{'method':_0x35605f(0x1c2),'headers':{'Authorization':_0x35605f(0x1b1)+_0x1593f5,'Content-Type':'application/json'},'body':_0x50525e});if(_0x3b98d0[_0x35605f(0x197)]===0x191){const _0x23a13c=await dpRefreshToken();if(!_0x23a13c)throw new Error(_0x35605f(0x1ca));_0x1593f5=localStorage[_0x35605f(0x19e)](_0x35605f(0x1d9));continue;}if(_0x3b98d0[_0x35605f(0x197)]===0x199)return{'message':_0x35605f(0x194),'path':_0x34921c};if(!_0x3b98d0['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x34921c);const _0x489bad=await _0x3b98d0['json']();return await lockNoti(_0x35605f(0x190),'',0xbb8),_0x489bad;}catch(_0x25a3f6){if(_0x4ba49f===0x1)throw _0x25a3f6;}}return![];}export async function dpRefreshToken(){var _0x4ec94f=a0_0x574491;if(!localStorage[_0x4ec94f(0x19e)](_0x4ec94f(0x1a9)))throw'No\x20refresh\x20token';try{const _0x5724cb=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x4ec94f(0x1c2),'headers':{'Content-Type':_0x4ec94f(0x185)},'body':_0x4ec94f(0x182)+localStorage[_0x4ec94f(0x19e)](_0x4ec94f(0x1a9))+_0x4ec94f(0x1c1)}),_0x2b7b08=await _0x5724cb[_0x4ec94f(0x1cb)]();if(!_0x2b7b08[_0x4ec94f(0x189)])return localStorage[_0x4ec94f(0x1aa)]('accessToken',_0x2b7b08['access_token']),await lockNoti(_0x4ec94f(0x1cd),'',0xbb8),await delay(0x3e8),!![];else alert(_0x2b7b08[_0x4ec94f(0x1ba)]||_0x4ec94f(0x1ae));}catch(_0x15fd84){console['error']('Error\x20while\x20refreshing\x20token:',_0x15fd84);}return![];}export async function dpUploadFile(_0x3741b6,_0x3a0209,_0x14a0c1){var _0x9ac64c=a0_0x574491;const _0x3be4dd=localStorage[_0x9ac64c(0x19e)](_0x9ac64c(0x19a));var _0x268d39=JSON[_0x9ac64c(0x1c5)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x3be4dd+'/'+_0x14a0c1+'/'+_0x3741b6}),_0x2da2b9=new Blob([_0x3a0209],{'type':'application/octet-stream'});for(var _0x251de0=0x0;_0x251de0<0x2;_0x251de0++){var _0x111c7a=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x9ac64c(0x1c2),'headers':{'Authorization':_0x9ac64c(0x1b1)+localStorage[_0x9ac64c(0x19e)]('accessToken'),'Dropbox-API-Arg':_0x268d39,'Content-Type':_0x9ac64c(0x188)},'body':_0x2da2b9});if(_0x111c7a[_0x9ac64c(0x197)]!=0xc8){if(_0x111c7a['status']==0x191){var _0x52e72d=await dpRefreshToken();if(!_0x52e72d)throw _0x9ac64c(0x1ca);continue;}else throw _0x9ac64c(0x1bc)+_0x111c7a[_0x9ac64c(0x197)];}else{var _0x46ac9b=await _0x111c7a[_0x9ac64c(0x1cb)]();return console[_0x9ac64c(0x1b9)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x3741b6),_0x46ac9b;}}return![];}export async function dpDownloadFile(_0x46dbac,_0x47d792){var _0x13be29=a0_0x574491;const _0x16a663=localStorage[_0x13be29(0x19e)]('uId');var _0x54a1f9=JSON[_0x13be29(0x1c5)]({'path':'/'+_0x16a663+'/'+_0x47d792+'/'+_0x46dbac});for(var _0x1dd15d=0x0;_0x1dd15d<0x2;_0x1dd15d++){var _0x4febd4=await fetch(_0x13be29(0x1d2),{'method':_0x13be29(0x1c2),'headers':{'Authorization':_0x13be29(0x1b1)+localStorage[_0x13be29(0x19e)](_0x13be29(0x1d9)),'Dropbox-API-Arg':_0x54a1f9}});if(_0x4febd4['status']!=0xc8){if(_0x4febd4[_0x13be29(0x197)]==0x191){var _0x224968=await dpRefreshToken();if(!_0x224968)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x13be29(0x19d)+_0x4febd4[_0x13be29(0x197)];}const _0x329f5c=new File([await _0x4febd4['blob']()],_0x46dbac);return console[_0x13be29(0x1b9)](_0x13be29(0x1c4),_0x329f5c['name']),a0_0x4b18df[_0x13be29(0x1b5)](_0x329f5c,()=>{}),_0x329f5c;}return![];}function a0_0x2403(){var _0x786fcf=['\x20files\x20from\x20Cloud?','location','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','POST','&client_secret=','Cloud\x20↦\x20Kabu\x20storage\x20◆','stringify','refresh_token','&response_type=','folder','confirm','Unable\x20to\x20refresh\x20token','json','nwb3dnfh09rhs31','Refreshing\x20token...','No\x20files\x20found\x20to\x20restore.','screenshot','alert','code','https://content.dropboxapi.com/2/files/download','Wait\x20a\x20little\x20bit...','replace','offline','uid','listFiles',',\x20status:\x20','accessToken','763eFmxvI','12387210eDfQET','/data/','downloadFileInCloud','=([^&#]*)','2545518vSncyc','addEventListener','exec','length','entries','remove','https://api.dropboxapi.com/2/files/create_folder_v2','refresh_token=','click','responseText','application/x-www-form-urlencoded','&token_access_type=','Restoring...','application/octet-stream','error','&grant_type=','https://api.dropboxapi.com/2/files/list_folder','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','search','1488965nXgghX','Content-Type','Folder\x20created','[\x5c?&#]','save','href','Folder\x20already\x20exists','78739UgZHHM','26JPbHBs','status','902934JYcLtW','state','uId','Cloud\x20login\x20required!','open','Download\x20failed,\x20unknown\x20http\x20status:','getItem','split','https://www.dropbox.com/oauth2/authorize?client_id=','send','Do\x20you\x20want\x20to\x20backup\x20','Restore\x20canceled\x20by\x20user.','12VmFkQG','knh3uz2mx2hp2eu','Do\x20you\x20want\x20to\x20logout?','active','https://api.dropbox.com/oauth2/token','refreshToken','setItem','&client_id=','name','100784BlDtpn','Failed\x20to\x20refresh\x20Dropbox\x20token.','authorization_code','classList','Bearer\x20','onload','application/json','push','uploadFileInCloud','&redirect_uri=','Do\x20you\x20want\x20to\x20restore\x20','filter','log','error_description','code=','Upload\x20failed,\x20unknown\x20http\x20status:\x20','parse','4655547JXhgaq'];a0_0x2403=function(){return _0x786fcf;};return a0_0x2403();}document[a0_0x574491(0x1e0)]('DOMContentLoaded',function(){var _0x397f3b=a0_0x574491;dropboxRestore['addEventListener'](_0x397f3b(0x183),async function(){var _0x355bb7=_0x397f3b;await lockNoti(_0x355bb7(0x1d3),'',0x1388);const _0x194a09=localStorage['getItem'](_0x355bb7(0x19a)),_0x388ca4=[_0x355bb7(0x199),_0x355bb7(0x192),_0x355bb7(0x1cf)];if(!_0x194a09){window[_0x355bb7(0x1d0)](_0x355bb7(0x19b));return;}let _0x2f6db0=[];for(const _0x1894ef of _0x388ca4){let _0x1aad05={'path':'/'+_0x194a09+'/'+_0x1894ef};for(let _0x394feb=0x0;_0x394feb<0x2;_0x394feb++){let _0x2886c0=await fetch(_0x355bb7(0x18b),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x355bb7(0x19e)](_0x355bb7(0x1d9)),'Content-Type':_0x355bb7(0x1b3)},'body':JSON[_0x355bb7(0x1c5)](_0x1aad05)});if(_0x2886c0[_0x355bb7(0x197)]===0xc8){let _0x2d343c=await _0x2886c0[_0x355bb7(0x1cb)](),_0x76eed0=_0x2d343c[_0x355bb7(0x17f)][_0x355bb7(0x1b8)](_0x1c6740=>_0x1c6740['.tag']==='file');_0x76eed0[_0x355bb7(0x17e)]>0x0&&_0x2f6db0[_0x355bb7(0x1b4)](..._0x76eed0['map'](_0x21dfa2=>({'name':_0x21dfa2['name'],'folder':_0x1894ef})));break;}else{if(_0x2886c0[_0x355bb7(0x197)]===0x191){let _0x469fd7=await dpRefreshToken();if(!_0x469fd7)throw _0x355bb7(0x1ca);}else{console['error']('Download\x20failed\x20for\x20'+_0x1894ef+_0x355bb7(0x1d8)+_0x2886c0[_0x355bb7(0x197)]);break;}}}}if(_0x2f6db0[_0x355bb7(0x17e)]>0x0){const _0x3fe266=_0x355bb7(0x1b7)+_0x2f6db0['length']+_0x355bb7(0x1bf);if(window[_0x355bb7(0x1c9)](_0x3fe266))for(const _0x3bb15d of _0x2f6db0){await lockNoti(_0x355bb7(0x187),_0x3bb15d[_0x355bb7(0x1ac)],0xbb8),await dpDownloadFile(_0x3bb15d[_0x355bb7(0x1ac)],_0x3bb15d[_0x355bb7(0x1c8)]);}else console[_0x355bb7(0x1b9)]('Restore\x20canceled\x20by\x20user.');}else console[_0x355bb7(0x1b9)](_0x355bb7(0x1ce));}),dropboxBackup[_0x397f3b(0x1e0)](_0x397f3b(0x183),async function(){var _0x2c02d4=_0x397f3b;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x593a3b=localStorage[_0x2c02d4(0x19e)](_0x2c02d4(0x19a));if(_0x593a3b===null||_0x593a3b==='')window[_0x2c02d4(0x1d0)](_0x2c02d4(0x19b));else{const _0xa0a284=[_0x2c02d4(0x199),_0x2c02d4(0x192),'screenshot'];for(const _0x1e5f97 of _0xa0a284){await dpCreateFolder(_0x1e5f97);}let _0x3f8414=0x0;for(const _0x3b9e1c of _0xa0a284){const _0x5db3f7=a0_0x4b18df[_0x2c02d4(0x1d7)](_0x3b9e1c+'s');_0x3f8414+=_0x5db3f7[_0x2c02d4(0x17e)];}if(window[_0x2c02d4(0x1c9)](_0x2c02d4(0x1a2)+_0x3f8414+'\x20files\x20in\x20Kabu?'))for(const _0x3f1898 of _0xa0a284){const _0x3dbcd4=a0_0x4b18df[_0x2c02d4(0x1d7)](_0x3f1898+'s');for(const _0x40132a of _0x3dbcd4){const _0x2f71ca=await a0_0x4b18df[_0x2c02d4(0x1dd)](_0x2c02d4(0x1dc)+_0x3f1898+'s/'+_0x40132a);try{await lockNoti('Backing\x20up...',_0x40132a,0xbb8),await dpUploadFile(_0x40132a,_0x2f71ca,_0x3f1898);}catch(_0x18c587){console[_0x2c02d4(0x189)]('Failed\x20to\x20upload\x20file\x20'+_0x40132a+':',_0x18c587);}}}else console[_0x2c02d4(0x1b9)](_0x2c02d4(0x1a3));}}),dropboxCloud['addEventListener'](_0x397f3b(0x183),function(){var _0x206f5c=_0x397f3b;const _0x4fb787=localStorage[_0x206f5c(0x19e)](_0x206f5c(0x19a));_0x4fb787===null||_0x4fb787===''?authorizeWithDropbox():window[_0x206f5c(0x1c9)](_0x206f5c(0x1a6))&&(localStorage[_0x206f5c(0x1aa)](_0x206f5c(0x19a),''),dropboxRestore[_0x206f5c(0x1b0)][_0x206f5c(0x180)](_0x206f5c(0x1a7)),dropboxBackup[_0x206f5c(0x1b0)][_0x206f5c(0x180)](_0x206f5c(0x1a7)),dropboxCloud['classList'][_0x206f5c(0x180)](_0x206f5c(0x1a7)));}),handleDropboxCallback();});