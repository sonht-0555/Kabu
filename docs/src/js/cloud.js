var a0_0x281846=a0_0xaeb6;(function(_0x51a169,_0x18a7ca){var _0x335102=a0_0xaeb6,_0x178bb7=_0x51a169();while(!![]){try{var _0x479fd3=parseInt(_0x335102(0x1dd))/0x1*(parseInt(_0x335102(0x1f0))/0x2)+parseInt(_0x335102(0x1e1))/0x3+-parseInt(_0x335102(0x1e3))/0x4*(-parseInt(_0x335102(0x1de))/0x5)+-parseInt(_0x335102(0x1f3))/0x6+parseInt(_0x335102(0x1dc))/0x7*(parseInt(_0x335102(0x1b2))/0x8)+-parseInt(_0x335102(0x20e))/0x9+-parseInt(_0x335102(0x1fe))/0xa;if(_0x479fd3===_0x18a7ca)break;else _0x178bb7['push'](_0x178bb7['shift']());}catch(_0x29f41c){_0x178bb7['push'](_0x178bb7['shift']());}}}(a0_0x3bbd,0x3af08));import*as a0_0x118e5c from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x281846(0x1db);function a0_0xaeb6(_0x587201,_0x19471e){var _0x3bbd75=a0_0x3bbd();return a0_0xaeb6=function(_0xaeb6ef,_0x20e404){_0xaeb6ef=_0xaeb6ef-0x19f;var _0x41581b=_0x3bbd75[_0xaeb6ef];return _0x41581b;},a0_0xaeb6(_0x587201,_0x19471e);}function authorizeWithDropbox(){var _0x310fd7=a0_0x281846,_0x327236=window['location'][_0x310fd7(0x1f5)][_0x310fd7(0x1af)]('?')[0x0],_0xa80b35=_0x310fd7(0x1d3),_0x37f1a5=_0x310fd7(0x204),_0x308645=_0x310fd7(0x1f2)+clientId+_0x310fd7(0x1ab)+_0xa80b35+_0x310fd7(0x1b9)+_0x37f1a5+_0x310fd7(0x1d8)+encodeURIComponent(_0x327236);window['location'][_0x310fd7(0x1f5)]=_0x308645;}function handleDropboxCallback(){var _0x133127=a0_0x281846,_0x1c0caf=getUrlParameter(_0x133127(0x1d3));_0x1c0caf?(getAccessToken(_0x1c0caf),console[_0x133127(0x1ed)](_0x133127(0x202),_0x1c0caf)):console[_0x133127(0x1ed)](_0x133127(0x1f6));}function getUrlParameter(_0x49c657){var _0x553111=a0_0x281846;_0x49c657=_0x49c657[_0x553111(0x1bf)](/[\[]/,'\x5c[')[_0x553111(0x1bf)](/[\]]/,'\x5c]');var _0x2dabf8=new RegExp(_0x553111(0x1cf)+_0x49c657+_0x553111(0x210)),_0x46d7c8=_0x2dabf8['exec'](location['search']);return _0x46d7c8===null?'':decodeURIComponent(_0x46d7c8[0x1][_0x553111(0x1bf)](/\+/g,'\x20'));}function a0_0x3bbd(){var _0x1d2513=['Bearer\x20','log','/data/','onload','10HVpWXo','.ss4','https://www.dropbox.com/oauth2/authorize?client_id=','696372mnkgNG','uId','href','Do\x20not\x20receive\x20authorization','uid','\x20files\x20in\x20Kabu?','lastIndexOf','refresh_token','application/x-www-form-urlencoded','DOMContentLoaded','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','6746750ZpFOHG','toUpperCase','.txt','.tag','Authorization\x20Code:','application/octet-stream','offline','.ss5','access_token','.gba_slot','https://api.dropbox.com/oauth2/token','refreshToken','Content-Type','.gba_dateState','length','application/json','1849833oAWeog','parse','=([^&#]*)','open','Do\x20you\x20want\x20to\x20backup\x20','text/plain','.ss7','error_description','filter','downloadFileInCloud','Failed\x20to\x20upload\x20file\x20','FSSync','setItem','accessToken','slice','confirm','&response_type=','list','Backing\x20up...','Download\x20failed,\x20unknown\x20http\x20status:','split','alert','click','2304552vbzoRv','addEventListener','https://api.dropboxapi.com/2/files/list_folder','classList','stringify','Restore\x20canceled\x20by\x20user.','.gba_imageState','&token_access_type=','remove','json','&client_secret=','substring','Unable\x20to\x20refresh\x20token','replace','active','location','Restoring...','.ss2','entries','save','refresh_token=','https://content.dropboxapi.com/2/files/upload','Cloud\x20login\x20required!','charAt','file','Kabu\x20storage\x20↦\x20Cloud\x20◆','https://api.dropboxapi.com/oauth2/token','&grant_type=','uploadSaveOrSaveState','[\x5c?&#]','Cloud\x20↦\x20Kabu\x20storage\x20◆','getItem','Upload\x20failed,\x20unknown\x20http\x20status:\x20','code','.ss0','No\x20refresh\x20token','endsWith','_imageState','&redirect_uri=','status:\x20','https://content.dropboxapi.com/2/files/download','nwb3dnfh09rhs31','7jaEXyh','78844mpXoqh','20CBssGY','Do\x20you\x20want\x20to\x20restore\x20','responseText','581331JWoWpg','authorization_code','361624eftFqr','code=','overwrite','error','Refreshing\x20token...','POST','status','.ss6','name'];a0_0x3bbd=function(){return _0x1d2513;};return a0_0x3bbd();}function getAccessToken(_0x13bf08){var _0x230a42=a0_0x281846,_0x52a989=_0x230a42(0x1e2),_0xb6b103=window[_0x230a42(0x1c1)][_0x230a42(0x1f5)]['split']('?')[0x0],_0x2e67ef=new XMLHttpRequest();_0x2e67ef[_0x230a42(0x211)]('POST',_0x230a42(0x208)),_0x2e67ef['setRequestHeader'](_0x230a42(0x20a),'application/x-www-form-urlencoded'),_0x2e67ef[_0x230a42(0x1ef)]=function(){var _0xb3a89a=_0x230a42;if(_0x2e67ef[_0xb3a89a(0x1e9)]===0xc8){var _0x5d7a44=JSON[_0xb3a89a(0x20f)](_0x2e67ef[_0xb3a89a(0x1e0)]),_0x813201=_0x5d7a44[_0xb3a89a(0x206)],_0x2b75dc=_0x5d7a44[_0xb3a89a(0x1fa)],_0x23d3fd=_0x5d7a44[_0xb3a89a(0x1f7)];localStorage[_0xb3a89a(0x1a7)]('accessToken',_0x813201),localStorage[_0xb3a89a(0x1a7)](_0xb3a89a(0x209),_0x2b75dc),localStorage[_0xb3a89a(0x1a7)]('uId',_0x23d3fd);}else console[_0xb3a89a(0x1ed)](_0xb3a89a(0x1fd));},_0x2e67ef['send'](_0x230a42(0x1e4)+_0x13bf08+_0x230a42(0x1cd)+_0x52a989+'&client_id='+clientId+_0x230a42(0x1bc)+clientSecret+_0x230a42(0x1d8)+encodeURIComponent(_0xb6b103));}export async function dpRefreshToken(){var _0x24fcb9=a0_0x281846;if(!localStorage[_0x24fcb9(0x1d1)]('refreshToken'))throw _0x24fcb9(0x1d5);try{const _0x220536=await fetch(_0x24fcb9(0x1cc),{'method':'POST','headers':{'Content-Type':_0x24fcb9(0x1fb)},'body':_0x24fcb9(0x1c6)+localStorage[_0x24fcb9(0x1d1)]('refreshToken')+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x4d36a3=await _0x220536[_0x24fcb9(0x1bb)]();if(!_0x4d36a3['error'])return localStorage[_0x24fcb9(0x1a7)]('accessToken',_0x4d36a3[_0x24fcb9(0x206)]),await lockNoti('',_0x24fcb9(0x1e7),0xbb8),await delay(0x3e8),!![];else alert(_0x4d36a3[_0x24fcb9(0x1a2)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x5123ec){console[_0x24fcb9(0x1e6)]('Error\x20while\x20refreshing\x20token:',_0x5123ec);}return![];}export async function dpUploadFile(_0x5e4980,_0xc64d7f){var _0x499844=a0_0x281846;const _0x182a06=localStorage[_0x499844(0x1d1)]('uId');var _0x1fc6a3=JSON[_0x499844(0x1b6)]({'autorename':!![],'mode':_0x499844(0x1e5),'mute':!![],'strict_conflict':![],'path':'/'+_0x182a06+'/'+_0x5e4980}),_0x1dd2e9=new Blob([_0xc64d7f],{'type':_0x499844(0x203)});for(var _0x2d5bef=0x0;_0x2d5bef<0x2;_0x2d5bef++){var _0x108368=await fetch(_0x499844(0x1c7),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x499844(0x1d1)](_0x499844(0x1a8)),'Dropbox-API-Arg':_0x1fc6a3,'Content-Type':_0x499844(0x203)},'body':_0x1dd2e9});if(_0x108368[_0x499844(0x1e9)]!=0xc8){if(_0x108368[_0x499844(0x1e9)]==0x191){var _0x5787a7=await dpRefreshToken();if(!_0x5787a7)throw _0x499844(0x1be);continue;}else throw _0x499844(0x1d2)+_0x108368[_0x499844(0x1e9)];}else{var _0x2fc8ac=await _0x108368[_0x499844(0x1bb)]();return console[_0x499844(0x1ed)](_0x499844(0x1cb),_0x5e4980),_0x2fc8ac;}}return![];}async function dpDownloadFile(_0x26d203){var _0x475135=a0_0x281846;const _0x5d6982=localStorage[_0x475135(0x1d1)](_0x475135(0x1f4));var _0x31d335=JSON[_0x475135(0x1b6)]({'path':'/'+_0x5d6982+'/'+_0x26d203});for(var _0x586e6b=0x0;_0x586e6b<0x2;_0x586e6b++){var _0x6dec5a=await fetch(_0x475135(0x1da),{'method':_0x475135(0x1e8),'headers':{'Authorization':_0x475135(0x1ec)+localStorage['getItem'](_0x475135(0x1a8)),'Dropbox-API-Arg':_0x31d335}});if(_0x6dec5a[_0x475135(0x1e9)]!=0xc8){if(_0x6dec5a[_0x475135(0x1e9)]==0x191){var _0x55e916=await dpRefreshToken();if(!_0x55e916)throw _0x475135(0x1be);continue;}else throw _0x475135(0x1ae)+_0x6dec5a[_0x475135(0x1e9)];}const _0x516403=new File([await _0x6dec5a['blob']()],_0x26d203);console[_0x475135(0x1ed)](_0x475135(0x1d0),_0x516403['name']);if(_0x26d203[_0x475135(0x1d6)](_0x475135(0x200))){const _0x5dc968=await _0x516403['text'](),[_0x1c120c,_0x17609d]=_0x5dc968[_0x475135(0x1af)]('\x0a\x0a'),_0x2022b6=_0x26d203[_0x475135(0x1bd)](0x0,_0x26d203['lastIndexOf']('gba')+0x3),_0x2fc665=_0x26d203[_0x475135(0x1c9)](_0x26d203['length']-0x5);localStorage[_0x475135(0x1a7)](_0x2022b6+'_dateState'+_0x2fc665,_0x17609d),localStorage[_0x475135(0x1a7)](_0x2022b6+_0x475135(0x1d7)+_0x2fc665,_0x1c120c);}else a0_0x118e5c[_0x475135(0x1ce)](_0x516403,()=>{var _0x5a6e49=_0x475135;localStorageFile(),Module[_0x5a6e49(0x1a6)]();});return _0x516403;}return![];}document[a0_0x281846(0x1b3)](a0_0x281846(0x1fc),function(){var _0x49336e=a0_0x281846;dropboxRestore['addEventListener'](_0x49336e(0x1b1),async function(){var _0xe9b9d4=_0x49336e;const _0x1f2393=localStorage[_0xe9b9d4(0x1d1)](_0xe9b9d4(0x1f4));if(_0x1f2393===null||_0x1f2393==='')window['alert']('Cloud\x20login\x20required!');else{var _0xe4d8fe={'path':'/'+_0x1f2393};for(var _0x256c17=0x0;_0x256c17<0x2;_0x256c17++){var _0x37646e=await fetch(_0xe9b9d4(0x1b4),{'method':_0xe9b9d4(0x1e8),'headers':{'Authorization':_0xe9b9d4(0x1ec)+localStorage[_0xe9b9d4(0x1d1)]('accessToken'),'Content-Type':_0xe9b9d4(0x20d)},'body':JSON[_0xe9b9d4(0x1b6)](_0xe4d8fe)});console[_0xe9b9d4(0x1ed)](_0xe9b9d4(0x1d9),_0x37646e[_0xe9b9d4(0x1e9)]);if(_0x37646e[_0xe9b9d4(0x1e9)]!=0xc8){if(_0x37646e[_0xe9b9d4(0x1e9)]==0x191){var _0x29cf56=await dpRefreshToken();if(!_0x29cf56)throw _0xe9b9d4(0x1be);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:\x20'+_0x37646e['status'];}else{const _0x30c086=await _0x37646e[_0xe9b9d4(0x1bb)](),_0x36a5a1=_0x30c086[_0xe9b9d4(0x1c4)][_0xe9b9d4(0x1a3)](_0xbebd00=>_0xbebd00['.tag']==='file')['length'],_0x4a0869=_0xe9b9d4(0x1df)+_0x36a5a1+'\x20files\x20in\x20Cloud?';if(window[_0xe9b9d4(0x1aa)](_0x4a0869))for(const _0x38ff12 of _0x30c086[_0xe9b9d4(0x1c4)]){_0x38ff12[_0xe9b9d4(0x201)]===_0xe9b9d4(0x1ca)&&(await lockNoti(_0xe9b9d4(0x1c2),_0x38ff12[_0xe9b9d4(0x1eb)],0xbb8),await dpDownloadFile(_0x38ff12[_0xe9b9d4(0x1eb)]));}else console[_0xe9b9d4(0x1ed)](_0xe9b9d4(0x1b7));return!![];}}return![];}}),dropboxBackup['addEventListener']('click',async function(){var _0x262dde=_0x49336e;const _0x5eef1e=localStorage[_0x262dde(0x1d1)](_0x262dde(0x1f4));if(_0x5eef1e===null||_0x5eef1e==='')window[_0x262dde(0x1b0)](_0x262dde(0x1c8));else{const _0x2e34d4=['state',_0x262dde(0x1c5)];let _0x3d4c1e=0x0;for(const _0x4178e1 of _0x2e34d4){const _0x10580d=a0_0x118e5c[_0x262dde(0x1ac)+(_0x4178e1[_0x262dde(0x1c9)](0x0)[_0x262dde(0x1ff)]()+_0x4178e1['slice'](0x1))]();_0x3d4c1e+=_0x10580d[_0x262dde(0x20c)];}if(window[_0x262dde(0x1aa)](_0x262dde(0x19f)+_0x3d4c1e+_0x262dde(0x1f8)))for(const _0x92b85a of _0x2e34d4){const _0x55c524=a0_0x118e5c[_0x262dde(0x1ac)+(_0x92b85a[_0x262dde(0x1c9)](0x0)[_0x262dde(0x1ff)]()+_0x92b85a[_0x262dde(0x1a9)](0x1))]();for(const _0xa87bbf of _0x55c524){const _0x4144ed=await a0_0x118e5c[_0x262dde(0x1a4)](_0x262dde(0x1ee)+_0x92b85a+'s/'+_0xa87bbf);try{await lockNoti('Backing\x20up...',_0xa87bbf,0xbb8),await dpUploadFile(_0xa87bbf,_0x4144ed);if(_0xa87bbf['endsWith'](_0x262dde(0x1d4))||_0xa87bbf[_0x262dde(0x1d6)]('.ss1')||_0xa87bbf[_0x262dde(0x1d6)](_0x262dde(0x1c3))||_0xa87bbf[_0x262dde(0x1d6)]('.ss3')||_0xa87bbf[_0x262dde(0x1d6)](_0x262dde(0x1f1))||_0xa87bbf[_0x262dde(0x1d6)](_0x262dde(0x205))||_0xa87bbf[_0x262dde(0x1d6)](_0x262dde(0x1ea))||_0xa87bbf[_0x262dde(0x1d6)](_0x262dde(0x1a1))){const _0x166ee2=_0xa87bbf['substring'](0x0,_0xa87bbf[_0x262dde(0x1f9)]('.')),_0x225eec=_0xa87bbf[_0x262dde(0x1c9)](_0xa87bbf[_0x262dde(0x20c)]-0x1),_0x45f135=localStorage[_0x262dde(0x1d1)](_0x166ee2+_0x262dde(0x1b8)+_0x225eec),_0x16240e=localStorage[_0x262dde(0x1d1)](_0x166ee2+_0x262dde(0x20b)+_0x225eec);if(_0x45f135!==null){const _0x1ae8e4=_0x45f135+'\x0a\x0a'+_0x16240e,_0x48c896=new Blob([_0x1ae8e4],{'type':_0x262dde(0x1a0)});await lockNoti(_0x262dde(0x1ad),_0x166ee2+_0x262dde(0x207)+_0x225eec+_0x262dde(0x200),0xbb8),await dpUploadFile(_0x166ee2+_0x262dde(0x207)+_0x225eec+_0x262dde(0x200),_0x48c896);}}}catch(_0x28e2c1){console[_0x262dde(0x1e6)](_0x262dde(0x1a5)+_0xa87bbf+':',_0x28e2c1);}}}else console['log'](_0x262dde(0x1b7));}}),dropboxCloud[_0x49336e(0x1b3)](_0x49336e(0x1b1),function(){var _0x1d5f24=_0x49336e;const _0x2ad193=localStorage[_0x1d5f24(0x1d1)]('uId');_0x2ad193===null||_0x2ad193===''?authorizeWithDropbox():window[_0x1d5f24(0x1aa)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x1d5f24(0x1a7)](_0x1d5f24(0x1f4),''),dropboxRestore['classList'][_0x1d5f24(0x1ba)]('active'),dropboxBackup['classList'][_0x1d5f24(0x1ba)](_0x1d5f24(0x1c0)),dropboxCloud[_0x1d5f24(0x1b5)][_0x1d5f24(0x1ba)]('active'));}),handleDropboxCallback();});