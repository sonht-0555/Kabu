var a0_0xba993d=a0_0x284e;(function(_0x26c3df,_0x550616){var _0x2fa2de=a0_0x284e,_0x5e0a5d=_0x26c3df();while(!![]){try{var _0x199b98=-parseInt(_0x2fa2de(0xe8))/0x1*(-parseInt(_0x2fa2de(0xb0))/0x2)+-parseInt(_0x2fa2de(0xf0))/0x3*(-parseInt(_0x2fa2de(0xd6))/0x4)+-parseInt(_0x2fa2de(0xd5))/0x5+parseInt(_0x2fa2de(0xe2))/0x6+-parseInt(_0x2fa2de(0x117))/0x7*(parseInt(_0x2fa2de(0x114))/0x8)+-parseInt(_0x2fa2de(0xfb))/0x9*(-parseInt(_0x2fa2de(0x107))/0xa)+parseInt(_0x2fa2de(0xd7))/0xb;if(_0x199b98===_0x550616)break;else _0x5e0a5d['push'](_0x5e0a5d['shift']());}catch(_0x508c89){_0x5e0a5d['push'](_0x5e0a5d['shift']());}}}(a0_0x4a5d,0x57d66));import*as a0_0x49df5b from'./main.js';function a0_0x284e(_0x35e703,_0x316c1c){var _0x4a5d03=a0_0x4a5d();return a0_0x284e=function(_0x284ea9,_0x3c46a9){_0x284ea9=_0x284ea9-0xa6;var _0x7b1a32=_0x4a5d03[_0x284ea9];return _0x7b1a32;},a0_0x284e(_0x35e703,_0x316c1c);}import{localStorageFile}from'./storage.js';var clientId=a0_0xba993d(0xbc),clientSecret=a0_0xba993d(0xcf);function a0_0x4a5d(){var _0x25b17f=['_dateState','POST','Upload\x20failed,\x20unknown\x20http\x20status:\x20','.ss7','location','9eAvMHp','Failed\x20to\x20refresh\x20Dropbox\x20token.','DOMContentLoaded','name','gba','toUpperCase','filter','send','code=','error','Backing\x20up...','.ss4','392230DQwIdS','onload','Refreshing\x20token...','classList','setItem','refreshToken','&redirect_uri=','_imageState','.ss3','open','https://api.dropboxapi.com/oauth2/token','https://api.dropboxapi.com/2/files/list_folder','uid','8tymLhq','.ss6','.tag','1554161fvpyNB','\x20files\x20in\x20Kabu?','Authorization\x20Code:','https://www.dropbox.com/oauth2/authorize?client_id=','confirm','uploadSaveOrSaveState','.gba_imageState','replace','refresh_token','file','application/x-www-form-urlencoded','Download\x20failed,\x20unknown\x20http\x20status:','2tsZZGi','\x20files\x20in\x20Cloud?','Unable\x20to\x20refresh\x20token','remove','exec','Do\x20you\x20want\x20to\x20logout?','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','error_description','addEventListener','Bearer\x20','state','save','knh3uz2mx2hp2eu','uId','.gba_slot','code','split','downloadFileInCloud','entries','alert','charAt','&response_type=','Cloud\x20↦\x20Kabu\x20storage\x20◆','stringify','click','https://content.dropboxapi.com/2/files/upload','No\x20refresh\x20token','href','lastIndexOf','slice','&token_access_type=','nwb3dnfh09rhs31','Do\x20you\x20want\x20to\x20restore\x20','list','active','status','offline','2677000ItDpXm','4JIHNHU','4699530RhbdOM','Download\x20failed,\x20unknown\x20http\x20status:\x20','length','=([^&#]*)','https://content.dropboxapi.com/2/files/download','substring','/data/','Do\x20you\x20want\x20to\x20backup\x20','accessToken','.ss5','Restore\x20canceled\x20by\x20user.','1806846SWlTHO','search','getItem','endsWith','status:\x20','Restoring...','263974epsXss','Do\x20not\x20receive\x20authorization','log','Cloud\x20login\x20required!','application/octet-stream','json','&client_id=','setRequestHeader','256911DjhAsE','.ss1','access_token','.txt','text/plain','blob'];a0_0x4a5d=function(){return _0x25b17f;};return a0_0x4a5d();}function authorizeWithDropbox(){var _0x588042=a0_0xba993d,_0x1ee096=window[_0x588042(0xfa)]['href'][_0x588042(0xc0)]('?')[0x0],_0x427983='code',_0x408d7b=_0x588042(0xd4),_0x562c4a=_0x588042(0xa7)+clientId+_0x588042(0xc5)+_0x427983+_0x588042(0xce)+_0x408d7b+_0x588042(0x10d)+encodeURIComponent(_0x1ee096);window[_0x588042(0xfa)][_0x588042(0xcb)]=_0x562c4a;}function handleDropboxCallback(){var _0x29fbcd=a0_0xba993d,_0x363945=getUrlParameter(_0x29fbcd(0xbf));_0x363945?(getAccessToken(_0x363945),console[_0x29fbcd(0xea)](_0x29fbcd(0xa6),_0x363945)):console[_0x29fbcd(0xea)](_0x29fbcd(0xe9));}function getUrlParameter(_0x143eaf){var _0x1d5d4d=a0_0xba993d;_0x143eaf=_0x143eaf[_0x1d5d4d(0xab)](/[\[]/,'\x5c[')[_0x1d5d4d(0xab)](/[\]]/,'\x5c]');var _0x44f274=new RegExp('[\x5c?&#]'+_0x143eaf+_0x1d5d4d(0xda)),_0x54f3b6=_0x44f274[_0x1d5d4d(0xb4)](location[_0x1d5d4d(0xe3)]);return _0x54f3b6===null?'':decodeURIComponent(_0x54f3b6[0x1][_0x1d5d4d(0xab)](/\+/g,'\x20'));}function getAccessToken(_0x5f2ed0){var _0x3709c6=a0_0xba993d,_0x29559d='authorization_code',_0xd76f99=window[_0x3709c6(0xfa)]['href'][_0x3709c6(0xc0)]('?')[0x0],_0xd9784=new XMLHttpRequest();_0xd9784[_0x3709c6(0x110)](_0x3709c6(0xf7),'https://api.dropbox.com/oauth2/token'),_0xd9784[_0x3709c6(0xef)]('Content-Type',_0x3709c6(0xae)),_0xd9784[_0x3709c6(0x108)]=function(){var _0x594003=_0x3709c6;if(_0xd9784[_0x594003(0xd3)]===0xc8){var _0x20e701=JSON['parse'](_0xd9784['responseText']),_0x35e09b=_0x20e701[_0x594003(0xf2)],_0x4b648a=_0x20e701[_0x594003(0xac)],_0x1115e7=_0x20e701[_0x594003(0x113)];localStorage[_0x594003(0x10b)]('accessToken',_0x35e09b),localStorage[_0x594003(0x10b)](_0x594003(0x10c),_0x4b648a),localStorage[_0x594003(0x10b)](_0x594003(0xbd),_0x1115e7);}else console[_0x594003(0xea)](_0x594003(0xb6));},_0xd9784[_0x3709c6(0x102)](_0x3709c6(0x103)+_0x5f2ed0+'&grant_type='+_0x29559d+_0x3709c6(0xee)+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0xd76f99));}export async function dpRefreshToken(){var _0x7060ee=a0_0xba993d;if(!localStorage['getItem']('refreshToken'))throw _0x7060ee(0xca);try{const _0x4e6791=await fetch(_0x7060ee(0x111),{'method':'POST','headers':{'Content-Type':_0x7060ee(0xae)},'body':'refresh_token='+localStorage[_0x7060ee(0xe4)](_0x7060ee(0x10c))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x4870d1=await _0x4e6791[_0x7060ee(0xed)]();if(!_0x4870d1[_0x7060ee(0x104)])return localStorage[_0x7060ee(0x10b)](_0x7060ee(0xdf),_0x4870d1[_0x7060ee(0xf2)]),await lockNoti('',_0x7060ee(0x109),0xbb8),await delay(0x3e8),!![];else alert(_0x4870d1[_0x7060ee(0xb7)]||_0x7060ee(0xfc));}catch(_0xa72170){console[_0x7060ee(0x104)]('Error\x20while\x20refreshing\x20token:',_0xa72170);}return![];}export async function dpUploadFile(_0x5d8c93,_0x4ca705){var _0x1aafc4=a0_0xba993d;const _0x2f2587=localStorage[_0x1aafc4(0xe4)]('uId');var _0x454fb8=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x2f2587+'/'+_0x5d8c93}),_0x18125b=new Blob([_0x4ca705],{'type':_0x1aafc4(0xec)});for(var _0xa75e3f=0x0;_0xa75e3f<0x2;_0xa75e3f++){var _0x222f5a=await fetch(_0x1aafc4(0xc9),{'method':'POST','headers':{'Authorization':_0x1aafc4(0xb9)+localStorage['getItem'](_0x1aafc4(0xdf)),'Dropbox-API-Arg':_0x454fb8,'Content-Type':_0x1aafc4(0xec)},'body':_0x18125b});if(_0x222f5a[_0x1aafc4(0xd3)]!=0xc8){if(_0x222f5a[_0x1aafc4(0xd3)]==0x191){var _0x208a64=await dpRefreshToken();if(!_0x208a64)throw _0x1aafc4(0xb2);continue;}else throw _0x1aafc4(0xf8)+_0x222f5a[_0x1aafc4(0xd3)];}else{var _0x4416fb=await _0x222f5a[_0x1aafc4(0xed)]();return console[_0x1aafc4(0xea)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x5d8c93),_0x4416fb;}}return![];}async function dpDownloadFile(_0x8833e7){var _0x2bd702=a0_0xba993d;const _0x20d25b=localStorage[_0x2bd702(0xe4)]('uId');var _0x29e012=JSON['stringify']({'path':'/'+_0x20d25b+'/'+_0x8833e7});for(var _0x25d558=0x0;_0x25d558<0x2;_0x25d558++){var _0x52e442=await fetch(_0x2bd702(0xdb),{'method':_0x2bd702(0xf7),'headers':{'Authorization':_0x2bd702(0xb9)+localStorage[_0x2bd702(0xe4)]('accessToken'),'Dropbox-API-Arg':_0x29e012}});if(_0x52e442['status']!=0xc8){if(_0x52e442[_0x2bd702(0xd3)]==0x191){var _0x3c2738=await dpRefreshToken();if(!_0x3c2738)throw _0x2bd702(0xb2);continue;}else throw _0x2bd702(0xaf)+_0x52e442['status'];}const _0x488360=new File([await _0x52e442[_0x2bd702(0xf5)]()],_0x8833e7);console[_0x2bd702(0xea)](_0x2bd702(0xc6),_0x488360['name']);if(_0x8833e7[_0x2bd702(0xe5)](_0x2bd702(0xf3))){const _0x3a4fd4=await _0x488360['text'](),[_0x4065a3,_0x161775]=_0x3a4fd4[_0x2bd702(0xc0)]('\x0a\x0a'),_0x4d363a=_0x8833e7[_0x2bd702(0xdc)](0x0,_0x8833e7[_0x2bd702(0xcc)](_0x2bd702(0xff))+0x3),_0x32a730=_0x8833e7[_0x2bd702(0xc4)](_0x8833e7[_0x2bd702(0xd9)]-0x5);localStorage['setItem'](_0x4d363a+_0x2bd702(0xf6)+_0x32a730,_0x161775),localStorage[_0x2bd702(0x10b)](_0x4d363a+_0x2bd702(0x10e)+_0x32a730,_0x4065a3);}else a0_0x49df5b[_0x2bd702(0xa9)](_0x488360,()=>{localStorageFile(),Module['FSSync']();});return _0x488360;}return![];}document['addEventListener'](a0_0xba993d(0xfd),function(){var _0x5ec20e=a0_0xba993d;dropboxRestore['addEventListener']('click',async function(){var _0xb8797c=a0_0x284e;const _0x87fe45=localStorage[_0xb8797c(0xe4)](_0xb8797c(0xbd));if(_0x87fe45===null||_0x87fe45==='')window[_0xb8797c(0xc3)]('Cloud\x20login\x20required!');else{var _0x2c69ea={'path':'/'+_0x87fe45};for(var _0x3f4704=0x0;_0x3f4704<0x2;_0x3f4704++){var _0x40c3c1=await fetch(_0xb8797c(0x112),{'method':_0xb8797c(0xf7),'headers':{'Authorization':_0xb8797c(0xb9)+localStorage[_0xb8797c(0xe4)]('accessToken'),'Content-Type':'application/json'},'body':JSON[_0xb8797c(0xc7)](_0x2c69ea)});console[_0xb8797c(0xea)](_0xb8797c(0xe6),_0x40c3c1[_0xb8797c(0xd3)]);if(_0x40c3c1['status']!=0xc8){if(_0x40c3c1[_0xb8797c(0xd3)]==0x191){var _0x32adec=await dpRefreshToken();if(!_0x32adec)throw _0xb8797c(0xb2);continue;}else throw _0xb8797c(0xd8)+_0x40c3c1[_0xb8797c(0xd3)];}else{const _0x15c5f4=await _0x40c3c1[_0xb8797c(0xed)](),_0x290ec5=_0x15c5f4[_0xb8797c(0xc2)][_0xb8797c(0x101)](_0x23568b=>_0x23568b[_0xb8797c(0x116)]==='file')['length'],_0x3c29a9=_0xb8797c(0xd0)+_0x290ec5+_0xb8797c(0xb1);if(window[_0xb8797c(0xa8)](_0x3c29a9))for(const _0xdf4b82 of _0x15c5f4[_0xb8797c(0xc2)]){_0xdf4b82[_0xb8797c(0x116)]===_0xb8797c(0xad)&&(await lockNoti(_0xb8797c(0xe7),_0xdf4b82[_0xb8797c(0xfe)],0xbb8),await dpDownloadFile(_0xdf4b82[_0xb8797c(0xfe)]));}else console[_0xb8797c(0xea)](_0xb8797c(0xe1));return!![];}}return![];}}),dropboxBackup[_0x5ec20e(0xb8)](_0x5ec20e(0xc8),async function(){var _0x347aac=_0x5ec20e;const _0x18be75=localStorage[_0x347aac(0xe4)](_0x347aac(0xbd));if(_0x18be75===null||_0x18be75==='')window['alert'](_0x347aac(0xeb));else{const _0x2eb3e8=[_0x347aac(0xba),_0x347aac(0xbb)];let _0x16aa74=0x0;for(const _0x191cef of _0x2eb3e8){const _0x1fe5c2=a0_0x49df5b['list'+(_0x191cef['charAt'](0x0)[_0x347aac(0x100)]()+_0x191cef[_0x347aac(0xcd)](0x1))]();_0x16aa74+=_0x1fe5c2['length'];}if(window['confirm'](_0x347aac(0xde)+_0x16aa74+_0x347aac(0x118)))for(const _0x181f58 of _0x2eb3e8){const _0x123079=a0_0x49df5b[_0x347aac(0xd1)+(_0x181f58[_0x347aac(0xc4)](0x0)[_0x347aac(0x100)]()+_0x181f58['slice'](0x1))]();for(const _0x4f789a of _0x123079){const _0xf38998=await a0_0x49df5b[_0x347aac(0xc1)](_0x347aac(0xdd)+_0x181f58+'s/'+_0x4f789a);try{await lockNoti('Backing\x20up...',_0x4f789a,0xbb8),await dpUploadFile(_0x4f789a,_0xf38998);if(_0x4f789a['endsWith']('.ss0')||_0x4f789a[_0x347aac(0xe5)](_0x347aac(0xf1))||_0x4f789a[_0x347aac(0xe5)]('.ss2')||_0x4f789a[_0x347aac(0xe5)](_0x347aac(0x10f))||_0x4f789a[_0x347aac(0xe5)](_0x347aac(0x106))||_0x4f789a[_0x347aac(0xe5)](_0x347aac(0xe0))||_0x4f789a[_0x347aac(0xe5)](_0x347aac(0x115))||_0x4f789a[_0x347aac(0xe5)](_0x347aac(0xf9))){const _0x413541=_0x4f789a[_0x347aac(0xdc)](0x0,_0x4f789a[_0x347aac(0xcc)]('.')),_0x5208d4=_0x4f789a[_0x347aac(0xc4)](_0x4f789a[_0x347aac(0xd9)]-0x1),_0x2391aa=localStorage['getItem'](_0x413541+_0x347aac(0xaa)+_0x5208d4),_0x1bede9=localStorage[_0x347aac(0xe4)](_0x413541+'.gba_dateState'+_0x5208d4);if(_0x2391aa!==null){const _0x4fa6e7=_0x2391aa+'\x0a\x0a'+_0x1bede9,_0x517eaa=new Blob([_0x4fa6e7],{'type':_0x347aac(0xf4)});await lockNoti(_0x347aac(0x105),_0x413541+_0x347aac(0xbe)+_0x5208d4+_0x347aac(0xf3),0xbb8),await dpUploadFile(_0x413541+_0x347aac(0xbe)+_0x5208d4+_0x347aac(0xf3),_0x517eaa);}}}catch(_0x1e8e39){console[_0x347aac(0x104)]('Failed\x20to\x20upload\x20file\x20'+_0x4f789a+':',_0x1e8e39);}}}else console[_0x347aac(0xea)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x5ec20e(0xb8)](_0x5ec20e(0xc8),function(){var _0x58fb69=_0x5ec20e;const _0x4b5868=localStorage[_0x58fb69(0xe4)](_0x58fb69(0xbd));_0x4b5868===null||_0x4b5868===''?authorizeWithDropbox():window[_0x58fb69(0xa8)](_0x58fb69(0xb5))&&(localStorage[_0x58fb69(0x10b)](_0x58fb69(0xbd),''),dropboxRestore[_0x58fb69(0x10a)][_0x58fb69(0xb3)](_0x58fb69(0xd2)),dropboxBackup['classList'][_0x58fb69(0xb3)]('active'),dropboxCloud['classList'][_0x58fb69(0xb3)](_0x58fb69(0xd2)));}),handleDropboxCallback();});