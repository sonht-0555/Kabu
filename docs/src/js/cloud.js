var a0_0x2b44fe=a0_0x4179;(function(_0x4e8cd9,_0x5ac966){var _0x1f5dd2=a0_0x4179,_0x4411b3=_0x4e8cd9();while(!![]){try{var _0x428047=-parseInt(_0x1f5dd2(0x19b))/0x1*(-parseInt(_0x1f5dd2(0x17d))/0x2)+parseInt(_0x1f5dd2(0x190))/0x3+-parseInt(_0x1f5dd2(0x1a1))/0x4+-parseInt(_0x1f5dd2(0x1ba))/0x5+-parseInt(_0x1f5dd2(0x1a7))/0x6*(-parseInt(_0x1f5dd2(0x171))/0x7)+parseInt(_0x1f5dd2(0x192))/0x8+-parseInt(_0x1f5dd2(0x1c8))/0x9;if(_0x428047===_0x5ac966)break;else _0x4411b3['push'](_0x4411b3['shift']());}catch(_0x683780){_0x4411b3['push'](_0x4411b3['shift']());}}}(a0_0x2c04,0xe0f13));import*as a0_0x19a193 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2b44fe(0x172),clientSecret=a0_0x2b44fe(0x1aa);function authorizeWithDropbox(){var _0x513061=a0_0x2b44fe,_0x4a12ef=window['location'][_0x513061(0x1c6)][_0x513061(0x19c)]('?')[0x0],_0x4132dc=_0x513061(0x1b6),_0x19005c=_0x513061(0x1d1),_0xc7836a=_0x513061(0x17b)+clientId+_0x513061(0x184)+_0x4132dc+_0x513061(0x1cc)+_0x19005c+_0x513061(0x1ce)+encodeURIComponent(_0x4a12ef);window[_0x513061(0x1b7)][_0x513061(0x1c6)]=_0xc7836a;}function handleDropboxCallback(){var _0x1682a9=a0_0x2b44fe,_0x18754b=getUrlParameter(_0x1682a9(0x1b6));_0x18754b?(getAccessToken(_0x18754b),console[_0x1682a9(0x1ad)](_0x1682a9(0x1ca),_0x18754b)):console[_0x1682a9(0x1ad)](_0x1682a9(0x1b2));}function getUrlParameter(_0x9441fd){var _0x3ff95a=a0_0x2b44fe;_0x9441fd=_0x9441fd['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x44fe7d=new RegExp(_0x3ff95a(0x1ac)+_0x9441fd+'=([^&#]*)'),_0xc72ae0=_0x44fe7d[_0x3ff95a(0x1b4)](location[_0x3ff95a(0x18f)]);return _0xc72ae0===null?'':decodeURIComponent(_0xc72ae0[0x1][_0x3ff95a(0x1a4)](/\+/g,'\x20'));}function getAccessToken(_0x22c35c){var _0x6ae12=a0_0x2b44fe,_0x5a6e09=_0x6ae12(0x18a),_0x43ca91=window[_0x6ae12(0x1b7)][_0x6ae12(0x1c6)][_0x6ae12(0x19c)]('?')[0x0],_0x22c99b=new XMLHttpRequest();_0x22c99b[_0x6ae12(0x18d)](_0x6ae12(0x173),'https://api.dropbox.com/oauth2/token'),_0x22c99b[_0x6ae12(0x1a0)]('Content-Type',_0x6ae12(0x194)),_0x22c99b['onload']=function(){var _0x38cc17=_0x6ae12;if(_0x22c99b[_0x38cc17(0x1a3)]===0xc8){var _0x33bb79=JSON['parse'](_0x22c99b[_0x38cc17(0x198)]),_0x276041=_0x33bb79[_0x38cc17(0x18b)],_0x16d31a=_0x33bb79['refresh_token'],_0x1a4ab0=_0x33bb79['uid'];localStorage[_0x38cc17(0x197)](_0x38cc17(0x180),_0x276041),localStorage['setItem'](_0x38cc17(0x199),_0x16d31a),localStorage['setItem']('uId',_0x1a4ab0);}else console['log'](_0x38cc17(0x1bf));},_0x22c99b[_0x6ae12(0x1c2)](_0x6ae12(0x1c3)+_0x22c35c+'&grant_type='+_0x5a6e09+'&client_id='+clientId+_0x6ae12(0x1bb)+clientSecret+_0x6ae12(0x1ce)+encodeURIComponent(_0x43ca91));}export async function dpCreateFolder(_0x52641d){var _0xb61ff=a0_0x2b44fe;const _0x5e3e1d=localStorage[_0xb61ff(0x19e)](_0xb61ff(0x1c4));let _0x2d584a=localStorage[_0xb61ff(0x19e)](_0xb61ff(0x180));const _0x8a9cfa='/'+_0x5e3e1d+'/'+_0x52641d,_0x1d220b=JSON['stringify']({'path':_0x8a9cfa,'autorename':![]});for(let _0x36820e=0x0;_0x36820e<0x2;_0x36820e++){try{const _0x185085=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':'POST','headers':{'Authorization':_0xb61ff(0x1b9)+_0x2d584a,'Content-Type':_0xb61ff(0x196)},'body':_0x1d220b});if(_0x185085[_0xb61ff(0x1a3)]===0x191){const _0x1593d3=await dpRefreshToken();if(!_0x1593d3)throw new Error('Unable\x20to\x20refresh\x20token');_0x2d584a=localStorage[_0xb61ff(0x19e)]('accessToken');continue;}if(_0x185085[_0xb61ff(0x1a3)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x52641d};if(!_0x185085['ok'])throw new Error(_0xb61ff(0x1b0)+_0x52641d);const _0xfde317=await _0x185085[_0xb61ff(0x1d0)]();return await lockNoti(_0xb61ff(0x1c5),'',0xbb8),_0xfde317;}catch(_0x5d4fb0){if(_0x36820e===0x1)throw _0x5d4fb0;}}return![];}export async function dpRefreshToken(){var _0x3970e1=a0_0x2b44fe;if(!localStorage[_0x3970e1(0x19e)]('refreshToken'))throw'No\x20refresh\x20token';try{const _0x3c627e=await fetch(_0x3970e1(0x1ae),{'method':'POST','headers':{'Content-Type':_0x3970e1(0x194)},'body':_0x3970e1(0x1a9)+localStorage['getItem'](_0x3970e1(0x199))+_0x3970e1(0x17c)}),_0x5d1a17=await _0x3c627e['json']();if(!_0x5d1a17[_0x3970e1(0x185)])return localStorage[_0x3970e1(0x197)](_0x3970e1(0x180),_0x5d1a17[_0x3970e1(0x18b)]),await lockNoti(_0x3970e1(0x1bd),'',0xbb8),await delay(0x3e8),!![];else alert(_0x5d1a17['error_description']||_0x3970e1(0x191));}catch(_0x41adab){console[_0x3970e1(0x185)]('Error\x20while\x20refreshing\x20token:',_0x41adab);}return![];}export async function dpUploadFile(_0x1a951a,_0x5be3c0,_0x16d563){var _0x4b1726=a0_0x2b44fe;const _0x19df5f=localStorage[_0x4b1726(0x19e)](_0x4b1726(0x1c4));var _0xf8a327=JSON['stringify']({'autorename':!![],'mode':_0x4b1726(0x193),'mute':!![],'strict_conflict':![],'path':'/'+_0x19df5f+'/'+_0x16d563+'/'+_0x1a951a}),_0x501800=new Blob([_0x5be3c0],{'type':_0x4b1726(0x19d)});for(var _0x1ab486=0x0;_0x1ab486<0x2;_0x1ab486++){var _0x4c20c0=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x4b1726(0x173),'headers':{'Authorization':_0x4b1726(0x1b9)+localStorage[_0x4b1726(0x19e)]('accessToken'),'Dropbox-API-Arg':_0xf8a327,'Content-Type':_0x4b1726(0x19d)},'body':_0x501800});if(_0x4c20c0[_0x4b1726(0x1a3)]!=0xc8){if(_0x4c20c0[_0x4b1726(0x1a3)]==0x191){var _0x48b34d=await dpRefreshToken();if(!_0x48b34d)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x4b1726(0x1cd)+_0x4c20c0['status'];}else{var _0x3ad40b=await _0x4c20c0[_0x4b1726(0x1d0)]();return console['log'](_0x4b1726(0x17f),_0x1a951a),_0x3ad40b;}}return![];}export async function dpDownloadFile(_0x11d244,_0x437caa){var _0x46f9b3=a0_0x2b44fe;const _0x2bc282=localStorage[_0x46f9b3(0x19e)](_0x46f9b3(0x1c4));var _0x3fc7fc=JSON['stringify']({'path':'/'+_0x2bc282+'/'+_0x437caa+'/'+_0x11d244});for(var _0x3366d9=0x0;_0x3366d9<0x2;_0x3366d9++){var _0xb8d11a=await fetch('https://content.dropboxapi.com/2/files/download',{'method':'POST','headers':{'Authorization':_0x46f9b3(0x1b9)+localStorage[_0x46f9b3(0x19e)](_0x46f9b3(0x180)),'Dropbox-API-Arg':_0x3fc7fc}});if(_0xb8d11a['status']!=0xc8){if(_0xb8d11a['status']==0x191){var _0x3ee10d=await dpRefreshToken();if(!_0x3ee10d)throw _0x46f9b3(0x177);continue;}else throw _0x46f9b3(0x178)+_0xb8d11a[_0x46f9b3(0x1a3)];}const _0x2a22a7=new File([await _0xb8d11a[_0x46f9b3(0x176)]()],_0x11d244);return console[_0x46f9b3(0x1ad)](_0x46f9b3(0x187),_0x2a22a7[_0x46f9b3(0x186)]),a0_0x19a193[_0x46f9b3(0x19f)](_0x2a22a7,()=>{}),_0x2a22a7;}return![];}function a0_0x4179(_0x3595de,_0x435c97){var _0x2c047e=a0_0x2c04();return a0_0x4179=function(_0x41794a,_0x478bdf){_0x41794a=_0x41794a-0x170;var _0x4b0509=_0x2c047e[_0x41794a];return _0x4b0509;},a0_0x4179(_0x3595de,_0x435c97);}function a0_0x2c04(){var _0xbc75dc=['nwb3dnfh09rhs31','push','[\x5c?&#]','log','https://api.dropboxapi.com/oauth2/token','click','Error\x20creating\x20folder\x20','stringify','Do\x20not\x20receive\x20authorization','Failed\x20to\x20upload\x20file\x20','exec','state','code','location','active','Bearer\x20','2210720PDiVHL','&client_secret=','save','Refreshing\x20token...','remove','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','confirm','Cloud\x20login\x20required!','send','code=','uId','Folder\x20created','href','Restore\x20canceled\x20by\x20user.','17719218YRDqjj','screenshot','Authorization\x20Code:','file','&token_access_type=','Upload\x20failed,\x20unknown\x20http\x20status:\x20','&redirect_uri=','No\x20files\x20found\x20to\x20restore.','json','offline','\x20files\x20in\x20Kabu?','33110CwHkMX','knh3uz2mx2hp2eu','POST','downloadFileInCloud','addEventListener','blob','Unable\x20to\x20refresh\x20token','Download\x20failed,\x20unknown\x20http\x20status:','entries','filter','https://www.dropbox.com/oauth2/authorize?client_id=','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','826QTTbfj','/data/','Kabu\x20storage\x20↦\x20Cloud\x20◆','accessToken','Do\x20you\x20want\x20to\x20logout?','map','Backing\x20up...','&response_type=','error','name','Cloud\x20↦\x20Kabu\x20storage\x20◆','Do\x20you\x20want\x20to\x20restore\x20','alert','authorization_code','access_token','DOMContentLoaded','open','listFiles','search','2246676Clworm','Failed\x20to\x20refresh\x20Dropbox\x20token.','3817168XVuzxo','overwrite','application/x-www-form-urlencoded','Do\x20you\x20want\x20to\x20backup\x20','application/json','setItem','responseText','refreshToken','https://api.dropboxapi.com/2/files/list_folder','3833lOmafk','split','application/octet-stream','getItem','uploadFileInCloud','setRequestHeader','2126192sPKYqL','length','status','replace','.tag','Wait\x20a\x20little\x20bit...','1338SizNvL','classList','refresh_token='];a0_0x2c04=function(){return _0xbc75dc;};return a0_0x2c04();}document[a0_0x2b44fe(0x175)](a0_0x2b44fe(0x18c),function(){var _0x2a84c5=a0_0x2b44fe;dropboxRestore['addEventListener']('click',async function(){var _0xf2b58b=a0_0x4179;await lockNoti(_0xf2b58b(0x1a6),'',0x1388);const _0x2b0398=localStorage[_0xf2b58b(0x19e)](_0xf2b58b(0x1c4)),_0x2b32e3=[_0xf2b58b(0x1b5),_0xf2b58b(0x1bc),'screenshot'];if(!_0x2b0398){window[_0xf2b58b(0x189)]('Cloud\x20login\x20required!');return;}let _0x57d8e7=[];for(const _0x48c48a of _0x2b32e3){let _0x364f48={'path':'/'+_0x2b0398+'/'+_0x48c48a};for(let _0x2cf0ea=0x0;_0x2cf0ea<0x2;_0x2cf0ea++){let _0x47ae48=await fetch(_0xf2b58b(0x19a),{'method':_0xf2b58b(0x173),'headers':{'Authorization':_0xf2b58b(0x1b9)+localStorage[_0xf2b58b(0x19e)](_0xf2b58b(0x180)),'Content-Type':'application/json'},'body':JSON[_0xf2b58b(0x1b1)](_0x364f48)});if(_0x47ae48[_0xf2b58b(0x1a3)]===0xc8){let _0x5c301b=await _0x47ae48['json'](),_0x2fbd36=_0x5c301b[_0xf2b58b(0x179)][_0xf2b58b(0x17a)](_0x1d2e78=>_0x1d2e78[_0xf2b58b(0x1a5)]===_0xf2b58b(0x1cb));_0x2fbd36['length']>0x0&&_0x57d8e7[_0xf2b58b(0x1ab)](..._0x2fbd36[_0xf2b58b(0x182)](_0xf61a88=>({'name':_0xf61a88[_0xf2b58b(0x186)],'folder':_0x48c48a})));break;}else{if(_0x47ae48[_0xf2b58b(0x1a3)]===0x191){let _0x1e4f6=await dpRefreshToken();if(!_0x1e4f6)throw _0xf2b58b(0x177);}else{console[_0xf2b58b(0x185)]('Download\x20failed\x20for\x20'+_0x48c48a+',\x20status:\x20'+_0x47ae48['status']);break;}}}}if(_0x57d8e7[_0xf2b58b(0x1a2)]>0x0){const _0x482c87=_0xf2b58b(0x188)+_0x57d8e7[_0xf2b58b(0x1a2)]+'\x20files\x20from\x20Cloud?';if(window['confirm'](_0x482c87))for(const _0x1c323d of _0x57d8e7){await lockNoti('Restoring...',_0x1c323d['name'],0xbb8),await dpDownloadFile(_0x1c323d['name'],_0x1c323d['folder']);}else console[_0xf2b58b(0x1ad)]('Restore\x20canceled\x20by\x20user.');}else console[_0xf2b58b(0x1ad)](_0xf2b58b(0x1cf));}),dropboxBackup[_0x2a84c5(0x175)](_0x2a84c5(0x1af),async function(){var _0x1b97a2=_0x2a84c5;await lockNoti(_0x1b97a2(0x1a6),'',0x1388);const _0x2e5527=localStorage['getItem'](_0x1b97a2(0x1c4));if(_0x2e5527===null||_0x2e5527==='')window[_0x1b97a2(0x189)](_0x1b97a2(0x1c1));else{const _0x5087c8=[_0x1b97a2(0x1b5),_0x1b97a2(0x1bc),_0x1b97a2(0x1c9)];for(const _0x4acb36 of _0x5087c8){await dpCreateFolder(_0x4acb36);}let _0x58aa2f=0x0;for(const _0x42dc98 of _0x5087c8){const _0x5216d0=a0_0x19a193[_0x1b97a2(0x18e)](_0x42dc98+'s');_0x58aa2f+=_0x5216d0[_0x1b97a2(0x1a2)];}if(window[_0x1b97a2(0x1c0)](_0x1b97a2(0x195)+_0x58aa2f+_0x1b97a2(0x170)))for(const _0x528ef7 of _0x5087c8){const _0x2cb3d1=a0_0x19a193[_0x1b97a2(0x18e)](_0x528ef7+'s');for(const _0x491d25 of _0x2cb3d1){const _0x36c1c2=await a0_0x19a193[_0x1b97a2(0x174)](_0x1b97a2(0x17e)+_0x528ef7+'s/'+_0x491d25);try{await lockNoti(_0x1b97a2(0x183),_0x491d25,0xbb8),await dpUploadFile(_0x491d25,_0x36c1c2,_0x528ef7);}catch(_0x3038b5){console[_0x1b97a2(0x185)](_0x1b97a2(0x1b3)+_0x491d25+':',_0x3038b5);}}}else console[_0x1b97a2(0x1ad)](_0x1b97a2(0x1c7));}}),dropboxCloud['addEventListener']('click',function(){var _0x133cec=_0x2a84c5;const _0x29ec7d=localStorage['getItem'](_0x133cec(0x1c4));_0x29ec7d===null||_0x29ec7d===''?authorizeWithDropbox():window[_0x133cec(0x1c0)](_0x133cec(0x181))&&(localStorage[_0x133cec(0x197)]('uId',''),dropboxRestore[_0x133cec(0x1a8)][_0x133cec(0x1be)](_0x133cec(0x1b8)),dropboxBackup['classList'][_0x133cec(0x1be)](_0x133cec(0x1b8)),dropboxCloud['classList']['remove'](_0x133cec(0x1b8)));}),handleDropboxCallback();});