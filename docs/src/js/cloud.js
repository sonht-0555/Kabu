var a0_0x3df31a=a0_0xb7f1;(function(_0x39ec30,_0x12d842){var _0x21a2b4=a0_0xb7f1,_0x26771a=_0x39ec30();while(!![]){try{var _0x21e512=-parseInt(_0x21a2b4(0x102))/0x1*(parseInt(_0x21a2b4(0x156))/0x2)+-parseInt(_0x21a2b4(0x13d))/0x3*(parseInt(_0x21a2b4(0x10d))/0x4)+-parseInt(_0x21a2b4(0x111))/0x5+parseInt(_0x21a2b4(0x141))/0x6+parseInt(_0x21a2b4(0x13a))/0x7*(parseInt(_0x21a2b4(0x101))/0x8)+-parseInt(_0x21a2b4(0x12c))/0x9*(parseInt(_0x21a2b4(0x150))/0xa)+parseInt(_0x21a2b4(0x153))/0xb;if(_0x21e512===_0x12d842)break;else _0x26771a['push'](_0x26771a['shift']());}catch(_0x1ad6ba){_0x26771a['push'](_0x26771a['shift']());}}}(a0_0x8639,0xe423d));import*as a0_0x88e677 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x3df31a(0xfe),clientSecret=a0_0x3df31a(0x11d);function a0_0x8639(){var _0x2f9399=['push','Wait\x20a\x20little\x20bit...','Bearer\x20','Download\x20failed\x20for\x20','remove','https://api.dropboxapi.com/2/files/list_folder','knh3uz2mx2hp2eu','parse','https://api.dropboxapi.com/oauth2/token','8EwRmVg','6oDkonf','Restore\x20canceled\x20by\x20user.','Do\x20you\x20want\x20to\x20restore\x20','Error\x20creating\x20folder\x20','list','name','addEventListener','onload','setItem','application/json','stringify','4NKICFR','slice','[\x5c?&#]','folder','6255480kraqiM','Backing\x20up...','code=','application/octet-stream','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','map','Download\x20failed,\x20unknown\x20http\x20status:','classList','search','json','length','Do\x20you\x20want\x20to\x20backup\x20','nwb3dnfh09rhs31','click','uid','toUpperCase','refreshToken','&grant_type=','Cloud\x20↦\x20Kabu\x20storage\x20◆','uId','https://content.dropboxapi.com/2/files/upload','entries','open','responseText','error_description','send','https://content.dropboxapi.com/2/files/download','1304946VzsDxI','Refreshing\x20token...','&client_id=','refresh_token=','screenshot','=([^&#]*)','split','alert','save','file','FSSync','replace','active','refresh_token','1996162VEcAaJ','Failed\x20to\x20upload\x20file\x20','https://api.dropbox.com/oauth2/token','2497923fEkGLT','Folder\x20created','Cloud\x20login\x20required!','https://api.dropboxapi.com/2/files/create_folder_v2','6823488zpcldC','exec','Do\x20you\x20want\x20to\x20logout?','POST','DOMContentLoaded','Upload\x20failed,\x20unknown\x20http\x20status:\x20','code','&redirect_uri=','/data/','confirm','log','Failed\x20to\x20refresh\x20Dropbox\x20token.','Error\x20while\x20refreshing\x20token:','location','access_token','10BCCDKT','charAt','Unable\x20to\x20refresh\x20token','34710434KznHer','blob','error','471572YMeoRM','accessToken','status','overwrite','application/x-www-form-urlencoded','Restoring...','state','Do\x20not\x20receive\x20authorization','https://www.dropbox.com/oauth2/authorize?client_id=','Folder\x20already\x20exists','No\x20refresh\x20token','href',',\x20status:\x20','getItem','setRequestHeader','offline'];a0_0x8639=function(){return _0x2f9399;};return a0_0x8639();}function authorizeWithDropbox(){var _0x3fddf2=a0_0x3df31a,_0x32b8a8=window[_0x3fddf2(0x14e)][_0x3fddf2(0x161)][_0x3fddf2(0x132)]('?')[0x0],_0x5936f4='code',_0x3f9c55=_0x3fddf2(0x165),_0x4498d0=_0x3fddf2(0x15e)+clientId+'&response_type='+_0x5936f4+'&token_access_type='+_0x3f9c55+_0x3fddf2(0x148)+encodeURIComponent(_0x32b8a8);window[_0x3fddf2(0x14e)][_0x3fddf2(0x161)]=_0x4498d0;}function a0_0xb7f1(_0x535e0c,_0x2faf0b){var _0x8639ff=a0_0x8639();return a0_0xb7f1=function(_0xb7f133,_0xd999ad){_0xb7f133=_0xb7f133-0xf8;var _0x2f807f=_0x8639ff[_0xb7f133];return _0x2f807f;},a0_0xb7f1(_0x535e0c,_0x2faf0b);}function handleDropboxCallback(){var _0x1a2f4c=a0_0x3df31a,_0x7a08ad=getUrlParameter(_0x1a2f4c(0x147));_0x7a08ad?(getAccessToken(_0x7a08ad),console['log']('Authorization\x20Code:',_0x7a08ad)):console[_0x1a2f4c(0x14b)](_0x1a2f4c(0x15d));}function getUrlParameter(_0x468283){var _0x455d48=a0_0x3df31a;_0x468283=_0x468283[_0x455d48(0x137)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x3aea6e=new RegExp(_0x455d48(0x10f)+_0x468283+_0x455d48(0x131)),_0x15ed77=_0x3aea6e[_0x455d48(0x142)](location[_0x455d48(0x119)]);return _0x15ed77===null?'':decodeURIComponent(_0x15ed77[0x1][_0x455d48(0x137)](/\+/g,'\x20'));}function getAccessToken(_0x545a6a){var _0x7e699c=a0_0x3df31a,_0x180b1e='authorization_code',_0x329eff=window[_0x7e699c(0x14e)][_0x7e699c(0x161)][_0x7e699c(0x132)]('?')[0x0],_0x18301e=new XMLHttpRequest();_0x18301e[_0x7e699c(0x127)]('POST',_0x7e699c(0x13c)),_0x18301e[_0x7e699c(0x164)]('Content-Type',_0x7e699c(0x15a)),_0x18301e[_0x7e699c(0x109)]=function(){var _0x5125fa=_0x7e699c;if(_0x18301e['status']===0xc8){var _0x343fb6=JSON[_0x5125fa(0xff)](_0x18301e[_0x5125fa(0x128)]),_0x523657=_0x343fb6[_0x5125fa(0x14f)],_0x54007c=_0x343fb6[_0x5125fa(0x139)],_0x392652=_0x343fb6[_0x5125fa(0x11f)];localStorage[_0x5125fa(0x10a)]('accessToken',_0x523657),localStorage[_0x5125fa(0x10a)](_0x5125fa(0x121),_0x54007c),localStorage['setItem']('uId',_0x392652);}else console[_0x5125fa(0x14b)](_0x5125fa(0x115));},_0x18301e[_0x7e699c(0x12a)](_0x7e699c(0x113)+_0x545a6a+_0x7e699c(0x122)+_0x180b1e+_0x7e699c(0x12e)+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0x329eff));}export async function dpCreateFolder(_0x574049){var _0x2f2ab9=a0_0x3df31a;const _0xcfba0a=localStorage[_0x2f2ab9(0x163)](_0x2f2ab9(0x124));let _0xcc55d1=localStorage[_0x2f2ab9(0x163)](_0x2f2ab9(0x157));const _0x57ecb6='/'+_0xcfba0a+'/'+_0x574049,_0x59876b=JSON[_0x2f2ab9(0x10c)]({'path':_0x57ecb6,'autorename':![]});for(let _0x3b95f9=0x0;_0x3b95f9<0x2;_0x3b95f9++){try{const _0x5bde7c=await fetch(_0x2f2ab9(0x140),{'method':_0x2f2ab9(0x144),'headers':{'Authorization':'Bearer\x20'+_0xcc55d1,'Content-Type':_0x2f2ab9(0x10b)},'body':_0x59876b});if(_0x5bde7c[_0x2f2ab9(0x158)]===0x191){const _0x4e7652=await dpRefreshToken();if(!_0x4e7652)throw new Error('Unable\x20to\x20refresh\x20token');_0xcc55d1=localStorage[_0x2f2ab9(0x163)](_0x2f2ab9(0x157));continue;}if(_0x5bde7c[_0x2f2ab9(0x158)]===0x199)return{'message':_0x2f2ab9(0x15f),'path':_0x574049};if(!_0x5bde7c['ok'])throw new Error(_0x2f2ab9(0x105)+_0x574049);const _0x57cff4=await _0x5bde7c[_0x2f2ab9(0x11a)]();return await lockNoti(_0x2f2ab9(0x13e),'',0xbb8),_0x57cff4;}catch(_0x1cf847){if(_0x3b95f9===0x1)throw _0x1cf847;}}return![];}export async function dpRefreshToken(){var _0x203c44=a0_0x3df31a;if(!localStorage[_0x203c44(0x163)](_0x203c44(0x121)))throw _0x203c44(0x160);try{const _0x296f7a=await fetch(_0x203c44(0x100),{'method':_0x203c44(0x144),'headers':{'Content-Type':_0x203c44(0x15a)},'body':_0x203c44(0x12f)+localStorage[_0x203c44(0x163)]('refreshToken')+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x2d67a2=await _0x296f7a[_0x203c44(0x11a)]();if(!_0x2d67a2[_0x203c44(0x155)])return localStorage[_0x203c44(0x10a)](_0x203c44(0x157),_0x2d67a2[_0x203c44(0x14f)]),await lockNoti(_0x203c44(0x12d),'',0xbb8),await delay(0x3e8),!![];else alert(_0x2d67a2[_0x203c44(0x129)]||_0x203c44(0x14c));}catch(_0xffcb64){console[_0x203c44(0x155)](_0x203c44(0x14d),_0xffcb64);}return![];}export async function dpUploadFile(_0x2e9017,_0x3692bc,_0x578677){var _0xfb4df6=a0_0x3df31a;const _0x55a637=localStorage[_0xfb4df6(0x163)](_0xfb4df6(0x124));var _0x11a610=JSON[_0xfb4df6(0x10c)]({'autorename':!![],'mode':_0xfb4df6(0x159),'mute':!![],'strict_conflict':![],'path':'/'+_0x55a637+'/'+_0x578677+'/'+_0x2e9017}),_0x34e937=new Blob([_0x3692bc],{'type':_0xfb4df6(0x114)});for(var _0x40ab10=0x0;_0x40ab10<0x2;_0x40ab10++){var _0x5b63ed=await fetch(_0xfb4df6(0x125),{'method':_0xfb4df6(0x144),'headers':{'Authorization':_0xfb4df6(0xfa)+localStorage['getItem']('accessToken'),'Dropbox-API-Arg':_0x11a610,'Content-Type':'application/octet-stream'},'body':_0x34e937});if(_0x5b63ed[_0xfb4df6(0x158)]!=0xc8){if(_0x5b63ed[_0xfb4df6(0x158)]==0x191){var _0x5cca62=await dpRefreshToken();if(!_0x5cca62)throw _0xfb4df6(0x152);continue;}else throw _0xfb4df6(0x146)+_0x5b63ed['status'];}else{var _0x4c9771=await _0x5b63ed[_0xfb4df6(0x11a)]();return console[_0xfb4df6(0x14b)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x2e9017),_0x4c9771;}}return![];}export async function dpDownloadFile(_0x45efdf,_0x5a4c34){var _0x2728b9=a0_0x3df31a;const _0xe00f3a=localStorage['getItem']('uId');var _0x46074e=JSON[_0x2728b9(0x10c)]({'path':'/'+_0xe00f3a+'/'+_0x5a4c34+'/'+_0x45efdf});for(var _0x46cc62=0x0;_0x46cc62<0x2;_0x46cc62++){var _0x3167c9=await fetch(_0x2728b9(0x12b),{'method':_0x2728b9(0x144),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x2728b9(0x163)](_0x2728b9(0x157)),'Dropbox-API-Arg':_0x46074e}});if(_0x3167c9[_0x2728b9(0x158)]!=0xc8){if(_0x3167c9[_0x2728b9(0x158)]==0x191){var _0x36cf65=await dpRefreshToken();if(!_0x36cf65)throw _0x2728b9(0x152);continue;}else throw _0x2728b9(0x117)+_0x3167c9[_0x2728b9(0x158)];}const _0x115ee1=new File([await _0x3167c9[_0x2728b9(0x154)]()],_0x45efdf);return console['log'](_0x2728b9(0x123),_0x115ee1[_0x2728b9(0x107)]),a0_0x88e677['uploadFileInCloud'](_0x115ee1,()=>{var _0x148f08=_0x2728b9;localStorageFile(),Module[_0x148f08(0x136)]();}),_0x115ee1;}return![];}document[a0_0x3df31a(0x108)](a0_0x3df31a(0x145),function(){var _0x492837=a0_0x3df31a;dropboxRestore[_0x492837(0x108)]('click',async function(){var _0x167b98=_0x492837;await lockNoti(_0x167b98(0xf9),'',0x1388);const _0x57b671=localStorage[_0x167b98(0x163)](_0x167b98(0x124)),_0x41ca3d=[_0x167b98(0x15c),_0x167b98(0x134),_0x167b98(0x130)];if(!_0x57b671){window[_0x167b98(0x133)](_0x167b98(0x13f));return;}let _0x1b3e19=[];for(const _0x4e5126 of _0x41ca3d){let _0x12de76={'path':'/'+_0x57b671+'/'+_0x4e5126};for(let _0x292b40=0x0;_0x292b40<0x2;_0x292b40++){let _0x27bea0=await fetch(_0x167b98(0xfd),{'method':_0x167b98(0x144),'headers':{'Authorization':_0x167b98(0xfa)+localStorage[_0x167b98(0x163)](_0x167b98(0x157)),'Content-Type':'application/json'},'body':JSON['stringify'](_0x12de76)});if(_0x27bea0[_0x167b98(0x158)]===0xc8){let _0x20e783=await _0x27bea0[_0x167b98(0x11a)](),_0x5c20aa=_0x20e783[_0x167b98(0x126)]['filter'](_0x5a4c6b=>_0x5a4c6b['.tag']===_0x167b98(0x135));_0x5c20aa[_0x167b98(0x11b)]>0x0&&_0x1b3e19[_0x167b98(0xf8)](..._0x5c20aa[_0x167b98(0x116)](_0x24d946=>({'name':_0x24d946[_0x167b98(0x107)],'folder':_0x4e5126})));break;}else{if(_0x27bea0[_0x167b98(0x158)]===0x191){let _0x43181d=await dpRefreshToken();if(!_0x43181d)throw _0x167b98(0x152);}else{console['error'](_0x167b98(0xfb)+_0x4e5126+_0x167b98(0x162)+_0x27bea0[_0x167b98(0x158)]);break;}}}}if(_0x1b3e19[_0x167b98(0x11b)]>0x0){const _0x170abb=_0x167b98(0x104)+_0x1b3e19[_0x167b98(0x11b)]+'\x20files\x20from\x20Cloud?';if(window[_0x167b98(0x14a)](_0x170abb))for(const _0x3ed8c9 of _0x1b3e19){await lockNoti(_0x167b98(0x15b),_0x3ed8c9[_0x167b98(0x107)],0xbb8),await dpDownloadFile(_0x3ed8c9[_0x167b98(0x107)],_0x3ed8c9[_0x167b98(0x110)]);}else console[_0x167b98(0x14b)]('Restore\x20canceled\x20by\x20user.');}else console[_0x167b98(0x14b)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup['addEventListener'](_0x492837(0x11e),async function(){var _0x179206=_0x492837;await lockNoti(_0x179206(0xf9),'',0x1388);const _0x194ee7=localStorage[_0x179206(0x163)]('uId');if(_0x194ee7===null||_0x194ee7==='')window[_0x179206(0x133)](_0x179206(0x13f));else{const _0x35a461=[_0x179206(0x15c),_0x179206(0x134),_0x179206(0x130)];for(const _0x359175 of _0x35a461){await dpCreateFolder(_0x359175);}let _0x53cb77=0x0;for(const _0x18c230 of _0x35a461){const _0x508908=a0_0x88e677[_0x179206(0x106)+(_0x18c230[_0x179206(0x151)](0x0)[_0x179206(0x120)]()+_0x18c230[_0x179206(0x10e)](0x1))]();_0x53cb77+=_0x508908[_0x179206(0x11b)];}if(window['confirm'](_0x179206(0x11c)+_0x53cb77+'\x20files\x20in\x20Kabu?'))for(const _0x329f79 of _0x35a461){const _0x16c07e=a0_0x88e677['list'+(_0x329f79[_0x179206(0x151)](0x0)['toUpperCase']()+_0x329f79[_0x179206(0x10e)](0x1))]();for(const _0x51b6c8 of _0x16c07e){const _0x1905d8=await a0_0x88e677['downloadFileInCloud'](_0x179206(0x149)+_0x329f79+'s/'+_0x51b6c8);try{await lockNoti(_0x179206(0x112),_0x51b6c8,0xbb8),await dpUploadFile(_0x51b6c8,_0x1905d8,_0x329f79);}catch(_0x5ccbf7){console[_0x179206(0x155)](_0x179206(0x13b)+_0x51b6c8+':',_0x5ccbf7);}}}else console[_0x179206(0x14b)](_0x179206(0x103));}}),dropboxCloud[_0x492837(0x108)](_0x492837(0x11e),function(){var _0x977958=_0x492837;const _0x18eb10=localStorage[_0x977958(0x163)](_0x977958(0x124));_0x18eb10===null||_0x18eb10===''?authorizeWithDropbox():window[_0x977958(0x14a)](_0x977958(0x143))&&(localStorage[_0x977958(0x10a)](_0x977958(0x124),''),dropboxRestore['classList'][_0x977958(0xfc)](_0x977958(0x138)),dropboxBackup[_0x977958(0x118)]['remove'](_0x977958(0x138)),dropboxCloud['classList'][_0x977958(0xfc)]('active'));}),handleDropboxCallback();});