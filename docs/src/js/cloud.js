var a0_0x43aa54=a0_0x2226;(function(_0x287d6e,_0x1c04d1){var _0x4555eb=a0_0x2226,_0x18bc5e=_0x287d6e();while(!![]){try{var _0x197757=parseInt(_0x4555eb(0x122))/0x1+parseInt(_0x4555eb(0x120))/0x2*(parseInt(_0x4555eb(0x151))/0x3)+parseInt(_0x4555eb(0x111))/0x4*(-parseInt(_0x4555eb(0x16d))/0x5)+parseInt(_0x4555eb(0x13a))/0x6*(-parseInt(_0x4555eb(0x12b))/0x7)+-parseInt(_0x4555eb(0x121))/0x8+parseInt(_0x4555eb(0x147))/0x9*(parseInt(_0x4555eb(0x12d))/0xa)+parseInt(_0x4555eb(0x10f))/0xb*(-parseInt(_0x4555eb(0x139))/0xc);if(_0x197757===_0x1c04d1)break;else _0x18bc5e['push'](_0x18bc5e['shift']());}catch(_0x2eef6b){_0x18bc5e['push'](_0x18bc5e['shift']());}}}(a0_0x2e9a,0xb7fb7));import*as a0_0x346777 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x43aa54(0x13f),clientSecret=a0_0x43aa54(0x11c);function a0_0x2e9a(){var _0x504d09=['https://api.dropboxapi.com/2/files/create_folder_v2','.tag','code=','exec','https://content.dropboxapi.com/2/files/download','parse','state','&grant_type=','https://api.dropboxapi.com/oauth2/token','json','POST','Content-Type','&client_secret=','active','remove','Backing\x20up...','20qehKPQ','refresh_token','responseText','&response_type=','getItem','onload','code','addEventListener','log','450329RuYhZt','click','641392KvgYeL','Error\x20creating\x20folder\x20','offline','downloadFileInCloud','search','Folder\x20already\x20exists','uid','access_token','file','confirm','\x20files\x20from\x20Cloud?','nwb3dnfh09rhs31','status','/data/','Kabu\x20storage\x20↦\x20Cloud\x20◆','7698eNgnrq','3561576lgcAkR','365812mQyvZr','refresh_token=','Wait\x20a\x20little\x20bit...','DOMContentLoaded','alert','length','=([^&#]*)','application/octet-stream','setItem','2144233uhynLR','accessToken','2627810YGnOwu','&client_id=','Bearer\x20','https://www.dropbox.com/oauth2/authorize?client_id=','https://api.dropboxapi.com/2/files/list_folder','overwrite','uId','refreshToken','application/json','Refreshing\x20token...','uploadFileInCloud','Upload\x20failed,\x20unknown\x20http\x20status:\x20','60louJGJ','6foVgRL','Restore\x20canceled\x20by\x20user.','No\x20refresh\x20token','split','[\x5c?&#]','knh3uz2mx2hp2eu','No\x20files\x20found\x20to\x20restore.','Cloud\x20login\x20required!','application/x-www-form-urlencoded','Unable\x20to\x20refresh\x20token','location','send','save','27AjoGSD','href','Authorization\x20Code:','open','Folder\x20created','Do\x20you\x20want\x20to\x20logout?','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','https://content.dropboxapi.com/2/files/upload','name','error','933rTtKaw','blob','entries','listFiles','Do\x20not\x20receive\x20authorization','&redirect_uri=','Failed\x20to\x20refresh\x20Dropbox\x20token.','https://api.dropbox.com/oauth2/token','classList','screenshot','replace','Download\x20failed\x20for\x20'];a0_0x2e9a=function(){return _0x504d09;};return a0_0x2e9a();}function authorizeWithDropbox(){var _0x3714ab=a0_0x43aa54,_0x5a4165=window['location'][_0x3714ab(0x148)][_0x3714ab(0x13d)]('?')[0x0],_0x519b76=_0x3714ab(0x173),_0x222c9d=_0x3714ab(0x113),_0x34cb13=_0x3714ab(0x130)+clientId+_0x3714ab(0x170)+_0x519b76+'&token_access_type='+_0x222c9d+_0x3714ab(0x156)+encodeURIComponent(_0x5a4165);window[_0x3714ab(0x144)][_0x3714ab(0x148)]=_0x34cb13;}function handleDropboxCallback(){var _0x5bd7b1=a0_0x43aa54,_0x164530=getUrlParameter(_0x5bd7b1(0x173));_0x164530?(getAccessToken(_0x164530),console[_0x5bd7b1(0x10e)](_0x5bd7b1(0x149),_0x164530)):console[_0x5bd7b1(0x10e)](_0x5bd7b1(0x155));}function getUrlParameter(_0x4f4c0c){var _0x357b4e=a0_0x43aa54;_0x4f4c0c=_0x4f4c0c['replace'](/[\[]/,'\x5c[')[_0x357b4e(0x15b)](/[\]]/,'\x5c]');var _0x107e6c=new RegExp(_0x357b4e(0x13e)+_0x4f4c0c+_0x357b4e(0x128)),_0x3e0def=_0x107e6c[_0x357b4e(0x160)](location[_0x357b4e(0x115)]);return _0x3e0def===null?'':decodeURIComponent(_0x3e0def[0x1][_0x357b4e(0x15b)](/\+/g,'\x20'));}function a0_0x2226(_0x584cc4,_0x2d93f4){var _0x2e9abc=a0_0x2e9a();return a0_0x2226=function(_0x222677,_0x121e5e){_0x222677=_0x222677-0x10e;var _0x4908f0=_0x2e9abc[_0x222677];return _0x4908f0;},a0_0x2226(_0x584cc4,_0x2d93f4);}function getAccessToken(_0x3f056f){var _0x72acc6=a0_0x43aa54,_0x19ad5c='authorization_code',_0x495a23=window[_0x72acc6(0x144)][_0x72acc6(0x148)][_0x72acc6(0x13d)]('?')[0x0],_0x27213b=new XMLHttpRequest();_0x27213b[_0x72acc6(0x14a)](_0x72acc6(0x167),_0x72acc6(0x158)),_0x27213b['setRequestHeader'](_0x72acc6(0x168),_0x72acc6(0x142)),_0x27213b[_0x72acc6(0x172)]=function(){var _0x2b0c8d=_0x72acc6;if(_0x27213b[_0x2b0c8d(0x11d)]===0xc8){var _0xabf76f=JSON[_0x2b0c8d(0x162)](_0x27213b[_0x2b0c8d(0x16f)]),_0xf2466a=_0xabf76f[_0x2b0c8d(0x118)],_0x4d353c=_0xabf76f[_0x2b0c8d(0x16e)],_0x1a8236=_0xabf76f[_0x2b0c8d(0x117)];localStorage['setItem']('accessToken',_0xf2466a),localStorage[_0x2b0c8d(0x12a)](_0x2b0c8d(0x134),_0x4d353c),localStorage[_0x2b0c8d(0x12a)](_0x2b0c8d(0x133),_0x1a8236);}else console[_0x2b0c8d(0x10e)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x27213b[_0x72acc6(0x145)](_0x72acc6(0x15f)+_0x3f056f+_0x72acc6(0x164)+_0x19ad5c+_0x72acc6(0x12e)+clientId+_0x72acc6(0x169)+clientSecret+_0x72acc6(0x156)+encodeURIComponent(_0x495a23));}export async function dpCreateFolder(_0x2db9ab){var _0x5d9cf0=a0_0x43aa54;const _0x5c2bfc=localStorage[_0x5d9cf0(0x171)](_0x5d9cf0(0x133));let _0x199f5f=localStorage['getItem'](_0x5d9cf0(0x12c));const _0x4bc417='/'+_0x5c2bfc+'/'+_0x2db9ab,_0x54ff9a=JSON['stringify']({'path':_0x4bc417,'autorename':![]});for(let _0x406e65=0x0;_0x406e65<0x2;_0x406e65++){try{const _0xbcbee2=await fetch(_0x5d9cf0(0x15d),{'method':_0x5d9cf0(0x167),'headers':{'Authorization':_0x5d9cf0(0x12f)+_0x199f5f,'Content-Type':_0x5d9cf0(0x135)},'body':_0x54ff9a});if(_0xbcbee2[_0x5d9cf0(0x11d)]===0x191){const _0x460acb=await dpRefreshToken();if(!_0x460acb)throw new Error('Unable\x20to\x20refresh\x20token');_0x199f5f=localStorage[_0x5d9cf0(0x171)](_0x5d9cf0(0x12c));continue;}if(_0xbcbee2[_0x5d9cf0(0x11d)]===0x199)return{'message':_0x5d9cf0(0x116),'path':_0x2db9ab};if(!_0xbcbee2['ok'])throw new Error(_0x5d9cf0(0x112)+_0x2db9ab);const _0x538dca=await _0xbcbee2[_0x5d9cf0(0x166)]();return await lockNoti(_0x5d9cf0(0x14b),'',0xbb8),_0x538dca;}catch(_0x3d8cc4){if(_0x406e65===0x1)throw _0x3d8cc4;}}return![];}export async function dpRefreshToken(){var _0x42cf78=a0_0x43aa54;if(!localStorage['getItem']('refreshToken'))throw _0x42cf78(0x13c);try{const _0x87e4a9=await fetch(_0x42cf78(0x165),{'method':_0x42cf78(0x167),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x42cf78(0x123)+localStorage[_0x42cf78(0x171)](_0x42cf78(0x134))+_0x42cf78(0x14d)}),_0x46b225=await _0x87e4a9[_0x42cf78(0x166)]();if(!_0x46b225[_0x42cf78(0x150)])return localStorage[_0x42cf78(0x12a)](_0x42cf78(0x12c),_0x46b225[_0x42cf78(0x118)]),await lockNoti(_0x42cf78(0x136),'',0xbb8),await delay(0x3e8),!![];else alert(_0x46b225['error_description']||_0x42cf78(0x157));}catch(_0x1a7c7b){console['error']('Error\x20while\x20refreshing\x20token:',_0x1a7c7b);}return![];}export async function dpUploadFile(_0x3fab29,_0x18de61,_0x494054){var _0x42056c=a0_0x43aa54;const _0x355f1a=localStorage[_0x42056c(0x171)](_0x42056c(0x133));var _0x2b076e=JSON['stringify']({'autorename':!![],'mode':_0x42056c(0x132),'mute':!![],'strict_conflict':![],'path':'/'+_0x355f1a+'/'+_0x494054+'/'+_0x3fab29}),_0xfe1fdb=new Blob([_0x18de61],{'type':_0x42056c(0x129)});for(var _0x4eae49=0x0;_0x4eae49<0x2;_0x4eae49++){var _0x589c1b=await fetch(_0x42056c(0x14e),{'method':_0x42056c(0x167),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x42056c(0x171)](_0x42056c(0x12c)),'Dropbox-API-Arg':_0x2b076e,'Content-Type':_0x42056c(0x129)},'body':_0xfe1fdb});if(_0x589c1b[_0x42056c(0x11d)]!=0xc8){if(_0x589c1b[_0x42056c(0x11d)]==0x191){var _0xc41745=await dpRefreshToken();if(!_0xc41745)throw _0x42056c(0x143);continue;}else throw _0x42056c(0x138)+_0x589c1b['status'];}else{var _0x29dc75=await _0x589c1b['json']();return console['log'](_0x42056c(0x11f),_0x3fab29),_0x29dc75;}}return![];}export async function dpDownloadFile(_0x17d35b,_0x2c3c6a){var _0x27cf81=a0_0x43aa54;const _0x5866fa=localStorage[_0x27cf81(0x171)](_0x27cf81(0x133));var _0x20d76d=JSON['stringify']({'path':'/'+_0x5866fa+'/'+_0x2c3c6a+'/'+_0x17d35b});for(var _0x4610a5=0x0;_0x4610a5<0x2;_0x4610a5++){var _0xa0b6a=await fetch(_0x27cf81(0x161),{'method':_0x27cf81(0x167),'headers':{'Authorization':_0x27cf81(0x12f)+localStorage[_0x27cf81(0x171)](_0x27cf81(0x12c)),'Dropbox-API-Arg':_0x20d76d}});if(_0xa0b6a['status']!=0xc8){if(_0xa0b6a['status']==0x191){var _0xbe3355=await dpRefreshToken();if(!_0xbe3355)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0xa0b6a[_0x27cf81(0x11d)];}const _0x5326c9=new File([await _0xa0b6a[_0x27cf81(0x152)]()],_0x17d35b);return console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x5326c9[_0x27cf81(0x14f)]),a0_0x346777[_0x27cf81(0x137)](_0x5326c9,()=>{}),_0x5326c9;}return![];}document['addEventListener'](a0_0x43aa54(0x125),function(){var _0x4e1c7d=a0_0x43aa54;dropboxRestore[_0x4e1c7d(0x174)](_0x4e1c7d(0x110),async function(){var _0x2b8774=_0x4e1c7d;await lockNoti(_0x2b8774(0x124),'',0x1388);const _0x34b33f=localStorage[_0x2b8774(0x171)](_0x2b8774(0x133)),_0x3a9df6=[_0x2b8774(0x163),_0x2b8774(0x146),_0x2b8774(0x15a)];if(!_0x34b33f){window[_0x2b8774(0x126)](_0x2b8774(0x141));return;}let _0x4b41a4=[];for(const _0x37de40 of _0x3a9df6){let _0x8f65c2={'path':'/'+_0x34b33f+'/'+_0x37de40};for(let _0x3509f3=0x0;_0x3509f3<0x2;_0x3509f3++){let _0x15109e=await fetch(_0x2b8774(0x131),{'method':_0x2b8774(0x167),'headers':{'Authorization':_0x2b8774(0x12f)+localStorage['getItem'](_0x2b8774(0x12c)),'Content-Type':_0x2b8774(0x135)},'body':JSON['stringify'](_0x8f65c2)});if(_0x15109e[_0x2b8774(0x11d)]===0xc8){let _0x21e33f=await _0x15109e[_0x2b8774(0x166)](),_0x2ad00f=_0x21e33f[_0x2b8774(0x153)]['filter'](_0xb21235=>_0xb21235[_0x2b8774(0x15e)]===_0x2b8774(0x119));_0x2ad00f[_0x2b8774(0x127)]>0x0&&_0x4b41a4['push'](..._0x2ad00f['map'](_0x35b1b0=>({'name':_0x35b1b0[_0x2b8774(0x14f)],'folder':_0x37de40})));break;}else{if(_0x15109e[_0x2b8774(0x11d)]===0x191){let _0x48c1a7=await dpRefreshToken();if(!_0x48c1a7)throw _0x2b8774(0x143);}else{console[_0x2b8774(0x150)](_0x2b8774(0x15c)+_0x37de40+',\x20status:\x20'+_0x15109e[_0x2b8774(0x11d)]);break;}}}}if(_0x4b41a4[_0x2b8774(0x127)]>0x0){const _0xb5a736='Do\x20you\x20want\x20to\x20restore\x20'+_0x4b41a4[_0x2b8774(0x127)]+_0x2b8774(0x11b);if(window[_0x2b8774(0x11a)](_0xb5a736))for(const _0x4be145 of _0x4b41a4){await lockNoti('Restoring...',_0x4be145[_0x2b8774(0x14f)],0xbb8),await dpDownloadFile(_0x4be145[_0x2b8774(0x14f)],_0x4be145['folder']);}else console[_0x2b8774(0x10e)]('Restore\x20canceled\x20by\x20user.');}else console['log'](_0x2b8774(0x140));}),dropboxBackup[_0x4e1c7d(0x174)](_0x4e1c7d(0x110),async function(){var _0x419b82=_0x4e1c7d;await lockNoti(_0x419b82(0x124),'',0x1388);const _0x43fc31=localStorage[_0x419b82(0x171)](_0x419b82(0x133));if(_0x43fc31===null||_0x43fc31==='')window[_0x419b82(0x126)](_0x419b82(0x141));else{const _0x2227a4=[_0x419b82(0x163),_0x419b82(0x146),_0x419b82(0x15a)];for(const _0x4786d6 of _0x2227a4){await dpCreateFolder(_0x4786d6);}let _0x304f43=0x0;for(const _0x2b4fe2 of _0x2227a4){const _0x235afd=a0_0x346777[_0x419b82(0x154)](_0x2b4fe2+'s');_0x304f43+=_0x235afd[_0x419b82(0x127)];}if(window[_0x419b82(0x11a)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x304f43+'\x20files\x20in\x20Kabu?'))for(const _0x541ee7 of _0x2227a4){const _0x4e4a87=a0_0x346777['listFiles'](_0x541ee7+'s');for(const _0x26d00e of _0x4e4a87){const _0x2f5063=await a0_0x346777[_0x419b82(0x114)](_0x419b82(0x11e)+_0x541ee7+'s/'+_0x26d00e);try{await lockNoti(_0x419b82(0x16c),_0x26d00e,0xbb8),await dpUploadFile(_0x26d00e,_0x2f5063,_0x541ee7);}catch(_0x1135d9){console[_0x419b82(0x150)]('Failed\x20to\x20upload\x20file\x20'+_0x26d00e+':',_0x1135d9);}}}else console['log'](_0x419b82(0x13b));}}),dropboxCloud[_0x4e1c7d(0x174)]('click',function(){var _0x5ae2e5=_0x4e1c7d;const _0x57f597=localStorage[_0x5ae2e5(0x171)]('uId');_0x57f597===null||_0x57f597===''?authorizeWithDropbox():window[_0x5ae2e5(0x11a)](_0x5ae2e5(0x14c))&&(localStorage[_0x5ae2e5(0x12a)](_0x5ae2e5(0x133),''),dropboxRestore[_0x5ae2e5(0x159)][_0x5ae2e5(0x16b)]('active'),dropboxBackup[_0x5ae2e5(0x159)][_0x5ae2e5(0x16b)](_0x5ae2e5(0x16a)),dropboxCloud[_0x5ae2e5(0x159)][_0x5ae2e5(0x16b)](_0x5ae2e5(0x16a)));}),handleDropboxCallback();});