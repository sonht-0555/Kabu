var a0_0x26d38d=a0_0x2041;(function(_0x5b6b10,_0x2673ad){var _0x4da542=a0_0x2041,_0x6e4a98=_0x5b6b10();while(!![]){try{var _0x2424b9=parseInt(_0x4da542(0x1b1))/0x1+parseInt(_0x4da542(0x1df))/0x2+parseInt(_0x4da542(0x1a2))/0x3+-parseInt(_0x4da542(0x1bf))/0x4+parseInt(_0x4da542(0x1a1))/0x5*(-parseInt(_0x4da542(0x1e9))/0x6)+-parseInt(_0x4da542(0x1ed))/0x7+parseInt(_0x4da542(0x1dc))/0x8;if(_0x2424b9===_0x2673ad)break;else _0x6e4a98['push'](_0x6e4a98['shift']());}catch(_0x526bd6){_0x6e4a98['push'](_0x6e4a98['shift']());}}}(a0_0x3b42,0x45928));import*as a0_0x5023de from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x26d38d(0x1c8);function authorizeWithDropbox(){var _0x5898b4=a0_0x26d38d,_0x2c2c97=window[_0x5898b4(0x1c6)][_0x5898b4(0x1bc)][_0x5898b4(0x1ca)]('?')[0x0],_0x4af85d=_0x5898b4(0x1e0),_0x50aa67=_0x5898b4(0x1c4),_0xe0e2da=_0x5898b4(0x1db)+clientId+_0x5898b4(0x1cd)+_0x4af85d+_0x5898b4(0x1dd)+_0x50aa67+_0x5898b4(0x199)+encodeURIComponent(_0x2c2c97);window[_0x5898b4(0x1c6)][_0x5898b4(0x1bc)]=_0xe0e2da;}function handleDropboxCallback(){var _0x55f00c=a0_0x26d38d,_0xf59178=getUrlParameter(_0x55f00c(0x1e0));_0xf59178?(getAccessToken(_0xf59178),console[_0x55f00c(0x1a3)](_0x55f00c(0x1d7),_0xf59178)):console[_0x55f00c(0x1a3)](_0x55f00c(0x1c0));}function a0_0x3b42(){var _0x16bb64=['remove','Folder\x20created','replace','offline','Failed\x20to\x20upload\x20file\x20','location','addEventListener','nwb3dnfh09rhs31','accessToken','split','https://api.dropboxapi.com/oauth2/token','https://content.dropboxapi.com/2/files/download','&response_type=','code=','name','send','Do\x20you\x20want\x20to\x20logout?','Download\x20failed,\x20unknown\x20http\x20status:','/data/','status','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','click','Authorization\x20Code:','classList','authorization_code','uploadFileInCloud','https://www.dropbox.com/oauth2/authorize?client_id=','3593408kkzIsu','&token_access_type=','state','596664BUzspj','code','entries','Refreshing\x20token...','=([^&#]*)','https://api.dropboxapi.com/2/files/list_folder','screenshot','Upload\x20failed,\x20unknown\x20http\x20status:\x20','active','listFiles','8814HOqqpH','Backing\x20up...','No\x20refresh\x20token','Download\x20failed\x20for\x20','1069096wtsFKd','Cloud\x20login\x20required!','length','No\x20files\x20found\x20to\x20restore.','refreshToken','open','stringify','error_description','access_token','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','uid','json','responseText','Error\x20creating\x20folder\x20','Wait\x20a\x20little\x20bit...','Content-Type','confirm','map','&redirect_uri=','setItem','application/json','&client_id=','getItem','Restoring...','https://api.dropboxapi.com/2/files/create_folder_v2','application/x-www-form-urlencoded','165qcOTgp','741666aSrTaN','log','error',',\x20status:\x20','&client_secret=','application/octet-stream','https://content.dropboxapi.com/2/files/upload','Bearer\x20','&grant_type=','search','DOMContentLoaded','POST','alert','save','overwrite','55035wFlhxb','file','Restore\x20canceled\x20by\x20user.','push','Kabu\x20storage\x20↦\x20Cloud\x20◆','https://api.dropbox.com/oauth2/token','Unable\x20to\x20refresh\x20token','Do\x20you\x20want\x20to\x20backup\x20','refresh_token','\x20files\x20in\x20Kabu?','parse','href','uId','downloadFileInCloud','2254368wbdGxX','Do\x20not\x20receive\x20authorization'];a0_0x3b42=function(){return _0x16bb64;};return a0_0x3b42();}function getUrlParameter(_0x542ffa){var _0x1c64ed=a0_0x26d38d;_0x542ffa=_0x542ffa[_0x1c64ed(0x1c3)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x13cf79=new RegExp('[\x5c?&#]'+_0x542ffa+_0x1c64ed(0x1e3)),_0x430a76=_0x13cf79['exec'](location[_0x1c64ed(0x1ab)]);return _0x430a76===null?'':decodeURIComponent(_0x430a76[0x1][_0x1c64ed(0x1c3)](/\+/g,'\x20'));}function getAccessToken(_0x345151){var _0x99494e=a0_0x26d38d,_0x2cc25f=_0x99494e(0x1d9),_0x1ab8ef=window[_0x99494e(0x1c6)][_0x99494e(0x1bc)][_0x99494e(0x1ca)]('?')[0x0],_0x172668=new XMLHttpRequest();_0x172668[_0x99494e(0x1f2)](_0x99494e(0x1ad),_0x99494e(0x1b6)),_0x172668['setRequestHeader'](_0x99494e(0x1fc),_0x99494e(0x1a0)),_0x172668['onload']=function(){var _0x44f36a=_0x99494e;if(_0x172668['status']===0xc8){var _0x179ff4=JSON[_0x44f36a(0x1bb)](_0x172668[_0x44f36a(0x1f9)]),_0xafbf81=_0x179ff4[_0x44f36a(0x1f5)],_0x59e727=_0x179ff4[_0x44f36a(0x1b9)],_0x2e03f4=_0x179ff4[_0x44f36a(0x1f7)];localStorage[_0x44f36a(0x19a)]('accessToken',_0xafbf81),localStorage[_0x44f36a(0x19a)]('refreshToken',_0x59e727),localStorage['setItem']('uId',_0x2e03f4);}else console[_0x44f36a(0x1a3)](_0x44f36a(0x1d5));},_0x172668[_0x99494e(0x1d0)](_0x99494e(0x1ce)+_0x345151+_0x99494e(0x1aa)+_0x2cc25f+_0x99494e(0x19c)+clientId+_0x99494e(0x1a6)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x1ab8ef));}export async function dpCreateFolder(_0x1d58fd){var _0x225b9d=a0_0x26d38d;const _0x149ec9=localStorage[_0x225b9d(0x19d)](_0x225b9d(0x1bd));let _0x4e6799=localStorage['getItem'](_0x225b9d(0x1c9));const _0x1c37dd='/'+_0x149ec9+'/'+_0x1d58fd,_0xee163e=JSON['stringify']({'path':_0x1c37dd,'autorename':![]});for(let _0x1a5280=0x0;_0x1a5280<0x2;_0x1a5280++){try{const _0x55a1f4=await fetch(_0x225b9d(0x19f),{'method':'POST','headers':{'Authorization':_0x225b9d(0x1a9)+_0x4e6799,'Content-Type':_0x225b9d(0x19b)},'body':_0xee163e});if(_0x55a1f4[_0x225b9d(0x1d4)]===0x191){const _0x2dbbc0=await dpRefreshToken();if(!_0x2dbbc0)throw new Error('Unable\x20to\x20refresh\x20token');_0x4e6799=localStorage[_0x225b9d(0x19d)](_0x225b9d(0x1c9));continue;}if(_0x55a1f4['status']===0x199)return{'message':'Folder\x20already\x20exists','path':_0x1d58fd};if(!_0x55a1f4['ok'])throw new Error(_0x225b9d(0x1fa)+_0x1d58fd);const _0x4f1bce=await _0x55a1f4[_0x225b9d(0x1f8)]();return await lockNoti(_0x225b9d(0x1c2),'',0xbb8),_0x4f1bce;}catch(_0x1b0480){if(_0x1a5280===0x1)throw _0x1b0480;}}return![];}export async function dpRefreshToken(){var _0x45228a=a0_0x26d38d;if(!localStorage[_0x45228a(0x19d)](_0x45228a(0x1f1)))throw _0x45228a(0x1eb);try{const _0x49e57e=await fetch(_0x45228a(0x1cb),{'method':'POST','headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x45228a(0x19d)](_0x45228a(0x1f1))+_0x45228a(0x1f6)}),_0x39b5d7=await _0x49e57e[_0x45228a(0x1f8)]();if(!_0x39b5d7[_0x45228a(0x1a4)])return localStorage[_0x45228a(0x19a)](_0x45228a(0x1c9),_0x39b5d7['access_token']),await lockNoti(_0x45228a(0x1e2),'',0xbb8),await delay(0x3e8),!![];else alert(_0x39b5d7[_0x45228a(0x1f4)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x271f5c){console['error']('Error\x20while\x20refreshing\x20token:',_0x271f5c);}return![];}export async function dpUploadFile(_0x30b8c4,_0x20350b,_0x3c9afb){var _0x34079e=a0_0x26d38d;const _0xd7bf52=localStorage[_0x34079e(0x19d)]('uId');var _0x2f67f3=JSON[_0x34079e(0x1f3)]({'autorename':!![],'mode':_0x34079e(0x1b0),'mute':!![],'strict_conflict':![],'path':'/'+_0xd7bf52+'/'+_0x3c9afb+'/'+_0x30b8c4}),_0x3304b1=new Blob([_0x20350b],{'type':_0x34079e(0x1a7)});for(var _0x56f8b5=0x0;_0x56f8b5<0x2;_0x56f8b5++){var _0x1509a3=await fetch(_0x34079e(0x1a8),{'method':'POST','headers':{'Authorization':_0x34079e(0x1a9)+localStorage[_0x34079e(0x19d)]('accessToken'),'Dropbox-API-Arg':_0x2f67f3,'Content-Type':_0x34079e(0x1a7)},'body':_0x3304b1});if(_0x1509a3[_0x34079e(0x1d4)]!=0xc8){if(_0x1509a3[_0x34079e(0x1d4)]==0x191){var _0x1cf002=await dpRefreshToken();if(!_0x1cf002)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x34079e(0x1e6)+_0x1509a3[_0x34079e(0x1d4)];}else{var _0x3279ae=await _0x1509a3[_0x34079e(0x1f8)]();return console[_0x34079e(0x1a3)](_0x34079e(0x1b5),_0x30b8c4),_0x3279ae;}}return![];}export async function dpDownloadFile(_0x2f1fdd,_0x49e06b){var _0x1feff8=a0_0x26d38d;const _0x2373aa=localStorage[_0x1feff8(0x19d)]('uId');var _0xa2e576=JSON[_0x1feff8(0x1f3)]({'path':'/'+_0x2373aa+'/'+_0x49e06b+'/'+_0x2f1fdd});for(var _0x344194=0x0;_0x344194<0x2;_0x344194++){var _0x4a3170=await fetch(_0x1feff8(0x1cc),{'method':_0x1feff8(0x1ad),'headers':{'Authorization':_0x1feff8(0x1a9)+localStorage[_0x1feff8(0x19d)](_0x1feff8(0x1c9)),'Dropbox-API-Arg':_0xa2e576}});if(_0x4a3170[_0x1feff8(0x1d4)]!=0xc8){if(_0x4a3170[_0x1feff8(0x1d4)]==0x191){var _0x4f01d9=await dpRefreshToken();if(!_0x4f01d9)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x1feff8(0x1d2)+_0x4a3170[_0x1feff8(0x1d4)];}const _0x1d1ed4=new File([await _0x4a3170['blob']()],_0x2f1fdd);return console[_0x1feff8(0x1a3)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x1d1ed4['name']),a0_0x5023de[_0x1feff8(0x1da)](_0x1d1ed4,()=>{}),_0x1d1ed4;}return![];}function a0_0x2041(_0x22eda0,_0x5b4e3d){var _0x3b42f6=a0_0x3b42();return a0_0x2041=function(_0x2041e0,_0x5be4be){_0x2041e0=_0x2041e0-0x199;var _0x50ecc6=_0x3b42f6[_0x2041e0];return _0x50ecc6;},a0_0x2041(_0x22eda0,_0x5b4e3d);}document[a0_0x26d38d(0x1c7)](a0_0x26d38d(0x1ac),function(){var _0x75e503=a0_0x26d38d;dropboxRestore[_0x75e503(0x1c7)](_0x75e503(0x1d6),async function(){var _0x9fb883=_0x75e503;await lockNoti(_0x9fb883(0x1fb),'',0x1388);const _0x48291a=localStorage[_0x9fb883(0x19d)](_0x9fb883(0x1bd)),_0x783673=[_0x9fb883(0x1de),_0x9fb883(0x1af),_0x9fb883(0x1e5)];if(!_0x48291a){window['alert'](_0x9fb883(0x1ee));return;}let _0x2940aa=[];for(const _0x387c1e of _0x783673){let _0x3e5291={'path':'/'+_0x48291a+'/'+_0x387c1e};for(let _0x1f969c=0x0;_0x1f969c<0x2;_0x1f969c++){let _0x14fc5f=await fetch(_0x9fb883(0x1e4),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x9fb883(0x19d)](_0x9fb883(0x1c9)),'Content-Type':_0x9fb883(0x19b)},'body':JSON[_0x9fb883(0x1f3)](_0x3e5291)});if(_0x14fc5f['status']===0xc8){let _0x4ef34d=await _0x14fc5f['json'](),_0x3d8c16=_0x4ef34d[_0x9fb883(0x1e1)]['filter'](_0x319191=>_0x319191['.tag']===_0x9fb883(0x1b2));_0x3d8c16[_0x9fb883(0x1ef)]>0x0&&_0x2940aa[_0x9fb883(0x1b4)](..._0x3d8c16[_0x9fb883(0x1fe)](_0x397a4a=>({'name':_0x397a4a['name'],'folder':_0x387c1e})));break;}else{if(_0x14fc5f['status']===0x191){let _0x1cc7de=await dpRefreshToken();if(!_0x1cc7de)throw _0x9fb883(0x1b7);}else{console[_0x9fb883(0x1a4)](_0x9fb883(0x1ec)+_0x387c1e+_0x9fb883(0x1a5)+_0x14fc5f[_0x9fb883(0x1d4)]);break;}}}}if(_0x2940aa[_0x9fb883(0x1ef)]>0x0){const _0x55ed19='Do\x20you\x20want\x20to\x20restore\x20'+_0x2940aa[_0x9fb883(0x1ef)]+'\x20files\x20from\x20Cloud?';if(window[_0x9fb883(0x1fd)](_0x55ed19))for(const _0x3ae04d of _0x2940aa){await lockNoti(_0x9fb883(0x19e),_0x3ae04d[_0x9fb883(0x1cf)],0xbb8),await dpDownloadFile(_0x3ae04d[_0x9fb883(0x1cf)],_0x3ae04d['folder']);}else console[_0x9fb883(0x1a3)](_0x9fb883(0x1b3));}else console['log'](_0x9fb883(0x1f0));}),dropboxBackup['addEventListener'](_0x75e503(0x1d6),async function(){var _0x3ecf62=_0x75e503;await lockNoti(_0x3ecf62(0x1fb),'',0x1388);const _0x450713=localStorage[_0x3ecf62(0x19d)]('uId');if(_0x450713===null||_0x450713==='')window[_0x3ecf62(0x1ae)]('Cloud\x20login\x20required!');else{const _0x44aaf3=['state',_0x3ecf62(0x1af),'screenshot'];for(const _0x679dcb of _0x44aaf3){await dpCreateFolder(_0x679dcb);}let _0x2b2da7=0x0;for(const _0x1defbe of _0x44aaf3){const _0x3fcb20=a0_0x5023de[_0x3ecf62(0x1e8)](_0x1defbe+'s');_0x2b2da7+=_0x3fcb20['length'];}if(window['confirm'](_0x3ecf62(0x1b8)+_0x2b2da7+_0x3ecf62(0x1ba)))for(const _0x8eec6f of _0x44aaf3){const _0x15f8c7=a0_0x5023de['listFiles'](_0x8eec6f+'s');for(const _0x5a44e1 of _0x15f8c7){const _0x39bfbc=await a0_0x5023de[_0x3ecf62(0x1be)](_0x3ecf62(0x1d3)+_0x8eec6f+'s/'+_0x5a44e1);try{await lockNoti(_0x3ecf62(0x1ea),_0x5a44e1,0xbb8),await dpUploadFile(_0x5a44e1,_0x39bfbc,_0x8eec6f);}catch(_0x2d292f){console[_0x3ecf62(0x1a4)](_0x3ecf62(0x1c5)+_0x5a44e1+':',_0x2d292f);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x75e503(0x1c7)](_0x75e503(0x1d6),function(){var _0x178102=_0x75e503;const _0x483f0d=localStorage[_0x178102(0x19d)]('uId');_0x483f0d===null||_0x483f0d===''?authorizeWithDropbox():window['confirm'](_0x178102(0x1d1))&&(localStorage[_0x178102(0x19a)](_0x178102(0x1bd),''),dropboxRestore[_0x178102(0x1d8)][_0x178102(0x1c1)](_0x178102(0x1e7)),dropboxBackup['classList']['remove']('active'),dropboxCloud[_0x178102(0x1d8)][_0x178102(0x1c1)](_0x178102(0x1e7)));}),handleDropboxCallback();});