var a0_0x10da6c=a0_0x434e;(function(_0x3d73c6,_0x57fe36){var _0x1892f5=a0_0x434e,_0xa951ac=_0x3d73c6();while(!![]){try{var _0x3d98f5=-parseInt(_0x1892f5(0xcf))/0x1+parseInt(_0x1892f5(0xea))/0x2+-parseInt(_0x1892f5(0xd6))/0x3*(-parseInt(_0x1892f5(0xfd))/0x4)+-parseInt(_0x1892f5(0x105))/0x5+parseInt(_0x1892f5(0xfa))/0x6+-parseInt(_0x1892f5(0x100))/0x7+-parseInt(_0x1892f5(0xdc))/0x8*(-parseInt(_0x1892f5(0xf4))/0x9);if(_0x3d98f5===_0x57fe36)break;else _0xa951ac['push'](_0xa951ac['shift']());}catch(_0x4c7e9f){_0xa951ac['push'](_0xa951ac['shift']());}}}(a0_0x5e96,0xd6da1));import*as a0_0x423e3b from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x10da6c(0x102);function authorizeWithDropbox(){var _0x4a13fb=a0_0x10da6c,_0x1e6844=window[_0x4a13fb(0x115)][_0x4a13fb(0x11e)][_0x4a13fb(0xc7)]('?')[0x0],_0x365b70='code',_0x31cd9d=_0x4a13fb(0x119),_0x377e4d=_0x4a13fb(0xe5)+clientId+_0x4a13fb(0x113)+_0x365b70+'&token_access_type='+_0x31cd9d+_0x4a13fb(0xe1)+encodeURIComponent(_0x1e6844);window[_0x4a13fb(0x115)][_0x4a13fb(0x11e)]=_0x377e4d;}function handleDropboxCallback(){var _0x27842a=a0_0x10da6c,_0x5736f8=getUrlParameter(_0x27842a(0xf9));_0x5736f8?(getAccessToken(_0x5736f8),console[_0x27842a(0x10f)](_0x27842a(0x111),_0x5736f8)):console[_0x27842a(0x10f)]('Do\x20not\x20receive\x20authorization');}function a0_0x5e96(){var _0x1c8c0f=['authorization_code','Refreshing\x20token...','4taXzuH','Upload\x20failed,\x20unknown\x20http\x20status:\x20','active','11338943byBSGI','application/x-www-form-urlencoded','nwb3dnfh09rhs31','Folder\x20already\x20exists','setRequestHeader','7412045rABtTe','\x20files\x20in\x20Kabu?','Cloud\x20login\x20required!','refreshToken','toUpperCase','access_token','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','charAt',',\x20status:\x20','uid','log','replace','Authorization\x20Code:','Wait\x20a\x20little\x20bit...','&response_type=','overwrite','location','getItem','[\x5c?&#]','Restoring...','offline','Restore\x20canceled\x20by\x20user.','downloadFileInCloud','remove','https://content.dropboxapi.com/2/files/download','href','json','list','screenshot','Download\x20failed,\x20unknown\x20http\x20status:','code=','accessToken','Content-Type','Do\x20you\x20want\x20to\x20backup\x20','Backing\x20up...','Kabu\x20storage\x20↦\x20Cloud\x20◆','split','confirm','uId','addEventListener','/data/','folder','map','No\x20files\x20found\x20to\x20restore.','918281gTNMrY','DOMContentLoaded','Folder\x20created','length','stringify','exec','onload','4436619LhFQVf','&grant_type=','send','application/octet-stream','Download\x20failed\x20for\x20','save','14288BxBIcv','error','refresh_token=','click','status','&redirect_uri=','setItem','Failed\x20to\x20refresh\x20Dropbox\x20token.','Bearer\x20','https://www.dropbox.com/oauth2/authorize?client_id=','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Do\x20you\x20want\x20to\x20restore\x20','slice','alert','249000GapiZq','Unable\x20to\x20refresh\x20token','state','application/json','uploadFileInCloud','https://api.dropboxapi.com/2/files/list_folder','Failed\x20to\x20upload\x20file\x20','name','responseText','classList','8109oIrDvX','filter','&client_id=','POST','FSSync','code','10128078wsbWPQ'];a0_0x5e96=function(){return _0x1c8c0f;};return a0_0x5e96();}function getUrlParameter(_0x21dc8f){var _0x44f31c=a0_0x10da6c;_0x21dc8f=_0x21dc8f[_0x44f31c(0x110)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x484185=new RegExp(_0x44f31c(0x117)+_0x21dc8f+'=([^&#]*)'),_0x1f0f86=_0x484185[_0x44f31c(0xd4)](location['search']);return _0x1f0f86===null?'':decodeURIComponent(_0x1f0f86[0x1][_0x44f31c(0x110)](/\+/g,'\x20'));}function getAccessToken(_0x4ff526){var _0x1251d4=a0_0x10da6c,_0x47d3c8=_0x1251d4(0xfb),_0x111433=window[_0x1251d4(0x115)][_0x1251d4(0x11e)]['split']('?')[0x0],_0x1e17d2=new XMLHttpRequest();_0x1e17d2['open'](_0x1251d4(0xf7),'https://api.dropbox.com/oauth2/token'),_0x1e17d2[_0x1251d4(0x104)](_0x1251d4(0x125),_0x1251d4(0x101)),_0x1e17d2[_0x1251d4(0xd5)]=function(){var _0xa81e07=_0x1251d4;if(_0x1e17d2[_0xa81e07(0xe0)]===0xc8){var _0x13b671=JSON['parse'](_0x1e17d2[_0xa81e07(0xf2)]),_0x29119e=_0x13b671[_0xa81e07(0x10a)],_0x262bb7=_0x13b671['refresh_token'],_0x2c9992=_0x13b671[_0xa81e07(0x10e)];localStorage[_0xa81e07(0xe2)]('accessToken',_0x29119e),localStorage[_0xa81e07(0xe2)](_0xa81e07(0x108),_0x262bb7),localStorage[_0xa81e07(0xe2)](_0xa81e07(0xc9),_0x2c9992);}else console[_0xa81e07(0x10f)](_0xa81e07(0x10b));},_0x1e17d2[_0x1251d4(0xd8)](_0x1251d4(0x123)+_0x4ff526+_0x1251d4(0xd7)+_0x47d3c8+_0x1251d4(0xf6)+clientId+'&client_secret='+clientSecret+_0x1251d4(0xe1)+encodeURIComponent(_0x111433));}function a0_0x434e(_0x196eac,_0x222357){var _0x5e964d=a0_0x5e96();return a0_0x434e=function(_0x434ea2,_0x1d355e){_0x434ea2=_0x434ea2-0xc4;var _0x57433d=_0x5e964d[_0x434ea2];return _0x57433d;},a0_0x434e(_0x196eac,_0x222357);}export async function dpCreateFolder(_0x592109){var _0x5008a4=a0_0x10da6c;const _0xaf78d2=localStorage[_0x5008a4(0x116)]('uId');let _0x4a5f65=localStorage[_0x5008a4(0x116)](_0x5008a4(0x124));const _0x1d0325='/'+_0xaf78d2+'/'+_0x592109,_0x11b2f0=JSON[_0x5008a4(0xd3)]({'path':_0x1d0325,'autorename':![]});for(let _0x2dcd2a=0x0;_0x2dcd2a<0x2;_0x2dcd2a++){try{const _0x5eb20c=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':'POST','headers':{'Authorization':'Bearer\x20'+_0x4a5f65,'Content-Type':_0x5008a4(0xed)},'body':_0x11b2f0});if(_0x5eb20c[_0x5008a4(0xe0)]===0x191){const _0x3f0de6=await dpRefreshToken();if(!_0x3f0de6)throw new Error(_0x5008a4(0xeb));_0x4a5f65=localStorage['getItem'](_0x5008a4(0x124));continue;}if(_0x5eb20c[_0x5008a4(0xe0)]===0x199)return{'message':_0x5008a4(0x103),'path':_0x592109};if(!_0x5eb20c['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x592109);const _0x559e84=await _0x5eb20c[_0x5008a4(0x11f)]();return await lockNoti(_0x5008a4(0xd1),'',0xbb8),_0x559e84;}catch(_0x372a64){if(_0x2dcd2a===0x1)throw _0x372a64;}}return![];}export async function dpRefreshToken(){var _0xb66504=a0_0x10da6c;if(!localStorage['getItem'](_0xb66504(0x108)))throw'No\x20refresh\x20token';try{const _0x2cf4eb=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0xb66504(0xf7),'headers':{'Content-Type':_0xb66504(0x101)},'body':_0xb66504(0xde)+localStorage[_0xb66504(0x116)](_0xb66504(0x108))+_0xb66504(0xe6)}),_0x306bdb=await _0x2cf4eb[_0xb66504(0x11f)]();if(!_0x306bdb[_0xb66504(0xdd)])return localStorage[_0xb66504(0xe2)]('accessToken',_0x306bdb[_0xb66504(0x10a)]),await lockNoti(_0xb66504(0xfc),'',0xbb8),await delay(0x3e8),!![];else alert(_0x306bdb['error_description']||_0xb66504(0xe3));}catch(_0x3fad82){console[_0xb66504(0xdd)]('Error\x20while\x20refreshing\x20token:',_0x3fad82);}return![];}export async function dpUploadFile(_0xf35277,_0x20df35,_0x3ddbd8){var _0x247ea6=a0_0x10da6c;const _0x4a654b=localStorage[_0x247ea6(0x116)]('uId');var _0x1d8d66=JSON[_0x247ea6(0xd3)]({'autorename':!![],'mode':_0x247ea6(0x114),'mute':!![],'strict_conflict':![],'path':'/'+_0x4a654b+'/'+_0x3ddbd8+'/'+_0xf35277}),_0x241d19=new Blob([_0x20df35],{'type':'application/octet-stream'});for(var _0x4f4a90=0x0;_0x4f4a90<0x2;_0x4f4a90++){var _0x34237b=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x247ea6(0xf7),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x247ea6(0x116)](_0x247ea6(0x124)),'Dropbox-API-Arg':_0x1d8d66,'Content-Type':_0x247ea6(0xd9)},'body':_0x241d19});if(_0x34237b[_0x247ea6(0xe0)]!=0xc8){if(_0x34237b[_0x247ea6(0xe0)]==0x191){var _0x24d201=await dpRefreshToken();if(!_0x24d201)throw _0x247ea6(0xeb);continue;}else throw _0x247ea6(0xfe)+_0x34237b['status'];}else{var _0x44f640=await _0x34237b[_0x247ea6(0x11f)]();return console['log'](_0x247ea6(0xc6),_0xf35277),_0x44f640;}}return![];}export async function dpDownloadFile(_0x53b20a,_0x3c1d2d){var _0x148f8f=a0_0x10da6c;const _0x14f92e=localStorage['getItem']('uId');var _0x1a8d87=JSON[_0x148f8f(0xd3)]({'path':'/'+_0x14f92e+'/'+_0x3c1d2d+'/'+_0x53b20a});for(var _0x38f918=0x0;_0x38f918<0x2;_0x38f918++){var _0x25a064=await fetch(_0x148f8f(0x11d),{'method':_0x148f8f(0xf7),'headers':{'Authorization':_0x148f8f(0xe4)+localStorage[_0x148f8f(0x116)](_0x148f8f(0x124)),'Dropbox-API-Arg':_0x1a8d87}});if(_0x25a064[_0x148f8f(0xe0)]!=0xc8){if(_0x25a064['status']==0x191){var _0x2985ad=await dpRefreshToken();if(!_0x2985ad)throw _0x148f8f(0xeb);continue;}else throw _0x148f8f(0x122)+_0x25a064[_0x148f8f(0xe0)];}const _0x1941c9=new File([await _0x25a064['blob']()],_0x53b20a);return console[_0x148f8f(0x10f)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x1941c9[_0x148f8f(0xf1)]),a0_0x423e3b[_0x148f8f(0xee)](_0x1941c9,()=>{var _0x5b2960=_0x148f8f;localStorageFile(),Module[_0x5b2960(0xf8)]();}),_0x1941c9;}return![];}document[a0_0x10da6c(0xca)](a0_0x10da6c(0xd0),function(){var _0x40160e=a0_0x10da6c;dropboxRestore[_0x40160e(0xca)]('click',async function(){var _0xfc18b0=_0x40160e;await lockNoti(_0xfc18b0(0x112),'',0x1388);const _0x1cb42b=localStorage['getItem'](_0xfc18b0(0xc9)),_0x4a8745=[_0xfc18b0(0xec),'save',_0xfc18b0(0x121)];if(!_0x1cb42b){window[_0xfc18b0(0xe9)]('Cloud\x20login\x20required!');return;}let _0x52edc8=[];for(const _0x1293ec of _0x4a8745){let _0x298881={'path':'/'+_0x1cb42b+'/'+_0x1293ec};for(let _0x35644f=0x0;_0x35644f<0x2;_0x35644f++){let _0x3a051c=await fetch(_0xfc18b0(0xef),{'method':'POST','headers':{'Authorization':_0xfc18b0(0xe4)+localStorage[_0xfc18b0(0x116)](_0xfc18b0(0x124)),'Content-Type':_0xfc18b0(0xed)},'body':JSON['stringify'](_0x298881)});if(_0x3a051c[_0xfc18b0(0xe0)]===0xc8){let _0x340e2b=await _0x3a051c[_0xfc18b0(0x11f)](),_0x35f9e2=_0x340e2b['entries'][_0xfc18b0(0xf5)](_0x3590a0=>_0x3590a0['.tag']==='file');_0x35f9e2['length']>0x0&&_0x52edc8['push'](..._0x35f9e2[_0xfc18b0(0xcd)](_0x207a88=>({'name':_0x207a88['name'],'folder':_0x1293ec})));break;}else{if(_0x3a051c['status']===0x191){let _0x1481ec=await dpRefreshToken();if(!_0x1481ec)throw _0xfc18b0(0xeb);}else{console[_0xfc18b0(0xdd)](_0xfc18b0(0xda)+_0x1293ec+_0xfc18b0(0x10d)+_0x3a051c[_0xfc18b0(0xe0)]);break;}}}}if(_0x52edc8[_0xfc18b0(0xd2)]>0x0){const _0xb5a839=_0xfc18b0(0xe7)+_0x52edc8[_0xfc18b0(0xd2)]+'\x20files\x20from\x20Cloud?';if(window['confirm'](_0xb5a839))for(const _0x4cf410 of _0x52edc8){await lockNoti(_0xfc18b0(0x118),_0x4cf410[_0xfc18b0(0xf1)],0xbb8),await dpDownloadFile(_0x4cf410['name'],_0x4cf410[_0xfc18b0(0xcc)]);}else console[_0xfc18b0(0x10f)](_0xfc18b0(0x11a));}else console[_0xfc18b0(0x10f)](_0xfc18b0(0xce));}),dropboxBackup[_0x40160e(0xca)]('click',async function(){var _0x23f081=_0x40160e;await lockNoti(_0x23f081(0x112),'',0x1388);const _0x3e44f6=localStorage[_0x23f081(0x116)]('uId');if(_0x3e44f6===null||_0x3e44f6==='')window[_0x23f081(0xe9)](_0x23f081(0x107));else{const _0x36ce3c=[_0x23f081(0xec),_0x23f081(0xdb),'screenshot'];for(const _0x501710 of _0x36ce3c){await dpCreateFolder(_0x501710);}let _0x388dfd=0x0;for(const _0x179d8b of _0x36ce3c){const _0x404427=a0_0x423e3b[_0x23f081(0x120)+(_0x179d8b[_0x23f081(0x10c)](0x0)['toUpperCase']()+_0x179d8b[_0x23f081(0xe8)](0x1))]();_0x388dfd+=_0x404427[_0x23f081(0xd2)];}if(window[_0x23f081(0xc8)](_0x23f081(0xc4)+_0x388dfd+_0x23f081(0x106)))for(const _0x4d499c of _0x36ce3c){const _0x273093=a0_0x423e3b[_0x23f081(0x120)+(_0x4d499c[_0x23f081(0x10c)](0x0)[_0x23f081(0x109)]()+_0x4d499c[_0x23f081(0xe8)](0x1))]();for(const _0x28f769 of _0x273093){const _0x18c918=await a0_0x423e3b[_0x23f081(0x11b)](_0x23f081(0xcb)+_0x4d499c+'s/'+_0x28f769);try{await lockNoti(_0x23f081(0xc5),_0x28f769,0xbb8),await dpUploadFile(_0x28f769,_0x18c918,_0x4d499c);}catch(_0x22b672){console[_0x23f081(0xdd)](_0x23f081(0xf0)+_0x28f769+':',_0x22b672);}}}else console[_0x23f081(0x10f)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x40160e(0xdf),function(){var _0x4256eb=_0x40160e;const _0x564669=localStorage[_0x4256eb(0x116)]('uId');_0x564669===null||_0x564669===''?authorizeWithDropbox():window[_0x4256eb(0xc8)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x4256eb(0xe2)](_0x4256eb(0xc9),''),dropboxRestore[_0x4256eb(0xf3)][_0x4256eb(0x11c)](_0x4256eb(0xff)),dropboxBackup[_0x4256eb(0xf3)][_0x4256eb(0x11c)](_0x4256eb(0xff)),dropboxCloud[_0x4256eb(0xf3)][_0x4256eb(0x11c)]('active'));}),handleDropboxCallback();});