var a0_0x15fa58=a0_0x7f2f;function a0_0x7f2f(_0x2c1163,_0xa74cdf){var _0x198cae=a0_0x198c();return a0_0x7f2f=function(_0x7f2ffb,_0xf3be6c){_0x7f2ffb=_0x7f2ffb-0xb1;var _0x963b72=_0x198cae[_0x7f2ffb];return _0x963b72;},a0_0x7f2f(_0x2c1163,_0xa74cdf);}(function(_0x265fd6,_0x19fe72){var _0x103720=a0_0x7f2f,_0x1d5b6d=_0x265fd6();while(!![]){try{var _0x390eb5=parseInt(_0x103720(0x112))/0x1+-parseInt(_0x103720(0x10c))/0x2+parseInt(_0x103720(0xce))/0x3+-parseInt(_0x103720(0xed))/0x4*(parseInt(_0x103720(0xfe))/0x5)+-parseInt(_0x103720(0x116))/0x6*(parseInt(_0x103720(0xd5))/0x7)+-parseInt(_0x103720(0x104))/0x8*(parseInt(_0x103720(0xb2))/0x9)+parseInt(_0x103720(0xcd))/0xa;if(_0x390eb5===_0x19fe72)break;else _0x1d5b6d['push'](_0x1d5b6d['shift']());}catch(_0x2369d8){_0x1d5b6d['push'](_0x1d5b6d['shift']());}}}(a0_0x198c,0x26d08));import*as a0_0x499ced from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x15fa58(0xc0);function authorizeWithDropbox(){var _0x4de071=a0_0x15fa58,_0x21db37=window[_0x4de071(0xfc)][_0x4de071(0xe4)][_0x4de071(0xfa)]('?')[0x0],_0x7aa381=_0x4de071(0xb1),_0x4d5f46=_0x4de071(0xb8),_0x2eee76=_0x4de071(0xeb)+clientId+_0x4de071(0xf5)+_0x7aa381+'&token_access_type='+_0x4d5f46+_0x4de071(0xc4)+encodeURIComponent(_0x21db37);window['location'][_0x4de071(0xe4)]=_0x2eee76;}function handleDropboxCallback(){var _0x53dfe8=a0_0x15fa58,_0x151761=getUrlParameter('code');_0x151761?(getAccessToken(_0x151761),console[_0x53dfe8(0xec)](_0x53dfe8(0x10f),_0x151761)):console[_0x53dfe8(0xec)](_0x53dfe8(0xf8));}function getUrlParameter(_0x391e7d){var _0x20b4e2=a0_0x15fa58;_0x391e7d=_0x391e7d['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x16ac71=new RegExp(_0x20b4e2(0x108)+_0x391e7d+_0x20b4e2(0xf3)),_0x310524=_0x16ac71[_0x20b4e2(0xdf)](location[_0x20b4e2(0xca)]);return _0x310524===null?'':decodeURIComponent(_0x310524[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x195b75){var _0x23eb1c=a0_0x15fa58,_0x1daa03='authorization_code',_0xd16040=window[_0x23eb1c(0xfc)][_0x23eb1c(0xe4)][_0x23eb1c(0xfa)]('?')[0x0],_0x59f4e9=new XMLHttpRequest();_0x59f4e9[_0x23eb1c(0x110)](_0x23eb1c(0xe8),_0x23eb1c(0x10b)),_0x59f4e9[_0x23eb1c(0x115)](_0x23eb1c(0xfd),_0x23eb1c(0xe6)),_0x59f4e9[_0x23eb1c(0xee)]=function(){var _0x9d1d9e=_0x23eb1c;if(_0x59f4e9[_0x9d1d9e(0xcc)]===0xc8){var _0x9c03ad=JSON['parse'](_0x59f4e9[_0x9d1d9e(0xf6)]),_0x1ab6b3=_0x9c03ad[_0x9d1d9e(0xf7)],_0x4f7db6=_0x9c03ad[_0x9d1d9e(0xc8)],_0x3b8140=_0x9c03ad['uid'];localStorage['setItem'](_0x9d1d9e(0xe5),_0x1ab6b3),localStorage[_0x9d1d9e(0xf4)](_0x9d1d9e(0xc7),_0x4f7db6),localStorage[_0x9d1d9e(0xf4)]('uId',_0x3b8140);}else console['log'](_0x9d1d9e(0xe2));},_0x59f4e9[_0x23eb1c(0xf1)](_0x23eb1c(0xc9)+_0x195b75+'&grant_type='+_0x1daa03+_0x23eb1c(0xbf)+clientId+'&client_secret='+clientSecret+_0x23eb1c(0xc4)+encodeURIComponent(_0xd16040));}export async function dpCreateFolder(_0x3ff13c){var _0x29579b=a0_0x15fa58;const _0x348bdb=localStorage['getItem'](_0x29579b(0xb3));let _0x3f908b=localStorage[_0x29579b(0xd8)](_0x29579b(0xe5));const _0x124a6d='/'+_0x348bdb+'/'+_0x3ff13c,_0x51ea93=JSON['stringify']({'path':_0x124a6d,'autorename':![]});for(let _0x4ca256=0x0;_0x4ca256<0x2;_0x4ca256++){try{const _0x1e30a7=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x29579b(0xe8),'headers':{'Authorization':_0x29579b(0xc3)+_0x3f908b,'Content-Type':_0x29579b(0xd1)},'body':_0x51ea93});if(_0x1e30a7[_0x29579b(0xcc)]===0x191){const _0x4c7daa=await dpRefreshToken();if(!_0x4c7daa)throw new Error(_0x29579b(0xd4));_0x3f908b=localStorage[_0x29579b(0xd8)]('accessToken');continue;}if(_0x1e30a7[_0x29579b(0xcc)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x3ff13c};if(!_0x1e30a7['ok'])throw new Error(_0x29579b(0xbb)+_0x3ff13c);const _0x370c86=await _0x1e30a7['json']();return await lockNoti(_0x29579b(0x100),'',0xbb8),_0x370c86;}catch(_0x16206c){if(_0x4ca256===0x1)throw _0x16206c;}}return![];}export async function dpRefreshToken(){var _0x52b0cc=a0_0x15fa58;if(!localStorage[_0x52b0cc(0xd8)](_0x52b0cc(0xc7)))throw _0x52b0cc(0x102);try{const _0x193284=await fetch(_0x52b0cc(0xbe),{'method':_0x52b0cc(0xe8),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x52b0cc(0xe0)+localStorage[_0x52b0cc(0xd8)](_0x52b0cc(0xc7))+_0x52b0cc(0x10a)}),_0x1b1aaa=await _0x193284[_0x52b0cc(0xcf)]();if(!_0x1b1aaa[_0x52b0cc(0xc5)])return localStorage[_0x52b0cc(0xf4)]('accessToken',_0x1b1aaa[_0x52b0cc(0xf7)]),await lockNoti(_0x52b0cc(0xd0),'',0xbb8),await delay(0x3e8),!![];else alert(_0x1b1aaa['error_description']||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x5a33b3){console[_0x52b0cc(0xc5)](_0x52b0cc(0xea),_0x5a33b3);}return![];}export async function dpUploadFile(_0x4cf2ab,_0x1323d0,_0x2f82e1){var _0x2600f2=a0_0x15fa58;const _0x31da92=localStorage['getItem']('uId');var _0x599be3=JSON[_0x2600f2(0xfb)]({'autorename':!![],'mode':_0x2600f2(0xde),'mute':!![],'strict_conflict':![],'path':'/'+_0x31da92+'/'+_0x2f82e1+'/'+_0x4cf2ab}),_0x3f6aa6=new Blob([_0x1323d0],{'type':_0x2600f2(0xb7)});for(var _0x4e03eb=0x0;_0x4e03eb<0x2;_0x4e03eb++){var _0x3c77ec=await fetch(_0x2600f2(0xf2),{'method':_0x2600f2(0xe8),'headers':{'Authorization':_0x2600f2(0xc3)+localStorage[_0x2600f2(0xd8)]('accessToken'),'Dropbox-API-Arg':_0x599be3,'Content-Type':_0x2600f2(0xb7)},'body':_0x3f6aa6});if(_0x3c77ec[_0x2600f2(0xcc)]!=0xc8){if(_0x3c77ec['status']==0x191){var _0x1a53a4=await dpRefreshToken();if(!_0x1a53a4)throw _0x2600f2(0xd4);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x3c77ec[_0x2600f2(0xcc)];}else{var _0x547ab9=await _0x3c77ec[_0x2600f2(0xcf)]();return console[_0x2600f2(0xec)](_0x2600f2(0x105),_0x4cf2ab),_0x547ab9;}}return![];}function a0_0x198c(){var _0x5a1520=['Unable\x20to\x20refresh\x20token','175dZwipJ','folder','save','getItem',',\x20status:\x20','Restoring...','listFiles','https://content.dropboxapi.com/2/files/download','No\x20files\x20found\x20to\x20restore.','overwrite','exec','refresh_token=','click','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Download\x20failed\x20for\x20','href','accessToken','application/x-www-form-urlencoded','\x20files\x20in\x20Kabu?','POST','active','Error\x20while\x20refreshing\x20token:','https://www.dropbox.com/oauth2/authorize?client_id=','log','128omilNw','onload','downloadFileInCloud','Do\x20you\x20want\x20to\x20logout?','send','https://content.dropboxapi.com/2/files/upload','=([^&#]*)','setItem','&response_type=','responseText','access_token','Do\x20not\x20receive\x20authorization','name','split','stringify','location','Content-Type','44845CiaalR','length','Folder\x20created','Backing\x20up...','No\x20refresh\x20token','Failed\x20to\x20upload\x20file\x20','5824kpQbAO','Kabu\x20storage\x20↦\x20Cloud\x20◆','state','confirm','[\x5c?&#]','/data/','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','https://api.dropbox.com/oauth2/token','170794HnvYZo','map','Do\x20you\x20want\x20to\x20restore\x20','Authorization\x20Code:','open','Cloud\x20login\x20required!','293490lmwYgp','addEventListener','https://api.dropboxapi.com/2/files/list_folder','setRequestHeader','47994rMpOWy','code','2043sHkrlo','uId','Restore\x20canceled\x20by\x20user.','blob','classList','application/octet-stream','offline','Wait\x20a\x20little\x20bit...','.tag','Error\x20creating\x20folder\x20','Cloud\x20↦\x20Kabu\x20storage\x20◆','alert','https://api.dropboxapi.com/oauth2/token','&client_id=','nwb3dnfh09rhs31','DOMContentLoaded','file','Bearer\x20','&redirect_uri=','error','Download\x20failed,\x20unknown\x20http\x20status:','refreshToken','refresh_token','code=','search','push','status','3635530AkxsfL','718731DMZYAv','json','Refreshing\x20token...','application/json','remove','screenshot'];a0_0x198c=function(){return _0x5a1520;};return a0_0x198c();}export async function dpDownloadFile(_0x2c0b7e,_0x437806){var _0x829528=a0_0x15fa58;const _0x5e846b=localStorage['getItem'](_0x829528(0xb3));var _0x4808ac=JSON[_0x829528(0xfb)]({'path':'/'+_0x5e846b+'/'+_0x437806+'/'+_0x2c0b7e});for(var _0x1f5260=0x0;_0x1f5260<0x2;_0x1f5260++){var _0x43024e=await fetch(_0x829528(0xdc),{'method':_0x829528(0xe8),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x829528(0xd8)](_0x829528(0xe5)),'Dropbox-API-Arg':_0x4808ac}});if(_0x43024e['status']!=0xc8){if(_0x43024e[_0x829528(0xcc)]==0x191){var _0x152278=await dpRefreshToken();if(!_0x152278)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x829528(0xc6)+_0x43024e[_0x829528(0xcc)];}const _0x4efa6a=new File([await _0x43024e[_0x829528(0xb5)]()],_0x2c0b7e);return console['log'](_0x829528(0xbc),_0x4efa6a[_0x829528(0xf9)]),a0_0x499ced['uploadFileInCloud'](_0x4efa6a,()=>{}),_0x4efa6a;}return![];}document[a0_0x15fa58(0x113)](a0_0x15fa58(0xc1),function(){var _0x36e2c5=a0_0x15fa58;dropboxRestore[_0x36e2c5(0x113)]('click',async function(){var _0x468e24=_0x36e2c5;await lockNoti(_0x468e24(0xb9),'',0x1388);const _0x157830=localStorage[_0x468e24(0xd8)](_0x468e24(0xb3)),_0x3c2303=['state',_0x468e24(0xd7),_0x468e24(0xd3)];if(!_0x157830){window[_0x468e24(0xbd)](_0x468e24(0x111));return;}let _0x19b59c=[];for(const _0x1baecc of _0x3c2303){let _0x3b00c1={'path':'/'+_0x157830+'/'+_0x1baecc};for(let _0x2996ed=0x0;_0x2996ed<0x2;_0x2996ed++){let _0xa60239=await fetch(_0x468e24(0x114),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x468e24(0xd8)](_0x468e24(0xe5)),'Content-Type':_0x468e24(0xd1)},'body':JSON[_0x468e24(0xfb)](_0x3b00c1)});if(_0xa60239[_0x468e24(0xcc)]===0xc8){let _0x8eddb1=await _0xa60239[_0x468e24(0xcf)](),_0x44cbc3=_0x8eddb1['entries']['filter'](_0x523d33=>_0x523d33[_0x468e24(0xba)]===_0x468e24(0xc2));_0x44cbc3[_0x468e24(0xff)]>0x0&&_0x19b59c[_0x468e24(0xcb)](..._0x44cbc3[_0x468e24(0x10d)](_0x36b2e3=>({'name':_0x36b2e3[_0x468e24(0xf9)],'folder':_0x1baecc})));break;}else{if(_0xa60239['status']===0x191){let _0x3694c8=await dpRefreshToken();if(!_0x3694c8)throw _0x468e24(0xd4);}else{console[_0x468e24(0xc5)](_0x468e24(0xe3)+_0x1baecc+_0x468e24(0xd9)+_0xa60239['status']);break;}}}}if(_0x19b59c[_0x468e24(0xff)]>0x0){const _0x12bede=_0x468e24(0x10e)+_0x19b59c[_0x468e24(0xff)]+'\x20files\x20from\x20Cloud?';if(window['confirm'](_0x12bede))for(const _0x498a4a of _0x19b59c){await lockNoti(_0x468e24(0xda),_0x498a4a[_0x468e24(0xf9)],0xbb8),await dpDownloadFile(_0x498a4a['name'],_0x498a4a[_0x468e24(0xd6)]);}else console[_0x468e24(0xec)](_0x468e24(0xb4));}else console['log'](_0x468e24(0xdd));}),dropboxBackup[_0x36e2c5(0x113)](_0x36e2c5(0xe1),async function(){var _0x7f9525=_0x36e2c5;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x94da74=localStorage[_0x7f9525(0xd8)]('uId');if(_0x94da74===null||_0x94da74==='')window[_0x7f9525(0xbd)](_0x7f9525(0x111));else{const _0x3aadc9=[_0x7f9525(0x106),'save','screenshot'];for(const _0x3bc880 of _0x3aadc9){await dpCreateFolder(_0x3bc880);}let _0x30e06e=0x0;for(const _0x5d5e97 of _0x3aadc9){const _0xd4119=a0_0x499ced[_0x7f9525(0xdb)](_0x5d5e97+'s');_0x30e06e+=_0xd4119[_0x7f9525(0xff)];}if(window[_0x7f9525(0x107)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x30e06e+_0x7f9525(0xe7)))for(const _0x35dc3d of _0x3aadc9){const _0x229992=a0_0x499ced[_0x7f9525(0xdb)](_0x35dc3d+'s');for(const _0x56cb47 of _0x229992){const _0x1c522c=await a0_0x499ced[_0x7f9525(0xef)](_0x7f9525(0x109)+_0x35dc3d+'s/'+_0x56cb47);try{await lockNoti(_0x7f9525(0x101),_0x56cb47,0xbb8),await dpUploadFile(_0x56cb47,_0x1c522c,_0x35dc3d);}catch(_0x444c04){console[_0x7f9525(0xc5)](_0x7f9525(0x103)+_0x56cb47+':',_0x444c04);}}}else console[_0x7f9525(0xec)](_0x7f9525(0xb4));}}),dropboxCloud[_0x36e2c5(0x113)]('click',function(){var _0x371a70=_0x36e2c5;const _0x5b0231=localStorage[_0x371a70(0xd8)](_0x371a70(0xb3));_0x5b0231===null||_0x5b0231===''?authorizeWithDropbox():window[_0x371a70(0x107)](_0x371a70(0xf0))&&(localStorage[_0x371a70(0xf4)](_0x371a70(0xb3),''),dropboxRestore[_0x371a70(0xb6)][_0x371a70(0xd2)]('active'),dropboxBackup['classList'][_0x371a70(0xd2)](_0x371a70(0xe9)),dropboxCloud['classList']['remove']('active'));}),handleDropboxCallback();});