var a0_0xefb2bc=a0_0x416c;function a0_0x1967(){var _0xcca6ee=['remove','https://api.dropbox.com/oauth2/token','alert','Restoring...','onload','Kabu\x20storage\x20↦\x20Cloud\x20◆','setItem','nwb3dnfh09rhs31','Failed\x20to\x20upload\x20file\x20','[\x5c?&#]','Error\x20creating\x20folder\x20','state','https://api.dropboxapi.com/2/files/list_folder','authorization_code','&client_id=','status','access_token','&token_access_type=','Cloud\x20↦\x20Kabu\x20storage\x20◆','responseText','split','folder','refreshToken','&grant_type=','file','save','stringify','Upload\x20failed,\x20unknown\x20http\x20status:\x20','filter','\x20files\x20in\x20Kabu?','DOMContentLoaded','length','screenshot','Download\x20failed,\x20unknown\x20http\x20status:','https://api.dropboxapi.com/oauth2/token','410405MjALSG','=([^&#]*)','\x20files\x20from\x20Cloud?','log','6bfIhZr','3joGDvF','1214650nekehB','application/octet-stream','Failed\x20to\x20refresh\x20Dropbox\x20token.','&response_type=','refresh_token=','Wait\x20a\x20little\x20bit...','Do\x20you\x20want\x20to\x20backup\x20',',\x20status:\x20','166788iBkWMx','click','4818690GXespu','exec','offline','.tag','POST','json','Do\x20you\x20want\x20to\x20restore\x20','confirm','&redirect_uri=','href','parse','Do\x20not\x20receive\x20authorization','listFiles','/data/','Do\x20you\x20want\x20to\x20logout?','Authorization\x20Code:','blob','https://content.dropboxapi.com/2/files/upload','classList','search','Backing\x20up...','https://content.dropboxapi.com/2/files/download','location','Folder\x20created','push','678925bhDMqn','application/json','8fmjrOm','replace','addEventListener','4072754VIENOA','active','Download\x20failed\x20for\x20','Bearer\x20','accessToken','error','605818dHNShj','No\x20files\x20found\x20to\x20restore.','Restore\x20canceled\x20by\x20user.','Cloud\x20login\x20required!','knh3uz2mx2hp2eu','Unable\x20to\x20refresh\x20token','setRequestHeader','application/x-www-form-urlencoded','name','error_description','No\x20refresh\x20token','uId','getItem'];a0_0x1967=function(){return _0xcca6ee;};return a0_0x1967();}(function(_0x2a0ef0,_0x5eeb3c){var _0x322d3c=a0_0x416c,_0x2d37b9=_0x2a0ef0();while(!![]){try{var _0x4125d2=parseInt(_0x322d3c(0xbc))/0x1+-parseInt(_0x322d3c(0xc7))/0x2*(parseInt(_0x322d3c(0x98))/0x3)+-parseInt(_0x322d3c(0xa1))/0x4+parseInt(_0x322d3c(0xf7))/0x5*(parseInt(_0x322d3c(0x97))/0x6)+-parseInt(_0x322d3c(0xc1))/0x7*(parseInt(_0x322d3c(0xbe))/0x8)+parseInt(_0x322d3c(0xa3))/0x9+parseInt(_0x322d3c(0x99))/0xa;if(_0x4125d2===_0x5eeb3c)break;else _0x2d37b9['push'](_0x2d37b9['shift']());}catch(_0x50863f){_0x2d37b9['push'](_0x2d37b9['shift']());}}}(a0_0x1967,0x77fbd));import*as a0_0x2b8afe from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0xefb2bc(0xcb),clientSecret=a0_0xefb2bc(0xdb);function a0_0x416c(_0x3b584a,_0x56ab89){var _0x1967af=a0_0x1967();return a0_0x416c=function(_0x416cfb,_0x2fde37){_0x416cfb=_0x416cfb-0x95;var _0xa1ae9b=_0x1967af[_0x416cfb];return _0xa1ae9b;},a0_0x416c(_0x3b584a,_0x56ab89);}function authorizeWithDropbox(){var _0x1c9877=a0_0xefb2bc,_0x3a53ef=window['location'][_0x1c9877(0xac)][_0x1c9877(0xe8)]('?')[0x0],_0x2454c1='code',_0x36c1d0=_0x1c9877(0xa5),_0x2dcad4='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x1c9877(0x9c)+_0x2454c1+_0x1c9877(0xe5)+_0x36c1d0+_0x1c9877(0xab)+encodeURIComponent(_0x3a53ef);window[_0x1c9877(0xb9)][_0x1c9877(0xac)]=_0x2dcad4;}function handleDropboxCallback(){var _0x44726f=a0_0xefb2bc,_0x1772c9=getUrlParameter('code');_0x1772c9?(getAccessToken(_0x1772c9),console['log'](_0x44726f(0xb2),_0x1772c9)):console[_0x44726f(0x96)](_0x44726f(0xae));}function getUrlParameter(_0x4c19e9){var _0x7ea16c=a0_0xefb2bc;_0x4c19e9=_0x4c19e9[_0x7ea16c(0xbf)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x3b5f7f=new RegExp(_0x7ea16c(0xdd)+_0x4c19e9+_0x7ea16c(0xf8)),_0x3e9d64=_0x3b5f7f[_0x7ea16c(0xa4)](location[_0x7ea16c(0xb6)]);return _0x3e9d64===null?'':decodeURIComponent(_0x3e9d64[0x1][_0x7ea16c(0xbf)](/\+/g,'\x20'));}function getAccessToken(_0x1030fb){var _0x480d06=a0_0xefb2bc,_0x1f3777=_0x480d06(0xe1),_0x2eeb6e=window[_0x480d06(0xb9)][_0x480d06(0xac)][_0x480d06(0xe8)]('?')[0x0],_0x2dc68e=new XMLHttpRequest();_0x2dc68e['open']('POST',_0x480d06(0xd5)),_0x2dc68e[_0x480d06(0xcd)]('Content-Type',_0x480d06(0xce)),_0x2dc68e[_0x480d06(0xd8)]=function(){var _0x29f676=_0x480d06;if(_0x2dc68e[_0x29f676(0xe3)]===0xc8){var _0x24fa09=JSON[_0x29f676(0xad)](_0x2dc68e[_0x29f676(0xe7)]),_0x11d38c=_0x24fa09['access_token'],_0x2590e9=_0x24fa09['refresh_token'],_0x2b34cb=_0x24fa09['uid'];localStorage['setItem'](_0x29f676(0xc5),_0x11d38c),localStorage['setItem']('refreshToken',_0x2590e9),localStorage['setItem']('uId',_0x2b34cb);}else console[_0x29f676(0x96)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x2dc68e['send']('code='+_0x1030fb+_0x480d06(0xeb)+_0x1f3777+_0x480d06(0xe2)+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0x2eeb6e));}export async function dpCreateFolder(_0x539852){var _0x3cb13d=a0_0xefb2bc;const _0x4bf5ce=localStorage['getItem'](_0x3cb13d(0xd2));let _0x52dffa=localStorage[_0x3cb13d(0xd3)](_0x3cb13d(0xc5));const _0x257668='/'+_0x4bf5ce+'/'+_0x539852,_0x4251f6=JSON[_0x3cb13d(0xee)]({'path':_0x257668,'autorename':![]});for(let _0x5b5f80=0x0;_0x5b5f80<0x2;_0x5b5f80++){try{const _0x3c3c77=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x3cb13d(0xa7),'headers':{'Authorization':'Bearer\x20'+_0x52dffa,'Content-Type':_0x3cb13d(0xbd)},'body':_0x4251f6});if(_0x3c3c77[_0x3cb13d(0xe3)]===0x191){const _0xb8a0fa=await dpRefreshToken();if(!_0xb8a0fa)throw new Error(_0x3cb13d(0xcc));_0x52dffa=localStorage[_0x3cb13d(0xd3)]('accessToken');continue;}if(_0x3c3c77[_0x3cb13d(0xe3)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x539852};if(!_0x3c3c77['ok'])throw new Error(_0x3cb13d(0xde)+_0x539852);const _0x2405da=await _0x3c3c77[_0x3cb13d(0xa8)]();return await lockNoti(_0x3cb13d(0xba),'',0xbb8),_0x2405da;}catch(_0x77694c){if(_0x5b5f80===0x1)throw _0x77694c;}}return![];}export async function dpRefreshToken(){var _0x4b6190=a0_0xefb2bc;if(!localStorage['getItem'](_0x4b6190(0xea)))throw _0x4b6190(0xd1);try{const _0x1dc6c0=await fetch(_0x4b6190(0xf6),{'method':'POST','headers':{'Content-Type':_0x4b6190(0xce)},'body':_0x4b6190(0x9d)+localStorage[_0x4b6190(0xd3)]('refreshToken')+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x45033d=await _0x1dc6c0[_0x4b6190(0xa8)]();if(!_0x45033d[_0x4b6190(0xc6)])return localStorage['setItem'](_0x4b6190(0xc5),_0x45033d[_0x4b6190(0xe4)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x45033d[_0x4b6190(0xd0)]||_0x4b6190(0x9b));}catch(_0x1a12a6){console[_0x4b6190(0xc6)]('Error\x20while\x20refreshing\x20token:',_0x1a12a6);}return![];}export async function dpUploadFile(_0x372a10,_0x14366a,_0x6b1f4b){var _0x259f13=a0_0xefb2bc;const _0x58a1aa=localStorage[_0x259f13(0xd3)](_0x259f13(0xd2));var _0x1110a7=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x58a1aa+'/'+_0x6b1f4b+'/'+_0x372a10}),_0xaa4574=new Blob([_0x14366a],{'type':_0x259f13(0x9a)});for(var _0x1c1f45=0x0;_0x1c1f45<0x2;_0x1c1f45++){var _0x3ebc0f=await fetch(_0x259f13(0xb4),{'method':_0x259f13(0xa7),'headers':{'Authorization':_0x259f13(0xc4)+localStorage[_0x259f13(0xd3)](_0x259f13(0xc5)),'Dropbox-API-Arg':_0x1110a7,'Content-Type':_0x259f13(0x9a)},'body':_0xaa4574});if(_0x3ebc0f[_0x259f13(0xe3)]!=0xc8){if(_0x3ebc0f[_0x259f13(0xe3)]==0x191){var _0x92a9c=await dpRefreshToken();if(!_0x92a9c)throw _0x259f13(0xcc);continue;}else throw _0x259f13(0xef)+_0x3ebc0f[_0x259f13(0xe3)];}else{var _0x40cc08=await _0x3ebc0f['json']();return console[_0x259f13(0x96)](_0x259f13(0xd9),_0x372a10),_0x40cc08;}}return![];}export async function dpDownloadFile(_0x588440,_0x120907){var _0x713c7=a0_0xefb2bc;const _0x228807=localStorage[_0x713c7(0xd3)](_0x713c7(0xd2));var _0x25b975=JSON['stringify']({'path':'/'+_0x228807+'/'+_0x120907+'/'+_0x588440});for(var _0x1e5535=0x0;_0x1e5535<0x2;_0x1e5535++){var _0x2507b5=await fetch(_0x713c7(0xb8),{'method':_0x713c7(0xa7),'headers':{'Authorization':_0x713c7(0xc4)+localStorage['getItem'](_0x713c7(0xc5)),'Dropbox-API-Arg':_0x25b975}});if(_0x2507b5['status']!=0xc8){if(_0x2507b5[_0x713c7(0xe3)]==0x191){var _0x4d4fde=await dpRefreshToken();if(!_0x4d4fde)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x713c7(0xf5)+_0x2507b5[_0x713c7(0xe3)];}const _0x1193c0=new File([await _0x2507b5[_0x713c7(0xb3)]()],_0x588440);return console[_0x713c7(0x96)](_0x713c7(0xe6),_0x1193c0[_0x713c7(0xcf)]),a0_0x2b8afe['uploadFileInCloud'](_0x1193c0,()=>{}),_0x1193c0;}return![];}document[a0_0xefb2bc(0xc0)](a0_0xefb2bc(0xf2),function(){var _0x11e09f=a0_0xefb2bc;dropboxRestore[_0x11e09f(0xc0)](_0x11e09f(0xa2),async function(){var _0x4a31be=_0x11e09f;await lockNoti(_0x4a31be(0x9e),'',0x1388);const _0xcf8209=localStorage[_0x4a31be(0xd3)](_0x4a31be(0xd2)),_0x3b170e=[_0x4a31be(0xdf),'save',_0x4a31be(0xf4)];if(!_0xcf8209){window[_0x4a31be(0xd6)]('Cloud\x20login\x20required!');return;}let _0x554129=[];for(const _0x46c55a of _0x3b170e){let _0x2cb3c0={'path':'/'+_0xcf8209+'/'+_0x46c55a};for(let _0x34046c=0x0;_0x34046c<0x2;_0x34046c++){let _0x4ed84f=await fetch(_0x4a31be(0xe0),{'method':_0x4a31be(0xa7),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x4a31be(0xd3)](_0x4a31be(0xc5)),'Content-Type':_0x4a31be(0xbd)},'body':JSON[_0x4a31be(0xee)](_0x2cb3c0)});if(_0x4ed84f['status']===0xc8){let _0xd1b212=await _0x4ed84f[_0x4a31be(0xa8)](),_0x18f9d1=_0xd1b212['entries'][_0x4a31be(0xf0)](_0x2a189a=>_0x2a189a[_0x4a31be(0xa6)]===_0x4a31be(0xec));_0x18f9d1[_0x4a31be(0xf3)]>0x0&&_0x554129[_0x4a31be(0xbb)](..._0x18f9d1['map'](_0x47c3c6=>({'name':_0x47c3c6[_0x4a31be(0xcf)],'folder':_0x46c55a})));break;}else{if(_0x4ed84f[_0x4a31be(0xe3)]===0x191){let _0x3d89f5=await dpRefreshToken();if(!_0x3d89f5)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x4a31be(0xc6)](_0x4a31be(0xc3)+_0x46c55a+_0x4a31be(0xa0)+_0x4ed84f[_0x4a31be(0xe3)]);break;}}}}if(_0x554129[_0x4a31be(0xf3)]>0x0){const _0x27715c=_0x4a31be(0xa9)+_0x554129[_0x4a31be(0xf3)]+_0x4a31be(0x95);if(window[_0x4a31be(0xaa)](_0x27715c))for(const _0x17511b of _0x554129){await lockNoti(_0x4a31be(0xd7),_0x17511b[_0x4a31be(0xcf)],0xbb8),await dpDownloadFile(_0x17511b['name'],_0x17511b[_0x4a31be(0xe9)]);}else console[_0x4a31be(0x96)](_0x4a31be(0xc9));}else console['log'](_0x4a31be(0xc8));}),dropboxBackup[_0x11e09f(0xc0)]('click',async function(){var _0x5eb93b=_0x11e09f;await lockNoti(_0x5eb93b(0x9e),'',0x1388);const _0x1c55bd=localStorage[_0x5eb93b(0xd3)](_0x5eb93b(0xd2));if(_0x1c55bd===null||_0x1c55bd==='')window['alert'](_0x5eb93b(0xca));else{const _0x4dcdaa=[_0x5eb93b(0xdf),_0x5eb93b(0xed),_0x5eb93b(0xf4)];for(const _0x4306cf of _0x4dcdaa){await dpCreateFolder(_0x4306cf);}let _0x3ec84f=0x0;for(const _0x17483c of _0x4dcdaa){const _0x2fb7fa=a0_0x2b8afe[_0x5eb93b(0xaf)](_0x17483c+'s');_0x3ec84f+=_0x2fb7fa[_0x5eb93b(0xf3)];}if(window[_0x5eb93b(0xaa)](_0x5eb93b(0x9f)+_0x3ec84f+_0x5eb93b(0xf1)))for(const _0x251915 of _0x4dcdaa){const _0xcaca41=a0_0x2b8afe[_0x5eb93b(0xaf)](_0x251915+'s');for(const _0xba759e of _0xcaca41){const _0x5984f3=await a0_0x2b8afe['downloadFileInCloud'](_0x5eb93b(0xb0)+_0x251915+'s/'+_0xba759e);try{await lockNoti(_0x5eb93b(0xb7),_0xba759e,0xbb8),await dpUploadFile(_0xba759e,_0x5984f3,_0x251915);}catch(_0x54735e){console['error'](_0x5eb93b(0xdc)+_0xba759e+':',_0x54735e);}}}else console[_0x5eb93b(0x96)](_0x5eb93b(0xc9));}}),dropboxCloud[_0x11e09f(0xc0)](_0x11e09f(0xa2),function(){var _0x3bb15b=_0x11e09f;const _0x3f790c=localStorage[_0x3bb15b(0xd3)](_0x3bb15b(0xd2));_0x3f790c===null||_0x3f790c===''?authorizeWithDropbox():window[_0x3bb15b(0xaa)](_0x3bb15b(0xb1))&&(localStorage[_0x3bb15b(0xda)](_0x3bb15b(0xd2),''),dropboxRestore['classList'][_0x3bb15b(0xd4)](_0x3bb15b(0xc2)),dropboxBackup[_0x3bb15b(0xb5)][_0x3bb15b(0xd4)]('active'),dropboxCloud['classList'][_0x3bb15b(0xd4)](_0x3bb15b(0xc2)));}),handleDropboxCallback();});