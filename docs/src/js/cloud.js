var a0_0x3a7fab=a0_0x59cc;function a0_0xb2b4(){var _0x1e01ed=['&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Restoring...','Folder\x20created','active','https://api.dropboxapi.com/2/files/list_folder','\x20files\x20from\x20Cloud?','list','&grant_type=','Unable\x20to\x20refresh\x20token','confirm','&response_type=','Wait\x20a\x20little\x20bit...','access_token','No\x20files\x20found\x20to\x20restore.','https://api.dropboxapi.com/oauth2/token','state','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','115EVBsHA','classList','setRequestHeader','Bearer\x20','stringify','href','overwrite','Upload\x20failed,\x20unknown\x20http\x20status:\x20','split','Cloud\x20login\x20required!','alert','Do\x20you\x20want\x20to\x20logout?','charAt','length','click','search','open','&token_access_type=','exec','6UCcSsv','1063414tmGnvx','FSSync','error','=([^&#]*)','entries','blob','Download\x20failed\x20for\x20',',\x20status:\x20','Error\x20creating\x20folder\x20','https://api.dropbox.com/oauth2/token','https://api.dropboxapi.com/2/files/create_folder_v2','Failed\x20to\x20upload\x20file\x20','refresh_token','3137032nmkjCz','&client_secret=','setItem','knh3uz2mx2hp2eu','accessToken','8847979uTVKDS','https://content.dropboxapi.com/2/files/upload','1818870JpxSDF','file','onload','map','status','application/x-www-form-urlencoded','uId','2387560yesOHw','application/octet-stream','Download\x20failed,\x20unknown\x20http\x20status:','application/json','Kabu\x20storage\x20↦\x20Cloud\x20◆','log','POST','location','No\x20refresh\x20token','Backing\x20up...','addEventListener','Do\x20you\x20want\x20to\x20restore\x20','&redirect_uri=','uploadFileInCloud','Authorization\x20Code:','json','\x20files\x20in\x20Kabu?','Content-Type','replace','153870ErOFQm','4649301nvxJpr','screenshot','refreshToken','folder','code','error_description','Restore\x20canceled\x20by\x20user.','save','name','remove','https://www.dropbox.com/oauth2/authorize?client_id=','getItem'];a0_0xb2b4=function(){return _0x1e01ed;};return a0_0xb2b4();}function a0_0x59cc(_0x1ac43a,_0x3f65d4){var _0xb2b463=a0_0xb2b4();return a0_0x59cc=function(_0x59cc44,_0x5f3504){_0x59cc44=_0x59cc44-0x18c;var _0x5dabfb=_0xb2b463[_0x59cc44];return _0x5dabfb;},a0_0x59cc(_0x1ac43a,_0x3f65d4);}(function(_0x3fc3f9,_0x8afb22){var _0x1b01e9=a0_0x59cc,_0x3839f0=_0x3fc3f9();while(!![]){try{var _0x210218=parseInt(_0x1b01e9(0x1d0))/0x1+parseInt(_0x1b01e9(0x1e4))/0x2+parseInt(_0x1b01e9(0x1cf))/0x3*(-parseInt(_0x1b01e9(0x1dd))/0x4)+parseInt(_0x1b01e9(0x1bc))/0x5*(-parseInt(_0x1b01e9(0x19e))/0x6)+parseInt(_0x1b01e9(0x1e2))/0x7+parseInt(_0x1b01e9(0x1eb))/0x8+-parseInt(_0x1b01e9(0x19f))/0x9;if(_0x210218===_0x8afb22)break;else _0x3839f0['push'](_0x3839f0['shift']());}catch(_0x2077e){_0x3839f0['push'](_0x3839f0['shift']());}}}(a0_0xb2b4,0xd20bf));import*as a0_0x4bad62 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x3a7fab(0x1e0),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x13e012=a0_0x3a7fab,_0x2a9f93=window['location']['href']['split']('?')[0x0],_0x2a6cf1=_0x13e012(0x1a3),_0x36393b='offline',_0x28e4e4=_0x13e012(0x1a9)+clientId+_0x13e012(0x1b5)+_0x2a6cf1+_0x13e012(0x1cd)+_0x36393b+_0x13e012(0x197)+encodeURIComponent(_0x2a9f93);window[_0x13e012(0x192)][_0x13e012(0x1c1)]=_0x28e4e4;}function handleDropboxCallback(){var _0x21062c=a0_0x3a7fab,_0x19ea7b=getUrlParameter(_0x21062c(0x1a3));_0x19ea7b?(getAccessToken(_0x19ea7b),console[_0x21062c(0x190)](_0x21062c(0x199),_0x19ea7b)):console[_0x21062c(0x190)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x562645){var _0x577ab2=a0_0x3a7fab;_0x562645=_0x562645[_0x577ab2(0x19d)](/[\[]/,'\x5c[')[_0x577ab2(0x19d)](/[\]]/,'\x5c]');var _0x657d3c=new RegExp('[\x5c?&#]'+_0x562645+_0x577ab2(0x1d3)),_0x1e32b1=_0x657d3c[_0x577ab2(0x1ce)](location[_0x577ab2(0x1cb)]);return _0x1e32b1===null?'':decodeURIComponent(_0x1e32b1[0x1][_0x577ab2(0x19d)](/\+/g,'\x20'));}function getAccessToken(_0x292e24){var _0x1c7a00=a0_0x3a7fab,_0xb9eae0='authorization_code',_0xdfc43b=window[_0x1c7a00(0x192)][_0x1c7a00(0x1c1)][_0x1c7a00(0x1c4)]('?')[0x0],_0x3be28a=new XMLHttpRequest();_0x3be28a[_0x1c7a00(0x1cc)](_0x1c7a00(0x191),_0x1c7a00(0x1d9)),_0x3be28a[_0x1c7a00(0x1be)](_0x1c7a00(0x19c),_0x1c7a00(0x1e9)),_0x3be28a[_0x1c7a00(0x1e6)]=function(){var _0x182afb=_0x1c7a00;if(_0x3be28a['status']===0xc8){var _0x5e96e8=JSON['parse'](_0x3be28a['responseText']),_0x47ab65=_0x5e96e8[_0x182afb(0x1b7)],_0x348947=_0x5e96e8[_0x182afb(0x1dc)],_0x1f62a3=_0x5e96e8['uid'];localStorage['setItem'](_0x182afb(0x1e1),_0x47ab65),localStorage[_0x182afb(0x1df)](_0x182afb(0x1a1),_0x348947),localStorage[_0x182afb(0x1df)](_0x182afb(0x1ea),_0x1f62a3);}else console[_0x182afb(0x190)](_0x182afb(0x1bb));},_0x3be28a['send']('code='+_0x292e24+_0x1c7a00(0x1b2)+_0xb9eae0+'&client_id='+clientId+_0x1c7a00(0x1de)+clientSecret+'&redirect_uri='+encodeURIComponent(_0xdfc43b));}export async function dpCreateFolder(_0x4808e9){var _0x12d005=a0_0x3a7fab;const _0x195066=localStorage[_0x12d005(0x1aa)]('uId');let _0x764ecc=localStorage[_0x12d005(0x1aa)](_0x12d005(0x1e1));const _0x52d842='/'+_0x195066+'/'+_0x4808e9,_0x43666c=JSON['stringify']({'path':_0x52d842,'autorename':![]});for(let _0x14bf60=0x0;_0x14bf60<0x2;_0x14bf60++){try{const _0x29b215=await fetch(_0x12d005(0x1da),{'method':'POST','headers':{'Authorization':_0x12d005(0x1bf)+_0x764ecc,'Content-Type':_0x12d005(0x18e)},'body':_0x43666c});if(_0x29b215[_0x12d005(0x1e8)]===0x191){const _0x432fd7=await dpRefreshToken();if(!_0x432fd7)throw new Error(_0x12d005(0x1b3));_0x764ecc=localStorage['getItem'](_0x12d005(0x1e1));continue;}if(_0x29b215[_0x12d005(0x1e8)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x4808e9};if(!_0x29b215['ok'])throw new Error(_0x12d005(0x1d8)+_0x4808e9);const _0x2aa9a6=await _0x29b215[_0x12d005(0x19a)]();return await lockNoti(_0x12d005(0x1ad),'',0xbb8),_0x2aa9a6;}catch(_0x292798){if(_0x14bf60===0x1)throw _0x292798;}}return![];}export async function dpRefreshToken(){var _0x32a398=a0_0x3a7fab;if(!localStorage[_0x32a398(0x1aa)](_0x32a398(0x1a1)))throw _0x32a398(0x193);try{const _0x53410f=await fetch(_0x32a398(0x1b9),{'method':_0x32a398(0x191),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x32a398(0x1aa)](_0x32a398(0x1a1))+_0x32a398(0x1ab)}),_0x559e27=await _0x53410f[_0x32a398(0x19a)]();if(!_0x559e27['error'])return localStorage[_0x32a398(0x1df)](_0x32a398(0x1e1),_0x559e27[_0x32a398(0x1b7)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x559e27[_0x32a398(0x1a4)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x86d137){console[_0x32a398(0x1d2)]('Error\x20while\x20refreshing\x20token:',_0x86d137);}return![];}export async function dpUploadFile(_0x483187,_0xbccfb3,_0x84367c){var _0x14983b=a0_0x3a7fab;const _0x3ea9a6=localStorage[_0x14983b(0x1aa)](_0x14983b(0x1ea));var _0x47ba5e=JSON['stringify']({'autorename':!![],'mode':_0x14983b(0x1c2),'mute':!![],'strict_conflict':![],'path':'/'+_0x3ea9a6+'/'+_0x84367c+'/'+_0x483187}),_0x4155a6=new Blob([_0xbccfb3],{'type':_0x14983b(0x18c)});for(var _0x25d71a=0x0;_0x25d71a<0x2;_0x25d71a++){var _0x5c757a=await fetch(_0x14983b(0x1e3),{'method':_0x14983b(0x191),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x14983b(0x1aa)](_0x14983b(0x1e1)),'Dropbox-API-Arg':_0x47ba5e,'Content-Type':'application/octet-stream'},'body':_0x4155a6});if(_0x5c757a[_0x14983b(0x1e8)]!=0xc8){if(_0x5c757a['status']==0x191){var _0x267878=await dpRefreshToken();if(!_0x267878)throw _0x14983b(0x1b3);continue;}else throw _0x14983b(0x1c3)+_0x5c757a['status'];}else{var _0x543c84=await _0x5c757a[_0x14983b(0x19a)]();return console[_0x14983b(0x190)](_0x14983b(0x18f),_0x483187),_0x543c84;}}return![];}export async function dpDownloadFile(_0x4e9c99,_0x3351c3){var _0x243fe8=a0_0x3a7fab;const _0x295638=localStorage[_0x243fe8(0x1aa)](_0x243fe8(0x1ea));var _0x376bfd=JSON[_0x243fe8(0x1c0)]({'path':'/'+_0x295638+'/'+_0x3351c3+'/'+_0x4e9c99});for(var _0x11e9b6=0x0;_0x11e9b6<0x2;_0x11e9b6++){var _0x437dc7=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x243fe8(0x191),'headers':{'Authorization':_0x243fe8(0x1bf)+localStorage[_0x243fe8(0x1aa)](_0x243fe8(0x1e1)),'Dropbox-API-Arg':_0x376bfd}});if(_0x437dc7[_0x243fe8(0x1e8)]!=0xc8){if(_0x437dc7['status']==0x191){var _0x36428b=await dpRefreshToken();if(!_0x36428b)throw _0x243fe8(0x1b3);continue;}else throw _0x243fe8(0x18d)+_0x437dc7['status'];}const _0x15c09a=new File([await _0x437dc7[_0x243fe8(0x1d5)]()],_0x4e9c99);return console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x15c09a['name']),a0_0x4bad62[_0x243fe8(0x198)](_0x15c09a,()=>{var _0x59c7c5=_0x243fe8;localStorageFile(),Module[_0x59c7c5(0x1d1)]();}),_0x15c09a;}return![];}document[a0_0x3a7fab(0x195)]('DOMContentLoaded',function(){var _0x42f009=a0_0x3a7fab;dropboxRestore[_0x42f009(0x195)]('click',async function(){var _0x1c86ac=_0x42f009;await lockNoti(_0x1c86ac(0x1b6),'',0x1388);const _0x1b8e98=localStorage['getItem'](_0x1c86ac(0x1ea)),_0x49a75f=[_0x1c86ac(0x1ba),_0x1c86ac(0x1a6),'screenshot'];if(!_0x1b8e98){window[_0x1c86ac(0x1c6)]('Cloud\x20login\x20required!');return;}let _0x3ca822=[];for(const _0x7958d2 of _0x49a75f){let _0x135565={'path':'/'+_0x1b8e98+'/'+_0x7958d2};for(let _0xd41094=0x0;_0xd41094<0x2;_0xd41094++){let _0x468efa=await fetch(_0x1c86ac(0x1af),{'method':_0x1c86ac(0x191),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x1c86ac(0x1e1)),'Content-Type':_0x1c86ac(0x18e)},'body':JSON[_0x1c86ac(0x1c0)](_0x135565)});if(_0x468efa['status']===0xc8){let _0x43586b=await _0x468efa['json'](),_0x5774a5=_0x43586b[_0x1c86ac(0x1d4)]['filter'](_0x2dd3b0=>_0x2dd3b0['.tag']===_0x1c86ac(0x1e5));_0x5774a5['length']>0x0&&_0x3ca822['push'](..._0x5774a5[_0x1c86ac(0x1e7)](_0x4b215c=>({'name':_0x4b215c[_0x1c86ac(0x1a7)],'folder':_0x7958d2})));break;}else{if(_0x468efa['status']===0x191){let _0x56de9d=await dpRefreshToken();if(!_0x56de9d)throw _0x1c86ac(0x1b3);}else{console['error'](_0x1c86ac(0x1d6)+_0x7958d2+_0x1c86ac(0x1d7)+_0x468efa[_0x1c86ac(0x1e8)]);break;}}}}if(_0x3ca822[_0x1c86ac(0x1c9)]>0x0){const _0x3dd7d7=_0x1c86ac(0x196)+_0x3ca822[_0x1c86ac(0x1c9)]+_0x1c86ac(0x1b0);if(window[_0x1c86ac(0x1b4)](_0x3dd7d7))for(const _0x3bf4ea of _0x3ca822){await lockNoti(_0x1c86ac(0x1ac),_0x3bf4ea[_0x1c86ac(0x1a7)],0xbb8),await dpDownloadFile(_0x3bf4ea[_0x1c86ac(0x1a7)],_0x3bf4ea[_0x1c86ac(0x1a2)]);}else console[_0x1c86ac(0x190)](_0x1c86ac(0x1a5));}else console[_0x1c86ac(0x190)](_0x1c86ac(0x1b8));}),dropboxBackup[_0x42f009(0x195)](_0x42f009(0x1ca),async function(){var _0x2fed65=_0x42f009;await lockNoti(_0x2fed65(0x1b6),'',0x1388);const _0x31cfdd=localStorage[_0x2fed65(0x1aa)]('uId');if(_0x31cfdd===null||_0x31cfdd==='')window[_0x2fed65(0x1c6)](_0x2fed65(0x1c5));else{const _0xbab4fe=[_0x2fed65(0x1ba),_0x2fed65(0x1a6),_0x2fed65(0x1a0)];for(const _0x4a913a of _0xbab4fe){await dpCreateFolder(_0x4a913a);}let _0x1ba6b8=0x0;for(const _0x2691aa of _0xbab4fe){const _0x44d5e5=a0_0x4bad62['list'+(_0x2691aa[_0x2fed65(0x1c8)](0x0)['toUpperCase']()+_0x2691aa['slice'](0x1))]();_0x1ba6b8+=_0x44d5e5[_0x2fed65(0x1c9)];}if(window[_0x2fed65(0x1b4)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x1ba6b8+_0x2fed65(0x19b)))for(const _0x441159 of _0xbab4fe){const _0xae6473=a0_0x4bad62[_0x2fed65(0x1b1)+(_0x441159[_0x2fed65(0x1c8)](0x0)['toUpperCase']()+_0x441159['slice'](0x1))]();for(const _0x154b44 of _0xae6473){const _0x2b880e=await a0_0x4bad62['downloadFileInCloud']('/data/'+_0x441159+'s/'+_0x154b44);try{await lockNoti(_0x2fed65(0x194),_0x154b44,0xbb8),await dpUploadFile(_0x154b44,_0x2b880e,_0x441159);}catch(_0x5e0833){console[_0x2fed65(0x1d2)](_0x2fed65(0x1db)+_0x154b44+':',_0x5e0833);}}}else console[_0x2fed65(0x190)](_0x2fed65(0x1a5));}}),dropboxCloud[_0x42f009(0x195)]('click',function(){var _0x3a6465=_0x42f009;const _0x456065=localStorage[_0x3a6465(0x1aa)](_0x3a6465(0x1ea));_0x456065===null||_0x456065===''?authorizeWithDropbox():window[_0x3a6465(0x1b4)](_0x3a6465(0x1c7))&&(localStorage['setItem'](_0x3a6465(0x1ea),''),dropboxRestore[_0x3a6465(0x1bd)][_0x3a6465(0x1a8)]('active'),dropboxBackup[_0x3a6465(0x1bd)]['remove']('active'),dropboxCloud[_0x3a6465(0x1bd)][_0x3a6465(0x1a8)](_0x3a6465(0x1ae)));}),handleDropboxCallback();});