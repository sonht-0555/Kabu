var a0_0x272339=a0_0x163e;(function(_0x5630d7,_0x52cdd9){var _0xef4b38=a0_0x163e,_0xb94055=_0x5630d7();while(!![]){try{var _0x51fc76=parseInt(_0xef4b38(0x1b7))/0x1+parseInt(_0xef4b38(0x1b3))/0x2+-parseInt(_0xef4b38(0x1da))/0x3*(-parseInt(_0xef4b38(0x1f3))/0x4)+parseInt(_0xef4b38(0x1f2))/0x5*(-parseInt(_0xef4b38(0x1b9))/0x6)+parseInt(_0xef4b38(0x1ee))/0x7*(-parseInt(_0xef4b38(0x1ec))/0x8)+-parseInt(_0xef4b38(0x1c0))/0x9+-parseInt(_0xef4b38(0x201))/0xa*(-parseInt(_0xef4b38(0x200))/0xb);if(_0x51fc76===_0x52cdd9)break;else _0xb94055['push'](_0xb94055['shift']());}catch(_0x4ed3d1){_0xb94055['push'](_0xb94055['shift']());}}}(a0_0x46b3,0x914b2));import*as a0_0x1749ad from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x272339(0x1c7),clientSecret=a0_0x272339(0x1ed);function authorizeWithDropbox(){var _0x13b984=a0_0x272339,_0x417df3=window[_0x13b984(0x1d0)][_0x13b984(0x1e3)][_0x13b984(0x1d2)]('?')[0x0],_0x5f391c=_0x13b984(0x1ac),_0x435ffb=_0x13b984(0x1e9),_0x36230b=_0x13b984(0x19e)+clientId+_0x13b984(0x1ba)+_0x5f391c+'&token_access_type='+_0x435ffb+_0x13b984(0x1a0)+encodeURIComponent(_0x417df3);window[_0x13b984(0x1d0)][_0x13b984(0x1e3)]=_0x36230b;}function handleDropboxCallback(){var _0x89c527=a0_0x272339,_0x207e7b=getUrlParameter('code');_0x207e7b?(getAccessToken(_0x207e7b),console['log']('Authorization\x20Code:',_0x207e7b)):console[_0x89c527(0x19d)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x388aa1){var _0x9dc04d=a0_0x272339;_0x388aa1=_0x388aa1[_0x9dc04d(0x1aa)](/[\[]/,'\x5c[')[_0x9dc04d(0x1aa)](/[\]]/,'\x5c]');var _0x38762f=new RegExp('[\x5c?&#]'+_0x388aa1+_0x9dc04d(0x1a1)),_0x416336=_0x38762f['exec'](location['search']);return _0x416336===null?'':decodeURIComponent(_0x416336[0x1][_0x9dc04d(0x1aa)](/\+/g,'\x20'));}function getAccessToken(_0x322419){var _0x5805e1=a0_0x272339,_0x39682b=_0x5805e1(0x1be),_0x34dfd4=window[_0x5805e1(0x1d0)]['href'][_0x5805e1(0x1d2)]('?')[0x0],_0x47c9c5=new XMLHttpRequest();_0x47c9c5[_0x5805e1(0x1ca)]('POST',_0x5805e1(0x1bd)),_0x47c9c5[_0x5805e1(0x1f5)](_0x5805e1(0x1eb),_0x5805e1(0x19f)),_0x47c9c5[_0x5805e1(0x1bb)]=function(){var _0x435574=_0x5805e1;if(_0x47c9c5[_0x435574(0x1e2)]===0xc8){var _0x1ea12f=JSON[_0x435574(0x1f9)](_0x47c9c5[_0x435574(0x1b0)]),_0x4ec34f=_0x1ea12f[_0x435574(0x1af)],_0x24fdf7=_0x1ea12f[_0x435574(0x1ea)],_0x2f2732=_0x1ea12f[_0x435574(0x1c1)];localStorage[_0x435574(0x1db)](_0x435574(0x1f7),_0x4ec34f),localStorage[_0x435574(0x1db)](_0x435574(0x1e6),_0x24fdf7),localStorage[_0x435574(0x1db)](_0x435574(0x1a6),_0x2f2732);}else console['log'](_0x435574(0x1c4));},_0x47c9c5['send'](_0x5805e1(0x1a7)+_0x322419+_0x5805e1(0x1fc)+_0x39682b+_0x5805e1(0x1b2)+clientId+'&client_secret='+clientSecret+_0x5805e1(0x1a0)+encodeURIComponent(_0x34dfd4));}function a0_0x46b3(){var _0x344e84=['Bearer\x20','No\x20refresh\x20token','log','https://www.dropbox.com/oauth2/authorize?client_id=','application/x-www-form-urlencoded','&redirect_uri=','=([^&#]*)','active','overwrite','error','Download\x20failed\x20for\x20','uId','code=','https://api.dropboxapi.com/2/files/list_folder','refresh_token=','replace','screenshot','code',',\x20status:\x20','Do\x20you\x20want\x20to\x20logout?','access_token','responseText','Cloud\x20login\x20required!','&client_id=','2192100sliSDh','.tag','remove','json','391117Chwynz','push','3666geANNW','&response_type=','onload','stringify','https://api.dropbox.com/oauth2/token','authorization_code','length','9304713AjZcqA','uid','listFiles','Do\x20you\x20want\x20to\x20restore\x20','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','https://content.dropboxapi.com/2/files/download','knh3uz2mx2hp2eu','name','https://api.dropboxapi.com/oauth2/token','open','confirm','Error\x20creating\x20folder\x20','\x20files\x20from\x20Cloud?','folder','classList','location','file','split','https://api.dropboxapi.com/2/files/create_folder_v2','POST','Upload\x20failed,\x20unknown\x20http\x20status:\x20','state','alert','downloadFileInCloud','Folder\x20already\x20exists','946767tQxyCy','setItem','application/octet-stream','Cloud\x20↦\x20Kabu\x20storage\x20◆','Kabu\x20storage\x20↦\x20Cloud\x20◆','blob','Failed\x20to\x20refresh\x20Dropbox\x20token.','DOMContentLoaded','status','href','error_description','application/json','refreshToken','Error\x20while\x20refreshing\x20token:','\x20files\x20in\x20Kabu?','offline','refresh_token','Content-Type','6042144aBjsID','nwb3dnfh09rhs31','7dpmBYY','map','getItem','click','3030ITBtUj','8hkFuaI','Do\x20you\x20want\x20to\x20backup\x20','setRequestHeader','Unable\x20to\x20refresh\x20token','accessToken','Wait\x20a\x20little\x20bit...','parse','No\x20files\x20found\x20to\x20restore.','save','&grant_type=','Restore\x20canceled\x20by\x20user.','Folder\x20created','https://content.dropboxapi.com/2/files/upload','89716uexRsd','780kRRXIt'];a0_0x46b3=function(){return _0x344e84;};return a0_0x46b3();}export async function dpCreateFolder(_0x27ca5f){var _0x551d81=a0_0x272339;const _0x221c00=localStorage[_0x551d81(0x1f0)](_0x551d81(0x1a6));let _0x2bb935=localStorage[_0x551d81(0x1f0)](_0x551d81(0x1f7));const _0x453b37='/'+_0x221c00+'/'+_0x27ca5f,_0x3d7261=JSON['stringify']({'path':_0x453b37,'autorename':![]});for(let _0x560086=0x0;_0x560086<0x2;_0x560086++){try{const _0x4aca1f=await fetch(_0x551d81(0x1d3),{'method':_0x551d81(0x1d4),'headers':{'Authorization':_0x551d81(0x19b)+_0x2bb935,'Content-Type':'application/json'},'body':_0x3d7261});if(_0x4aca1f[_0x551d81(0x1e2)]===0x191){const _0x1012e3=await dpRefreshToken();if(!_0x1012e3)throw new Error(_0x551d81(0x1f6));_0x2bb935=localStorage[_0x551d81(0x1f0)](_0x551d81(0x1f7));continue;}if(_0x4aca1f['status']===0x199)return{'message':_0x551d81(0x1d9),'path':_0x27ca5f};if(!_0x4aca1f['ok'])throw new Error(_0x551d81(0x1cc)+_0x27ca5f);const _0x248620=await _0x4aca1f[_0x551d81(0x1b6)]();return await lockNoti(_0x551d81(0x1fe),'',0xbb8),_0x248620;}catch(_0x34c053){if(_0x560086===0x1)throw _0x34c053;}}return![];}export async function dpRefreshToken(){var _0x2244b3=a0_0x272339;if(!localStorage['getItem']('refreshToken'))throw _0x2244b3(0x19c);try{const _0x2edeb3=await fetch(_0x2244b3(0x1c9),{'method':_0x2244b3(0x1d4),'headers':{'Content-Type':_0x2244b3(0x19f)},'body':_0x2244b3(0x1a9)+localStorage['getItem'](_0x2244b3(0x1e6))+_0x2244b3(0x1c5)}),_0x4fcf1f=await _0x2edeb3[_0x2244b3(0x1b6)]();if(!_0x4fcf1f[_0x2244b3(0x1a4)])return localStorage[_0x2244b3(0x1db)](_0x2244b3(0x1f7),_0x4fcf1f[_0x2244b3(0x1af)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x4fcf1f[_0x2244b3(0x1e4)]||_0x2244b3(0x1e0));}catch(_0x1bd363){console['error'](_0x2244b3(0x1e7),_0x1bd363);}return![];}function a0_0x163e(_0x2fed11,_0x51e5f3){var _0x46b374=a0_0x46b3();return a0_0x163e=function(_0x163e91,_0x218f6d){_0x163e91=_0x163e91-0x19b;var _0x1336e1=_0x46b374[_0x163e91];return _0x1336e1;},a0_0x163e(_0x2fed11,_0x51e5f3);}export async function dpUploadFile(_0x148b38,_0x39967a,_0x30592b){var _0x460e12=a0_0x272339;const _0x5e121a=localStorage[_0x460e12(0x1f0)](_0x460e12(0x1a6));var _0x3e215a=JSON[_0x460e12(0x1bc)]({'autorename':!![],'mode':_0x460e12(0x1a3),'mute':!![],'strict_conflict':![],'path':'/'+_0x5e121a+'/'+_0x30592b+'/'+_0x148b38}),_0x5f23e4=new Blob([_0x39967a],{'type':_0x460e12(0x1dc)});for(var _0xaeaf43=0x0;_0xaeaf43<0x2;_0xaeaf43++){var _0x2a1c5c=await fetch(_0x460e12(0x1ff),{'method':'POST','headers':{'Authorization':_0x460e12(0x19b)+localStorage[_0x460e12(0x1f0)](_0x460e12(0x1f7)),'Dropbox-API-Arg':_0x3e215a,'Content-Type':_0x460e12(0x1dc)},'body':_0x5f23e4});if(_0x2a1c5c[_0x460e12(0x1e2)]!=0xc8){if(_0x2a1c5c[_0x460e12(0x1e2)]==0x191){var _0x2c7fdd=await dpRefreshToken();if(!_0x2c7fdd)throw _0x460e12(0x1f6);continue;}else throw _0x460e12(0x1d5)+_0x2a1c5c[_0x460e12(0x1e2)];}else{var _0x47b5f0=await _0x2a1c5c[_0x460e12(0x1b6)]();return console[_0x460e12(0x19d)](_0x460e12(0x1de),_0x148b38),_0x47b5f0;}}return![];}export async function dpDownloadFile(_0xa55ab7,_0x49bdb0){var _0x2af1a9=a0_0x272339;const _0x429c35=localStorage[_0x2af1a9(0x1f0)](_0x2af1a9(0x1a6));var _0x2c196a=JSON[_0x2af1a9(0x1bc)]({'path':'/'+_0x429c35+'/'+_0x49bdb0+'/'+_0xa55ab7});for(var _0x3f8285=0x0;_0x3f8285<0x2;_0x3f8285++){var _0x20ad40=await fetch(_0x2af1a9(0x1c6),{'method':_0x2af1a9(0x1d4),'headers':{'Authorization':_0x2af1a9(0x19b)+localStorage[_0x2af1a9(0x1f0)](_0x2af1a9(0x1f7)),'Dropbox-API-Arg':_0x2c196a}});if(_0x20ad40[_0x2af1a9(0x1e2)]!=0xc8){if(_0x20ad40['status']==0x191){var _0x157ddf=await dpRefreshToken();if(!_0x157ddf)throw _0x2af1a9(0x1f6);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x20ad40['status'];}const _0x53ed77=new File([await _0x20ad40[_0x2af1a9(0x1df)]()],_0xa55ab7);return console['log'](_0x2af1a9(0x1dd),_0x53ed77['name']),a0_0x1749ad['uploadFileInCloud'](_0x53ed77,()=>{}),_0x53ed77;}return![];}document['addEventListener'](a0_0x272339(0x1e1),function(){var _0x385572=a0_0x272339;dropboxRestore['addEventListener'](_0x385572(0x1f1),async function(){var _0x47e9f6=_0x385572;await lockNoti(_0x47e9f6(0x1f8),'',0x1388);const _0x2ea9d9=localStorage[_0x47e9f6(0x1f0)]('uId'),_0x3504a1=[_0x47e9f6(0x1d6),_0x47e9f6(0x1fb),_0x47e9f6(0x1ab)];if(!_0x2ea9d9){window[_0x47e9f6(0x1d7)](_0x47e9f6(0x1b1));return;}let _0x132525=[];for(const _0x2521a4 of _0x3504a1){let _0x23b29d={'path':'/'+_0x2ea9d9+'/'+_0x2521a4};for(let _0x480805=0x0;_0x480805<0x2;_0x480805++){let _0x3daca3=await fetch(_0x47e9f6(0x1a8),{'method':'POST','headers':{'Authorization':_0x47e9f6(0x19b)+localStorage['getItem'](_0x47e9f6(0x1f7)),'Content-Type':_0x47e9f6(0x1e5)},'body':JSON[_0x47e9f6(0x1bc)](_0x23b29d)});if(_0x3daca3['status']===0xc8){let _0x3c0e44=await _0x3daca3[_0x47e9f6(0x1b6)](),_0x53e0f6=_0x3c0e44['entries']['filter'](_0x509d8c=>_0x509d8c[_0x47e9f6(0x1b4)]===_0x47e9f6(0x1d1));_0x53e0f6[_0x47e9f6(0x1bf)]>0x0&&_0x132525[_0x47e9f6(0x1b8)](..._0x53e0f6[_0x47e9f6(0x1ef)](_0xbe5588=>({'name':_0xbe5588[_0x47e9f6(0x1c8)],'folder':_0x2521a4})));break;}else{if(_0x3daca3[_0x47e9f6(0x1e2)]===0x191){let _0x425ab5=await dpRefreshToken();if(!_0x425ab5)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x47e9f6(0x1a4)](_0x47e9f6(0x1a5)+_0x2521a4+_0x47e9f6(0x1ad)+_0x3daca3[_0x47e9f6(0x1e2)]);break;}}}}if(_0x132525[_0x47e9f6(0x1bf)]>0x0){const _0x49fde2=_0x47e9f6(0x1c3)+_0x132525['length']+_0x47e9f6(0x1cd);if(window[_0x47e9f6(0x1cb)](_0x49fde2))for(const _0x1a84dc of _0x132525){await lockNoti('Restoring...',_0x1a84dc[_0x47e9f6(0x1c8)],0xbb8),await dpDownloadFile(_0x1a84dc[_0x47e9f6(0x1c8)],_0x1a84dc[_0x47e9f6(0x1ce)]);}else console[_0x47e9f6(0x19d)](_0x47e9f6(0x1fd));}else console['log'](_0x47e9f6(0x1fa));}),dropboxBackup['addEventListener']('click',async function(){var _0x51c105=_0x385572;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x451eae=localStorage[_0x51c105(0x1f0)](_0x51c105(0x1a6));if(_0x451eae===null||_0x451eae==='')window['alert']('Cloud\x20login\x20required!');else{const _0x555cdf=['state',_0x51c105(0x1fb),_0x51c105(0x1ab)];for(const _0x1330f9 of _0x555cdf){await dpCreateFolder(_0x1330f9);}let _0x3d11d5=0x0;for(const _0x4a51da of _0x555cdf){const _0x59cbf2=a0_0x1749ad[_0x51c105(0x1c2)](_0x4a51da+'s');_0x3d11d5+=_0x59cbf2['length'];}if(window[_0x51c105(0x1cb)](_0x51c105(0x1f4)+_0x3d11d5+_0x51c105(0x1e8)))for(const _0x551118 of _0x555cdf){const _0x3fb892=a0_0x1749ad['listFiles'](_0x551118+'s');for(const _0xf81491 of _0x3fb892){const _0xac63a=await a0_0x1749ad[_0x51c105(0x1d8)]('/data/'+_0x551118+'s/'+_0xf81491);try{await lockNoti('Backing\x20up...',_0xf81491,0xbb8),await dpUploadFile(_0xf81491,_0xac63a,_0x551118);}catch(_0x5c7ae1){console[_0x51c105(0x1a4)]('Failed\x20to\x20upload\x20file\x20'+_0xf81491+':',_0x5c7ae1);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x385572(0x1f1),function(){var _0x8e0270=_0x385572;const _0x4bf51e=localStorage[_0x8e0270(0x1f0)](_0x8e0270(0x1a6));_0x4bf51e===null||_0x4bf51e===''?authorizeWithDropbox():window[_0x8e0270(0x1cb)](_0x8e0270(0x1ae))&&(localStorage[_0x8e0270(0x1db)]('uId',''),dropboxRestore[_0x8e0270(0x1cf)][_0x8e0270(0x1b5)](_0x8e0270(0x1a2)),dropboxBackup[_0x8e0270(0x1cf)][_0x8e0270(0x1b5)](_0x8e0270(0x1a2)),dropboxCloud[_0x8e0270(0x1cf)][_0x8e0270(0x1b5)](_0x8e0270(0x1a2)));}),handleDropboxCallback();});