var a0_0x2729a2=a0_0x1f90;(function(_0x303377,_0x478c3d){var _0x3a44c4=a0_0x1f90,_0x450972=_0x303377();while(!![]){try{var _0x26fe60=parseInt(_0x3a44c4(0xf9))/0x1+-parseInt(_0x3a44c4(0x119))/0x2+parseInt(_0x3a44c4(0xe6))/0x3+-parseInt(_0x3a44c4(0xc8))/0x4*(-parseInt(_0x3a44c4(0xf2))/0x5)+-parseInt(_0x3a44c4(0xe7))/0x6+parseInt(_0x3a44c4(0x130))/0x7+parseInt(_0x3a44c4(0xf1))/0x8;if(_0x26fe60===_0x478c3d)break;else _0x450972['push'](_0x450972['shift']());}catch(_0x25177f){_0x450972['push'](_0x450972['shift']());}}}(a0_0x2049,0x188ba));import*as a0_0x581af0 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2729a2(0xfb),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x1c7ee3=a0_0x2729a2,_0x18ee80=window[_0x1c7ee3(0xfd)]['href'][_0x1c7ee3(0xda)]('?')[0x0],_0x1877d6=_0x1c7ee3(0x106),_0x4b9e4d='offline',_0x3951d5='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x1c7ee3(0xd8)+_0x1877d6+_0x1c7ee3(0x12e)+_0x4b9e4d+'&redirect_uri='+encodeURIComponent(_0x18ee80);window['location'][_0x1c7ee3(0xe8)]=_0x3951d5;}function handleDropboxCallback(){var _0x35f93c=a0_0x2729a2,_0x5a3d23=getUrlParameter(_0x35f93c(0x106));_0x5a3d23?(getAccessToken(_0x5a3d23),console[_0x35f93c(0x104)](_0x35f93c(0x129),_0x5a3d23)):console[_0x35f93c(0x104)](_0x35f93c(0xf7));}function getUrlParameter(_0x56ca1b){var _0x5941ad=a0_0x2729a2;_0x56ca1b=_0x56ca1b[_0x5941ad(0xe2)](/[\[]/,'\x5c[')[_0x5941ad(0xe2)](/[\]]/,'\x5c]');var _0x5117c9=new RegExp(_0x5941ad(0x11f)+_0x56ca1b+_0x5941ad(0x100)),_0x4e7cfb=_0x5117c9[_0x5941ad(0x110)](location[_0x5941ad(0xd7)]);return _0x4e7cfb===null?'':decodeURIComponent(_0x4e7cfb[0x1][_0x5941ad(0xe2)](/\+/g,'\x20'));}function a0_0x1f90(_0x1e13c2,_0x44f091){var _0x204906=a0_0x2049();return a0_0x1f90=function(_0x1f9029,_0x4a20a5){_0x1f9029=_0x1f9029-0xc0;var _0x3d6043=_0x204906[_0x1f9029];return _0x3d6043;},a0_0x1f90(_0x1e13c2,_0x44f091);}function getAccessToken(_0x95e885){var _0x37c225=a0_0x2729a2,_0x485599=_0x37c225(0x11a),_0x8b8018=window[_0x37c225(0xfd)][_0x37c225(0xe8)][_0x37c225(0xda)]('?')[0x0],_0x414082=new XMLHttpRequest();_0x414082[_0x37c225(0xdd)](_0x37c225(0xcc),_0x37c225(0xdf)),_0x414082[_0x37c225(0x128)](_0x37c225(0x120),'application/x-www-form-urlencoded'),_0x414082[_0x37c225(0xf4)]=function(){var _0xfb0b4f=_0x37c225;if(_0x414082['status']===0xc8){var _0xd41638=JSON[_0xfb0b4f(0x116)](_0x414082[_0xfb0b4f(0x108)]),_0x2a306b=_0xd41638[_0xfb0b4f(0xf6)],_0x3af407=_0xd41638[_0xfb0b4f(0x115)],_0x137a72=_0xd41638['uid'];localStorage[_0xfb0b4f(0x109)](_0xfb0b4f(0x127),_0x2a306b),localStorage[_0xfb0b4f(0x109)](_0xfb0b4f(0xc2),_0x3af407),localStorage[_0xfb0b4f(0x109)]('uId',_0x137a72);}else console[_0xfb0b4f(0x104)](_0xfb0b4f(0xc6));},_0x414082['send'](_0x37c225(0xe3)+_0x95e885+_0x37c225(0xc3)+_0x485599+_0x37c225(0x103)+clientId+_0x37c225(0x107)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x8b8018));}function a0_0x2049(){var _0x3ce470=['length','json','.ss0','refresh_token','parse','Download\x20failed,\x20unknown\x20http\x20status:\x20','charAt','340960mlIAWG','authorization_code','name','application/octet-stream','Error\x20while\x20refreshing\x20token:','status','[\x5c?&#]','Content-Type','overwrite','.ss2','addEventListener','Bearer\x20','Unable\x20to\x20refresh\x20token','.gba_dateState','accessToken','setRequestHeader','Authorization\x20Code:','getItem','Do\x20you\x20want\x20to\x20restore\x20','active','Refreshing\x20token...','&token_access_type=','Failed\x20to\x20refresh\x20Dropbox\x20token.','28490DqUHEA','classList','substring','refreshToken','&grant_type=','uploadSaveOrSaveState','https://api.dropboxapi.com/oauth2/token','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','.ss6','152rgBCgK','file','Cloud\x20↦\x20Kabu\x20storage\x20◆','text','POST','lastIndexOf','gba','status:\x20','click','Do\x20you\x20want\x20to\x20backup\x20','alert','Upload\x20failed,\x20unknown\x20http\x20status:\x20','.ss7','refresh_token=','toUpperCase','search','&response_type=','uId','split','Cloud\x20login\x20required!','Backing\x20up...','open','.ss5','https://api.dropbox.com/oauth2/token','.tag','Restoring...','replace','code=','_imageState','.ss3','239514vNqXbt','1049622StxmRL','href','confirm','remove','stringify','\x20files\x20in\x20Cloud?','.txt','/data/','entries','Failed\x20to\x20upload\x20file\x20','1111480PKgKFG','8185zhEgld','.gba_imageState','onload','https://api.dropboxapi.com/2/files/list_folder','access_token','Do\x20not\x20receive\x20authorization','slice','160906DcCKtZ','filter','knh3uz2mx2hp2eu','Kabu\x20storage\x20↦\x20Cloud\x20◆','location','list','error','=([^&#]*)','downloadFileInCloud','Restore\x20canceled\x20by\x20user.','&client_id=','log','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','code','&client_secret=','responseText','setItem','DOMContentLoaded','\x20files\x20in\x20Kabu?','.gba_slot','text/plain','endsWith','.ss4','exec','save'];a0_0x2049=function(){return _0x3ce470;};return a0_0x2049();}export async function dpRefreshToken(){var _0x447b29=a0_0x2729a2;if(!localStorage['getItem']('refreshToken'))throw'No\x20refresh\x20token';try{const _0x4ad84a=await fetch(_0x447b29(0xc5),{'method':_0x447b29(0xcc),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x447b29(0xd5)+localStorage[_0x447b29(0x12a)](_0x447b29(0xc2))+_0x447b29(0x105)}),_0x2b944d=await _0x4ad84a['json']();if(!_0x2b944d[_0x447b29(0xff)])return localStorage[_0x447b29(0x109)]('accessToken',_0x2b944d[_0x447b29(0xf6)]),await lockNoti('',_0x447b29(0x12d),0xbb8),await delay(0x3e8),!![];else alert(_0x2b944d['error_description']||_0x447b29(0x12f));}catch(_0x36347f){console['error'](_0x447b29(0x11d),_0x36347f);}return![];}export async function dpUploadFile(_0x3438e8,_0x16695a){var _0x55e982=a0_0x2729a2;const _0x4a11a9=localStorage['getItem'](_0x55e982(0xd9));var _0x4d2e3=JSON[_0x55e982(0xeb)]({'autorename':!![],'mode':_0x55e982(0x121),'mute':!![],'strict_conflict':![],'path':'/'+_0x4a11a9+'/'+_0x3438e8}),_0x24572d=new Blob([_0x16695a],{'type':'application/octet-stream'});for(var _0x1f6b67=0x0;_0x1f6b67<0x2;_0x1f6b67++){var _0x4bf35f=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':'POST','headers':{'Authorization':_0x55e982(0x124)+localStorage[_0x55e982(0x12a)]('accessToken'),'Dropbox-API-Arg':_0x4d2e3,'Content-Type':_0x55e982(0x11c)},'body':_0x24572d});if(_0x4bf35f[_0x55e982(0x11e)]!=0xc8){if(_0x4bf35f[_0x55e982(0x11e)]==0x191){var _0x5f0d17=await dpRefreshToken();if(!_0x5f0d17)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x55e982(0xd3)+_0x4bf35f[_0x55e982(0x11e)];}else{var _0xccb05c=await _0x4bf35f[_0x55e982(0x113)]();return console['log'](_0x55e982(0xfc),_0x3438e8),_0xccb05c;}}return![];}async function dpDownloadFile(_0x5280b5){var _0xe09449=a0_0x2729a2;const _0x1419fb=localStorage[_0xe09449(0x12a)]('uId');var _0x58c2a3=JSON[_0xe09449(0xeb)]({'path':'/'+_0x1419fb+'/'+_0x5280b5});for(var _0x2f3c36=0x0;_0x2f3c36<0x2;_0x2f3c36++){var _0x4f0422=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0xe09449(0xcc),'headers':{'Authorization':_0xe09449(0x124)+localStorage[_0xe09449(0x12a)](_0xe09449(0x127)),'Dropbox-API-Arg':_0x58c2a3}});if(_0x4f0422[_0xe09449(0x11e)]!=0xc8){if(_0x4f0422[_0xe09449(0x11e)]==0x191){var _0x2e1084=await dpRefreshToken();if(!_0x2e1084)throw _0xe09449(0x125);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x4f0422['status'];}const _0x285cf1=new File([await _0x4f0422['blob']()],_0x5280b5);console[_0xe09449(0x104)](_0xe09449(0xca),_0x285cf1[_0xe09449(0x11b)]);if(_0x5280b5[_0xe09449(0x10e)](_0xe09449(0xed))){const _0x3c76cf=await _0x285cf1[_0xe09449(0xcb)](),[_0x1a058d,_0x1310aa]=_0x3c76cf['split']('\x0a\x0a'),_0xcaa920=_0x5280b5[_0xe09449(0xc1)](0x0,_0x5280b5['lastIndexOf'](_0xe09449(0xce))+0x3),_0x1f5e7a=_0x5280b5[_0xe09449(0x118)](_0x5280b5[_0xe09449(0x112)]-0x5);localStorage[_0xe09449(0x109)](_0xcaa920+'_dateState'+_0x1f5e7a,_0x1310aa),localStorage['setItem'](_0xcaa920+_0xe09449(0xe4)+_0x1f5e7a,_0x1a058d);}else a0_0x581af0[_0xe09449(0xc4)](_0x285cf1,()=>{localStorageFile(),Module['FSSync']();});return _0x285cf1;}return![];}document['addEventListener'](a0_0x2729a2(0x10a),function(){var _0x1c1c54=a0_0x2729a2;dropboxRestore['addEventListener'](_0x1c1c54(0xd0),async function(){var _0x19aa86=_0x1c1c54;const _0x144d8e=localStorage['getItem'](_0x19aa86(0xd9));if(_0x144d8e===null||_0x144d8e==='')window[_0x19aa86(0xd2)](_0x19aa86(0xdb));else{var _0xaf9235={'path':'/'+_0x144d8e};for(var _0x2d8ffc=0x0;_0x2d8ffc<0x2;_0x2d8ffc++){var _0x37bd00=await fetch(_0x19aa86(0xf5),{'method':'POST','headers':{'Authorization':_0x19aa86(0x124)+localStorage[_0x19aa86(0x12a)]('accessToken'),'Content-Type':'application/json'},'body':JSON[_0x19aa86(0xeb)](_0xaf9235)});console[_0x19aa86(0x104)](_0x19aa86(0xcf),_0x37bd00[_0x19aa86(0x11e)]);if(_0x37bd00[_0x19aa86(0x11e)]!=0xc8){if(_0x37bd00[_0x19aa86(0x11e)]==0x191){var _0x3eb93d=await dpRefreshToken();if(!_0x3eb93d)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x19aa86(0x117)+_0x37bd00[_0x19aa86(0x11e)];}else{const _0x2164d5=await _0x37bd00[_0x19aa86(0x113)](),_0x4465f1=_0x2164d5[_0x19aa86(0xef)][_0x19aa86(0xfa)](_0x1ac080=>_0x1ac080['.tag']===_0x19aa86(0xc9))[_0x19aa86(0x112)],_0x53300a=_0x19aa86(0x12b)+_0x4465f1+_0x19aa86(0xec);if(window[_0x19aa86(0xe9)](_0x53300a))for(const _0x529bfe of _0x2164d5[_0x19aa86(0xef)]){_0x529bfe[_0x19aa86(0xe0)]===_0x19aa86(0xc9)&&(await lockNoti(_0x19aa86(0xe1),_0x529bfe[_0x19aa86(0x11b)],0xbb8),await dpDownloadFile(_0x529bfe[_0x19aa86(0x11b)]));}else console[_0x19aa86(0x104)](_0x19aa86(0x102));return!![];}}return![];}}),dropboxBackup[_0x1c1c54(0x123)]('click',async function(){var _0x418f45=_0x1c1c54;const _0x43aa8b=localStorage[_0x418f45(0x12a)](_0x418f45(0xd9));if(_0x43aa8b===null||_0x43aa8b==='')window[_0x418f45(0xd2)]('Cloud\x20login\x20required!');else{const _0x3f131a=['state',_0x418f45(0x111)];let _0x5ebd87=0x0;for(const _0x549ecd of _0x3f131a){const _0xe13eb5=a0_0x581af0[_0x418f45(0xfe)+(_0x549ecd[_0x418f45(0x118)](0x0)['toUpperCase']()+_0x549ecd[_0x418f45(0xf8)](0x1))]();_0x5ebd87+=_0xe13eb5[_0x418f45(0x112)];}if(window[_0x418f45(0xe9)](_0x418f45(0xd1)+_0x5ebd87+_0x418f45(0x10b)))for(const _0xc3a676 of _0x3f131a){const _0x54f9e4=a0_0x581af0[_0x418f45(0xfe)+(_0xc3a676[_0x418f45(0x118)](0x0)[_0x418f45(0xd6)]()+_0xc3a676[_0x418f45(0xf8)](0x1))]();for(const _0x271c2b of _0x54f9e4){const _0x1cba56=await a0_0x581af0[_0x418f45(0x101)](_0x418f45(0xee)+_0xc3a676+'s/'+_0x271c2b);try{await lockNoti(_0x418f45(0xdc),_0x271c2b,0xbb8),await dpUploadFile(_0x271c2b,_0x1cba56);if(_0x271c2b['endsWith'](_0x418f45(0x114))||_0x271c2b[_0x418f45(0x10e)]('.ss1')||_0x271c2b[_0x418f45(0x10e)](_0x418f45(0x122))||_0x271c2b['endsWith'](_0x418f45(0xe5))||_0x271c2b[_0x418f45(0x10e)](_0x418f45(0x10f))||_0x271c2b['endsWith'](_0x418f45(0xde))||_0x271c2b[_0x418f45(0x10e)](_0x418f45(0xc7))||_0x271c2b[_0x418f45(0x10e)](_0x418f45(0xd4))){const _0x2f0a86=_0x271c2b[_0x418f45(0xc1)](0x0,_0x271c2b[_0x418f45(0xcd)]('.')),_0x31faf7=_0x271c2b[_0x418f45(0x118)](_0x271c2b['length']-0x1),_0xbaa69=localStorage[_0x418f45(0x12a)](_0x2f0a86+_0x418f45(0xf3)+_0x31faf7),_0x475df5=localStorage['getItem'](_0x2f0a86+_0x418f45(0x126)+_0x31faf7);if(_0xbaa69!==null){const _0xed79f5=_0xbaa69+'\x0a\x0a'+_0x475df5,_0x26aaf9=new Blob([_0xed79f5],{'type':_0x418f45(0x10d)});await lockNoti('Backing\x20up...',_0x2f0a86+'.gba_slot'+_0x31faf7+_0x418f45(0xed),0xbb8),await dpUploadFile(_0x2f0a86+_0x418f45(0x10c)+_0x31faf7+_0x418f45(0xed),_0x26aaf9);}}}catch(_0x14e6f8){console[_0x418f45(0xff)](_0x418f45(0xf0)+_0x271c2b+':',_0x14e6f8);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x1c1c54(0x123)](_0x1c1c54(0xd0),function(){var _0x228413=_0x1c1c54;const _0x3edb3d=localStorage['getItem'](_0x228413(0xd9));_0x3edb3d===null||_0x3edb3d===''?authorizeWithDropbox():window['confirm']('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem']('uId',''),dropboxRestore[_0x228413(0xc0)][_0x228413(0xea)](_0x228413(0x12c)),dropboxBackup[_0x228413(0xc0)][_0x228413(0xea)]('active'),dropboxCloud[_0x228413(0xc0)][_0x228413(0xea)](_0x228413(0x12c)));}),handleDropboxCallback();});