var a0_0x5e97b3=a0_0x2beb;(function(_0x25fba3,_0x12e47e){var _0x3eb7db=a0_0x2beb,_0x58df89=_0x25fba3();while(!![]){try{var _0xd3ed3=parseInt(_0x3eb7db(0x1b3))/0x1*(-parseInt(_0x3eb7db(0x198))/0x2)+-parseInt(_0x3eb7db(0x19d))/0x3+parseInt(_0x3eb7db(0x1a7))/0x4*(parseInt(_0x3eb7db(0x180))/0x5)+parseInt(_0x3eb7db(0x1b1))/0x6*(-parseInt(_0x3eb7db(0x1c0))/0x7)+-parseInt(_0x3eb7db(0x1c6))/0x8+parseInt(_0x3eb7db(0x17d))/0x9*(-parseInt(_0x3eb7db(0x1d8))/0xa)+parseInt(_0x3eb7db(0x19b))/0xb*(parseInt(_0x3eb7db(0x1c3))/0xc);if(_0xd3ed3===_0x12e47e)break;else _0x58df89['push'](_0x58df89['shift']());}catch(_0x3f23d8){_0x58df89['push'](_0x58df89['shift']());}}}(a0_0x8d13,0x64a9a));import*as a0_0x5b0cf4 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x5e97b3(0x1bb),clientSecret=a0_0x5e97b3(0x1ca);function authorizeWithDropbox(){var _0x12004d=a0_0x5e97b3,_0x1e81c2=window['location'][_0x12004d(0x1a3)][_0x12004d(0x17e)]('?')[0x0],_0x562216='code',_0x25eece=_0x12004d(0x188),_0x14f0a2=_0x12004d(0x1d0)+clientId+_0x12004d(0x1d7)+_0x562216+_0x12004d(0x1c7)+_0x25eece+_0x12004d(0x195)+encodeURIComponent(_0x1e81c2);window['location'][_0x12004d(0x1a3)]=_0x14f0a2;}function handleDropboxCallback(){var _0x434797=a0_0x5e97b3,_0x2efce0=getUrlParameter('code');_0x2efce0?(getAccessToken(_0x2efce0),console[_0x434797(0x1da)]('Authorization\x20Code:',_0x2efce0)):console['log'](_0x434797(0x172));}function getUrlParameter(_0xf82071){var _0x13dbde=a0_0x5e97b3;_0xf82071=_0xf82071['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x32bf36=new RegExp('[\x5c?&#]'+_0xf82071+_0x13dbde(0x19e)),_0x3e2f2e=_0x32bf36[_0x13dbde(0x178)](location[_0x13dbde(0x1d4)]);return _0x3e2f2e===null?'':decodeURIComponent(_0x3e2f2e[0x1][_0x13dbde(0x181)](/\+/g,'\x20'));}function a0_0x8d13(){var _0x1094d2=['save','log','&client_secret=','Unable\x20to\x20refresh\x20token','.ss4','.ss3','.ss1','/data/','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Do\x20not\x20receive\x20authorization','state','toUpperCase','gba','POST','charAt','exec','uploadSaveOrSaveState','Do\x20you\x20want\x20to\x20restore\x20','setRequestHeader','parse','1055421KqqxxB','split','Do\x20you\x20want\x20to\x20logout?','305AMlyXf','replace','overwrite','addEventListener','setItem','.tag','location','Upload\x20failed,\x20unknown\x20http\x20status:\x20','offline','name','error','accessToken','Download\x20failed,\x20unknown\x20http\x20status:','downloadFileInCloud','https://content.dropboxapi.com/2/files/download','slice','application/json','Kabu\x20storage\x20↦\x20Cloud\x20◆','click','alert','substring','&redirect_uri=','Failed\x20to\x20refresh\x20Dropbox\x20token.','.ss0','6936yysjyd','Cloud\x20login\x20required!','DOMContentLoaded','11vNyPXE','file','916683vDPScU','=([^&#]*)','.ss5','endsWith','.gba_imageState','uId','href','entries','refresh_token=','Backing\x20up...','53168zHxVgJ','lastIndexOf','Bearer\x20','application/x-www-form-urlencoded','classList','https://api.dropboxapi.com/oauth2/token','confirm','Content-Type','responseText','application/octet-stream','12GDGVOo','blob','94fLYsyI','length','remove','.gba_slot','list','\x20files\x20in\x20Kabu?','.gba_dateState','.txt','knh3uz2mx2hp2eu','No\x20refresh\x20token','authorization_code','text','.ss2','367031swofwS','Restoring...','getItem','16888332tLxqbX','https://api.dropbox.com/oauth2/token','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','2926608zfRfnL','&token_access_type=','&grant_type=','json','nwb3dnfh09rhs31','status','active','Cloud\x20↦\x20Kabu\x20storage\x20◆','access_token','Do\x20you\x20want\x20to\x20backup\x20','https://www.dropbox.com/oauth2/authorize?client_id=','https://api.dropboxapi.com/2/files/list_folder','stringify','refreshToken','search','https://content.dropboxapi.com/2/files/upload','error_description','&response_type=','60iuYfol'];a0_0x8d13=function(){return _0x1094d2;};return a0_0x8d13();}function getAccessToken(_0x25b6b4){var _0x4b5a01=a0_0x5e97b3,_0x5c438e=_0x4b5a01(0x1bd),_0x40153f=window[_0x4b5a01(0x186)][_0x4b5a01(0x1a3)][_0x4b5a01(0x17e)]('?')[0x0],_0xb74e9d=new XMLHttpRequest();_0xb74e9d['open'](_0x4b5a01(0x176),_0x4b5a01(0x1c4)),_0xb74e9d[_0x4b5a01(0x17b)](_0x4b5a01(0x1ae),_0x4b5a01(0x1aa)),_0xb74e9d['onload']=function(){var _0x141e3e=_0x4b5a01;if(_0xb74e9d[_0x141e3e(0x1cb)]===0xc8){var _0x37c877=JSON[_0x141e3e(0x17c)](_0xb74e9d[_0x141e3e(0x1af)]),_0x46756c=_0x37c877['access_token'],_0x129f2b=_0x37c877['refresh_token'],_0x2070d0=_0x37c877['uid'];localStorage[_0x141e3e(0x184)](_0x141e3e(0x18b),_0x46756c),localStorage['setItem']('refreshToken',_0x129f2b),localStorage[_0x141e3e(0x184)]('uId',_0x2070d0);}else console['log'](_0x141e3e(0x1c5));},_0xb74e9d['send']('code='+_0x25b6b4+_0x4b5a01(0x1c8)+_0x5c438e+'&client_id='+clientId+_0x4b5a01(0x1db)+clientSecret+_0x4b5a01(0x195)+encodeURIComponent(_0x40153f));}export async function dpRefreshToken(){var _0x491717=a0_0x5e97b3;if(!localStorage[_0x491717(0x1c2)](_0x491717(0x1d3)))throw _0x491717(0x1bc);try{const _0x5bfa98=await fetch(_0x491717(0x1ac),{'method':_0x491717(0x176),'headers':{'Content-Type':_0x491717(0x1aa)},'body':_0x491717(0x1a5)+localStorage['getItem'](_0x491717(0x1d3))+_0x491717(0x1e1)}),_0xde96f6=await _0x5bfa98['json']();if(!_0xde96f6[_0x491717(0x18a)])return localStorage[_0x491717(0x184)]('accessToken',_0xde96f6[_0x491717(0x1ce)]),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0xde96f6[_0x491717(0x1d6)]||_0x491717(0x196));}catch(_0x34b0ba){console[_0x491717(0x18a)]('Error\x20while\x20refreshing\x20token:',_0x34b0ba);}return![];}export async function dpUploadFile(_0x2310f7,_0x22878a){var _0x7168e7=a0_0x5e97b3;const _0x1381f2=localStorage[_0x7168e7(0x1c2)](_0x7168e7(0x1a2));var _0xead62d=JSON['stringify']({'autorename':!![],'mode':_0x7168e7(0x182),'mute':!![],'strict_conflict':![],'path':'/'+_0x1381f2+'/'+_0x2310f7}),_0x442c75=new Blob([_0x22878a],{'type':_0x7168e7(0x1b0)});for(var _0x4d7908=0x0;_0x4d7908<0x2;_0x4d7908++){var _0x585fc9=await fetch(_0x7168e7(0x1d5),{'method':_0x7168e7(0x176),'headers':{'Authorization':_0x7168e7(0x1a9)+localStorage[_0x7168e7(0x1c2)]('accessToken'),'Dropbox-API-Arg':_0xead62d,'Content-Type':_0x7168e7(0x1b0)},'body':_0x442c75});if(_0x585fc9[_0x7168e7(0x1cb)]!=0xc8){if(_0x585fc9[_0x7168e7(0x1cb)]==0x191){var _0x361846=await dpRefreshToken();if(!_0x361846)throw _0x7168e7(0x1dc);continue;}else throw _0x7168e7(0x187)+_0x585fc9['status'];}else{var _0x134e04=await _0x585fc9[_0x7168e7(0x1c9)]();return console['log'](_0x7168e7(0x191),_0x2310f7),_0x134e04;}}return![];}function a0_0x2beb(_0x778b18,_0x44c3b3){var _0x8d1383=a0_0x8d13();return a0_0x2beb=function(_0x2beb85,_0x50b9fd){_0x2beb85=_0x2beb85-0x172;var _0x14a95b=_0x8d1383[_0x2beb85];return _0x14a95b;},a0_0x2beb(_0x778b18,_0x44c3b3);}async function dpDownloadFile(_0x49efe9){var _0x33988a=a0_0x5e97b3;const _0x16a71e=localStorage['getItem'](_0x33988a(0x1a2));var _0xdb3d95=JSON['stringify']({'path':'/'+_0x16a71e+'/'+_0x49efe9});for(var _0x1343a6=0x0;_0x1343a6<0x2;_0x1343a6++){var _0x59f790=await fetch(_0x33988a(0x18e),{'method':_0x33988a(0x176),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x33988a(0x1c2)]('accessToken'),'Dropbox-API-Arg':_0xdb3d95}});if(_0x59f790['status']!=0xc8){if(_0x59f790[_0x33988a(0x1cb)]==0x191){var _0x1322bd=await dpRefreshToken();if(!_0x1322bd)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x33988a(0x18c)+_0x59f790[_0x33988a(0x1cb)];}const _0x4f2323=new File([await _0x59f790[_0x33988a(0x1b2)]()],_0x49efe9);console[_0x33988a(0x1da)](_0x33988a(0x1cd),_0x4f2323[_0x33988a(0x189)]);if(_0x49efe9['endsWith']('.txt')){const _0x2d8e6a=await _0x4f2323[_0x33988a(0x1be)](),[_0x45fa2a,_0x2ccda0]=_0x2d8e6a[_0x33988a(0x17e)]('\x0a\x0a'),_0x55ba8c=_0x49efe9[_0x33988a(0x194)](0x0,_0x49efe9['lastIndexOf'](_0x33988a(0x175))+0x3),_0xa15319=_0x49efe9[_0x33988a(0x177)](_0x49efe9[_0x33988a(0x1b4)]-0x5);localStorage[_0x33988a(0x184)](_0x55ba8c+'_dateState'+_0xa15319,_0x2ccda0),localStorage['setItem'](_0x55ba8c+'_imageState'+_0xa15319,_0x45fa2a);}else a0_0x5b0cf4[_0x33988a(0x179)](_0x4f2323,()=>{localStorageFile(),Module['FSSync']();});return _0x4f2323;}return![];}document[a0_0x5e97b3(0x183)](a0_0x5e97b3(0x19a),function(){var _0xe20c48=a0_0x5e97b3;dropboxRestore[_0xe20c48(0x183)](_0xe20c48(0x192),async function(){var _0x46430d=_0xe20c48;const _0x511dae=localStorage['getItem']('uId');if(_0x511dae===null||_0x511dae==='')window[_0x46430d(0x193)](_0x46430d(0x199));else{var _0x75fac9={'path':'/'+_0x511dae};for(var _0x2fc69a=0x0;_0x2fc69a<0x2;_0x2fc69a++){var _0x1ddfcc=await fetch(_0x46430d(0x1d1),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x46430d(0x1c2)](_0x46430d(0x18b)),'Content-Type':_0x46430d(0x190)},'body':JSON[_0x46430d(0x1d2)](_0x75fac9)});console[_0x46430d(0x1da)]('status:\x20',_0x1ddfcc[_0x46430d(0x1cb)]);if(_0x1ddfcc[_0x46430d(0x1cb)]!=0xc8){if(_0x1ddfcc[_0x46430d(0x1cb)]==0x191){var _0x36e0=await dpRefreshToken();if(!_0x36e0)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:\x20'+_0x1ddfcc[_0x46430d(0x1cb)];}else{const _0x3283aa=await _0x1ddfcc[_0x46430d(0x1c9)](),_0x5c62cb=_0x3283aa['entries']['filter'](_0x3024fd=>_0x3024fd[_0x46430d(0x185)]===_0x46430d(0x19c))['length'],_0xa15c10=_0x46430d(0x17a)+_0x5c62cb+'\x20files\x20in\x20Cloud?';if(window[_0x46430d(0x1ad)](_0xa15c10))for(const _0x1eee8b of _0x3283aa[_0x46430d(0x1a4)]){_0x1eee8b['.tag']===_0x46430d(0x19c)&&(await lockNoti(_0x46430d(0x1c1),_0x1eee8b[_0x46430d(0x189)],0xbb8),await dpDownloadFile(_0x1eee8b['name']));}else console[_0x46430d(0x1da)]('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup['addEventListener'](_0xe20c48(0x192),async function(){var _0x49e815=_0xe20c48;const _0x202dee=localStorage[_0x49e815(0x1c2)](_0x49e815(0x1a2));if(_0x202dee===null||_0x202dee==='')window[_0x49e815(0x193)](_0x49e815(0x199));else{const _0x562389=[_0x49e815(0x173),_0x49e815(0x1d9)];let _0x167042=0x0;for(const _0x1cd752 of _0x562389){const _0x349cdf=a0_0x5b0cf4[_0x49e815(0x1b7)+(_0x1cd752[_0x49e815(0x177)](0x0)['toUpperCase']()+_0x1cd752['slice'](0x1))]();_0x167042+=_0x349cdf[_0x49e815(0x1b4)];}if(window['confirm'](_0x49e815(0x1cf)+_0x167042+_0x49e815(0x1b8)))for(const _0x1034d2 of _0x562389){const _0x2e71ef=a0_0x5b0cf4['list'+(_0x1034d2[_0x49e815(0x177)](0x0)[_0x49e815(0x174)]()+_0x1034d2[_0x49e815(0x18f)](0x1))]();for(const _0x48e638 of _0x2e71ef){const _0x2955f8=await a0_0x5b0cf4[_0x49e815(0x18d)](_0x49e815(0x1e0)+_0x1034d2+'s/'+_0x48e638);try{await lockNoti(_0x49e815(0x1a6),_0x48e638,0xbb8),await dpUploadFile(_0x48e638,_0x2955f8);if(_0x48e638[_0x49e815(0x1a0)](_0x49e815(0x197))||_0x48e638['endsWith'](_0x49e815(0x1df))||_0x48e638[_0x49e815(0x1a0)](_0x49e815(0x1bf))||_0x48e638['endsWith'](_0x49e815(0x1de))||_0x48e638[_0x49e815(0x1a0)](_0x49e815(0x1dd))||_0x48e638['endsWith'](_0x49e815(0x19f))||_0x48e638[_0x49e815(0x1a0)]('.ss6')||_0x48e638[_0x49e815(0x1a0)]('.ss7')){const _0x51e64a=_0x48e638[_0x49e815(0x194)](0x0,_0x48e638[_0x49e815(0x1a8)]('.')),_0x228ca1=_0x48e638[_0x49e815(0x177)](_0x48e638['length']-0x1),_0x5651de=localStorage[_0x49e815(0x1c2)](_0x51e64a+_0x49e815(0x1a1)+_0x228ca1),_0x2a4f12=localStorage[_0x49e815(0x1c2)](_0x51e64a+_0x49e815(0x1b9)+_0x228ca1);if(_0x5651de!==null){const _0x54041b=_0x5651de+'\x0a\x0a'+_0x2a4f12,_0x2a6f7d=new Blob([_0x54041b],{'type':'text/plain'});await lockNoti(_0x49e815(0x1a6),_0x51e64a+'.gba_slot'+_0x228ca1+_0x49e815(0x1ba),0xbb8),await dpUploadFile(_0x51e64a+_0x49e815(0x1b6)+_0x228ca1+_0x49e815(0x1ba),_0x2a6f7d);}}}catch(_0x5b6ebf){console['error']('Failed\x20to\x20upload\x20file\x20'+_0x48e638+':',_0x5b6ebf);}}}else console[_0x49e815(0x1da)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0xe20c48(0x183)](_0xe20c48(0x192),function(){var _0x1b7901=_0xe20c48;const _0x3b5785=localStorage[_0x1b7901(0x1c2)]('uId');_0x3b5785===null||_0x3b5785===''?authorizeWithDropbox():window[_0x1b7901(0x1ad)](_0x1b7901(0x17f))&&(localStorage[_0x1b7901(0x184)](_0x1b7901(0x1a2),''),dropboxRestore[_0x1b7901(0x1ab)]['remove'](_0x1b7901(0x1cc)),dropboxBackup['classList'][_0x1b7901(0x1b5)]('active'),dropboxCloud[_0x1b7901(0x1ab)][_0x1b7901(0x1b5)]('active'));}),handleDropboxCallback();});