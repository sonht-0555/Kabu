var a0_0x51b0de=a0_0x2fa0;(function(_0x1064ce,_0x12e9e0){var _0xdefd8a=a0_0x2fa0,_0x3d3553=_0x1064ce();while(!![]){try{var _0x336019=-parseInt(_0xdefd8a(0x8a))/0x1*(-parseInt(_0xdefd8a(0xbe))/0x2)+parseInt(_0xdefd8a(0xca))/0x3*(parseInt(_0xdefd8a(0xb7))/0x4)+-parseInt(_0xdefd8a(0x97))/0x5*(-parseInt(_0xdefd8a(0xcf))/0x6)+parseInt(_0xdefd8a(0xd7))/0x7*(-parseInt(_0xdefd8a(0x87))/0x8)+parseInt(_0xdefd8a(0x7f))/0x9+-parseInt(_0xdefd8a(0xda))/0xa*(-parseInt(_0xdefd8a(0x9c))/0xb)+-parseInt(_0xdefd8a(0xd9))/0xc;if(_0x336019===_0x12e9e0)break;else _0x3d3553['push'](_0x3d3553['shift']());}catch(_0x9d28f5){_0x3d3553['push'](_0x3d3553['shift']());}}}(a0_0xe0f0,0x8f0a5));import*as a0_0x238d75 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x51b0de(0x90),clientSecret=a0_0x51b0de(0x98);function authorizeWithDropbox(){var _0x340230=a0_0x51b0de,_0x4f1e92=window[_0x340230(0xd6)][_0x340230(0xc5)][_0x340230(0xb9)]('?')[0x0],_0x577a65='code',_0x26c839=_0x340230(0xd1),_0x5ec106=_0x340230(0x9d)+clientId+_0x340230(0x85)+_0x577a65+_0x340230(0x76)+_0x26c839+_0x340230(0xb8)+encodeURIComponent(_0x4f1e92);window[_0x340230(0xd6)][_0x340230(0xc5)]=_0x5ec106;}function handleDropboxCallback(){var _0x297bb6=a0_0x51b0de,_0x5a9259=getUrlParameter('code');_0x5a9259?(getAccessToken(_0x5a9259),console[_0x297bb6(0xc7)](_0x297bb6(0x9f),_0x5a9259)):console[_0x297bb6(0xc7)]('Do\x20not\x20receive\x20authorization');}function a0_0xe0f0(){var _0x5a9a21=['lastIndexOf','log','.ss2','uid','12KIZzAs','Restore\x20canceled\x20by\x20user.','Do\x20you\x20want\x20to\x20logout?','setItem','No\x20refresh\x20token','6hEEHWt','confirm','offline','.ss7','POST','Do\x20you\x20want\x20to\x20backup\x20','replace','location','203KYygiM','.ss6','21872340BsOANl','70860MycnxB','getItem','send','length','&token_access_type=','status:\x20','&grant_type=','[\x5c?&#]','.tag','Unable\x20to\x20refresh\x20token','Bearer\x20','/data/','_dateState','6934608Bttaan','open','access_token','blob','Backing\x20up...','Failed\x20to\x20upload\x20file\x20','&response_type=','Restoring...','150728tRxdno','alert','name','1Evbxoa','.ss1','status','&client_secret=','authorization_code','text','knh3uz2mx2hp2eu','Upload\x20failed,\x20unknown\x20http\x20status:\x20','text/plain','refresh_token=','refreshToken','uId','entries','416810JPkyPK','nwb3dnfh09rhs31','.gba_slot','remove','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','385SAQXVf','https://www.dropbox.com/oauth2/authorize?client_id=','file','Authorization\x20Code:','responseText','classList','accessToken','charAt','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','FSSync','active','search','exec','=([^&#]*)','addEventListener','application/json','DOMContentLoaded','.ss0','https://content.dropboxapi.com/2/files/upload','endsWith','.ss3','application/octet-stream','Error\x20while\x20refreshing\x20token:','\x20files\x20in\x20Cloud?','https://api.dropboxapi.com/2/files/list_folder','toUpperCase','Failed\x20to\x20refresh\x20Dropbox\x20token.','704732FULLOz','&redirect_uri=','split','_imageState','.txt','setRequestHeader','gba','2296722NqFTnb','.gba_imageState','downloadFileInCloud','filter','substring','click','onload','href'];a0_0xe0f0=function(){return _0x5a9a21;};return a0_0xe0f0();}function getUrlParameter(_0x5e7f7f){var _0x5d8dd2=a0_0x51b0de;_0x5e7f7f=_0x5e7f7f[_0x5d8dd2(0xd5)](/[\[]/,'\x5c[')[_0x5d8dd2(0xd5)](/[\]]/,'\x5c]');var _0x4614d3=new RegExp(_0x5d8dd2(0x79)+_0x5e7f7f+_0x5d8dd2(0xa9)),_0x538870=_0x4614d3[_0x5d8dd2(0xa8)](location[_0x5d8dd2(0xa7)]);return _0x538870===null?'':decodeURIComponent(_0x538870[0x1][_0x5d8dd2(0xd5)](/\+/g,'\x20'));}function getAccessToken(_0x3dd389){var _0x59e54c=a0_0x51b0de,_0x36834e=_0x59e54c(0x8e),_0x508703=window[_0x59e54c(0xd6)][_0x59e54c(0xc5)][_0x59e54c(0xb9)]('?')[0x0],_0x401b24=new XMLHttpRequest();_0x401b24[_0x59e54c(0x80)](_0x59e54c(0xd3),'https://api.dropbox.com/oauth2/token'),_0x401b24[_0x59e54c(0xbc)]('Content-Type','application/x-www-form-urlencoded'),_0x401b24[_0x59e54c(0xc4)]=function(){var _0x2ad8ab=_0x59e54c;if(_0x401b24[_0x2ad8ab(0x8c)]===0xc8){var _0x1d0886=JSON['parse'](_0x401b24[_0x2ad8ab(0xa0)]),_0x247f8b=_0x1d0886[_0x2ad8ab(0x81)],_0x528135=_0x1d0886['refresh_token'],_0x448048=_0x1d0886[_0x2ad8ab(0xc9)];localStorage[_0x2ad8ab(0xcd)](_0x2ad8ab(0xa2),_0x247f8b),localStorage[_0x2ad8ab(0xcd)](_0x2ad8ab(0x94),_0x528135),localStorage[_0x2ad8ab(0xcd)](_0x2ad8ab(0x95),_0x448048);}else console['log'](_0x2ad8ab(0x9b));},_0x401b24[_0x59e54c(0x74)]('code='+_0x3dd389+_0x59e54c(0x78)+_0x36834e+'&client_id='+clientId+_0x59e54c(0x8d)+clientSecret+_0x59e54c(0xb8)+encodeURIComponent(_0x508703));}function a0_0x2fa0(_0x1709af,_0x4bc1e1){var _0xe0f0f9=a0_0xe0f0();return a0_0x2fa0=function(_0x2fa056,_0x12d477){_0x2fa056=_0x2fa056-0x73;var _0x3f6a8b=_0xe0f0f9[_0x2fa056];return _0x3f6a8b;},a0_0x2fa0(_0x1709af,_0x4bc1e1);}export async function dpRefreshToken(){var _0x56bb7c=a0_0x51b0de;if(!localStorage['getItem'](_0x56bb7c(0x94)))throw _0x56bb7c(0xce);try{const _0x7a3a76=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x56bb7c(0xd3),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x56bb7c(0x93)+localStorage['getItem'](_0x56bb7c(0x94))+_0x56bb7c(0xa4)}),_0xad0700=await _0x7a3a76['json']();if(!_0xad0700['error'])return localStorage['setItem'](_0x56bb7c(0xa2),_0xad0700[_0x56bb7c(0x81)]),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0xad0700['error_description']||_0x56bb7c(0xb6));}catch(_0x21a75a){console['error'](_0x56bb7c(0xb2),_0x21a75a);}return![];}export async function dpUploadFile(_0x4a0ab0,_0x711e8e){var _0x162eb3=a0_0x51b0de;const _0xa4fa21=localStorage['getItem'](_0x162eb3(0x95));var _0x3f893c=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0xa4fa21+'/'+_0x4a0ab0}),_0x5a790f=new Blob([_0x711e8e],{'type':_0x162eb3(0xb1)});for(var _0x12ec84=0x0;_0x12ec84<0x2;_0x12ec84++){var _0x114f3f=await fetch(_0x162eb3(0xae),{'method':_0x162eb3(0xd3),'headers':{'Authorization':_0x162eb3(0x7c)+localStorage[_0x162eb3(0x73)](_0x162eb3(0xa2)),'Dropbox-API-Arg':_0x3f893c,'Content-Type':_0x162eb3(0xb1)},'body':_0x5a790f});if(_0x114f3f['status']!=0xc8){if(_0x114f3f[_0x162eb3(0x8c)]==0x191){var _0x2c15ff=await dpRefreshToken();if(!_0x2c15ff)throw _0x162eb3(0x7b);continue;}else throw _0x162eb3(0x91)+_0x114f3f[_0x162eb3(0x8c)];}else{var _0x162ce3=await _0x114f3f['json']();return console[_0x162eb3(0xc7)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x4a0ab0),_0x162ce3;}}return![];}async function dpDownloadFile(_0x4a7c58){var _0x212d6d=a0_0x51b0de;const _0x126f0f=localStorage[_0x212d6d(0x73)](_0x212d6d(0x95));var _0xc1cde7=JSON['stringify']({'path':'/'+_0x126f0f+'/'+_0x4a7c58});for(var _0x502ebe=0x0;_0x502ebe<0x2;_0x502ebe++){var _0x4691da=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x212d6d(0xd3),'headers':{'Authorization':_0x212d6d(0x7c)+localStorage[_0x212d6d(0x73)]('accessToken'),'Dropbox-API-Arg':_0xc1cde7}});if(_0x4691da['status']!=0xc8){if(_0x4691da[_0x212d6d(0x8c)]==0x191){var _0x57613f=await dpRefreshToken();if(!_0x57613f)throw _0x212d6d(0x7b);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x4691da[_0x212d6d(0x8c)];}const _0x5bd10f=new File([await _0x4691da[_0x212d6d(0x82)]()],_0x4a7c58);console[_0x212d6d(0xc7)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x5bd10f[_0x212d6d(0x89)]);if(_0x4a7c58['endsWith'](_0x212d6d(0xbb))){const _0x546cd2=await _0x5bd10f[_0x212d6d(0x8f)](),[_0xf8c137,_0x3c116e]=_0x546cd2[_0x212d6d(0xb9)]('\x0a\x0a'),_0x143703=_0x4a7c58['substring'](0x0,_0x4a7c58[_0x212d6d(0xc6)](_0x212d6d(0xbd))+0x3),_0x43b3ad=_0x4a7c58[_0x212d6d(0xa3)](_0x4a7c58[_0x212d6d(0x75)]-0x5);localStorage[_0x212d6d(0xcd)](_0x143703+_0x212d6d(0x7e)+_0x43b3ad,_0x3c116e),localStorage['setItem'](_0x143703+_0x212d6d(0xba)+_0x43b3ad,_0xf8c137);}else a0_0x238d75['uploadSaveOrSaveState'](_0x5bd10f,()=>{var _0x56e738=_0x212d6d;localStorageFile(),Module[_0x56e738(0xa5)]();});return _0x5bd10f;}return![];}document[a0_0x51b0de(0xaa)](a0_0x51b0de(0xac),function(){var _0x54ae83=a0_0x51b0de;dropboxRestore['addEventListener'](_0x54ae83(0xc3),async function(){var _0x48cf53=_0x54ae83;const _0x4e4327=localStorage[_0x48cf53(0x73)](_0x48cf53(0x95));if(_0x4e4327===null||_0x4e4327==='')window['alert']('Cloud\x20login\x20required!');else{var _0x39edc2={'path':'/'+_0x4e4327};for(var _0x347280=0x0;_0x347280<0x2;_0x347280++){var _0x275383=await fetch(_0x48cf53(0xb4),{'method':_0x48cf53(0xd3),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x48cf53(0x73)](_0x48cf53(0xa2)),'Content-Type':_0x48cf53(0xab)},'body':JSON['stringify'](_0x39edc2)});console[_0x48cf53(0xc7)](_0x48cf53(0x77),_0x275383[_0x48cf53(0x8c)]);if(_0x275383[_0x48cf53(0x8c)]!=0xc8){if(_0x275383[_0x48cf53(0x8c)]==0x191){var _0x5ebfe1=await dpRefreshToken();if(!_0x5ebfe1)throw _0x48cf53(0x7b);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:\x20'+_0x275383[_0x48cf53(0x8c)];}else{const _0x4ae689=await _0x275383['json'](),_0x258149=_0x4ae689['entries'][_0x48cf53(0xc1)](_0x155eb2=>_0x155eb2[_0x48cf53(0x7a)]==='file')[_0x48cf53(0x75)],_0x5dd4b0='Do\x20you\x20want\x20to\x20restore\x20'+_0x258149+_0x48cf53(0xb3);if(window[_0x48cf53(0xd0)](_0x5dd4b0))for(const _0x237c38 of _0x4ae689[_0x48cf53(0x96)]){_0x237c38['.tag']===_0x48cf53(0x9e)&&(await lockNoti(_0x48cf53(0x86),_0x237c38[_0x48cf53(0x89)],0xbb8),await dpDownloadFile(_0x237c38[_0x48cf53(0x89)]));}else console[_0x48cf53(0xc7)](_0x48cf53(0xcb));return!![];}}return![];}}),dropboxBackup[_0x54ae83(0xaa)]('click',async function(){var _0x526d9d=_0x54ae83;const _0x555dd0=localStorage['getItem']('uId');if(_0x555dd0===null||_0x555dd0==='')window[_0x526d9d(0x88)]('Cloud\x20login\x20required!');else{const _0x12ae51=['state','save'];let _0x190439=0x0;for(const _0x3ae743 of _0x12ae51){const _0x49dcaa=a0_0x238d75['list'+(_0x3ae743[_0x526d9d(0xa3)](0x0)[_0x526d9d(0xb5)]()+_0x3ae743['slice'](0x1))]();_0x190439+=_0x49dcaa[_0x526d9d(0x75)];}if(window[_0x526d9d(0xd0)](_0x526d9d(0xd4)+_0x190439+'\x20files\x20in\x20Kabu?'))for(const _0x4ea94b of _0x12ae51){const _0x72adf7=a0_0x238d75['list'+(_0x4ea94b[_0x526d9d(0xa3)](0x0)[_0x526d9d(0xb5)]()+_0x4ea94b['slice'](0x1))]();for(const _0x34a206 of _0x72adf7){const _0x1c6887=await a0_0x238d75[_0x526d9d(0xc0)](_0x526d9d(0x7d)+_0x4ea94b+'s/'+_0x34a206);try{await lockNoti(_0x526d9d(0x83),_0x34a206,0xbb8),await dpUploadFile(_0x34a206,_0x1c6887);if(_0x34a206[_0x526d9d(0xaf)](_0x526d9d(0xad))||_0x34a206[_0x526d9d(0xaf)](_0x526d9d(0x8b))||_0x34a206[_0x526d9d(0xaf)](_0x526d9d(0xc8))||_0x34a206[_0x526d9d(0xaf)](_0x526d9d(0xb0))||_0x34a206[_0x526d9d(0xaf)]('.ss4')||_0x34a206[_0x526d9d(0xaf)]('.ss5')||_0x34a206[_0x526d9d(0xaf)](_0x526d9d(0xd8))||_0x34a206[_0x526d9d(0xaf)](_0x526d9d(0xd2))){const _0x285738=_0x34a206[_0x526d9d(0xc2)](0x0,_0x34a206[_0x526d9d(0xc6)]('.')),_0x1923e1=_0x34a206[_0x526d9d(0xa3)](_0x34a206[_0x526d9d(0x75)]-0x1),_0x10168b=localStorage[_0x526d9d(0x73)](_0x285738+_0x526d9d(0xbf)+_0x1923e1),_0x313abf=localStorage[_0x526d9d(0x73)](_0x285738+'.gba_dateState'+_0x1923e1);if(_0x10168b!==null){const _0x5330cf=_0x10168b+'\x0a\x0a'+_0x313abf,_0xad1145=new Blob([_0x5330cf],{'type':_0x526d9d(0x92)});await lockNoti(_0x526d9d(0x83),_0x285738+'.gba_slot'+_0x1923e1+_0x526d9d(0xbb),0xbb8),await dpUploadFile(_0x285738+_0x526d9d(0x99)+_0x1923e1+'.txt',_0xad1145);}}}catch(_0x3a488b){console['error'](_0x526d9d(0x84)+_0x34a206+':',_0x3a488b);}}}else console[_0x526d9d(0xc7)](_0x526d9d(0xcb));}}),dropboxCloud[_0x54ae83(0xaa)](_0x54ae83(0xc3),function(){var _0x570ece=_0x54ae83;const _0x47b0f9=localStorage[_0x570ece(0x73)](_0x570ece(0x95));_0x47b0f9===null||_0x47b0f9===''?authorizeWithDropbox():window[_0x570ece(0xd0)](_0x570ece(0xcc))&&(localStorage['setItem']('uId',''),dropboxRestore[_0x570ece(0xa1)][_0x570ece(0x9a)](_0x570ece(0xa6)),dropboxBackup[_0x570ece(0xa1)][_0x570ece(0x9a)](_0x570ece(0xa6)),dropboxCloud[_0x570ece(0xa1)][_0x570ece(0x9a)](_0x570ece(0xa6)));}),handleDropboxCallback();});