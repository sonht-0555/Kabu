var a0_0x15ca36=a0_0x6647;function a0_0x2f92(){var _0x407cf8=['open',',\x20status:\x20','downloadFileInCloud','&grant_type=','No\x20files\x20found\x20to\x20restore.','alert','3EdowcB','exec','send','.tag','5sttDho','8203zwZzXC','overwrite','&client_id=','Content-Type','push','setItem','code=','6586554OLctdB','12869510BnrhcH','split','Error\x20creating\x20folder\x20','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','&client_secret=','addEventListener','Bearer\x20','remove','\x20files\x20from\x20Cloud?','&token_access_type=','code','click','active','length','Cloud\x20↦\x20Kabu\x20storage\x20◆','href','stringify','260dTuaqU','&redirect_uri=','status','Do\x20not\x20receive\x20authorization','Do\x20you\x20want\x20to\x20restore\x20','Cloud\x20login\x20required!','931288fpSaYH','Download\x20failed\x20for\x20','https://api.dropboxapi.com/2/files/list_folder','nwb3dnfh09rhs31','save','onload','Download\x20failed,\x20unknown\x20http\x20status:','uploadFileInCloud','117OWRrWS','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Folder\x20created','https://www.dropbox.com/oauth2/authorize?client_id=','entries','Folder\x20already\x20exists','parse','[\x5c?&#]','refreshToken','knh3uz2mx2hp2eu','refresh_token','Failed\x20to\x20upload\x20file\x20','/data/','1866892efJHvv','Do\x20you\x20want\x20to\x20logout?','application/x-www-form-urlencoded','https://content.dropboxapi.com/2/files/upload','Refreshing\x20token...','Restore\x20canceled\x20by\x20user.','POST','application/octet-stream','replace','Wait\x20a\x20little\x20bit...','10389603FgjKNh','Do\x20you\x20want\x20to\x20backup\x20','listFiles','application/json','uId','state','Restoring...','access_token','authorization_code','=([^&#]*)','https://api.dropbox.com/oauth2/token','Upload\x20failed,\x20unknown\x20http\x20status:\x20','folder','offline','No\x20refresh\x20token','location','refresh_token=','name','json','classList','error','38958667uYqQpX','log','Failed\x20to\x20refresh\x20Dropbox\x20token.','setRequestHeader','confirm','Backing\x20up...','Unable\x20to\x20refresh\x20token','getItem','uid','accessToken'];a0_0x2f92=function(){return _0x407cf8;};return a0_0x2f92();}(function(_0x3643ce,_0x1736c6){var _0x2e75c7=a0_0x6647,_0x51ff20=_0x3643ce();while(!![]){try{var _0x3a7fa8=parseInt(_0x2e75c7(0x129))/0x1*(parseInt(_0x2e75c7(0x142))/0x2)+parseInt(_0x2e75c7(0x124))/0x3*(parseInt(_0x2e75c7(0x15d))/0x4)+-parseInt(_0x2e75c7(0x128))/0x5*(-parseInt(_0x2e75c7(0x130))/0x6)+parseInt(_0x2e75c7(0x167))/0x7+parseInt(_0x2e75c7(0x148))/0x8*(parseInt(_0x2e75c7(0x150))/0x9)+-parseInt(_0x2e75c7(0x131))/0xa+-parseInt(_0x2e75c7(0x114))/0xb;if(_0x3a7fa8===_0x1736c6)break;else _0x51ff20['push'](_0x51ff20['shift']());}catch(_0x319f23){_0x51ff20['push'](_0x51ff20['shift']());}}}(a0_0x2f92,0xc3434));import*as a0_0x3f7dcb from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x15ca36(0x159),clientSecret=a0_0x15ca36(0x14b);function a0_0x6647(_0x1bfeb8,_0x1d48f2){var _0x2f92f5=a0_0x2f92();return a0_0x6647=function(_0x6647ea,_0x3eceb2){_0x6647ea=_0x6647ea-0x114;var _0x412ce5=_0x2f92f5[_0x6647ea];return _0x412ce5;},a0_0x6647(_0x1bfeb8,_0x1d48f2);}function authorizeWithDropbox(){var _0x467a79=a0_0x15ca36,_0x2371ea=window[_0x467a79(0x176)][_0x467a79(0x140)][_0x467a79(0x132)]('?')[0x0],_0xe52acc=_0x467a79(0x13b),_0x58d9e8=_0x467a79(0x174),_0x131074=_0x467a79(0x153)+clientId+'&response_type='+_0xe52acc+_0x467a79(0x13a)+_0x58d9e8+_0x467a79(0x143)+encodeURIComponent(_0x2371ea);window[_0x467a79(0x176)][_0x467a79(0x140)]=_0x131074;}function handleDropboxCallback(){var _0x162221=a0_0x15ca36,_0x47c7b0=getUrlParameter(_0x162221(0x13b));_0x47c7b0?(getAccessToken(_0x47c7b0),console[_0x162221(0x115)]('Authorization\x20Code:',_0x47c7b0)):console[_0x162221(0x115)](_0x162221(0x145));}function getUrlParameter(_0x5ed475){var _0xc10008=a0_0x15ca36;_0x5ed475=_0x5ed475['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x1d42b5=new RegExp(_0xc10008(0x157)+_0x5ed475+_0xc10008(0x170)),_0x3f1daf=_0x1d42b5[_0xc10008(0x125)](location['search']);return _0x3f1daf===null?'':decodeURIComponent(_0x3f1daf[0x1][_0xc10008(0x165)](/\+/g,'\x20'));}function getAccessToken(_0x37cfb9){var _0x29eb06=a0_0x15ca36,_0x377764=_0x29eb06(0x16f),_0x480078=window[_0x29eb06(0x176)]['href'][_0x29eb06(0x132)]('?')[0x0],_0x110c55=new XMLHttpRequest();_0x110c55[_0x29eb06(0x11e)](_0x29eb06(0x163),_0x29eb06(0x171)),_0x110c55[_0x29eb06(0x117)](_0x29eb06(0x12c),_0x29eb06(0x15f)),_0x110c55[_0x29eb06(0x14d)]=function(){var _0x32b138=_0x29eb06;if(_0x110c55[_0x32b138(0x144)]===0xc8){var _0x265162=JSON[_0x32b138(0x156)](_0x110c55['responseText']),_0x546df2=_0x265162[_0x32b138(0x16e)],_0x3b7f5c=_0x265162[_0x32b138(0x15a)],_0x4c2b69=_0x265162[_0x32b138(0x11c)];localStorage[_0x32b138(0x12e)](_0x32b138(0x11d),_0x546df2),localStorage[_0x32b138(0x12e)]('refreshToken',_0x3b7f5c),localStorage[_0x32b138(0x12e)](_0x32b138(0x16b),_0x4c2b69);}else console[_0x32b138(0x115)](_0x32b138(0x151));},_0x110c55[_0x29eb06(0x126)](_0x29eb06(0x12f)+_0x37cfb9+_0x29eb06(0x121)+_0x377764+_0x29eb06(0x12b)+clientId+_0x29eb06(0x135)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x480078));}export async function dpCreateFolder(_0x500a25){var _0x417b50=a0_0x15ca36;const _0x3d6d27=localStorage['getItem'](_0x417b50(0x16b));let _0x1799d5=localStorage[_0x417b50(0x11b)](_0x417b50(0x11d));const _0x30f7f9='/'+_0x3d6d27+'/'+_0x500a25,_0x51c38e=JSON[_0x417b50(0x141)]({'path':_0x30f7f9,'autorename':![]});for(let _0x5c064a=0x0;_0x5c064a<0x2;_0x5c064a++){try{const _0x36f75f=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x417b50(0x163),'headers':{'Authorization':'Bearer\x20'+_0x1799d5,'Content-Type':_0x417b50(0x16a)},'body':_0x51c38e});if(_0x36f75f[_0x417b50(0x144)]===0x191){const _0x426dac=await dpRefreshToken();if(!_0x426dac)throw new Error(_0x417b50(0x11a));_0x1799d5=localStorage[_0x417b50(0x11b)](_0x417b50(0x11d));continue;}if(_0x36f75f[_0x417b50(0x144)]===0x199)return{'message':_0x417b50(0x155),'path':_0x500a25};if(!_0x36f75f['ok'])throw new Error(_0x417b50(0x133)+_0x500a25);const _0x1365fb=await _0x36f75f[_0x417b50(0x179)]();return await lockNoti(_0x417b50(0x152),'',0xbb8),_0x1365fb;}catch(_0x4935df){if(_0x5c064a===0x1)throw _0x4935df;}}return![];}export async function dpRefreshToken(){var _0x423bcf=a0_0x15ca36;if(!localStorage[_0x423bcf(0x11b)](_0x423bcf(0x158)))throw _0x423bcf(0x175);try{const _0x3dbe98=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x423bcf(0x163),'headers':{'Content-Type':_0x423bcf(0x15f)},'body':_0x423bcf(0x177)+localStorage[_0x423bcf(0x11b)](_0x423bcf(0x158))+_0x423bcf(0x134)}),_0x465244=await _0x3dbe98[_0x423bcf(0x179)]();if(!_0x465244['error'])return localStorage[_0x423bcf(0x12e)](_0x423bcf(0x11d),_0x465244[_0x423bcf(0x16e)]),await lockNoti(_0x423bcf(0x161),'',0xbb8),await delay(0x3e8),!![];else alert(_0x465244['error_description']||_0x423bcf(0x116));}catch(_0x33ebf9){console[_0x423bcf(0x17b)]('Error\x20while\x20refreshing\x20token:',_0x33ebf9);}return![];}export async function dpUploadFile(_0x1684c0,_0x3f9220,_0x404055){var _0xf9399b=a0_0x15ca36;const _0x1be3ca=localStorage[_0xf9399b(0x11b)](_0xf9399b(0x16b));var _0x539f89=JSON['stringify']({'autorename':!![],'mode':_0xf9399b(0x12a),'mute':!![],'strict_conflict':![],'path':'/'+_0x1be3ca+'/'+_0x404055+'/'+_0x1684c0}),_0x5c59fa=new Blob([_0x3f9220],{'type':'application/octet-stream'});for(var _0x258375=0x0;_0x258375<0x2;_0x258375++){var _0x391d83=await fetch(_0xf9399b(0x160),{'method':_0xf9399b(0x163),'headers':{'Authorization':_0xf9399b(0x137)+localStorage[_0xf9399b(0x11b)](_0xf9399b(0x11d)),'Dropbox-API-Arg':_0x539f89,'Content-Type':_0xf9399b(0x164)},'body':_0x5c59fa});if(_0x391d83['status']!=0xc8){if(_0x391d83[_0xf9399b(0x144)]==0x191){var _0x46d2f8=await dpRefreshToken();if(!_0x46d2f8)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0xf9399b(0x172)+_0x391d83[_0xf9399b(0x144)];}else{var _0x59e5f8=await _0x391d83[_0xf9399b(0x179)]();return console[_0xf9399b(0x115)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x1684c0),_0x59e5f8;}}return![];}export async function dpDownloadFile(_0x4bf025,_0x41488f){var _0x3247d7=a0_0x15ca36;const _0x5f0fef=localStorage[_0x3247d7(0x11b)](_0x3247d7(0x16b));var _0x152bc3=JSON[_0x3247d7(0x141)]({'path':'/'+_0x5f0fef+'/'+_0x41488f+'/'+_0x4bf025});for(var _0x351276=0x0;_0x351276<0x2;_0x351276++){var _0x1c7445=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x3247d7(0x163),'headers':{'Authorization':_0x3247d7(0x137)+localStorage[_0x3247d7(0x11b)](_0x3247d7(0x11d)),'Dropbox-API-Arg':_0x152bc3}});if(_0x1c7445[_0x3247d7(0x144)]!=0xc8){if(_0x1c7445[_0x3247d7(0x144)]==0x191){var _0x345a16=await dpRefreshToken();if(!_0x345a16)throw _0x3247d7(0x11a);continue;}else throw _0x3247d7(0x14e)+_0x1c7445[_0x3247d7(0x144)];}const _0x45ba7a=new File([await _0x1c7445['blob']()],_0x4bf025);return console[_0x3247d7(0x115)](_0x3247d7(0x13f),_0x45ba7a[_0x3247d7(0x178)]),a0_0x3f7dcb[_0x3247d7(0x14f)](_0x45ba7a,()=>{}),_0x45ba7a;}return![];}document['addEventListener']('DOMContentLoaded',function(){var _0x549dd1=a0_0x15ca36;dropboxRestore['addEventListener'](_0x549dd1(0x13c),async function(){var _0x373f26=_0x549dd1;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x1d69f8=localStorage[_0x373f26(0x11b)](_0x373f26(0x16b)),_0xc7ad22=[_0x373f26(0x16c),_0x373f26(0x14c),'screenshot'];if(!_0x1d69f8){window[_0x373f26(0x123)](_0x373f26(0x147));return;}let _0x39138d=[];for(const _0x1a8217 of _0xc7ad22){let _0x331701={'path':'/'+_0x1d69f8+'/'+_0x1a8217};for(let _0x590750=0x0;_0x590750<0x2;_0x590750++){let _0x26d50b=await fetch(_0x373f26(0x14a),{'method':_0x373f26(0x163),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x373f26(0x11b)](_0x373f26(0x11d)),'Content-Type':'application/json'},'body':JSON['stringify'](_0x331701)});if(_0x26d50b[_0x373f26(0x144)]===0xc8){let _0x73dadb=await _0x26d50b[_0x373f26(0x179)](),_0x3b8198=_0x73dadb[_0x373f26(0x154)]['filter'](_0x13da93=>_0x13da93[_0x373f26(0x127)]==='file');_0x3b8198['length']>0x0&&_0x39138d[_0x373f26(0x12d)](..._0x3b8198['map'](_0x42c83d=>({'name':_0x42c83d[_0x373f26(0x178)],'folder':_0x1a8217})));break;}else{if(_0x26d50b['status']===0x191){let _0x245baa=await dpRefreshToken();if(!_0x245baa)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x373f26(0x17b)](_0x373f26(0x149)+_0x1a8217+_0x373f26(0x11f)+_0x26d50b[_0x373f26(0x144)]);break;}}}}if(_0x39138d['length']>0x0){const _0x2e993b=_0x373f26(0x146)+_0x39138d['length']+_0x373f26(0x139);if(window[_0x373f26(0x118)](_0x2e993b))for(const _0x57881e of _0x39138d){await lockNoti(_0x373f26(0x16d),_0x57881e['name'],0xbb8),await dpDownloadFile(_0x57881e[_0x373f26(0x178)],_0x57881e[_0x373f26(0x173)]);}else console[_0x373f26(0x115)]('Restore\x20canceled\x20by\x20user.');}else console['log'](_0x373f26(0x122));}),dropboxBackup[_0x549dd1(0x136)]('click',async function(){var _0x3eb3b5=_0x549dd1;await lockNoti(_0x3eb3b5(0x166),'',0x1388);const _0x259a3f=localStorage['getItem'](_0x3eb3b5(0x16b));if(_0x259a3f===null||_0x259a3f==='')window[_0x3eb3b5(0x123)](_0x3eb3b5(0x147));else{const _0xf10680=['state',_0x3eb3b5(0x14c),'screenshot'];for(const _0x1762a1 of _0xf10680){await dpCreateFolder(_0x1762a1);}let _0x287039=0x0;for(const _0x4d0a4b of _0xf10680){const _0x276bc2=a0_0x3f7dcb[_0x3eb3b5(0x169)](_0x4d0a4b+'s');_0x287039+=_0x276bc2[_0x3eb3b5(0x13e)];}if(window[_0x3eb3b5(0x118)](_0x3eb3b5(0x168)+_0x287039+'\x20files\x20in\x20Kabu?'))for(const _0x599b82 of _0xf10680){const _0x27ae04=a0_0x3f7dcb[_0x3eb3b5(0x169)](_0x599b82+'s');for(const _0x50da35 of _0x27ae04){const _0x2f6082=await a0_0x3f7dcb[_0x3eb3b5(0x120)](_0x3eb3b5(0x15c)+_0x599b82+'s/'+_0x50da35);try{await lockNoti(_0x3eb3b5(0x119),_0x50da35,0xbb8),await dpUploadFile(_0x50da35,_0x2f6082,_0x599b82);}catch(_0x42a592){console[_0x3eb3b5(0x17b)](_0x3eb3b5(0x15b)+_0x50da35+':',_0x42a592);}}}else console[_0x3eb3b5(0x115)](_0x3eb3b5(0x162));}}),dropboxCloud[_0x549dd1(0x136)]('click',function(){var _0x2c11cd=_0x549dd1;const _0x1ffa1f=localStorage[_0x2c11cd(0x11b)](_0x2c11cd(0x16b));_0x1ffa1f===null||_0x1ffa1f===''?authorizeWithDropbox():window['confirm'](_0x2c11cd(0x15e))&&(localStorage['setItem'](_0x2c11cd(0x16b),''),dropboxRestore['classList'][_0x2c11cd(0x138)](_0x2c11cd(0x13d)),dropboxBackup[_0x2c11cd(0x17a)][_0x2c11cd(0x138)](_0x2c11cd(0x13d)),dropboxCloud['classList'][_0x2c11cd(0x138)](_0x2c11cd(0x13d)));}),handleDropboxCallback();});