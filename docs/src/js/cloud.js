var a0_0x166ddf=a0_0x1495;(function(_0x4a401e,_0x18c5b4){var _0x3eb886=a0_0x1495,_0x5b22f7=_0x4a401e();while(!![]){try{var _0x8ce0f8=-parseInt(_0x3eb886(0xea))/0x1+-parseInt(_0x3eb886(0xbe))/0x2*(parseInt(_0x3eb886(0xeb))/0x3)+parseInt(_0x3eb886(0xc5))/0x4*(-parseInt(_0x3eb886(0x108))/0x5)+parseInt(_0x3eb886(0x106))/0x6+parseInt(_0x3eb886(0xe3))/0x7*(-parseInt(_0x3eb886(0xef))/0x8)+parseInt(_0x3eb886(0xde))/0x9*(parseInt(_0x3eb886(0xee))/0xa)+-parseInt(_0x3eb886(0xda))/0xb*(-parseInt(_0x3eb886(0xfc))/0xc);if(_0x8ce0f8===_0x18c5b4)break;else _0x5b22f7['push'](_0x5b22f7['shift']());}catch(_0xba67bc){_0x5b22f7['push'](_0x5b22f7['shift']());}}}(a0_0x3691,0x80e58));import*as a0_0x5d0c44 from'./main.js';function a0_0x3691(){var _0x10ddc7=['setItem','Download\x20failed,\x20unknown\x20http\x20status:','.gba_slot','remove','authorization_code','code','&token_access_type=','href','.ss7','.tag','knh3uz2mx2hp2eu','407038VogtAl','Refreshing\x20token...','.ss6','offline','stringify','access_token','confirm','2215592kphXwC','\x20files\x20in\x20Cloud?','json','length','.ss4','Backing\x20up...','accessToken','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','endsWith','_imageState','Restoring...','lastIndexOf','.gba_dateState','list','nwb3dnfh09rhs31','log','refresh_token=','charAt','Kabu\x20storage\x20↦\x20Cloud\x20◆','refreshToken','active','11811349qjieGd','alert','.ss3','click','182619kAfDMl','filter','Do\x20you\x20want\x20to\x20restore\x20','https://api.dropbox.com/oauth2/token','Error\x20while\x20refreshing\x20token:','199255NaFaxb','addEventListener','Failed\x20to\x20refresh\x20Dropbox\x20token.','application/x-www-form-urlencoded','Bearer\x20','.ss1','substring','895616kuxfgC','15YRCGLs','Do\x20not\x20receive\x20authorization','&redirect_uri=','40XnmjyN','16zIbHVF','status','https://content.dropboxapi.com/2/files/upload','\x20files\x20in\x20Kabu?','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','error_description','Cloud\x20login\x20required!','No\x20refresh\x20token','location','replace','code=','Content-Type','toUpperCase','24jwOoHf','blob','entries','classList','Download\x20failed,\x20unknown\x20http\x20status:\x20','split','Cloud\x20↦\x20Kabu\x20storage\x20◆','onload','save','name','4939902AjdZmN','setRequestHeader','5BmNTfj','file','overwrite','uploadSaveOrSaveState','text','https://content.dropboxapi.com/2/files/download','refresh_token','getItem','[\x5c?&#]','status:\x20','_dateState','responseText','send','POST','error','Upload\x20failed,\x20unknown\x20http\x20status:\x20','&grant_type=','.txt','.gba_imageState','slice','downloadFileInCloud','state','Unable\x20to\x20refresh\x20token','Restore\x20canceled\x20by\x20user.','application/json','DOMContentLoaded','https://api.dropboxapi.com/oauth2/token','text/plain','application/octet-stream','https://api.dropboxapi.com/2/files/list_folder','=([^&#]*)','uId'];a0_0x3691=function(){return _0x10ddc7;};return a0_0x3691();}import{localStorageFile}from'./storage.js';var clientId=a0_0x166ddf(0xbd),clientSecret=a0_0x166ddf(0xd3);function authorizeWithDropbox(){var _0xa8c138=a0_0x166ddf,_0x566404=window['location'][_0xa8c138(0xba)][_0xa8c138(0x101)]('?')[0x0],_0x31c538='code',_0x1f6df9=_0xa8c138(0xc1),_0x20115f='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+'&response_type='+_0x31c538+_0xa8c138(0xb9)+_0x1f6df9+'&redirect_uri='+encodeURIComponent(_0x566404);window[_0xa8c138(0xf7)][_0xa8c138(0xba)]=_0x20115f;}function handleDropboxCallback(){var _0xfe37ae=a0_0x166ddf,_0x30a3b7=getUrlParameter(_0xfe37ae(0xb8));_0x30a3b7?(getAccessToken(_0x30a3b7),console[_0xfe37ae(0xd4)]('Authorization\x20Code:',_0x30a3b7)):console[_0xfe37ae(0xd4)](_0xfe37ae(0xec));}function getUrlParameter(_0x3790a5){var _0x1bb112=a0_0x166ddf;_0x3790a5=_0x3790a5[_0x1bb112(0xf8)](/[\[]/,'\x5c[')[_0x1bb112(0xf8)](/[\]]/,'\x5c]');var _0x3ed989=new RegExp(_0x1bb112(0x9b)+_0x3790a5+_0x1bb112(0xb1)),_0xada489=_0x3ed989['exec'](location['search']);return _0xada489===null?'':decodeURIComponent(_0xada489[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x4768dd){var _0x1938d2=a0_0x166ddf,_0x4b212e=_0x1938d2(0xb7),_0x34f94b=window[_0x1938d2(0xf7)][_0x1938d2(0xba)][_0x1938d2(0x101)]('?')[0x0],_0x32d612=new XMLHttpRequest();_0x32d612['open'](_0x1938d2(0xa0),_0x1938d2(0xe1)),_0x32d612[_0x1938d2(0x107)](_0x1938d2(0xfa),'application/x-www-form-urlencoded'),_0x32d612[_0x1938d2(0x103)]=function(){var _0x902b17=_0x1938d2;if(_0x32d612[_0x902b17(0xf0)]===0xc8){var _0x58288c=JSON['parse'](_0x32d612[_0x902b17(0x9e)]),_0x5ad3c6=_0x58288c[_0x902b17(0xc3)],_0x43e3fe=_0x58288c[_0x902b17(0x10e)],_0x407e8a=_0x58288c['uid'];localStorage['setItem'](_0x902b17(0xcb),_0x5ad3c6),localStorage[_0x902b17(0xb3)](_0x902b17(0xd8),_0x43e3fe),localStorage['setItem'](_0x902b17(0xb2),_0x407e8a);}else console[_0x902b17(0xd4)](_0x902b17(0xcc));},_0x32d612[_0x1938d2(0x9f)](_0x1938d2(0xf9)+_0x4768dd+_0x1938d2(0xa3)+_0x4b212e+'&client_id='+clientId+'&client_secret='+clientSecret+_0x1938d2(0xed)+encodeURIComponent(_0x34f94b));}function a0_0x1495(_0xb69f2,_0x1a298b){var _0x3691f4=a0_0x3691();return a0_0x1495=function(_0x14956b,_0x374aa5){_0x14956b=_0x14956b-0x9a;var _0xf12fed=_0x3691f4[_0x14956b];return _0xf12fed;},a0_0x1495(_0xb69f2,_0x1a298b);}export async function dpRefreshToken(){var _0x5ca867=a0_0x166ddf;if(!localStorage['getItem'](_0x5ca867(0xd8)))throw _0x5ca867(0xf6);try{const _0x3c01d1=await fetch(_0x5ca867(0xad),{'method':'POST','headers':{'Content-Type':_0x5ca867(0xe6)},'body':_0x5ca867(0xd5)+localStorage['getItem'](_0x5ca867(0xd8))+_0x5ca867(0xf3)}),_0x156c32=await _0x3c01d1['json']();if(!_0x156c32['error'])return localStorage[_0x5ca867(0xb3)](_0x5ca867(0xcb),_0x156c32[_0x5ca867(0xc3)]),await lockNoti('',_0x5ca867(0xbf),0xbb8),await delay(0x3e8),!![];else alert(_0x156c32[_0x5ca867(0xf4)]||_0x5ca867(0xe5));}catch(_0x20497a){console['error'](_0x5ca867(0xe2),_0x20497a);}return![];}export async function dpUploadFile(_0x40ea65,_0x26f5e4){var _0x23477a=a0_0x166ddf;const _0x481121=localStorage[_0x23477a(0x9a)](_0x23477a(0xb2));var _0x5b49af=JSON[_0x23477a(0xc2)]({'autorename':!![],'mode':_0x23477a(0x10a),'mute':!![],'strict_conflict':![],'path':'/'+_0x481121+'/'+_0x40ea65}),_0x17c3bf=new Blob([_0x26f5e4],{'type':'application/octet-stream'});for(var _0x172b2e=0x0;_0x172b2e<0x2;_0x172b2e++){var _0x89d9c5=await fetch(_0x23477a(0xf1),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x23477a(0x9a)](_0x23477a(0xcb)),'Dropbox-API-Arg':_0x5b49af,'Content-Type':_0x23477a(0xaf)},'body':_0x17c3bf});if(_0x89d9c5[_0x23477a(0xf0)]!=0xc8){if(_0x89d9c5[_0x23477a(0xf0)]==0x191){var _0x1da1ea=await dpRefreshToken();if(!_0x1da1ea)throw _0x23477a(0xa9);continue;}else throw _0x23477a(0xa2)+_0x89d9c5[_0x23477a(0xf0)];}else{var _0x334f28=await _0x89d9c5[_0x23477a(0xc7)]();return console['log'](_0x23477a(0xd7),_0x40ea65),_0x334f28;}}return![];}async function dpDownloadFile(_0x50c30f){var _0x28d0d6=a0_0x166ddf;const _0x3f4c11=localStorage[_0x28d0d6(0x9a)](_0x28d0d6(0xb2));var _0x53b6f8=JSON[_0x28d0d6(0xc2)]({'path':'/'+_0x3f4c11+'/'+_0x50c30f});for(var _0x17d403=0x0;_0x17d403<0x2;_0x17d403++){var _0x52aaa0=await fetch(_0x28d0d6(0x10d),{'method':_0x28d0d6(0xa0),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x28d0d6(0xcb)),'Dropbox-API-Arg':_0x53b6f8}});if(_0x52aaa0[_0x28d0d6(0xf0)]!=0xc8){if(_0x52aaa0[_0x28d0d6(0xf0)]==0x191){var _0x43d7b4=await dpRefreshToken();if(!_0x43d7b4)throw _0x28d0d6(0xa9);continue;}else throw _0x28d0d6(0xb4)+_0x52aaa0[_0x28d0d6(0xf0)];}const _0x21486f=new File([await _0x52aaa0[_0x28d0d6(0xfd)]()],_0x50c30f);console[_0x28d0d6(0xd4)](_0x28d0d6(0x102),_0x21486f[_0x28d0d6(0x105)]);if(_0x50c30f['endsWith'](_0x28d0d6(0xa4))){const _0x4cc2a1=await _0x21486f[_0x28d0d6(0x10c)](),[_0x54a50c,_0x323ae7]=_0x4cc2a1[_0x28d0d6(0x101)]('\x0a\x0a'),_0x2a1e87=_0x50c30f[_0x28d0d6(0xe9)](0x0,_0x50c30f[_0x28d0d6(0xd0)]('gba')+0x3),_0x2d6c77=_0x50c30f['charAt'](_0x50c30f[_0x28d0d6(0xc8)]-0x5);localStorage[_0x28d0d6(0xb3)](_0x2a1e87+_0x28d0d6(0x9d)+_0x2d6c77,_0x323ae7),localStorage['setItem'](_0x2a1e87+_0x28d0d6(0xce)+_0x2d6c77,_0x54a50c);}else a0_0x5d0c44[_0x28d0d6(0x10b)](_0x21486f,()=>{localStorageFile(),Module['FSSync']();});return _0x21486f;}return![];}document[a0_0x166ddf(0xe4)](a0_0x166ddf(0xac),function(){var _0x24c7e2=a0_0x166ddf;dropboxRestore[_0x24c7e2(0xe4)](_0x24c7e2(0xdd),async function(){var _0x1e5509=_0x24c7e2;const _0x6a071a=localStorage['getItem']('uId');if(_0x6a071a===null||_0x6a071a==='')window[_0x1e5509(0xdb)](_0x1e5509(0xf5));else{var _0x409cca={'path':'/'+_0x6a071a};for(var _0x2efe82=0x0;_0x2efe82<0x2;_0x2efe82++){var _0x3682d4=await fetch(_0x1e5509(0xb0),{'method':_0x1e5509(0xa0),'headers':{'Authorization':_0x1e5509(0xe7)+localStorage['getItem'](_0x1e5509(0xcb)),'Content-Type':_0x1e5509(0xab)},'body':JSON[_0x1e5509(0xc2)](_0x409cca)});console[_0x1e5509(0xd4)](_0x1e5509(0x9c),_0x3682d4[_0x1e5509(0xf0)]);if(_0x3682d4['status']!=0xc8){if(_0x3682d4[_0x1e5509(0xf0)]==0x191){var _0x4ea764=await dpRefreshToken();if(!_0x4ea764)throw _0x1e5509(0xa9);continue;}else throw _0x1e5509(0x100)+_0x3682d4['status'];}else{const _0x1e4965=await _0x3682d4[_0x1e5509(0xc7)](),_0x4c6fe8=_0x1e4965['entries'][_0x1e5509(0xdf)](_0x1e7460=>_0x1e7460[_0x1e5509(0xbc)]==='file')[_0x1e5509(0xc8)],_0x3ee178=_0x1e5509(0xe0)+_0x4c6fe8+_0x1e5509(0xc6);if(window[_0x1e5509(0xc4)](_0x3ee178))for(const _0x161bde of _0x1e4965[_0x1e5509(0xfe)]){_0x161bde[_0x1e5509(0xbc)]===_0x1e5509(0x109)&&(await lockNoti(_0x1e5509(0xcf),_0x161bde['name'],0xbb8),await dpDownloadFile(_0x161bde[_0x1e5509(0x105)]));}else console[_0x1e5509(0xd4)]('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup[_0x24c7e2(0xe4)]('click',async function(){var _0x373129=_0x24c7e2;const _0xbf363f=localStorage[_0x373129(0x9a)](_0x373129(0xb2));if(_0xbf363f===null||_0xbf363f==='')window[_0x373129(0xdb)](_0x373129(0xf5));else{const _0x2e5a23=[_0x373129(0xa8),_0x373129(0x104)];let _0x375409=0x0;for(const _0x2c8d54 of _0x2e5a23){const _0x55f428=a0_0x5d0c44['list'+(_0x2c8d54[_0x373129(0xd6)](0x0)[_0x373129(0xfb)]()+_0x2c8d54[_0x373129(0xa6)](0x1))]();_0x375409+=_0x55f428[_0x373129(0xc8)];}if(window[_0x373129(0xc4)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x375409+_0x373129(0xf2)))for(const _0x3b4323 of _0x2e5a23){const _0x719e90=a0_0x5d0c44[_0x373129(0xd2)+(_0x3b4323[_0x373129(0xd6)](0x0)[_0x373129(0xfb)]()+_0x3b4323['slice'](0x1))]();for(const _0x31fdad of _0x719e90){const _0x343765=await a0_0x5d0c44[_0x373129(0xa7)]('/data/'+_0x3b4323+'s/'+_0x31fdad);try{await lockNoti('Backing\x20up...',_0x31fdad,0xbb8),await dpUploadFile(_0x31fdad,_0x343765);if(_0x31fdad[_0x373129(0xcd)]('.ss0')||_0x31fdad['endsWith'](_0x373129(0xe8))||_0x31fdad[_0x373129(0xcd)]('.ss2')||_0x31fdad[_0x373129(0xcd)](_0x373129(0xdc))||_0x31fdad[_0x373129(0xcd)](_0x373129(0xc9))||_0x31fdad[_0x373129(0xcd)]('.ss5')||_0x31fdad['endsWith'](_0x373129(0xc0))||_0x31fdad['endsWith'](_0x373129(0xbb))){const _0x1b297f=_0x31fdad[_0x373129(0xe9)](0x0,_0x31fdad[_0x373129(0xd0)]('.')),_0x5187a6=_0x31fdad['charAt'](_0x31fdad[_0x373129(0xc8)]-0x1),_0x3174f2=localStorage['getItem'](_0x1b297f+_0x373129(0xa5)+_0x5187a6),_0xdb4f61=localStorage[_0x373129(0x9a)](_0x1b297f+_0x373129(0xd1)+_0x5187a6);if(_0x3174f2!==null){const _0x27db1b=_0x3174f2+'\x0a\x0a'+_0xdb4f61,_0x571f3a=new Blob([_0x27db1b],{'type':_0x373129(0xae)});await lockNoti(_0x373129(0xca),_0x1b297f+'.gba_slot'+_0x5187a6+_0x373129(0xa4),0xbb8),await dpUploadFile(_0x1b297f+_0x373129(0xb5)+_0x5187a6+_0x373129(0xa4),_0x571f3a);}}}catch(_0x43c557){console[_0x373129(0xa1)]('Failed\x20to\x20upload\x20file\x20'+_0x31fdad+':',_0x43c557);}}}else console[_0x373129(0xd4)](_0x373129(0xaa));}}),dropboxCloud[_0x24c7e2(0xe4)](_0x24c7e2(0xdd),function(){var _0x123d1e=_0x24c7e2;const _0x21b238=localStorage[_0x123d1e(0x9a)](_0x123d1e(0xb2));_0x21b238===null||_0x21b238===''?authorizeWithDropbox():window['confirm']('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x123d1e(0xb3)](_0x123d1e(0xb2),''),dropboxRestore[_0x123d1e(0xff)][_0x123d1e(0xb6)](_0x123d1e(0xd9)),dropboxBackup[_0x123d1e(0xff)]['remove'](_0x123d1e(0xd9)),dropboxCloud[_0x123d1e(0xff)][_0x123d1e(0xb6)](_0x123d1e(0xd9)));}),handleDropboxCallback();});