var a0_0x356df1=a0_0x1689;(function(_0x3dc9c3,_0x22639c){var _0x35852f=a0_0x1689,_0x67af5c=_0x3dc9c3();while(!![]){try{var _0x586a1e=parseInt(_0x35852f(0x20a))/0x1*(parseInt(_0x35852f(0x224))/0x2)+-parseInt(_0x35852f(0x242))/0x3+-parseInt(_0x35852f(0x20b))/0x4*(-parseInt(_0x35852f(0x209))/0x5)+-parseInt(_0x35852f(0x22e))/0x6+-parseInt(_0x35852f(0x1f4))/0x7*(parseInt(_0x35852f(0x210))/0x8)+parseInt(_0x35852f(0x240))/0x9+-parseInt(_0x35852f(0x221))/0xa;if(_0x586a1e===_0x22639c)break;else _0x67af5c['push'](_0x67af5c['shift']());}catch(_0x48dac5){_0x67af5c['push'](_0x67af5c['shift']());}}}(a0_0x1d47,0xa447f));import*as a0_0x3c0583 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x356df1(0x20c),clientSecret=a0_0x356df1(0x1df);function authorizeWithDropbox(){var _0x5e2e02=a0_0x356df1,_0x1528fb=window[_0x5e2e02(0x20f)][_0x5e2e02(0x1f0)][_0x5e2e02(0x22a)]('?')[0x0],_0x15d1b3='code',_0x484071='offline',_0x220406=_0x5e2e02(0x222)+clientId+_0x5e2e02(0x220)+_0x15d1b3+'&token_access_type='+_0x484071+'&redirect_uri='+encodeURIComponent(_0x1528fb);window['location'][_0x5e2e02(0x1f0)]=_0x220406;}function handleDropboxCallback(){var _0x770f86=a0_0x356df1,_0xba7e38=getUrlParameter('code');_0xba7e38?(getAccessToken(_0xba7e38),console[_0x770f86(0x1f7)](_0x770f86(0x227),_0xba7e38)):console[_0x770f86(0x1f7)](_0x770f86(0x243));}function getUrlParameter(_0x3199f1){var _0x563c9a=a0_0x356df1;_0x3199f1=_0x3199f1[_0x563c9a(0x1ef)](/[\[]/,'\x5c[')[_0x563c9a(0x1ef)](/[\]]/,'\x5c]');var _0x22e35a=new RegExp(_0x563c9a(0x218)+_0x3199f1+_0x563c9a(0x212)),_0x2172cc=_0x22e35a[_0x563c9a(0x1f2)](location[_0x563c9a(0x1e2)]);return _0x2172cc===null?'':decodeURIComponent(_0x2172cc[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x72994c){var _0x368492=a0_0x356df1,_0x14fd6b=_0x368492(0x20d),_0x3b02e7=window[_0x368492(0x20f)]['href'][_0x368492(0x22a)]('?')[0x0],_0x54c6ee=new XMLHttpRequest();_0x54c6ee[_0x368492(0x234)](_0x368492(0x226),'https://api.dropbox.com/oauth2/token'),_0x54c6ee[_0x368492(0x23d)](_0x368492(0x207),'application/x-www-form-urlencoded'),_0x54c6ee[_0x368492(0x206)]=function(){var _0x443ea4=_0x368492;if(_0x54c6ee[_0x443ea4(0x219)]===0xc8){var _0x1d2207=JSON[_0x443ea4(0x1eb)](_0x54c6ee[_0x443ea4(0x1e9)]),_0xe73e85=_0x1d2207[_0x443ea4(0x22d)],_0x37110c=_0x1d2207[_0x443ea4(0x228)],_0x332f7f=_0x1d2207[_0x443ea4(0x23c)];localStorage[_0x443ea4(0x223)](_0x443ea4(0x204),_0xe73e85),localStorage[_0x443ea4(0x223)](_0x443ea4(0x235),_0x37110c),localStorage[_0x443ea4(0x223)](_0x443ea4(0x23f),_0x332f7f);}else console[_0x443ea4(0x1f7)](_0x443ea4(0x21c));},_0x54c6ee[_0x368492(0x231)](_0x368492(0x1e8)+_0x72994c+_0x368492(0x1f9)+_0x14fd6b+'&client_id='+clientId+_0x368492(0x1e5)+clientSecret+_0x368492(0x23e)+encodeURIComponent(_0x3b02e7));}export async function dpCreateFolder(_0x54e126){var _0x52522c=a0_0x356df1;const _0x44f7bb=localStorage[_0x52522c(0x1fe)](_0x52522c(0x23f));let _0x152c82=localStorage[_0x52522c(0x1fe)]('accessToken');const _0x788c6f='/'+_0x44f7bb+'/'+_0x54e126,_0x3e59d1=JSON[_0x52522c(0x1e7)]({'path':_0x788c6f,'autorename':![]});for(let _0x41bb07=0x0;_0x41bb07<0x2;_0x41bb07++){try{const _0x220aa7=await fetch(_0x52522c(0x1ed),{'method':_0x52522c(0x226),'headers':{'Authorization':_0x52522c(0x201)+_0x152c82,'Content-Type':_0x52522c(0x22b)},'body':_0x3e59d1});if(_0x220aa7[_0x52522c(0x219)]===0x191){const _0x47c041=await dpRefreshToken();if(!_0x47c041)throw new Error(_0x52522c(0x225));_0x152c82=localStorage[_0x52522c(0x1fe)](_0x52522c(0x204));continue;}if(_0x220aa7[_0x52522c(0x219)]===0x199)return{'message':_0x52522c(0x211),'path':_0x54e126};if(!_0x220aa7['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x54e126);const _0x15e87e=await _0x220aa7['json']();return await lockNoti(_0x52522c(0x21f),'',0xbb8),_0x15e87e;}catch(_0x24f90e){if(_0x41bb07===0x1)throw _0x24f90e;}}return![];}function a0_0x1d47(){var _0x351ea3=['Cloud\x20login\x20required!','access_token','23604RMexXP','state','refresh_token=','send','active','application/octet-stream','open','refreshToken',',\x20status:\x20','application/x-www-form-urlencoded','name','click','Restore\x20canceled\x20by\x20user.','No\x20files\x20found\x20to\x20restore.','uid','setRequestHeader','&redirect_uri=','uId','7231203jJlnld','screenshot','2945064WxXWHV','Do\x20not\x20receive\x20authorization','Download\x20failed\x20for\x20','error','classList','Restoring...','https://api.dropboxapi.com/oauth2/token','DOMContentLoaded','nwb3dnfh09rhs31','overwrite','\x20files\x20in\x20Kabu?','search','\x20files\x20from\x20Cloud?','listFiles','&client_secret=','Upload\x20failed,\x20unknown\x20http\x20status:\x20','stringify','code=','responseText','Wait\x20a\x20little\x20bit...','parse','Download\x20failed,\x20unknown\x20http\x20status:','https://api.dropboxapi.com/2/files/create_folder_v2','Backing\x20up...','replace','href','.tag','exec','Cloud\x20↦\x20Kabu\x20storage\x20◆','70yqqRoK','Do\x20you\x20want\x20to\x20backup\x20','addEventListener','log','filter','&grant_type=','save','length','Failed\x20to\x20refresh\x20Dropbox\x20token.','uploadFileInCloud','getItem','confirm','https://api.dropboxapi.com/2/files/list_folder','Bearer\x20','push','file','accessToken','No\x20refresh\x20token','onload','Content-Type','https://content.dropboxapi.com/2/files/upload','5RSJzeG','101538StKtJS','5195940LvSpDZ','knh3uz2mx2hp2eu','authorization_code','Do\x20you\x20want\x20to\x20restore\x20','location','248360ikYjzm','Folder\x20already\x20exists','=([^&#]*)','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','remove','Do\x20you\x20want\x20to\x20logout?','downloadFileInCloud','folder','[\x5c?&#]','status','alert','json','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','/data/','Error\x20while\x20refreshing\x20token:','Folder\x20created','&response_type=','2350230eYnFca','https://www.dropbox.com/oauth2/authorize?client_id=','setItem','2FxVXkr','Unable\x20to\x20refresh\x20token','POST','Authorization\x20Code:','refresh_token','https://content.dropboxapi.com/2/files/download','split','application/json'];a0_0x1d47=function(){return _0x351ea3;};return a0_0x1d47();}export async function dpRefreshToken(){var _0x2f801e=a0_0x356df1;if(!localStorage[_0x2f801e(0x1fe)](_0x2f801e(0x235)))throw _0x2f801e(0x205);try{const _0x6b775c=await fetch(_0x2f801e(0x1dd),{'method':_0x2f801e(0x226),'headers':{'Content-Type':_0x2f801e(0x237)},'body':_0x2f801e(0x230)+localStorage[_0x2f801e(0x1fe)](_0x2f801e(0x235))+_0x2f801e(0x213)}),_0x25d961=await _0x6b775c['json']();if(!_0x25d961[_0x2f801e(0x245)])return localStorage[_0x2f801e(0x223)](_0x2f801e(0x204),_0x25d961[_0x2f801e(0x22d)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x25d961['error_description']||_0x2f801e(0x1fc));}catch(_0x4ed48f){console['error'](_0x2f801e(0x21e),_0x4ed48f);}return![];}function a0_0x1689(_0x5a2f84,_0x33cb41){var _0x1d470a=a0_0x1d47();return a0_0x1689=function(_0x16893f,_0x3e3028){_0x16893f=_0x16893f-0x1db;var _0x13f5bd=_0x1d470a[_0x16893f];return _0x13f5bd;},a0_0x1689(_0x5a2f84,_0x33cb41);}export async function dpUploadFile(_0x153b47,_0x466659,_0x3ca7d9){var _0x15bb5d=a0_0x356df1;const _0x14f443=localStorage[_0x15bb5d(0x1fe)](_0x15bb5d(0x23f));var _0x2ac068=JSON['stringify']({'autorename':!![],'mode':_0x15bb5d(0x1e0),'mute':!![],'strict_conflict':![],'path':'/'+_0x14f443+'/'+_0x3ca7d9+'/'+_0x153b47}),_0x4d95a4=new Blob([_0x466659],{'type':'application/octet-stream'});for(var _0x70f5f1=0x0;_0x70f5f1<0x2;_0x70f5f1++){var _0x8599bc=await fetch(_0x15bb5d(0x208),{'method':'POST','headers':{'Authorization':_0x15bb5d(0x201)+localStorage[_0x15bb5d(0x1fe)](_0x15bb5d(0x204)),'Dropbox-API-Arg':_0x2ac068,'Content-Type':_0x15bb5d(0x233)},'body':_0x4d95a4});if(_0x8599bc[_0x15bb5d(0x219)]!=0xc8){if(_0x8599bc[_0x15bb5d(0x219)]==0x191){var _0x139d24=await dpRefreshToken();if(!_0x139d24)throw _0x15bb5d(0x225);continue;}else throw _0x15bb5d(0x1e6)+_0x8599bc[_0x15bb5d(0x219)];}else{var _0x3e04fb=await _0x8599bc[_0x15bb5d(0x21b)]();return console[_0x15bb5d(0x1f7)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x153b47),_0x3e04fb;}}return![];}export async function dpDownloadFile(_0x4e8869,_0x10746f){var _0x4c2596=a0_0x356df1;const _0x56f368=localStorage[_0x4c2596(0x1fe)](_0x4c2596(0x23f));var _0x19b4f9=JSON[_0x4c2596(0x1e7)]({'path':'/'+_0x56f368+'/'+_0x10746f+'/'+_0x4e8869});for(var _0x1bece2=0x0;_0x1bece2<0x2;_0x1bece2++){var _0xe4c092=await fetch(_0x4c2596(0x229),{'method':_0x4c2596(0x226),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x4c2596(0x204)),'Dropbox-API-Arg':_0x19b4f9}});if(_0xe4c092[_0x4c2596(0x219)]!=0xc8){if(_0xe4c092['status']==0x191){var _0x5cf339=await dpRefreshToken();if(!_0x5cf339)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x4c2596(0x1ec)+_0xe4c092[_0x4c2596(0x219)];}const _0x546aa8=new File([await _0xe4c092['blob']()],_0x4e8869);return console[_0x4c2596(0x1f7)](_0x4c2596(0x1f3),_0x546aa8[_0x4c2596(0x238)]),a0_0x3c0583[_0x4c2596(0x1fd)](_0x546aa8,()=>{}),_0x546aa8;}return![];}document[a0_0x356df1(0x1f6)](a0_0x356df1(0x1de),function(){var _0x5cba17=a0_0x356df1;dropboxRestore[_0x5cba17(0x1f6)](_0x5cba17(0x239),async function(){var _0x5d6814=_0x5cba17;await lockNoti(_0x5d6814(0x1ea),'',0x1388);const _0x2f9665=localStorage[_0x5d6814(0x1fe)](_0x5d6814(0x23f)),_0x3273a1=[_0x5d6814(0x22f),_0x5d6814(0x1fa),_0x5d6814(0x241)];if(!_0x2f9665){window[_0x5d6814(0x21a)](_0x5d6814(0x22c));return;}let _0x5e25b8=[];for(const _0x548c7a of _0x3273a1){let _0x26900c={'path':'/'+_0x2f9665+'/'+_0x548c7a};for(let _0x57be15=0x0;_0x57be15<0x2;_0x57be15++){let _0x11fee0=await fetch(_0x5d6814(0x200),{'method':_0x5d6814(0x226),'headers':{'Authorization':_0x5d6814(0x201)+localStorage[_0x5d6814(0x1fe)](_0x5d6814(0x204)),'Content-Type':'application/json'},'body':JSON[_0x5d6814(0x1e7)](_0x26900c)});if(_0x11fee0['status']===0xc8){let _0x5deff9=await _0x11fee0[_0x5d6814(0x21b)](),_0x25727c=_0x5deff9['entries'][_0x5d6814(0x1f8)](_0x34689f=>_0x34689f[_0x5d6814(0x1f1)]===_0x5d6814(0x203));_0x25727c[_0x5d6814(0x1fb)]>0x0&&_0x5e25b8[_0x5d6814(0x202)](..._0x25727c['map'](_0x15539f=>({'name':_0x15539f[_0x5d6814(0x238)],'folder':_0x548c7a})));break;}else{if(_0x11fee0[_0x5d6814(0x219)]===0x191){let _0x430399=await dpRefreshToken();if(!_0x430399)throw _0x5d6814(0x225);}else{console[_0x5d6814(0x245)](_0x5d6814(0x244)+_0x548c7a+_0x5d6814(0x236)+_0x11fee0[_0x5d6814(0x219)]);break;}}}}if(_0x5e25b8[_0x5d6814(0x1fb)]>0x0){const _0x2fbe09=_0x5d6814(0x20e)+_0x5e25b8[_0x5d6814(0x1fb)]+_0x5d6814(0x1e3);if(window[_0x5d6814(0x1ff)](_0x2fbe09))for(const _0x3fda40 of _0x5e25b8){await lockNoti(_0x5d6814(0x1dc),_0x3fda40[_0x5d6814(0x238)],0xbb8),await dpDownloadFile(_0x3fda40[_0x5d6814(0x238)],_0x3fda40[_0x5d6814(0x217)]);}else console[_0x5d6814(0x1f7)]('Restore\x20canceled\x20by\x20user.');}else console[_0x5d6814(0x1f7)](_0x5d6814(0x23b));}),dropboxBackup[_0x5cba17(0x1f6)]('click',async function(){var _0x5f5332=_0x5cba17;await lockNoti(_0x5f5332(0x1ea),'',0x1388);const _0x2845c4=localStorage['getItem'](_0x5f5332(0x23f));if(_0x2845c4===null||_0x2845c4==='')window[_0x5f5332(0x21a)](_0x5f5332(0x22c));else{const _0x526069=[_0x5f5332(0x22f),_0x5f5332(0x1fa),'screenshot'];for(const _0x22b971 of _0x526069){await dpCreateFolder(_0x22b971);}let _0x5aa995=0x0;for(const _0x1e1e1 of _0x526069){const _0x23e3c0=a0_0x3c0583[_0x5f5332(0x1e4)](_0x1e1e1+'s');_0x5aa995+=_0x23e3c0[_0x5f5332(0x1fb)];}if(window[_0x5f5332(0x1ff)](_0x5f5332(0x1f5)+_0x5aa995+_0x5f5332(0x1e1)))for(const _0x5d1878 of _0x526069){const _0x2e5061=a0_0x3c0583[_0x5f5332(0x1e4)](_0x5d1878+'s');for(const _0x60dc1e of _0x2e5061){const _0x31cb23=await a0_0x3c0583[_0x5f5332(0x216)](_0x5f5332(0x21d)+_0x5d1878+'s/'+_0x60dc1e);try{await lockNoti(_0x5f5332(0x1ee),_0x60dc1e,0xbb8),await dpUploadFile(_0x60dc1e,_0x31cb23,_0x5d1878);}catch(_0x48ece7){console[_0x5f5332(0x245)]('Failed\x20to\x20upload\x20file\x20'+_0x60dc1e+':',_0x48ece7);}}}else console[_0x5f5332(0x1f7)](_0x5f5332(0x23a));}}),dropboxCloud['addEventListener']('click',function(){var _0x149504=_0x5cba17;const _0x1f397f=localStorage[_0x149504(0x1fe)]('uId');_0x1f397f===null||_0x1f397f===''?authorizeWithDropbox():window[_0x149504(0x1ff)](_0x149504(0x215))&&(localStorage[_0x149504(0x223)](_0x149504(0x23f),''),dropboxRestore[_0x149504(0x1db)]['remove'](_0x149504(0x232)),dropboxBackup[_0x149504(0x1db)][_0x149504(0x214)](_0x149504(0x232)),dropboxCloud[_0x149504(0x1db)][_0x149504(0x214)](_0x149504(0x232)));}),handleDropboxCallback();});