var a0_0x4b89ff=a0_0x10f8;function a0_0x10f8(_0x1c0611,_0x17fc7b){var _0x3dfe07=a0_0x3dfe();return a0_0x10f8=function(_0x10f887,_0x2cda12){_0x10f887=_0x10f887-0x7d;var _0x46398e=_0x3dfe07[_0x10f887];return _0x46398e;},a0_0x10f8(_0x1c0611,_0x17fc7b);}(function(_0x3d0697,_0x39189d){var _0x4f1659=a0_0x10f8,_0x234c51=_0x3d0697();while(!![]){try{var _0x5f2e7d=-parseInt(_0x4f1659(0x99))/0x1+-parseInt(_0x4f1659(0xa5))/0x2+parseInt(_0x4f1659(0x83))/0x3*(-parseInt(_0x4f1659(0xb6))/0x4)+-parseInt(_0x4f1659(0x82))/0x5*(-parseInt(_0x4f1659(0x8f))/0x6)+parseInt(_0x4f1659(0x8a))/0x7+-parseInt(_0x4f1659(0xb4))/0x8*(-parseInt(_0x4f1659(0xce))/0x9)+parseInt(_0x4f1659(0xdb))/0xa*(parseInt(_0x4f1659(0xd2))/0xb);if(_0x5f2e7d===_0x39189d)break;else _0x234c51['push'](_0x234c51['shift']());}catch(_0x422867){_0x234c51['push'](_0x234c51['shift']());}}}(a0_0x3dfe,0x38ddd));import*as a0_0xf0e5e4 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x4b89ff(0x90),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x397d63=a0_0x4b89ff,_0x485914=window['location']['href']['split']('?')[0x0],_0x233332='code',_0x3791f7=_0x397d63(0xa4),_0x1163a1='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x397d63(0xc8)+_0x233332+_0x397d63(0xcb)+_0x3791f7+'&redirect_uri='+encodeURIComponent(_0x485914);window[_0x397d63(0xae)][_0x397d63(0xd3)]=_0x1163a1;}function handleDropboxCallback(){var _0x2a15c9=a0_0x4b89ff,_0xdcc987=getUrlParameter(_0x2a15c9(0xc0));_0xdcc987?(getAccessToken(_0xdcc987),console[_0x2a15c9(0xd5)]('Authorization\x20Code:',_0xdcc987)):console['log'](_0x2a15c9(0x94));}function a0_0x3dfe(){var _0xdabd09=['state','code','POST',',\x20status:\x20','Failed\x20to\x20refresh\x20Dropbox\x20token.','status','application/json','https://content.dropboxapi.com/2/files/upload','error_description','&response_type=','Cloud\x20login\x20required!','classList','&token_access_type=','remove','Backing\x20up...','9CpMRfb','send','replace','.tag','121ZynkUW','href','refresh_token=','log','Cloud\x20↦\x20Kabu\x20storage\x20◆','Restoring...','screenshot','slice','accessToken','134680pkMvrL','alert','Error\x20creating\x20folder\x20','\x20files\x20from\x20Cloud?','Do\x20you\x20want\x20to\x20backup\x20','\x20files\x20in\x20Kabu?','parse','toUpperCase','No\x20refresh\x20token','name','435555LrTvbT','17034fUdKyJ','charAt','length','refreshToken','save','Upload\x20failed,\x20unknown\x20http\x20status:\x20','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','2113230yrzbXE','&redirect_uri=','json','&grant_type=','uId','6cSpdkV','knh3uz2mx2hp2eu','Restore\x20canceled\x20by\x20user.','exec','/data/','Do\x20not\x20receive\x20authorization','entries','error','Content-Type','Folder\x20created','315567yWLreN','[\x5c?&#]','search','https://api.dropboxapi.com/oauth2/token','list','addEventListener','uid','push','application/octet-stream','Bearer\x20','folder','offline','202844WLAasg','code=','Folder\x20already\x20exists','Wait\x20a\x20little\x20bit...','setItem','https://api.dropbox.com/oauth2/token','stringify','confirm','click','location','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','filter','No\x20files\x20found\x20to\x20restore.','application/x-www-form-urlencoded','getItem','1038392tekLBX','FSSync','12MOTOVd','Unable\x20to\x20refresh\x20token','https://content.dropboxapi.com/2/files/download','Download\x20failed,\x20unknown\x20http\x20status:','&client_secret=','refresh_token','Kabu\x20storage\x20↦\x20Cloud\x20◆','active','Download\x20failed\x20for\x20'];a0_0x3dfe=function(){return _0xdabd09;};return a0_0x3dfe();}function getUrlParameter(_0x5c8f22){var _0x117efd=a0_0x4b89ff;_0x5c8f22=_0x5c8f22[_0x117efd(0xd0)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x996bcc=new RegExp(_0x117efd(0x9a)+_0x5c8f22+'=([^&#]*)'),_0xb568f0=_0x996bcc[_0x117efd(0x92)](location[_0x117efd(0x9b)]);return _0xb568f0===null?'':decodeURIComponent(_0xb568f0[0x1][_0x117efd(0xd0)](/\+/g,'\x20'));}function getAccessToken(_0x524222){var _0x54a18c=a0_0x4b89ff,_0x4c4d79='authorization_code',_0x8168f1=window[_0x54a18c(0xae)][_0x54a18c(0xd3)]['split']('?')[0x0],_0x4ac802=new XMLHttpRequest();_0x4ac802['open'](_0x54a18c(0xc1),_0x54a18c(0xaa)),_0x4ac802['setRequestHeader'](_0x54a18c(0x97),_0x54a18c(0xb2)),_0x4ac802['onload']=function(){var _0x105533=_0x54a18c;if(_0x4ac802[_0x105533(0xc4)]===0xc8){var _0x27b0e4=JSON[_0x105533(0x7e)](_0x4ac802['responseText']),_0x42c397=_0x27b0e4['access_token'],_0x447d46=_0x27b0e4[_0x105533(0xbb)],_0x1ca403=_0x27b0e4[_0x105533(0x9f)];localStorage['setItem'](_0x105533(0xda),_0x42c397),localStorage['setItem'](_0x105533(0x86),_0x447d46),localStorage[_0x105533(0xa9)](_0x105533(0x8e),_0x1ca403);}else console[_0x105533(0xd5)](_0x105533(0xaf));},_0x4ac802[_0x54a18c(0xcf)](_0x54a18c(0xa6)+_0x524222+_0x54a18c(0x8d)+_0x4c4d79+'&client_id='+clientId+_0x54a18c(0xba)+clientSecret+_0x54a18c(0x8b)+encodeURIComponent(_0x8168f1));}export async function dpCreateFolder(_0x56d78a){var _0x9330f7=a0_0x4b89ff;const _0x52e5f7=localStorage[_0x9330f7(0xb3)](_0x9330f7(0x8e));let _0x3851b7=localStorage[_0x9330f7(0xb3)](_0x9330f7(0xda));const _0x439184='/'+_0x52e5f7+'/'+_0x56d78a,_0x2224ea=JSON[_0x9330f7(0xab)]({'path':_0x439184,'autorename':![]});for(let _0x58f64e=0x0;_0x58f64e<0x2;_0x58f64e++){try{const _0x1538b5=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x9330f7(0xc1),'headers':{'Authorization':'Bearer\x20'+_0x3851b7,'Content-Type':_0x9330f7(0xc5)},'body':_0x2224ea});if(_0x1538b5[_0x9330f7(0xc4)]===0x191){const _0xab2857=await dpRefreshToken();if(!_0xab2857)throw new Error('Unable\x20to\x20refresh\x20token');_0x3851b7=localStorage['getItem'](_0x9330f7(0xda));continue;}if(_0x1538b5[_0x9330f7(0xc4)]===0x199)return{'message':_0x9330f7(0xa7),'path':_0x56d78a};if(!_0x1538b5['ok'])throw new Error(_0x9330f7(0xdd)+_0x56d78a);const _0xc54a64=await _0x1538b5[_0x9330f7(0x8c)]();return await lockNoti(_0x9330f7(0x98),'',0xbb8),_0xc54a64;}catch(_0x35e644){if(_0x58f64e===0x1)throw _0x35e644;}}return![];}export async function dpRefreshToken(){var _0x1057c0=a0_0x4b89ff;if(!localStorage[_0x1057c0(0xb3)](_0x1057c0(0x86)))throw _0x1057c0(0x80);try{const _0x3e8317=await fetch(_0x1057c0(0x9c),{'method':_0x1057c0(0xc1),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x1057c0(0xd4)+localStorage[_0x1057c0(0xb3)](_0x1057c0(0x86))+_0x1057c0(0x89)}),_0x135b01=await _0x3e8317[_0x1057c0(0x8c)]();if(!_0x135b01[_0x1057c0(0x96)])return localStorage[_0x1057c0(0xa9)](_0x1057c0(0xda),_0x135b01['access_token']),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x135b01[_0x1057c0(0xc7)]||_0x1057c0(0xc3));}catch(_0x51256a){console['error']('Error\x20while\x20refreshing\x20token:',_0x51256a);}return![];}export async function dpUploadFile(_0x2575f4,_0x37881b,_0x5a5b78){var _0x34bdb0=a0_0x4b89ff;const _0x2b388b=localStorage[_0x34bdb0(0xb3)](_0x34bdb0(0x8e));var _0x37c92c=JSON[_0x34bdb0(0xab)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x2b388b+'/'+_0x5a5b78+'/'+_0x2575f4}),_0x328b7d=new Blob([_0x37881b],{'type':'application/octet-stream'});for(var _0x407704=0x0;_0x407704<0x2;_0x407704++){var _0x2e6510=await fetch(_0x34bdb0(0xc6),{'method':_0x34bdb0(0xc1),'headers':{'Authorization':_0x34bdb0(0xa2)+localStorage[_0x34bdb0(0xb3)]('accessToken'),'Dropbox-API-Arg':_0x37c92c,'Content-Type':_0x34bdb0(0xa1)},'body':_0x328b7d});if(_0x2e6510[_0x34bdb0(0xc4)]!=0xc8){if(_0x2e6510[_0x34bdb0(0xc4)]==0x191){var _0x16b743=await dpRefreshToken();if(!_0x16b743)throw _0x34bdb0(0xb7);continue;}else throw _0x34bdb0(0x88)+_0x2e6510[_0x34bdb0(0xc4)];}else{var _0x2d7f71=await _0x2e6510['json']();return console['log'](_0x34bdb0(0xbc),_0x2575f4),_0x2d7f71;}}return![];}export async function dpDownloadFile(_0x3e30da,_0x5b223f){var _0x11a877=a0_0x4b89ff;const _0x27af7e=localStorage[_0x11a877(0xb3)](_0x11a877(0x8e));var _0x36afb5=JSON[_0x11a877(0xab)]({'path':'/'+_0x27af7e+'/'+_0x5b223f+'/'+_0x3e30da});for(var _0x5b3656=0x0;_0x5b3656<0x2;_0x5b3656++){var _0x3440ad=await fetch(_0x11a877(0xb8),{'method':_0x11a877(0xc1),'headers':{'Authorization':_0x11a877(0xa2)+localStorage[_0x11a877(0xb3)](_0x11a877(0xda)),'Dropbox-API-Arg':_0x36afb5}});if(_0x3440ad[_0x11a877(0xc4)]!=0xc8){if(_0x3440ad[_0x11a877(0xc4)]==0x191){var _0x1a6c14=await dpRefreshToken();if(!_0x1a6c14)throw _0x11a877(0xb7);continue;}else throw _0x11a877(0xb9)+_0x3440ad[_0x11a877(0xc4)];}const _0x2dd85a=new File([await _0x3440ad['blob']()],_0x3e30da);return console['log'](_0x11a877(0xd6),_0x2dd85a[_0x11a877(0x81)]),a0_0xf0e5e4['uploadFileInCloud'](_0x2dd85a,()=>{var _0x3c36b6=_0x11a877;localStorageFile(),Module[_0x3c36b6(0xb5)]();}),_0x2dd85a;}return![];}document['addEventListener']('DOMContentLoaded',function(){var _0x56effa=a0_0x4b89ff;dropboxRestore[_0x56effa(0x9e)](_0x56effa(0xad),async function(){var _0x4cb08f=_0x56effa;await lockNoti(_0x4cb08f(0xa8),'',0x1388);const _0x3b5bd4=localStorage[_0x4cb08f(0xb3)](_0x4cb08f(0x8e)),_0x4ef3d6=['state','save',_0x4cb08f(0xd8)];if(!_0x3b5bd4){window[_0x4cb08f(0xdc)](_0x4cb08f(0xc9));return;}let _0x3b0fe3=[];for(const _0x37d342 of _0x4ef3d6){let _0x283063={'path':'/'+_0x3b5bd4+'/'+_0x37d342};for(let _0x1f4ec8=0x0;_0x1f4ec8<0x2;_0x1f4ec8++){let _0x5a64a2=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x4cb08f(0xc1),'headers':{'Authorization':_0x4cb08f(0xa2)+localStorage['getItem'](_0x4cb08f(0xda)),'Content-Type':'application/json'},'body':JSON[_0x4cb08f(0xab)](_0x283063)});if(_0x5a64a2['status']===0xc8){let _0x18f5ce=await _0x5a64a2['json'](),_0x548346=_0x18f5ce[_0x4cb08f(0x95)][_0x4cb08f(0xb0)](_0x4104e1=>_0x4104e1[_0x4cb08f(0xd1)]==='file');_0x548346[_0x4cb08f(0x85)]>0x0&&_0x3b0fe3[_0x4cb08f(0xa0)](..._0x548346['map'](_0x3f5825=>({'name':_0x3f5825[_0x4cb08f(0x81)],'folder':_0x37d342})));break;}else{if(_0x5a64a2['status']===0x191){let _0x1bf458=await dpRefreshToken();if(!_0x1bf458)throw _0x4cb08f(0xb7);}else{console[_0x4cb08f(0x96)](_0x4cb08f(0xbe)+_0x37d342+_0x4cb08f(0xc2)+_0x5a64a2[_0x4cb08f(0xc4)]);break;}}}}if(_0x3b0fe3[_0x4cb08f(0x85)]>0x0){const _0x399d6f='Do\x20you\x20want\x20to\x20restore\x20'+_0x3b0fe3[_0x4cb08f(0x85)]+_0x4cb08f(0xde);if(window[_0x4cb08f(0xac)](_0x399d6f))for(const _0x12bd46 of _0x3b0fe3){await lockNoti(_0x4cb08f(0xd7),_0x12bd46[_0x4cb08f(0x81)],0xbb8),await dpDownloadFile(_0x12bd46[_0x4cb08f(0x81)],_0x12bd46[_0x4cb08f(0xa3)]);}else console['log'](_0x4cb08f(0x91));}else console[_0x4cb08f(0xd5)](_0x4cb08f(0xb1));}),dropboxBackup['addEventListener'](_0x56effa(0xad),async function(){var _0x1eb40b=_0x56effa;await lockNoti(_0x1eb40b(0xa8),'',0x1388);const _0x4fca17=localStorage[_0x1eb40b(0xb3)](_0x1eb40b(0x8e));if(_0x4fca17===null||_0x4fca17==='')window['alert'](_0x1eb40b(0xc9));else{const _0x105dd2=[_0x1eb40b(0xbf),_0x1eb40b(0x87),_0x1eb40b(0xd8)];for(const _0x49d147 of _0x105dd2){await dpCreateFolder(_0x49d147);}let _0x2b7b06=0x0;for(const _0x2750f5 of _0x105dd2){const _0x2ea51c=a0_0xf0e5e4[_0x1eb40b(0x9d)+(_0x2750f5['charAt'](0x0)[_0x1eb40b(0x7f)]()+_0x2750f5[_0x1eb40b(0xd9)](0x1))]();_0x2b7b06+=_0x2ea51c['length'];}if(window[_0x1eb40b(0xac)](_0x1eb40b(0xdf)+_0x2b7b06+_0x1eb40b(0x7d)))for(const _0x6c02ec of _0x105dd2){const _0x165e5f=a0_0xf0e5e4['list'+(_0x6c02ec[_0x1eb40b(0x84)](0x0)[_0x1eb40b(0x7f)]()+_0x6c02ec[_0x1eb40b(0xd9)](0x1))]();for(const _0x2219e3 of _0x165e5f){const _0x2ff7ee=await a0_0xf0e5e4['downloadFileInCloud'](_0x1eb40b(0x93)+_0x6c02ec+'s/'+_0x2219e3);try{await lockNoti(_0x1eb40b(0xcd),_0x2219e3,0xbb8),await dpUploadFile(_0x2219e3,_0x2ff7ee,_0x6c02ec);}catch(_0x49d89a){console[_0x1eb40b(0x96)]('Failed\x20to\x20upload\x20file\x20'+_0x2219e3+':',_0x49d89a);}}}else console[_0x1eb40b(0xd5)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x56effa(0x9e)](_0x56effa(0xad),function(){var _0x53b9a0=_0x56effa;const _0x490179=localStorage[_0x53b9a0(0xb3)]('uId');_0x490179===null||_0x490179===''?authorizeWithDropbox():window[_0x53b9a0(0xac)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x53b9a0(0xa9)](_0x53b9a0(0x8e),''),dropboxRestore[_0x53b9a0(0xca)][_0x53b9a0(0xcc)](_0x53b9a0(0xbd)),dropboxBackup['classList']['remove'](_0x53b9a0(0xbd)),dropboxCloud['classList'][_0x53b9a0(0xcc)](_0x53b9a0(0xbd)));}),handleDropboxCallback();});