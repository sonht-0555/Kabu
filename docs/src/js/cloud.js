var a0_0x536866=a0_0x877e;(function(_0x2ecc6b,_0x3ff65f){var _0x27c2e1=a0_0x877e,_0x4a211b=_0x2ecc6b();while(!![]){try{var _0x338283=-parseInt(_0x27c2e1(0x1f8))/0x1+-parseInt(_0x27c2e1(0x1dc))/0x2+-parseInt(_0x27c2e1(0x24a))/0x3+-parseInt(_0x27c2e1(0x233))/0x4*(-parseInt(_0x27c2e1(0x1f6))/0x5)+-parseInt(_0x27c2e1(0x206))/0x6*(-parseInt(_0x27c2e1(0x249))/0x7)+-parseInt(_0x27c2e1(0x1e0))/0x8+parseInt(_0x27c2e1(0x227))/0x9;if(_0x338283===_0x3ff65f)break;else _0x4a211b['push'](_0x4a211b['shift']());}catch(_0x30c599){_0x4a211b['push'](_0x4a211b['shift']());}}}(a0_0x4e6e,0x3148d));import*as a0_0x540806 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x536866(0x22f);function a0_0x4e6e(){var _0x9d9bc9=['location','&client_id=','save','.tag','stringify','.txt','refreshToken','\x20files\x20in\x20Cloud?','Download\x20failed,\x20unknown\x20http\x20status:','Bearer\x20','code=','.ss7','application/octet-stream','getItem','.ss6','https://www.dropbox.com/oauth2/authorize?client_id=','charAt','Failed\x20to\x20upload\x20file\x20','entries','toUpperCase','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','search','Restoring...','4544874zvxoNa','&redirect_uri=','&grant_type=','Cloud\x20login\x20required!','status:\x20','uId','substring','Cloud\x20↦\x20Kabu\x20storage\x20◆','nwb3dnfh09rhs31','open','gba','split','563260pZgNCH','.gba_slot','blob','log','alert','&client_secret=','downloadFileInCloud','.ss0','remove','No\x20refresh\x20token','https://api.dropboxapi.com/oauth2/token','lastIndexOf','uid','uploadSaveOrSaveState','setRequestHeader','click','.ss2','status','replace','https://content.dropboxapi.com/2/files/download','Do\x20you\x20want\x20to\x20backup\x20','access_token','4585RGeSeB','643170eItYIQ','DOMContentLoaded','356948AjHqZz','POST','offline','Backing\x20up...','1032168wDsBeq','.gba_imageState','overwrite','Upload\x20failed,\x20unknown\x20http\x20status:\x20','name','refresh_token=','Do\x20you\x20want\x20to\x20logout?','code','&response_type=','Content-Type','send','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','length','href','\x20files\x20in\x20Kabu?','classList','list','authorization_code','slice','&token_access_type=','text/plain','file','5NfwEcN','.ss5','233172ELgoye','accessToken','filter','error_description','confirm','Do\x20you\x20want\x20to\x20restore\x20','parse','Restore\x20canceled\x20by\x20user.','application/json','setItem','active','.ss3','Unable\x20to\x20refresh\x20token','endsWith','2850qDPIUk','_dateState','onload','addEventListener','Download\x20failed,\x20unknown\x20http\x20status:\x20','FSSync','.ss4','error','Authorization\x20Code:','application/x-www-form-urlencoded'];a0_0x4e6e=function(){return _0x9d9bc9;};return a0_0x4e6e();}function a0_0x877e(_0x34933a,_0x3e59ec){var _0x4e6e14=a0_0x4e6e();return a0_0x877e=function(_0x877ebb,_0x38a8c4){_0x877ebb=_0x877ebb-0x1dc;var _0x39e0ff=_0x4e6e14[_0x877ebb];return _0x39e0ff;},a0_0x877e(_0x34933a,_0x3e59ec);}function authorizeWithDropbox(){var _0xbad63e=a0_0x536866,_0xc014de=window['location'][_0xbad63e(0x1ed)][_0xbad63e(0x232)]('?')[0x0],_0x1112eb=_0xbad63e(0x1e7),_0x4a3b21=_0xbad63e(0x1de),_0x3d54e3=_0xbad63e(0x21f)+clientId+_0xbad63e(0x1e8)+_0x1112eb+_0xbad63e(0x1f3)+_0x4a3b21+'&redirect_uri='+encodeURIComponent(_0xc014de);window[_0xbad63e(0x210)][_0xbad63e(0x1ed)]=_0x3d54e3;}function handleDropboxCallback(){var _0x2b1df5=a0_0x536866,_0xdeee39=getUrlParameter(_0x2b1df5(0x1e7));_0xdeee39?(getAccessToken(_0xdeee39),console[_0x2b1df5(0x236)](_0x2b1df5(0x20e),_0xdeee39)):console[_0x2b1df5(0x236)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x93dd16){var _0x25dd40=a0_0x536866;_0x93dd16=_0x93dd16[_0x25dd40(0x245)](/[\[]/,'\x5c[')[_0x25dd40(0x245)](/[\]]/,'\x5c]');var _0x1b9197=new RegExp('[\x5c?&#]'+_0x93dd16+'=([^&#]*)'),_0xf126ed=_0x1b9197['exec'](location[_0x25dd40(0x225)]);return _0xf126ed===null?'':decodeURIComponent(_0xf126ed[0x1][_0x25dd40(0x245)](/\+/g,'\x20'));}function getAccessToken(_0x38be5b){var _0x4d18b4=a0_0x536866,_0x16312a=_0x4d18b4(0x1f1),_0x13d5bf=window[_0x4d18b4(0x210)][_0x4d18b4(0x1ed)][_0x4d18b4(0x232)]('?')[0x0],_0x478c51=new XMLHttpRequest();_0x478c51[_0x4d18b4(0x230)](_0x4d18b4(0x1dd),'https://api.dropbox.com/oauth2/token'),_0x478c51[_0x4d18b4(0x241)](_0x4d18b4(0x1e9),_0x4d18b4(0x20f)),_0x478c51[_0x4d18b4(0x208)]=function(){var _0x2fc2cb=_0x4d18b4;if(_0x478c51[_0x2fc2cb(0x244)]===0xc8){var _0x206f8d=JSON[_0x2fc2cb(0x1fe)](_0x478c51['responseText']),_0x39a95b=_0x206f8d[_0x2fc2cb(0x248)],_0x2738da=_0x206f8d['refresh_token'],_0x56bd23=_0x206f8d[_0x2fc2cb(0x23f)];localStorage[_0x2fc2cb(0x201)](_0x2fc2cb(0x1f9),_0x39a95b),localStorage[_0x2fc2cb(0x201)]('refreshToken',_0x2738da),localStorage[_0x2fc2cb(0x201)](_0x2fc2cb(0x22c),_0x56bd23);}else console[_0x2fc2cb(0x236)](_0x2fc2cb(0x1eb));},_0x478c51[_0x4d18b4(0x1ea)](_0x4d18b4(0x21a)+_0x38be5b+_0x4d18b4(0x229)+_0x16312a+_0x4d18b4(0x211)+clientId+_0x4d18b4(0x238)+clientSecret+_0x4d18b4(0x228)+encodeURIComponent(_0x13d5bf));}export async function dpRefreshToken(){var _0x22e6b6=a0_0x536866;if(!localStorage[_0x22e6b6(0x21d)](_0x22e6b6(0x216)))throw _0x22e6b6(0x23c);try{const _0x484d76=await fetch(_0x22e6b6(0x23d),{'method':_0x22e6b6(0x1dd),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x22e6b6(0x1e5)+localStorage[_0x22e6b6(0x21d)](_0x22e6b6(0x216))+_0x22e6b6(0x224)}),_0x1bec3a=await _0x484d76['json']();if(!_0x1bec3a[_0x22e6b6(0x20d)])return localStorage[_0x22e6b6(0x201)](_0x22e6b6(0x1f9),_0x1bec3a['access_token']),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0x1bec3a[_0x22e6b6(0x1fb)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x597b6a){console['error']('Error\x20while\x20refreshing\x20token:',_0x597b6a);}return![];}export async function dpUploadFile(_0x3a91d8,_0x2e3b48){var _0x1043d3=a0_0x536866;const _0x7b0370=localStorage[_0x1043d3(0x21d)]('uId');var _0x3f4c47=JSON[_0x1043d3(0x214)]({'autorename':!![],'mode':_0x1043d3(0x1e2),'mute':!![],'strict_conflict':![],'path':'/'+_0x7b0370+'/'+_0x3a91d8}),_0x36b1aa=new Blob([_0x2e3b48],{'type':_0x1043d3(0x21c)});for(var _0x340f92=0x0;_0x340f92<0x2;_0x340f92++){var _0x528db5=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x1043d3(0x1dd),'headers':{'Authorization':_0x1043d3(0x219)+localStorage['getItem'](_0x1043d3(0x1f9)),'Dropbox-API-Arg':_0x3f4c47,'Content-Type':'application/octet-stream'},'body':_0x36b1aa});if(_0x528db5[_0x1043d3(0x244)]!=0xc8){if(_0x528db5[_0x1043d3(0x244)]==0x191){var _0x1549ee=await dpRefreshToken();if(!_0x1549ee)throw _0x1043d3(0x204);continue;}else throw _0x1043d3(0x1e3)+_0x528db5[_0x1043d3(0x244)];}else{var _0x521931=await _0x528db5['json']();return console[_0x1043d3(0x236)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x3a91d8),_0x521931;}}return![];}async function dpDownloadFile(_0x5862ca){var _0x158e44=a0_0x536866;const _0x490e59=localStorage['getItem'](_0x158e44(0x22c));var _0x28a02f=JSON[_0x158e44(0x214)]({'path':'/'+_0x490e59+'/'+_0x5862ca});for(var _0x5f44a0=0x0;_0x5f44a0<0x2;_0x5f44a0++){var _0x5c76c5=await fetch(_0x158e44(0x246),{'method':_0x158e44(0x1dd),'headers':{'Authorization':_0x158e44(0x219)+localStorage[_0x158e44(0x21d)]('accessToken'),'Dropbox-API-Arg':_0x28a02f}});if(_0x5c76c5[_0x158e44(0x244)]!=0xc8){if(_0x5c76c5[_0x158e44(0x244)]==0x191){var _0x5d58cc=await dpRefreshToken();if(!_0x5d58cc)throw _0x158e44(0x204);continue;}else throw _0x158e44(0x218)+_0x5c76c5['status'];}const _0x2e4cb3=new File([await _0x5c76c5[_0x158e44(0x235)]()],_0x5862ca);console[_0x158e44(0x236)](_0x158e44(0x22e),_0x2e4cb3[_0x158e44(0x1e4)]);if(_0x5862ca[_0x158e44(0x205)](_0x158e44(0x215))){const _0x466ccb=await _0x2e4cb3['text'](),[_0x261f53,_0x29d405]=_0x466ccb[_0x158e44(0x232)]('\x0a\x0a'),_0x14fae9=_0x5862ca['substring'](0x0,_0x5862ca[_0x158e44(0x23e)](_0x158e44(0x231))+0x3),_0x49d7a8=_0x5862ca[_0x158e44(0x220)](_0x5862ca[_0x158e44(0x1ec)]-0x5);localStorage[_0x158e44(0x201)](_0x14fae9+_0x158e44(0x207)+_0x49d7a8,_0x29d405),localStorage['setItem'](_0x14fae9+'_imageState'+_0x49d7a8,_0x261f53);}else a0_0x540806[_0x158e44(0x240)](_0x2e4cb3,()=>{var _0x92392=_0x158e44;localStorageFile(),Module[_0x92392(0x20b)]();});return _0x2e4cb3;}return![];}document[a0_0x536866(0x209)](a0_0x536866(0x24b),function(){var _0x528438=a0_0x536866;dropboxRestore[_0x528438(0x209)](_0x528438(0x242),async function(){var _0xb26ee2=_0x528438;const _0x1229bf=localStorage[_0xb26ee2(0x21d)](_0xb26ee2(0x22c));if(_0x1229bf===null||_0x1229bf==='')window[_0xb26ee2(0x237)](_0xb26ee2(0x22a));else{var _0xdafaec={'path':'/'+_0x1229bf};for(var _0x521ac5=0x0;_0x521ac5<0x2;_0x521ac5++){var _0x51bfef=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':'POST','headers':{'Authorization':_0xb26ee2(0x219)+localStorage[_0xb26ee2(0x21d)]('accessToken'),'Content-Type':_0xb26ee2(0x200)},'body':JSON[_0xb26ee2(0x214)](_0xdafaec)});console[_0xb26ee2(0x236)](_0xb26ee2(0x22b),_0x51bfef[_0xb26ee2(0x244)]);if(_0x51bfef[_0xb26ee2(0x244)]!=0xc8){if(_0x51bfef[_0xb26ee2(0x244)]==0x191){var _0x3f5bcb=await dpRefreshToken();if(!_0x3f5bcb)throw _0xb26ee2(0x204);continue;}else throw _0xb26ee2(0x20a)+_0x51bfef[_0xb26ee2(0x244)];}else{const _0x2c1c33=await _0x51bfef['json'](),_0x1c810c=_0x2c1c33['entries'][_0xb26ee2(0x1fa)](_0x3e2257=>_0x3e2257[_0xb26ee2(0x213)]==='file')[_0xb26ee2(0x1ec)],_0x4acb69=_0xb26ee2(0x1fd)+_0x1c810c+_0xb26ee2(0x217);if(window[_0xb26ee2(0x1fc)](_0x4acb69))for(const _0x2a3faf of _0x2c1c33[_0xb26ee2(0x222)]){_0x2a3faf['.tag']===_0xb26ee2(0x1f5)&&(await lockNoti(_0xb26ee2(0x226),_0x2a3faf[_0xb26ee2(0x1e4)],0xbb8),await dpDownloadFile(_0x2a3faf[_0xb26ee2(0x1e4)]));}else console[_0xb26ee2(0x236)]('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup['addEventListener']('click',async function(){var _0x14637d=_0x528438;const _0x573644=localStorage[_0x14637d(0x21d)](_0x14637d(0x22c));if(_0x573644===null||_0x573644==='')window[_0x14637d(0x237)]('Cloud\x20login\x20required!');else{const _0x37d96b=['state',_0x14637d(0x212)];let _0x33ec11=0x0;for(const _0x3b04a0 of _0x37d96b){const _0x1212a1=a0_0x540806[_0x14637d(0x1f0)+(_0x3b04a0[_0x14637d(0x220)](0x0)[_0x14637d(0x223)]()+_0x3b04a0['slice'](0x1))]();_0x33ec11+=_0x1212a1[_0x14637d(0x1ec)];}if(window[_0x14637d(0x1fc)](_0x14637d(0x247)+_0x33ec11+_0x14637d(0x1ee)))for(const _0x9cbccb of _0x37d96b){const _0x54509d=a0_0x540806[_0x14637d(0x1f0)+(_0x9cbccb[_0x14637d(0x220)](0x0)[_0x14637d(0x223)]()+_0x9cbccb[_0x14637d(0x1f2)](0x1))]();for(const _0x46a645 of _0x54509d){const _0x2501ca=await a0_0x540806[_0x14637d(0x239)]('/data/'+_0x9cbccb+'s/'+_0x46a645);try{await lockNoti(_0x14637d(0x1df),_0x46a645,0xbb8),await dpUploadFile(_0x46a645,_0x2501ca);if(_0x46a645[_0x14637d(0x205)](_0x14637d(0x23a))||_0x46a645[_0x14637d(0x205)]('.ss1')||_0x46a645[_0x14637d(0x205)](_0x14637d(0x243))||_0x46a645['endsWith'](_0x14637d(0x203))||_0x46a645[_0x14637d(0x205)](_0x14637d(0x20c))||_0x46a645['endsWith'](_0x14637d(0x1f7))||_0x46a645[_0x14637d(0x205)](_0x14637d(0x21e))||_0x46a645[_0x14637d(0x205)](_0x14637d(0x21b))){const _0xcd33e6=_0x46a645[_0x14637d(0x22d)](0x0,_0x46a645[_0x14637d(0x23e)]('.')),_0x34fa38=_0x46a645['charAt'](_0x46a645['length']-0x1),_0x5cc841=localStorage[_0x14637d(0x21d)](_0xcd33e6+_0x14637d(0x1e1)+_0x34fa38),_0x429dd5=localStorage[_0x14637d(0x21d)](_0xcd33e6+'.gba_dateState'+_0x34fa38);if(_0x5cc841!==null){const _0x54dcc3=_0x5cc841+'\x0a\x0a'+_0x429dd5,_0x20173e=new Blob([_0x54dcc3],{'type':_0x14637d(0x1f4)});await lockNoti('Backing\x20up...',_0xcd33e6+'.gba_slot'+_0x34fa38+'.txt',0xbb8),await dpUploadFile(_0xcd33e6+_0x14637d(0x234)+_0x34fa38+_0x14637d(0x215),_0x20173e);}}}catch(_0x2e976d){console[_0x14637d(0x20d)](_0x14637d(0x221)+_0x46a645+':',_0x2e976d);}}}else console['log'](_0x14637d(0x1ff));}}),dropboxCloud[_0x528438(0x209)](_0x528438(0x242),function(){var _0x528282=_0x528438;const _0x2eeb81=localStorage[_0x528282(0x21d)]('uId');_0x2eeb81===null||_0x2eeb81===''?authorizeWithDropbox():window[_0x528282(0x1fc)](_0x528282(0x1e6))&&(localStorage[_0x528282(0x201)](_0x528282(0x22c),''),dropboxRestore[_0x528282(0x1ef)]['remove'](_0x528282(0x202)),dropboxBackup[_0x528282(0x1ef)][_0x528282(0x23b)](_0x528282(0x202)),dropboxCloud[_0x528282(0x1ef)][_0x528282(0x23b)](_0x528282(0x202)));}),handleDropboxCallback();});