var a0_0x228d20=a0_0x29c6;(function(_0x3a8656,_0x2870f2){var _0x42dcd8=a0_0x29c6,_0x2b3dce=_0x3a8656();while(!![]){try{var _0xd320c1=parseInt(_0x42dcd8(0xb7))/0x1+-parseInt(_0x42dcd8(0xa2))/0x2+parseInt(_0x42dcd8(0xae))/0x3*(-parseInt(_0x42dcd8(0x6b))/0x4)+parseInt(_0x42dcd8(0xc6))/0x5*(parseInt(_0x42dcd8(0xc3))/0x6)+-parseInt(_0x42dcd8(0xb3))/0x7+-parseInt(_0x42dcd8(0xb5))/0x8+-parseInt(_0x42dcd8(0xca))/0x9*(-parseInt(_0x42dcd8(0xc4))/0xa);if(_0xd320c1===_0x2870f2)break;else _0x2b3dce['push'](_0x2b3dce['shift']());}catch(_0x2007b9){_0x2b3dce['push'](_0x2b3dce['shift']());}}}(a0_0x5c82,0xeb7da));import*as a0_0x418c84 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x228d20(0xc8),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x4df8be=a0_0x228d20,_0x3cbf97=window[_0x4df8be(0x7f)][_0x4df8be(0x73)][_0x4df8be(0xbb)]('?')[0x0],_0x4f73c8=_0x4df8be(0x97),_0x1a2ccd=_0x4df8be(0x69),_0x5d5093=_0x4df8be(0x8a)+clientId+_0x4df8be(0xce)+_0x4f73c8+'&token_access_type='+_0x1a2ccd+'&redirect_uri='+encodeURIComponent(_0x3cbf97);window['location'][_0x4df8be(0x73)]=_0x5d5093;}function handleDropboxCallback(){var _0x5547a4=a0_0x228d20,_0x5d3968=getUrlParameter(_0x5547a4(0x97));_0x5d3968?(getAccessToken(_0x5d3968),console['log']('Authorization\x20Code:',_0x5d3968)):console[_0x5547a4(0xb9)](_0x5547a4(0xac));}function getUrlParameter(_0x42cac6){var _0xf1387b=a0_0x228d20;_0x42cac6=_0x42cac6[_0xf1387b(0xb8)](/[\[]/,'\x5c[')[_0xf1387b(0xb8)](/[\]]/,'\x5c]');var _0x45ef38=new RegExp(_0xf1387b(0x66)+_0x42cac6+_0xf1387b(0x7e)),_0x59e538=_0x45ef38[_0xf1387b(0xc1)](location[_0xf1387b(0x90)]);return _0x59e538===null?'':decodeURIComponent(_0x59e538[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x72df7e){var _0x5ce2bd=a0_0x228d20,_0x280bfa='authorization_code',_0x48d9a7=window[_0x5ce2bd(0x7f)][_0x5ce2bd(0x73)][_0x5ce2bd(0xbb)]('?')[0x0],_0x8ccbba=new XMLHttpRequest();_0x8ccbba[_0x5ce2bd(0xbf)](_0x5ce2bd(0xad),_0x5ce2bd(0x71)),_0x8ccbba[_0x5ce2bd(0xa9)](_0x5ce2bd(0xaf),_0x5ce2bd(0x68)),_0x8ccbba[_0x5ce2bd(0xa0)]=function(){var _0x2e944c=_0x5ce2bd;if(_0x8ccbba[_0x2e944c(0x76)]===0xc8){var _0x52834c=JSON[_0x2e944c(0x95)](_0x8ccbba[_0x2e944c(0x7c)]),_0x372738=_0x52834c[_0x2e944c(0x6d)],_0x3a3e48=_0x52834c[_0x2e944c(0xb1)],_0x4960f3=_0x52834c[_0x2e944c(0xcb)];localStorage[_0x2e944c(0x92)]('accessToken',_0x372738),localStorage['setItem'](_0x2e944c(0x99),_0x3a3e48),localStorage[_0x2e944c(0x92)](_0x2e944c(0xab),_0x4960f3);}else console['log'](_0x2e944c(0xba));},_0x8ccbba[_0x5ce2bd(0x70)](_0x5ce2bd(0x8c)+_0x72df7e+_0x5ce2bd(0x9b)+_0x280bfa+_0x5ce2bd(0x85)+clientId+'&client_secret='+clientSecret+_0x5ce2bd(0xb4)+encodeURIComponent(_0x48d9a7));}function a0_0x29c6(_0x257f15,_0x26b9b8){var _0x5c82b7=a0_0x5c82();return a0_0x29c6=function(_0x29c66c,_0x49728d){_0x29c66c=_0x29c66c-0x66;var _0x1728e1=_0x5c82b7[_0x29c66c];return _0x1728e1;},a0_0x29c6(_0x257f15,_0x26b9b8);}function a0_0x5c82(){var _0x4c7757=['status','Folder\x20already\x20exists','error_description','Restore\x20canceled\x20by\x20user.','stringify','remove','responseText','.tag','=([^&#]*)','location','json','blob','\x20files\x20in\x20Kabu?','folder','https://content.dropboxapi.com/2/files/download','&client_id=','charAt','alert','entries','application/json','https://www.dropbox.com/oauth2/authorize?client_id=','Wait\x20a\x20little\x20bit...','code=','active','list','classList','search','Do\x20you\x20want\x20to\x20restore\x20','setItem','Restoring...','map','parse','uploadFileInCloud','code','\x20files\x20from\x20Cloud?','refreshToken','Cloud\x20login\x20required!','&grant_type=','No\x20files\x20found\x20to\x20restore.','Error\x20while\x20refreshing\x20token:','confirm','file','onload','Failed\x20to\x20upload\x20file\x20','3784316ifToHU','click','https://api.dropboxapi.com/2/files/create_folder_v2','filter','Do\x20you\x20want\x20to\x20backup\x20','Unable\x20to\x20refresh\x20token','accessToken','setRequestHeader','https://api.dropboxapi.com/2/files/list_folder','uId','Do\x20not\x20receive\x20authorization','POST','13629EkRbOV','Content-Type','error','refresh_token','Error\x20creating\x20folder\x20','12441499whbJio','&redirect_uri=','8204512fMoVEE','save','968000vroTqX','replace','log','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','split','screenshot','length','FSSync','open','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','exec','Cloud\x20↦\x20Kabu\x20storage\x20◆','6MPqXWu','57307650XAnlIQ',',\x20status:\x20','6155VGKoeZ','name','knh3uz2mx2hp2eu','Bearer\x20','9HAaHYx','uid','getItem','Download\x20failed,\x20unknown\x20http\x20status:','&response_type=','[\x5c?&#]','https://content.dropboxapi.com/2/files/upload','application/x-www-form-urlencoded','offline','DOMContentLoaded','916QKSflP','slice','access_token','Download\x20failed\x20for\x20','https://api.dropboxapi.com/oauth2/token','send','https://api.dropbox.com/oauth2/token','application/octet-stream','href','state','Do\x20you\x20want\x20to\x20logout?'];a0_0x5c82=function(){return _0x4c7757;};return a0_0x5c82();}export async function dpCreateFolder(_0x468288){var _0x5492d6=a0_0x228d20;const _0x295be6=localStorage[_0x5492d6(0xcc)](_0x5492d6(0xab));let _0x3779eb=localStorage['getItem'](_0x5492d6(0xa8));const _0x12144d='/'+_0x295be6+'/'+_0x468288,_0x19f9e6=JSON[_0x5492d6(0x7a)]({'path':_0x12144d,'autorename':![]});for(let _0x2ac007=0x0;_0x2ac007<0x2;_0x2ac007++){try{const _0x89f86a=await fetch(_0x5492d6(0xa4),{'method':_0x5492d6(0xad),'headers':{'Authorization':_0x5492d6(0xc9)+_0x3779eb,'Content-Type':_0x5492d6(0x89)},'body':_0x19f9e6});if(_0x89f86a[_0x5492d6(0x76)]===0x191){const _0x53fe58=await dpRefreshToken();if(!_0x53fe58)throw new Error(_0x5492d6(0xa7));_0x3779eb=localStorage[_0x5492d6(0xcc)](_0x5492d6(0xa8));continue;}if(_0x89f86a[_0x5492d6(0x76)]===0x199)return{'message':_0x5492d6(0x77),'path':_0x468288};if(!_0x89f86a['ok'])throw new Error(_0x5492d6(0xb2)+_0x468288);const _0x4f0440=await _0x89f86a[_0x5492d6(0x80)]();return await lockNoti('Folder\x20created','',0xbb8),_0x4f0440;}catch(_0x3d6b4e){if(_0x2ac007===0x1)throw _0x3d6b4e;}}return![];}export async function dpRefreshToken(){var _0x5b97de=a0_0x228d20;if(!localStorage[_0x5b97de(0xcc)](_0x5b97de(0x99)))throw'No\x20refresh\x20token';try{const _0x16ad61=await fetch(_0x5b97de(0x6f),{'method':_0x5b97de(0xad),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x5b97de(0xcc)](_0x5b97de(0x99))+_0x5b97de(0xc0)}),_0x3e5e37=await _0x16ad61[_0x5b97de(0x80)]();if(!_0x3e5e37['error'])return localStorage[_0x5b97de(0x92)](_0x5b97de(0xa8),_0x3e5e37[_0x5b97de(0x6d)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x3e5e37[_0x5b97de(0x78)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x3ce1a7){console['error'](_0x5b97de(0x9d),_0x3ce1a7);}return![];}export async function dpUploadFile(_0x64f0d9,_0x5635fe,_0x349bdd){var _0x43b44c=a0_0x228d20;const _0x4671ec=localStorage['getItem'](_0x43b44c(0xab));var _0x7fbb55=JSON[_0x43b44c(0x7a)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x4671ec+'/'+_0x349bdd+'/'+_0x64f0d9}),_0x388fe9=new Blob([_0x5635fe],{'type':'application/octet-stream'});for(var _0x121eba=0x0;_0x121eba<0x2;_0x121eba++){var _0x2ed13b=await fetch(_0x43b44c(0x67),{'method':_0x43b44c(0xad),'headers':{'Authorization':_0x43b44c(0xc9)+localStorage[_0x43b44c(0xcc)](_0x43b44c(0xa8)),'Dropbox-API-Arg':_0x7fbb55,'Content-Type':_0x43b44c(0x72)},'body':_0x388fe9});if(_0x2ed13b[_0x43b44c(0x76)]!=0xc8){if(_0x2ed13b[_0x43b44c(0x76)]==0x191){var _0x147f3f=await dpRefreshToken();if(!_0x147f3f)throw _0x43b44c(0xa7);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x2ed13b[_0x43b44c(0x76)];}else{var _0x34c59e=await _0x2ed13b[_0x43b44c(0x80)]();return console[_0x43b44c(0xb9)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x64f0d9),_0x34c59e;}}return![];}export async function dpDownloadFile(_0x1ec835,_0x1c884d){var _0x2bc825=a0_0x228d20;const _0x425652=localStorage[_0x2bc825(0xcc)](_0x2bc825(0xab));var _0x1cc7cc=JSON[_0x2bc825(0x7a)]({'path':'/'+_0x425652+'/'+_0x1c884d+'/'+_0x1ec835});for(var _0x399aa2=0x0;_0x399aa2<0x2;_0x399aa2++){var _0x136012=await fetch(_0x2bc825(0x84),{'method':_0x2bc825(0xad),'headers':{'Authorization':_0x2bc825(0xc9)+localStorage[_0x2bc825(0xcc)](_0x2bc825(0xa8)),'Dropbox-API-Arg':_0x1cc7cc}});if(_0x136012[_0x2bc825(0x76)]!=0xc8){if(_0x136012[_0x2bc825(0x76)]==0x191){var _0x3f9a72=await dpRefreshToken();if(!_0x3f9a72)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x2bc825(0xcd)+_0x136012['status'];}const _0x2f4059=new File([await _0x136012[_0x2bc825(0x81)]()],_0x1ec835);return console[_0x2bc825(0xb9)](_0x2bc825(0xc2),_0x2f4059['name']),a0_0x418c84[_0x2bc825(0x96)](_0x2f4059,()=>{var _0x58ef16=_0x2bc825;localStorageFile(),Module[_0x58ef16(0xbe)]();}),_0x2f4059;}return![];}document['addEventListener'](a0_0x228d20(0x6a),function(){var _0x2e8ca6=a0_0x228d20;dropboxRestore['addEventListener']('click',async function(){var _0x40d186=a0_0x29c6;await lockNoti(_0x40d186(0x8b),'',0x1388);const _0x5f462c=localStorage[_0x40d186(0xcc)](_0x40d186(0xab)),_0x65d8c9=[_0x40d186(0x74),_0x40d186(0xb6),'screenshot'];if(!_0x5f462c){window[_0x40d186(0x87)]('Cloud\x20login\x20required!');return;}let _0x741e72=[];for(const _0x4a4373 of _0x65d8c9){let _0x9b822c={'path':'/'+_0x5f462c+'/'+_0x4a4373};for(let _0x2e5344=0x0;_0x2e5344<0x2;_0x2e5344++){let _0x3eae5d=await fetch(_0x40d186(0xaa),{'method':'POST','headers':{'Authorization':_0x40d186(0xc9)+localStorage['getItem'](_0x40d186(0xa8)),'Content-Type':_0x40d186(0x89)},'body':JSON[_0x40d186(0x7a)](_0x9b822c)});if(_0x3eae5d[_0x40d186(0x76)]===0xc8){let _0x326138=await _0x3eae5d[_0x40d186(0x80)](),_0x27ad26=_0x326138[_0x40d186(0x88)][_0x40d186(0xa5)](_0x213524=>_0x213524[_0x40d186(0x7d)]===_0x40d186(0x9f));_0x27ad26['length']>0x0&&_0x741e72['push'](..._0x27ad26[_0x40d186(0x94)](_0x535e92=>({'name':_0x535e92[_0x40d186(0xc7)],'folder':_0x4a4373})));break;}else{if(_0x3eae5d[_0x40d186(0x76)]===0x191){let _0x1bc950=await dpRefreshToken();if(!_0x1bc950)throw _0x40d186(0xa7);}else{console[_0x40d186(0xb0)](_0x40d186(0x6e)+_0x4a4373+_0x40d186(0xc5)+_0x3eae5d['status']);break;}}}}if(_0x741e72[_0x40d186(0xbd)]>0x0){const _0x55a4c8=_0x40d186(0x91)+_0x741e72['length']+_0x40d186(0x98);if(window['confirm'](_0x55a4c8))for(const _0x563179 of _0x741e72){await lockNoti(_0x40d186(0x93),_0x563179[_0x40d186(0xc7)],0xbb8),await dpDownloadFile(_0x563179[_0x40d186(0xc7)],_0x563179[_0x40d186(0x83)]);}else console['log'](_0x40d186(0x79));}else console[_0x40d186(0xb9)](_0x40d186(0x9c));}),dropboxBackup['addEventListener'](_0x2e8ca6(0xa3),async function(){var _0x5680cb=_0x2e8ca6;await lockNoti(_0x5680cb(0x8b),'',0x1388);const _0x24f168=localStorage[_0x5680cb(0xcc)](_0x5680cb(0xab));if(_0x24f168===null||_0x24f168==='')window[_0x5680cb(0x87)](_0x5680cb(0x9a));else{const _0x389ed5=[_0x5680cb(0x74),_0x5680cb(0xb6),_0x5680cb(0xbc)];for(const _0x43df72 of _0x389ed5){await dpCreateFolder(_0x43df72);}let _0x251a37=0x0;for(const _0x2c2c1f of _0x389ed5){const _0x11a015=a0_0x418c84['list'+(_0x2c2c1f[_0x5680cb(0x86)](0x0)['toUpperCase']()+_0x2c2c1f['slice'](0x1))]();_0x251a37+=_0x11a015[_0x5680cb(0xbd)];}if(window[_0x5680cb(0x9e)](_0x5680cb(0xa6)+_0x251a37+_0x5680cb(0x82)))for(const _0x59806c of _0x389ed5){const _0x4c3855=a0_0x418c84[_0x5680cb(0x8e)+(_0x59806c[_0x5680cb(0x86)](0x0)['toUpperCase']()+_0x59806c[_0x5680cb(0x6c)](0x1))]();for(const _0x1918c7 of _0x4c3855){const _0x1000ca=await a0_0x418c84['downloadFileInCloud']('/data/'+_0x59806c+'s/'+_0x1918c7);try{await lockNoti('Backing\x20up...',_0x1918c7,0xbb8),await dpUploadFile(_0x1918c7,_0x1000ca,_0x59806c);}catch(_0x52b9a5){console['error'](_0x5680cb(0xa1)+_0x1918c7+':',_0x52b9a5);}}}else console[_0x5680cb(0xb9)](_0x5680cb(0x79));}}),dropboxCloud['addEventListener']('click',function(){var _0x46b35a=_0x2e8ca6;const _0x43de32=localStorage[_0x46b35a(0xcc)](_0x46b35a(0xab));_0x43de32===null||_0x43de32===''?authorizeWithDropbox():window[_0x46b35a(0x9e)](_0x46b35a(0x75))&&(localStorage[_0x46b35a(0x92)](_0x46b35a(0xab),''),dropboxRestore[_0x46b35a(0x8f)]['remove']('active'),dropboxBackup['classList'][_0x46b35a(0x7b)](_0x46b35a(0x8d)),dropboxCloud[_0x46b35a(0x8f)]['remove'](_0x46b35a(0x8d)));}),handleDropboxCallback();});