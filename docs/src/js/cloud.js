var a0_0x263f6d=a0_0xfcf9;function a0_0x3982(){var _0x24b9b7=['Restoring...','stringify','https://api.dropboxapi.com/oauth2/token','setItem','map','log','36296733kckiRP','access_token','exec','screenshot','refreshToken','1166417TZfqJr','blob','[\x5c?&#]','&redirect_uri=','toUpperCase','uid','accessToken','10tMZPtu','split','7201936XEvMjP','open','nwb3dnfh09rhs31','downloadFileInCloud','&response_type=','https://api.dropbox.com/oauth2/token','active','replace','\x20files\x20in\x20Kabu?','Kabu\x20storage\x20↦\x20Cloud\x20◆','error_description','entries','parse','FSSync','onload','send','Download\x20failed\x20for\x20','59986jWMJHn','8mmJsru','Download\x20failed,\x20unknown\x20http\x20status:','json','setRequestHeader','addEventListener','&grant_type=','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','href','No\x20refresh\x20token','Do\x20not\x20receive\x20authorization','Cloud\x20login\x20required!','remove','offline','https://content.dropboxapi.com/2/files/upload','Do\x20you\x20want\x20to\x20backup\x20','Bearer\x20','POST','69ldyFId','confirm','uploadFileInCloud','https://api.dropboxapi.com/2/files/create_folder_v2','folder','/data/','1700577rXsmmj','name','getItem','application/x-www-form-urlencoded','application/octet-stream','No\x20files\x20found\x20to\x20restore.','uId','.tag','Error\x20creating\x20folder\x20','https://www.dropbox.com/oauth2/authorize?client_id=','error','length','Folder\x20already\x20exists','Cloud\x20↦\x20Kabu\x20storage\x20◆','Backing\x20up...','knh3uz2mx2hp2eu','&client_secret=','status','location','push','alert','Restore\x20canceled\x20by\x20user.','&client_id=','search','save','application/json','filter','Content-Type','763385ZLmjrr','https://content.dropboxapi.com/2/files/download','Do\x20you\x20want\x20to\x20restore\x20','code','slice','list','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','12EmETif','click',',\x20status:\x20','responseText','classList','8237859EPlXLz','Error\x20while\x20refreshing\x20token:','charAt','Wait\x20a\x20little\x20bit...','Unable\x20to\x20refresh\x20token','&token_access_type='];a0_0x3982=function(){return _0x24b9b7;};return a0_0x3982();}(function(_0x150b3a,_0x47badd){var _0x4c0f33=a0_0xfcf9,_0x23b495=_0x150b3a();while(!![]){try{var _0x561406=parseInt(_0x4c0f33(0x139))/0x1+-parseInt(_0x4c0f33(0x153))/0x2*(parseInt(_0x4c0f33(0xfa))/0x3)+-parseInt(_0x4c0f33(0x142))/0x4+-parseInt(_0x4c0f33(0x11c))/0x5*(-parseInt(_0x4c0f33(0x123))/0x6)+parseInt(_0x4c0f33(0x128))/0x7*(-parseInt(_0x4c0f33(0x154))/0x8)+parseInt(_0x4c0f33(0x100))/0x9*(-parseInt(_0x4c0f33(0x140))/0xa)+parseInt(_0x4c0f33(0x134))/0xb;if(_0x561406===_0x47badd)break;else _0x23b495['push'](_0x23b495['shift']());}catch(_0x40cf0b){_0x23b495['push'](_0x23b495['shift']());}}}(a0_0x3982,0xdf7a1));import*as a0_0xd55224 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x263f6d(0x10f),clientSecret=a0_0x263f6d(0x144);function authorizeWithDropbox(){var _0x30d29a=a0_0x263f6d,_0x2bcdb7=window[_0x30d29a(0x112)][_0x30d29a(0x15b)][_0x30d29a(0x141)]('?')[0x0],_0x1358eb=_0x30d29a(0x11f),_0x447c83=_0x30d29a(0x160),_0x45152e=_0x30d29a(0x109)+clientId+_0x30d29a(0x146)+_0x1358eb+_0x30d29a(0x12d)+_0x447c83+_0x30d29a(0x13c)+encodeURIComponent(_0x2bcdb7);window[_0x30d29a(0x112)][_0x30d29a(0x15b)]=_0x45152e;}function handleDropboxCallback(){var _0x2247f9=a0_0x263f6d,_0x5c2e29=getUrlParameter(_0x2247f9(0x11f));_0x5c2e29?(getAccessToken(_0x5c2e29),console[_0x2247f9(0x133)]('Authorization\x20Code:',_0x5c2e29)):console[_0x2247f9(0x133)](_0x2247f9(0x15d));}function getUrlParameter(_0x5370fb){var _0x49775e=a0_0x263f6d;_0x5370fb=_0x5370fb['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x432831=new RegExp(_0x49775e(0x13b)+_0x5370fb+'=([^&#]*)'),_0x5851a4=_0x432831[_0x49775e(0x136)](location[_0x49775e(0x117)]);return _0x5851a4===null?'':decodeURIComponent(_0x5851a4[0x1][_0x49775e(0x149)](/\+/g,'\x20'));}function a0_0xfcf9(_0x4196e0,_0x6ba7ed){var _0x398240=a0_0x3982();return a0_0xfcf9=function(_0xfcf955,_0x26312d){_0xfcf955=_0xfcf955-0xf6;var _0xa34e2f=_0x398240[_0xfcf955];return _0xa34e2f;},a0_0xfcf9(_0x4196e0,_0x6ba7ed);}function getAccessToken(_0x502a40){var _0x1c25dc=a0_0x263f6d,_0x547e19='authorization_code',_0x135023=window[_0x1c25dc(0x112)][_0x1c25dc(0x15b)][_0x1c25dc(0x141)]('?')[0x0],_0x2e4fbe=new XMLHttpRequest();_0x2e4fbe[_0x1c25dc(0x143)](_0x1c25dc(0xf9),_0x1c25dc(0x147)),_0x2e4fbe[_0x1c25dc(0x157)](_0x1c25dc(0x11b),_0x1c25dc(0x103)),_0x2e4fbe[_0x1c25dc(0x150)]=function(){var _0x5b1961=_0x1c25dc;if(_0x2e4fbe[_0x5b1961(0x111)]===0xc8){var _0x380e5b=JSON[_0x5b1961(0x14e)](_0x2e4fbe[_0x5b1961(0x126)]),_0x50540d=_0x380e5b[_0x5b1961(0x135)],_0x41fc00=_0x380e5b['refresh_token'],_0x452614=_0x380e5b[_0x5b1961(0x13e)];localStorage[_0x5b1961(0x131)](_0x5b1961(0x13f),_0x50540d),localStorage[_0x5b1961(0x131)](_0x5b1961(0x138),_0x41fc00),localStorage['setItem'](_0x5b1961(0x106),_0x452614);}else console[_0x5b1961(0x133)](_0x5b1961(0x15a));},_0x2e4fbe[_0x1c25dc(0x151)]('code='+_0x502a40+_0x1c25dc(0x159)+_0x547e19+_0x1c25dc(0x116)+clientId+_0x1c25dc(0x110)+clientSecret+_0x1c25dc(0x13c)+encodeURIComponent(_0x135023));}export async function dpCreateFolder(_0x39ce1e){var _0x6ee6c8=a0_0x263f6d;const _0x2df660=localStorage[_0x6ee6c8(0x102)](_0x6ee6c8(0x106));let _0x2f54d1=localStorage[_0x6ee6c8(0x102)](_0x6ee6c8(0x13f));const _0x314560='/'+_0x2df660+'/'+_0x39ce1e,_0x25dc80=JSON[_0x6ee6c8(0x12f)]({'path':_0x314560,'autorename':![]});for(let _0x37e0c0=0x0;_0x37e0c0<0x2;_0x37e0c0++){try{const _0x5a2c15=await fetch(_0x6ee6c8(0xfd),{'method':_0x6ee6c8(0xf9),'headers':{'Authorization':_0x6ee6c8(0xf8)+_0x2f54d1,'Content-Type':_0x6ee6c8(0x119)},'body':_0x25dc80});if(_0x5a2c15[_0x6ee6c8(0x111)]===0x191){const _0x2eaed1=await dpRefreshToken();if(!_0x2eaed1)throw new Error(_0x6ee6c8(0x12c));_0x2f54d1=localStorage[_0x6ee6c8(0x102)](_0x6ee6c8(0x13f));continue;}if(_0x5a2c15['status']===0x199)return{'message':_0x6ee6c8(0x10c),'path':_0x39ce1e};if(!_0x5a2c15['ok'])throw new Error(_0x6ee6c8(0x108)+_0x39ce1e);const _0x1347e9=await _0x5a2c15[_0x6ee6c8(0x156)]();return await lockNoti('Folder\x20created','',0xbb8),_0x1347e9;}catch(_0xc41e84){if(_0x37e0c0===0x1)throw _0xc41e84;}}return![];}export async function dpRefreshToken(){var _0x4ef243=a0_0x263f6d;if(!localStorage[_0x4ef243(0x102)](_0x4ef243(0x138)))throw _0x4ef243(0x15c);try{const _0x748787=await fetch(_0x4ef243(0x130),{'method':_0x4ef243(0xf9),'headers':{'Content-Type':_0x4ef243(0x103)},'body':'refresh_token='+localStorage['getItem'](_0x4ef243(0x138))+_0x4ef243(0x122)}),_0x47c86e=await _0x748787[_0x4ef243(0x156)]();if(!_0x47c86e[_0x4ef243(0x10a)])return localStorage['setItem'](_0x4ef243(0x13f),_0x47c86e[_0x4ef243(0x135)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x47c86e[_0x4ef243(0x14c)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x33257b){console['error'](_0x4ef243(0x129),_0x33257b);}return![];}export async function dpUploadFile(_0x26f1ab,_0x1f248d,_0x361743){var _0xc4406e=a0_0x263f6d;const _0x2444ee=localStorage[_0xc4406e(0x102)](_0xc4406e(0x106));var _0x547554=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x2444ee+'/'+_0x361743+'/'+_0x26f1ab}),_0x1ab7c7=new Blob([_0x1f248d],{'type':_0xc4406e(0x104)});for(var _0x18f4fb=0x0;_0x18f4fb<0x2;_0x18f4fb++){var _0x469a94=await fetch(_0xc4406e(0xf6),{'method':_0xc4406e(0xf9),'headers':{'Authorization':_0xc4406e(0xf8)+localStorage[_0xc4406e(0x102)]('accessToken'),'Dropbox-API-Arg':_0x547554,'Content-Type':'application/octet-stream'},'body':_0x1ab7c7});if(_0x469a94['status']!=0xc8){if(_0x469a94[_0xc4406e(0x111)]==0x191){var _0x41518f=await dpRefreshToken();if(!_0x41518f)throw _0xc4406e(0x12c);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x469a94['status'];}else{var _0x4a0292=await _0x469a94[_0xc4406e(0x156)]();return console[_0xc4406e(0x133)](_0xc4406e(0x14b),_0x26f1ab),_0x4a0292;}}return![];}export async function dpDownloadFile(_0x557da3,_0x479cbc){var _0x32760d=a0_0x263f6d;const _0x362651=localStorage[_0x32760d(0x102)]('uId');var _0x4bc3e4=JSON['stringify']({'path':'/'+_0x362651+'/'+_0x479cbc+'/'+_0x557da3});for(var _0x3d60de=0x0;_0x3d60de<0x2;_0x3d60de++){var _0x2b2375=await fetch(_0x32760d(0x11d),{'method':_0x32760d(0xf9),'headers':{'Authorization':_0x32760d(0xf8)+localStorage['getItem'](_0x32760d(0x13f)),'Dropbox-API-Arg':_0x4bc3e4}});if(_0x2b2375[_0x32760d(0x111)]!=0xc8){if(_0x2b2375[_0x32760d(0x111)]==0x191){var _0x2a29ea=await dpRefreshToken();if(!_0x2a29ea)throw _0x32760d(0x12c);continue;}else throw _0x32760d(0x155)+_0x2b2375[_0x32760d(0x111)];}const _0x401af3=new File([await _0x2b2375[_0x32760d(0x13a)]()],_0x557da3);return console[_0x32760d(0x133)](_0x32760d(0x10d),_0x401af3[_0x32760d(0x101)]),a0_0xd55224[_0x32760d(0xfc)](_0x401af3,()=>{var _0x4b93e8=_0x32760d;localStorageFile(),Module[_0x4b93e8(0x14f)]();}),_0x401af3;}return![];}document['addEventListener']('DOMContentLoaded',function(){var _0x5a51ec=a0_0x263f6d;dropboxRestore[_0x5a51ec(0x158)](_0x5a51ec(0x124),async function(){var _0x5222c8=_0x5a51ec;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x3fbf6a=localStorage[_0x5222c8(0x102)]('uId'),_0x208fb4=['state',_0x5222c8(0x118),_0x5222c8(0x137)];if(!_0x3fbf6a){window[_0x5222c8(0x114)](_0x5222c8(0x15e));return;}let _0x45990b=[];for(const _0x128fd4 of _0x208fb4){let _0x2665e5={'path':'/'+_0x3fbf6a+'/'+_0x128fd4};for(let _0x44983a=0x0;_0x44983a<0x2;_0x44983a++){let _0x271b71=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x5222c8(0xf9),'headers':{'Authorization':_0x5222c8(0xf8)+localStorage['getItem'](_0x5222c8(0x13f)),'Content-Type':_0x5222c8(0x119)},'body':JSON[_0x5222c8(0x12f)](_0x2665e5)});if(_0x271b71[_0x5222c8(0x111)]===0xc8){let _0x47c495=await _0x271b71[_0x5222c8(0x156)](),_0x197281=_0x47c495[_0x5222c8(0x14d)][_0x5222c8(0x11a)](_0x18f69c=>_0x18f69c[_0x5222c8(0x107)]==='file');_0x197281[_0x5222c8(0x10b)]>0x0&&_0x45990b[_0x5222c8(0x113)](..._0x197281[_0x5222c8(0x132)](_0x3a87ae=>({'name':_0x3a87ae[_0x5222c8(0x101)],'folder':_0x128fd4})));break;}else{if(_0x271b71[_0x5222c8(0x111)]===0x191){let _0x4dfd2a=await dpRefreshToken();if(!_0x4dfd2a)throw _0x5222c8(0x12c);}else{console[_0x5222c8(0x10a)](_0x5222c8(0x152)+_0x128fd4+_0x5222c8(0x125)+_0x271b71[_0x5222c8(0x111)]);break;}}}}if(_0x45990b[_0x5222c8(0x10b)]>0x0){const _0x4a84dc=_0x5222c8(0x11e)+_0x45990b[_0x5222c8(0x10b)]+'\x20files\x20from\x20Cloud?';if(window[_0x5222c8(0xfb)](_0x4a84dc))for(const _0x3b6eee of _0x45990b){await lockNoti(_0x5222c8(0x12e),_0x3b6eee[_0x5222c8(0x101)],0xbb8),await dpDownloadFile(_0x3b6eee[_0x5222c8(0x101)],_0x3b6eee[_0x5222c8(0xfe)]);}else console[_0x5222c8(0x133)](_0x5222c8(0x115));}else console['log'](_0x5222c8(0x105));}),dropboxBackup[_0x5a51ec(0x158)]('click',async function(){var _0x1b122d=_0x5a51ec;await lockNoti(_0x1b122d(0x12b),'',0x1388);const _0x3cd95e=localStorage[_0x1b122d(0x102)](_0x1b122d(0x106));if(_0x3cd95e===null||_0x3cd95e==='')window[_0x1b122d(0x114)](_0x1b122d(0x15e));else{const _0x21be99=['state',_0x1b122d(0x118),_0x1b122d(0x137)];for(const _0x416f71 of _0x21be99){await dpCreateFolder(_0x416f71);}let _0x2bc734=0x0;for(const _0x12296e of _0x21be99){const _0x3da366=a0_0xd55224[_0x1b122d(0x121)+(_0x12296e['charAt'](0x0)[_0x1b122d(0x13d)]()+_0x12296e['slice'](0x1))]();_0x2bc734+=_0x3da366['length'];}if(window[_0x1b122d(0xfb)](_0x1b122d(0xf7)+_0x2bc734+_0x1b122d(0x14a)))for(const _0x14ffc0 of _0x21be99){const _0x6d5562=a0_0xd55224[_0x1b122d(0x121)+(_0x14ffc0[_0x1b122d(0x12a)](0x0)[_0x1b122d(0x13d)]()+_0x14ffc0[_0x1b122d(0x120)](0x1))]();for(const _0x1caaca of _0x6d5562){const _0x5834a0=await a0_0xd55224[_0x1b122d(0x145)](_0x1b122d(0xff)+_0x14ffc0+'s/'+_0x1caaca);try{await lockNoti(_0x1b122d(0x10e),_0x1caaca,0xbb8),await dpUploadFile(_0x1caaca,_0x5834a0,_0x14ffc0);}catch(_0x329d92){console[_0x1b122d(0x10a)]('Failed\x20to\x20upload\x20file\x20'+_0x1caaca+':',_0x329d92);}}}else console[_0x1b122d(0x133)](_0x1b122d(0x115));}}),dropboxCloud['addEventListener'](_0x5a51ec(0x124),function(){var _0x2bf096=_0x5a51ec;const _0x26a370=localStorage[_0x2bf096(0x102)](_0x2bf096(0x106));_0x26a370===null||_0x26a370===''?authorizeWithDropbox():window['confirm']('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x2bf096(0x131)](_0x2bf096(0x106),''),dropboxRestore[_0x2bf096(0x127)][_0x2bf096(0x15f)](_0x2bf096(0x148)),dropboxBackup[_0x2bf096(0x127)][_0x2bf096(0x15f)](_0x2bf096(0x148)),dropboxCloud[_0x2bf096(0x127)]['remove'](_0x2bf096(0x148)));}),handleDropboxCallback();});