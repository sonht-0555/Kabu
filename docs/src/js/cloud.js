var a0_0x27d182=a0_0x4a2f;(function(_0x33df05,_0x7994ee){var _0x163b5b=a0_0x4a2f,_0x4aae23=_0x33df05();while(!![]){try{var _0x56ee51=-parseInt(_0x163b5b(0x1d0))/0x1+-parseInt(_0x163b5b(0x21b))/0x2+-parseInt(_0x163b5b(0x1f9))/0x3*(-parseInt(_0x163b5b(0x1e5))/0x4)+parseInt(_0x163b5b(0x1ed))/0x5*(-parseInt(_0x163b5b(0x1f3))/0x6)+-parseInt(_0x163b5b(0x221))/0x7+parseInt(_0x163b5b(0x1fc))/0x8+parseInt(_0x163b5b(0x1c2))/0x9;if(_0x56ee51===_0x7994ee)break;else _0x4aae23['push'](_0x4aae23['shift']());}catch(_0x59c533){_0x4aae23['push'](_0x4aae23['shift']());}}}(a0_0x3e02,0xbe8f7));import*as a0_0x495fef from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x27d182(0x1c6);function authorizeWithDropbox(){var _0x3d7c3b=a0_0x27d182,_0x2d0372=window[_0x3d7c3b(0x1cd)]['href'][_0x3d7c3b(0x1ea)]('?')[0x0],_0x27d44c='code',_0x299e50=_0x3d7c3b(0x1d8),_0x1374ca=_0x3d7c3b(0x1db)+clientId+_0x3d7c3b(0x200)+_0x27d44c+_0x3d7c3b(0x1d7)+_0x299e50+'&redirect_uri='+encodeURIComponent(_0x2d0372);window['location'][_0x3d7c3b(0x21d)]=_0x1374ca;}function a0_0x3e02(){var _0x10c2f3=['log','Unable\x20to\x20refresh\x20token','https://www.dropbox.com/oauth2/authorize?client_id=','uploadFileInCloud','No\x20refresh\x20token','Do\x20you\x20want\x20to\x20logout?','classList','Folder\x20created','addEventListener','alert','application/octet-stream','parse','305288XzsEtl','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','accessToken','Wait\x20a\x20little\x20bit...','json','split','push','click','1814860QRfNyC','No\x20files\x20found\x20to\x20restore.','https://api.dropboxapi.com/oauth2/token','application/x-www-form-urlencoded','refresh_token=','exec','6qgQdru','https://api.dropboxapi.com/2/files/list_folder','Failed\x20to\x20upload\x20file\x20','Do\x20not\x20receive\x20authorization','save','https://content.dropboxapi.com/2/files/download','9JgPZmP','\x20files\x20in\x20Kabu?','overwrite','8832536esBQAp','&grant_type=','error_description','length','&response_type=','folder','stringify',',\x20status:\x20','getItem','Download\x20failed\x20for\x20','active','application/json','Cloud\x20login\x20required!','code','setItem','[\x5c?&#]','Bearer\x20','replace','remove','/data/','Backing\x20up...','Download\x20failed,\x20unknown\x20http\x20status:','Error\x20creating\x20folder\x20','Error\x20while\x20refreshing\x20token:','Refreshing\x20token...','&client_secret=','https://api.dropboxapi.com/2/files/create_folder_v2','https://api.dropbox.com/oauth2/token','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','name','onload','936350moqZtf','access_token','href','Do\x20you\x20want\x20to\x20restore\x20','Authorization\x20Code:','uId','4386571efoXAL','search','code=','DOMContentLoaded','send','Cloud\x20↦\x20Kabu\x20storage\x20◆','Upload\x20failed,\x20unknown\x20http\x20status:\x20','&redirect_uri=','open','entries','POST','8883432SZiXpT','downloadFileInCloud','confirm','Kabu\x20storage\x20↦\x20Cloud\x20◆','nwb3dnfh09rhs31','Content-Type','responseText','map','\x20files\x20from\x20Cloud?','status','Do\x20you\x20want\x20to\x20backup\x20','location','authorization_code','state','81746aDqUjr','refresh_token','blob','Restore\x20canceled\x20by\x20user.','setRequestHeader','error','file','&token_access_type=','offline'];a0_0x3e02=function(){return _0x10c2f3;};return a0_0x3e02();}function handleDropboxCallback(){var _0xde87a7=a0_0x27d182,_0x5aaf13=getUrlParameter(_0xde87a7(0x209));_0x5aaf13?(getAccessToken(_0x5aaf13),console[_0xde87a7(0x1d9)](_0xde87a7(0x21f),_0x5aaf13)):console[_0xde87a7(0x1d9)](_0xde87a7(0x1f6));}function getUrlParameter(_0x170711){var _0x31246a=a0_0x27d182;_0x170711=_0x170711[_0x31246a(0x20d)](/[\[]/,'\x5c[')[_0x31246a(0x20d)](/[\]]/,'\x5c]');var _0x3d6763=new RegExp(_0x31246a(0x20b)+_0x170711+'=([^&#]*)'),_0x5a6442=_0x3d6763[_0x31246a(0x1f2)](location[_0x31246a(0x222)]);return _0x5a6442===null?'':decodeURIComponent(_0x5a6442[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x58c49c){var _0x101463=a0_0x27d182,_0x3c3171=_0x101463(0x1ce),_0x162837=window[_0x101463(0x1cd)][_0x101463(0x21d)][_0x101463(0x1ea)]('?')[0x0],_0x2c4122=new XMLHttpRequest();_0x2c4122[_0x101463(0x1bf)](_0x101463(0x1c1),_0x101463(0x217)),_0x2c4122[_0x101463(0x1d4)](_0x101463(0x1c7),'application/x-www-form-urlencoded'),_0x2c4122[_0x101463(0x21a)]=function(){var _0x4c0f98=_0x101463;if(_0x2c4122['status']===0xc8){var _0x4f649a=JSON[_0x4c0f98(0x1e4)](_0x2c4122[_0x4c0f98(0x1c8)]),_0x488bd8=_0x4f649a['access_token'],_0x166071=_0x4f649a[_0x4c0f98(0x1d1)],_0x494875=_0x4f649a['uid'];localStorage['setItem'](_0x4c0f98(0x1e7),_0x488bd8),localStorage[_0x4c0f98(0x20a)]('refreshToken',_0x166071),localStorage['setItem']('uId',_0x494875);}else console[_0x4c0f98(0x1d9)](_0x4c0f98(0x1e6));},_0x2c4122[_0x101463(0x1bb)](_0x101463(0x223)+_0x58c49c+_0x101463(0x1fd)+_0x3c3171+'&client_id='+clientId+_0x101463(0x215)+clientSecret+_0x101463(0x1be)+encodeURIComponent(_0x162837));}export async function dpCreateFolder(_0x455b7b){var _0x33da44=a0_0x27d182;const _0x5ec78f=localStorage[_0x33da44(0x204)](_0x33da44(0x220));let _0xc40822=localStorage[_0x33da44(0x204)]('accessToken');const _0x11b62c='/'+_0x5ec78f+'/'+_0x455b7b,_0x425c8e=JSON[_0x33da44(0x202)]({'path':_0x11b62c,'autorename':![]});for(let _0x1e4757=0x0;_0x1e4757<0x2;_0x1e4757++){try{const _0x1e54d5=await fetch(_0x33da44(0x216),{'method':_0x33da44(0x1c1),'headers':{'Authorization':_0x33da44(0x20c)+_0xc40822,'Content-Type':_0x33da44(0x207)},'body':_0x425c8e});if(_0x1e54d5[_0x33da44(0x1cb)]===0x191){const _0xe67c5c=await dpRefreshToken();if(!_0xe67c5c)throw new Error(_0x33da44(0x1da));_0xc40822=localStorage['getItem'](_0x33da44(0x1e7));continue;}if(_0x1e54d5[_0x33da44(0x1cb)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x455b7b};if(!_0x1e54d5['ok'])throw new Error(_0x33da44(0x212)+_0x455b7b);const _0x301083=await _0x1e54d5[_0x33da44(0x1e9)]();return await lockNoti(_0x33da44(0x1e0),'',0xbb8),_0x301083;}catch(_0x5acd99){if(_0x1e4757===0x1)throw _0x5acd99;}}return![];}export async function dpRefreshToken(){var _0x51bc3b=a0_0x27d182;if(!localStorage[_0x51bc3b(0x204)]('refreshToken'))throw _0x51bc3b(0x1dd);try{const _0x326e1a=await fetch(_0x51bc3b(0x1ef),{'method':'POST','headers':{'Content-Type':_0x51bc3b(0x1f0)},'body':_0x51bc3b(0x1f1)+localStorage[_0x51bc3b(0x204)]('refreshToken')+_0x51bc3b(0x218)}),_0x33188f=await _0x326e1a['json']();if(!_0x33188f['error'])return localStorage['setItem']('accessToken',_0x33188f[_0x51bc3b(0x21c)]),await lockNoti(_0x51bc3b(0x214),'',0xbb8),await delay(0x3e8),!![];else alert(_0x33188f[_0x51bc3b(0x1fe)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x1d84c5){console['error'](_0x51bc3b(0x213),_0x1d84c5);}return![];}export async function dpUploadFile(_0x3e040d,_0x4278ab,_0x465165){var _0x2ae848=a0_0x27d182;const _0x1161b2=localStorage['getItem'](_0x2ae848(0x220));var _0x367ed1=JSON[_0x2ae848(0x202)]({'autorename':!![],'mode':_0x2ae848(0x1fb),'mute':!![],'strict_conflict':![],'path':'/'+_0x1161b2+'/'+_0x465165+'/'+_0x3e040d}),_0x92b1fc=new Blob([_0x4278ab],{'type':'application/octet-stream'});for(var _0x11c6b0=0x0;_0x11c6b0<0x2;_0x11c6b0++){var _0x251ff9=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x2ae848(0x1c1),'headers':{'Authorization':_0x2ae848(0x20c)+localStorage[_0x2ae848(0x204)]('accessToken'),'Dropbox-API-Arg':_0x367ed1,'Content-Type':_0x2ae848(0x1e3)},'body':_0x92b1fc});if(_0x251ff9[_0x2ae848(0x1cb)]!=0xc8){if(_0x251ff9[_0x2ae848(0x1cb)]==0x191){var _0x2a858d=await dpRefreshToken();if(!_0x2a858d)throw _0x2ae848(0x1da);continue;}else throw _0x2ae848(0x1bd)+_0x251ff9[_0x2ae848(0x1cb)];}else{var _0x2cf422=await _0x251ff9['json']();return console[_0x2ae848(0x1d9)](_0x2ae848(0x1c5),_0x3e040d),_0x2cf422;}}return![];}function a0_0x4a2f(_0x41a2fd,_0x57ca68){var _0x3e02b3=a0_0x3e02();return a0_0x4a2f=function(_0x4a2f8d,_0x3e6e9e){_0x4a2f8d=_0x4a2f8d-0x1ba;var _0x29ed01=_0x3e02b3[_0x4a2f8d];return _0x29ed01;},a0_0x4a2f(_0x41a2fd,_0x57ca68);}export async function dpDownloadFile(_0x13ae9f,_0x36ba00){var _0x362a91=a0_0x27d182;const _0xc10ce4=localStorage['getItem'](_0x362a91(0x220));var _0x4a0716=JSON[_0x362a91(0x202)]({'path':'/'+_0xc10ce4+'/'+_0x36ba00+'/'+_0x13ae9f});for(var _0x564319=0x0;_0x564319<0x2;_0x564319++){var _0xe9ad00=await fetch(_0x362a91(0x1f8),{'method':_0x362a91(0x1c1),'headers':{'Authorization':_0x362a91(0x20c)+localStorage[_0x362a91(0x204)](_0x362a91(0x1e7)),'Dropbox-API-Arg':_0x4a0716}});if(_0xe9ad00[_0x362a91(0x1cb)]!=0xc8){if(_0xe9ad00[_0x362a91(0x1cb)]==0x191){var _0x4fe44a=await dpRefreshToken();if(!_0x4fe44a)throw _0x362a91(0x1da);continue;}else throw _0x362a91(0x211)+_0xe9ad00[_0x362a91(0x1cb)];}const _0x206afb=new File([await _0xe9ad00[_0x362a91(0x1d2)]()],_0x13ae9f);return console[_0x362a91(0x1d9)](_0x362a91(0x1bc),_0x206afb[_0x362a91(0x219)]),a0_0x495fef[_0x362a91(0x1dc)](_0x206afb,()=>{}),_0x206afb;}return![];}document['addEventListener'](a0_0x27d182(0x1ba),function(){var _0x4ea542=a0_0x27d182;dropboxRestore[_0x4ea542(0x1e1)](_0x4ea542(0x1ec),async function(){var _0x3453b8=_0x4ea542;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x483ea0=localStorage['getItem'](_0x3453b8(0x220)),_0x472a34=[_0x3453b8(0x1cf),_0x3453b8(0x1f7),'screenshot'];if(!_0x483ea0){window[_0x3453b8(0x1e2)](_0x3453b8(0x208));return;}let _0x246955=[];for(const _0x23c72e of _0x472a34){let _0x12fde3={'path':'/'+_0x483ea0+'/'+_0x23c72e};for(let _0x1c3aa6=0x0;_0x1c3aa6<0x2;_0x1c3aa6++){let _0x1679d0=await fetch(_0x3453b8(0x1f4),{'method':_0x3453b8(0x1c1),'headers':{'Authorization':_0x3453b8(0x20c)+localStorage[_0x3453b8(0x204)](_0x3453b8(0x1e7)),'Content-Type':_0x3453b8(0x207)},'body':JSON[_0x3453b8(0x202)](_0x12fde3)});if(_0x1679d0[_0x3453b8(0x1cb)]===0xc8){let _0x125b5d=await _0x1679d0['json'](),_0x45e85c=_0x125b5d[_0x3453b8(0x1c0)]['filter'](_0x3e2d0a=>_0x3e2d0a['.tag']===_0x3453b8(0x1d6));_0x45e85c[_0x3453b8(0x1ff)]>0x0&&_0x246955[_0x3453b8(0x1eb)](..._0x45e85c[_0x3453b8(0x1c9)](_0x294c2d=>({'name':_0x294c2d[_0x3453b8(0x219)],'folder':_0x23c72e})));break;}else{if(_0x1679d0['status']===0x191){let _0x1b0e8b=await dpRefreshToken();if(!_0x1b0e8b)throw _0x3453b8(0x1da);}else{console[_0x3453b8(0x1d5)](_0x3453b8(0x205)+_0x23c72e+_0x3453b8(0x203)+_0x1679d0[_0x3453b8(0x1cb)]);break;}}}}if(_0x246955['length']>0x0){const _0x388d5e=_0x3453b8(0x21e)+_0x246955[_0x3453b8(0x1ff)]+_0x3453b8(0x1ca);if(window['confirm'](_0x388d5e))for(const _0x1cff07 of _0x246955){await lockNoti('Restoring...',_0x1cff07['name'],0xbb8),await dpDownloadFile(_0x1cff07[_0x3453b8(0x219)],_0x1cff07[_0x3453b8(0x201)]);}else console['log'](_0x3453b8(0x1d3));}else console[_0x3453b8(0x1d9)](_0x3453b8(0x1ee));}),dropboxBackup[_0x4ea542(0x1e1)](_0x4ea542(0x1ec),async function(){var _0x4f6914=_0x4ea542;await lockNoti(_0x4f6914(0x1e8),'',0x1388);const _0x368bc2=localStorage[_0x4f6914(0x204)](_0x4f6914(0x220));if(_0x368bc2===null||_0x368bc2==='')window[_0x4f6914(0x1e2)]('Cloud\x20login\x20required!');else{const _0x567231=[_0x4f6914(0x1cf),_0x4f6914(0x1f7),'screenshot'];for(const _0x3a04df of _0x567231){await dpCreateFolder(_0x3a04df);}let _0x34cce6=0x0;for(const _0x4baacb of _0x567231){const _0x57557e=a0_0x495fef['listFiles'](_0x4baacb+'s');_0x34cce6+=_0x57557e[_0x4f6914(0x1ff)];}if(window[_0x4f6914(0x1c4)](_0x4f6914(0x1cc)+_0x34cce6+_0x4f6914(0x1fa)))for(const _0x627a7e of _0x567231){const _0x7a7011=a0_0x495fef['listFiles'](_0x627a7e+'s');for(const _0x47676e of _0x7a7011){const _0x5acedf=await a0_0x495fef[_0x4f6914(0x1c3)](_0x4f6914(0x20f)+_0x627a7e+'s/'+_0x47676e);try{await lockNoti(_0x4f6914(0x210),_0x47676e,0xbb8),await dpUploadFile(_0x47676e,_0x5acedf,_0x627a7e);}catch(_0x5ab5e4){console[_0x4f6914(0x1d5)](_0x4f6914(0x1f5)+_0x47676e+':',_0x5ab5e4);}}}else console[_0x4f6914(0x1d9)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener']('click',function(){var _0x48b4ac=_0x4ea542;const _0x2893fa=localStorage['getItem'](_0x48b4ac(0x220));_0x2893fa===null||_0x2893fa===''?authorizeWithDropbox():window['confirm'](_0x48b4ac(0x1de))&&(localStorage[_0x48b4ac(0x20a)](_0x48b4ac(0x220),''),dropboxRestore[_0x48b4ac(0x1df)][_0x48b4ac(0x20e)](_0x48b4ac(0x206)),dropboxBackup['classList'][_0x48b4ac(0x20e)](_0x48b4ac(0x206)),dropboxCloud['classList'][_0x48b4ac(0x20e)](_0x48b4ac(0x206)));}),handleDropboxCallback();});