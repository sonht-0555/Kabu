var a0_0x1638a5=a0_0x483b;(function(_0x465cc5,_0x145a45){var _0x286256=a0_0x483b,_0x110690=_0x465cc5();while(!![]){try{var _0x24c97f=-parseInt(_0x286256(0x1b1))/0x1*(-parseInt(_0x286256(0x1ad))/0x2)+parseInt(_0x286256(0x157))/0x3*(parseInt(_0x286256(0x1b3))/0x4)+parseInt(_0x286256(0x19c))/0x5*(-parseInt(_0x286256(0x18e))/0x6)+parseInt(_0x286256(0x161))/0x7+parseInt(_0x286256(0x1a9))/0x8+parseInt(_0x286256(0x19b))/0x9+-parseInt(_0x286256(0x1ba))/0xa*(parseInt(_0x286256(0x156))/0xb);if(_0x24c97f===_0x145a45)break;else _0x110690['push'](_0x110690['shift']());}catch(_0x3248f0){_0x110690['push'](_0x110690['shift']());}}}(a0_0x3ba9,0x318f6));import*as a0_0x527f3a from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x1638a5(0x185);function authorizeWithDropbox(){var _0x2d2d0f=a0_0x1638a5,_0x4dfac5=window[_0x2d2d0f(0x154)][_0x2d2d0f(0x167)]['split']('?')[0x0],_0x45b97f=_0x2d2d0f(0x19e),_0x186130=_0x2d2d0f(0x14e),_0x2a8b10='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x2d2d0f(0x1a5)+_0x45b97f+_0x2d2d0f(0x182)+_0x186130+'&redirect_uri='+encodeURIComponent(_0x4dfac5);window[_0x2d2d0f(0x154)][_0x2d2d0f(0x167)]=_0x2a8b10;}function a0_0x483b(_0x25ab9b,_0x50d8ba){var _0x3ba947=a0_0x3ba9();return a0_0x483b=function(_0x483b63,_0x929761){_0x483b63=_0x483b63-0x14c;var _0x32992c=_0x3ba947[_0x483b63];return _0x32992c;},a0_0x483b(_0x25ab9b,_0x50d8ba);}function handleDropboxCallback(){var _0x3eb896=a0_0x1638a5,_0x3f3871=getUrlParameter(_0x3eb896(0x19e));_0x3f3871?(getAccessToken(_0x3f3871),console[_0x3eb896(0x194)](_0x3eb896(0x17c),_0x3f3871)):console['log'](_0x3eb896(0x1a1));}function a0_0x3ba9(){var _0x288c12=['split','alert','2584442fPQlvw','toUpperCase','uploadSaveOrSaveState','.ss0','https://content.dropboxapi.com/2/files/upload','.ss7','href','Cloud\x20login\x20required!','&grant_type=','status:\x20','active','remove','Cloud\x20↦\x20Kabu\x20storage\x20◆','.ss4','https://content.dropboxapi.com/2/files/download','name','blob','.ss1','replace','uid','accessToken','setItem','DOMContentLoaded','error_description','access_token','https://api.dropbox.com/oauth2/token','Download\x20failed,\x20unknown\x20http\x20status:','Authorization\x20Code:','refresh_token=','state','_dateState','authorization_code','Upload\x20failed,\x20unknown\x20http\x20status:\x20','&token_access_type=','downloadFileInCloud','slice','nwb3dnfh09rhs31','responseText','Download\x20failed,\x20unknown\x20http\x20status:\x20','Content-Type','.gba_slot','exec','parse','/data/','charAt','12gCyKeK','substring','filter','file','.ss5','open','log','classList','.txt','=([^&#]*)','[\x5c?&#]','.tag','setRequestHeader','1813365mqAflB','562230dYeiIc','Restore\x20canceled\x20by\x20user.','code','.gba_imageState','addEventListener','Do\x20not\x20receive\x20authorization','Unable\x20to\x20refresh\x20token','Error\x20while\x20refreshing\x20token:','.ss6','&response_type=','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','gba','POST','2135608xacJeJ','getItem','Restoring...','status','751840sliiPc','endsWith','code=','Bearer\x20','1iUENoN','uId','37788UdONIv','application/x-www-form-urlencoded','onload','text/plain','Failed\x20to\x20upload\x20file\x20','list','.gba_dateState','8518010yJQEXE','application/json','Failed\x20to\x20refresh\x20Dropbox\x20token.','refresh_token','refreshToken','offline','_imageState','length','click','save','stringify','location','.ss2','11nfakQy','21STSkbt','https://api.dropboxapi.com/2/files/list_folder','Do\x20you\x20want\x20to\x20logout?','application/octet-stream','.ss3','entries','lastIndexOf','Backing\x20up...'];a0_0x3ba9=function(){return _0x288c12;};return a0_0x3ba9();}function getUrlParameter(_0x472a81){var _0x3716c3=a0_0x1638a5;_0x472a81=_0x472a81[_0x3716c3(0x173)](/[\[]/,'\x5c[')[_0x3716c3(0x173)](/[\]]/,'\x5c]');var _0x303837=new RegExp(_0x3716c3(0x198)+_0x472a81+_0x3716c3(0x197)),_0x1741a5=_0x303837[_0x3716c3(0x18a)](location['search']);return _0x1741a5===null?'':decodeURIComponent(_0x1741a5[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x578c31){var _0x39d345=a0_0x1638a5,_0x2cb0de=_0x39d345(0x180),_0x464593=window[_0x39d345(0x154)][_0x39d345(0x167)][_0x39d345(0x15f)]('?')[0x0],_0x3387bf=new XMLHttpRequest();_0x3387bf[_0x39d345(0x193)](_0x39d345(0x1a8),_0x39d345(0x17a)),_0x3387bf[_0x39d345(0x19a)](_0x39d345(0x188),_0x39d345(0x1b4)),_0x3387bf[_0x39d345(0x1b5)]=function(){var _0x5f4693=_0x39d345;if(_0x3387bf[_0x5f4693(0x1ac)]===0xc8){var _0x5e6ac4=JSON[_0x5f4693(0x18b)](_0x3387bf[_0x5f4693(0x186)]),_0x307b70=_0x5e6ac4[_0x5f4693(0x179)],_0x5c0b97=_0x5e6ac4[_0x5f4693(0x14c)],_0x28511b=_0x5e6ac4[_0x5f4693(0x174)];localStorage[_0x5f4693(0x176)](_0x5f4693(0x175),_0x307b70),localStorage[_0x5f4693(0x176)](_0x5f4693(0x14d),_0x5c0b97),localStorage[_0x5f4693(0x176)](_0x5f4693(0x1b2),_0x28511b);}else console[_0x5f4693(0x194)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x3387bf['send'](_0x39d345(0x1af)+_0x578c31+_0x39d345(0x169)+_0x2cb0de+'&client_id='+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0x464593));}export async function dpRefreshToken(){var _0x5661c2=a0_0x1638a5;if(!localStorage[_0x5661c2(0x1aa)](_0x5661c2(0x14d)))throw'No\x20refresh\x20token';try{const _0x48a542=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x5661c2(0x1a8),'headers':{'Content-Type':_0x5661c2(0x1b4)},'body':_0x5661c2(0x17d)+localStorage[_0x5661c2(0x1aa)](_0x5661c2(0x14d))+_0x5661c2(0x1a6)}),_0x1dcb36=await _0x48a542['json']();if(!_0x1dcb36['error'])return localStorage[_0x5661c2(0x176)](_0x5661c2(0x175),_0x1dcb36['access_token']),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0x1dcb36[_0x5661c2(0x178)]||_0x5661c2(0x1bc));}catch(_0x1487b5){console['error'](_0x5661c2(0x1a3),_0x1487b5);}return![];}export async function dpUploadFile(_0x4b544b,_0x789bcd){var _0xad6057=a0_0x1638a5;const _0x3a1913=localStorage[_0xad6057(0x1aa)](_0xad6057(0x1b2));var _0x11d30e=JSON[_0xad6057(0x153)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x3a1913+'/'+_0x4b544b}),_0x183ce6=new Blob([_0x789bcd],{'type':'application/octet-stream'});for(var _0x527d18=0x0;_0x527d18<0x2;_0x527d18++){var _0x52efa7=await fetch(_0xad6057(0x165),{'method':_0xad6057(0x1a8),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0xad6057(0x175)),'Dropbox-API-Arg':_0x11d30e,'Content-Type':_0xad6057(0x15a)},'body':_0x183ce6});if(_0x52efa7['status']!=0xc8){if(_0x52efa7['status']==0x191){var _0x2ef92e=await dpRefreshToken();if(!_0x2ef92e)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0xad6057(0x181)+_0x52efa7[_0xad6057(0x1ac)];}else{var _0x3f011b=await _0x52efa7['json']();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x4b544b),_0x3f011b;}}return![];}async function dpDownloadFile(_0x364cb0){var _0x43fbc4=a0_0x1638a5;const _0x25001c=localStorage[_0x43fbc4(0x1aa)](_0x43fbc4(0x1b2));var _0xbf826b=JSON[_0x43fbc4(0x153)]({'path':'/'+_0x25001c+'/'+_0x364cb0});for(var _0x2e727a=0x0;_0x2e727a<0x2;_0x2e727a++){var _0x4bcdf6=await fetch(_0x43fbc4(0x16f),{'method':_0x43fbc4(0x1a8),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x43fbc4(0x1aa)](_0x43fbc4(0x175)),'Dropbox-API-Arg':_0xbf826b}});if(_0x4bcdf6[_0x43fbc4(0x1ac)]!=0xc8){if(_0x4bcdf6['status']==0x191){var _0x467e79=await dpRefreshToken();if(!_0x467e79)throw _0x43fbc4(0x1a2);continue;}else throw _0x43fbc4(0x17b)+_0x4bcdf6['status'];}const _0x23e62a=new File([await _0x4bcdf6[_0x43fbc4(0x171)]()],_0x364cb0);console[_0x43fbc4(0x194)](_0x43fbc4(0x16d),_0x23e62a['name']);if(_0x364cb0['endsWith'](_0x43fbc4(0x196))){const _0x51e9c9=await _0x23e62a['text'](),[_0x46aaba,_0x41a8e5]=_0x51e9c9[_0x43fbc4(0x15f)]('\x0a\x0a'),_0x2547ee=_0x364cb0[_0x43fbc4(0x18f)](0x0,_0x364cb0[_0x43fbc4(0x15d)](_0x43fbc4(0x1a7))+0x3),_0x5bfc99=_0x364cb0[_0x43fbc4(0x18d)](_0x364cb0[_0x43fbc4(0x150)]-0x5);localStorage[_0x43fbc4(0x176)](_0x2547ee+_0x43fbc4(0x17f)+_0x5bfc99,_0x41a8e5),localStorage['setItem'](_0x2547ee+_0x43fbc4(0x14f)+_0x5bfc99,_0x46aaba);}else a0_0x527f3a[_0x43fbc4(0x163)](_0x23e62a,()=>{localStorageFile(),Module['FSSync']();});return _0x23e62a;}return![];}document[a0_0x1638a5(0x1a0)](a0_0x1638a5(0x177),function(){var _0x2b51e5=a0_0x1638a5;dropboxRestore['addEventListener'](_0x2b51e5(0x151),async function(){var _0x43f2be=_0x2b51e5;const _0x2a23bf=localStorage['getItem'](_0x43f2be(0x1b2));if(_0x2a23bf===null||_0x2a23bf==='')window[_0x43f2be(0x160)](_0x43f2be(0x168));else{var _0x481581={'path':'/'+_0x2a23bf};for(var _0x387113=0x0;_0x387113<0x2;_0x387113++){var _0x95037e=await fetch(_0x43f2be(0x158),{'method':_0x43f2be(0x1a8),'headers':{'Authorization':_0x43f2be(0x1b0)+localStorage['getItem']('accessToken'),'Content-Type':_0x43f2be(0x1bb)},'body':JSON['stringify'](_0x481581)});console[_0x43f2be(0x194)](_0x43f2be(0x16a),_0x95037e[_0x43f2be(0x1ac)]);if(_0x95037e['status']!=0xc8){if(_0x95037e[_0x43f2be(0x1ac)]==0x191){var _0x56589c=await dpRefreshToken();if(!_0x56589c)throw _0x43f2be(0x1a2);continue;}else throw _0x43f2be(0x187)+_0x95037e[_0x43f2be(0x1ac)];}else{const _0x2269ac=await _0x95037e['json'](),_0x161611=_0x2269ac[_0x43f2be(0x15c)][_0x43f2be(0x190)](_0x29f0d3=>_0x29f0d3[_0x43f2be(0x199)]===_0x43f2be(0x191))['length'],_0x1f8d14='Do\x20you\x20want\x20to\x20restore\x20'+_0x161611+'\x20files\x20in\x20Cloud?';if(window['confirm'](_0x1f8d14))for(const _0x41ff68 of _0x2269ac[_0x43f2be(0x15c)]){_0x41ff68[_0x43f2be(0x199)]===_0x43f2be(0x191)&&(await lockNoti(_0x43f2be(0x1ab),_0x41ff68[_0x43f2be(0x170)],0xbb8),await dpDownloadFile(_0x41ff68[_0x43f2be(0x170)]));}else console[_0x43f2be(0x194)](_0x43f2be(0x19d));return!![];}}return![];}}),dropboxBackup[_0x2b51e5(0x1a0)](_0x2b51e5(0x151),async function(){var _0x255b46=_0x2b51e5;const _0x515632=localStorage['getItem'](_0x255b46(0x1b2));if(_0x515632===null||_0x515632==='')window[_0x255b46(0x160)](_0x255b46(0x168));else{const _0xd33b7d=[_0x255b46(0x17e),_0x255b46(0x152)];let _0x19781a=0x0;for(const _0xc804a1 of _0xd33b7d){const _0x4bc6e6=a0_0x527f3a[_0x255b46(0x1b8)+(_0xc804a1[_0x255b46(0x18d)](0x0)[_0x255b46(0x162)]()+_0xc804a1[_0x255b46(0x184)](0x1))]();_0x19781a+=_0x4bc6e6[_0x255b46(0x150)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x19781a+'\x20files\x20in\x20Kabu?'))for(const _0x5e3692 of _0xd33b7d){const _0x56f034=a0_0x527f3a[_0x255b46(0x1b8)+(_0x5e3692[_0x255b46(0x18d)](0x0)[_0x255b46(0x162)]()+_0x5e3692[_0x255b46(0x184)](0x1))]();for(const _0x3f1352 of _0x56f034){const _0x202c65=await a0_0x527f3a[_0x255b46(0x183)](_0x255b46(0x18c)+_0x5e3692+'s/'+_0x3f1352);try{await lockNoti(_0x255b46(0x15e),_0x3f1352,0xbb8),await dpUploadFile(_0x3f1352,_0x202c65);if(_0x3f1352[_0x255b46(0x1ae)](_0x255b46(0x164))||_0x3f1352[_0x255b46(0x1ae)](_0x255b46(0x172))||_0x3f1352[_0x255b46(0x1ae)](_0x255b46(0x155))||_0x3f1352[_0x255b46(0x1ae)](_0x255b46(0x15b))||_0x3f1352[_0x255b46(0x1ae)](_0x255b46(0x16e))||_0x3f1352[_0x255b46(0x1ae)](_0x255b46(0x192))||_0x3f1352[_0x255b46(0x1ae)](_0x255b46(0x1a4))||_0x3f1352['endsWith'](_0x255b46(0x166))){const _0x10f133=_0x3f1352[_0x255b46(0x18f)](0x0,_0x3f1352[_0x255b46(0x15d)]('.')),_0x18969c=_0x3f1352[_0x255b46(0x18d)](_0x3f1352['length']-0x1),_0x50c23f=localStorage[_0x255b46(0x1aa)](_0x10f133+_0x255b46(0x19f)+_0x18969c),_0x3110c3=localStorage['getItem'](_0x10f133+_0x255b46(0x1b9)+_0x18969c);if(_0x50c23f!==null){const _0x6be66e=_0x50c23f+'\x0a\x0a'+_0x3110c3,_0x136eda=new Blob([_0x6be66e],{'type':_0x255b46(0x1b6)});await lockNoti(_0x255b46(0x15e),_0x10f133+'.gba_slot'+_0x18969c+_0x255b46(0x196),0xbb8),await dpUploadFile(_0x10f133+_0x255b46(0x189)+_0x18969c+_0x255b46(0x196),_0x136eda);}}}catch(_0x5b5afd){console['error'](_0x255b46(0x1b7)+_0x3f1352+':',_0x5b5afd);}}}else console[_0x255b46(0x194)](_0x255b46(0x19d));}}),dropboxCloud[_0x2b51e5(0x1a0)](_0x2b51e5(0x151),function(){var _0x3c9b47=_0x2b51e5;const _0x242443=localStorage[_0x3c9b47(0x1aa)](_0x3c9b47(0x1b2));_0x242443===null||_0x242443===''?authorizeWithDropbox():window['confirm'](_0x3c9b47(0x159))&&(localStorage[_0x3c9b47(0x176)](_0x3c9b47(0x1b2),''),dropboxRestore[_0x3c9b47(0x195)]['remove'](_0x3c9b47(0x16b)),dropboxBackup[_0x3c9b47(0x195)][_0x3c9b47(0x16c)](_0x3c9b47(0x16b)),dropboxCloud[_0x3c9b47(0x195)][_0x3c9b47(0x16c)](_0x3c9b47(0x16b)));}),handleDropboxCallback();});