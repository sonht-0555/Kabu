var a0_0x11344e=a0_0x15d9;(function(_0x591c78,_0x353932){var _0x468137=a0_0x15d9,_0x2894bc=_0x591c78();while(!![]){try{var _0x1ff941=parseInt(_0x468137(0xfb))/0x1*(parseInt(_0x468137(0xe7))/0x2)+-parseInt(_0x468137(0xa7))/0x3+-parseInt(_0x468137(0xaa))/0x4+parseInt(_0x468137(0xa4))/0x5*(parseInt(_0x468137(0xd7))/0x6)+parseInt(_0x468137(0xe3))/0x7*(parseInt(_0x468137(0xed))/0x8)+-parseInt(_0x468137(0xbb))/0x9+-parseInt(_0x468137(0x105))/0xa*(-parseInt(_0x468137(0xdc))/0xb);if(_0x1ff941===_0x353932)break;else _0x2894bc['push'](_0x2894bc['shift']());}catch(_0x11d02a){_0x2894bc['push'](_0x2894bc['shift']());}}}(a0_0x4d90,0x80b30));import*as a0_0x2051b3 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x11344e(0xd4),clientSecret=a0_0x11344e(0xf2);function authorizeWithDropbox(){var _0x57a13d=a0_0x11344e,_0x317441=window['location'][_0x57a13d(0xee)][_0x57a13d(0xa0)]('?')[0x0],_0x107d78='code',_0x55c451=_0x57a13d(0xcd),_0x4ef694=_0x57a13d(0xf4)+clientId+_0x57a13d(0xf7)+_0x107d78+_0x57a13d(0xf3)+_0x55c451+_0x57a13d(0xf9)+encodeURIComponent(_0x317441);window[_0x57a13d(0xd0)]['href']=_0x4ef694;}function handleDropboxCallback(){var _0x28aa99=a0_0x11344e,_0x8bdfd=getUrlParameter(_0x28aa99(0x9e));_0x8bdfd?(getAccessToken(_0x8bdfd),console[_0x28aa99(0xc6)]('Authorization\x20Code:',_0x8bdfd)):console[_0x28aa99(0xc6)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x39fdd8){var _0x2b2abc=a0_0x11344e;_0x39fdd8=_0x39fdd8[_0x2b2abc(0xb3)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x2913b5=new RegExp(_0x2b2abc(0xfd)+_0x39fdd8+_0x2b2abc(0xfc)),_0xdb41b=_0x2913b5[_0x2b2abc(0xb8)](location[_0x2b2abc(0xad)]);return _0xdb41b===null?'':decodeURIComponent(_0xdb41b[0x1]['replace'](/\+/g,'\x20'));}function a0_0x4d90(){var _0x10f495=['No\x20refresh\x20token','confirm','Do\x20you\x20want\x20to\x20restore\x20','&grant_type=','.tag','replace','state','parse','open','application/json','exec','https://api.dropboxapi.com/oauth2/token','Backing\x20up...','6447366iyWnwv','Cloud\x20login\x20required!','&client_id=','send','https://api.dropboxapi.com/2/files/list_folder','json','application/x-www-form-urlencoded','setItem','DOMContentLoaded','application/octet-stream','status','log','setRequestHeader','error_description','Unable\x20to\x20refresh\x20token','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Restore\x20canceled\x20by\x20user.','POST','offline','click','classList','location','folder','Download\x20failed,\x20unknown\x20http\x20status:','uId','knh3uz2mx2hp2eu','stringify','Kabu\x20storage\x20↦\x20Cloud\x20◆','31020rxRyse','length','active','uploadFileInCloud','\x20files\x20from\x20Cloud?','1998634navJjF','Folder\x20already\x20exists','Error\x20while\x20refreshing\x20token:','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','getItem','https://content.dropboxapi.com/2/files/download','blob','52556fcaHiN','accessToken','refresh_token=','entries','1126524TWdSXJ','save','addEventListener','Upload\x20failed,\x20unknown\x20http\x20status:\x20','Refreshing\x20token...','Error\x20creating\x20folder\x20','120JTKGgu','href','onload','uid','refreshToken','nwb3dnfh09rhs31','&token_access_type=','https://www.dropbox.com/oauth2/authorize?client_id=','Cloud\x20↦\x20Kabu\x20storage\x20◆','Wait\x20a\x20little\x20bit...','&response_type=','remove','&redirect_uri=','screenshot','1XtmtRp','=([^&#]*)','[\x5c?&#]','authorization_code','error','Folder\x20created','downloadFileInCloud','&client_secret=',',\x20status:\x20','No\x20files\x20found\x20to\x20restore.','90GnWVfM','https://api.dropboxapi.com/2/files/create_folder_v2','file','code','responseText','split','listFiles','alert','access_token','435LbJfqy','Bearer\x20','name','1647198dNDtux','Download\x20failed\x20for\x20','code=','3873304isIfnk','https://content.dropboxapi.com/2/files/upload','Failed\x20to\x20refresh\x20Dropbox\x20token.','search'];a0_0x4d90=function(){return _0x10f495;};return a0_0x4d90();}function getAccessToken(_0x2d34b3){var _0x56cd06=a0_0x11344e,_0x5679ee=_0x56cd06(0xfe),_0x3b27c4=window['location']['href']['split']('?')[0x0],_0x181d8b=new XMLHttpRequest();_0x181d8b[_0x56cd06(0xb6)]('POST','https://api.dropbox.com/oauth2/token'),_0x181d8b[_0x56cd06(0xc7)]('Content-Type',_0x56cd06(0xc1)),_0x181d8b[_0x56cd06(0xef)]=function(){var _0x123b2c=_0x56cd06;if(_0x181d8b[_0x123b2c(0xc5)]===0xc8){var _0x5692ab=JSON[_0x123b2c(0xb5)](_0x181d8b[_0x123b2c(0x9f)]),_0x44d434=_0x5692ab[_0x123b2c(0xa3)],_0x56444c=_0x5692ab['refresh_token'],_0x1db036=_0x5692ab[_0x123b2c(0xf0)];localStorage[_0x123b2c(0xc2)]('accessToken',_0x44d434),localStorage['setItem'](_0x123b2c(0xf1),_0x56444c),localStorage['setItem'](_0x123b2c(0xd3),_0x1db036);}else console[_0x123b2c(0xc6)](_0x123b2c(0xdf));},_0x181d8b[_0x56cd06(0xbe)](_0x56cd06(0xa9)+_0x2d34b3+_0x56cd06(0xb1)+_0x5679ee+_0x56cd06(0xbd)+clientId+_0x56cd06(0x102)+clientSecret+_0x56cd06(0xf9)+encodeURIComponent(_0x3b27c4));}export async function dpCreateFolder(_0x40163b){var _0x199fde=a0_0x11344e;const _0x808675=localStorage['getItem'](_0x199fde(0xd3));let _0x196d88=localStorage[_0x199fde(0xe0)](_0x199fde(0xe4));const _0x5f5345='/'+_0x808675+'/'+_0x40163b,_0x3d2506=JSON[_0x199fde(0xd5)]({'path':_0x5f5345,'autorename':![]});for(let _0x2ddc69=0x0;_0x2ddc69<0x2;_0x2ddc69++){try{const _0x3f4e34=await fetch(_0x199fde(0x106),{'method':_0x199fde(0xcc),'headers':{'Authorization':_0x199fde(0xa5)+_0x196d88,'Content-Type':_0x199fde(0xb7)},'body':_0x3d2506});if(_0x3f4e34[_0x199fde(0xc5)]===0x191){const _0x118a6b=await dpRefreshToken();if(!_0x118a6b)throw new Error(_0x199fde(0xc9));_0x196d88=localStorage[_0x199fde(0xe0)]('accessToken');continue;}if(_0x3f4e34[_0x199fde(0xc5)]===0x199)return{'message':_0x199fde(0xdd),'path':_0x40163b};if(!_0x3f4e34['ok'])throw new Error(_0x199fde(0xec)+_0x40163b);const _0x1ba4bd=await _0x3f4e34[_0x199fde(0xc0)]();return await lockNoti(_0x199fde(0x100),'',0xbb8),_0x1ba4bd;}catch(_0x29c0de){if(_0x2ddc69===0x1)throw _0x29c0de;}}return![];}function a0_0x15d9(_0x251cc4,_0x57a5a1){var _0x4d908f=a0_0x4d90();return a0_0x15d9=function(_0x15d990,_0x2223e5){_0x15d990=_0x15d990-0x9d;var _0x402029=_0x4d908f[_0x15d990];return _0x402029;},a0_0x15d9(_0x251cc4,_0x57a5a1);}export async function dpRefreshToken(){var _0x2b68d8=a0_0x11344e;if(!localStorage[_0x2b68d8(0xe0)](_0x2b68d8(0xf1)))throw _0x2b68d8(0xae);try{const _0x2675bd=await fetch(_0x2b68d8(0xb9),{'method':_0x2b68d8(0xcc),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x2b68d8(0xe5)+localStorage['getItem'](_0x2b68d8(0xf1))+_0x2b68d8(0xca)}),_0x2df1e1=await _0x2675bd[_0x2b68d8(0xc0)]();if(!_0x2df1e1[_0x2b68d8(0xff)])return localStorage['setItem'](_0x2b68d8(0xe4),_0x2df1e1['access_token']),await lockNoti(_0x2b68d8(0xeb),'',0xbb8),await delay(0x3e8),!![];else alert(_0x2df1e1[_0x2b68d8(0xc8)]||_0x2b68d8(0xac));}catch(_0x4a1d12){console[_0x2b68d8(0xff)](_0x2b68d8(0xde),_0x4a1d12);}return![];}export async function dpUploadFile(_0x587fcc,_0x33191f,_0x440319){var _0x7fe2c1=a0_0x11344e;const _0xad3b1=localStorage[_0x7fe2c1(0xe0)](_0x7fe2c1(0xd3));var _0x40e75c=JSON[_0x7fe2c1(0xd5)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0xad3b1+'/'+_0x440319+'/'+_0x587fcc}),_0x259aee=new Blob([_0x33191f],{'type':'application/octet-stream'});for(var _0x468ddb=0x0;_0x468ddb<0x2;_0x468ddb++){var _0x3f8540=await fetch(_0x7fe2c1(0xab),{'method':_0x7fe2c1(0xcc),'headers':{'Authorization':_0x7fe2c1(0xa5)+localStorage[_0x7fe2c1(0xe0)](_0x7fe2c1(0xe4)),'Dropbox-API-Arg':_0x40e75c,'Content-Type':_0x7fe2c1(0xc4)},'body':_0x259aee});if(_0x3f8540['status']!=0xc8){if(_0x3f8540['status']==0x191){var _0x453a58=await dpRefreshToken();if(!_0x453a58)throw _0x7fe2c1(0xc9);continue;}else throw _0x7fe2c1(0xea)+_0x3f8540[_0x7fe2c1(0xc5)];}else{var _0x5da21c=await _0x3f8540['json']();return console[_0x7fe2c1(0xc6)](_0x7fe2c1(0xd6),_0x587fcc),_0x5da21c;}}return![];}export async function dpDownloadFile(_0x39a22e,_0x56a3bd){var _0xdcf95d=a0_0x11344e;const _0x102d83=localStorage[_0xdcf95d(0xe0)]('uId');var _0x500f33=JSON[_0xdcf95d(0xd5)]({'path':'/'+_0x102d83+'/'+_0x56a3bd+'/'+_0x39a22e});for(var _0x4ca2ad=0x0;_0x4ca2ad<0x2;_0x4ca2ad++){var _0x236008=await fetch(_0xdcf95d(0xe1),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage['getItem']('accessToken'),'Dropbox-API-Arg':_0x500f33}});if(_0x236008[_0xdcf95d(0xc5)]!=0xc8){if(_0x236008[_0xdcf95d(0xc5)]==0x191){var _0x4cae98=await dpRefreshToken();if(!_0x4cae98)throw _0xdcf95d(0xc9);continue;}else throw _0xdcf95d(0xd2)+_0x236008['status'];}const _0x5d1218=new File([await _0x236008[_0xdcf95d(0xe2)]()],_0x39a22e);return console[_0xdcf95d(0xc6)](_0xdcf95d(0xf5),_0x5d1218[_0xdcf95d(0xa6)]),a0_0x2051b3[_0xdcf95d(0xda)](_0x5d1218,()=>{}),_0x5d1218;}return![];}document['addEventListener'](a0_0x11344e(0xc3),function(){var _0x25e9e2=a0_0x11344e;dropboxRestore['addEventListener'](_0x25e9e2(0xce),async function(){var _0x344355=_0x25e9e2;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x149557=localStorage[_0x344355(0xe0)](_0x344355(0xd3)),_0x4c167e=['state',_0x344355(0xe8),_0x344355(0xfa)];if(!_0x149557){window[_0x344355(0xa2)](_0x344355(0xbc));return;}let _0x28b255=[];for(const _0x2f3db6 of _0x4c167e){let _0x1dac3f={'path':'/'+_0x149557+'/'+_0x2f3db6};for(let _0xe4df46=0x0;_0xe4df46<0x2;_0xe4df46++){let _0x35d562=await fetch(_0x344355(0xbf),{'method':_0x344355(0xcc),'headers':{'Authorization':_0x344355(0xa5)+localStorage[_0x344355(0xe0)](_0x344355(0xe4)),'Content-Type':_0x344355(0xb7)},'body':JSON['stringify'](_0x1dac3f)});if(_0x35d562[_0x344355(0xc5)]===0xc8){let _0x427610=await _0x35d562[_0x344355(0xc0)](),_0x3854b7=_0x427610[_0x344355(0xe6)]['filter'](_0x44a9df=>_0x44a9df[_0x344355(0xb2)]===_0x344355(0x9d));_0x3854b7['length']>0x0&&_0x28b255['push'](..._0x3854b7['map'](_0xb21cda=>({'name':_0xb21cda[_0x344355(0xa6)],'folder':_0x2f3db6})));break;}else{if(_0x35d562[_0x344355(0xc5)]===0x191){let _0x313627=await dpRefreshToken();if(!_0x313627)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x344355(0xff)](_0x344355(0xa8)+_0x2f3db6+_0x344355(0x103)+_0x35d562['status']);break;}}}}if(_0x28b255[_0x344355(0xd8)]>0x0){const _0x939b1c=_0x344355(0xb0)+_0x28b255[_0x344355(0xd8)]+_0x344355(0xdb);if(window[_0x344355(0xaf)](_0x939b1c))for(const _0x1561be of _0x28b255){await lockNoti('Restoring...',_0x1561be['name'],0xbb8),await dpDownloadFile(_0x1561be[_0x344355(0xa6)],_0x1561be[_0x344355(0xd1)]);}else console[_0x344355(0xc6)](_0x344355(0xcb));}else console['log'](_0x344355(0x104));}),dropboxBackup[_0x25e9e2(0xe9)](_0x25e9e2(0xce),async function(){var _0x3b1cbf=_0x25e9e2;await lockNoti(_0x3b1cbf(0xf6),'',0x1388);const _0x2310e8=localStorage[_0x3b1cbf(0xe0)](_0x3b1cbf(0xd3));if(_0x2310e8===null||_0x2310e8==='')window[_0x3b1cbf(0xa2)](_0x3b1cbf(0xbc));else{const _0x1ac0ee=[_0x3b1cbf(0xb4),_0x3b1cbf(0xe8),'screenshot'];for(const _0x4d39b8 of _0x1ac0ee){await dpCreateFolder(_0x4d39b8);}let _0x460283=0x0;for(const _0x113f6c of _0x1ac0ee){const _0x19738b=a0_0x2051b3[_0x3b1cbf(0xa1)](_0x113f6c+'s');_0x460283+=_0x19738b['length'];}if(window[_0x3b1cbf(0xaf)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x460283+'\x20files\x20in\x20Kabu?'))for(const _0x59d355 of _0x1ac0ee){const _0x352a3a=a0_0x2051b3[_0x3b1cbf(0xa1)](_0x59d355+'s');for(const _0x302bb1 of _0x352a3a){const _0x17e71c=await a0_0x2051b3[_0x3b1cbf(0x101)]('/data/'+_0x59d355+'s/'+_0x302bb1);try{await lockNoti(_0x3b1cbf(0xba),_0x302bb1,0xbb8),await dpUploadFile(_0x302bb1,_0x17e71c,_0x59d355);}catch(_0x1c1ad2){console[_0x3b1cbf(0xff)]('Failed\x20to\x20upload\x20file\x20'+_0x302bb1+':',_0x1c1ad2);}}}else console[_0x3b1cbf(0xc6)](_0x3b1cbf(0xcb));}}),dropboxCloud[_0x25e9e2(0xe9)](_0x25e9e2(0xce),function(){var _0x514261=_0x25e9e2;const _0x4e96d6=localStorage[_0x514261(0xe0)](_0x514261(0xd3));_0x4e96d6===null||_0x4e96d6===''?authorizeWithDropbox():window[_0x514261(0xaf)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem'](_0x514261(0xd3),''),dropboxRestore[_0x514261(0xcf)][_0x514261(0xf8)](_0x514261(0xd9)),dropboxBackup['classList'][_0x514261(0xf8)](_0x514261(0xd9)),dropboxCloud[_0x514261(0xcf)][_0x514261(0xf8)](_0x514261(0xd9)));}),handleDropboxCallback();});