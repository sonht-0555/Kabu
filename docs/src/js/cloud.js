var a0_0x2fee0a=a0_0x2620;(function(_0x1ecc03,_0x12637c){var _0x263657=a0_0x2620,_0xff9dde=_0x1ecc03();while(!![]){try{var _0x12acc3=parseInt(_0x263657(0x10e))/0x1+parseInt(_0x263657(0xd1))/0x2*(parseInt(_0x263657(0xfc))/0x3)+parseInt(_0x263657(0xde))/0x4+parseInt(_0x263657(0x10b))/0x5+-parseInt(_0x263657(0xce))/0x6*(parseInt(_0x263657(0xdc))/0x7)+-parseInt(_0x263657(0xd7))/0x8*(-parseInt(_0x263657(0xdb))/0x9)+-parseInt(_0x263657(0xb5))/0xa;if(_0x12acc3===_0x12637c)break;else _0xff9dde['push'](_0xff9dde['shift']());}catch(_0x4d0fa0){_0xff9dde['push'](_0xff9dde['shift']());}}}(a0_0x384a,0x47196));import*as a0_0x1d3f5a from'./main.js';function a0_0x2620(_0xd75b6c,_0x3172db){var _0x384ab8=a0_0x384a();return a0_0x2620=function(_0x2620a4,_0x38c23f){_0x2620a4=_0x2620a4-0xb5;var _0x70098e=_0x384ab8[_0x2620a4];return _0x70098e;},a0_0x2620(_0xd75b6c,_0x3172db);}import{localStorageFile}from'./storage.js';var clientId=a0_0x2fee0a(0xe6),clientSecret=a0_0x2fee0a(0x113);function authorizeWithDropbox(){var _0xb9bd4a=a0_0x2fee0a,_0x109816=window[_0xb9bd4a(0xd5)]['href'][_0xb9bd4a(0xe3)]('?')[0x0],_0xe6fbc2=_0xb9bd4a(0xdf),_0x105726='offline',_0x33561b='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0xb9bd4a(0xf5)+_0xe6fbc2+'&token_access_type='+_0x105726+'&redirect_uri='+encodeURIComponent(_0x109816);window[_0xb9bd4a(0xd5)][_0xb9bd4a(0xf8)]=_0x33561b;}function handleDropboxCallback(){var _0x22c6fc=a0_0x2fee0a,_0x1ddec=getUrlParameter('code');_0x1ddec?(getAccessToken(_0x1ddec),console[_0x22c6fc(0xe4)](_0x22c6fc(0x10c),_0x1ddec)):console[_0x22c6fc(0xe4)](_0x22c6fc(0xe7));}function getUrlParameter(_0x17621e){var _0x4b1412=a0_0x2fee0a;_0x17621e=_0x17621e[_0x4b1412(0xc1)](/[\[]/,'\x5c[')[_0x4b1412(0xc1)](/[\]]/,'\x5c]');var _0x178352=new RegExp(_0x4b1412(0xbb)+_0x17621e+_0x4b1412(0x118)),_0x1be4ad=_0x178352[_0x4b1412(0x100)](location[_0x4b1412(0xca)]);return _0x1be4ad===null?'':decodeURIComponent(_0x1be4ad[0x1][_0x4b1412(0xc1)](/\+/g,'\x20'));}function getAccessToken(_0x5ee4c1){var _0x3bb7cb=a0_0x2fee0a,_0x34ed8c=_0x3bb7cb(0xfa),_0x3f5b92=window['location'][_0x3bb7cb(0xf8)][_0x3bb7cb(0xe3)]('?')[0x0],_0x4a5262=new XMLHttpRequest();_0x4a5262[_0x3bb7cb(0xb9)](_0x3bb7cb(0xcc),_0x3bb7cb(0xcb)),_0x4a5262['setRequestHeader'](_0x3bb7cb(0xc9),_0x3bb7cb(0xf3)),_0x4a5262['onload']=function(){var _0x4f1c39=_0x3bb7cb;if(_0x4a5262[_0x4f1c39(0xd4)]===0xc8){var _0x4fa163=JSON[_0x4f1c39(0xe8)](_0x4a5262[_0x4f1c39(0xc8)]),_0x21cfeb=_0x4fa163[_0x4f1c39(0xf2)],_0x130059=_0x4fa163['refresh_token'],_0x38621a=_0x4fa163[_0x4f1c39(0xc7)];localStorage[_0x4f1c39(0xd9)](_0x4f1c39(0xd3),_0x21cfeb),localStorage[_0x4f1c39(0xd9)]('refreshToken',_0x130059),localStorage[_0x4f1c39(0xd9)](_0x4f1c39(0xec),_0x38621a);}else console[_0x4f1c39(0xe4)](_0x4f1c39(0xcd));},_0x4a5262[_0x3bb7cb(0xeb)](_0x3bb7cb(0xf4)+_0x5ee4c1+_0x3bb7cb(0xc5)+_0x34ed8c+_0x3bb7cb(0xbc)+clientId+_0x3bb7cb(0xe9)+clientSecret+_0x3bb7cb(0xe1)+encodeURIComponent(_0x3f5b92));}export async function dpCreateFolder(_0x5ae370){var _0x5673a2=a0_0x2fee0a;const _0x113704=localStorage[_0x5673a2(0x106)](_0x5673a2(0xec));let _0x209a36=localStorage['getItem']('accessToken');const _0xb6b3c6='/'+_0x113704+'/'+_0x5ae370,_0xbf52d7=JSON[_0x5673a2(0xf7)]({'path':_0xb6b3c6,'autorename':![]});for(let _0x1cc6af=0x0;_0x1cc6af<0x2;_0x1cc6af++){try{const _0x163419=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x5673a2(0xcc),'headers':{'Authorization':_0x5673a2(0xfd)+_0x209a36,'Content-Type':_0x5673a2(0x117)},'body':_0xbf52d7});if(_0x163419[_0x5673a2(0xd4)]===0x191){const _0x31d4fe=await dpRefreshToken();if(!_0x31d4fe)throw new Error(_0x5673a2(0xe0));_0x209a36=localStorage['getItem'](_0x5673a2(0xd3));continue;}if(_0x163419['status']===0x199)return{'message':_0x5673a2(0xb7),'path':_0x5ae370};if(!_0x163419['ok'])throw new Error(_0x5673a2(0x115)+_0x5ae370);const _0x5af666=await _0x163419[_0x5673a2(0xea)]();return await lockNoti(_0x5673a2(0x114),'',0xbb8),_0x5af666;}catch(_0x213f58){if(_0x1cc6af===0x1)throw _0x213f58;}}return![];}export async function dpRefreshToken(){var _0xa495d4=a0_0x2fee0a;if(!localStorage[_0xa495d4(0x106)](_0xa495d4(0xb6)))throw _0xa495d4(0xf6);try{const _0xdeaca8=await fetch(_0xa495d4(0xef),{'method':_0xa495d4(0xcc),'headers':{'Content-Type':_0xa495d4(0xf3)},'body':_0xa495d4(0x103)+localStorage[_0xa495d4(0x106)](_0xa495d4(0xb6))+_0xa495d4(0x10d)}),_0x50bb66=await _0xdeaca8[_0xa495d4(0xea)]();if(!_0x50bb66[_0xa495d4(0xe2)])return localStorage[_0xa495d4(0xd9)](_0xa495d4(0xd3),_0x50bb66[_0xa495d4(0xf2)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x50bb66[_0xa495d4(0xd2)]||_0xa495d4(0xf1));}catch(_0x2c3d6c){console[_0xa495d4(0xe2)]('Error\x20while\x20refreshing\x20token:',_0x2c3d6c);}return![];}export async function dpUploadFile(_0x11bbc2,_0x56a983,_0x4b1531){var _0x4ec160=a0_0x2fee0a;const _0x545afe=localStorage['getItem']('uId');var _0xf8a470=JSON[_0x4ec160(0xf7)]({'autorename':!![],'mode':_0x4ec160(0xba),'mute':!![],'strict_conflict':![],'path':'/'+_0x545afe+'/'+_0x4b1531+'/'+_0x11bbc2}),_0x1d5660=new Blob([_0x56a983],{'type':_0x4ec160(0xb8)});for(var _0x4053a8=0x0;_0x4053a8<0x2;_0x4053a8++){var _0x262c8b=await fetch(_0x4ec160(0xd6),{'method':_0x4ec160(0xcc),'headers':{'Authorization':_0x4ec160(0xfd)+localStorage[_0x4ec160(0x106)](_0x4ec160(0xd3)),'Dropbox-API-Arg':_0xf8a470,'Content-Type':_0x4ec160(0xb8)},'body':_0x1d5660});if(_0x262c8b['status']!=0xc8){if(_0x262c8b[_0x4ec160(0xd4)]==0x191){var _0x91434f=await dpRefreshToken();if(!_0x91434f)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x262c8b[_0x4ec160(0xd4)];}else{var _0x52480a=await _0x262c8b[_0x4ec160(0xea)]();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x11bbc2),_0x52480a;}}return![];}function a0_0x384a(){var _0x5e7885=['uId','Wait\x20a\x20little\x20bit...','classList','https://api.dropboxapi.com/oauth2/token','uploadFileInCloud','Failed\x20to\x20refresh\x20Dropbox\x20token.','access_token','application/x-www-form-urlencoded','code=','&response_type=','No\x20refresh\x20token','stringify','href','Restore\x20canceled\x20by\x20user.','authorization_code','remove','239763DxhWwS','Bearer\x20','length','Do\x20you\x20want\x20to\x20logout?','exec','/data/','state','refresh_token=','https://content.dropboxapi.com/2/files/download','.tag','getItem','active','addEventListener','push','alert','217625PahukJ','Authorization\x20Code:','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','248297ZCeHyf','blob','Download\x20failed,\x20unknown\x20http\x20status:','\x20files\x20in\x20Kabu?','name','nwb3dnfh09rhs31','Folder\x20created','Error\x20creating\x20folder\x20','save','application/json','=([^&#]*)','381740vzokkf','refreshToken','Folder\x20already\x20exists','application/octet-stream','open','overwrite','[\x5c?&#]','&client_id=','Cloud\x20login\x20required!','file','entries','click','replace','DOMContentLoaded','screenshot','confirm','&grant_type=','folder','uid','responseText','Content-Type','search','https://api.dropbox.com/oauth2/token','POST','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','12GzBGVQ','Do\x20you\x20want\x20to\x20backup\x20','Backing\x20up...','2XgVRMv','error_description','accessToken','status','location','https://content.dropboxapi.com/2/files/upload','86936NXmmtn','Do\x20you\x20want\x20to\x20restore\x20','setItem',',\x20status:\x20','378GwixnP','1920555kLFcxf','filter','199876eflgSk','code','Unable\x20to\x20refresh\x20token','&redirect_uri=','error','split','log','Cloud\x20↦\x20Kabu\x20storage\x20◆','knh3uz2mx2hp2eu','Do\x20not\x20receive\x20authorization','parse','&client_secret=','json','send'];a0_0x384a=function(){return _0x5e7885;};return a0_0x384a();}export async function dpDownloadFile(_0xd0d849,_0x360c40){var _0x3a39a5=a0_0x2fee0a;const _0x3c0715=localStorage['getItem'](_0x3a39a5(0xec));var _0x5f507f=JSON[_0x3a39a5(0xf7)]({'path':'/'+_0x3c0715+'/'+_0x360c40+'/'+_0xd0d849});for(var _0x3c482f=0x0;_0x3c482f<0x2;_0x3c482f++){var _0x507e99=await fetch(_0x3a39a5(0x104),{'method':_0x3a39a5(0xcc),'headers':{'Authorization':_0x3a39a5(0xfd)+localStorage[_0x3a39a5(0x106)](_0x3a39a5(0xd3)),'Dropbox-API-Arg':_0x5f507f}});if(_0x507e99[_0x3a39a5(0xd4)]!=0xc8){if(_0x507e99[_0x3a39a5(0xd4)]==0x191){var _0x2edb77=await dpRefreshToken();if(!_0x2edb77)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x3a39a5(0x110)+_0x507e99[_0x3a39a5(0xd4)];}const _0x593de6=new File([await _0x507e99[_0x3a39a5(0x10f)]()],_0xd0d849);return console[_0x3a39a5(0xe4)](_0x3a39a5(0xe5),_0x593de6[_0x3a39a5(0x112)]),a0_0x1d3f5a[_0x3a39a5(0xf0)](_0x593de6,()=>{}),_0x593de6;}return![];}document['addEventListener'](a0_0x2fee0a(0xc2),function(){var _0x508192=a0_0x2fee0a;dropboxRestore['addEventListener'](_0x508192(0xc0),async function(){var _0x1cd38b=_0x508192;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x38a94c=localStorage['getItem'](_0x1cd38b(0xec)),_0x5df2cf=[_0x1cd38b(0x102),_0x1cd38b(0x116),_0x1cd38b(0xc3)];if(!_0x38a94c){window[_0x1cd38b(0x10a)](_0x1cd38b(0xbd));return;}let _0x5dfcf0=[];for(const _0xc68a1a of _0x5df2cf){let _0x40820b={'path':'/'+_0x38a94c+'/'+_0xc68a1a};for(let _0x24ac64=0x0;_0x24ac64<0x2;_0x24ac64++){let _0x31f889=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x1cd38b(0xcc),'headers':{'Authorization':_0x1cd38b(0xfd)+localStorage['getItem'](_0x1cd38b(0xd3)),'Content-Type':'application/json'},'body':JSON[_0x1cd38b(0xf7)](_0x40820b)});if(_0x31f889[_0x1cd38b(0xd4)]===0xc8){let _0x99e399=await _0x31f889['json'](),_0x1c0a14=_0x99e399[_0x1cd38b(0xbf)][_0x1cd38b(0xdd)](_0x4a19c8=>_0x4a19c8[_0x1cd38b(0x105)]===_0x1cd38b(0xbe));_0x1c0a14[_0x1cd38b(0xfe)]>0x0&&_0x5dfcf0[_0x1cd38b(0x109)](..._0x1c0a14['map'](_0x540feb=>({'name':_0x540feb[_0x1cd38b(0x112)],'folder':_0xc68a1a})));break;}else{if(_0x31f889[_0x1cd38b(0xd4)]===0x191){let _0x163aac=await dpRefreshToken();if(!_0x163aac)throw _0x1cd38b(0xe0);}else{console[_0x1cd38b(0xe2)]('Download\x20failed\x20for\x20'+_0xc68a1a+_0x1cd38b(0xda)+_0x31f889['status']);break;}}}}if(_0x5dfcf0['length']>0x0){const _0x121bd0=_0x1cd38b(0xd8)+_0x5dfcf0[_0x1cd38b(0xfe)]+'\x20files\x20from\x20Cloud?';if(window[_0x1cd38b(0xc4)](_0x121bd0))for(const _0x14c55e of _0x5dfcf0){await lockNoti('Restoring...',_0x14c55e[_0x1cd38b(0x112)],0xbb8),await dpDownloadFile(_0x14c55e[_0x1cd38b(0x112)],_0x14c55e[_0x1cd38b(0xc6)]);}else console[_0x1cd38b(0xe4)](_0x1cd38b(0xf9));}else console[_0x1cd38b(0xe4)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup['addEventListener'](_0x508192(0xc0),async function(){var _0x11974f=_0x508192;await lockNoti(_0x11974f(0xed),'',0x1388);const _0x4d19ef=localStorage[_0x11974f(0x106)](_0x11974f(0xec));if(_0x4d19ef===null||_0x4d19ef==='')window[_0x11974f(0x10a)](_0x11974f(0xbd));else{const _0x176a06=[_0x11974f(0x102),_0x11974f(0x116),_0x11974f(0xc3)];for(const _0x3ab584 of _0x176a06){await dpCreateFolder(_0x3ab584);}let _0x1d1809=0x0;for(const _0xc6c7ce of _0x176a06){const _0x59fbc5=a0_0x1d3f5a['listFiles'](_0xc6c7ce+'s');_0x1d1809+=_0x59fbc5[_0x11974f(0xfe)];}if(window['confirm'](_0x11974f(0xcf)+_0x1d1809+_0x11974f(0x111)))for(const _0x55b58a of _0x176a06){const _0x589fd3=a0_0x1d3f5a['listFiles'](_0x55b58a+'s');for(const _0x597cd3 of _0x589fd3){const _0x428107=await a0_0x1d3f5a['downloadFileInCloud'](_0x11974f(0x101)+_0x55b58a+'s/'+_0x597cd3);try{await lockNoti(_0x11974f(0xd0),_0x597cd3,0xbb8),await dpUploadFile(_0x597cd3,_0x428107,_0x55b58a);}catch(_0x5ec2ff){console[_0x11974f(0xe2)]('Failed\x20to\x20upload\x20file\x20'+_0x597cd3+':',_0x5ec2ff);}}}else console[_0x11974f(0xe4)](_0x11974f(0xf9));}}),dropboxCloud[_0x508192(0x108)]('click',function(){var _0x1dfd7a=_0x508192;const _0x2e0c2b=localStorage[_0x1dfd7a(0x106)](_0x1dfd7a(0xec));_0x2e0c2b===null||_0x2e0c2b===''?authorizeWithDropbox():window[_0x1dfd7a(0xc4)](_0x1dfd7a(0xff))&&(localStorage[_0x1dfd7a(0xd9)](_0x1dfd7a(0xec),''),dropboxRestore[_0x1dfd7a(0xee)][_0x1dfd7a(0xfb)]('active'),dropboxBackup[_0x1dfd7a(0xee)][_0x1dfd7a(0xfb)](_0x1dfd7a(0x107)),dropboxCloud[_0x1dfd7a(0xee)][_0x1dfd7a(0xfb)]('active'));}),handleDropboxCallback();});