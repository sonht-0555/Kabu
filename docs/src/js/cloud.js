var a0_0x46dfbb=a0_0x10b3;(function(_0x2b4ee0,_0x34c682){var _0x26119e=a0_0x10b3,_0x4e40cd=_0x2b4ee0();while(!![]){try{var _0x14578a=-parseInt(_0x26119e(0x1c4))/0x1*(-parseInt(_0x26119e(0x165))/0x2)+-parseInt(_0x26119e(0x16c))/0x3*(-parseInt(_0x26119e(0x199))/0x4)+parseInt(_0x26119e(0x1b8))/0x5+-parseInt(_0x26119e(0x1ba))/0x6*(-parseInt(_0x26119e(0x1b0))/0x7)+parseInt(_0x26119e(0x169))/0x8*(parseInt(_0x26119e(0x176))/0x9)+parseInt(_0x26119e(0x166))/0xa+parseInt(_0x26119e(0x173))/0xb*(-parseInt(_0x26119e(0x1c7))/0xc);if(_0x14578a===_0x34c682)break;else _0x4e40cd['push'](_0x4e40cd['shift']());}catch(_0x473155){_0x4e40cd['push'](_0x4e40cd['shift']());}}}(a0_0xb588,0xa56fc));import*as a0_0x26471d from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x46dfbb(0x187),clientSecret=a0_0x46dfbb(0x1b5);function authorizeWithDropbox(){var _0x572a7a=a0_0x46dfbb,_0x492a99=window['location'][_0x572a7a(0x17a)][_0x572a7a(0x195)]('?')[0x0],_0x2d44f7='code',_0x255f84=_0x572a7a(0x17d),_0x24c767='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x572a7a(0x19f)+_0x2d44f7+_0x572a7a(0x1aa)+_0x255f84+_0x572a7a(0x19b)+encodeURIComponent(_0x492a99);window['location'][_0x572a7a(0x17a)]=_0x24c767;}function handleDropboxCallback(){var _0xb8c1b=a0_0x46dfbb,_0x4f7ac1=getUrlParameter(_0xb8c1b(0x1c5));_0x4f7ac1?(getAccessToken(_0x4f7ac1),console[_0xb8c1b(0x1a7)]('Authorization\x20Code:',_0x4f7ac1)):console[_0xb8c1b(0x1a7)](_0xb8c1b(0x178));}function a0_0x10b3(_0x489e0c,_0x9772b4){var _0xb588cf=a0_0xb588();return a0_0x10b3=function(_0x10b310,_0x53430d){_0x10b310=_0x10b310-0x164;var _0x4e2bef=_0xb588cf[_0x10b310];return _0x4e2bef;},a0_0x10b3(_0x489e0c,_0x9772b4);}function getUrlParameter(_0x1ae808){var _0x3ee3a8=a0_0x46dfbb;_0x1ae808=_0x1ae808[_0x3ee3a8(0x191)](/[\[]/,'\x5c[')[_0x3ee3a8(0x191)](/[\]]/,'\x5c]');var _0x44add2=new RegExp(_0x3ee3a8(0x1b2)+_0x1ae808+_0x3ee3a8(0x1a0)),_0x1fc354=_0x44add2[_0x3ee3a8(0x197)](location[_0x3ee3a8(0x16e)]);return _0x1fc354===null?'':decodeURIComponent(_0x1fc354[0x1][_0x3ee3a8(0x191)](/\+/g,'\x20'));}function getAccessToken(_0x4d515c){var _0x80f585=a0_0x46dfbb,_0x22bd70='authorization_code',_0x1f8ec9=window[_0x80f585(0x198)]['href'][_0x80f585(0x195)]('?')[0x0],_0x46b609=new XMLHttpRequest();_0x46b609[_0x80f585(0x17c)](_0x80f585(0x1ac),_0x80f585(0x16a)),_0x46b609['setRequestHeader']('Content-Type',_0x80f585(0x168)),_0x46b609[_0x80f585(0x167)]=function(){var _0x5604a4=_0x80f585;if(_0x46b609[_0x5604a4(0x1a4)]===0xc8){var _0x45a620=JSON[_0x5604a4(0x1bc)](_0x46b609[_0x5604a4(0x179)]),_0x20d362=_0x45a620[_0x5604a4(0x1c8)],_0x326ef1=_0x45a620['refresh_token'],_0xbaf512=_0x45a620[_0x5604a4(0x194)];localStorage[_0x5604a4(0x1b7)](_0x5604a4(0x16b),_0x20d362),localStorage['setItem']('refreshToken',_0x326ef1),localStorage['setItem']('uId',_0xbaf512);}else console[_0x5604a4(0x1a7)](_0x5604a4(0x1ab));},_0x46b609[_0x80f585(0x172)](_0x80f585(0x171)+_0x4d515c+_0x80f585(0x1a2)+_0x22bd70+'&client_id='+clientId+_0x80f585(0x1bb)+clientSecret+_0x80f585(0x19b)+encodeURIComponent(_0x1f8ec9));}export async function dpCreateFolder(_0x2ba128){var _0x394c03=a0_0x46dfbb;const _0x318e91=localStorage[_0x394c03(0x182)](_0x394c03(0x1af));let _0x81ae9e=localStorage[_0x394c03(0x182)]('accessToken');const _0x5a5c53='/'+_0x318e91+'/'+_0x2ba128,_0x309a86=JSON[_0x394c03(0x1c6)]({'path':_0x5a5c53,'autorename':![]});for(let _0x5d8dd0=0x0;_0x5d8dd0<0x2;_0x5d8dd0++){try{const _0x18f53c=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x394c03(0x1ac),'headers':{'Authorization':_0x394c03(0x1a5)+_0x81ae9e,'Content-Type':_0x394c03(0x1ae)},'body':_0x309a86});if(_0x18f53c[_0x394c03(0x1a4)]===0x191){const _0x15009e=await dpRefreshToken();if(!_0x15009e)throw new Error(_0x394c03(0x196));_0x81ae9e=localStorage[_0x394c03(0x182)](_0x394c03(0x16b));continue;}if(_0x18f53c[_0x394c03(0x1a4)]===0x199)return{'message':_0x394c03(0x1be),'path':_0x2ba128};if(!_0x18f53c['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x2ba128);const _0x32a789=await _0x18f53c[_0x394c03(0x1c9)]();return await lockNoti(_0x394c03(0x1a9),'',0xbb8),_0x32a789;}catch(_0x4de5ae){if(_0x5d8dd0===0x1)throw _0x4de5ae;}}return![];}export async function dpRefreshToken(){var _0x3773f0=a0_0x46dfbb;if(!localStorage[_0x3773f0(0x182)](_0x3773f0(0x19a)))throw _0x3773f0(0x189);try{const _0xbb7418=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x3773f0(0x1ac),'headers':{'Content-Type':_0x3773f0(0x168)},'body':_0x3773f0(0x1bf)+localStorage[_0x3773f0(0x182)](_0x3773f0(0x19a))+_0x3773f0(0x16d)}),_0x29c29c=await _0xbb7418[_0x3773f0(0x1c9)]();if(!_0x29c29c[_0x3773f0(0x192)])return localStorage[_0x3773f0(0x1b7)](_0x3773f0(0x16b),_0x29c29c['access_token']),await lockNoti(_0x3773f0(0x1b9),'',0xbb8),await delay(0x3e8),!![];else alert(_0x29c29c[_0x3773f0(0x181)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x1a7402){console[_0x3773f0(0x192)](_0x3773f0(0x1a8),_0x1a7402);}return![];}export async function dpUploadFile(_0xbea6a2,_0x2c970b,_0x53b80d){var _0x32f12e=a0_0x46dfbb;const _0x3cd608=localStorage[_0x32f12e(0x182)](_0x32f12e(0x1af));var _0x23d12f=JSON[_0x32f12e(0x1c6)]({'autorename':!![],'mode':_0x32f12e(0x190),'mute':!![],'strict_conflict':![],'path':'/'+_0x3cd608+'/'+_0x53b80d+'/'+_0xbea6a2}),_0x31a2ae=new Blob([_0x2c970b],{'type':_0x32f12e(0x186)});for(var _0x2fd581=0x0;_0x2fd581<0x2;_0x2fd581++){var _0x2bb68f=await fetch(_0x32f12e(0x19e),{'method':_0x32f12e(0x1ac),'headers':{'Authorization':_0x32f12e(0x1a5)+localStorage[_0x32f12e(0x182)](_0x32f12e(0x16b)),'Dropbox-API-Arg':_0x23d12f,'Content-Type':'application/octet-stream'},'body':_0x31a2ae});if(_0x2bb68f[_0x32f12e(0x1a4)]!=0xc8){if(_0x2bb68f[_0x32f12e(0x1a4)]==0x191){var _0x2a2df3=await dpRefreshToken();if(!_0x2a2df3)throw _0x32f12e(0x196);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x2bb68f[_0x32f12e(0x1a4)];}else{var _0x1883c5=await _0x2bb68f[_0x32f12e(0x1c9)]();return console['log'](_0x32f12e(0x18b),_0xbea6a2),_0x1883c5;}}return![];}export async function dpDownloadFile(_0x10a355,_0x44c303){var _0x1e27ca=a0_0x46dfbb;const _0x55de2c=localStorage[_0x1e27ca(0x182)](_0x1e27ca(0x1af));var _0x1391cb=JSON[_0x1e27ca(0x1c6)]({'path':'/'+_0x55de2c+'/'+_0x44c303+'/'+_0x10a355});for(var _0x8cf267=0x0;_0x8cf267<0x2;_0x8cf267++){var _0x3bb323=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x1e27ca(0x1ac),'headers':{'Authorization':_0x1e27ca(0x1a5)+localStorage[_0x1e27ca(0x182)](_0x1e27ca(0x16b)),'Dropbox-API-Arg':_0x1391cb}});if(_0x3bb323[_0x1e27ca(0x1a4)]!=0xc8){if(_0x3bb323[_0x1e27ca(0x1a4)]==0x191){var _0x5c2c19=await dpRefreshToken();if(!_0x5c2c19)throw _0x1e27ca(0x196);continue;}else throw _0x1e27ca(0x175)+_0x3bb323[_0x1e27ca(0x1a4)];}const _0x58d87f=new File([await _0x3bb323[_0x1e27ca(0x183)]()],_0x10a355);return console[_0x1e27ca(0x1a7)](_0x1e27ca(0x18c),_0x58d87f[_0x1e27ca(0x17b)]),a0_0x26471d[_0x1e27ca(0x17e)](_0x58d87f,()=>{}),_0x58d87f;}return![];}function a0_0xb588(){var _0x171f9f=['active','save','screenshot','overwrite','replace','error','folder','uid','split','Unable\x20to\x20refresh\x20token','exec','location','584adNkPd','refreshToken','&redirect_uri=','map','push','https://content.dropboxapi.com/2/files/upload','&response_type=','=([^&#]*)','Cloud\x20login\x20required!','&grant_type=','listFiles','status','Bearer\x20','Restoring...','log','Error\x20while\x20refreshing\x20token:','Folder\x20created','&token_access_type=','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','POST','addEventListener','application/json','uId','1838536jOEYuu','remove','[\x5c?&#]','entries','file','nwb3dnfh09rhs31','alert','setItem','3888450fgCmVH','Refreshing\x20token...','6rtqPeD','&client_secret=','parse','https://api.dropboxapi.com/2/files/list_folder','Folder\x20already\x20exists','refresh_token=','Backing\x20up...','Download\x20failed\x20for\x20','click',',\x20status:\x20','16wdJAMY','code','stringify','8952WAhkLC','access_token','json','downloadFileInCloud','62948IukJlW','6520540iIiIPP','onload','application/x-www-form-urlencoded','27576REHEdd','https://api.dropbox.com/oauth2/token','accessToken','213GovaNy','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','search','Failed\x20to\x20upload\x20file\x20','Wait\x20a\x20little\x20bit...','code=','send','30877TfIwbb','DOMContentLoaded','Download\x20failed,\x20unknown\x20http\x20status:','1476MCkQEr','\x20files\x20in\x20Kabu?','Do\x20not\x20receive\x20authorization','responseText','href','name','open','offline','uploadFileInCloud','state','Do\x20you\x20want\x20to\x20logout?','error_description','getItem','blob','classList','confirm','application/octet-stream','knh3uz2mx2hp2eu','length','No\x20refresh\x20token','Do\x20you\x20want\x20to\x20restore\x20','Kabu\x20storage\x20↦\x20Cloud\x20◆','Cloud\x20↦\x20Kabu\x20storage\x20◆'];a0_0xb588=function(){return _0x171f9f;};return a0_0xb588();}document['addEventListener'](a0_0x46dfbb(0x174),function(){var _0x4fc9df=a0_0x46dfbb;dropboxRestore['addEventListener'](_0x4fc9df(0x1c2),async function(){var _0x42dee6=_0x4fc9df;await lockNoti(_0x42dee6(0x170),'',0x1388);const _0x4b2633=localStorage['getItem'](_0x42dee6(0x1af)),_0x328e8d=[_0x42dee6(0x17f),'save',_0x42dee6(0x18f)];if(!_0x4b2633){window[_0x42dee6(0x1b6)](_0x42dee6(0x1a1));return;}let _0x13e7a1=[];for(const _0x2741da of _0x328e8d){let _0x582fb9={'path':'/'+_0x4b2633+'/'+_0x2741da};for(let _0x53444c=0x0;_0x53444c<0x2;_0x53444c++){let _0x51ff43=await fetch(_0x42dee6(0x1bd),{'method':_0x42dee6(0x1ac),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x42dee6(0x182)](_0x42dee6(0x16b)),'Content-Type':_0x42dee6(0x1ae)},'body':JSON[_0x42dee6(0x1c6)](_0x582fb9)});if(_0x51ff43[_0x42dee6(0x1a4)]===0xc8){let _0x41acfc=await _0x51ff43[_0x42dee6(0x1c9)](),_0x39ec32=_0x41acfc[_0x42dee6(0x1b3)]['filter'](_0x5c854d=>_0x5c854d['.tag']===_0x42dee6(0x1b4));_0x39ec32[_0x42dee6(0x188)]>0x0&&_0x13e7a1[_0x42dee6(0x19d)](..._0x39ec32[_0x42dee6(0x19c)](_0x12d54b=>({'name':_0x12d54b[_0x42dee6(0x17b)],'folder':_0x2741da})));break;}else{if(_0x51ff43[_0x42dee6(0x1a4)]===0x191){let _0x33699b=await dpRefreshToken();if(!_0x33699b)throw _0x42dee6(0x196);}else{console['error'](_0x42dee6(0x1c1)+_0x2741da+_0x42dee6(0x1c3)+_0x51ff43['status']);break;}}}}if(_0x13e7a1[_0x42dee6(0x188)]>0x0){const _0x34c116=_0x42dee6(0x18a)+_0x13e7a1[_0x42dee6(0x188)]+'\x20files\x20from\x20Cloud?';if(window[_0x42dee6(0x185)](_0x34c116))for(const _0x156437 of _0x13e7a1){await lockNoti(_0x42dee6(0x1a6),_0x156437[_0x42dee6(0x17b)],0xbb8),await dpDownloadFile(_0x156437['name'],_0x156437[_0x42dee6(0x193)]);}else console['log']('Restore\x20canceled\x20by\x20user.');}else console[_0x42dee6(0x1a7)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup['addEventListener'](_0x4fc9df(0x1c2),async function(){var _0x37fdf5=_0x4fc9df;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x136fe1=localStorage['getItem'](_0x37fdf5(0x1af));if(_0x136fe1===null||_0x136fe1==='')window[_0x37fdf5(0x1b6)](_0x37fdf5(0x1a1));else{const _0x37a535=[_0x37fdf5(0x17f),_0x37fdf5(0x18e),_0x37fdf5(0x18f)];for(const _0x4889b9 of _0x37a535){await dpCreateFolder(_0x4889b9);}let _0x7abcee=0x0;for(const _0x215030 of _0x37a535){const _0x3ca67a=a0_0x26471d['listFiles'](_0x215030+'s');_0x7abcee+=_0x3ca67a[_0x37fdf5(0x188)];}if(window[_0x37fdf5(0x185)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x7abcee+_0x37fdf5(0x177)))for(const _0x4c81cc of _0x37a535){const _0x114db1=a0_0x26471d[_0x37fdf5(0x1a3)](_0x4c81cc+'s');for(const _0x28296b of _0x114db1){const _0x5415b9=await a0_0x26471d[_0x37fdf5(0x164)]('/data/'+_0x4c81cc+'s/'+_0x28296b);try{await lockNoti(_0x37fdf5(0x1c0),_0x28296b,0xbb8),await dpUploadFile(_0x28296b,_0x5415b9,_0x4c81cc);}catch(_0x407616){console['error'](_0x37fdf5(0x16f)+_0x28296b+':',_0x407616);}}}else console[_0x37fdf5(0x1a7)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x4fc9df(0x1ad)]('click',function(){var _0x401c5d=_0x4fc9df;const _0x11dc34=localStorage['getItem'](_0x401c5d(0x1af));_0x11dc34===null||_0x11dc34===''?authorizeWithDropbox():window[_0x401c5d(0x185)](_0x401c5d(0x180))&&(localStorage[_0x401c5d(0x1b7)](_0x401c5d(0x1af),''),dropboxRestore[_0x401c5d(0x184)][_0x401c5d(0x1b1)]('active'),dropboxBackup[_0x401c5d(0x184)][_0x401c5d(0x1b1)](_0x401c5d(0x18d)),dropboxCloud[_0x401c5d(0x184)][_0x401c5d(0x1b1)]('active'));}),handleDropboxCallback();});