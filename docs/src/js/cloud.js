var a0_0x2f65a4=a0_0x4543;(function(_0x20289b,_0x1d5f1e){var _0x2b963f=a0_0x4543,_0x449058=_0x20289b();while(!![]){try{var _0x15bc5d=parseInt(_0x2b963f(0x90))/0x1*(parseInt(_0x2b963f(0x93))/0x2)+parseInt(_0x2b963f(0xa1))/0x3+-parseInt(_0x2b963f(0xbe))/0x4*(-parseInt(_0x2b963f(0xa3))/0x5)+-parseInt(_0x2b963f(0xc8))/0x6+parseInt(_0x2b963f(0xcb))/0x7+parseInt(_0x2b963f(0xc5))/0x8+parseInt(_0x2b963f(0xb5))/0x9*(-parseInt(_0x2b963f(0xa2))/0xa);if(_0x15bc5d===_0x1d5f1e)break;else _0x449058['push'](_0x449058['shift']());}catch(_0x250c74){_0x449058['push'](_0x449058['shift']());}}}(a0_0x1b2e,0xcb95f));import*as a0_0x39b7e4 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2f65a4(0xca),clientSecret=a0_0x2f65a4(0xbb);function authorizeWithDropbox(){var _0x569847=a0_0x2f65a4,_0x27c483=window[_0x569847(0xa6)][_0x569847(0xba)]['split']('?')[0x0],_0x552d8a=_0x569847(0xd8),_0x9a3a27=_0x569847(0xe5),_0x153e3e=_0x569847(0xec)+clientId+_0x569847(0xbc)+_0x552d8a+_0x569847(0x94)+_0x9a3a27+_0x569847(0xe9)+encodeURIComponent(_0x27c483);window[_0x569847(0xa6)][_0x569847(0xba)]=_0x153e3e;}function handleDropboxCallback(){var _0x47ab20=a0_0x2f65a4,_0x1aac8f=getUrlParameter(_0x47ab20(0xd8));_0x1aac8f?(getAccessToken(_0x1aac8f),console[_0x47ab20(0xe6)]('Authorization\x20Code:',_0x1aac8f)):console['log'](_0x47ab20(0xdc));}function getUrlParameter(_0x186673){var _0x40ac70=a0_0x2f65a4;_0x186673=_0x186673['replace'](/[\[]/,'\x5c[')[_0x40ac70(0xc2)](/[\]]/,'\x5c]');var _0x3a817a=new RegExp(_0x40ac70(0xea)+_0x186673+_0x40ac70(0xeb)),_0xf38a04=_0x3a817a['exec'](location[_0x40ac70(0xe4)]);return _0xf38a04===null?'':decodeURIComponent(_0xf38a04[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x2d70f8){var _0x222446=a0_0x2f65a4,_0xc15303='authorization_code',_0x26e50f=window[_0x222446(0xa6)][_0x222446(0xba)][_0x222446(0xb1)]('?')[0x0],_0x212c90=new XMLHttpRequest();_0x212c90['open'](_0x222446(0xc4),_0x222446(0xbd)),_0x212c90['setRequestHeader'](_0x222446(0x91),_0x222446(0x92)),_0x212c90[_0x222446(0x8f)]=function(){var _0x54f461=_0x222446;if(_0x212c90[_0x54f461(0x96)]===0xc8){var _0x150f0f=JSON['parse'](_0x212c90[_0x54f461(0xdb)]),_0x4e94aa=_0x150f0f[_0x54f461(0xd5)],_0x145693=_0x150f0f[_0x54f461(0xce)],_0xcb9654=_0x150f0f[_0x54f461(0xd2)];localStorage['setItem']('accessToken',_0x4e94aa),localStorage[_0x54f461(0x95)]('refreshToken',_0x145693),localStorage['setItem'](_0x54f461(0xc9),_0xcb9654);}else console[_0x54f461(0xe6)](_0x54f461(0xcf));},_0x212c90['send']('code='+_0x2d70f8+_0x222446(0xda)+_0xc15303+_0x222446(0x99)+clientId+_0x222446(0xb0)+clientSecret+_0x222446(0xe9)+encodeURIComponent(_0x26e50f));}export async function dpCreateFolder(_0x552723){var _0x47f8e2=a0_0x2f65a4;const _0xf71cfb=localStorage['getItem'](_0x47f8e2(0xc9));let _0xaf4dfc=localStorage[_0x47f8e2(0xc3)]('accessToken');const _0x192445='/'+_0xf71cfb+'/'+_0x552723,_0x36a775=JSON['stringify']({'path':_0x192445,'autorename':![]});for(let _0x40df7b=0x0;_0x40df7b<0x2;_0x40df7b++){try{const _0x48d114=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x47f8e2(0xc4),'headers':{'Authorization':_0x47f8e2(0xc6)+_0xaf4dfc,'Content-Type':_0x47f8e2(0x98)},'body':_0x36a775});if(_0x48d114['status']===0x191){const _0x37e75f=await dpRefreshToken();if(!_0x37e75f)throw new Error('Unable\x20to\x20refresh\x20token');_0xaf4dfc=localStorage[_0x47f8e2(0xc3)](_0x47f8e2(0xe8));continue;}if(_0x48d114[_0x47f8e2(0x96)]===0x199)return{'message':_0x47f8e2(0xa4),'path':_0x552723};if(!_0x48d114['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x552723);const _0x29000b=await _0x48d114['json']();return await lockNoti(_0x47f8e2(0xd4),'',0xbb8),_0x29000b;}catch(_0x336a80){if(_0x40df7b===0x1)throw _0x336a80;}}return![];}function a0_0x4543(_0x5222c0,_0x3a87ec){var _0x1b2e9b=a0_0x1b2e();return a0_0x4543=function(_0x45433f,_0x42663c){_0x45433f=_0x45433f-0x8e;var _0xf0ef72=_0x1b2e9b[_0x45433f];return _0xf0ef72;},a0_0x4543(_0x5222c0,_0x3a87ec);}function a0_0x1b2e(){var _0x1be3ac=['&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Failed\x20to\x20refresh\x20Dropbox\x20token.','error_description','9oVSyYW','\x20files\x20in\x20Kabu?','uploadFileInCloud','alert','application/octet-stream','href','nwb3dnfh09rhs31','&response_type=','https://api.dropbox.com/oauth2/token','1275932NZyVxM','Wait\x20a\x20little\x20bit...','addEventListener','remove','replace','getItem','POST','6648704IQpbUQ','Bearer\x20','refresh_token=','3610194KQbdDw','uId','knh3uz2mx2hp2eu','698292DWTBQF','https://api.dropboxapi.com/oauth2/token','entries','refresh_token','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','stringify','Do\x20you\x20want\x20to\x20backup\x20','uid','screenshot','Folder\x20created','access_token','Backing\x20up...','json','code','folder','&grant_type=','responseText','Do\x20not\x20receive\x20authorization','listFiles','Unable\x20to\x20refresh\x20token','click','Download\x20failed,\x20unknown\x20http\x20status:','Kabu\x20storage\x20↦\x20Cloud\x20◆','Upload\x20failed,\x20unknown\x20http\x20status:\x20','active','search','offline','log','confirm','accessToken','&redirect_uri=','[\x5c?&#]','=([^&#]*)','https://www.dropbox.com/oauth2/authorize?client_id=',',\x20status:\x20','Restore\x20canceled\x20by\x20user.','onload','605012rbxBtN','Content-Type','application/x-www-form-urlencoded','4wTPByq','&token_access_type=','setItem','status','push','application/json','&client_id=','length','https://api.dropboxapi.com/2/files/list_folder','Refreshing\x20token...','Cloud\x20↦\x20Kabu\x20storage\x20◆','refreshToken','Failed\x20to\x20upload\x20file\x20','name','1346784rlnAsQ','14731930UIZWVZ','5zZolBW','Folder\x20already\x20exists','classList','location','DOMContentLoaded','error','save','Cloud\x20login\x20required!','Download\x20failed\x20for\x20','downloadFileInCloud','state','No\x20refresh\x20token','overwrite','&client_secret=','split'];a0_0x1b2e=function(){return _0x1be3ac;};return a0_0x1b2e();}export async function dpRefreshToken(){var _0x22e34a=a0_0x2f65a4;if(!localStorage[_0x22e34a(0xc3)](_0x22e34a(0x9e)))throw _0x22e34a(0xae);try{const _0x3dce82=await fetch(_0x22e34a(0xcc),{'method':_0x22e34a(0xc4),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x22e34a(0xc7)+localStorage[_0x22e34a(0xc3)](_0x22e34a(0x9e))+_0x22e34a(0xb2)}),_0x57b8c3=await _0x3dce82[_0x22e34a(0xd7)]();if(!_0x57b8c3[_0x22e34a(0xa8)])return localStorage[_0x22e34a(0x95)](_0x22e34a(0xe8),_0x57b8c3[_0x22e34a(0xd5)]),await lockNoti(_0x22e34a(0x9c),'',0xbb8),await delay(0x3e8),!![];else alert(_0x57b8c3[_0x22e34a(0xb4)]||_0x22e34a(0xb3));}catch(_0x94b5ae){console[_0x22e34a(0xa8)]('Error\x20while\x20refreshing\x20token:',_0x94b5ae);}return![];}export async function dpUploadFile(_0x4911cd,_0xc0c3ca,_0x406448){var _0x3eb915=a0_0x2f65a4;const _0x2a42ac=localStorage[_0x3eb915(0xc3)](_0x3eb915(0xc9));var _0x570ce7=JSON[_0x3eb915(0xd0)]({'autorename':!![],'mode':_0x3eb915(0xaf),'mute':!![],'strict_conflict':![],'path':'/'+_0x2a42ac+'/'+_0x406448+'/'+_0x4911cd}),_0x117496=new Blob([_0xc0c3ca],{'type':_0x3eb915(0xb9)});for(var _0x1189ad=0x0;_0x1189ad<0x2;_0x1189ad++){var _0x3b4ae5=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x3eb915(0xc4),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x3eb915(0xc3)](_0x3eb915(0xe8)),'Dropbox-API-Arg':_0x570ce7,'Content-Type':'application/octet-stream'},'body':_0x117496});if(_0x3b4ae5[_0x3eb915(0x96)]!=0xc8){if(_0x3b4ae5[_0x3eb915(0x96)]==0x191){var _0x3a8eb4=await dpRefreshToken();if(!_0x3a8eb4)throw _0x3eb915(0xde);continue;}else throw _0x3eb915(0xe2)+_0x3b4ae5[_0x3eb915(0x96)];}else{var _0x4ebc68=await _0x3b4ae5[_0x3eb915(0xd7)]();return console['log'](_0x3eb915(0xe1),_0x4911cd),_0x4ebc68;}}return![];}export async function dpDownloadFile(_0x1fa0e8,_0x91bdc9){var _0x38be5e=a0_0x2f65a4;const _0x51faec=localStorage[_0x38be5e(0xc3)](_0x38be5e(0xc9));var _0x530031=JSON[_0x38be5e(0xd0)]({'path':'/'+_0x51faec+'/'+_0x91bdc9+'/'+_0x1fa0e8});for(var _0x23ac2b=0x0;_0x23ac2b<0x2;_0x23ac2b++){var _0x46aca5=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x38be5e(0xc4),'headers':{'Authorization':_0x38be5e(0xc6)+localStorage[_0x38be5e(0xc3)](_0x38be5e(0xe8)),'Dropbox-API-Arg':_0x530031}});if(_0x46aca5[_0x38be5e(0x96)]!=0xc8){if(_0x46aca5[_0x38be5e(0x96)]==0x191){var _0x25ba59=await dpRefreshToken();if(!_0x25ba59)throw _0x38be5e(0xde);continue;}else throw _0x38be5e(0xe0)+_0x46aca5[_0x38be5e(0x96)];}const _0x5f37de=new File([await _0x46aca5['blob']()],_0x1fa0e8);return console[_0x38be5e(0xe6)](_0x38be5e(0x9d),_0x5f37de[_0x38be5e(0xa0)]),a0_0x39b7e4[_0x38be5e(0xb7)](_0x5f37de,()=>{}),_0x5f37de;}return![];}document[a0_0x2f65a4(0xc0)](a0_0x2f65a4(0xa7),function(){var _0x319965=a0_0x2f65a4;dropboxRestore[_0x319965(0xc0)](_0x319965(0xdf),async function(){var _0x2e571a=_0x319965;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x5d1c8f=localStorage[_0x2e571a(0xc3)](_0x2e571a(0xc9)),_0x2fb26b=['state',_0x2e571a(0xa9),_0x2e571a(0xd3)];if(!_0x5d1c8f){window[_0x2e571a(0xb8)]('Cloud\x20login\x20required!');return;}let _0x5a113c=[];for(const _0x494390 of _0x2fb26b){let _0x4ae2f0={'path':'/'+_0x5d1c8f+'/'+_0x494390};for(let _0x2db0bb=0x0;_0x2db0bb<0x2;_0x2db0bb++){let _0x4ee81f=await fetch(_0x2e571a(0x9b),{'method':'POST','headers':{'Authorization':_0x2e571a(0xc6)+localStorage['getItem'](_0x2e571a(0xe8)),'Content-Type':_0x2e571a(0x98)},'body':JSON['stringify'](_0x4ae2f0)});if(_0x4ee81f[_0x2e571a(0x96)]===0xc8){let _0x765738=await _0x4ee81f['json'](),_0x5c2f52=_0x765738[_0x2e571a(0xcd)]['filter'](_0x33c009=>_0x33c009['.tag']==='file');_0x5c2f52['length']>0x0&&_0x5a113c[_0x2e571a(0x97)](..._0x5c2f52['map'](_0x2c1c0b=>({'name':_0x2c1c0b[_0x2e571a(0xa0)],'folder':_0x494390})));break;}else{if(_0x4ee81f[_0x2e571a(0x96)]===0x191){let _0x4b4a59=await dpRefreshToken();if(!_0x4b4a59)throw _0x2e571a(0xde);}else{console['error'](_0x2e571a(0xab)+_0x494390+_0x2e571a(0xed)+_0x4ee81f[_0x2e571a(0x96)]);break;}}}}if(_0x5a113c[_0x2e571a(0x9a)]>0x0){const _0x40d7e4='Do\x20you\x20want\x20to\x20restore\x20'+_0x5a113c[_0x2e571a(0x9a)]+'\x20files\x20from\x20Cloud?';if(window[_0x2e571a(0xe7)](_0x40d7e4))for(const _0x43453b of _0x5a113c){await lockNoti('Restoring...',_0x43453b[_0x2e571a(0xa0)],0xbb8),await dpDownloadFile(_0x43453b['name'],_0x43453b[_0x2e571a(0xd9)]);}else console[_0x2e571a(0xe6)]('Restore\x20canceled\x20by\x20user.');}else console[_0x2e571a(0xe6)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x319965(0xc0)](_0x319965(0xdf),async function(){var _0x4ff776=_0x319965;await lockNoti(_0x4ff776(0xbf),'',0x1388);const _0x4621a7=localStorage['getItem'](_0x4ff776(0xc9));if(_0x4621a7===null||_0x4621a7==='')window[_0x4ff776(0xb8)](_0x4ff776(0xaa));else{const _0x5465c9=[_0x4ff776(0xad),_0x4ff776(0xa9),_0x4ff776(0xd3)];for(const _0x1d9de9 of _0x5465c9){await dpCreateFolder(_0x1d9de9);}let _0x3f5d74=0x0;for(const _0x2a9621 of _0x5465c9){const _0x568659=a0_0x39b7e4[_0x4ff776(0xdd)](_0x2a9621+'s');_0x3f5d74+=_0x568659[_0x4ff776(0x9a)];}if(window[_0x4ff776(0xe7)](_0x4ff776(0xd1)+_0x3f5d74+_0x4ff776(0xb6)))for(const _0x2ce4f9 of _0x5465c9){const _0xb9eec3=a0_0x39b7e4['listFiles'](_0x2ce4f9+'s');for(const _0x2d0a1a of _0xb9eec3){const _0x25b6be=await a0_0x39b7e4[_0x4ff776(0xac)]('/data/'+_0x2ce4f9+'s/'+_0x2d0a1a);try{await lockNoti(_0x4ff776(0xd6),_0x2d0a1a,0xbb8),await dpUploadFile(_0x2d0a1a,_0x25b6be,_0x2ce4f9);}catch(_0x2cdd08){console[_0x4ff776(0xa8)](_0x4ff776(0x9f)+_0x2d0a1a+':',_0x2cdd08);}}}else console['log'](_0x4ff776(0x8e));}}),dropboxCloud['addEventListener'](_0x319965(0xdf),function(){var _0x346c24=_0x319965;const _0x47bb2d=localStorage[_0x346c24(0xc3)](_0x346c24(0xc9));_0x47bb2d===null||_0x47bb2d===''?authorizeWithDropbox():window[_0x346c24(0xe7)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem'](_0x346c24(0xc9),''),dropboxRestore['classList'][_0x346c24(0xc1)](_0x346c24(0xe3)),dropboxBackup['classList'][_0x346c24(0xc1)](_0x346c24(0xe3)),dropboxCloud[_0x346c24(0xa5)]['remove'](_0x346c24(0xe3)));}),handleDropboxCallback();});