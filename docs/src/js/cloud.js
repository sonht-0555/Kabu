var a0_0x37451c=a0_0x5140;(function(_0x506704,_0x4ab92d){var _0x1fb959=a0_0x5140,_0x43ab4d=_0x506704();while(!![]){try{var _0x1c2557=-parseInt(_0x1fb959(0x152))/0x1*(-parseInt(_0x1fb959(0x123))/0x2)+-parseInt(_0x1fb959(0x139))/0x3+parseInt(_0x1fb959(0x170))/0x4*(parseInt(_0x1fb959(0x18d))/0x5)+-parseInt(_0x1fb959(0x153))/0x6*(parseInt(_0x1fb959(0x158))/0x7)+-parseInt(_0x1fb959(0x137))/0x8+parseInt(_0x1fb959(0x164))/0x9+parseInt(_0x1fb959(0x192))/0xa;if(_0x1c2557===_0x4ab92d)break;else _0x43ab4d['push'](_0x43ab4d['shift']());}catch(_0x228969){_0x43ab4d['push'](_0x43ab4d['shift']());}}}(a0_0x2d06,0xeacaf));import*as a0_0x27b38c from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x24f802=a0_0x5140,_0x3fbbfc=window[_0x24f802(0x17c)][_0x24f802(0x120)][_0x24f802(0x178)]('?')[0x0],_0x4349a4=_0x24f802(0x17e),_0x2bc9f0='offline',_0x175007='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x24f802(0x156)+_0x4349a4+'&token_access_type='+_0x2bc9f0+'&redirect_uri='+encodeURIComponent(_0x3fbbfc);window[_0x24f802(0x17c)][_0x24f802(0x120)]=_0x175007;}function handleDropboxCallback(){var _0x5a7ddf=a0_0x5140,_0x3bdb3d=getUrlParameter(_0x5a7ddf(0x17e));_0x3bdb3d?(getAccessToken(_0x3bdb3d),console['log'](_0x5a7ddf(0x12b),_0x3bdb3d)):console[_0x5a7ddf(0x168)](_0x5a7ddf(0x17d));}function getUrlParameter(_0x1c99ec){var _0xc287a9=a0_0x5140;_0x1c99ec=_0x1c99ec['replace'](/[\[]/,'\x5c[')[_0xc287a9(0x13c)](/[\]]/,'\x5c]');var _0x588c72=new RegExp(_0xc287a9(0x15d)+_0x1c99ec+_0xc287a9(0x162)),_0x2370aa=_0x588c72[_0xc287a9(0x16f)](location[_0xc287a9(0x160)]);return _0x2370aa===null?'':decodeURIComponent(_0x2370aa[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x394d9d){var _0x30bc0f=a0_0x5140,_0x288ca9=_0x30bc0f(0x14f),_0x5a8bff=window[_0x30bc0f(0x17c)][_0x30bc0f(0x120)][_0x30bc0f(0x178)]('?')[0x0],_0x285a43=new XMLHttpRequest();_0x285a43[_0x30bc0f(0x185)](_0x30bc0f(0x12a),_0x30bc0f(0x18b)),_0x285a43[_0x30bc0f(0x16e)](_0x30bc0f(0x15f),_0x30bc0f(0x177)),_0x285a43['onload']=function(){var _0x595186=_0x30bc0f;if(_0x285a43[_0x595186(0x147)]===0xc8){var _0x5458a5=JSON['parse'](_0x285a43[_0x595186(0x154)]),_0x42de5a=_0x5458a5[_0x595186(0x180)],_0x14c1b8=_0x5458a5[_0x595186(0x135)],_0x205c8f=_0x5458a5[_0x595186(0x166)];localStorage['setItem']('accessToken',_0x42de5a),localStorage[_0x595186(0x14d)](_0x595186(0x13a),_0x14c1b8),localStorage[_0x595186(0x14d)]('uId',_0x205c8f);}else console['log'](_0x595186(0x183));},_0x285a43[_0x30bc0f(0x17a)](_0x30bc0f(0x174)+_0x394d9d+'&grant_type='+_0x288ca9+_0x30bc0f(0x189)+clientId+_0x30bc0f(0x191)+clientSecret+_0x30bc0f(0x127)+encodeURIComponent(_0x5a8bff));}function a0_0x2d06(){var _0x58e4bd=['/data/','1758258SpeDij','refreshToken','.ss1','replace','application/json','Do\x20you\x20want\x20to\x20restore\x20','\x20files\x20in\x20Kabu?','Error\x20while\x20refreshing\x20token:','alert','.ss4','save','length','.ss3','entries','status','application/octet-stream','stringify','list','classList','downloadFileInCloud','setItem','.ss6','authorization_code','_dateState','endsWith','15EeDtqL','6406788MkDDVh','responseText','uId','&response_type=','Kabu\x20storage\x20↦\x20Cloud\x20◆','7mJdznm','text','https://api.dropboxapi.com/oauth2/token','.txt','Do\x20you\x20want\x20to\x20backup\x20','[\x5c?&#]','.ss0','Content-Type','search','Restoring...','=([^&#]*)','_imageState','10455813YErdLz','gba','uid','.gba_imageState','log','status:\x20','click','slice','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Bearer\x20','setRequestHeader','exec','8wqjuvZ','toUpperCase','Unable\x20to\x20refresh\x20token','Failed\x20to\x20upload\x20file\x20','code=','Download\x20failed,\x20unknown\x20http\x20status:\x20','Download\x20failed,\x20unknown\x20http\x20status:','application/x-www-form-urlencoded','split','addEventListener','send','overwrite','location','Do\x20not\x20receive\x20authorization','code','.ss2','access_token','getItem','.gba_dateState','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','text/plain','open','name','Failed\x20to\x20refresh\x20Dropbox\x20token.','substring','&client_id=','https://content.dropboxapi.com/2/files/upload','https://api.dropbox.com/oauth2/token','Refreshing\x20token...','3606615llfHRW','json','active','Cloud\x20login\x20required!','&client_secret=','6723880CjPAyU','charAt','error_description','Upload\x20failed,\x20unknown\x20http\x20status:\x20','remove','href','uploadSaveOrSaveState','accessToken','14778VIeQUL','filter','blob','lastIndexOf','&redirect_uri=','Restore\x20canceled\x20by\x20user.','No\x20refresh\x20token','POST','Authorization\x20Code:','\x20files\x20in\x20Cloud?','Backing\x20up...','error','.ss5','https://api.dropboxapi.com/2/files/list_folder','FSSync','.gba_slot','confirm','file','refresh_token','.tag','6176248dyUoHw'];a0_0x2d06=function(){return _0x58e4bd;};return a0_0x2d06();}export async function dpRefreshToken(){var _0x2cacff=a0_0x5140;if(!localStorage[_0x2cacff(0x181)](_0x2cacff(0x13a)))throw _0x2cacff(0x129);try{const _0x1dc33a=await fetch(_0x2cacff(0x15a),{'method':_0x2cacff(0x12a),'headers':{'Content-Type':_0x2cacff(0x177)},'body':'refresh_token='+localStorage['getItem'](_0x2cacff(0x13a))+_0x2cacff(0x16c)}),_0x1bae0a=await _0x1dc33a[_0x2cacff(0x18e)]();if(!_0x1bae0a[_0x2cacff(0x12e)])return localStorage[_0x2cacff(0x14d)](_0x2cacff(0x122),_0x1bae0a[_0x2cacff(0x180)]),await lockNoti('',_0x2cacff(0x18c),0xbb8),await delay(0x3e8),!![];else alert(_0x1bae0a[_0x2cacff(0x194)]||_0x2cacff(0x187));}catch(_0x30545a){console[_0x2cacff(0x12e)](_0x2cacff(0x140),_0x30545a);}return![];}function a0_0x5140(_0xf26134,_0x12a8dc){var _0x2d0677=a0_0x2d06();return a0_0x5140=function(_0x514031,_0x3d2f6b){_0x514031=_0x514031-0x11e;var _0x2e0d8b=_0x2d0677[_0x514031];return _0x2e0d8b;},a0_0x5140(_0xf26134,_0x12a8dc);}export async function dpUploadFile(_0x5786fe,_0x5d51c1){var _0x1e8d90=a0_0x5140;const _0xc5430e=localStorage[_0x1e8d90(0x181)](_0x1e8d90(0x155));var _0xfadb21=JSON[_0x1e8d90(0x149)]({'autorename':!![],'mode':_0x1e8d90(0x17b),'mute':!![],'strict_conflict':![],'path':'/'+_0xc5430e+'/'+_0x5786fe}),_0x4f29b8=new Blob([_0x5d51c1],{'type':_0x1e8d90(0x148)});for(var _0x4b12d0=0x0;_0x4b12d0<0x2;_0x4b12d0++){var _0xd4b9e9=await fetch(_0x1e8d90(0x18a),{'method':_0x1e8d90(0x12a),'headers':{'Authorization':_0x1e8d90(0x16d)+localStorage[_0x1e8d90(0x181)](_0x1e8d90(0x122)),'Dropbox-API-Arg':_0xfadb21,'Content-Type':'application/octet-stream'},'body':_0x4f29b8});if(_0xd4b9e9[_0x1e8d90(0x147)]!=0xc8){if(_0xd4b9e9[_0x1e8d90(0x147)]==0x191){var _0x4cdc06=await dpRefreshToken();if(!_0x4cdc06)throw _0x1e8d90(0x172);continue;}else throw _0x1e8d90(0x11e)+_0xd4b9e9['status'];}else{var _0x1c64a0=await _0xd4b9e9[_0x1e8d90(0x18e)]();return console[_0x1e8d90(0x168)](_0x1e8d90(0x157),_0x5786fe),_0x1c64a0;}}return![];}async function dpDownloadFile(_0x313f16){var _0x25e187=a0_0x5140;const _0x51722c=localStorage['getItem'](_0x25e187(0x155));var _0x55b500=JSON[_0x25e187(0x149)]({'path':'/'+_0x51722c+'/'+_0x313f16});for(var _0x4d7937=0x0;_0x4d7937<0x2;_0x4d7937++){var _0x35c817=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x25e187(0x12a),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x25e187(0x181)]('accessToken'),'Dropbox-API-Arg':_0x55b500}});if(_0x35c817['status']!=0xc8){if(_0x35c817[_0x25e187(0x147)]==0x191){var _0x5d612d=await dpRefreshToken();if(!_0x5d612d)throw _0x25e187(0x172);continue;}else throw _0x25e187(0x176)+_0x35c817[_0x25e187(0x147)];}const _0x51e4b0=new File([await _0x35c817[_0x25e187(0x125)]()],_0x313f16);console[_0x25e187(0x168)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x51e4b0['name']);if(_0x313f16[_0x25e187(0x151)](_0x25e187(0x15b))){const _0x5407fe=await _0x51e4b0[_0x25e187(0x159)](),[_0xce2873,_0x132046]=_0x5407fe['split']('\x0a\x0a'),_0xc2954d=_0x313f16[_0x25e187(0x188)](0x0,_0x313f16[_0x25e187(0x126)](_0x25e187(0x165))+0x3),_0xe5713=_0x313f16['charAt'](_0x313f16[_0x25e187(0x144)]-0x5);localStorage[_0x25e187(0x14d)](_0xc2954d+_0x25e187(0x150)+_0xe5713,_0x132046),localStorage['setItem'](_0xc2954d+_0x25e187(0x163)+_0xe5713,_0xce2873);}else a0_0x27b38c[_0x25e187(0x121)](_0x51e4b0,()=>{var _0x267212=_0x25e187;localStorageFile(),Module[_0x267212(0x131)]();});return _0x51e4b0;}return![];}document[a0_0x37451c(0x179)]('DOMContentLoaded',function(){var _0x2e4e44=a0_0x37451c;dropboxRestore[_0x2e4e44(0x179)]('click',async function(){var _0x3ff013=_0x2e4e44;const _0x46b725=localStorage[_0x3ff013(0x181)](_0x3ff013(0x155));if(_0x46b725===null||_0x46b725==='')window[_0x3ff013(0x141)](_0x3ff013(0x190));else{var _0x39a138={'path':'/'+_0x46b725};for(var _0x2ed858=0x0;_0x2ed858<0x2;_0x2ed858++){var _0x120b52=await fetch(_0x3ff013(0x130),{'method':_0x3ff013(0x12a),'headers':{'Authorization':_0x3ff013(0x16d)+localStorage[_0x3ff013(0x181)](_0x3ff013(0x122)),'Content-Type':_0x3ff013(0x13d)},'body':JSON[_0x3ff013(0x149)](_0x39a138)});console[_0x3ff013(0x168)](_0x3ff013(0x169),_0x120b52[_0x3ff013(0x147)]);if(_0x120b52['status']!=0xc8){if(_0x120b52['status']==0x191){var _0x4b9380=await dpRefreshToken();if(!_0x4b9380)throw _0x3ff013(0x172);continue;}else throw _0x3ff013(0x175)+_0x120b52[_0x3ff013(0x147)];}else{const _0x34b09c=await _0x120b52['json'](),_0x4116d9=_0x34b09c[_0x3ff013(0x146)][_0x3ff013(0x124)](_0x2d6c6b=>_0x2d6c6b['.tag']===_0x3ff013(0x134))[_0x3ff013(0x144)],_0x4c8023=_0x3ff013(0x13e)+_0x4116d9+_0x3ff013(0x12c);if(window['confirm'](_0x4c8023))for(const _0x23ed50 of _0x34b09c[_0x3ff013(0x146)]){_0x23ed50[_0x3ff013(0x136)]===_0x3ff013(0x134)&&(await lockNoti(_0x3ff013(0x161),_0x23ed50[_0x3ff013(0x186)],0xbb8),await dpDownloadFile(_0x23ed50['name']));}else console['log']('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup[_0x2e4e44(0x179)](_0x2e4e44(0x16a),async function(){var _0x557919=_0x2e4e44;const _0x1a879d=localStorage['getItem']('uId');if(_0x1a879d===null||_0x1a879d==='')window[_0x557919(0x141)](_0x557919(0x190));else{const _0x1f24ea=['state',_0x557919(0x143)];let _0x1c2dad=0x0;for(const _0x409989 of _0x1f24ea){const _0x51c7d7=a0_0x27b38c[_0x557919(0x14a)+(_0x409989[_0x557919(0x193)](0x0)[_0x557919(0x171)]()+_0x409989[_0x557919(0x16b)](0x1))]();_0x1c2dad+=_0x51c7d7[_0x557919(0x144)];}if(window['confirm'](_0x557919(0x15c)+_0x1c2dad+_0x557919(0x13f)))for(const _0x61cd03 of _0x1f24ea){const _0x31b56c=a0_0x27b38c['list'+(_0x61cd03[_0x557919(0x193)](0x0)[_0x557919(0x171)]()+_0x61cd03['slice'](0x1))]();for(const _0x3f18ea of _0x31b56c){const _0x785d43=await a0_0x27b38c[_0x557919(0x14c)](_0x557919(0x138)+_0x61cd03+'s/'+_0x3f18ea);try{await lockNoti(_0x557919(0x12d),_0x3f18ea,0xbb8),await dpUploadFile(_0x3f18ea,_0x785d43);if(_0x3f18ea[_0x557919(0x151)](_0x557919(0x15e))||_0x3f18ea[_0x557919(0x151)](_0x557919(0x13b))||_0x3f18ea[_0x557919(0x151)](_0x557919(0x17f))||_0x3f18ea[_0x557919(0x151)](_0x557919(0x145))||_0x3f18ea[_0x557919(0x151)](_0x557919(0x142))||_0x3f18ea[_0x557919(0x151)](_0x557919(0x12f))||_0x3f18ea[_0x557919(0x151)](_0x557919(0x14e))||_0x3f18ea[_0x557919(0x151)]('.ss7')){const _0x121b33=_0x3f18ea[_0x557919(0x188)](0x0,_0x3f18ea[_0x557919(0x126)]('.')),_0x249ea6=_0x3f18ea[_0x557919(0x193)](_0x3f18ea[_0x557919(0x144)]-0x1),_0x310b66=localStorage[_0x557919(0x181)](_0x121b33+_0x557919(0x167)+_0x249ea6),_0x48d468=localStorage[_0x557919(0x181)](_0x121b33+_0x557919(0x182)+_0x249ea6);if(_0x310b66!==null){const _0x34dcc5=_0x310b66+'\x0a\x0a'+_0x48d468,_0x375a10=new Blob([_0x34dcc5],{'type':_0x557919(0x184)});await lockNoti(_0x557919(0x12d),_0x121b33+_0x557919(0x132)+_0x249ea6+'.txt',0xbb8),await dpUploadFile(_0x121b33+'.gba_slot'+_0x249ea6+_0x557919(0x15b),_0x375a10);}}}catch(_0x4f6115){console[_0x557919(0x12e)](_0x557919(0x173)+_0x3f18ea+':',_0x4f6115);}}}else console[_0x557919(0x168)](_0x557919(0x128));}}),dropboxCloud[_0x2e4e44(0x179)]('click',function(){var _0x4421d5=_0x2e4e44;const _0x550d40=localStorage['getItem'](_0x4421d5(0x155));_0x550d40===null||_0x550d40===''?authorizeWithDropbox():window[_0x4421d5(0x133)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x4421d5(0x14d)]('uId',''),dropboxRestore[_0x4421d5(0x14b)]['remove']('active'),dropboxBackup[_0x4421d5(0x14b)][_0x4421d5(0x11f)](_0x4421d5(0x18f)),dropboxCloud['classList'][_0x4421d5(0x11f)](_0x4421d5(0x18f)));}),handleDropboxCallback();});