var a0_0x26ceb1=a0_0x5723;(function(_0x267db6,_0x31bfc6){var _0x3c43db=a0_0x5723,_0x5a5760=_0x267db6();while(!![]){try{var _0x4b6c55=-parseInt(_0x3c43db(0x14b))/0x1*(-parseInt(_0x3c43db(0x115))/0x2)+parseInt(_0x3c43db(0x10d))/0x3*(parseInt(_0x3c43db(0x122))/0x4)+-parseInt(_0x3c43db(0x14a))/0x5+-parseInt(_0x3c43db(0x10e))/0x6+parseInt(_0x3c43db(0x13b))/0x7*(parseInt(_0x3c43db(0x154))/0x8)+-parseInt(_0x3c43db(0x128))/0x9*(-parseInt(_0x3c43db(0x113))/0xa)+parseInt(_0x3c43db(0x12c))/0xb;if(_0x4b6c55===_0x31bfc6)break;else _0x5a5760['push'](_0x5a5760['shift']());}catch(_0x55fe10){_0x5a5760['push'](_0x5a5760['shift']());}}}(a0_0x2fcf,0x6d336));import*as a0_0x378808 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x26ceb1(0x112);function authorizeWithDropbox(){var _0x52f5e7=a0_0x26ceb1,_0x3da86e=window[_0x52f5e7(0x131)][_0x52f5e7(0x145)][_0x52f5e7(0x12f)]('?')[0x0],_0x4b1bbc=_0x52f5e7(0x156),_0x5326af=_0x52f5e7(0x130),_0x4c5977=_0x52f5e7(0x157)+clientId+_0x52f5e7(0x13c)+_0x4b1bbc+_0x52f5e7(0x11d)+_0x5326af+_0x52f5e7(0x165)+encodeURIComponent(_0x3da86e);window['location']['href']=_0x4c5977;}function handleDropboxCallback(){var _0x2c7acc=a0_0x26ceb1,_0x1d51f5=getUrlParameter('code');_0x1d51f5?(getAccessToken(_0x1d51f5),console[_0x2c7acc(0x110)](_0x2c7acc(0x10f),_0x1d51f5)):console[_0x2c7acc(0x110)](_0x2c7acc(0x12a));}function getUrlParameter(_0x489f9c){var _0x2a1420=a0_0x26ceb1;_0x489f9c=_0x489f9c[_0x2a1420(0x134)](/[\[]/,'\x5c[')[_0x2a1420(0x134)](/[\]]/,'\x5c]');var _0x2aba36=new RegExp('[\x5c?&#]'+_0x489f9c+_0x2a1420(0x12e)),_0x535268=_0x2aba36[_0x2a1420(0x15d)](location[_0x2a1420(0x119)]);return _0x535268===null?'':decodeURIComponent(_0x535268[0x1][_0x2a1420(0x134)](/\+/g,'\x20'));}function a0_0x2fcf(){var _0x174db0=['2971820VVCPow','14oXKdFW','refreshToken','\x20files\x20from\x20Cloud?','uId','Wait\x20a\x20little\x20bit...','Bearer\x20','blob','authorization_code','length','39032jkywfc','Restore\x20canceled\x20by\x20user.','code','https://www.dropbox.com/oauth2/authorize?client_id=',',\x20status:\x20','remove','refresh_token=','json','application/x-www-form-urlencoded','exec','responseText','Do\x20you\x20want\x20to\x20logout?','onload','addEventListener','.tag','Restoring...','Cloud\x20login\x20required!','&redirect_uri=','screenshot','error','folder','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Folder\x20created','listFiles','status','access_token','/data/','getItem','1607583VFmDxI','2914092qlshtl','Authorization\x20Code:','log','click','nwb3dnfh09rhs31','246200qxruIT','classList','7450FCkAdE','Failed\x20to\x20upload\x20file\x20','send','Folder\x20already\x20exists','search','filter','name','Error\x20creating\x20folder\x20','&token_access_type=','https://api.dropbox.com/oauth2/token','active','https://api.dropboxapi.com/oauth2/token','POST','4XAhFgw','alert','setRequestHeader','No\x20files\x20found\x20to\x20restore.','https://api.dropboxapi.com/2/files/create_folder_v2','DOMContentLoaded','9RpPiNX','application/octet-stream','Do\x20not\x20receive\x20authorization','Download\x20failed,\x20unknown\x20http\x20status:','6412219eFFzrl','push','=([^&#]*)','split','offline','location','&client_id=','Upload\x20failed,\x20unknown\x20http\x20status:\x20','replace','Unable\x20to\x20refresh\x20token','setItem','&grant_type=','Download\x20failed\x20for\x20','No\x20refresh\x20token','state','476JbQcOn','&response_type=','parse','open','stringify','Refreshing\x20token...','uploadFileInCloud','confirm','code=','Error\x20while\x20refreshing\x20token:','href','accessToken','save','application/json','Cloud\x20↦\x20Kabu\x20storage\x20◆'];a0_0x2fcf=function(){return _0x174db0;};return a0_0x2fcf();}function a0_0x5723(_0x14508b,_0x545dd7){var _0x2fcf3b=a0_0x2fcf();return a0_0x5723=function(_0x572349,_0x25bc56){_0x572349=_0x572349-0x10a;var _0x417ca9=_0x2fcf3b[_0x572349];return _0x417ca9;},a0_0x5723(_0x14508b,_0x545dd7);}function getAccessToken(_0x1b0f16){var _0x3733d6=a0_0x26ceb1,_0x4e32ae=_0x3733d6(0x152),_0x221133=window[_0x3733d6(0x131)][_0x3733d6(0x145)][_0x3733d6(0x12f)]('?')[0x0],_0x31ee0a=new XMLHttpRequest();_0x31ee0a[_0x3733d6(0x13e)]('POST',_0x3733d6(0x11e)),_0x31ee0a[_0x3733d6(0x124)]('Content-Type',_0x3733d6(0x15c)),_0x31ee0a[_0x3733d6(0x160)]=function(){var _0x146ef7=_0x3733d6;if(_0x31ee0a['status']===0xc8){var _0x3a063b=JSON[_0x146ef7(0x13d)](_0x31ee0a[_0x146ef7(0x15e)]),_0x53cfa6=_0x3a063b[_0x146ef7(0x10a)],_0x451ae0=_0x3a063b['refresh_token'],_0x50fb4c=_0x3a063b['uid'];localStorage[_0x146ef7(0x136)](_0x146ef7(0x146),_0x53cfa6),localStorage[_0x146ef7(0x136)](_0x146ef7(0x14c),_0x451ae0),localStorage[_0x146ef7(0x136)](_0x146ef7(0x14e),_0x50fb4c);}else console[_0x146ef7(0x110)](_0x146ef7(0x169));},_0x31ee0a[_0x3733d6(0x117)](_0x3733d6(0x143)+_0x1b0f16+_0x3733d6(0x137)+_0x4e32ae+_0x3733d6(0x132)+clientId+'&client_secret='+clientSecret+_0x3733d6(0x165)+encodeURIComponent(_0x221133));}export async function dpCreateFolder(_0x27320f){var _0x33a9be=a0_0x26ceb1;const _0x3790ab=localStorage[_0x33a9be(0x10c)]('uId');let _0x50c79b=localStorage[_0x33a9be(0x10c)](_0x33a9be(0x146));const _0x1d3429='/'+_0x3790ab+'/'+_0x27320f,_0x402b18=JSON[_0x33a9be(0x13f)]({'path':_0x1d3429,'autorename':![]});for(let _0x2d2476=0x0;_0x2d2476<0x2;_0x2d2476++){try{const _0x37f742=await fetch(_0x33a9be(0x126),{'method':_0x33a9be(0x121),'headers':{'Authorization':_0x33a9be(0x150)+_0x50c79b,'Content-Type':_0x33a9be(0x148)},'body':_0x402b18});if(_0x37f742['status']===0x191){const _0x3c0a36=await dpRefreshToken();if(!_0x3c0a36)throw new Error(_0x33a9be(0x135));_0x50c79b=localStorage[_0x33a9be(0x10c)](_0x33a9be(0x146));continue;}if(_0x37f742[_0x33a9be(0x16c)]===0x199)return{'message':_0x33a9be(0x118),'path':_0x27320f};if(!_0x37f742['ok'])throw new Error(_0x33a9be(0x11c)+_0x27320f);const _0x90b848=await _0x37f742['json']();return await lockNoti(_0x33a9be(0x16a),'',0xbb8),_0x90b848;}catch(_0x255c51){if(_0x2d2476===0x1)throw _0x255c51;}}return![];}export async function dpRefreshToken(){var _0x259295=a0_0x26ceb1;if(!localStorage[_0x259295(0x10c)](_0x259295(0x14c)))throw _0x259295(0x139);try{const _0x292a47=await fetch(_0x259295(0x120),{'method':_0x259295(0x121),'headers':{'Content-Type':_0x259295(0x15c)},'body':_0x259295(0x15a)+localStorage[_0x259295(0x10c)](_0x259295(0x14c))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x515eb3=await _0x292a47[_0x259295(0x15b)]();if(!_0x515eb3['error'])return localStorage['setItem']('accessToken',_0x515eb3[_0x259295(0x10a)]),await lockNoti(_0x259295(0x140),'',0xbb8),await delay(0x3e8),!![];else alert(_0x515eb3['error_description']||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x3fc79b){console[_0x259295(0x167)](_0x259295(0x144),_0x3fc79b);}return![];}export async function dpUploadFile(_0x2e8a8a,_0x522e18,_0x27b950){var _0x220181=a0_0x26ceb1;const _0x2f6c85=localStorage[_0x220181(0x10c)](_0x220181(0x14e));var _0x78b3e3=JSON[_0x220181(0x13f)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x2f6c85+'/'+_0x27b950+'/'+_0x2e8a8a}),_0x4ed085=new Blob([_0x522e18],{'type':_0x220181(0x129)});for(var _0xfed88=0x0;_0xfed88<0x2;_0xfed88++){var _0x19d7b8=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x220181(0x121),'headers':{'Authorization':_0x220181(0x150)+localStorage[_0x220181(0x10c)](_0x220181(0x146)),'Dropbox-API-Arg':_0x78b3e3,'Content-Type':_0x220181(0x129)},'body':_0x4ed085});if(_0x19d7b8['status']!=0xc8){if(_0x19d7b8['status']==0x191){var _0x46bfef=await dpRefreshToken();if(!_0x46bfef)throw _0x220181(0x135);continue;}else throw _0x220181(0x133)+_0x19d7b8[_0x220181(0x16c)];}else{var _0xcd5944=await _0x19d7b8[_0x220181(0x15b)]();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x2e8a8a),_0xcd5944;}}return![];}export async function dpDownloadFile(_0x48b0ff,_0x4bc202){var _0x3a2f66=a0_0x26ceb1;const _0x437cf4=localStorage[_0x3a2f66(0x10c)](_0x3a2f66(0x14e));var _0x4d1529=JSON[_0x3a2f66(0x13f)]({'path':'/'+_0x437cf4+'/'+_0x4bc202+'/'+_0x48b0ff});for(var _0x466690=0x0;_0x466690<0x2;_0x466690++){var _0x15be56=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x3a2f66(0x121),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x3a2f66(0x10c)](_0x3a2f66(0x146)),'Dropbox-API-Arg':_0x4d1529}});if(_0x15be56['status']!=0xc8){if(_0x15be56[_0x3a2f66(0x16c)]==0x191){var _0x2272cd=await dpRefreshToken();if(!_0x2272cd)throw _0x3a2f66(0x135);continue;}else throw _0x3a2f66(0x12b)+_0x15be56[_0x3a2f66(0x16c)];}const _0x19f0a1=new File([await _0x15be56[_0x3a2f66(0x151)]()],_0x48b0ff);return console['log'](_0x3a2f66(0x149),_0x19f0a1['name']),a0_0x378808[_0x3a2f66(0x141)](_0x19f0a1,()=>{}),_0x19f0a1;}return![];}document[a0_0x26ceb1(0x161)](a0_0x26ceb1(0x127),function(){var _0x550998=a0_0x26ceb1;dropboxRestore[_0x550998(0x161)](_0x550998(0x111),async function(){var _0x3384fe=_0x550998;await lockNoti(_0x3384fe(0x14f),'',0x1388);const _0x5a1f7e=localStorage[_0x3384fe(0x10c)]('uId'),_0x2ee48f=[_0x3384fe(0x13a),_0x3384fe(0x147),_0x3384fe(0x166)];if(!_0x5a1f7e){window[_0x3384fe(0x123)]('Cloud\x20login\x20required!');return;}let _0x37526e=[];for(const _0x57fcdc of _0x2ee48f){let _0x10caed={'path':'/'+_0x5a1f7e+'/'+_0x57fcdc};for(let _0x874424=0x0;_0x874424<0x2;_0x874424++){let _0x5f4f79=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x3384fe(0x121),'headers':{'Authorization':_0x3384fe(0x150)+localStorage['getItem']('accessToken'),'Content-Type':'application/json'},'body':JSON[_0x3384fe(0x13f)](_0x10caed)});if(_0x5f4f79[_0x3384fe(0x16c)]===0xc8){let _0x3d2188=await _0x5f4f79[_0x3384fe(0x15b)](),_0xb0e13c=_0x3d2188['entries'][_0x3384fe(0x11a)](_0x4f5ef6=>_0x4f5ef6[_0x3384fe(0x162)]==='file');_0xb0e13c[_0x3384fe(0x153)]>0x0&&_0x37526e[_0x3384fe(0x12d)](..._0xb0e13c['map'](_0x3a652f=>({'name':_0x3a652f['name'],'folder':_0x57fcdc})));break;}else{if(_0x5f4f79[_0x3384fe(0x16c)]===0x191){let _0x4f73bb=await dpRefreshToken();if(!_0x4f73bb)throw'Unable\x20to\x20refresh\x20token';}else{console['error'](_0x3384fe(0x138)+_0x57fcdc+_0x3384fe(0x158)+_0x5f4f79['status']);break;}}}}if(_0x37526e[_0x3384fe(0x153)]>0x0){const _0x3a5b45='Do\x20you\x20want\x20to\x20restore\x20'+_0x37526e[_0x3384fe(0x153)]+_0x3384fe(0x14d);if(window['confirm'](_0x3a5b45))for(const _0x495610 of _0x37526e){await lockNoti(_0x3384fe(0x163),_0x495610[_0x3384fe(0x11b)],0xbb8),await dpDownloadFile(_0x495610[_0x3384fe(0x11b)],_0x495610[_0x3384fe(0x168)]);}else console[_0x3384fe(0x110)](_0x3384fe(0x155));}else console[_0x3384fe(0x110)](_0x3384fe(0x125));}),dropboxBackup[_0x550998(0x161)](_0x550998(0x111),async function(){var _0x1fa6f1=_0x550998;await lockNoti(_0x1fa6f1(0x14f),'',0x1388);const _0xbef70e=localStorage['getItem'](_0x1fa6f1(0x14e));if(_0xbef70e===null||_0xbef70e==='')window[_0x1fa6f1(0x123)](_0x1fa6f1(0x164));else{const _0x4a5d20=[_0x1fa6f1(0x13a),_0x1fa6f1(0x147),_0x1fa6f1(0x166)];for(const _0x4a7b99 of _0x4a5d20){await dpCreateFolder(_0x4a7b99);}let _0x3ba5f0=0x0;for(const _0x27bc19 of _0x4a5d20){const _0x19f13e=a0_0x378808[_0x1fa6f1(0x16b)](_0x27bc19+'s');_0x3ba5f0+=_0x19f13e[_0x1fa6f1(0x153)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x3ba5f0+'\x20files\x20in\x20Kabu?'))for(const _0x435af6 of _0x4a5d20){const _0x144d3f=a0_0x378808[_0x1fa6f1(0x16b)](_0x435af6+'s');for(const _0x5a74e9 of _0x144d3f){const _0x54778a=await a0_0x378808['downloadFileInCloud'](_0x1fa6f1(0x10b)+_0x435af6+'s/'+_0x5a74e9);try{await lockNoti('Backing\x20up...',_0x5a74e9,0xbb8),await dpUploadFile(_0x5a74e9,_0x54778a,_0x435af6);}catch(_0x3aef53){console[_0x1fa6f1(0x167)](_0x1fa6f1(0x116)+_0x5a74e9+':',_0x3aef53);}}}else console[_0x1fa6f1(0x110)](_0x1fa6f1(0x155));}}),dropboxCloud[_0x550998(0x161)](_0x550998(0x111),function(){var _0x14c94b=_0x550998;const _0x893264=localStorage[_0x14c94b(0x10c)](_0x14c94b(0x14e));_0x893264===null||_0x893264===''?authorizeWithDropbox():window[_0x14c94b(0x142)](_0x14c94b(0x15f))&&(localStorage[_0x14c94b(0x136)](_0x14c94b(0x14e),''),dropboxRestore[_0x14c94b(0x114)][_0x14c94b(0x159)](_0x14c94b(0x11f)),dropboxBackup[_0x14c94b(0x114)][_0x14c94b(0x159)](_0x14c94b(0x11f)),dropboxCloud[_0x14c94b(0x114)][_0x14c94b(0x159)](_0x14c94b(0x11f)));}),handleDropboxCallback();});