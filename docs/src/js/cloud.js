var a0_0x2a0e15=a0_0x224b;function a0_0x224b(_0x1fc8f8,_0x5b0dc6){var _0x3ee22b=a0_0x3ee2();return a0_0x224b=function(_0x224b3b,_0x2b7672){_0x224b3b=_0x224b3b-0xe2;var _0xb42aff=_0x3ee22b[_0x224b3b];return _0xb42aff;},a0_0x224b(_0x1fc8f8,_0x5b0dc6);}function a0_0x3ee2(){var _0x362e02=['/data/','1505128zhGsHg','accessToken','Do\x20you\x20want\x20to\x20backup\x20','Backing\x20up...','Wait\x20a\x20little\x20bit...','toUpperCase','4582270KbqhaA','knh3uz2mx2hp2eu','charAt','blob','refreshToken','push','search','setRequestHeader','Do\x20you\x20want\x20to\x20logout?','Bearer\x20','overwrite','Upload\x20failed,\x20unknown\x20http\x20status:\x20','parse','screenshot','nwb3dnfh09rhs31','application/x-www-form-urlencoded','POST','uid','location','Restore\x20canceled\x20by\x20user.','&response_type=','11ydnpuM','getItem','error_description','uId','json','DOMContentLoaded','https://api.dropboxapi.com/oauth2/token','log','https://www.dropbox.com/oauth2/authorize?client_id=','Folder\x20created','save','folder','responseText','authorization_code','3126670pplypb','\x20files\x20in\x20Kabu?','split','449364kwYDWI','entries','No\x20files\x20found\x20to\x20restore.','Download\x20failed,\x20unknown\x20http\x20status:','length','7108hhbbdR','href','https://api.dropboxapi.com/2/files/list_folder','&client_id=','click','=([^&#]*)','Do\x20you\x20want\x20to\x20restore\x20','state','&redirect_uri=','Failed\x20to\x20refresh\x20Dropbox\x20token.','Restoring...','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','access_token','addEventListener','open','application/json','remove','downloadFileInCloud','error','Cloud\x20login\x20required!','application/octet-stream','Download\x20failed\x20for\x20','Authorization\x20Code:','refresh_token=','uploadFileInCloud','\x20files\x20from\x20Cloud?','Unable\x20to\x20refresh\x20token','list','1grZPhq','1182TfZyUS','active','setItem','&grant_type=','https://api.dropbox.com/oauth2/token','classList','Content-Type','alert','Do\x20not\x20receive\x20authorization','code','confirm','No\x20refresh\x20token','Error\x20while\x20refreshing\x20token:','5909238bFCLfM','stringify','393478EBKSbi',',\x20status:\x20','&token_access_type=','Refreshing\x20token...','25BmEYGX','status','slice','filter','name','.tag','replace'];a0_0x3ee2=function(){return _0x362e02;};return a0_0x3ee2();}(function(_0x2cc565,_0x4fe3f7){var _0x12889f=a0_0x224b,_0x45e811=_0x2cc565();while(!![]){try{var _0x525668=-parseInt(_0x12889f(0xec))/0x1*(-parseInt(_0x12889f(0xfc))/0x2)+parseInt(_0x12889f(0xed))/0x3*(-parseInt(_0x12889f(0x139))/0x4)+parseInt(_0x12889f(0x100))/0x5*(parseInt(_0x12889f(0x134))/0x6)+-parseInt(_0x12889f(0x10e))/0x7+parseInt(_0x12889f(0x108))/0x8+parseInt(_0x12889f(0xfa))/0x9+-parseInt(_0x12889f(0x131))/0xa*(-parseInt(_0x12889f(0x123))/0xb);if(_0x525668===_0x4fe3f7)break;else _0x45e811['push'](_0x45e811['shift']());}catch(_0xc0981a){_0x45e811['push'](_0x45e811['shift']());}}}(a0_0x3ee2,0x5b45b));import*as a0_0xe669b7 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2a0e15(0x10f),clientSecret=a0_0x2a0e15(0x11c);function authorizeWithDropbox(){var _0x430692=a0_0x2a0e15,_0x1ee436=window[_0x430692(0x120)][_0x430692(0x13a)]['split']('?')[0x0],_0x32694e=_0x430692(0xf6),_0x122c1b='offline',_0x1cacc0=_0x430692(0x12b)+clientId+_0x430692(0x122)+_0x32694e+_0x430692(0xfe)+_0x122c1b+_0x430692(0x141)+encodeURIComponent(_0x1ee436);window[_0x430692(0x120)]['href']=_0x1cacc0;}function handleDropboxCallback(){var _0x2fbcfb=a0_0x2a0e15,_0x23a4c0=getUrlParameter(_0x2fbcfb(0xf6));_0x23a4c0?(getAccessToken(_0x23a4c0),console[_0x2fbcfb(0x12a)](_0x2fbcfb(0xe6),_0x23a4c0)):console[_0x2fbcfb(0x12a)](_0x2fbcfb(0xf5));}function getUrlParameter(_0x47c558){var _0x581834=a0_0x2a0e15;_0x47c558=_0x47c558[_0x581834(0x106)](/[\[]/,'\x5c[')[_0x581834(0x106)](/[\]]/,'\x5c]');var _0x238715=new RegExp('[\x5c?&#]'+_0x47c558+_0x581834(0x13e)),_0x202775=_0x238715['exec'](location[_0x581834(0x114)]);return _0x202775===null?'':decodeURIComponent(_0x202775[0x1][_0x581834(0x106)](/\+/g,'\x20'));}function getAccessToken(_0x11169e){var _0x56aecc=a0_0x2a0e15,_0x41807a=_0x56aecc(0x130),_0x4c6cff=window['location']['href'][_0x56aecc(0x133)]('?')[0x0],_0x591903=new XMLHttpRequest();_0x591903[_0x56aecc(0x147)]('POST',_0x56aecc(0xf1)),_0x591903[_0x56aecc(0x115)](_0x56aecc(0xf3),_0x56aecc(0x11d)),_0x591903['onload']=function(){var _0x31a56c=_0x56aecc;if(_0x591903[_0x31a56c(0x101)]===0xc8){var _0x3772e5=JSON[_0x31a56c(0x11a)](_0x591903[_0x31a56c(0x12f)]),_0xf51f22=_0x3772e5['access_token'],_0x21f785=_0x3772e5['refresh_token'],_0x159396=_0x3772e5[_0x31a56c(0x11f)];localStorage['setItem'](_0x31a56c(0x109),_0xf51f22),localStorage['setItem'](_0x31a56c(0x112),_0x21f785),localStorage[_0x31a56c(0xef)](_0x31a56c(0x126),_0x159396);}else console['log']('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x591903['send']('code='+_0x11169e+_0x56aecc(0xf0)+_0x41807a+_0x56aecc(0x13c)+clientId+'&client_secret='+clientSecret+_0x56aecc(0x141)+encodeURIComponent(_0x4c6cff));}export async function dpCreateFolder(_0x39a047){var _0x5c7d6f=a0_0x2a0e15;const _0x55e09b=localStorage['getItem'](_0x5c7d6f(0x126));let _0xb56d4c=localStorage[_0x5c7d6f(0x124)](_0x5c7d6f(0x109));const _0x5a67da='/'+_0x55e09b+'/'+_0x39a047,_0x2a4367=JSON['stringify']({'path':_0x5a67da,'autorename':![]});for(let _0x4efd6c=0x0;_0x4efd6c<0x2;_0x4efd6c++){try{const _0x4c712a=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x5c7d6f(0x11e),'headers':{'Authorization':_0x5c7d6f(0x117)+_0xb56d4c,'Content-Type':_0x5c7d6f(0x148)},'body':_0x2a4367});if(_0x4c712a['status']===0x191){const _0xedae49=await dpRefreshToken();if(!_0xedae49)throw new Error(_0x5c7d6f(0xea));_0xb56d4c=localStorage[_0x5c7d6f(0x124)]('accessToken');continue;}if(_0x4c712a[_0x5c7d6f(0x101)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x39a047};if(!_0x4c712a['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x39a047);const _0x425faa=await _0x4c712a[_0x5c7d6f(0x127)]();return await lockNoti(_0x5c7d6f(0x12c),'',0xbb8),_0x425faa;}catch(_0x56b9f3){if(_0x4efd6c===0x1)throw _0x56b9f3;}}return![];}export async function dpRefreshToken(){var _0x2db5dc=a0_0x2a0e15;if(!localStorage[_0x2db5dc(0x124)](_0x2db5dc(0x112)))throw _0x2db5dc(0xf8);try{const _0x23884a=await fetch(_0x2db5dc(0x129),{'method':_0x2db5dc(0x11e),'headers':{'Content-Type':_0x2db5dc(0x11d)},'body':_0x2db5dc(0xe7)+localStorage[_0x2db5dc(0x124)](_0x2db5dc(0x112))+_0x2db5dc(0x144)}),_0x5df3de=await _0x23884a['json']();if(!_0x5df3de['error'])return localStorage['setItem'](_0x2db5dc(0x109),_0x5df3de[_0x2db5dc(0x145)]),await lockNoti(_0x2db5dc(0xff),'',0xbb8),await delay(0x3e8),!![];else alert(_0x5df3de[_0x2db5dc(0x125)]||_0x2db5dc(0x142));}catch(_0x283e65){console[_0x2db5dc(0xe2)](_0x2db5dc(0xf9),_0x283e65);}return![];}export async function dpUploadFile(_0x4c7ed7,_0x5e21e9,_0x38acac){var _0x40991e=a0_0x2a0e15;const _0x2a0184=localStorage[_0x40991e(0x124)](_0x40991e(0x126));var _0x4f953b=JSON[_0x40991e(0xfb)]({'autorename':!![],'mode':_0x40991e(0x118),'mute':!![],'strict_conflict':![],'path':'/'+_0x2a0184+'/'+_0x38acac+'/'+_0x4c7ed7}),_0x233f84=new Blob([_0x5e21e9],{'type':_0x40991e(0xe4)});for(var _0x3ef6d6=0x0;_0x3ef6d6<0x2;_0x3ef6d6++){var _0x463b32=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x40991e(0x11e),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x40991e(0x124)](_0x40991e(0x109)),'Dropbox-API-Arg':_0x4f953b,'Content-Type':'application/octet-stream'},'body':_0x233f84});if(_0x463b32[_0x40991e(0x101)]!=0xc8){if(_0x463b32[_0x40991e(0x101)]==0x191){var _0x1d2ba8=await dpRefreshToken();if(!_0x1d2ba8)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x40991e(0x119)+_0x463b32[_0x40991e(0x101)];}else{var _0x34ab5b=await _0x463b32['json']();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x4c7ed7),_0x34ab5b;}}return![];}export async function dpDownloadFile(_0x5bfe66,_0x3ee556){var _0x6c2712=a0_0x2a0e15;const _0x5dcb2f=localStorage['getItem'](_0x6c2712(0x126));var _0x4433e1=JSON[_0x6c2712(0xfb)]({'path':'/'+_0x5dcb2f+'/'+_0x3ee556+'/'+_0x5bfe66});for(var _0x26bf44=0x0;_0x26bf44<0x2;_0x26bf44++){var _0x244373=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x6c2712(0x11e),'headers':{'Authorization':_0x6c2712(0x117)+localStorage[_0x6c2712(0x124)](_0x6c2712(0x109)),'Dropbox-API-Arg':_0x4433e1}});if(_0x244373[_0x6c2712(0x101)]!=0xc8){if(_0x244373['status']==0x191){var _0x19251c=await dpRefreshToken();if(!_0x19251c)throw _0x6c2712(0xea);continue;}else throw _0x6c2712(0x137)+_0x244373[_0x6c2712(0x101)];}const _0x2d209a=new File([await _0x244373[_0x6c2712(0x111)]()],_0x5bfe66);return console[_0x6c2712(0x12a)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x2d209a[_0x6c2712(0x104)]),a0_0xe669b7[_0x6c2712(0xe8)](_0x2d209a,()=>{localStorageFile(),Module['FSSync']();}),_0x2d209a;}return![];}document[a0_0x2a0e15(0x146)](a0_0x2a0e15(0x128),function(){var _0x450cf0=a0_0x2a0e15;dropboxRestore['addEventListener'](_0x450cf0(0x13d),async function(){var _0x26a192=_0x450cf0;await lockNoti(_0x26a192(0x10c),'',0x1388);const _0x3426c3=localStorage['getItem'](_0x26a192(0x126)),_0x3ab490=['state',_0x26a192(0x12d),_0x26a192(0x11b)];if(!_0x3426c3){window[_0x26a192(0xf4)]('Cloud\x20login\x20required!');return;}let _0x51ccf0=[];for(const _0x57d8a2 of _0x3ab490){let _0x332e2e={'path':'/'+_0x3426c3+'/'+_0x57d8a2};for(let _0x42d4c6=0x0;_0x42d4c6<0x2;_0x42d4c6++){let _0x50aca9=await fetch(_0x26a192(0x13b),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x26a192(0x124)]('accessToken'),'Content-Type':'application/json'},'body':JSON[_0x26a192(0xfb)](_0x332e2e)});if(_0x50aca9[_0x26a192(0x101)]===0xc8){let _0xc86f13=await _0x50aca9['json'](),_0x21f58b=_0xc86f13[_0x26a192(0x135)][_0x26a192(0x103)](_0x1c3369=>_0x1c3369[_0x26a192(0x105)]==='file');_0x21f58b['length']>0x0&&_0x51ccf0[_0x26a192(0x113)](..._0x21f58b['map'](_0x446d8a=>({'name':_0x446d8a[_0x26a192(0x104)],'folder':_0x57d8a2})));break;}else{if(_0x50aca9[_0x26a192(0x101)]===0x191){let _0x2e5488=await dpRefreshToken();if(!_0x2e5488)throw _0x26a192(0xea);}else{console['error'](_0x26a192(0xe5)+_0x57d8a2+_0x26a192(0xfd)+_0x50aca9['status']);break;}}}}if(_0x51ccf0[_0x26a192(0x138)]>0x0){const _0x5e59cc=_0x26a192(0x13f)+_0x51ccf0[_0x26a192(0x138)]+_0x26a192(0xe9);if(window['confirm'](_0x5e59cc))for(const _0xe85cd5 of _0x51ccf0){await lockNoti(_0x26a192(0x143),_0xe85cd5[_0x26a192(0x104)],0xbb8),await dpDownloadFile(_0xe85cd5[_0x26a192(0x104)],_0xe85cd5[_0x26a192(0x12e)]);}else console[_0x26a192(0x12a)](_0x26a192(0x121));}else console['log'](_0x26a192(0x136));}),dropboxBackup[_0x450cf0(0x146)](_0x450cf0(0x13d),async function(){var _0x189101=_0x450cf0;await lockNoti(_0x189101(0x10c),'',0x1388);const _0x5317d8=localStorage[_0x189101(0x124)]('uId');if(_0x5317d8===null||_0x5317d8==='')window[_0x189101(0xf4)](_0x189101(0xe3));else{const _0x344825=[_0x189101(0x140),'save',_0x189101(0x11b)];for(const _0x4a7c6c of _0x344825){await dpCreateFolder(_0x4a7c6c);}let _0x4b3f30=0x0;for(const _0x3b2f0a of _0x344825){const _0x1c0163=a0_0xe669b7[_0x189101(0xeb)+(_0x3b2f0a[_0x189101(0x110)](0x0)[_0x189101(0x10d)]()+_0x3b2f0a[_0x189101(0x102)](0x1))]();_0x4b3f30+=_0x1c0163[_0x189101(0x138)];}if(window['confirm'](_0x189101(0x10a)+_0x4b3f30+_0x189101(0x132)))for(const _0x411180 of _0x344825){const _0x28a26e=a0_0xe669b7[_0x189101(0xeb)+(_0x411180[_0x189101(0x110)](0x0)['toUpperCase']()+_0x411180['slice'](0x1))]();for(const _0x235800 of _0x28a26e){const _0x55d75d=await a0_0xe669b7[_0x189101(0x14a)](_0x189101(0x107)+_0x411180+'s/'+_0x235800);try{await lockNoti(_0x189101(0x10b),_0x235800,0xbb8),await dpUploadFile(_0x235800,_0x55d75d,_0x411180);}catch(_0x470eb5){console[_0x189101(0xe2)]('Failed\x20to\x20upload\x20file\x20'+_0x235800+':',_0x470eb5);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x450cf0(0x13d),function(){var _0xafffc1=_0x450cf0;const _0x24b0c8=localStorage[_0xafffc1(0x124)](_0xafffc1(0x126));_0x24b0c8===null||_0x24b0c8===''?authorizeWithDropbox():window[_0xafffc1(0xf7)](_0xafffc1(0x116))&&(localStorage[_0xafffc1(0xef)](_0xafffc1(0x126),''),dropboxRestore[_0xafffc1(0xf2)][_0xafffc1(0x149)]('active'),dropboxBackup[_0xafffc1(0xf2)][_0xafffc1(0x149)](_0xafffc1(0xee)),dropboxCloud[_0xafffc1(0xf2)]['remove'](_0xafffc1(0xee)));}),handleDropboxCallback();});