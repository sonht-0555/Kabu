var a0_0x3dffc2=a0_0x4368;(function(_0x2934d3,_0x3d763e){var _0x482035=a0_0x4368,_0x5150c0=_0x2934d3();while(!![]){try{var _0x47dd33=-parseInt(_0x482035(0x147))/0x1+-parseInt(_0x482035(0x15f))/0x2+parseInt(_0x482035(0x12a))/0x3+parseInt(_0x482035(0x158))/0x4+parseInt(_0x482035(0x161))/0x5+-parseInt(_0x482035(0x169))/0x6*(parseInt(_0x482035(0x14a))/0x7)+parseInt(_0x482035(0x129))/0x8;if(_0x47dd33===_0x3d763e)break;else _0x5150c0['push'](_0x5150c0['shift']());}catch(_0x57f91c){_0x5150c0['push'](_0x5150c0['shift']());}}}(a0_0x5876,0x546ac));import*as a0_0x22a4e2 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret='nwb3dnfh09rhs31';function a0_0x5876(){var _0x3d3ba8=['Failed\x20to\x20upload\x20file\x20','Refreshing\x20token...','log','&response_type=','blob','confirm','classList','entries','status','Restoring...','&grant_type=','&token_access_type=','Error\x20while\x20refreshing\x20token:','state','map','530200liVSLX','downloadFileInCloud','&client_secret=','21UxDQAP','responseText','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','error','file','uId','setItem','Folder\x20already\x20exists','open','json','POST','send','accessToken','filter','502516JJFXwa','https://api.dropboxapi.com/2/files/list_folder','exec','&redirect_uri=','name','Cloud\x20login\x20required!','Wait\x20a\x20little\x20bit...','1266636JOFRfn','save','2255595PMsbRN','refresh_token=','Content-Type','access_token','Unable\x20to\x20refresh\x20token','/data/','authorization_code','Upload\x20failed,\x20unknown\x20http\x20status:\x20','1184346gnHZxA','active','stringify','code','code=','Do\x20not\x20receive\x20authorization','DOMContentLoaded','addEventListener','href','Backing\x20up...','https://api.dropbox.com/oauth2/token','Folder\x20created','https://content.dropboxapi.com/2/files/upload','replace','Failed\x20to\x20refresh\x20Dropbox\x20token.','Download\x20failed\x20for\x20','click','application/json','Error\x20creating\x20folder\x20','listFiles','remove','=([^&#]*)','split','Do\x20you\x20want\x20to\x20restore\x20','Do\x20you\x20want\x20to\x20backup\x20','https://www.dropbox.com/oauth2/authorize?client_id=','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','.tag','\x20files\x20from\x20Cloud?','refreshToken','https://content.dropboxapi.com/2/files/download','getItem','9850280USokFG','880290KeLKAz',',\x20status:\x20','application/octet-stream','Bearer\x20','setRequestHeader','https://api.dropboxapi.com/oauth2/token','location','length','Restore\x20canceled\x20by\x20user.','https://api.dropboxapi.com/2/files/create_folder_v2','parse','folder','application/x-www-form-urlencoded','overwrite'];a0_0x5876=function(){return _0x3d3ba8;};return a0_0x5876();}function authorizeWithDropbox(){var _0x5ba163=a0_0x4368,_0x5ac2a4=window[_0x5ba163(0x130)][_0x5ba163(0x111)][_0x5ba163(0x11f)]('?')[0x0],_0x12cf02=_0x5ba163(0x16c),_0xf910c3='offline',_0x23a6bb=_0x5ba163(0x122)+clientId+_0x5ba163(0x13b)+_0x12cf02+_0x5ba163(0x143)+_0xf910c3+_0x5ba163(0x15b)+encodeURIComponent(_0x5ac2a4);window[_0x5ba163(0x130)][_0x5ba163(0x111)]=_0x23a6bb;}function handleDropboxCallback(){var _0x51774f=a0_0x4368,_0x2f48ba=getUrlParameter(_0x51774f(0x16c));_0x2f48ba?(getAccessToken(_0x2f48ba),console[_0x51774f(0x13a)]('Authorization\x20Code:',_0x2f48ba)):console['log'](_0x51774f(0x10e));}function getUrlParameter(_0x43556f){var _0x9be9cb=a0_0x4368;_0x43556f=_0x43556f[_0x9be9cb(0x116)](/[\[]/,'\x5c[')[_0x9be9cb(0x116)](/[\]]/,'\x5c]');var _0x2f3f16=new RegExp('[\x5c?&#]'+_0x43556f+_0x9be9cb(0x11e)),_0x54bf6b=_0x2f3f16[_0x9be9cb(0x15a)](location['search']);return _0x54bf6b===null?'':decodeURIComponent(_0x54bf6b[0x1][_0x9be9cb(0x116)](/\+/g,'\x20'));}function getAccessToken(_0x1169f8){var _0x22c10c=a0_0x4368,_0x598427=_0x22c10c(0x167),_0x3d19e4=window[_0x22c10c(0x130)][_0x22c10c(0x111)][_0x22c10c(0x11f)]('?')[0x0],_0x2a4f07=new XMLHttpRequest();_0x2a4f07[_0x22c10c(0x152)](_0x22c10c(0x154),_0x22c10c(0x113)),_0x2a4f07[_0x22c10c(0x12e)](_0x22c10c(0x163),_0x22c10c(0x136)),_0x2a4f07['onload']=function(){var _0x224838=_0x22c10c;if(_0x2a4f07[_0x224838(0x140)]===0xc8){var _0x40ec96=JSON[_0x224838(0x134)](_0x2a4f07[_0x224838(0x14b)]),_0x1de949=_0x40ec96[_0x224838(0x164)],_0x4ca877=_0x40ec96['refresh_token'],_0x4bf1bd=_0x40ec96['uid'];localStorage['setItem'](_0x224838(0x156),_0x1de949),localStorage[_0x224838(0x150)](_0x224838(0x126),_0x4ca877),localStorage['setItem']('uId',_0x4bf1bd);}else console[_0x224838(0x13a)](_0x224838(0x14c));},_0x2a4f07[_0x22c10c(0x155)](_0x22c10c(0x16d)+_0x1169f8+_0x22c10c(0x142)+_0x598427+'&client_id='+clientId+_0x22c10c(0x149)+clientSecret+_0x22c10c(0x15b)+encodeURIComponent(_0x3d19e4));}export async function dpCreateFolder(_0x58687c){var _0x53067d=a0_0x4368;const _0x4bc3ff=localStorage[_0x53067d(0x128)]('uId');let _0x7d8d29=localStorage['getItem']('accessToken');const _0x36a8be='/'+_0x4bc3ff+'/'+_0x58687c,_0x12741a=JSON[_0x53067d(0x16b)]({'path':_0x36a8be,'autorename':![]});for(let _0x2a7d36=0x0;_0x2a7d36<0x2;_0x2a7d36++){try{const _0x57f7c7=await fetch(_0x53067d(0x133),{'method':_0x53067d(0x154),'headers':{'Authorization':_0x53067d(0x12d)+_0x7d8d29,'Content-Type':'application/json'},'body':_0x12741a});if(_0x57f7c7[_0x53067d(0x140)]===0x191){const _0x3238b5=await dpRefreshToken();if(!_0x3238b5)throw new Error(_0x53067d(0x165));_0x7d8d29=localStorage[_0x53067d(0x128)](_0x53067d(0x156));continue;}if(_0x57f7c7[_0x53067d(0x140)]===0x199)return{'message':_0x53067d(0x151),'path':_0x58687c};if(!_0x57f7c7['ok'])throw new Error(_0x53067d(0x11b)+_0x58687c);const _0x536d74=await _0x57f7c7[_0x53067d(0x153)]();return await lockNoti(_0x53067d(0x114),'',0xbb8),_0x536d74;}catch(_0x15cea6){if(_0x2a7d36===0x1)throw _0x15cea6;}}return![];}export async function dpRefreshToken(){var _0x40a081=a0_0x4368;if(!localStorage[_0x40a081(0x128)]('refreshToken'))throw'No\x20refresh\x20token';try{const _0x542522=await fetch(_0x40a081(0x12f),{'method':_0x40a081(0x154),'headers':{'Content-Type':_0x40a081(0x136)},'body':_0x40a081(0x162)+localStorage['getItem'](_0x40a081(0x126))+_0x40a081(0x123)}),_0x3de36e=await _0x542522[_0x40a081(0x153)]();if(!_0x3de36e[_0x40a081(0x14d)])return localStorage['setItem']('accessToken',_0x3de36e[_0x40a081(0x164)]),await lockNoti(_0x40a081(0x139),'',0xbb8),await delay(0x3e8),!![];else alert(_0x3de36e['error_description']||_0x40a081(0x117));}catch(_0x5b323b){console[_0x40a081(0x14d)](_0x40a081(0x144),_0x5b323b);}return![];}export async function dpUploadFile(_0x25e957,_0x14a611,_0x1d72b9){var _0x23693c=a0_0x4368;const _0xf30bf4=localStorage[_0x23693c(0x128)](_0x23693c(0x14f));var _0x2da939=JSON[_0x23693c(0x16b)]({'autorename':!![],'mode':_0x23693c(0x137),'mute':!![],'strict_conflict':![],'path':'/'+_0xf30bf4+'/'+_0x1d72b9+'/'+_0x25e957}),_0x1e9428=new Blob([_0x14a611],{'type':_0x23693c(0x12c)});for(var _0x8bfcfb=0x0;_0x8bfcfb<0x2;_0x8bfcfb++){var _0x4ff3c3=await fetch(_0x23693c(0x115),{'method':_0x23693c(0x154),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x23693c(0x128)](_0x23693c(0x156)),'Dropbox-API-Arg':_0x2da939,'Content-Type':_0x23693c(0x12c)},'body':_0x1e9428});if(_0x4ff3c3[_0x23693c(0x140)]!=0xc8){if(_0x4ff3c3[_0x23693c(0x140)]==0x191){var _0x334f2b=await dpRefreshToken();if(!_0x334f2b)throw _0x23693c(0x165);continue;}else throw _0x23693c(0x168)+_0x4ff3c3[_0x23693c(0x140)];}else{var _0x1bde21=await _0x4ff3c3['json']();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x25e957),_0x1bde21;}}return![];}function a0_0x4368(_0x38df88,_0x5e7874){var _0x587632=a0_0x5876();return a0_0x4368=function(_0x436843,_0x4fb9c9){_0x436843=_0x436843-0x10e;var _0x4b7461=_0x587632[_0x436843];return _0x4b7461;},a0_0x4368(_0x38df88,_0x5e7874);}export async function dpDownloadFile(_0x6280e2,_0x340fae){var _0x1e8461=a0_0x4368;const _0x305cfd=localStorage[_0x1e8461(0x128)]('uId');var _0x422eec=JSON[_0x1e8461(0x16b)]({'path':'/'+_0x305cfd+'/'+_0x340fae+'/'+_0x6280e2});for(var _0x4f45fa=0x0;_0x4f45fa<0x2;_0x4f45fa++){var _0x3001dd=await fetch(_0x1e8461(0x127),{'method':_0x1e8461(0x154),'headers':{'Authorization':_0x1e8461(0x12d)+localStorage[_0x1e8461(0x128)]('accessToken'),'Dropbox-API-Arg':_0x422eec}});if(_0x3001dd[_0x1e8461(0x140)]!=0xc8){if(_0x3001dd['status']==0x191){var _0x13932e=await dpRefreshToken();if(!_0x13932e)throw _0x1e8461(0x165);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x3001dd['status'];}const _0x73f473=new File([await _0x3001dd[_0x1e8461(0x13c)]()],_0x6280e2);return console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x73f473[_0x1e8461(0x15c)]),a0_0x22a4e2['uploadFileInCloud'](_0x73f473,()=>{}),_0x73f473;}return![];}document['addEventListener'](a0_0x3dffc2(0x10f),function(){var _0x41df6e=a0_0x3dffc2;dropboxRestore['addEventListener'](_0x41df6e(0x119),async function(){var _0x5a8521=_0x41df6e;await lockNoti(_0x5a8521(0x15e),'',0x1388);const _0x4039b2=localStorage[_0x5a8521(0x128)](_0x5a8521(0x14f)),_0x446d47=[_0x5a8521(0x145),'save','screenshot'];if(!_0x4039b2){window['alert']('Cloud\x20login\x20required!');return;}let _0x20f599=[];for(const _0x4cb44e of _0x446d47){let _0x18a60b={'path':'/'+_0x4039b2+'/'+_0x4cb44e};for(let _0x143a5e=0x0;_0x143a5e<0x2;_0x143a5e++){let _0x35d9f5=await fetch(_0x5a8521(0x159),{'method':_0x5a8521(0x154),'headers':{'Authorization':_0x5a8521(0x12d)+localStorage[_0x5a8521(0x128)](_0x5a8521(0x156)),'Content-Type':_0x5a8521(0x11a)},'body':JSON['stringify'](_0x18a60b)});if(_0x35d9f5[_0x5a8521(0x140)]===0xc8){let _0x4adcc4=await _0x35d9f5['json'](),_0x4ec21b=_0x4adcc4[_0x5a8521(0x13f)][_0x5a8521(0x157)](_0x20b69e=>_0x20b69e[_0x5a8521(0x124)]===_0x5a8521(0x14e));_0x4ec21b[_0x5a8521(0x131)]>0x0&&_0x20f599['push'](..._0x4ec21b[_0x5a8521(0x146)](_0x3e5c0a=>({'name':_0x3e5c0a[_0x5a8521(0x15c)],'folder':_0x4cb44e})));break;}else{if(_0x35d9f5['status']===0x191){let _0x11fb3f=await dpRefreshToken();if(!_0x11fb3f)throw _0x5a8521(0x165);}else{console[_0x5a8521(0x14d)](_0x5a8521(0x118)+_0x4cb44e+_0x5a8521(0x12b)+_0x35d9f5['status']);break;}}}}if(_0x20f599[_0x5a8521(0x131)]>0x0){const _0x42f0c2=_0x5a8521(0x120)+_0x20f599['length']+_0x5a8521(0x125);if(window['confirm'](_0x42f0c2))for(const _0x2a2d76 of _0x20f599){await lockNoti(_0x5a8521(0x141),_0x2a2d76[_0x5a8521(0x15c)],0xbb8),await dpDownloadFile(_0x2a2d76['name'],_0x2a2d76[_0x5a8521(0x135)]);}else console['log'](_0x5a8521(0x132));}else console[_0x5a8521(0x13a)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x41df6e(0x110)](_0x41df6e(0x119),async function(){var _0x6c3947=_0x41df6e;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x476abe=localStorage[_0x6c3947(0x128)](_0x6c3947(0x14f));if(_0x476abe===null||_0x476abe==='')window['alert'](_0x6c3947(0x15d));else{const _0x16a9f8=[_0x6c3947(0x145),_0x6c3947(0x160),'screenshot'];for(const _0x3d93b6 of _0x16a9f8){await dpCreateFolder(_0x3d93b6);}let _0x20a68f=0x0;for(const _0x2620f4 of _0x16a9f8){const _0x107a9f=a0_0x22a4e2[_0x6c3947(0x11c)](_0x2620f4+'s');_0x20a68f+=_0x107a9f[_0x6c3947(0x131)];}if(window[_0x6c3947(0x13d)](_0x6c3947(0x121)+_0x20a68f+'\x20files\x20in\x20Kabu?'))for(const _0x3d56ed of _0x16a9f8){const _0xeb5e8c=a0_0x22a4e2[_0x6c3947(0x11c)](_0x3d56ed+'s');for(const _0x32adfc of _0xeb5e8c){const _0x23985b=await a0_0x22a4e2[_0x6c3947(0x148)](_0x6c3947(0x166)+_0x3d56ed+'s/'+_0x32adfc);try{await lockNoti(_0x6c3947(0x112),_0x32adfc,0xbb8),await dpUploadFile(_0x32adfc,_0x23985b,_0x3d56ed);}catch(_0x53e4cd){console[_0x6c3947(0x14d)](_0x6c3947(0x138)+_0x32adfc+':',_0x53e4cd);}}}else console[_0x6c3947(0x13a)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x41df6e(0x110)](_0x41df6e(0x119),function(){var _0x1205b9=_0x41df6e;const _0x432423=localStorage[_0x1205b9(0x128)](_0x1205b9(0x14f));_0x432423===null||_0x432423===''?authorizeWithDropbox():window[_0x1205b9(0x13d)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x1205b9(0x150)]('uId',''),dropboxRestore['classList'][_0x1205b9(0x11d)](_0x1205b9(0x16a)),dropboxBackup['classList'][_0x1205b9(0x11d)]('active'),dropboxCloud[_0x1205b9(0x13e)]['remove']('active'));}),handleDropboxCallback();});