var a0_0x5093c8=a0_0xd654;(function(_0x162559,_0x2d78d4){var _0x438d63=a0_0xd654,_0x592efe=_0x162559();while(!![]){try{var _0x11c60f=parseInt(_0x438d63(0x21e))/0x1+-parseInt(_0x438d63(0x1c6))/0x2+parseInt(_0x438d63(0x1ef))/0x3*(parseInt(_0x438d63(0x1f4))/0x4)+-parseInt(_0x438d63(0x208))/0x5+-parseInt(_0x438d63(0x1dd))/0x6*(parseInt(_0x438d63(0x1cd))/0x7)+parseInt(_0x438d63(0x1f3))/0x8+parseInt(_0x438d63(0x1c7))/0x9;if(_0x11c60f===_0x2d78d4)break;else _0x592efe['push'](_0x592efe['shift']());}catch(_0x3080a6){_0x592efe['push'](_0x592efe['shift']());}}}(a0_0x2cb1,0xec025));import*as a0_0x38aa22 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x5093c8(0x1bc),clientSecret=a0_0x5093c8(0x1b7);function authorizeWithDropbox(){var _0x5a107b=a0_0x5093c8,_0x142b7e=window['location'][_0x5a107b(0x21b)][_0x5a107b(0x20c)]('?')[0x0],_0x2e6a3f=_0x5a107b(0x213),_0x3673ab=_0x5a107b(0x1ba),_0x304693=_0x5a107b(0x1f2)+clientId+'&response_type='+_0x2e6a3f+_0x5a107b(0x1d5)+_0x3673ab+_0x5a107b(0x212)+encodeURIComponent(_0x142b7e);window[_0x5a107b(0x214)]['href']=_0x304693;}function a0_0x2cb1(){var _0x1ea976=['json','https://www.dropbox.com/oauth2/authorize?client_id=','8503816cQsjSL','16JcOtvl','\x20files\x20in\x20Kabu?','onload','Authorization\x20Code:','setRequestHeader','Do\x20you\x20want\x20to\x20restore\x20','search','filter','Bearer\x20','length','code=','state','responseText','replace','=([^&#]*)','downloadFileInCloud','refresh_token=','authorization_code','accessToken','file','8605100uHIuXd','/data/','.tag','&client_id=','split','error','&client_secret=','Download\x20failed\x20for\x20','Refreshing\x20token...','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','&redirect_uri=','code','location','https://api.dropboxapi.com/2/files/create_folder_v2','alert','https://api.dropbox.com/oauth2/token','push','Cloud\x20login\x20required!','access_token','href','Restoring...','blob','1531324fqhvPF','DOMContentLoaded','Upload\x20failed,\x20unknown\x20http\x20status:\x20','https://content.dropboxapi.com/2/files/download','nwb3dnfh09rhs31','parse','open','offline','&grant_type=','knh3uz2mx2hp2eu','stringify','refreshToken','log','confirm','application/json','exec','Backing\x20up...','getItem','Folder\x20already\x20exists','2570286GCXkFW','847296nXRwuR','uId','\x20files\x20from\x20Cloud?','No\x20files\x20found\x20to\x20restore.','error_description','Failed\x20to\x20upload\x20file\x20','3153535dxdFOl','application/octet-stream','active','remove','Failed\x20to\x20refresh\x20Dropbox\x20token.','name','Do\x20not\x20receive\x20authorization','uploadFileInCloud','&token_access_type=','Unable\x20to\x20refresh\x20token','save','https://api.dropboxapi.com/oauth2/token','No\x20refresh\x20token',',\x20status:\x20','Error\x20creating\x20folder\x20','Wait\x20a\x20little\x20bit...','6DQeirf','entries','click','Folder\x20created','application/x-www-form-urlencoded','listFiles','Content-Type','classList','[\x5c?&#]','addEventListener','POST','screenshot','https://content.dropboxapi.com/2/files/upload','setItem','Restore\x20canceled\x20by\x20user.','status','Cloud\x20↦\x20Kabu\x20storage\x20◆','Kabu\x20storage\x20↦\x20Cloud\x20◆','1301187oaSXnd','refresh_token'];a0_0x2cb1=function(){return _0x1ea976;};return a0_0x2cb1();}function handleDropboxCallback(){var _0x331bf4=a0_0x5093c8,_0x4c3fe5=getUrlParameter('code');_0x4c3fe5?(getAccessToken(_0x4c3fe5),console[_0x331bf4(0x1bf)](_0x331bf4(0x1f7),_0x4c3fe5)):console[_0x331bf4(0x1bf)](_0x331bf4(0x1d3));}function a0_0xd654(_0x487d02,_0x15ce01){var _0x2cb117=a0_0x2cb1();return a0_0xd654=function(_0xd65413,_0x22d994){_0xd65413=_0xd65413-0x1b6;var _0xa4bb2f=_0x2cb117[_0xd65413];return _0xa4bb2f;},a0_0xd654(_0x487d02,_0x15ce01);}function getUrlParameter(_0x1e5dd1){var _0xb65252=a0_0x5093c8;_0x1e5dd1=_0x1e5dd1['replace'](/[\[]/,'\x5c[')[_0xb65252(0x201)](/[\]]/,'\x5c]');var _0x497be5=new RegExp(_0xb65252(0x1e5)+_0x1e5dd1+_0xb65252(0x202)),_0x260940=_0x497be5[_0xb65252(0x1c2)](location[_0xb65252(0x1fa)]);return _0x260940===null?'':decodeURIComponent(_0x260940[0x1][_0xb65252(0x201)](/\+/g,'\x20'));}function getAccessToken(_0x1186af){var _0x258500=a0_0x5093c8,_0x24deec=_0x258500(0x205),_0x32e8e0=window[_0x258500(0x214)][_0x258500(0x21b)]['split']('?')[0x0],_0xa89252=new XMLHttpRequest();_0xa89252[_0x258500(0x1b9)]('POST',_0x258500(0x217)),_0xa89252[_0x258500(0x1f8)](_0x258500(0x1e3),_0x258500(0x1e1)),_0xa89252[_0x258500(0x1f6)]=function(){var _0x4a4257=_0x258500;if(_0xa89252[_0x4a4257(0x1ec)]===0xc8){var _0x4ff194=JSON[_0x4a4257(0x1b8)](_0xa89252[_0x4a4257(0x200)]),_0x50fc6d=_0x4ff194[_0x4a4257(0x21a)],_0x368393=_0x4ff194[_0x4a4257(0x1f0)],_0x559041=_0x4ff194['uid'];localStorage[_0x4a4257(0x1ea)]('accessToken',_0x50fc6d),localStorage['setItem'](_0x4a4257(0x1be),_0x368393),localStorage[_0x4a4257(0x1ea)](_0x4a4257(0x1c8),_0x559041);}else console[_0x4a4257(0x1bf)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0xa89252['send'](_0x258500(0x1fe)+_0x1186af+_0x258500(0x1bb)+_0x24deec+_0x258500(0x20b)+clientId+_0x258500(0x20e)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x32e8e0));}export async function dpCreateFolder(_0x4bb27d){var _0x231438=a0_0x5093c8;const _0x2bf5aa=localStorage[_0x231438(0x1c4)](_0x231438(0x1c8));let _0x5be6d3=localStorage[_0x231438(0x1c4)](_0x231438(0x206));const _0x44273a='/'+_0x2bf5aa+'/'+_0x4bb27d,_0x4567ba=JSON[_0x231438(0x1bd)]({'path':_0x44273a,'autorename':![]});for(let _0x554184=0x0;_0x554184<0x2;_0x554184++){try{const _0x5cfcdf=await fetch(_0x231438(0x215),{'method':_0x231438(0x1e7),'headers':{'Authorization':_0x231438(0x1fc)+_0x5be6d3,'Content-Type':_0x231438(0x1c1)},'body':_0x4567ba});if(_0x5cfcdf['status']===0x191){const _0x5348d2=await dpRefreshToken();if(!_0x5348d2)throw new Error(_0x231438(0x1d6));_0x5be6d3=localStorage[_0x231438(0x1c4)](_0x231438(0x206));continue;}if(_0x5cfcdf['status']===0x199)return{'message':_0x231438(0x1c5),'path':_0x4bb27d};if(!_0x5cfcdf['ok'])throw new Error(_0x231438(0x1db)+_0x4bb27d);const _0x42076d=await _0x5cfcdf[_0x231438(0x1f1)]();return await lockNoti(_0x231438(0x1e0),'',0xbb8),_0x42076d;}catch(_0x34d743){if(_0x554184===0x1)throw _0x34d743;}}return![];}export async function dpRefreshToken(){var _0x45c076=a0_0x5093c8;if(!localStorage[_0x45c076(0x1c4)](_0x45c076(0x1be)))throw _0x45c076(0x1d9);try{const _0x3944d3=await fetch(_0x45c076(0x1d8),{'method':'POST','headers':{'Content-Type':_0x45c076(0x1e1)},'body':_0x45c076(0x204)+localStorage['getItem'](_0x45c076(0x1be))+_0x45c076(0x211)}),_0x14256a=await _0x3944d3['json']();if(!_0x14256a[_0x45c076(0x20d)])return localStorage[_0x45c076(0x1ea)](_0x45c076(0x206),_0x14256a[_0x45c076(0x21a)]),await lockNoti(_0x45c076(0x210),'',0xbb8),await delay(0x3e8),!![];else alert(_0x14256a[_0x45c076(0x1cb)]||_0x45c076(0x1d1));}catch(_0x19eb22){console[_0x45c076(0x20d)]('Error\x20while\x20refreshing\x20token:',_0x19eb22);}return![];}export async function dpUploadFile(_0x64e882,_0x51fca7,_0x359906){var _0x96f484=a0_0x5093c8;const _0x495abc=localStorage[_0x96f484(0x1c4)](_0x96f484(0x1c8));var _0x524717=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x495abc+'/'+_0x359906+'/'+_0x64e882}),_0x2000a6=new Blob([_0x51fca7],{'type':_0x96f484(0x1ce)});for(var _0xdcd25d=0x0;_0xdcd25d<0x2;_0xdcd25d++){var _0x328ed1=await fetch(_0x96f484(0x1e9),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x96f484(0x1c4)](_0x96f484(0x206)),'Dropbox-API-Arg':_0x524717,'Content-Type':_0x96f484(0x1ce)},'body':_0x2000a6});if(_0x328ed1[_0x96f484(0x1ec)]!=0xc8){if(_0x328ed1['status']==0x191){var _0x1367bd=await dpRefreshToken();if(!_0x1367bd)throw _0x96f484(0x1d6);continue;}else throw _0x96f484(0x220)+_0x328ed1['status'];}else{var _0xfe5d70=await _0x328ed1['json']();return console[_0x96f484(0x1bf)](_0x96f484(0x1ee),_0x64e882),_0xfe5d70;}}return![];}export async function dpDownloadFile(_0xa2b8e3,_0x5e8531){var _0x588ed8=a0_0x5093c8;const _0x59a8e4=localStorage[_0x588ed8(0x1c4)](_0x588ed8(0x1c8));var _0x39ef4e=JSON[_0x588ed8(0x1bd)]({'path':'/'+_0x59a8e4+'/'+_0x5e8531+'/'+_0xa2b8e3});for(var _0x14c915=0x0;_0x14c915<0x2;_0x14c915++){var _0xa60347=await fetch(_0x588ed8(0x1b6),{'method':'POST','headers':{'Authorization':_0x588ed8(0x1fc)+localStorage[_0x588ed8(0x1c4)](_0x588ed8(0x206)),'Dropbox-API-Arg':_0x39ef4e}});if(_0xa60347[_0x588ed8(0x1ec)]!=0xc8){if(_0xa60347[_0x588ed8(0x1ec)]==0x191){var _0xf20fa1=await dpRefreshToken();if(!_0xf20fa1)throw _0x588ed8(0x1d6);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0xa60347[_0x588ed8(0x1ec)];}const _0x3a75e3=new File([await _0xa60347[_0x588ed8(0x21d)]()],_0xa2b8e3);return console['log'](_0x588ed8(0x1ed),_0x3a75e3[_0x588ed8(0x1d2)]),a0_0x38aa22[_0x588ed8(0x1d4)](_0x3a75e3,()=>{}),_0x3a75e3;}return![];}document['addEventListener'](a0_0x5093c8(0x21f),function(){var _0x259578=a0_0x5093c8;dropboxRestore[_0x259578(0x1e6)](_0x259578(0x1df),async function(){var _0x3d6fd5=_0x259578;await lockNoti(_0x3d6fd5(0x1dc),'',0x1388);const _0x1d6f57=localStorage['getItem']('uId'),_0x463602=['state',_0x3d6fd5(0x1d7),_0x3d6fd5(0x1e8)];if(!_0x1d6f57){window[_0x3d6fd5(0x216)](_0x3d6fd5(0x219));return;}let _0x44c1b1=[];for(const _0x24e52f of _0x463602){let _0x22deca={'path':'/'+_0x1d6f57+'/'+_0x24e52f};for(let _0x521f99=0x0;_0x521f99<0x2;_0x521f99++){let _0x977575=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x3d6fd5(0x1e7),'headers':{'Authorization':_0x3d6fd5(0x1fc)+localStorage[_0x3d6fd5(0x1c4)](_0x3d6fd5(0x206)),'Content-Type':_0x3d6fd5(0x1c1)},'body':JSON[_0x3d6fd5(0x1bd)](_0x22deca)});if(_0x977575[_0x3d6fd5(0x1ec)]===0xc8){let _0x1e7fe0=await _0x977575[_0x3d6fd5(0x1f1)](),_0x325385=_0x1e7fe0[_0x3d6fd5(0x1de)][_0x3d6fd5(0x1fb)](_0x1669fe=>_0x1669fe[_0x3d6fd5(0x20a)]===_0x3d6fd5(0x207));_0x325385['length']>0x0&&_0x44c1b1[_0x3d6fd5(0x218)](..._0x325385['map'](_0x21aa40=>({'name':_0x21aa40['name'],'folder':_0x24e52f})));break;}else{if(_0x977575[_0x3d6fd5(0x1ec)]===0x191){let _0x57d24f=await dpRefreshToken();if(!_0x57d24f)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x3d6fd5(0x20d)](_0x3d6fd5(0x20f)+_0x24e52f+_0x3d6fd5(0x1da)+_0x977575[_0x3d6fd5(0x1ec)]);break;}}}}if(_0x44c1b1[_0x3d6fd5(0x1fd)]>0x0){const _0x1252ed=_0x3d6fd5(0x1f9)+_0x44c1b1[_0x3d6fd5(0x1fd)]+_0x3d6fd5(0x1c9);if(window[_0x3d6fd5(0x1c0)](_0x1252ed))for(const _0x260ed7 of _0x44c1b1){await lockNoti(_0x3d6fd5(0x21c),_0x260ed7[_0x3d6fd5(0x1d2)],0xbb8),await dpDownloadFile(_0x260ed7[_0x3d6fd5(0x1d2)],_0x260ed7['folder']);}else console['log']('Restore\x20canceled\x20by\x20user.');}else console[_0x3d6fd5(0x1bf)](_0x3d6fd5(0x1ca));}),dropboxBackup[_0x259578(0x1e6)](_0x259578(0x1df),async function(){var _0x40bc0a=_0x259578;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x214ab4=localStorage['getItem']('uId');if(_0x214ab4===null||_0x214ab4==='')window['alert'](_0x40bc0a(0x219));else{const _0x23cb63=[_0x40bc0a(0x1ff),_0x40bc0a(0x1d7),_0x40bc0a(0x1e8)];for(const _0x391de1 of _0x23cb63){await dpCreateFolder(_0x391de1);}let _0x311dc9=0x0;for(const _0x3f906b of _0x23cb63){const _0x3671cf=a0_0x38aa22[_0x40bc0a(0x1e2)](_0x3f906b+'s');_0x311dc9+=_0x3671cf[_0x40bc0a(0x1fd)];}if(window[_0x40bc0a(0x1c0)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x311dc9+_0x40bc0a(0x1f5)))for(const _0x54dae8 of _0x23cb63){const _0x454fe4=a0_0x38aa22[_0x40bc0a(0x1e2)](_0x54dae8+'s');for(const _0x174d2e of _0x454fe4){const _0x4e756b=await a0_0x38aa22[_0x40bc0a(0x203)](_0x40bc0a(0x209)+_0x54dae8+'s/'+_0x174d2e);try{await lockNoti(_0x40bc0a(0x1c3),_0x174d2e,0xbb8),await dpUploadFile(_0x174d2e,_0x4e756b,_0x54dae8);}catch(_0x2ddb0a){console[_0x40bc0a(0x20d)](_0x40bc0a(0x1cc)+_0x174d2e+':',_0x2ddb0a);}}}else console[_0x40bc0a(0x1bf)](_0x40bc0a(0x1eb));}}),dropboxCloud['addEventListener'](_0x259578(0x1df),function(){var _0x1a4ed6=_0x259578;const _0x4f79cb=localStorage[_0x1a4ed6(0x1c4)](_0x1a4ed6(0x1c8));_0x4f79cb===null||_0x4f79cb===''?authorizeWithDropbox():window[_0x1a4ed6(0x1c0)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x1a4ed6(0x1ea)](_0x1a4ed6(0x1c8),''),dropboxRestore['classList']['remove'](_0x1a4ed6(0x1cf)),dropboxBackup[_0x1a4ed6(0x1e4)][_0x1a4ed6(0x1d0)]('active'),dropboxCloud[_0x1a4ed6(0x1e4)][_0x1a4ed6(0x1d0)](_0x1a4ed6(0x1cf)));}),handleDropboxCallback();});