var a0_0x241eb4=a0_0x1d48;(function(_0x394baf,_0x39ad45){var _0x1a3c65=a0_0x1d48,_0x3b4baf=_0x394baf();while(!![]){try{var _0x3364b8=-parseInt(_0x1a3c65(0xea))/0x1+-parseInt(_0x1a3c65(0x147))/0x2*(-parseInt(_0x1a3c65(0x113))/0x3)+-parseInt(_0x1a3c65(0x10a))/0x4+parseInt(_0x1a3c65(0xeb))/0x5+-parseInt(_0x1a3c65(0x142))/0x6*(parseInt(_0x1a3c65(0x114))/0x7)+parseInt(_0x1a3c65(0x10f))/0x8+-parseInt(_0x1a3c65(0xf9))/0x9*(-parseInt(_0x1a3c65(0x101))/0xa);if(_0x3364b8===_0x39ad45)break;else _0x3b4baf['push'](_0x3b4baf['shift']());}catch(_0x7d56e6){_0x3b4baf['push'](_0x3b4baf['shift']());}}}(a0_0x5a98,0xb286a));import*as a0_0x47298a from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x241eb4(0xe8),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x58c86f=a0_0x241eb4,_0x59a74a=window['location'][_0x58c86f(0x129)]['split']('?')[0x0],_0x47c966=_0x58c86f(0x123),_0x53b721='offline',_0x2e1636=_0x58c86f(0x11e)+clientId+_0x58c86f(0x117)+_0x47c966+'&token_access_type='+_0x53b721+_0x58c86f(0xf5)+encodeURIComponent(_0x59a74a);window[_0x58c86f(0x126)][_0x58c86f(0x129)]=_0x2e1636;}function handleDropboxCallback(){var _0x12da30=a0_0x241eb4,_0x21e1f3=getUrlParameter(_0x12da30(0x123));_0x21e1f3?(getAccessToken(_0x21e1f3),console[_0x12da30(0x11c)](_0x12da30(0x120),_0x21e1f3)):console['log'](_0x12da30(0x115));}function getUrlParameter(_0x39d583){var _0x558811=a0_0x241eb4;_0x39d583=_0x39d583[_0x558811(0x102)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0xbddf32=new RegExp(_0x558811(0x148)+_0x39d583+'=([^&#]*)'),_0x4ae76e=_0xbddf32[_0x558811(0x12b)](location['search']);return _0x4ae76e===null?'':decodeURIComponent(_0x4ae76e[0x1][_0x558811(0x102)](/\+/g,'\x20'));}function getAccessToken(_0x3b47d6){var _0x1305ad=a0_0x241eb4,_0x549707=_0x1305ad(0x110),_0xb2e17b=window[_0x1305ad(0x126)]['href'][_0x1305ad(0x13b)]('?')[0x0],_0x121bd7=new XMLHttpRequest();_0x121bd7[_0x1305ad(0x145)](_0x1305ad(0x116),'https://api.dropbox.com/oauth2/token'),_0x121bd7['setRequestHeader'](_0x1305ad(0x121),_0x1305ad(0x11d)),_0x121bd7['onload']=function(){var _0x263a83=_0x1305ad;if(_0x121bd7[_0x263a83(0x13c)]===0xc8){var _0x3fd78c=JSON['parse'](_0x121bd7['responseText']),_0x416b4b=_0x3fd78c[_0x263a83(0xee)],_0x5e9491=_0x3fd78c[_0x263a83(0x124)],_0x417fc8=_0x3fd78c[_0x263a83(0x10e)];localStorage[_0x263a83(0xed)](_0x263a83(0x132),_0x416b4b),localStorage['setItem']('refreshToken',_0x5e9491),localStorage[_0x263a83(0xed)](_0x263a83(0xf4),_0x417fc8);}else console[_0x263a83(0x11c)](_0x263a83(0x137));},_0x121bd7[_0x1305ad(0x13f)](_0x1305ad(0x111)+_0x3b47d6+_0x1305ad(0xfd)+_0x549707+_0x1305ad(0x105)+clientId+'&client_secret='+clientSecret+_0x1305ad(0xf5)+encodeURIComponent(_0xb2e17b));}export async function dpCreateFolder(_0x2ec889){var _0x4ee516=a0_0x241eb4;const _0x3a1dc6=localStorage[_0x4ee516(0xef)](_0x4ee516(0xf4));let _0x153ed7=localStorage[_0x4ee516(0xef)](_0x4ee516(0x132));const _0x48b100='/'+_0x3a1dc6+'/'+_0x2ec889,_0x12398c=JSON[_0x4ee516(0x11f)]({'path':_0x48b100,'autorename':![]});for(let _0x42429d=0x0;_0x42429d<0x2;_0x42429d++){try{const _0x48b640=await fetch(_0x4ee516(0xec),{'method':_0x4ee516(0x116),'headers':{'Authorization':'Bearer\x20'+_0x153ed7,'Content-Type':_0x4ee516(0x131)},'body':_0x12398c});if(_0x48b640[_0x4ee516(0x13c)]===0x191){const _0x584e4f=await dpRefreshToken();if(!_0x584e4f)throw new Error(_0x4ee516(0x12d));_0x153ed7=localStorage[_0x4ee516(0xef)](_0x4ee516(0x132));continue;}if(_0x48b640[_0x4ee516(0x13c)]===0x199)return{'message':_0x4ee516(0x135),'path':_0x2ec889};if(!_0x48b640['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x2ec889);const _0x4e2068=await _0x48b640[_0x4ee516(0xe9)]();return await lockNoti('Folder\x20created','',0xbb8),_0x4e2068;}catch(_0x1d899b){if(_0x42429d===0x1)throw _0x1d899b;}}return![];}function a0_0x5a98(){var _0x32bdb0=['knh3uz2mx2hp2eu','json','1060945hkxLJx','5242415YJuVrs','https://api.dropboxapi.com/2/files/create_folder_v2','setItem','access_token','getItem','https://api.dropboxapi.com/oauth2/token','No\x20files\x20found\x20to\x20restore.','refreshToken','blob','uId','&redirect_uri=','screenshot','Cloud\x20login\x20required!','Download\x20failed\x20for\x20','600147sLRSlM','https://content.dropboxapi.com/2/files/download','save','addEventListener','&grant_type=','confirm','Restoring...','https://content.dropboxapi.com/2/files/upload','70VSdmNr','replace','refresh_token=','FSSync','&client_id=','name','\x20files\x20from\x20Cloud?','toUpperCase','filter','1684616dqoRRw','Kabu\x20storage\x20↦\x20Cloud\x20◆','remove','slice','uid','8631264EcQSRv','authorization_code','code=','.tag','98598agifpx','7957243crcrKQ','Do\x20not\x20receive\x20authorization','POST','&response_type=','Failed\x20to\x20refresh\x20Dropbox\x20token.','state','Refreshing\x20token...','charAt','log','application/x-www-form-urlencoded','https://www.dropbox.com/oauth2/authorize?client_id=','stringify','Authorization\x20Code:','Content-Type','Upload\x20failed,\x20unknown\x20http\x20status:\x20','code','refresh_token','error','location','alert','https://api.dropboxapi.com/2/files/list_folder','href','/data/','exec','error_description','Unable\x20to\x20refresh\x20token','Restore\x20canceled\x20by\x20user.','Cloud\x20↦\x20Kabu\x20storage\x20◆','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','application/json','accessToken','Bearer\x20',',\x20status:\x20','Folder\x20already\x20exists','classList','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','active','Do\x20you\x20want\x20to\x20restore\x20','Do\x20you\x20want\x20to\x20backup\x20','split','status','application/octet-stream','file','send','list','Failed\x20to\x20upload\x20file\x20','6ICilEz','map','Do\x20you\x20want\x20to\x20logout?','open','overwrite','46ByDiFC','[\x5c?&#]','click','No\x20refresh\x20token','Wait\x20a\x20little\x20bit...'];a0_0x5a98=function(){return _0x32bdb0;};return a0_0x5a98();}export async function dpRefreshToken(){var _0x5ebfc3=a0_0x241eb4;if(!localStorage['getItem'](_0x5ebfc3(0xf2)))throw _0x5ebfc3(0xe6);try{const _0x3a425b=await fetch(_0x5ebfc3(0xf0),{'method':_0x5ebfc3(0x116),'headers':{'Content-Type':_0x5ebfc3(0x11d)},'body':_0x5ebfc3(0x103)+localStorage[_0x5ebfc3(0xef)]('refreshToken')+_0x5ebfc3(0x130)}),_0x4900cd=await _0x3a425b[_0x5ebfc3(0xe9)]();if(!_0x4900cd[_0x5ebfc3(0x125)])return localStorage[_0x5ebfc3(0xed)](_0x5ebfc3(0x132),_0x4900cd['access_token']),await lockNoti('',_0x5ebfc3(0x11a),0xbb8),await delay(0x3e8),!![];else alert(_0x4900cd[_0x5ebfc3(0x12c)]||_0x5ebfc3(0x118));}catch(_0x37e404){console[_0x5ebfc3(0x125)]('Error\x20while\x20refreshing\x20token:',_0x37e404);}return![];}function a0_0x1d48(_0x2c669b,_0x3dcad5){var _0x5a9856=a0_0x5a98();return a0_0x1d48=function(_0x1d4896,_0xca768d){_0x1d4896=_0x1d4896-0xe5;var _0x24a678=_0x5a9856[_0x1d4896];return _0x24a678;},a0_0x1d48(_0x2c669b,_0x3dcad5);}export async function dpUploadFile(_0x2c4ee9,_0x51346e,_0x35168d){var _0x1c8554=a0_0x241eb4;const _0x2eea77=localStorage[_0x1c8554(0xef)]('uId');var _0x3a9373=JSON['stringify']({'autorename':!![],'mode':_0x1c8554(0x146),'mute':!![],'strict_conflict':![],'path':'/'+_0x2eea77+'/'+_0x35168d+'/'+_0x2c4ee9}),_0x38ffc4=new Blob([_0x51346e],{'type':_0x1c8554(0x13d)});for(var _0xaf0298=0x0;_0xaf0298<0x2;_0xaf0298++){var _0x323386=await fetch(_0x1c8554(0x100),{'method':_0x1c8554(0x116),'headers':{'Authorization':_0x1c8554(0x133)+localStorage[_0x1c8554(0xef)]('accessToken'),'Dropbox-API-Arg':_0x3a9373,'Content-Type':_0x1c8554(0x13d)},'body':_0x38ffc4});if(_0x323386[_0x1c8554(0x13c)]!=0xc8){if(_0x323386[_0x1c8554(0x13c)]==0x191){var _0x5e9634=await dpRefreshToken();if(!_0x5e9634)throw _0x1c8554(0x12d);continue;}else throw _0x1c8554(0x122)+_0x323386[_0x1c8554(0x13c)];}else{var _0x2df2b8=await _0x323386[_0x1c8554(0xe9)]();return console[_0x1c8554(0x11c)](_0x1c8554(0x10b),_0x2c4ee9),_0x2df2b8;}}return![];}export async function dpDownloadFile(_0x1c3e89,_0x4be12d){var _0x4eb243=a0_0x241eb4;const _0x3bb320=localStorage[_0x4eb243(0xef)](_0x4eb243(0xf4));var _0x271d21=JSON[_0x4eb243(0x11f)]({'path':'/'+_0x3bb320+'/'+_0x4be12d+'/'+_0x1c3e89});for(var _0x2ccc73=0x0;_0x2ccc73<0x2;_0x2ccc73++){var _0x48fea6=await fetch(_0x4eb243(0xfa),{'method':_0x4eb243(0x116),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x4eb243(0xef)](_0x4eb243(0x132)),'Dropbox-API-Arg':_0x271d21}});if(_0x48fea6[_0x4eb243(0x13c)]!=0xc8){if(_0x48fea6[_0x4eb243(0x13c)]==0x191){var _0x393561=await dpRefreshToken();if(!_0x393561)throw _0x4eb243(0x12d);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x48fea6[_0x4eb243(0x13c)];}const _0x138498=new File([await _0x48fea6[_0x4eb243(0xf3)]()],_0x1c3e89);return console[_0x4eb243(0x11c)](_0x4eb243(0x12f),_0x138498[_0x4eb243(0x106)]),a0_0x47298a['uploadSaveOrSaveState'](_0x138498,()=>{var _0x4aeb39=_0x4eb243;localStorageFile(),Module[_0x4aeb39(0x104)]();}),_0x138498;}return![];}document[a0_0x241eb4(0xfc)]('DOMContentLoaded',function(){var _0x3ca58a=a0_0x241eb4;dropboxRestore[_0x3ca58a(0xfc)]('click',async function(){var _0x205426=_0x3ca58a;await lockNoti(_0x205426(0xe7),'',0x1388);const _0x1ff056=localStorage[_0x205426(0xef)]('uId'),_0x870640=['state',_0x205426(0xfb),_0x205426(0xf6)];if(!_0x1ff056){window[_0x205426(0x127)](_0x205426(0xf7));return;}let _0x5671df=[];for(const _0x24a918 of _0x870640){let _0x3dadae={'path':'/'+_0x1ff056+'/'+_0x24a918};for(let _0x54dc01=0x0;_0x54dc01<0x2;_0x54dc01++){let _0x48038a=await fetch(_0x205426(0x128),{'method':_0x205426(0x116),'headers':{'Authorization':_0x205426(0x133)+localStorage[_0x205426(0xef)](_0x205426(0x132)),'Content-Type':_0x205426(0x131)},'body':JSON[_0x205426(0x11f)](_0x3dadae)});if(_0x48038a[_0x205426(0x13c)]===0xc8){let _0x5ec70d=await _0x48038a[_0x205426(0xe9)](),_0x423dfb=_0x5ec70d['entries'][_0x205426(0x109)](_0x47a423=>_0x47a423[_0x205426(0x112)]===_0x205426(0x13e));_0x423dfb['length']>0x0&&_0x5671df['push'](..._0x423dfb[_0x205426(0x143)](_0x40677c=>({'name':_0x40677c['name'],'folder':_0x24a918})));break;}else{if(_0x48038a[_0x205426(0x13c)]===0x191){let _0x3b1944=await dpRefreshToken();if(!_0x3b1944)throw _0x205426(0x12d);}else{console[_0x205426(0x125)](_0x205426(0xf8)+_0x24a918+_0x205426(0x134)+_0x48038a[_0x205426(0x13c)]);break;}}}}if(_0x5671df['length']>0x0){const _0x582863=_0x205426(0x139)+_0x5671df['length']+_0x205426(0x107);if(window[_0x205426(0xfe)](_0x582863))for(const _0x2eb4f7 of _0x5671df){await lockNoti(_0x205426(0xff),_0x2eb4f7[_0x205426(0x106)],0xbb8),await dpDownloadFile(_0x2eb4f7['name'],_0x2eb4f7['folder']);}else console['log']('Restore\x20canceled\x20by\x20user.');}else console[_0x205426(0x11c)](_0x205426(0xf1));}),dropboxBackup[_0x3ca58a(0xfc)]('click',async function(){var _0x481d82=_0x3ca58a;await lockNoti(_0x481d82(0xe7),'',0x1388);const _0x451eab=localStorage[_0x481d82(0xef)](_0x481d82(0xf4));if(_0x451eab===null||_0x451eab==='')window[_0x481d82(0x127)](_0x481d82(0xf7));else{const _0x2a8ef0=[_0x481d82(0x119),'save',_0x481d82(0xf6)];for(const _0x4e090b of _0x2a8ef0){await dpCreateFolder(_0x4e090b);}let _0x20b858=0x0;for(const _0x136938 of _0x2a8ef0){const _0x294e8b=a0_0x47298a['list'+(_0x136938[_0x481d82(0x11b)](0x0)['toUpperCase']()+_0x136938[_0x481d82(0x10d)](0x1))]();_0x20b858+=_0x294e8b['length'];}if(window['confirm'](_0x481d82(0x13a)+_0x20b858+'\x20files\x20in\x20Kabu?'))for(const _0x48cc23 of _0x2a8ef0){const _0x5f47af=a0_0x47298a[_0x481d82(0x140)+(_0x48cc23[_0x481d82(0x11b)](0x0)[_0x481d82(0x108)]()+_0x48cc23[_0x481d82(0x10d)](0x1))]();for(const _0x300bc2 of _0x5f47af){const _0x58b415=await a0_0x47298a['downloadFileInCloud'](_0x481d82(0x12a)+_0x48cc23+'s/'+_0x300bc2);try{await lockNoti('Backing\x20up...',_0x300bc2,0xbb8),await dpUploadFile(_0x300bc2,_0x58b415,_0x48cc23);}catch(_0x4ad07a){console[_0x481d82(0x125)](_0x481d82(0x141)+_0x300bc2+':',_0x4ad07a);}}}else console[_0x481d82(0x11c)](_0x481d82(0x12e));}}),dropboxCloud['addEventListener'](_0x3ca58a(0xe5),function(){var _0x16364a=_0x3ca58a;const _0x479c5a=localStorage[_0x16364a(0xef)](_0x16364a(0xf4));_0x479c5a===null||_0x479c5a===''?authorizeWithDropbox():window[_0x16364a(0xfe)](_0x16364a(0x144))&&(localStorage[_0x16364a(0xed)](_0x16364a(0xf4),''),dropboxRestore[_0x16364a(0x136)][_0x16364a(0x10c)](_0x16364a(0x138)),dropboxBackup[_0x16364a(0x136)][_0x16364a(0x10c)](_0x16364a(0x138)),dropboxCloud['classList'][_0x16364a(0x10c)]('active'));}),handleDropboxCallback();});