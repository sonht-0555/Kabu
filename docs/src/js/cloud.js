var a0_0x5e61bd=a0_0x1970;(function(_0x2d675f,_0x535ccf){var _0x2076b7=a0_0x1970,_0x260884=_0x2d675f();while(!![]){try{var _0x119b14=parseInt(_0x2076b7(0x15e))/0x1+parseInt(_0x2076b7(0x169))/0x2*(-parseInt(_0x2076b7(0x181))/0x3)+-parseInt(_0x2076b7(0x17d))/0x4+-parseInt(_0x2076b7(0x188))/0x5+-parseInt(_0x2076b7(0x136))/0x6+parseInt(_0x2076b7(0x16e))/0x7+parseInt(_0x2076b7(0x164))/0x8;if(_0x119b14===_0x535ccf)break;else _0x260884['push'](_0x260884['shift']());}catch(_0x300f41){_0x260884['push'](_0x260884['shift']());}}}(a0_0xfd08,0xdceb0));function a0_0xfd08(){var _0x172eed=['split','3xGAwNP','Error\x20creating\x20folder\x20','Bearer\x20','json','slice','No\x20refresh\x20token','save','2963795hCfTMu','blob','https://api.dropboxapi.com/2/files/list_folder','send','&client_secret=','classList','length','error_description','&grant_type=','log','setItem','/data/',',\x20status:\x20','replace','remove','push','Wait\x20a\x20little\x20bit...','click','7994682NArBlC','search','Unable\x20to\x20refresh\x20token','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','authorization_code','Backing\x20up...','error','getItem','parse','responseText','code','Kabu\x20storage\x20↦\x20Cloud\x20◆','href','confirm','[\x5c?&#]','Error\x20while\x20refreshing\x20token:','refresh_token=','entries','\x20files\x20from\x20Cloud?','https://content.dropboxapi.com/2/files/download','.tag','&client_id=','file','https://api.dropboxapi.com/oauth2/token','exec','folder','Do\x20you\x20want\x20to\x20backup\x20','uploadFileInCloud','addEventListener','\x20files\x20in\x20Kabu?','Do\x20you\x20want\x20to\x20logout?','location','application/json','screenshot','list','Upload\x20failed,\x20unknown\x20http\x20status:\x20','code=','application/octet-stream','stringify','&redirect_uri=','1180864zJnaJu','name','active','accessToken','Do\x20you\x20want\x20to\x20restore\x20','Restore\x20canceled\x20by\x20user.','27570872EEExwF','Authorization\x20Code:','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','charAt','uId','1039102KHButk','=([^&#]*)','application/x-www-form-urlencoded','refreshToken','toUpperCase','2693551hdPzpf','filter','status','setRequestHeader','FSSync','https://content.dropboxapi.com/2/files/upload','knh3uz2mx2hp2eu','access_token','refresh_token','onload','Failed\x20to\x20upload\x20file\x20','DOMContentLoaded','state','Failed\x20to\x20refresh\x20Dropbox\x20token.','POST','6649516yuDZdi','Content-Type','Do\x20not\x20receive\x20authorization'];a0_0xfd08=function(){return _0x172eed;};return a0_0xfd08();}import*as a0_0x8c7578 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x5e61bd(0x174),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x1497e7=a0_0x5e61bd,_0x558e94=window[_0x1497e7(0x155)][_0x1497e7(0x142)][_0x1497e7(0x180)]('?')[0x0],_0x389bd1='code',_0x26317d='offline',_0x3bf532='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+'&response_type='+_0x389bd1+'&token_access_type='+_0x26317d+_0x1497e7(0x15d)+encodeURIComponent(_0x558e94);window[_0x1497e7(0x155)][_0x1497e7(0x142)]=_0x3bf532;}function handleDropboxCallback(){var _0x4990bf=a0_0x5e61bd,_0x5e3134=getUrlParameter(_0x4990bf(0x140));_0x5e3134?(getAccessToken(_0x5e3134),console[_0x4990bf(0x12d)](_0x4990bf(0x165),_0x5e3134)):console[_0x4990bf(0x12d)](_0x4990bf(0x17f));}function getUrlParameter(_0x49110b){var _0x4a6aee=a0_0x5e61bd;_0x49110b=_0x49110b[_0x4a6aee(0x131)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x5a3d54=new RegExp(_0x4a6aee(0x144)+_0x49110b+_0x4a6aee(0x16a)),_0x58838d=_0x5a3d54[_0x4a6aee(0x14e)](location[_0x4a6aee(0x137)]);return _0x58838d===null?'':decodeURIComponent(_0x58838d[0x1]['replace'](/\+/g,'\x20'));}function a0_0x1970(_0x15f39d,_0x49eee5){var _0xfd0810=a0_0xfd08();return a0_0x1970=function(_0x1970f7,_0x5d5af7){_0x1970f7=_0x1970f7-0x12c;var _0x5a1295=_0xfd0810[_0x1970f7];return _0x5a1295;},a0_0x1970(_0x15f39d,_0x49eee5);}function getAccessToken(_0x190f2c){var _0x315d84=a0_0x5e61bd,_0x70e317=_0x315d84(0x13a),_0x2b3674=window[_0x315d84(0x155)][_0x315d84(0x142)][_0x315d84(0x180)]('?')[0x0],_0x1eca11=new XMLHttpRequest();_0x1eca11['open'](_0x315d84(0x17c),'https://api.dropbox.com/oauth2/token'),_0x1eca11[_0x315d84(0x171)](_0x315d84(0x17e),_0x315d84(0x16b)),_0x1eca11[_0x315d84(0x177)]=function(){var _0x455d8e=_0x315d84;if(_0x1eca11[_0x455d8e(0x170)]===0xc8){var _0x18c972=JSON[_0x455d8e(0x13e)](_0x1eca11[_0x455d8e(0x13f)]),_0x50eb9b=_0x18c972[_0x455d8e(0x175)],_0x345b37=_0x18c972[_0x455d8e(0x176)],_0x2772f1=_0x18c972['uid'];localStorage[_0x455d8e(0x12e)](_0x455d8e(0x161),_0x50eb9b),localStorage[_0x455d8e(0x12e)](_0x455d8e(0x16c),_0x345b37),localStorage[_0x455d8e(0x12e)]('uId',_0x2772f1);}else console['log'](_0x455d8e(0x139));},_0x1eca11[_0x315d84(0x18b)](_0x315d84(0x15a)+_0x190f2c+_0x315d84(0x12c)+_0x70e317+_0x315d84(0x14b)+clientId+_0x315d84(0x18c)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x2b3674));}export async function dpCreateFolder(_0x1aa918){var _0x363e72=a0_0x5e61bd;const _0x220a7e=localStorage[_0x363e72(0x13d)](_0x363e72(0x168));let _0x40d2fc=localStorage[_0x363e72(0x13d)]('accessToken');const _0x47f532='/'+_0x220a7e+'/'+_0x1aa918,_0x349781=JSON[_0x363e72(0x15c)]({'path':_0x47f532,'autorename':![]});for(let _0x2f2a7c=0x0;_0x2f2a7c<0x2;_0x2f2a7c++){try{const _0x535db5=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x363e72(0x17c),'headers':{'Authorization':_0x363e72(0x183)+_0x40d2fc,'Content-Type':'application/json'},'body':_0x349781});if(_0x535db5[_0x363e72(0x170)]===0x191){const _0x356397=await dpRefreshToken();if(!_0x356397)throw new Error('Unable\x20to\x20refresh\x20token');_0x40d2fc=localStorage[_0x363e72(0x13d)]('accessToken');continue;}if(_0x535db5[_0x363e72(0x170)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x1aa918};if(!_0x535db5['ok'])throw new Error(_0x363e72(0x182)+_0x1aa918);const _0x4a12a1=await _0x535db5['json']();return await lockNoti('Folder\x20created','',0xbb8),_0x4a12a1;}catch(_0x2f1858){if(_0x2f2a7c===0x1)throw _0x2f1858;}}return![];}export async function dpRefreshToken(){var _0x56a172=a0_0x5e61bd;if(!localStorage[_0x56a172(0x13d)](_0x56a172(0x16c)))throw _0x56a172(0x186);try{const _0x220432=await fetch(_0x56a172(0x14d),{'method':'POST','headers':{'Content-Type':_0x56a172(0x16b)},'body':_0x56a172(0x146)+localStorage[_0x56a172(0x13d)](_0x56a172(0x16c))+_0x56a172(0x166)}),_0x19cb22=await _0x220432[_0x56a172(0x184)]();if(!_0x19cb22[_0x56a172(0x13c)])return localStorage[_0x56a172(0x12e)](_0x56a172(0x161),_0x19cb22[_0x56a172(0x175)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x19cb22[_0x56a172(0x18f)]||_0x56a172(0x17b));}catch(_0x4f2d90){console['error'](_0x56a172(0x145),_0x4f2d90);}return![];}export async function dpUploadFile(_0x5dcb88,_0x5a2e0e,_0x340fa1){var _0x21632e=a0_0x5e61bd;const _0xc22340=localStorage[_0x21632e(0x13d)](_0x21632e(0x168));var _0x16192a=JSON[_0x21632e(0x15c)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0xc22340+'/'+_0x340fa1+'/'+_0x5dcb88}),_0x179df4=new Blob([_0x5a2e0e],{'type':_0x21632e(0x15b)});for(var _0x3ca6e5=0x0;_0x3ca6e5<0x2;_0x3ca6e5++){var _0x3333c4=await fetch(_0x21632e(0x173),{'method':_0x21632e(0x17c),'headers':{'Authorization':_0x21632e(0x183)+localStorage[_0x21632e(0x13d)](_0x21632e(0x161)),'Dropbox-API-Arg':_0x16192a,'Content-Type':'application/octet-stream'},'body':_0x179df4});if(_0x3333c4['status']!=0xc8){if(_0x3333c4[_0x21632e(0x170)]==0x191){var _0x3fd5d0=await dpRefreshToken();if(!_0x3fd5d0)throw _0x21632e(0x138);continue;}else throw _0x21632e(0x159)+_0x3333c4[_0x21632e(0x170)];}else{var _0x45d308=await _0x3333c4[_0x21632e(0x184)]();return console[_0x21632e(0x12d)](_0x21632e(0x141),_0x5dcb88),_0x45d308;}}return![];}export async function dpDownloadFile(_0x20367e,_0x3d87ef){var _0x1cdd99=a0_0x5e61bd;const _0x4a06a6=localStorage[_0x1cdd99(0x13d)](_0x1cdd99(0x168));var _0x21d68d=JSON[_0x1cdd99(0x15c)]({'path':'/'+_0x4a06a6+'/'+_0x3d87ef+'/'+_0x20367e});for(var _0xa43f63=0x0;_0xa43f63<0x2;_0xa43f63++){var _0x52449b=await fetch(_0x1cdd99(0x149),{'method':_0x1cdd99(0x17c),'headers':{'Authorization':_0x1cdd99(0x183)+localStorage['getItem'](_0x1cdd99(0x161)),'Dropbox-API-Arg':_0x21d68d}});if(_0x52449b[_0x1cdd99(0x170)]!=0xc8){if(_0x52449b[_0x1cdd99(0x170)]==0x191){var _0xaf9aa6=await dpRefreshToken();if(!_0xaf9aa6)throw _0x1cdd99(0x138);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x52449b[_0x1cdd99(0x170)];}const _0x411f94=new File([await _0x52449b[_0x1cdd99(0x189)]()],_0x20367e);return console[_0x1cdd99(0x12d)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x411f94[_0x1cdd99(0x15f)]),a0_0x8c7578[_0x1cdd99(0x151)](_0x411f94,()=>{var _0x22f969=_0x1cdd99;localStorageFile(),Module[_0x22f969(0x172)]();}),_0x411f94;}return![];}document[a0_0x5e61bd(0x152)](a0_0x5e61bd(0x179),function(){var _0x375319=a0_0x5e61bd;dropboxRestore[_0x375319(0x152)]('click',async function(){var _0x4cc160=_0x375319;await lockNoti(_0x4cc160(0x134),'',0x1388);const _0x13bb17=localStorage['getItem'](_0x4cc160(0x168)),_0x2bfe3b=[_0x4cc160(0x17a),_0x4cc160(0x187),_0x4cc160(0x157)];if(!_0x13bb17){window['alert']('Cloud\x20login\x20required!');return;}let _0x1cd6d0=[];for(const _0x158547 of _0x2bfe3b){let _0x4fbf09={'path':'/'+_0x13bb17+'/'+_0x158547};for(let _0x31e187=0x0;_0x31e187<0x2;_0x31e187++){let _0x2a5afd=await fetch(_0x4cc160(0x18a),{'method':_0x4cc160(0x17c),'headers':{'Authorization':_0x4cc160(0x183)+localStorage[_0x4cc160(0x13d)](_0x4cc160(0x161)),'Content-Type':_0x4cc160(0x156)},'body':JSON[_0x4cc160(0x15c)](_0x4fbf09)});if(_0x2a5afd['status']===0xc8){let _0x494c86=await _0x2a5afd[_0x4cc160(0x184)](),_0x407fdd=_0x494c86[_0x4cc160(0x147)][_0x4cc160(0x16f)](_0x1df777=>_0x1df777[_0x4cc160(0x14a)]===_0x4cc160(0x14c));_0x407fdd[_0x4cc160(0x18e)]>0x0&&_0x1cd6d0[_0x4cc160(0x133)](..._0x407fdd['map'](_0xefaade=>({'name':_0xefaade[_0x4cc160(0x15f)],'folder':_0x158547})));break;}else{if(_0x2a5afd[_0x4cc160(0x170)]===0x191){let _0x2be392=await dpRefreshToken();if(!_0x2be392)throw _0x4cc160(0x138);}else{console[_0x4cc160(0x13c)]('Download\x20failed\x20for\x20'+_0x158547+_0x4cc160(0x130)+_0x2a5afd[_0x4cc160(0x170)]);break;}}}}if(_0x1cd6d0[_0x4cc160(0x18e)]>0x0){const _0x2d1c4b=_0x4cc160(0x162)+_0x1cd6d0[_0x4cc160(0x18e)]+_0x4cc160(0x148);if(window[_0x4cc160(0x143)](_0x2d1c4b))for(const _0x59c057 of _0x1cd6d0){await lockNoti('Restoring...',_0x59c057[_0x4cc160(0x15f)],0xbb8),await dpDownloadFile(_0x59c057[_0x4cc160(0x15f)],_0x59c057[_0x4cc160(0x14f)]);}else console[_0x4cc160(0x12d)]('Restore\x20canceled\x20by\x20user.');}else console['log']('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup['addEventListener']('click',async function(){var _0x58e162=_0x375319;await lockNoti(_0x58e162(0x134),'',0x1388);const _0x46f42e=localStorage[_0x58e162(0x13d)](_0x58e162(0x168));if(_0x46f42e===null||_0x46f42e==='')window['alert']('Cloud\x20login\x20required!');else{const _0x5a8814=['state',_0x58e162(0x187),_0x58e162(0x157)];for(const _0x4b20e7 of _0x5a8814){await dpCreateFolder(_0x4b20e7);}let _0x4dfea0=0x0;for(const _0x307760 of _0x5a8814){const _0x51a705=a0_0x8c7578[_0x58e162(0x158)+(_0x307760[_0x58e162(0x167)](0x0)[_0x58e162(0x16d)]()+_0x307760['slice'](0x1))]();_0x4dfea0+=_0x51a705[_0x58e162(0x18e)];}if(window['confirm'](_0x58e162(0x150)+_0x4dfea0+_0x58e162(0x153)))for(const _0x179b5f of _0x5a8814){const _0x171de4=a0_0x8c7578[_0x58e162(0x158)+(_0x179b5f['charAt'](0x0)[_0x58e162(0x16d)]()+_0x179b5f[_0x58e162(0x185)](0x1))]();for(const _0x34f560 of _0x171de4){const _0x2611c8=await a0_0x8c7578['downloadFileInCloud'](_0x58e162(0x12f)+_0x179b5f+'s/'+_0x34f560);try{await lockNoti(_0x58e162(0x13b),_0x34f560,0xbb8),await dpUploadFile(_0x34f560,_0x2611c8,_0x179b5f);}catch(_0x58c855){console['error'](_0x58e162(0x178)+_0x34f560+':',_0x58c855);}}}else console['log'](_0x58e162(0x163));}}),dropboxCloud[_0x375319(0x152)](_0x375319(0x135),function(){var _0x3f3a47=_0x375319;const _0x163292=localStorage[_0x3f3a47(0x13d)]('uId');_0x163292===null||_0x163292===''?authorizeWithDropbox():window['confirm'](_0x3f3a47(0x154))&&(localStorage['setItem'](_0x3f3a47(0x168),''),dropboxRestore['classList'][_0x3f3a47(0x132)](_0x3f3a47(0x160)),dropboxBackup[_0x3f3a47(0x18d)][_0x3f3a47(0x132)](_0x3f3a47(0x160)),dropboxCloud[_0x3f3a47(0x18d)][_0x3f3a47(0x132)](_0x3f3a47(0x160)));}),handleDropboxCallback();});