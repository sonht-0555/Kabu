var a0_0x54513a=a0_0x44bd;(function(_0x5391c5,_0x3fe07a){var _0x35832c=a0_0x44bd,_0x118145=_0x5391c5();while(!![]){try{var _0x5e089a=parseInt(_0x35832c(0x1ad))/0x1+-parseInt(_0x35832c(0x1b6))/0x2+parseInt(_0x35832c(0x195))/0x3+parseInt(_0x35832c(0x1a3))/0x4+-parseInt(_0x35832c(0x1a4))/0x5*(parseInt(_0x35832c(0x1f4))/0x6)+-parseInt(_0x35832c(0x1cb))/0x7+parseInt(_0x35832c(0x1a5))/0x8;if(_0x5e089a===_0x3fe07a)break;else _0x118145['push'](_0x118145['shift']());}catch(_0x4fba5b){_0x118145['push'](_0x118145['shift']());}}}(a0_0x14d0,0x30f2a));import*as a0_0x43f644 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x54513a(0x1e1);function authorizeWithDropbox(){var _0x359ac3=a0_0x54513a,_0x5770f8=window['location']['href']['split']('?')[0x0],_0x5ba8cc=_0x359ac3(0x1cf),_0x92b898='offline',_0x4c1103=_0x359ac3(0x19b)+clientId+_0x359ac3(0x1b1)+_0x5ba8cc+_0x359ac3(0x1c2)+_0x92b898+_0x359ac3(0x1df)+encodeURIComponent(_0x5770f8);window[_0x359ac3(0x1d9)][_0x359ac3(0x1bd)]=_0x4c1103;}function a0_0x44bd(_0x419ce2,_0x5203da){var _0x14d094=a0_0x14d0();return a0_0x44bd=function(_0x44bdb4,_0x412a2b){_0x44bdb4=_0x44bdb4-0x195;var _0x21d9f4=_0x14d094[_0x44bdb4];return _0x21d9f4;},a0_0x44bd(_0x419ce2,_0x5203da);}function handleDropboxCallback(){var _0xcc2b45=a0_0x54513a,_0x3afd75=getUrlParameter('code');_0x3afd75?(getAccessToken(_0x3afd75),console[_0xcc2b45(0x1ac)](_0xcc2b45(0x1b0),_0x3afd75)):console[_0xcc2b45(0x1ac)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0xedcccb){var _0x251a00=a0_0x54513a;_0xedcccb=_0xedcccb['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x3184bd=new RegExp(_0x251a00(0x1c1)+_0xedcccb+_0x251a00(0x1af)),_0x10793f=_0x3184bd[_0x251a00(0x1f0)](location[_0x251a00(0x1ba)]);return _0x10793f===null?'':decodeURIComponent(_0x10793f[0x1][_0x251a00(0x1f5)](/\+/g,'\x20'));}function getAccessToken(_0x1a2d1f){var _0x7c9510=a0_0x54513a,_0x1bdb1e='authorization_code',_0x9df68e=window['location']['href']['split']('?')[0x0],_0x59ac8c=new XMLHttpRequest();_0x59ac8c[_0x7c9510(0x19d)](_0x7c9510(0x196),_0x7c9510(0x1d5)),_0x59ac8c[_0x7c9510(0x1b9)](_0x7c9510(0x1c4),_0x7c9510(0x1d3)),_0x59ac8c[_0x7c9510(0x1c3)]=function(){var _0x6a5592=_0x7c9510;if(_0x59ac8c[_0x6a5592(0x1d6)]===0xc8){var _0x2e9afa=JSON[_0x6a5592(0x1a7)](_0x59ac8c[_0x6a5592(0x1f2)]),_0x449abb=_0x2e9afa[_0x6a5592(0x1cc)],_0x227b9f=_0x2e9afa['refresh_token'],_0x67ed24=_0x2e9afa[_0x6a5592(0x198)];localStorage[_0x6a5592(0x1d0)](_0x6a5592(0x1be),_0x449abb),localStorage['setItem'](_0x6a5592(0x1d7),_0x227b9f),localStorage[_0x6a5592(0x1d0)](_0x6a5592(0x1ab),_0x67ed24);}else console[_0x6a5592(0x1ac)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x59ac8c[_0x7c9510(0x1ef)](_0x7c9510(0x1ae)+_0x1a2d1f+_0x7c9510(0x1d8)+_0x1bdb1e+_0x7c9510(0x1a2)+clientId+'&client_secret='+clientSecret+_0x7c9510(0x1df)+encodeURIComponent(_0x9df68e));}export async function dpCreateFolder(_0x2158d8){var _0xc11db3=a0_0x54513a;const _0x2e97ac=localStorage['getItem'](_0xc11db3(0x1ab));let _0x4349f0=localStorage['getItem']('accessToken');const _0x4c4c7e='/'+_0x2e97ac+'/'+_0x2158d8,_0x366b87=JSON['stringify']({'path':_0x4c4c7e,'autorename':![]});for(let _0x5b9fa9=0x0;_0x5b9fa9<0x2;_0x5b9fa9++){try{const _0x2e1a42=await fetch(_0xc11db3(0x197),{'method':_0xc11db3(0x196),'headers':{'Authorization':_0xc11db3(0x1db)+_0x4349f0,'Content-Type':'application/json'},'body':_0x366b87});if(_0x2e1a42[_0xc11db3(0x1d6)]===0x191){const _0x4b291d=await dpRefreshToken();if(!_0x4b291d)throw new Error(_0xc11db3(0x19a));_0x4349f0=localStorage[_0xc11db3(0x1d2)]('accessToken');continue;}if(_0x2e1a42[_0xc11db3(0x1d6)]===0x199)return{'message':_0xc11db3(0x19c),'path':_0x2158d8};if(!_0x2e1a42['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x2158d8);const _0x5c99a3=await _0x2e1a42[_0xc11db3(0x1ec)]();return await lockNoti(_0xc11db3(0x1a0),'',0xbb8),_0x5c99a3;}catch(_0x2971f7){if(_0x5b9fa9===0x1)throw _0x2971f7;}}return![];}export async function dpRefreshToken(){var _0x153a80=a0_0x54513a;if(!localStorage[_0x153a80(0x1d2)](_0x153a80(0x1d7)))throw'No\x20refresh\x20token';try{const _0x17b96c=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x153a80(0x196),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x153a80(0x1e2)+localStorage['getItem']('refreshToken')+_0x153a80(0x1f8)}),_0x5b18e3=await _0x17b96c[_0x153a80(0x1ec)]();if(!_0x5b18e3['error'])return localStorage[_0x153a80(0x1d0)](_0x153a80(0x1be),_0x5b18e3[_0x153a80(0x1cc)]),await lockNoti(_0x153a80(0x1c5),'',0xbb8),await delay(0x3e8),!![];else alert(_0x5b18e3['error_description']||_0x153a80(0x1b7));}catch(_0x52b728){console[_0x153a80(0x199)](_0x153a80(0x1ea),_0x52b728);}return![];}export async function dpUploadFile(_0x42bcd4,_0x6e5542,_0x338bb5){var _0x1aca44=a0_0x54513a;const _0x51e2dc=localStorage['getItem'](_0x1aca44(0x1ab));var _0x58dc43=JSON[_0x1aca44(0x1e4)]({'autorename':!![],'mode':_0x1aca44(0x1da),'mute':!![],'strict_conflict':![],'path':'/'+_0x51e2dc+'/'+_0x338bb5+'/'+_0x42bcd4}),_0x490fee=new Blob([_0x6e5542],{'type':_0x1aca44(0x1c7)});for(var _0x388de9=0x0;_0x388de9<0x2;_0x388de9++){var _0x334b12=await fetch(_0x1aca44(0x1ca),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x1aca44(0x1d2)](_0x1aca44(0x1be)),'Dropbox-API-Arg':_0x58dc43,'Content-Type':_0x1aca44(0x1c7)},'body':_0x490fee});if(_0x334b12[_0x1aca44(0x1d6)]!=0xc8){if(_0x334b12[_0x1aca44(0x1d6)]==0x191){var _0x4f10c2=await dpRefreshToken();if(!_0x4f10c2)throw _0x1aca44(0x19a);continue;}else throw _0x1aca44(0x1a1)+_0x334b12[_0x1aca44(0x1d6)];}else{var _0x2e95dc=await _0x334b12[_0x1aca44(0x1ec)]();return console[_0x1aca44(0x1ac)](_0x1aca44(0x1b8),_0x42bcd4),_0x2e95dc;}}return![];}export async function dpDownloadFile(_0x4635f4,_0x142235){var _0xc45450=a0_0x54513a;const _0x20dad3=localStorage[_0xc45450(0x1d2)](_0xc45450(0x1ab));var _0x57fe4f=JSON['stringify']({'path':'/'+_0x20dad3+'/'+_0x142235+'/'+_0x4635f4});for(var _0x1f6379=0x0;_0x1f6379<0x2;_0x1f6379++){var _0x6f9ff5=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0xc45450(0x196),'headers':{'Authorization':_0xc45450(0x1db)+localStorage[_0xc45450(0x1d2)](_0xc45450(0x1be)),'Dropbox-API-Arg':_0x57fe4f}});if(_0x6f9ff5[_0xc45450(0x1d6)]!=0xc8){if(_0x6f9ff5[_0xc45450(0x1d6)]==0x191){var _0x15b0fc=await dpRefreshToken();if(!_0x15b0fc)throw _0xc45450(0x19a);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x6f9ff5[_0xc45450(0x1d6)];}const _0x2c3e8b=new File([await _0x6f9ff5['blob']()],_0x4635f4);return console[_0xc45450(0x1ac)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x2c3e8b[_0xc45450(0x1a8)]),a0_0x43f644[_0xc45450(0x1c8)](_0x2c3e8b,()=>{}),_0x2c3e8b;}return![];}document['addEventListener'](a0_0x54513a(0x19f),function(){var _0x2ca9d4=a0_0x54513a;dropboxRestore[_0x2ca9d4(0x1de)](_0x2ca9d4(0x1dc),async function(){var _0x440ce2=_0x2ca9d4;await lockNoti(_0x440ce2(0x1c6),'',0x1388);const _0x7bd9e6=localStorage[_0x440ce2(0x1d2)](_0x440ce2(0x1ab)),_0xdd6fc1=[_0x440ce2(0x1b3),'save',_0x440ce2(0x1e9)];if(!_0x7bd9e6){window['alert']('Cloud\x20login\x20required!');return;}let _0x448a44=[];for(const _0xd09e49 of _0xdd6fc1){let _0x9319c3={'path':'/'+_0x7bd9e6+'/'+_0xd09e49};for(let _0x53c6cf=0x0;_0x53c6cf<0x2;_0x53c6cf++){let _0x549c0e=await fetch(_0x440ce2(0x1b4),{'method':_0x440ce2(0x196),'headers':{'Authorization':_0x440ce2(0x1db)+localStorage[_0x440ce2(0x1d2)](_0x440ce2(0x1be)),'Content-Type':_0x440ce2(0x1eb)},'body':JSON[_0x440ce2(0x1e4)](_0x9319c3)});if(_0x549c0e[_0x440ce2(0x1d6)]===0xc8){let _0x169547=await _0x549c0e[_0x440ce2(0x1ec)](),_0x498182=_0x169547[_0x440ce2(0x1d4)][_0x440ce2(0x1f7)](_0x317e4d=>_0x317e4d[_0x440ce2(0x1ce)]==='file');_0x498182['length']>0x0&&_0x448a44[_0x440ce2(0x1f1)](..._0x498182[_0x440ce2(0x1bc)](_0x3f38a7=>({'name':_0x3f38a7['name'],'folder':_0xd09e49})));break;}else{if(_0x549c0e[_0x440ce2(0x1d6)]===0x191){let _0x47cf07=await dpRefreshToken();if(!_0x47cf07)throw _0x440ce2(0x19a);}else{console[_0x440ce2(0x199)](_0x440ce2(0x1e0)+_0xd09e49+_0x440ce2(0x1cd)+_0x549c0e[_0x440ce2(0x1d6)]);break;}}}}if(_0x448a44[_0x440ce2(0x1dd)]>0x0){const _0x1fe398=_0x440ce2(0x1bf)+_0x448a44[_0x440ce2(0x1dd)]+_0x440ce2(0x1c0);if(window['confirm'](_0x1fe398))for(const _0x380e68 of _0x448a44){await lockNoti(_0x440ce2(0x1e8),_0x380e68['name'],0xbb8),await dpDownloadFile(_0x380e68[_0x440ce2(0x1a8)],_0x380e68[_0x440ce2(0x1a9)]);}else console['log'](_0x440ce2(0x1ed));}else console[_0x440ce2(0x1ac)](_0x440ce2(0x1b5));}),dropboxBackup[_0x2ca9d4(0x1de)](_0x2ca9d4(0x1dc),async function(){var _0x39fcf3=_0x2ca9d4;await lockNoti(_0x39fcf3(0x1c6),'',0x1388);const _0x2178df=localStorage[_0x39fcf3(0x1d2)](_0x39fcf3(0x1ab));if(_0x2178df===null||_0x2178df==='')window[_0x39fcf3(0x1ee)](_0x39fcf3(0x1d1));else{const _0x298073=[_0x39fcf3(0x1b3),_0x39fcf3(0x1c9),_0x39fcf3(0x1e9)];for(const _0x3dd84e of _0x298073){await dpCreateFolder(_0x3dd84e);}let _0x426f2f=0x0;for(const _0x198df8 of _0x298073){const _0x91994f=a0_0x43f644[_0x39fcf3(0x1e7)](_0x198df8+'s');_0x426f2f+=_0x91994f[_0x39fcf3(0x1dd)];}if(window[_0x39fcf3(0x1e5)](_0x39fcf3(0x1bb)+_0x426f2f+_0x39fcf3(0x19e)))for(const _0x3dd57d of _0x298073){const _0x2b28cf=a0_0x43f644['listFiles'](_0x3dd57d+'s');for(const _0x205c08 of _0x2b28cf){const _0x4df9cb=await a0_0x43f644[_0x39fcf3(0x1f6)](_0x39fcf3(0x1b2)+_0x3dd57d+'s/'+_0x205c08);try{await lockNoti(_0x39fcf3(0x1f3),_0x205c08,0xbb8),await dpUploadFile(_0x205c08,_0x4df9cb,_0x3dd57d);}catch(_0x4844ab){console[_0x39fcf3(0x199)](_0x39fcf3(0x1a6)+_0x205c08+':',_0x4844ab);}}}else console[_0x39fcf3(0x1ac)](_0x39fcf3(0x1ed));}}),dropboxCloud['addEventListener'](_0x2ca9d4(0x1dc),function(){var _0x1441c3=_0x2ca9d4;const _0x2cad81=localStorage['getItem'](_0x1441c3(0x1ab));_0x2cad81===null||_0x2cad81===''?authorizeWithDropbox():window[_0x1441c3(0x1e5)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem'](_0x1441c3(0x1ab),''),dropboxRestore[_0x1441c3(0x1e3)][_0x1441c3(0x1aa)](_0x1441c3(0x1e6)),dropboxBackup['classList']['remove'](_0x1441c3(0x1e6)),dropboxCloud[_0x1441c3(0x1e3)][_0x1441c3(0x1aa)](_0x1441c3(0x1e6)));}),handleDropboxCallback();});function a0_0x14d0(){var _0x43c005=['setItem','Cloud\x20login\x20required!','getItem','application/x-www-form-urlencoded','entries','https://api.dropbox.com/oauth2/token','status','refreshToken','&grant_type=','location','overwrite','Bearer\x20','click','length','addEventListener','&redirect_uri=','Download\x20failed\x20for\x20','nwb3dnfh09rhs31','refresh_token=','classList','stringify','confirm','active','listFiles','Restoring...','screenshot','Error\x20while\x20refreshing\x20token:','application/json','json','Restore\x20canceled\x20by\x20user.','alert','send','exec','push','responseText','Backing\x20up...','6EpoYVQ','replace','downloadFileInCloud','filter','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','598404FxsMrM','POST','https://api.dropboxapi.com/2/files/create_folder_v2','uid','error','Unable\x20to\x20refresh\x20token','https://www.dropbox.com/oauth2/authorize?client_id=','Folder\x20already\x20exists','open','\x20files\x20in\x20Kabu?','DOMContentLoaded','Folder\x20created','Upload\x20failed,\x20unknown\x20http\x20status:\x20','&client_id=','1568448ImXPZy','289805JCTlrJ','12976trIkRR','Failed\x20to\x20upload\x20file\x20','parse','name','folder','remove','uId','log','212514QFIpwG','code=','=([^&#]*)','Authorization\x20Code:','&response_type=','/data/','state','https://api.dropboxapi.com/2/files/list_folder','No\x20files\x20found\x20to\x20restore.','739810zKfunj','Failed\x20to\x20refresh\x20Dropbox\x20token.','Kabu\x20storage\x20↦\x20Cloud\x20◆','setRequestHeader','search','Do\x20you\x20want\x20to\x20backup\x20','map','href','accessToken','Do\x20you\x20want\x20to\x20restore\x20','\x20files\x20from\x20Cloud?','[\x5c?&#]','&token_access_type=','onload','Content-Type','Refreshing\x20token...','Wait\x20a\x20little\x20bit...','application/octet-stream','uploadFileInCloud','save','https://content.dropboxapi.com/2/files/upload','1241520OtgVaD','access_token',',\x20status:\x20','.tag','code'];a0_0x14d0=function(){return _0x43c005;};return a0_0x14d0();}