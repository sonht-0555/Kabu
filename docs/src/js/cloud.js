var a0_0x4aaba2=a0_0x5bc1;(function(_0x91aaf7,_0x459ea2){var _0x507cec=a0_0x5bc1,_0x1cdf70=_0x91aaf7();while(!![]){try{var _0x14b50a=-parseInt(_0x507cec(0x1a3))/0x1*(parseInt(_0x507cec(0x17a))/0x2)+parseInt(_0x507cec(0x1a1))/0x3+parseInt(_0x507cec(0x149))/0x4+-parseInt(_0x507cec(0x189))/0x5+parseInt(_0x507cec(0x1a8))/0x6+-parseInt(_0x507cec(0x170))/0x7+-parseInt(_0x507cec(0x1a7))/0x8*(-parseInt(_0x507cec(0x168))/0x9);if(_0x14b50a===_0x459ea2)break;else _0x1cdf70['push'](_0x1cdf70['shift']());}catch(_0x284495){_0x1cdf70['push'](_0x1cdf70['shift']());}}}(a0_0x3c42,0x350ff));import*as a0_0x66f2f2 from'./main.js';function a0_0x3c42(){var _0x482a35=['addEventListener','error','https://api.dropboxapi.com/oauth2/token','387FXWVIQ','location','Folder\x20already\x20exists','POST','status','json','knh3uz2mx2hp2eu','https://content.dropboxapi.com/2/files/upload','2878869rIjjZu','Kabu\x20storage\x20↦\x20Cloud\x20◆','alert','list','stringify','=([^&#]*)','getItem','DOMContentLoaded','confirm','Cloud\x20login\x20required!','176282BwzdKH','code','entries','Error\x20while\x20refreshing\x20token:','click','FSSync','file','charAt','remove','&token_access_type=','\x20files\x20from\x20Cloud?','Do\x20you\x20want\x20to\x20logout?','screenshot','Do\x20you\x20want\x20to\x20restore\x20','https://www.dropbox.com/oauth2/authorize?client_id=','1676920cFWXcj','length',',\x20status:\x20','refresh_token=','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','.tag','onload','setRequestHeader','toUpperCase','filter','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','accessToken','https://api.dropboxapi.com/2/files/create_folder_v2','&response_type=','Do\x20not\x20receive\x20authorization','&client_secret=','href','overwrite','state','downloadFileInCloud','error_description','replace','Wait\x20a\x20little\x20bit...','application/x-www-form-urlencoded','902244zSbrrL','Error\x20creating\x20folder\x20','3mGveQO','[\x5c?&#]','Do\x20you\x20want\x20to\x20backup\x20','refreshToken','125456vYKyXn','55644PSJxqZ','slice','log','&redirect_uri=','setItem','976276SGmYLn','Bearer\x20','application/octet-stream','offline','/data/','Restore\x20canceled\x20by\x20user.','active','Authorization\x20Code:','access_token','Download\x20failed\x20for\x20','search','Unable\x20to\x20refresh\x20token','uid','No\x20files\x20found\x20to\x20restore.','send','&grant_type=','name','Folder\x20created','authorization_code','folder','blob','classList','save','&client_id=','No\x20refresh\x20token','application/json','uId','https://api.dropbox.com/oauth2/token'];a0_0x3c42=function(){return _0x482a35;};return a0_0x3c42();}import{localStorageFile}from'./storage.js';var clientId=a0_0x4aaba2(0x16e),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x351dbb=a0_0x4aaba2,_0x46dcf6=window[_0x351dbb(0x169)]['href']['split']('?')[0x0],_0x24e49b=_0x351dbb(0x17b),_0x1103d9=_0x351dbb(0x14c),_0x84a7cf=_0x351dbb(0x188)+clientId+_0x351dbb(0x196)+_0x24e49b+_0x351dbb(0x183)+_0x1103d9+_0x351dbb(0x147)+encodeURIComponent(_0x46dcf6);window[_0x351dbb(0x169)][_0x351dbb(0x199)]=_0x84a7cf;}function handleDropboxCallback(){var _0x453019=a0_0x4aaba2,_0x2922ae=getUrlParameter(_0x453019(0x17b));_0x2922ae?(getAccessToken(_0x2922ae),console[_0x453019(0x146)](_0x453019(0x150),_0x2922ae)):console['log'](_0x453019(0x197));}function getUrlParameter(_0x4e1235){var _0xbd7c12=a0_0x4aaba2;_0x4e1235=_0x4e1235['replace'](/[\[]/,'\x5c[')[_0xbd7c12(0x19e)](/[\]]/,'\x5c]');var _0x3f20cf=new RegExp(_0xbd7c12(0x1a4)+_0x4e1235+_0xbd7c12(0x175)),_0x350e67=_0x3f20cf['exec'](location[_0xbd7c12(0x153)]);return _0x350e67===null?'':decodeURIComponent(_0x350e67[0x1][_0xbd7c12(0x19e)](/\+/g,'\x20'));}function a0_0x5bc1(_0x147172,_0xbba5d5){var _0x3c42af=a0_0x3c42();return a0_0x5bc1=function(_0x5bc1bd,_0x49fc7c){_0x5bc1bd=_0x5bc1bd-0x146;var _0x3532c7=_0x3c42af[_0x5bc1bd];return _0x3532c7;},a0_0x5bc1(_0x147172,_0xbba5d5);}function getAccessToken(_0x9607f6){var _0x10c164=a0_0x4aaba2,_0x479324=_0x10c164(0x15b),_0x5f3924=window[_0x10c164(0x169)][_0x10c164(0x199)]['split']('?')[0x0],_0x592c02=new XMLHttpRequest();_0x592c02['open'](_0x10c164(0x16b),_0x10c164(0x164)),_0x592c02[_0x10c164(0x190)]('Content-Type',_0x10c164(0x1a0)),_0x592c02[_0x10c164(0x18f)]=function(){var _0x5ba927=_0x10c164;if(_0x592c02[_0x5ba927(0x16c)]===0xc8){var _0x56becd=JSON['parse'](_0x592c02['responseText']),_0x4c25b1=_0x56becd['access_token'],_0x46dd06=_0x56becd['refresh_token'],_0x4d35b7=_0x56becd[_0x5ba927(0x155)];localStorage[_0x5ba927(0x148)](_0x5ba927(0x194),_0x4c25b1),localStorage[_0x5ba927(0x148)](_0x5ba927(0x1a6),_0x46dd06),localStorage[_0x5ba927(0x148)](_0x5ba927(0x163),_0x4d35b7);}else console[_0x5ba927(0x146)](_0x5ba927(0x193));},_0x592c02[_0x10c164(0x157)]('code='+_0x9607f6+_0x10c164(0x158)+_0x479324+_0x10c164(0x160)+clientId+_0x10c164(0x198)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x5f3924));}export async function dpCreateFolder(_0x400ae7){var _0x5caa25=a0_0x4aaba2;const _0x32a376=localStorage[_0x5caa25(0x176)](_0x5caa25(0x163));let _0x531ee6=localStorage[_0x5caa25(0x176)](_0x5caa25(0x194));const _0x4365e1='/'+_0x32a376+'/'+_0x400ae7,_0x5dab46=JSON[_0x5caa25(0x174)]({'path':_0x4365e1,'autorename':![]});for(let _0x2e2eea=0x0;_0x2e2eea<0x2;_0x2e2eea++){try{const _0x5cbfd4=await fetch(_0x5caa25(0x195),{'method':'POST','headers':{'Authorization':'Bearer\x20'+_0x531ee6,'Content-Type':'application/json'},'body':_0x5dab46});if(_0x5cbfd4[_0x5caa25(0x16c)]===0x191){const _0x47a448=await dpRefreshToken();if(!_0x47a448)throw new Error(_0x5caa25(0x154));_0x531ee6=localStorage[_0x5caa25(0x176)]('accessToken');continue;}if(_0x5cbfd4[_0x5caa25(0x16c)]===0x199)return{'message':_0x5caa25(0x16a),'path':_0x400ae7};if(!_0x5cbfd4['ok'])throw new Error(_0x5caa25(0x1a2)+_0x400ae7);const _0x597978=await _0x5cbfd4[_0x5caa25(0x16d)]();return await lockNoti(_0x5caa25(0x15a),'',0xbb8),_0x597978;}catch(_0x7ae4f0){if(_0x2e2eea===0x1)throw _0x7ae4f0;}}return![];}export async function dpRefreshToken(){var _0x2f5ef0=a0_0x4aaba2;if(!localStorage['getItem'](_0x2f5ef0(0x1a6)))throw _0x2f5ef0(0x161);try{const _0x515bff=await fetch(_0x2f5ef0(0x167),{'method':_0x2f5ef0(0x16b),'headers':{'Content-Type':_0x2f5ef0(0x1a0)},'body':_0x2f5ef0(0x18c)+localStorage[_0x2f5ef0(0x176)]('refreshToken')+_0x2f5ef0(0x18d)}),_0x362ddf=await _0x515bff[_0x2f5ef0(0x16d)]();if(!_0x362ddf[_0x2f5ef0(0x166)])return localStorage[_0x2f5ef0(0x148)]('accessToken',_0x362ddf[_0x2f5ef0(0x151)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x362ddf[_0x2f5ef0(0x19d)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x463480){console[_0x2f5ef0(0x166)](_0x2f5ef0(0x17d),_0x463480);}return![];}export async function dpUploadFile(_0x1a53e7,_0xdbeef6,_0x3eb2bc){var _0x46a3e0=a0_0x4aaba2;const _0x2cfa6c=localStorage[_0x46a3e0(0x176)](_0x46a3e0(0x163));var _0x26e6db=JSON[_0x46a3e0(0x174)]({'autorename':!![],'mode':_0x46a3e0(0x19a),'mute':!![],'strict_conflict':![],'path':'/'+_0x2cfa6c+'/'+_0x3eb2bc+'/'+_0x1a53e7}),_0x1f011e=new Blob([_0xdbeef6],{'type':'application/octet-stream'});for(var _0x19124b=0x0;_0x19124b<0x2;_0x19124b++){var _0x3b1242=await fetch(_0x46a3e0(0x16f),{'method':'POST','headers':{'Authorization':_0x46a3e0(0x14a)+localStorage[_0x46a3e0(0x176)](_0x46a3e0(0x194)),'Dropbox-API-Arg':_0x26e6db,'Content-Type':_0x46a3e0(0x14b)},'body':_0x1f011e});if(_0x3b1242[_0x46a3e0(0x16c)]!=0xc8){if(_0x3b1242[_0x46a3e0(0x16c)]==0x191){var _0x3c5d98=await dpRefreshToken();if(!_0x3c5d98)throw _0x46a3e0(0x154);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x3b1242['status'];}else{var _0x3e80de=await _0x3b1242[_0x46a3e0(0x16d)]();return console[_0x46a3e0(0x146)](_0x46a3e0(0x171),_0x1a53e7),_0x3e80de;}}return![];}export async function dpDownloadFile(_0x330fa2,_0x5371ab){var _0x5123da=a0_0x4aaba2;const _0x49fce1=localStorage[_0x5123da(0x176)](_0x5123da(0x163));var _0x15db45=JSON[_0x5123da(0x174)]({'path':'/'+_0x49fce1+'/'+_0x5371ab+'/'+_0x330fa2});for(var _0x319384=0x0;_0x319384<0x2;_0x319384++){var _0x43b38f=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x5123da(0x16b),'headers':{'Authorization':_0x5123da(0x14a)+localStorage[_0x5123da(0x176)](_0x5123da(0x194)),'Dropbox-API-Arg':_0x15db45}});if(_0x43b38f[_0x5123da(0x16c)]!=0xc8){if(_0x43b38f[_0x5123da(0x16c)]==0x191){var _0x1b1089=await dpRefreshToken();if(!_0x1b1089)throw _0x5123da(0x154);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x43b38f[_0x5123da(0x16c)];}const _0x199980=new File([await _0x43b38f[_0x5123da(0x15d)]()],_0x330fa2);return console[_0x5123da(0x146)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x199980['name']),a0_0x66f2f2['uploadFileInCloud'](_0x199980,()=>{var _0x3605c5=_0x5123da;localStorageFile(),Module[_0x3605c5(0x17f)]();}),_0x199980;}return![];}document['addEventListener'](a0_0x4aaba2(0x177),function(){var _0xa4e028=a0_0x4aaba2;dropboxRestore[_0xa4e028(0x165)](_0xa4e028(0x17e),async function(){var _0x1fa561=_0xa4e028;await lockNoti(_0x1fa561(0x19f),'',0x1388);const _0x444b7c=localStorage[_0x1fa561(0x176)](_0x1fa561(0x163)),_0x1017dd=['state',_0x1fa561(0x15f),_0x1fa561(0x186)];if(!_0x444b7c){window[_0x1fa561(0x172)](_0x1fa561(0x179));return;}let _0x5da855=[];for(const _0x4c71db of _0x1017dd){let _0x53be8e={'path':'/'+_0x444b7c+'/'+_0x4c71db};for(let _0x4fcd6d=0x0;_0x4fcd6d<0x2;_0x4fcd6d++){let _0x7d5beb=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x1fa561(0x16b),'headers':{'Authorization':_0x1fa561(0x14a)+localStorage[_0x1fa561(0x176)](_0x1fa561(0x194)),'Content-Type':_0x1fa561(0x162)},'body':JSON[_0x1fa561(0x174)](_0x53be8e)});if(_0x7d5beb[_0x1fa561(0x16c)]===0xc8){let _0x17a4e5=await _0x7d5beb[_0x1fa561(0x16d)](),_0x284f42=_0x17a4e5[_0x1fa561(0x17c)][_0x1fa561(0x192)](_0x5d0590=>_0x5d0590[_0x1fa561(0x18e)]===_0x1fa561(0x180));_0x284f42[_0x1fa561(0x18a)]>0x0&&_0x5da855['push'](..._0x284f42['map'](_0x102290=>({'name':_0x102290['name'],'folder':_0x4c71db})));break;}else{if(_0x7d5beb[_0x1fa561(0x16c)]===0x191){let _0x2eb512=await dpRefreshToken();if(!_0x2eb512)throw _0x1fa561(0x154);}else{console['error'](_0x1fa561(0x152)+_0x4c71db+_0x1fa561(0x18b)+_0x7d5beb[_0x1fa561(0x16c)]);break;}}}}if(_0x5da855[_0x1fa561(0x18a)]>0x0){const _0x35febd=_0x1fa561(0x187)+_0x5da855[_0x1fa561(0x18a)]+_0x1fa561(0x184);if(window[_0x1fa561(0x178)](_0x35febd))for(const _0x1c2804 of _0x5da855){await lockNoti('Restoring...',_0x1c2804[_0x1fa561(0x159)],0xbb8),await dpDownloadFile(_0x1c2804[_0x1fa561(0x159)],_0x1c2804[_0x1fa561(0x15c)]);}else console[_0x1fa561(0x146)](_0x1fa561(0x14e));}else console['log'](_0x1fa561(0x156));}),dropboxBackup[_0xa4e028(0x165)](_0xa4e028(0x17e),async function(){var _0x2c901d=_0xa4e028;await lockNoti(_0x2c901d(0x19f),'',0x1388);const _0xfea619=localStorage[_0x2c901d(0x176)]('uId');if(_0xfea619===null||_0xfea619==='')window['alert'](_0x2c901d(0x179));else{const _0x53face=[_0x2c901d(0x19b),_0x2c901d(0x15f),_0x2c901d(0x186)];for(const _0x27aa82 of _0x53face){await dpCreateFolder(_0x27aa82);}let _0x3a7db0=0x0;for(const _0x380972 of _0x53face){const _0x4a2b30=a0_0x66f2f2[_0x2c901d(0x173)+(_0x380972[_0x2c901d(0x181)](0x0)[_0x2c901d(0x191)]()+_0x380972[_0x2c901d(0x1a9)](0x1))]();_0x3a7db0+=_0x4a2b30['length'];}if(window[_0x2c901d(0x178)](_0x2c901d(0x1a5)+_0x3a7db0+'\x20files\x20in\x20Kabu?'))for(const _0x5a0a50 of _0x53face){const _0x507e01=a0_0x66f2f2[_0x2c901d(0x173)+(_0x5a0a50['charAt'](0x0)[_0x2c901d(0x191)]()+_0x5a0a50['slice'](0x1))]();for(const _0x13d254 of _0x507e01){const _0x5ccca9=await a0_0x66f2f2[_0x2c901d(0x19c)](_0x2c901d(0x14d)+_0x5a0a50+'s/'+_0x13d254);try{await lockNoti('Backing\x20up...',_0x13d254,0xbb8),await dpUploadFile(_0x13d254,_0x5ccca9,_0x5a0a50);}catch(_0x4b13c4){console[_0x2c901d(0x166)]('Failed\x20to\x20upload\x20file\x20'+_0x13d254+':',_0x4b13c4);}}}else console[_0x2c901d(0x146)](_0x2c901d(0x14e));}}),dropboxCloud[_0xa4e028(0x165)](_0xa4e028(0x17e),function(){var _0x150f9=_0xa4e028;const _0x327551=localStorage[_0x150f9(0x176)](_0x150f9(0x163));_0x327551===null||_0x327551===''?authorizeWithDropbox():window[_0x150f9(0x178)](_0x150f9(0x185))&&(localStorage[_0x150f9(0x148)](_0x150f9(0x163),''),dropboxRestore['classList'][_0x150f9(0x182)](_0x150f9(0x14f)),dropboxBackup[_0x150f9(0x15e)]['remove'](_0x150f9(0x14f)),dropboxCloud[_0x150f9(0x15e)][_0x150f9(0x182)](_0x150f9(0x14f)));}),handleDropboxCallback();});