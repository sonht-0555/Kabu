var a0_0x158aa7=a0_0x45b6;(function(_0x594322,_0x2aef35){var _0x5a8b76=a0_0x45b6,_0x8d854a=_0x594322();while(!![]){try{var _0x3f6db8=parseInt(_0x5a8b76(0x1ef))/0x1*(parseInt(_0x5a8b76(0x1e9))/0x2)+parseInt(_0x5a8b76(0x201))/0x3+parseInt(_0x5a8b76(0x1ed))/0x4*(parseInt(_0x5a8b76(0x1dc))/0x5)+-parseInt(_0x5a8b76(0x20a))/0x6+-parseInt(_0x5a8b76(0x1f8))/0x7+-parseInt(_0x5a8b76(0x1d2))/0x8+parseInt(_0x5a8b76(0x1d0))/0x9;if(_0x3f6db8===_0x2aef35)break;else _0x8d854a['push'](_0x8d854a['shift']());}catch(_0x26787d){_0x8d854a['push'](_0x8d854a['shift']());}}}(a0_0x22bd,0xe2e50));function a0_0x22bd(){var _0x353298=['send','3662955NvYhYK','active','listFiles','code','&client_secret=','https://api.dropboxapi.com/2/files/create_folder_v2','Authorization\x20Code:','href','overwrite','3558750aGTBfV','blob','Download\x20failed\x20for\x20','replace','remove','length','getItem','entries','Do\x20you\x20want\x20to\x20backup\x20','state','Bearer\x20','status','json','split','https://content.dropboxapi.com/2/files/upload','Wait\x20a\x20little\x20bit...','Do\x20not\x20receive\x20authorization','file','click','filter','Do\x20you\x20want\x20to\x20restore\x20','Refreshing\x20token...','&client_id=','Backing\x20up...','error','Error\x20creating\x20folder\x20','No\x20refresh\x20token','Unable\x20to\x20refresh\x20token','application/octet-stream','name','\x20files\x20in\x20Kabu?','uid','addEventListener','Error\x20while\x20refreshing\x20token:','error_description','code=','confirm','accessToken','classList','search','9485010PgyqbG','stringify','6710192MTbyzs','Restoring...','&response_type=','https://api.dropboxapi.com/2/files/list_folder','Restore\x20canceled\x20by\x20user.','offline','&grant_type=','Cloud\x20login\x20required!','map','\x20files\x20from\x20Cloud?','35nbBdpn','log','https://content.dropboxapi.com/2/files/download','https://api.dropbox.com/oauth2/token','access_token','location','/data/','Do\x20you\x20want\x20to\x20logout?','knh3uz2mx2hp2eu','screenshot','responseText','authorization_code','No\x20files\x20found\x20to\x20restore.','92bvjFkW','POST','application/json','open','91696NiGVoe','&redirect_uri=','28703qnmygm','Folder\x20created','uploadFileInCloud','onload','.tag','DOMContentLoaded','&token_access_type=','uId','=([^&#]*)','9760954tpkQwH','save','setItem','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Download\x20failed,\x20unknown\x20http\x20status:','application/x-www-form-urlencoded','refreshToken','refresh_token'];a0_0x22bd=function(){return _0x353298;};return a0_0x22bd();}import*as a0_0x1e7e71 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x158aa7(0x1e4),clientSecret='nwb3dnfh09rhs31';function a0_0x45b6(_0xa70d3,_0x1b2396){var _0x22bde6=a0_0x22bd();return a0_0x45b6=function(_0x45b6f5,_0x47b2f1){_0x45b6f5=_0x45b6f5-0x1aa;var _0x3a1d4a=_0x22bde6[_0x45b6f5];return _0x3a1d4a;},a0_0x45b6(_0xa70d3,_0x1b2396);}function authorizeWithDropbox(){var _0x5eb650=a0_0x158aa7,_0x4cd22e=window[_0x5eb650(0x1e1)][_0x5eb650(0x208)][_0x5eb650(0x1b5)]('?')[0x0],_0x215633='code',_0x552d9e=_0x5eb650(0x1d7),_0x46b6f1='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x5eb650(0x1d4)+_0x215633+_0x5eb650(0x1f5)+_0x552d9e+_0x5eb650(0x1ee)+encodeURIComponent(_0x4cd22e);window[_0x5eb650(0x1e1)]['href']=_0x46b6f1;}function handleDropboxCallback(){var _0x3ac872=a0_0x158aa7,_0xee3ec7=getUrlParameter(_0x3ac872(0x204));_0xee3ec7?(getAccessToken(_0xee3ec7),console[_0x3ac872(0x1dd)](_0x3ac872(0x207),_0xee3ec7)):console[_0x3ac872(0x1dd)](_0x3ac872(0x1b8));}function getUrlParameter(_0x5cccf5){var _0x49515f=a0_0x158aa7;_0x5cccf5=_0x5cccf5[_0x49515f(0x1ab)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x5159e8=new RegExp('[\x5c?&#]'+_0x5cccf5+_0x49515f(0x1f7)),_0x5b009f=_0x5159e8['exec'](location[_0x49515f(0x1cf)]);return _0x5b009f===null?'':decodeURIComponent(_0x5b009f[0x1][_0x49515f(0x1ab)](/\+/g,'\x20'));}function getAccessToken(_0x1a622e){var _0x1d9077=a0_0x158aa7,_0x397e15=_0x1d9077(0x1e7),_0x503df9=window[_0x1d9077(0x1e1)]['href'][_0x1d9077(0x1b5)]('?')[0x0],_0x70da4c=new XMLHttpRequest();_0x70da4c[_0x1d9077(0x1ec)](_0x1d9077(0x1ea),_0x1d9077(0x1df)),_0x70da4c['setRequestHeader']('Content-Type',_0x1d9077(0x1fd)),_0x70da4c[_0x1d9077(0x1f2)]=function(){var _0x4d99f8=_0x1d9077;if(_0x70da4c[_0x4d99f8(0x1b3)]===0xc8){var _0x3d5f26=JSON['parse'](_0x70da4c[_0x4d99f8(0x1e6)]),_0x1db1db=_0x3d5f26[_0x4d99f8(0x1e0)],_0x4f7f98=_0x3d5f26[_0x4d99f8(0x1ff)],_0x59e43c=_0x3d5f26[_0x4d99f8(0x1c7)];localStorage[_0x4d99f8(0x1fa)](_0x4d99f8(0x1cd),_0x1db1db),localStorage['setItem']('refreshToken',_0x4f7f98),localStorage['setItem']('uId',_0x59e43c);}else console[_0x4d99f8(0x1dd)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x70da4c[_0x1d9077(0x200)](_0x1d9077(0x1cb)+_0x1a622e+_0x1d9077(0x1d8)+_0x397e15+_0x1d9077(0x1be)+clientId+_0x1d9077(0x205)+clientSecret+_0x1d9077(0x1ee)+encodeURIComponent(_0x503df9));}export async function dpCreateFolder(_0xba1480){var _0x2fabd5=a0_0x158aa7;const _0x276797=localStorage[_0x2fabd5(0x1ae)](_0x2fabd5(0x1f6));let _0x424a74=localStorage[_0x2fabd5(0x1ae)](_0x2fabd5(0x1cd));const _0x3f4865='/'+_0x276797+'/'+_0xba1480,_0xb43c56=JSON[_0x2fabd5(0x1d1)]({'path':_0x3f4865,'autorename':![]});for(let _0x294fcb=0x0;_0x294fcb<0x2;_0x294fcb++){try{const _0x33372=await fetch(_0x2fabd5(0x206),{'method':_0x2fabd5(0x1ea),'headers':{'Authorization':'Bearer\x20'+_0x424a74,'Content-Type':_0x2fabd5(0x1eb)},'body':_0xb43c56});if(_0x33372[_0x2fabd5(0x1b3)]===0x191){const _0x123bc7=await dpRefreshToken();if(!_0x123bc7)throw new Error(_0x2fabd5(0x1c3));_0x424a74=localStorage[_0x2fabd5(0x1ae)](_0x2fabd5(0x1cd));continue;}if(_0x33372[_0x2fabd5(0x1b3)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0xba1480};if(!_0x33372['ok'])throw new Error(_0x2fabd5(0x1c1)+_0xba1480);const _0x3a8af3=await _0x33372['json']();return await lockNoti(_0x2fabd5(0x1f0),'',0xbb8),_0x3a8af3;}catch(_0x78ba9b){if(_0x294fcb===0x1)throw _0x78ba9b;}}return![];}export async function dpRefreshToken(){var _0x26b1c0=a0_0x158aa7;if(!localStorage[_0x26b1c0(0x1ae)](_0x26b1c0(0x1fe)))throw _0x26b1c0(0x1c2);try{const _0x1b455d=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x26b1c0(0x1ea),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x26b1c0(0x1ae)](_0x26b1c0(0x1fe))+_0x26b1c0(0x1fb)}),_0x14f8c5=await _0x1b455d[_0x26b1c0(0x1b4)]();if(!_0x14f8c5[_0x26b1c0(0x1c0)])return localStorage[_0x26b1c0(0x1fa)](_0x26b1c0(0x1cd),_0x14f8c5['access_token']),await lockNoti(_0x26b1c0(0x1bd),'',0xbb8),await delay(0x3e8),!![];else alert(_0x14f8c5[_0x26b1c0(0x1ca)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x56c01c){console['error'](_0x26b1c0(0x1c9),_0x56c01c);}return![];}export async function dpUploadFile(_0x2e610c,_0x2024a0,_0x4e2e7b){var _0x21bc80=a0_0x158aa7;const _0x2efb5a=localStorage['getItem'](_0x21bc80(0x1f6));var _0x397300=JSON[_0x21bc80(0x1d1)]({'autorename':!![],'mode':_0x21bc80(0x209),'mute':!![],'strict_conflict':![],'path':'/'+_0x2efb5a+'/'+_0x4e2e7b+'/'+_0x2e610c}),_0x22cd05=new Blob([_0x2024a0],{'type':_0x21bc80(0x1c4)});for(var _0x4e4c73=0x0;_0x4e4c73<0x2;_0x4e4c73++){var _0x1cce9b=await fetch(_0x21bc80(0x1b6),{'method':_0x21bc80(0x1ea),'headers':{'Authorization':_0x21bc80(0x1b2)+localStorage[_0x21bc80(0x1ae)](_0x21bc80(0x1cd)),'Dropbox-API-Arg':_0x397300,'Content-Type':'application/octet-stream'},'body':_0x22cd05});if(_0x1cce9b[_0x21bc80(0x1b3)]!=0xc8){if(_0x1cce9b[_0x21bc80(0x1b3)]==0x191){var _0x33116a=await dpRefreshToken();if(!_0x33116a)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x1cce9b['status'];}else{var _0x191fe6=await _0x1cce9b[_0x21bc80(0x1b4)]();return console[_0x21bc80(0x1dd)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x2e610c),_0x191fe6;}}return![];}export async function dpDownloadFile(_0x4736db,_0x4666b6){var _0x4f6b05=a0_0x158aa7;const _0x1953be=localStorage['getItem'](_0x4f6b05(0x1f6));var _0x2a2e9e=JSON[_0x4f6b05(0x1d1)]({'path':'/'+_0x1953be+'/'+_0x4666b6+'/'+_0x4736db});for(var _0x7468af=0x0;_0x7468af<0x2;_0x7468af++){var _0x2fe5b1=await fetch(_0x4f6b05(0x1de),{'method':'POST','headers':{'Authorization':_0x4f6b05(0x1b2)+localStorage[_0x4f6b05(0x1ae)](_0x4f6b05(0x1cd)),'Dropbox-API-Arg':_0x2a2e9e}});if(_0x2fe5b1[_0x4f6b05(0x1b3)]!=0xc8){if(_0x2fe5b1['status']==0x191){var _0x6a1851=await dpRefreshToken();if(!_0x6a1851)throw _0x4f6b05(0x1c3);continue;}else throw _0x4f6b05(0x1fc)+_0x2fe5b1[_0x4f6b05(0x1b3)];}const _0x580bae=new File([await _0x2fe5b1[_0x4f6b05(0x20b)]()],_0x4736db);return console[_0x4f6b05(0x1dd)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x580bae[_0x4f6b05(0x1c5)]),a0_0x1e7e71[_0x4f6b05(0x1f1)](_0x580bae,()=>{}),_0x580bae;}return![];}document[a0_0x158aa7(0x1c8)](a0_0x158aa7(0x1f4),function(){var _0x10df31=a0_0x158aa7;dropboxRestore['addEventListener']('click',async function(){var _0x1cb653=a0_0x45b6;await lockNoti(_0x1cb653(0x1b7),'',0x1388);const _0x5b8e53=localStorage['getItem'](_0x1cb653(0x1f6)),_0x19adb7=['state',_0x1cb653(0x1f9),'screenshot'];if(!_0x5b8e53){window['alert'](_0x1cb653(0x1d9));return;}let _0x16416c=[];for(const _0x55cb47 of _0x19adb7){let _0x21fa8e={'path':'/'+_0x5b8e53+'/'+_0x55cb47};for(let _0xf97a29=0x0;_0xf97a29<0x2;_0xf97a29++){let _0x6168f7=await fetch(_0x1cb653(0x1d5),{'method':_0x1cb653(0x1ea),'headers':{'Authorization':_0x1cb653(0x1b2)+localStorage[_0x1cb653(0x1ae)]('accessToken'),'Content-Type':'application/json'},'body':JSON[_0x1cb653(0x1d1)](_0x21fa8e)});if(_0x6168f7['status']===0xc8){let _0x4eebac=await _0x6168f7[_0x1cb653(0x1b4)](),_0x5f0891=_0x4eebac[_0x1cb653(0x1af)][_0x1cb653(0x1bb)](_0x5a331e=>_0x5a331e[_0x1cb653(0x1f3)]===_0x1cb653(0x1b9));_0x5f0891[_0x1cb653(0x1ad)]>0x0&&_0x16416c['push'](..._0x5f0891[_0x1cb653(0x1da)](_0x560517=>({'name':_0x560517[_0x1cb653(0x1c5)],'folder':_0x55cb47})));break;}else{if(_0x6168f7['status']===0x191){let _0x22f53e=await dpRefreshToken();if(!_0x22f53e)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x1cb653(0x1c0)](_0x1cb653(0x1aa)+_0x55cb47+',\x20status:\x20'+_0x6168f7[_0x1cb653(0x1b3)]);break;}}}}if(_0x16416c[_0x1cb653(0x1ad)]>0x0){const _0x45ffec=_0x1cb653(0x1bc)+_0x16416c[_0x1cb653(0x1ad)]+_0x1cb653(0x1db);if(window[_0x1cb653(0x1cc)](_0x45ffec))for(const _0x259c58 of _0x16416c){await lockNoti(_0x1cb653(0x1d3),_0x259c58[_0x1cb653(0x1c5)],0xbb8),await dpDownloadFile(_0x259c58[_0x1cb653(0x1c5)],_0x259c58['folder']);}else console['log'](_0x1cb653(0x1d6));}else console[_0x1cb653(0x1dd)](_0x1cb653(0x1e8));}),dropboxBackup['addEventListener'](_0x10df31(0x1ba),async function(){var _0x522352=_0x10df31;await lockNoti(_0x522352(0x1b7),'',0x1388);const _0x37efa2=localStorage['getItem'](_0x522352(0x1f6));if(_0x37efa2===null||_0x37efa2==='')window['alert'](_0x522352(0x1d9));else{const _0x1b00ba=[_0x522352(0x1b1),'save',_0x522352(0x1e5)];for(const _0x585d0e of _0x1b00ba){await dpCreateFolder(_0x585d0e);}let _0x34e5d6=0x0;for(const _0x3cddd8 of _0x1b00ba){const _0x41c6b3=a0_0x1e7e71[_0x522352(0x203)](_0x3cddd8+'s');_0x34e5d6+=_0x41c6b3[_0x522352(0x1ad)];}if(window[_0x522352(0x1cc)](_0x522352(0x1b0)+_0x34e5d6+_0x522352(0x1c6)))for(const _0x3a03b3 of _0x1b00ba){const _0xbe5ddc=a0_0x1e7e71[_0x522352(0x203)](_0x3a03b3+'s');for(const _0x3fa488 of _0xbe5ddc){const _0x603f9a=await a0_0x1e7e71['downloadFileInCloud'](_0x522352(0x1e2)+_0x3a03b3+'s/'+_0x3fa488);try{await lockNoti(_0x522352(0x1bf),_0x3fa488,0xbb8),await dpUploadFile(_0x3fa488,_0x603f9a,_0x3a03b3);}catch(_0x513549){console['error']('Failed\x20to\x20upload\x20file\x20'+_0x3fa488+':',_0x513549);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x10df31(0x1ba),function(){var _0x22a7a0=_0x10df31;const _0x4e757d=localStorage[_0x22a7a0(0x1ae)](_0x22a7a0(0x1f6));_0x4e757d===null||_0x4e757d===''?authorizeWithDropbox():window[_0x22a7a0(0x1cc)](_0x22a7a0(0x1e3))&&(localStorage['setItem'](_0x22a7a0(0x1f6),''),dropboxRestore[_0x22a7a0(0x1ce)][_0x22a7a0(0x1ac)](_0x22a7a0(0x202)),dropboxBackup[_0x22a7a0(0x1ce)][_0x22a7a0(0x1ac)](_0x22a7a0(0x202)),dropboxCloud[_0x22a7a0(0x1ce)]['remove'](_0x22a7a0(0x202)));}),handleDropboxCallback();});