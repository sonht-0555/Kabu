var a0_0x23a15d=a0_0x506e;(function(_0xf7258d,_0x3a524d){var _0x20f315=a0_0x506e,_0x3b8147=_0xf7258d();while(!![]){try{var _0x1ba065=parseInt(_0x20f315(0x183))/0x1*(-parseInt(_0x20f315(0x1cc))/0x2)+-parseInt(_0x20f315(0x1c9))/0x3*(-parseInt(_0x20f315(0x1d8))/0x4)+-parseInt(_0x20f315(0x1bf))/0x5*(parseInt(_0x20f315(0x1da))/0x6)+-parseInt(_0x20f315(0x1d7))/0x7+parseInt(_0x20f315(0x1c1))/0x8*(-parseInt(_0x20f315(0x1d9))/0x9)+-parseInt(_0x20f315(0x191))/0xa+parseInt(_0x20f315(0x1c6))/0xb*(parseInt(_0x20f315(0x17a))/0xc);if(_0x1ba065===_0x3a524d)break;else _0x3b8147['push'](_0x3b8147['shift']());}catch(_0x31cf59){_0x3b8147['push'](_0x3b8147['shift']());}}}(a0_0x4476,0x98672));import*as a0_0x4642fc from'./main.js';import{localStorageFile}from'./storage.js';function a0_0x4476(){var _0x5ddcef=['log','refresh_token','file','Restoring...','Restore\x20canceled\x20by\x20user.','Folder\x20already\x20exists','https://api.dropboxapi.com/oauth2/token','screenshot','&redirect_uri=','folder','\x20files\x20from\x20Cloud?','Authorization\x20Code:','map','Kabu\x20storage\x20↦\x20Cloud\x20◆','&client_id=','DOMContentLoaded','save','Error\x20while\x20refreshing\x20token:','Unable\x20to\x20refresh\x20token','refreshToken','POST','/data/','=([^&#]*)','active','alert','name','33805wiDcde','classList','9761992bQxZUj','setItem','code=','No\x20refresh\x20token','blob','25817UjAFJZ','uid','offline','3981eofhcQ','split','https://api.dropboxapi.com/2/files/list_folder','794738znmZHs','overwrite','application/octet-stream','Cloud\x20login\x20required!','json','https://content.dropboxapi.com/2/files/upload','nwb3dnfh09rhs31','https://www.dropbox.com/oauth2/authorize?client_id=','access_token','addEventListener','refresh_token=','193270wOanuW','1668btFhaN','9PuxgSI','930KHBLtW','responseText','onload','Do\x20you\x20want\x20to\x20backup\x20','location','https://api.dropboxapi.com/2/files/create_folder_v2','uId','authorization_code','\x20files\x20in\x20Kabu?','Backing\x20up...','24468VRRwIy','length','downloadFileInCloud','parse','entries','Wait\x20a\x20little\x20bit...','.tag','getItem','Refreshing\x20token...','3mLTQdg','status','state','code','&client_secret=','error','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Do\x20not\x20receive\x20authorization','Failed\x20to\x20upload\x20file\x20','accessToken','application/json','&response_type=','filter','confirm','12267290OoDoxB','href','remove','&grant_type=','Do\x20you\x20want\x20to\x20logout?','replace','Cloud\x20↦\x20Kabu\x20storage\x20◆','https://api.dropbox.com/oauth2/token','application/x-www-form-urlencoded','stringify','push','Upload\x20failed,\x20unknown\x20http\x20status:\x20','Failed\x20to\x20refresh\x20Dropbox\x20token.','click','https://content.dropboxapi.com/2/files/download','Bearer\x20','send','Download\x20failed,\x20unknown\x20http\x20status:','setRequestHeader','listFiles'];a0_0x4476=function(){return _0x5ddcef;};return a0_0x4476();}var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x23a15d(0x1d2);function authorizeWithDropbox(){var _0x7b7cc8=a0_0x23a15d,_0x1507a7=window[_0x7b7cc8(0x174)][_0x7b7cc8(0x192)]['split']('?')[0x0],_0x2a18d0=_0x7b7cc8(0x186),_0x4aaf85=_0x7b7cc8(0x1c8),_0x125768=_0x7b7cc8(0x1d3)+clientId+_0x7b7cc8(0x18e)+_0x2a18d0+'&token_access_type='+_0x4aaf85+'&redirect_uri='+encodeURIComponent(_0x1507a7);window[_0x7b7cc8(0x174)]['href']=_0x125768;}function handleDropboxCallback(){var _0x40b751=a0_0x23a15d,_0x171bdd=getUrlParameter('code');_0x171bdd?(getAccessToken(_0x171bdd),console['log'](_0x40b751(0x1b0),_0x171bdd)):console[_0x40b751(0x1a5)](_0x40b751(0x18a));}function getUrlParameter(_0x524cd5){var _0x7360b2=a0_0x23a15d;_0x524cd5=_0x524cd5[_0x7360b2(0x196)](/[\[]/,'\x5c[')[_0x7360b2(0x196)](/[\]]/,'\x5c]');var _0x45221b=new RegExp('[\x5c?&#]'+_0x524cd5+_0x7360b2(0x1bb)),_0x30536b=_0x45221b['exec'](location['search']);return _0x30536b===null?'':decodeURIComponent(_0x30536b[0x1][_0x7360b2(0x196)](/\+/g,'\x20'));}function getAccessToken(_0x615274){var _0x282f4e=a0_0x23a15d,_0x4d5b64=_0x282f4e(0x177),_0x188a33=window[_0x282f4e(0x174)]['href'][_0x282f4e(0x1ca)]('?')[0x0],_0x59f9dd=new XMLHttpRequest();_0x59f9dd['open']('POST',_0x282f4e(0x198)),_0x59f9dd[_0x282f4e(0x1a3)]('Content-Type',_0x282f4e(0x199)),_0x59f9dd[_0x282f4e(0x1dc)]=function(){var _0x28eeeb=_0x282f4e;if(_0x59f9dd[_0x28eeeb(0x184)]===0xc8){var _0x4cafd5=JSON[_0x28eeeb(0x17d)](_0x59f9dd[_0x28eeeb(0x1db)]),_0x564912=_0x4cafd5['access_token'],_0x22ea09=_0x4cafd5[_0x28eeeb(0x1a6)],_0x32de25=_0x4cafd5[_0x28eeeb(0x1c7)];localStorage[_0x28eeeb(0x1c2)](_0x28eeeb(0x18c),_0x564912),localStorage['setItem']('refreshToken',_0x22ea09),localStorage[_0x28eeeb(0x1c2)]('uId',_0x32de25);}else console[_0x28eeeb(0x1a5)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x59f9dd[_0x282f4e(0x1a1)](_0x282f4e(0x1c3)+_0x615274+_0x282f4e(0x194)+_0x4d5b64+_0x282f4e(0x1b3)+clientId+_0x282f4e(0x187)+clientSecret+_0x282f4e(0x1ad)+encodeURIComponent(_0x188a33));}export async function dpCreateFolder(_0x55f98b){var _0x1a28cf=a0_0x23a15d;const _0x31bf29=localStorage[_0x1a28cf(0x181)](_0x1a28cf(0x176));let _0x1e1ecd=localStorage[_0x1a28cf(0x181)](_0x1a28cf(0x18c));const _0xb7cecc='/'+_0x31bf29+'/'+_0x55f98b,_0x3e934e=JSON['stringify']({'path':_0xb7cecc,'autorename':![]});for(let _0x41522b=0x0;_0x41522b<0x2;_0x41522b++){try{const _0x3694fe=await fetch(_0x1a28cf(0x175),{'method':_0x1a28cf(0x1b9),'headers':{'Authorization':_0x1a28cf(0x1a0)+_0x1e1ecd,'Content-Type':'application/json'},'body':_0x3e934e});if(_0x3694fe['status']===0x191){const _0x257a72=await dpRefreshToken();if(!_0x257a72)throw new Error(_0x1a28cf(0x1b7));_0x1e1ecd=localStorage[_0x1a28cf(0x181)](_0x1a28cf(0x18c));continue;}if(_0x3694fe[_0x1a28cf(0x184)]===0x199)return{'message':_0x1a28cf(0x1aa),'path':_0x55f98b};if(!_0x3694fe['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x55f98b);const _0x33e4c7=await _0x3694fe['json']();return await lockNoti('Folder\x20created','',0xbb8),_0x33e4c7;}catch(_0x3ce59a){if(_0x41522b===0x1)throw _0x3ce59a;}}return![];}function a0_0x506e(_0x5cf961,_0x1450fa){var _0x44763b=a0_0x4476();return a0_0x506e=function(_0x506ea1,_0x4ae294){_0x506ea1=_0x506ea1-0x174;var _0x3cad90=_0x44763b[_0x506ea1];return _0x3cad90;},a0_0x506e(_0x5cf961,_0x1450fa);}export async function dpRefreshToken(){var _0x55ff7a=a0_0x23a15d;if(!localStorage['getItem'](_0x55ff7a(0x1b8)))throw _0x55ff7a(0x1c4);try{const _0x442247=await fetch(_0x55ff7a(0x1ab),{'method':_0x55ff7a(0x1b9),'headers':{'Content-Type':_0x55ff7a(0x199)},'body':_0x55ff7a(0x1d6)+localStorage[_0x55ff7a(0x181)]('refreshToken')+_0x55ff7a(0x189)}),_0x526974=await _0x442247[_0x55ff7a(0x1d0)]();if(!_0x526974[_0x55ff7a(0x188)])return localStorage['setItem'](_0x55ff7a(0x18c),_0x526974[_0x55ff7a(0x1d4)]),await lockNoti(_0x55ff7a(0x182),'',0xbb8),await delay(0x3e8),!![];else alert(_0x526974['error_description']||_0x55ff7a(0x19d));}catch(_0x4382a8){console[_0x55ff7a(0x188)](_0x55ff7a(0x1b6),_0x4382a8);}return![];}export async function dpUploadFile(_0x5cab0d,_0x1cf9fa,_0x24e31c){var _0x2c6a1d=a0_0x23a15d;const _0x3cad2e=localStorage[_0x2c6a1d(0x181)](_0x2c6a1d(0x176));var _0x1b158b=JSON['stringify']({'autorename':!![],'mode':_0x2c6a1d(0x1cd),'mute':!![],'strict_conflict':![],'path':'/'+_0x3cad2e+'/'+_0x24e31c+'/'+_0x5cab0d}),_0x385ca8=new Blob([_0x1cf9fa],{'type':_0x2c6a1d(0x1ce)});for(var _0x39cee4=0x0;_0x39cee4<0x2;_0x39cee4++){var _0xe82a38=await fetch(_0x2c6a1d(0x1d1),{'method':_0x2c6a1d(0x1b9),'headers':{'Authorization':_0x2c6a1d(0x1a0)+localStorage[_0x2c6a1d(0x181)](_0x2c6a1d(0x18c)),'Dropbox-API-Arg':_0x1b158b,'Content-Type':_0x2c6a1d(0x1ce)},'body':_0x385ca8});if(_0xe82a38[_0x2c6a1d(0x184)]!=0xc8){if(_0xe82a38[_0x2c6a1d(0x184)]==0x191){var _0x21882b=await dpRefreshToken();if(!_0x21882b)throw _0x2c6a1d(0x1b7);continue;}else throw _0x2c6a1d(0x19c)+_0xe82a38[_0x2c6a1d(0x184)];}else{var _0x430b40=await _0xe82a38['json']();return console['log'](_0x2c6a1d(0x1b2),_0x5cab0d),_0x430b40;}}return![];}export async function dpDownloadFile(_0xdaeeac,_0x25ece6){var _0x1df62e=a0_0x23a15d;const _0xe30e2f=localStorage[_0x1df62e(0x181)]('uId');var _0x4124b4=JSON[_0x1df62e(0x19a)]({'path':'/'+_0xe30e2f+'/'+_0x25ece6+'/'+_0xdaeeac});for(var _0x55aeb0=0x0;_0x55aeb0<0x2;_0x55aeb0++){var _0x58203f=await fetch(_0x1df62e(0x19f),{'method':_0x1df62e(0x1b9),'headers':{'Authorization':_0x1df62e(0x1a0)+localStorage['getItem'](_0x1df62e(0x18c)),'Dropbox-API-Arg':_0x4124b4}});if(_0x58203f[_0x1df62e(0x184)]!=0xc8){if(_0x58203f['status']==0x191){var _0x51d269=await dpRefreshToken();if(!_0x51d269)throw _0x1df62e(0x1b7);continue;}else throw _0x1df62e(0x1a2)+_0x58203f[_0x1df62e(0x184)];}const _0x56aebf=new File([await _0x58203f[_0x1df62e(0x1c5)]()],_0xdaeeac);return console['log'](_0x1df62e(0x197),_0x56aebf[_0x1df62e(0x1be)]),a0_0x4642fc['uploadFileInCloud'](_0x56aebf,()=>{}),_0x56aebf;}return![];}document['addEventListener'](a0_0x23a15d(0x1b4),function(){var _0x4f4b62=a0_0x23a15d;dropboxRestore[_0x4f4b62(0x1d5)](_0x4f4b62(0x19e),async function(){var _0x1ca9b5=_0x4f4b62;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x5dfa6d=localStorage['getItem']('uId'),_0x381cc8=['state',_0x1ca9b5(0x1b5),'screenshot'];if(!_0x5dfa6d){window['alert']('Cloud\x20login\x20required!');return;}let _0x1758af=[];for(const _0x2e3b03 of _0x381cc8){let _0x82f2fa={'path':'/'+_0x5dfa6d+'/'+_0x2e3b03};for(let _0x29d889=0x0;_0x29d889<0x2;_0x29d889++){let _0x4e279b=await fetch(_0x1ca9b5(0x1cb),{'method':_0x1ca9b5(0x1b9),'headers':{'Authorization':_0x1ca9b5(0x1a0)+localStorage['getItem'](_0x1ca9b5(0x18c)),'Content-Type':_0x1ca9b5(0x18d)},'body':JSON[_0x1ca9b5(0x19a)](_0x82f2fa)});if(_0x4e279b[_0x1ca9b5(0x184)]===0xc8){let _0x380d22=await _0x4e279b['json'](),_0x517831=_0x380d22[_0x1ca9b5(0x17e)][_0x1ca9b5(0x18f)](_0x157c45=>_0x157c45[_0x1ca9b5(0x180)]===_0x1ca9b5(0x1a7));_0x517831['length']>0x0&&_0x1758af[_0x1ca9b5(0x19b)](..._0x517831[_0x1ca9b5(0x1b1)](_0x17869f=>({'name':_0x17869f[_0x1ca9b5(0x1be)],'folder':_0x2e3b03})));break;}else{if(_0x4e279b[_0x1ca9b5(0x184)]===0x191){let _0x32a181=await dpRefreshToken();if(!_0x32a181)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x1ca9b5(0x188)]('Download\x20failed\x20for\x20'+_0x2e3b03+',\x20status:\x20'+_0x4e279b[_0x1ca9b5(0x184)]);break;}}}}if(_0x1758af['length']>0x0){const _0x279044='Do\x20you\x20want\x20to\x20restore\x20'+_0x1758af[_0x1ca9b5(0x17b)]+_0x1ca9b5(0x1af);if(window[_0x1ca9b5(0x190)](_0x279044))for(const _0x4b67ea of _0x1758af){await lockNoti(_0x1ca9b5(0x1a8),_0x4b67ea[_0x1ca9b5(0x1be)],0xbb8),await dpDownloadFile(_0x4b67ea[_0x1ca9b5(0x1be)],_0x4b67ea[_0x1ca9b5(0x1ae)]);}else console[_0x1ca9b5(0x1a5)](_0x1ca9b5(0x1a9));}else console[_0x1ca9b5(0x1a5)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x4f4b62(0x1d5)](_0x4f4b62(0x19e),async function(){var _0x297a78=_0x4f4b62;await lockNoti(_0x297a78(0x17f),'',0x1388);const _0x144cd8=localStorage[_0x297a78(0x181)](_0x297a78(0x176));if(_0x144cd8===null||_0x144cd8==='')window[_0x297a78(0x1bd)](_0x297a78(0x1cf));else{const _0x49de9b=[_0x297a78(0x185),_0x297a78(0x1b5),_0x297a78(0x1ac)];for(const _0x269dc of _0x49de9b){await dpCreateFolder(_0x269dc);}let _0x3901a4=0x0;for(const _0x398544 of _0x49de9b){const _0x2fb5c2=a0_0x4642fc[_0x297a78(0x1a4)](_0x398544+'s');_0x3901a4+=_0x2fb5c2['length'];}if(window[_0x297a78(0x190)](_0x297a78(0x1dd)+_0x3901a4+_0x297a78(0x178)))for(const _0x134c6f of _0x49de9b){const _0x1c6ed2=a0_0x4642fc[_0x297a78(0x1a4)](_0x134c6f+'s');for(const _0x3bccd2 of _0x1c6ed2){const _0x56d860=await a0_0x4642fc[_0x297a78(0x17c)](_0x297a78(0x1ba)+_0x134c6f+'s/'+_0x3bccd2);try{await lockNoti(_0x297a78(0x179),_0x3bccd2,0xbb8),await dpUploadFile(_0x3bccd2,_0x56d860,_0x134c6f);}catch(_0x397708){console[_0x297a78(0x188)](_0x297a78(0x18b)+_0x3bccd2+':',_0x397708);}}}else console['log'](_0x297a78(0x1a9));}}),dropboxCloud[_0x4f4b62(0x1d5)]('click',function(){var _0x36d651=_0x4f4b62;const _0x56daf2=localStorage['getItem'](_0x36d651(0x176));_0x56daf2===null||_0x56daf2===''?authorizeWithDropbox():window[_0x36d651(0x190)](_0x36d651(0x195))&&(localStorage[_0x36d651(0x1c2)]('uId',''),dropboxRestore[_0x36d651(0x1c0)][_0x36d651(0x193)](_0x36d651(0x1bc)),dropboxBackup[_0x36d651(0x1c0)]['remove'](_0x36d651(0x1bc)),dropboxCloud[_0x36d651(0x1c0)][_0x36d651(0x193)](_0x36d651(0x1bc)));}),handleDropboxCallback();});