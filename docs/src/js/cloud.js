var a0_0x2ccc94=a0_0x57f4;function a0_0x57f4(_0x5c7d3b,_0x37bec3){var _0x2b22d9=a0_0x2b22();return a0_0x57f4=function(_0x57f474,_0x4dc8b4){_0x57f474=_0x57f474-0x1cd;var _0x57300d=_0x2b22d9[_0x57f474];return _0x57300d;},a0_0x57f4(_0x5c7d3b,_0x37bec3);}(function(_0x5015ea,_0x27fe70){var _0x335042=a0_0x57f4,_0x18b76d=_0x5015ea();while(!![]){try{var _0x1a801b=parseInt(_0x335042(0x209))/0x1+parseInt(_0x335042(0x233))/0x2+-parseInt(_0x335042(0x1f4))/0x3+-parseInt(_0x335042(0x21e))/0x4*(parseInt(_0x335042(0x1e1))/0x5)+parseInt(_0x335042(0x206))/0x6+-parseInt(_0x335042(0x218))/0x7+parseInt(_0x335042(0x1fa))/0x8;if(_0x1a801b===_0x27fe70)break;else _0x18b76d['push'](_0x18b76d['shift']());}catch(_0x426b82){_0x18b76d['push'](_0x18b76d['shift']());}}}(a0_0x2b22,0x46af2));import*as a0_0x3b354f from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2ccc94(0x215),clientSecret=a0_0x2ccc94(0x1d5);function a0_0x2b22(){var _0x56228f=['Bearer\x20','Restore\x20canceled\x20by\x20user.','code=','access_token','href','.ss0','_imageState','setRequestHeader','getItem','&response_type=','1792848zpIUmU','https://api.dropbox.com/oauth2/token','json','483701HRUooU','name','refresh_token','status','toUpperCase','onload','length','remove','Failed\x20to\x20refresh\x20Dropbox\x20token.','Error\x20while\x20refreshing\x20token:','active','replace','knh3uz2mx2hp2eu','location','FSSync','3592008mlhHYj','overwrite','alert','.ss3','https://content.dropboxapi.com/2/files/upload','stringify','989916IUkuxR','&client_id=','error','entries','POST','.txt','click','.ss2','&token_access_type=','blob','confirm','file','\x20files\x20in\x20Kabu?','exec','error_description','.tag','.ss1','application/x-www-form-urlencoded','addEventListener','Content-Type','substring','30622YpEPpa','.gba_imageState','endsWith','https://api.dropboxapi.com/oauth2/token','charAt','Backing\x20up...','Cloud\x20login\x20required!','classList','refreshToken','_dateState','nwb3dnfh09rhs31','.ss7','lastIndexOf','https://www.dropbox.com/oauth2/authorize?client_id=','/data/','split','&client_secret=','&redirect_uri=','No\x20refresh\x20token','Cloud\x20↦\x20Kabu\x20storage\x20◆','setItem','application/octet-stream','5dyKHCZ','slice','.ss6','Authorization\x20Code:','uid','text/plain','Kabu\x20storage\x20↦\x20Cloud\x20◆','send','.ss4','=([^&#]*)','responseText','Do\x20you\x20want\x20to\x20logout?','authorization_code','uId','accessToken','https://api.dropboxapi.com/2/files/list_folder','offline','[\x5c?&#]','state','146718FGQoTL','log','.ss5','Unable\x20to\x20refresh\x20token','\x20files\x20in\x20Cloud?','Download\x20failed,\x20unknown\x20http\x20status:\x20','2409848OkxovU','list'];a0_0x2b22=function(){return _0x56228f;};return a0_0x2b22();}function authorizeWithDropbox(){var _0x18d1f5=a0_0x2ccc94,_0x2cf918=window[_0x18d1f5(0x216)][_0x18d1f5(0x200)]['split']('?')[0x0],_0x4ea8fe='code',_0x7d3b7e=_0x18d1f5(0x1f1),_0xb2fff7=_0x18d1f5(0x1d8)+clientId+_0x18d1f5(0x205)+_0x4ea8fe+_0x18d1f5(0x226)+_0x7d3b7e+_0x18d1f5(0x1dc)+encodeURIComponent(_0x2cf918);window['location'][_0x18d1f5(0x200)]=_0xb2fff7;}function handleDropboxCallback(){var _0x5bd0db=a0_0x2ccc94,_0x1f50e7=getUrlParameter('code');_0x1f50e7?(getAccessToken(_0x1f50e7),console[_0x5bd0db(0x1f5)](_0x5bd0db(0x1e4),_0x1f50e7)):console[_0x5bd0db(0x1f5)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x470a4c){var _0x17d0f4=a0_0x2ccc94;_0x470a4c=_0x470a4c[_0x17d0f4(0x214)](/[\[]/,'\x5c[')[_0x17d0f4(0x214)](/[\]]/,'\x5c]');var _0x114471=new RegExp(_0x17d0f4(0x1f2)+_0x470a4c+_0x17d0f4(0x1ea)),_0x179e5a=_0x114471[_0x17d0f4(0x22b)](location['search']);return _0x179e5a===null?'':decodeURIComponent(_0x179e5a[0x1][_0x17d0f4(0x214)](/\+/g,'\x20'));}function getAccessToken(_0x5633bf){var _0x5f19a9=a0_0x2ccc94,_0x335d72=_0x5f19a9(0x1ed),_0x1fb859=window['location'][_0x5f19a9(0x200)]['split']('?')[0x0],_0x13e736=new XMLHttpRequest();_0x13e736['open']('POST',_0x5f19a9(0x207)),_0x13e736[_0x5f19a9(0x203)](_0x5f19a9(0x231),_0x5f19a9(0x22f)),_0x13e736[_0x5f19a9(0x20e)]=function(){var _0x2a4c13=_0x5f19a9;if(_0x13e736[_0x2a4c13(0x20c)]===0xc8){var _0x43eb5f=JSON['parse'](_0x13e736[_0x2a4c13(0x1eb)]),_0x1f2a35=_0x43eb5f[_0x2a4c13(0x1ff)],_0x379ec3=_0x43eb5f[_0x2a4c13(0x20b)],_0x1f7788=_0x43eb5f[_0x2a4c13(0x1e5)];localStorage[_0x2a4c13(0x1df)](_0x2a4c13(0x1ef),_0x1f2a35),localStorage[_0x2a4c13(0x1df)](_0x2a4c13(0x1d3),_0x379ec3),localStorage['setItem'](_0x2a4c13(0x1ee),_0x1f7788);}else console[_0x2a4c13(0x1f5)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x13e736[_0x5f19a9(0x1e8)](_0x5f19a9(0x1fe)+_0x5633bf+'&grant_type='+_0x335d72+_0x5f19a9(0x21f)+clientId+_0x5f19a9(0x1db)+clientSecret+_0x5f19a9(0x1dc)+encodeURIComponent(_0x1fb859));}export async function dpRefreshToken(){var _0x59b9cf=a0_0x2ccc94;if(!localStorage[_0x59b9cf(0x204)](_0x59b9cf(0x1d3)))throw _0x59b9cf(0x1dd);try{const _0x26cd34=await fetch(_0x59b9cf(0x1ce),{'method':'POST','headers':{'Content-Type':_0x59b9cf(0x22f)},'body':'refresh_token='+localStorage[_0x59b9cf(0x204)]('refreshToken')+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x9ce08c=await _0x26cd34[_0x59b9cf(0x208)]();if(!_0x9ce08c[_0x59b9cf(0x220)])return localStorage['setItem']('accessToken',_0x9ce08c['access_token']),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0x9ce08c[_0x59b9cf(0x22c)]||_0x59b9cf(0x211));}catch(_0x2bbb82){console[_0x59b9cf(0x220)](_0x59b9cf(0x212),_0x2bbb82);}return![];}export async function dpUploadFile(_0x440fde,_0x5acc21){var _0x1d957e=a0_0x2ccc94;const _0x49aa73=localStorage[_0x1d957e(0x204)](_0x1d957e(0x1ee));var _0x51efe9=JSON['stringify']({'autorename':!![],'mode':_0x1d957e(0x219),'mute':!![],'strict_conflict':![],'path':'/'+_0x49aa73+'/'+_0x440fde}),_0x16e6be=new Blob([_0x5acc21],{'type':_0x1d957e(0x1e0)});for(var _0x3c0a5a=0x0;_0x3c0a5a<0x2;_0x3c0a5a++){var _0x5912ee=await fetch(_0x1d957e(0x21c),{'method':_0x1d957e(0x222),'headers':{'Authorization':_0x1d957e(0x1fc)+localStorage[_0x1d957e(0x204)](_0x1d957e(0x1ef)),'Dropbox-API-Arg':_0x51efe9,'Content-Type':'application/octet-stream'},'body':_0x16e6be});if(_0x5912ee[_0x1d957e(0x20c)]!=0xc8){if(_0x5912ee['status']==0x191){var _0x4c91fd=await dpRefreshToken();if(!_0x4c91fd)throw _0x1d957e(0x1f7);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x5912ee[_0x1d957e(0x20c)];}else{var _0x1010da=await _0x5912ee[_0x1d957e(0x208)]();return console['log'](_0x1d957e(0x1e7),_0x440fde),_0x1010da;}}return![];}async function dpDownloadFile(_0x55947c){var _0x4a1181=a0_0x2ccc94;const _0x43da88=localStorage[_0x4a1181(0x204)](_0x4a1181(0x1ee));var _0x5a6b40=JSON['stringify']({'path':'/'+_0x43da88+'/'+_0x55947c});for(var _0x2e5572=0x0;_0x2e5572<0x2;_0x2e5572++){var _0x48dc52=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x4a1181(0x222),'headers':{'Authorization':_0x4a1181(0x1fc)+localStorage['getItem'](_0x4a1181(0x1ef)),'Dropbox-API-Arg':_0x5a6b40}});if(_0x48dc52['status']!=0xc8){if(_0x48dc52[_0x4a1181(0x20c)]==0x191){var _0xd78b28=await dpRefreshToken();if(!_0xd78b28)throw _0x4a1181(0x1f7);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x48dc52[_0x4a1181(0x20c)];}const _0x34fd8d=new File([await _0x48dc52[_0x4a1181(0x227)]()],_0x55947c);console[_0x4a1181(0x1f5)](_0x4a1181(0x1de),_0x34fd8d[_0x4a1181(0x20a)]);if(_0x55947c[_0x4a1181(0x1cd)](_0x4a1181(0x223))){const _0x5e887d=await _0x34fd8d['text'](),[_0x4f0b53,_0x378e3a]=_0x5e887d[_0x4a1181(0x1da)]('\x0a\x0a'),_0x47080b=_0x55947c[_0x4a1181(0x232)](0x0,_0x55947c[_0x4a1181(0x1d7)]('gba')+0x3),_0x54e34a=_0x55947c[_0x4a1181(0x1cf)](_0x55947c[_0x4a1181(0x20f)]-0x5);localStorage[_0x4a1181(0x1df)](_0x47080b+_0x4a1181(0x1d4)+_0x54e34a,_0x378e3a),localStorage[_0x4a1181(0x1df)](_0x47080b+_0x4a1181(0x202)+_0x54e34a,_0x4f0b53);}else a0_0x3b354f['uploadSaveOrSaveState'](_0x34fd8d,()=>{var _0x2ada1b=_0x4a1181;localStorageFile(),Module[_0x2ada1b(0x217)]();});return _0x34fd8d;}return![];}document[a0_0x2ccc94(0x230)]('DOMContentLoaded',function(){var _0x1579f5=a0_0x2ccc94;dropboxRestore['addEventListener'](_0x1579f5(0x224),async function(){var _0x4c52f0=_0x1579f5;const _0x4922a2=localStorage['getItem'](_0x4c52f0(0x1ee));if(_0x4922a2===null||_0x4922a2==='')window['alert'](_0x4c52f0(0x1d1));else{var _0x229242={'path':'/'+_0x4922a2};for(var _0x2820b5=0x0;_0x2820b5<0x2;_0x2820b5++){var _0x61041c=await fetch(_0x4c52f0(0x1f0),{'method':_0x4c52f0(0x222),'headers':{'Authorization':_0x4c52f0(0x1fc)+localStorage[_0x4c52f0(0x204)](_0x4c52f0(0x1ef)),'Content-Type':'application/json'},'body':JSON[_0x4c52f0(0x21d)](_0x229242)});console[_0x4c52f0(0x1f5)]('status:\x20',_0x61041c[_0x4c52f0(0x20c)]);if(_0x61041c[_0x4c52f0(0x20c)]!=0xc8){if(_0x61041c[_0x4c52f0(0x20c)]==0x191){var _0xd2ffc3=await dpRefreshToken();if(!_0xd2ffc3)throw _0x4c52f0(0x1f7);continue;}else throw _0x4c52f0(0x1f9)+_0x61041c['status'];}else{const _0x3d132a=await _0x61041c[_0x4c52f0(0x208)](),_0xa70518=_0x3d132a[_0x4c52f0(0x221)]['filter'](_0x12e7d0=>_0x12e7d0[_0x4c52f0(0x22d)]===_0x4c52f0(0x229))[_0x4c52f0(0x20f)],_0x1b8d10='Do\x20you\x20want\x20to\x20restore\x20'+_0xa70518+_0x4c52f0(0x1f8);if(window[_0x4c52f0(0x228)](_0x1b8d10))for(const _0x39e2f3 of _0x3d132a['entries']){_0x39e2f3['.tag']===_0x4c52f0(0x229)&&(await lockNoti('Restoring...',_0x39e2f3['name'],0xbb8),await dpDownloadFile(_0x39e2f3[_0x4c52f0(0x20a)]));}else console['log'](_0x4c52f0(0x1fd));return!![];}}return![];}}),dropboxBackup['addEventListener'](_0x1579f5(0x224),async function(){var _0x459b2c=_0x1579f5;const _0x577927=localStorage[_0x459b2c(0x204)](_0x459b2c(0x1ee));if(_0x577927===null||_0x577927==='')window[_0x459b2c(0x21a)](_0x459b2c(0x1d1));else{const _0x1baf70=[_0x459b2c(0x1f3),'save'];let _0x3290de=0x0;for(const _0x24ef39 of _0x1baf70){const _0x4ff0a1=a0_0x3b354f[_0x459b2c(0x1fb)+(_0x24ef39[_0x459b2c(0x1cf)](0x0)[_0x459b2c(0x20d)]()+_0x24ef39[_0x459b2c(0x1e2)](0x1))]();_0x3290de+=_0x4ff0a1[_0x459b2c(0x20f)];}if(window[_0x459b2c(0x228)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x3290de+_0x459b2c(0x22a)))for(const _0x298a0d of _0x1baf70){const _0x8ff515=a0_0x3b354f[_0x459b2c(0x1fb)+(_0x298a0d['charAt'](0x0)[_0x459b2c(0x20d)]()+_0x298a0d['slice'](0x1))]();for(const _0xa54202 of _0x8ff515){const _0x232ea4=await a0_0x3b354f['downloadFileInCloud'](_0x459b2c(0x1d9)+_0x298a0d+'s/'+_0xa54202);try{await lockNoti('Backing\x20up...',_0xa54202,0xbb8),await dpUploadFile(_0xa54202,_0x232ea4);if(_0xa54202[_0x459b2c(0x1cd)](_0x459b2c(0x201))||_0xa54202[_0x459b2c(0x1cd)](_0x459b2c(0x22e))||_0xa54202['endsWith'](_0x459b2c(0x225))||_0xa54202['endsWith'](_0x459b2c(0x21b))||_0xa54202[_0x459b2c(0x1cd)](_0x459b2c(0x1e9))||_0xa54202[_0x459b2c(0x1cd)](_0x459b2c(0x1f6))||_0xa54202[_0x459b2c(0x1cd)](_0x459b2c(0x1e3))||_0xa54202[_0x459b2c(0x1cd)](_0x459b2c(0x1d6))){const _0x29b27f=_0xa54202[_0x459b2c(0x232)](0x0,_0xa54202[_0x459b2c(0x1d7)]('.')),_0x4c7ab2=_0xa54202[_0x459b2c(0x1cf)](_0xa54202[_0x459b2c(0x20f)]-0x1),_0x2349ba=localStorage[_0x459b2c(0x204)](_0x29b27f+_0x459b2c(0x234)+_0x4c7ab2),_0x54a52c=localStorage[_0x459b2c(0x204)](_0x29b27f+'.gba_dateState'+_0x4c7ab2);if(_0x2349ba!==null){const _0xc35777=_0x2349ba+'\x0a\x0a'+_0x54a52c,_0x222787=new Blob([_0xc35777],{'type':_0x459b2c(0x1e6)});await lockNoti(_0x459b2c(0x1d0),_0x29b27f+'.gba_slot'+_0x4c7ab2+_0x459b2c(0x223),0xbb8),await dpUploadFile(_0x29b27f+'.gba_slot'+_0x4c7ab2+'.txt',_0x222787);}}}catch(_0x1845ba){console[_0x459b2c(0x220)]('Failed\x20to\x20upload\x20file\x20'+_0xa54202+':',_0x1845ba);}}}else console[_0x459b2c(0x1f5)](_0x459b2c(0x1fd));}}),dropboxCloud['addEventListener'](_0x1579f5(0x224),function(){var _0x5000bb=_0x1579f5;const _0x3ebd82=localStorage['getItem'](_0x5000bb(0x1ee));_0x3ebd82===null||_0x3ebd82===''?authorizeWithDropbox():window[_0x5000bb(0x228)](_0x5000bb(0x1ec))&&(localStorage[_0x5000bb(0x1df)](_0x5000bb(0x1ee),''),dropboxRestore[_0x5000bb(0x1d2)][_0x5000bb(0x210)]('active'),dropboxBackup['classList']['remove'](_0x5000bb(0x213)),dropboxCloud[_0x5000bb(0x1d2)][_0x5000bb(0x210)](_0x5000bb(0x213)));}),handleDropboxCallback();});