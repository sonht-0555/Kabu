var a0_0x4f8321=a0_0x3212;(function(_0x70423c,_0x291efb){var _0x46ccf6=a0_0x3212,_0x8bf91f=_0x70423c();while(!![]){try{var _0x376a4b=-parseInt(_0x46ccf6(0x116))/0x1*(parseInt(_0x46ccf6(0xf8))/0x2)+parseInt(_0x46ccf6(0x12d))/0x3*(-parseInt(_0x46ccf6(0xe0))/0x4)+parseInt(_0x46ccf6(0x104))/0x5+-parseInt(_0x46ccf6(0x129))/0x6*(-parseInt(_0x46ccf6(0xd3))/0x7)+parseInt(_0x46ccf6(0x106))/0x8+-parseInt(_0x46ccf6(0x12b))/0x9+parseInt(_0x46ccf6(0xfe))/0xa;if(_0x376a4b===_0x291efb)break;else _0x8bf91f['push'](_0x8bf91f['shift']());}catch(_0x90a85f){_0x8bf91f['push'](_0x8bf91f['shift']());}}}(a0_0x180b,0x3ab1f));import*as a0_0x39230f from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x4f8321(0x110),clientSecret=a0_0x4f8321(0xe1);function a0_0x3212(_0x7d28b5,_0xfdc303){var _0x180b69=a0_0x180b();return a0_0x3212=function(_0x32121f,_0x2bb3f5){_0x32121f=_0x32121f-0xd3;var _0x517707=_0x180b69[_0x32121f];return _0x517707;},a0_0x3212(_0x7d28b5,_0xfdc303);}function authorizeWithDropbox(){var _0x412a9c=a0_0x4f8321,_0x4b236c=window[_0x412a9c(0xe4)][_0x412a9c(0x128)][_0x412a9c(0x118)]('?')[0x0],_0x4d9abf=_0x412a9c(0x10f),_0x1f1096='offline',_0x3da20a='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+'&response_type='+_0x4d9abf+'&token_access_type='+_0x1f1096+_0x412a9c(0xd8)+encodeURIComponent(_0x4b236c);window[_0x412a9c(0xe4)][_0x412a9c(0x128)]=_0x3da20a;}function handleDropboxCallback(){var _0x558154=a0_0x4f8321,_0x1ae10c=getUrlParameter(_0x558154(0x10f));_0x1ae10c?(getAccessToken(_0x1ae10c),console[_0x558154(0x137)](_0x558154(0x127),_0x1ae10c)):console[_0x558154(0x137)](_0x558154(0x132));}function getUrlParameter(_0x4c54d1){var _0x51e520=a0_0x4f8321;_0x4c54d1=_0x4c54d1[_0x51e520(0xef)](/[\[]/,'\x5c[')[_0x51e520(0xef)](/[\]]/,'\x5c]');var _0x5ca851=new RegExp(_0x51e520(0xe5)+_0x4c54d1+_0x51e520(0xf4)),_0x465a08=_0x5ca851[_0x51e520(0x142)](location[_0x51e520(0x103)]);return _0x465a08===null?'':decodeURIComponent(_0x465a08[0x1]['replace'](/\+/g,'\x20'));}function a0_0x180b(){var _0x1fef16=['name','code=','Restore\x20canceled\x20by\x20user.','log','POST','charAt','Do\x20you\x20want\x20to\x20restore\x20','toUpperCase','authorization_code','setRequestHeader','json','Download\x20failed,\x20unknown\x20http\x20status:\x20','Refreshing\x20token...','.gba_imageState','exec','Do\x20you\x20want\x20to\x20backup\x20','status','867041EKNSgA','Backing\x20up...','active','_dateState','.ss0','&redirect_uri=','classList','application/x-www-form-urlencoded','text/plain','gba','alert','substring','list','10312IhvATJ','nwb3dnfh09rhs31','.ss2','downloadFileInCloud','location','[\x5c?&#]','setItem','https://api.dropboxapi.com/2/files/list_folder','status:\x20','Failed\x20to\x20upload\x20file\x20','DOMContentLoaded','length','overwrite','refresh_token','Kabu\x20storage\x20↦\x20Cloud\x20◆','replace','access_token','.ss7','FSSync','application/octet-stream','=([^&#]*)','No\x20refresh\x20token','accessToken','addEventListener','436KUksNn','refresh_token=','.ss6','open','.gba_slot','lastIndexOf','479250wcyCkd','Content-Type','Cloud\x20↦\x20Kabu\x20storage\x20◆','text','onload','search','2146855FWvXWl','uploadSaveOrSaveState','3188296PoebHX','https://api.dropbox.com/oauth2/token','.tag','blob','.ss3','application/json','parse','file','uId','code','knh3uz2mx2hp2eu','https://content.dropboxapi.com/2/files/upload','endsWith','entries','uid','getItem','1955lagUxp','remove','split','click','confirm','https://api.dropboxapi.com/oauth2/token','state','send','Upload\x20failed,\x20unknown\x20http\x20status:\x20','error_description','stringify','Bearer\x20','/data/','.ss4','.gba_dateState','refreshToken','save','Authorization\x20Code:','href','18wWFrcE','Unable\x20to\x20refresh\x20token','2466315OqTNkg','responseText','357AmZujL','.ss1','Download\x20failed,\x20unknown\x20http\x20status:','slice','Restoring...','Do\x20not\x20receive\x20authorization','error'];a0_0x180b=function(){return _0x1fef16;};return a0_0x180b();}function getAccessToken(_0x14928f){var _0x3a93c5=a0_0x4f8321,_0x34476b=_0x3a93c5(0x13c),_0x476a4e=window['location'][_0x3a93c5(0x128)]['split']('?')[0x0],_0x32b2cc=new XMLHttpRequest();_0x32b2cc[_0x3a93c5(0xfb)]('POST',_0x3a93c5(0x107)),_0x32b2cc[_0x3a93c5(0x13d)](_0x3a93c5(0xff),'application/x-www-form-urlencoded'),_0x32b2cc[_0x3a93c5(0x102)]=function(){var _0x2eaa59=_0x3a93c5;if(_0x32b2cc[_0x2eaa59(0x144)]===0xc8){var _0x126595=JSON[_0x2eaa59(0x10c)](_0x32b2cc[_0x2eaa59(0x12c)]),_0x3a5700=_0x126595[_0x2eaa59(0xf0)],_0x46d969=_0x126595[_0x2eaa59(0xed)],_0x564dfa=_0x126595[_0x2eaa59(0x114)];localStorage[_0x2eaa59(0xe6)](_0x2eaa59(0xf6),_0x3a5700),localStorage[_0x2eaa59(0xe6)]('refreshToken',_0x46d969),localStorage[_0x2eaa59(0xe6)](_0x2eaa59(0x10e),_0x564dfa);}else console[_0x2eaa59(0x137)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x32b2cc[_0x3a93c5(0x11d)](_0x3a93c5(0x135)+_0x14928f+'&grant_type='+_0x34476b+'&client_id='+clientId+'&client_secret='+clientSecret+_0x3a93c5(0xd8)+encodeURIComponent(_0x476a4e));}export async function dpRefreshToken(){var _0x302249=a0_0x4f8321;if(!localStorage[_0x302249(0x115)](_0x302249(0x125)))throw _0x302249(0xf5);try{const _0x160dbe=await fetch(_0x302249(0x11b),{'method':_0x302249(0x138),'headers':{'Content-Type':_0x302249(0xda)},'body':_0x302249(0xf9)+localStorage[_0x302249(0x115)](_0x302249(0x125))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x3739cf=await _0x160dbe[_0x302249(0x13e)]();if(!_0x3739cf[_0x302249(0x133)])return localStorage['setItem'](_0x302249(0xf6),_0x3739cf[_0x302249(0xf0)]),await lockNoti('',_0x302249(0x140),0xbb8),await delay(0x3e8),!![];else alert(_0x3739cf[_0x302249(0x11f)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x36872a){console['error']('Error\x20while\x20refreshing\x20token:',_0x36872a);}return![];}export async function dpUploadFile(_0x495ff9,_0x68bd8b){var _0x6c58a2=a0_0x4f8321;const _0x142115=localStorage['getItem']('uId');var _0x32192c=JSON[_0x6c58a2(0x120)]({'autorename':!![],'mode':_0x6c58a2(0xec),'mute':!![],'strict_conflict':![],'path':'/'+_0x142115+'/'+_0x495ff9}),_0x5e80a7=new Blob([_0x68bd8b],{'type':_0x6c58a2(0xf3)});for(var _0x14d1c8=0x0;_0x14d1c8<0x2;_0x14d1c8++){var _0x4d2ba1=await fetch(_0x6c58a2(0x111),{'method':'POST','headers':{'Authorization':_0x6c58a2(0x121)+localStorage['getItem'](_0x6c58a2(0xf6)),'Dropbox-API-Arg':_0x32192c,'Content-Type':_0x6c58a2(0xf3)},'body':_0x5e80a7});if(_0x4d2ba1[_0x6c58a2(0x144)]!=0xc8){if(_0x4d2ba1[_0x6c58a2(0x144)]==0x191){var _0x4fa22e=await dpRefreshToken();if(!_0x4fa22e)throw _0x6c58a2(0x12a);continue;}else throw _0x6c58a2(0x11e)+_0x4d2ba1['status'];}else{var _0x3bcbcc=await _0x4d2ba1[_0x6c58a2(0x13e)]();return console[_0x6c58a2(0x137)](_0x6c58a2(0xee),_0x495ff9),_0x3bcbcc;}}return![];}async function dpDownloadFile(_0x230dbe){var _0x4579e1=a0_0x4f8321;const _0x106366=localStorage['getItem'](_0x4579e1(0x10e));var _0x351a4f=JSON[_0x4579e1(0x120)]({'path':'/'+_0x106366+'/'+_0x230dbe});for(var _0x192ec3=0x0;_0x192ec3<0x2;_0x192ec3++){var _0x1fc4c4=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x4579e1(0x138),'headers':{'Authorization':_0x4579e1(0x121)+localStorage[_0x4579e1(0x115)](_0x4579e1(0xf6)),'Dropbox-API-Arg':_0x351a4f}});if(_0x1fc4c4[_0x4579e1(0x144)]!=0xc8){if(_0x1fc4c4[_0x4579e1(0x144)]==0x191){var _0x6ce78a=await dpRefreshToken();if(!_0x6ce78a)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x4579e1(0x12f)+_0x1fc4c4['status'];}const _0x217592=new File([await _0x1fc4c4[_0x4579e1(0x109)]()],_0x230dbe);console[_0x4579e1(0x137)](_0x4579e1(0x100),_0x217592[_0x4579e1(0x134)]);if(_0x230dbe[_0x4579e1(0x112)]('.txt')){const _0xfc0dee=await _0x217592[_0x4579e1(0x101)](),[_0x172e3e,_0x39a029]=_0xfc0dee[_0x4579e1(0x118)]('\x0a\x0a'),_0x1c6cfa=_0x230dbe[_0x4579e1(0xde)](0x0,_0x230dbe[_0x4579e1(0xfd)](_0x4579e1(0xdc))+0x3),_0x4d1ad2=_0x230dbe[_0x4579e1(0x139)](_0x230dbe[_0x4579e1(0xeb)]-0x5);localStorage['setItem'](_0x1c6cfa+_0x4579e1(0xd6)+_0x4d1ad2,_0x39a029),localStorage[_0x4579e1(0xe6)](_0x1c6cfa+'_imageState'+_0x4d1ad2,_0x172e3e);}else a0_0x39230f[_0x4579e1(0x105)](_0x217592,()=>{var _0x1298ce=_0x4579e1;localStorageFile(),Module[_0x1298ce(0xf2)]();});return _0x217592;}return![];}document['addEventListener'](a0_0x4f8321(0xea),function(){var _0x3bf121=a0_0x4f8321;dropboxRestore[_0x3bf121(0xf7)]('click',async function(){var _0x230531=_0x3bf121;const _0x5a40db=localStorage[_0x230531(0x115)](_0x230531(0x10e));if(_0x5a40db===null||_0x5a40db==='')window['alert']('Cloud\x20login\x20required!');else{var _0x286283={'path':'/'+_0x5a40db};for(var _0x317716=0x0;_0x317716<0x2;_0x317716++){var _0x1ca25a=await fetch(_0x230531(0xe7),{'method':_0x230531(0x138),'headers':{'Authorization':_0x230531(0x121)+localStorage[_0x230531(0x115)]('accessToken'),'Content-Type':_0x230531(0x10b)},'body':JSON['stringify'](_0x286283)});console[_0x230531(0x137)](_0x230531(0xe8),_0x1ca25a['status']);if(_0x1ca25a[_0x230531(0x144)]!=0xc8){if(_0x1ca25a['status']==0x191){var _0x39875c=await dpRefreshToken();if(!_0x39875c)throw _0x230531(0x12a);continue;}else throw _0x230531(0x13f)+_0x1ca25a[_0x230531(0x144)];}else{const _0x438866=await _0x1ca25a[_0x230531(0x13e)](),_0x284b13=_0x438866[_0x230531(0x113)]['filter'](_0x2b217e=>_0x2b217e[_0x230531(0x108)]==='file')[_0x230531(0xeb)],_0x5f36d8=_0x230531(0x13a)+_0x284b13+'\x20files\x20in\x20Cloud?';if(window[_0x230531(0x11a)](_0x5f36d8))for(const _0x7fba03 of _0x438866[_0x230531(0x113)]){_0x7fba03['.tag']===_0x230531(0x10d)&&(await lockNoti(_0x230531(0x131),_0x7fba03[_0x230531(0x134)],0xbb8),await dpDownloadFile(_0x7fba03[_0x230531(0x134)]));}else console[_0x230531(0x137)]('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup[_0x3bf121(0xf7)]('click',async function(){var _0x3e069f=_0x3bf121;const _0x319901=localStorage[_0x3e069f(0x115)](_0x3e069f(0x10e));if(_0x319901===null||_0x319901==='')window[_0x3e069f(0xdd)]('Cloud\x20login\x20required!');else{const _0x12af40=[_0x3e069f(0x11c),_0x3e069f(0x126)];let _0x905ff7=0x0;for(const _0x479f19 of _0x12af40){const _0x3626d4=a0_0x39230f[_0x3e069f(0xdf)+(_0x479f19['charAt'](0x0)['toUpperCase']()+_0x479f19[_0x3e069f(0x130)](0x1))]();_0x905ff7+=_0x3626d4[_0x3e069f(0xeb)];}if(window[_0x3e069f(0x11a)](_0x3e069f(0x143)+_0x905ff7+'\x20files\x20in\x20Kabu?'))for(const _0x25e03b of _0x12af40){const _0x55f725=a0_0x39230f[_0x3e069f(0xdf)+(_0x25e03b[_0x3e069f(0x139)](0x0)[_0x3e069f(0x13b)]()+_0x25e03b[_0x3e069f(0x130)](0x1))]();for(const _0x77d2ef of _0x55f725){const _0x5dd05e=await a0_0x39230f[_0x3e069f(0xe3)](_0x3e069f(0x122)+_0x25e03b+'s/'+_0x77d2ef);try{await lockNoti(_0x3e069f(0xd4),_0x77d2ef,0xbb8),await dpUploadFile(_0x77d2ef,_0x5dd05e);if(_0x77d2ef['endsWith'](_0x3e069f(0xd7))||_0x77d2ef['endsWith'](_0x3e069f(0x12e))||_0x77d2ef[_0x3e069f(0x112)](_0x3e069f(0xe2))||_0x77d2ef[_0x3e069f(0x112)](_0x3e069f(0x10a))||_0x77d2ef[_0x3e069f(0x112)](_0x3e069f(0x123))||_0x77d2ef[_0x3e069f(0x112)]('.ss5')||_0x77d2ef[_0x3e069f(0x112)](_0x3e069f(0xfa))||_0x77d2ef[_0x3e069f(0x112)](_0x3e069f(0xf1))){const _0x16fc24=_0x77d2ef['substring'](0x0,_0x77d2ef['lastIndexOf']('.')),_0xf4a891=_0x77d2ef[_0x3e069f(0x139)](_0x77d2ef['length']-0x1),_0x1d67b3=localStorage[_0x3e069f(0x115)](_0x16fc24+_0x3e069f(0x141)+_0xf4a891),_0x2e2048=localStorage['getItem'](_0x16fc24+_0x3e069f(0x124)+_0xf4a891);if(_0x1d67b3!==null){const _0x54d127=_0x1d67b3+'\x0a\x0a'+_0x2e2048,_0x3a3a57=new Blob([_0x54d127],{'type':_0x3e069f(0xdb)});await lockNoti(_0x3e069f(0xd4),_0x16fc24+_0x3e069f(0xfc)+_0xf4a891+'.txt',0xbb8),await dpUploadFile(_0x16fc24+_0x3e069f(0xfc)+_0xf4a891+'.txt',_0x3a3a57);}}}catch(_0x52e4a5){console[_0x3e069f(0x133)](_0x3e069f(0xe9)+_0x77d2ef+':',_0x52e4a5);}}}else console[_0x3e069f(0x137)](_0x3e069f(0x136));}}),dropboxCloud[_0x3bf121(0xf7)](_0x3bf121(0x119),function(){var _0x58c1b6=_0x3bf121;const _0x68da60=localStorage[_0x58c1b6(0x115)](_0x58c1b6(0x10e));_0x68da60===null||_0x68da60===''?authorizeWithDropbox():window[_0x58c1b6(0x11a)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x58c1b6(0xe6)](_0x58c1b6(0x10e),''),dropboxRestore['classList']['remove'](_0x58c1b6(0xd5)),dropboxBackup['classList'][_0x58c1b6(0x117)]('active'),dropboxCloud[_0x58c1b6(0xd9)][_0x58c1b6(0x117)]('active'));}),handleDropboxCallback();});