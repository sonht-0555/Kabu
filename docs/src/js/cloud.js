var a0_0x11fa36=a0_0x3713;(function(_0x26cf5d,_0x3efbdf){var _0x462dfd=a0_0x3713,_0x146307=_0x26cf5d();while(!![]){try{var _0x4a51d2=-parseInt(_0x462dfd(0x20b))/0x1*(parseInt(_0x462dfd(0x1ff))/0x2)+-parseInt(_0x462dfd(0x242))/0x3+-parseInt(_0x462dfd(0x227))/0x4+-parseInt(_0x462dfd(0x233))/0x5*(-parseInt(_0x462dfd(0x22f))/0x6)+parseInt(_0x462dfd(0x210))/0x7+-parseInt(_0x462dfd(0x209))/0x8+parseInt(_0x462dfd(0x24d))/0x9*(parseInt(_0x462dfd(0x20c))/0xa);if(_0x4a51d2===_0x3efbdf)break;else _0x146307['push'](_0x146307['shift']());}catch(_0xc58608){_0x146307['push'](_0x146307['shift']());}}}(a0_0x3d42,0xbccb7));import*as a0_0x14032b from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x11fa36(0x222),clientSecret=a0_0x11fa36(0x23b);function authorizeWithDropbox(){var _0x1ae90e=a0_0x11fa36,_0x423ad3=window[_0x1ae90e(0x1e0)]['href'][_0x1ae90e(0x1f1)]('?')[0x0],_0x446e77=_0x1ae90e(0x21a),_0xf65e26=_0x1ae90e(0x201),_0x1845ae=_0x1ae90e(0x24a)+clientId+_0x1ae90e(0x1f5)+_0x446e77+_0x1ae90e(0x1f3)+_0xf65e26+_0x1ae90e(0x23e)+encodeURIComponent(_0x423ad3);window['location']['href']=_0x1845ae;}function handleDropboxCallback(){var _0x57b957=a0_0x11fa36,_0x1881e7=getUrlParameter(_0x57b957(0x21a));_0x1881e7?(getAccessToken(_0x1881e7),console[_0x57b957(0x223)](_0x57b957(0x22b),_0x1881e7)):console['log'](_0x57b957(0x239));}function getUrlParameter(_0x33c7c6){var _0x5eb23f=a0_0x11fa36;_0x33c7c6=_0x33c7c6['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x26553b=new RegExp(_0x5eb23f(0x1f8)+_0x33c7c6+_0x5eb23f(0x229)),_0xdd4934=_0x26553b[_0x5eb23f(0x22a)](location['search']);return _0xdd4934===null?'':decodeURIComponent(_0xdd4934[0x1][_0x5eb23f(0x1e8)](/\+/g,'\x20'));}function a0_0x3713(_0x2fc384,_0x24a9e0){var _0x3d42e2=a0_0x3d42();return a0_0x3713=function(_0x371325,_0x2067a5){_0x371325=_0x371325-0x1e0;var _0x9ff863=_0x3d42e2[_0x371325];return _0x9ff863;},a0_0x3713(_0x2fc384,_0x24a9e0);}function getAccessToken(_0x45ca2f){var _0x41d258=a0_0x11fa36,_0x5dd8b0='authorization_code',_0x24db27=window[_0x41d258(0x1e0)][_0x41d258(0x208)]['split']('?')[0x0],_0x225dd5=new XMLHttpRequest();_0x225dd5[_0x41d258(0x21b)](_0x41d258(0x21c),_0x41d258(0x228)),_0x225dd5[_0x41d258(0x232)](_0x41d258(0x202),'application/x-www-form-urlencoded'),_0x225dd5[_0x41d258(0x211)]=function(){var _0x47ed91=_0x41d258;if(_0x225dd5['status']===0xc8){var _0x1e8a70=JSON[_0x47ed91(0x237)](_0x225dd5[_0x47ed91(0x21f)]),_0x4e2c27=_0x1e8a70[_0x47ed91(0x244)],_0x566f09=_0x1e8a70[_0x47ed91(0x23f)],_0x367bad=_0x1e8a70[_0x47ed91(0x206)];localStorage[_0x47ed91(0x230)](_0x47ed91(0x1f0),_0x4e2c27),localStorage[_0x47ed91(0x230)](_0x47ed91(0x1ec),_0x566f09),localStorage[_0x47ed91(0x230)](_0x47ed91(0x245),_0x367bad);}else console[_0x47ed91(0x223)](_0x47ed91(0x1ef));},_0x225dd5[_0x41d258(0x24c)](_0x41d258(0x220)+_0x45ca2f+_0x41d258(0x1e7)+_0x5dd8b0+_0x41d258(0x20a)+clientId+_0x41d258(0x204)+clientSecret+_0x41d258(0x23e)+encodeURIComponent(_0x24db27));}export async function dpCreateFolder(_0x4917df){var _0x2a477c=a0_0x11fa36;const _0x185e04=localStorage['getItem'](_0x2a477c(0x245));let _0x24bf57=localStorage['getItem'](_0x2a477c(0x1f0));const _0x234cf1='/'+_0x185e04+'/'+_0x4917df,_0x254c5a=JSON[_0x2a477c(0x1eb)]({'path':_0x234cf1,'autorename':![]});for(let _0x42cde3=0x0;_0x42cde3<0x2;_0x42cde3++){try{const _0x4602b5=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':'POST','headers':{'Authorization':'Bearer\x20'+_0x24bf57,'Content-Type':'application/json'},'body':_0x254c5a});if(_0x4602b5[_0x2a477c(0x1f2)]===0x191){const _0x31289b=await dpRefreshToken();if(!_0x31289b)throw new Error(_0x2a477c(0x1e5));_0x24bf57=localStorage[_0x2a477c(0x225)]('accessToken');continue;}if(_0x4602b5[_0x2a477c(0x1f2)]===0x199)return{'message':_0x2a477c(0x205),'path':_0x4917df};if(!_0x4602b5['ok'])throw new Error(_0x2a477c(0x212)+_0x4917df);const _0x448180=await _0x4602b5[_0x2a477c(0x1fc)]();return await lockNoti(_0x2a477c(0x24b),'',0xbb8),_0x448180;}catch(_0x5a646b){if(_0x42cde3===0x1)throw _0x5a646b;}}return![];}export async function dpRefreshToken(){var _0x503cda=a0_0x11fa36;if(!localStorage['getItem'](_0x503cda(0x1ec)))throw _0x503cda(0x214);try{const _0x3719bf=await fetch(_0x503cda(0x1ed),{'method':_0x503cda(0x21c),'headers':{'Content-Type':_0x503cda(0x21d)},'body':'refresh_token='+localStorage[_0x503cda(0x225)](_0x503cda(0x1ec))+_0x503cda(0x1fb)}),_0x39c183=await _0x3719bf['json']();if(!_0x39c183[_0x503cda(0x22c)])return localStorage[_0x503cda(0x230)]('accessToken',_0x39c183[_0x503cda(0x244)]),await lockNoti(_0x503cda(0x23c),'',0xbb8),await delay(0x3e8),!![];else alert(_0x39c183['error_description']||_0x503cda(0x213));}catch(_0x519144){console['error']('Error\x20while\x20refreshing\x20token:',_0x519144);}return![];}export async function dpUploadFile(_0x36fcde,_0x12b52f,_0x4e1220){var _0x273dec=a0_0x11fa36;const _0x5ca3e6=localStorage['getItem'](_0x273dec(0x245));var _0x11348b=JSON['stringify']({'autorename':!![],'mode':_0x273dec(0x219),'mute':!![],'strict_conflict':![],'path':'/'+_0x5ca3e6+'/'+_0x4e1220+'/'+_0x36fcde}),_0x1e9807=new Blob([_0x12b52f],{'type':'application/octet-stream'});for(var _0x3f7bd1=0x0;_0x3f7bd1<0x2;_0x3f7bd1++){var _0x38e17a=await fetch(_0x273dec(0x1e1),{'method':_0x273dec(0x21c),'headers':{'Authorization':_0x273dec(0x23a)+localStorage[_0x273dec(0x225)]('accessToken'),'Dropbox-API-Arg':_0x11348b,'Content-Type':_0x273dec(0x216)},'body':_0x1e9807});if(_0x38e17a[_0x273dec(0x1f2)]!=0xc8){if(_0x38e17a['status']==0x191){var _0x909a0a=await dpRefreshToken();if(!_0x909a0a)throw _0x273dec(0x1e5);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x38e17a[_0x273dec(0x1f2)];}else{var _0x384702=await _0x38e17a[_0x273dec(0x1fc)]();return console['log'](_0x273dec(0x1e2),_0x36fcde),_0x384702;}}return![];}function a0_0x3d42(){var _0x34f165=['86465HABcTz','10wwMEIi','/data/','uploadFileInCloud','downloadFileInCloud','9065595upYyoB','onload','Error\x20creating\x20folder\x20','Failed\x20to\x20refresh\x20Dropbox\x20token.','No\x20refresh\x20token','Restoring...','application/octet-stream','Backing\x20up...','click','overwrite','code','open','POST','application/x-www-form-urlencoded','push','responseText','code=','name','knh3uz2mx2hp2eu','log','https://api.dropboxapi.com/2/files/list_folder','getItem','state','6172928BjhqPt','https://api.dropbox.com/oauth2/token','=([^&#]*)','exec','Authorization\x20Code:','error','application/json','save','613014BiXZvo','setItem','map','setRequestHeader','40dSNCWg','Cloud\x20↦\x20Kabu\x20storage\x20◆','No\x20files\x20found\x20to\x20restore.','blob','parse','Do\x20you\x20want\x20to\x20backup\x20','Do\x20not\x20receive\x20authorization','Bearer\x20','nwb3dnfh09rhs31','Refreshing\x20token...','active','&redirect_uri=','refresh_token','Download\x20failed,\x20unknown\x20http\x20status:','classList','2654064JiBJaf','confirm','access_token','uId','\x20files\x20in\x20Kabu?','length','file','https://content.dropboxapi.com/2/files/download','https://www.dropbox.com/oauth2/authorize?client_id=','Folder\x20created','send','20530287wgSuHR','location','https://content.dropboxapi.com/2/files/upload','Kabu\x20storage\x20↦\x20Cloud\x20◆','screenshot','Wait\x20a\x20little\x20bit...','Unable\x20to\x20refresh\x20token','Restore\x20canceled\x20by\x20user.','&grant_type=','replace','Download\x20failed\x20for\x20','Do\x20you\x20want\x20to\x20logout?','stringify','refreshToken','https://api.dropboxapi.com/oauth2/token','entries','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','accessToken','split','status','&token_access_type=','addEventListener','&response_type=','filter','DOMContentLoaded','[\x5c?&#]','Do\x20you\x20want\x20to\x20restore\x20','alert','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','json','folder','listFiles','2vLRHcW','remove','offline','Content-Type','Cloud\x20login\x20required!','&client_secret=','Folder\x20already\x20exists','uid','.tag','href','8847136UnckTK','&client_id='];a0_0x3d42=function(){return _0x34f165;};return a0_0x3d42();}export async function dpDownloadFile(_0x1f9182,_0x3c671d){var _0x4fdb6e=a0_0x11fa36;const _0x2bd8d2=localStorage[_0x4fdb6e(0x225)](_0x4fdb6e(0x245));var _0x183096=JSON[_0x4fdb6e(0x1eb)]({'path':'/'+_0x2bd8d2+'/'+_0x3c671d+'/'+_0x1f9182});for(var _0x332771=0x0;_0x332771<0x2;_0x332771++){var _0x2bfcfc=await fetch(_0x4fdb6e(0x249),{'method':_0x4fdb6e(0x21c),'headers':{'Authorization':_0x4fdb6e(0x23a)+localStorage[_0x4fdb6e(0x225)](_0x4fdb6e(0x1f0)),'Dropbox-API-Arg':_0x183096}});if(_0x2bfcfc[_0x4fdb6e(0x1f2)]!=0xc8){if(_0x2bfcfc[_0x4fdb6e(0x1f2)]==0x191){var _0x2bb72e=await dpRefreshToken();if(!_0x2bb72e)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x4fdb6e(0x240)+_0x2bfcfc[_0x4fdb6e(0x1f2)];}const _0x581042=new File([await _0x2bfcfc[_0x4fdb6e(0x236)]()],_0x1f9182);return console[_0x4fdb6e(0x223)](_0x4fdb6e(0x234),_0x581042['name']),a0_0x14032b[_0x4fdb6e(0x20e)](_0x581042,()=>{}),_0x581042;}return![];}document[a0_0x11fa36(0x1f4)](a0_0x11fa36(0x1f7),function(){var _0x428c4f=a0_0x11fa36;dropboxRestore[_0x428c4f(0x1f4)]('click',async function(){var _0x590aff=_0x428c4f;await lockNoti(_0x590aff(0x1e4),'',0x1388);const _0xcd7009=localStorage['getItem'](_0x590aff(0x245)),_0x5def3d=[_0x590aff(0x226),_0x590aff(0x22e),_0x590aff(0x1e3)];if(!_0xcd7009){window[_0x590aff(0x1fa)]('Cloud\x20login\x20required!');return;}let _0x8a4b67=[];for(const _0x23e3bd of _0x5def3d){let _0x5b6ce1={'path':'/'+_0xcd7009+'/'+_0x23e3bd};for(let _0x38ddba=0x0;_0x38ddba<0x2;_0x38ddba++){let _0x5a1180=await fetch(_0x590aff(0x224),{'method':_0x590aff(0x21c),'headers':{'Authorization':_0x590aff(0x23a)+localStorage['getItem']('accessToken'),'Content-Type':_0x590aff(0x22d)},'body':JSON['stringify'](_0x5b6ce1)});if(_0x5a1180[_0x590aff(0x1f2)]===0xc8){let _0x27a03a=await _0x5a1180['json'](),_0x6c9d8b=_0x27a03a[_0x590aff(0x1ee)][_0x590aff(0x1f6)](_0x3a6d61=>_0x3a6d61[_0x590aff(0x207)]===_0x590aff(0x248));_0x6c9d8b[_0x590aff(0x247)]>0x0&&_0x8a4b67[_0x590aff(0x21e)](..._0x6c9d8b[_0x590aff(0x231)](_0x49012b=>({'name':_0x49012b[_0x590aff(0x221)],'folder':_0x23e3bd})));break;}else{if(_0x5a1180[_0x590aff(0x1f2)]===0x191){let _0x2b562c=await dpRefreshToken();if(!_0x2b562c)throw _0x590aff(0x1e5);}else{console[_0x590aff(0x22c)](_0x590aff(0x1e9)+_0x23e3bd+',\x20status:\x20'+_0x5a1180[_0x590aff(0x1f2)]);break;}}}}if(_0x8a4b67['length']>0x0){const _0x558607=_0x590aff(0x1f9)+_0x8a4b67[_0x590aff(0x247)]+'\x20files\x20from\x20Cloud?';if(window[_0x590aff(0x243)](_0x558607))for(const _0x2cd396 of _0x8a4b67){await lockNoti(_0x590aff(0x215),_0x2cd396[_0x590aff(0x221)],0xbb8),await dpDownloadFile(_0x2cd396[_0x590aff(0x221)],_0x2cd396[_0x590aff(0x1fd)]);}else console[_0x590aff(0x223)]('Restore\x20canceled\x20by\x20user.');}else console[_0x590aff(0x223)](_0x590aff(0x235));}),dropboxBackup[_0x428c4f(0x1f4)](_0x428c4f(0x218),async function(){var _0x44c2dd=_0x428c4f;await lockNoti(_0x44c2dd(0x1e4),'',0x1388);const _0x460394=localStorage[_0x44c2dd(0x225)](_0x44c2dd(0x245));if(_0x460394===null||_0x460394==='')window[_0x44c2dd(0x1fa)](_0x44c2dd(0x203));else{const _0x3bc61f=[_0x44c2dd(0x226),_0x44c2dd(0x22e),_0x44c2dd(0x1e3)];for(const _0x447f31 of _0x3bc61f){await dpCreateFolder(_0x447f31);}let _0x43685b=0x0;for(const _0x5b89c7 of _0x3bc61f){const _0x47546b=a0_0x14032b['listFiles'](_0x5b89c7+'s');_0x43685b+=_0x47546b[_0x44c2dd(0x247)];}if(window[_0x44c2dd(0x243)](_0x44c2dd(0x238)+_0x43685b+_0x44c2dd(0x246)))for(const _0x164ee7 of _0x3bc61f){const _0x604226=a0_0x14032b[_0x44c2dd(0x1fe)](_0x164ee7+'s');for(const _0x102f4e of _0x604226){const _0x341bee=await a0_0x14032b[_0x44c2dd(0x20f)](_0x44c2dd(0x20d)+_0x164ee7+'s/'+_0x102f4e);try{await lockNoti(_0x44c2dd(0x217),_0x102f4e,0xbb8),await dpUploadFile(_0x102f4e,_0x341bee,_0x164ee7);}catch(_0x548e90){console[_0x44c2dd(0x22c)]('Failed\x20to\x20upload\x20file\x20'+_0x102f4e+':',_0x548e90);}}}else console[_0x44c2dd(0x223)](_0x44c2dd(0x1e6));}}),dropboxCloud[_0x428c4f(0x1f4)]('click',function(){var _0x385564=_0x428c4f;const _0x403601=localStorage[_0x385564(0x225)](_0x385564(0x245));_0x403601===null||_0x403601===''?authorizeWithDropbox():window[_0x385564(0x243)](_0x385564(0x1ea))&&(localStorage[_0x385564(0x230)](_0x385564(0x245),''),dropboxRestore[_0x385564(0x241)][_0x385564(0x200)](_0x385564(0x23d)),dropboxBackup[_0x385564(0x241)][_0x385564(0x200)](_0x385564(0x23d)),dropboxCloud[_0x385564(0x241)]['remove'](_0x385564(0x23d)));}),handleDropboxCallback();});