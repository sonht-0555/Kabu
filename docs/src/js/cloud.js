var a0_0x189ccb=a0_0x1122;(function(_0x158ca5,_0x464191){var _0x1618e5=a0_0x1122,_0x32b974=_0x158ca5();while(!![]){try{var _0xdaed25=parseInt(_0x1618e5(0x136))/0x1*(-parseInt(_0x1618e5(0x137))/0x2)+-parseInt(_0x1618e5(0x12a))/0x3*(-parseInt(_0x1618e5(0x146))/0x4)+-parseInt(_0x1618e5(0x170))/0x5*(-parseInt(_0x1618e5(0x148))/0x6)+parseInt(_0x1618e5(0x131))/0x7*(parseInt(_0x1618e5(0x181))/0x8)+parseInt(_0x1618e5(0x13f))/0x9+-parseInt(_0x1618e5(0x158))/0xa+-parseInt(_0x1618e5(0x123))/0xb*(parseInt(_0x1618e5(0x141))/0xc);if(_0xdaed25===_0x464191)break;else _0x32b974['push'](_0x32b974['shift']());}catch(_0xc84c05){_0x32b974['push'](_0x32b974['shift']());}}}(a0_0x5847,0x660d7));import*as a0_0xd37301 from'./main.js';import{localStorageFile}from'./storage.js';function a0_0x5847(){var _0x32258e=['61806WCmxJB','entries','Do\x20you\x20want\x20to\x20restore\x20','Bearer\x20','Failed\x20to\x20upload\x20file\x20','Folder\x20already\x20exists','addEventListener','application/x-www-form-urlencoded','6633783GTVOWN','uid','7620msRFcs','nwb3dnfh09rhs31','responseText','Refreshing\x20token...','blob','116060iXgWtt','active','54606KNVseb','push','listFiles','refresh_token=','POST','uploadFileInCloud','Error\x20creating\x20folder\x20','log','split','uId','application/json','knh3uz2mx2hp2eu','parse','accessToken','downloadFileInCloud','https://api.dropboxapi.com/2/files/list_folder','4496650vLqnIq','Failed\x20to\x20refresh\x20Dropbox\x20token.','overwrite','getItem','save','screenshot','json','href',',\x20status:\x20','file','https://api.dropboxapi.com/oauth2/token','Kabu\x20storage\x20↦\x20Cloud\x20◆','.tag','[\x5c?&#]','alert','code=','error','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Cloud\x20login\x20required!','name','Download\x20failed,\x20unknown\x20http\x20status:','setItem','send','https://content.dropboxapi.com/2/files/download','145OkULLz','DOMContentLoaded','https://www.dropbox.com/oauth2/authorize?client_id=','authorization_code','status','filter','&redirect_uri=','Restoring...','Do\x20not\x20receive\x20authorization','error_description','=([^&#]*)','&grant_type=','Backing\x20up...','length','refreshToken','https://content.dropboxapi.com/2/files/upload','click','8RvtsPG','access_token','code','\x20files\x20from\x20Cloud?','open','confirm','Cloud\x20↦\x20Kabu\x20storage\x20◆','20834gmAYlq','location','classList','setRequestHeader','No\x20files\x20found\x20to\x20restore.','Authorization\x20Code:','application/octet-stream','60oDkMDg','offline','https://api.dropbox.com/oauth2/token','stringify','Upload\x20failed,\x20unknown\x20http\x20status:\x20','Restore\x20canceled\x20by\x20user.','&client_id=','5802853jvtwRp','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','replace','search','remove','11WXpSHG'];a0_0x5847=function(){return _0x32258e;};return a0_0x5847();}var clientId=a0_0x189ccb(0x153),clientSecret=a0_0x189ccb(0x142);function authorizeWithDropbox(){var _0x3cfd8a=a0_0x189ccb,_0x45ee89=window[_0x3cfd8a(0x124)][_0x3cfd8a(0x15f)][_0x3cfd8a(0x150)]('?')[0x0],_0x29e7ba='code',_0x53f8f6=_0x3cfd8a(0x12b),_0x2a8cc2=_0x3cfd8a(0x172)+clientId+'&response_type='+_0x29e7ba+'&token_access_type='+_0x53f8f6+_0x3cfd8a(0x176)+encodeURIComponent(_0x45ee89);window[_0x3cfd8a(0x124)]['href']=_0x2a8cc2;}function handleDropboxCallback(){var _0x18d565=a0_0x189ccb,_0x3d0a7b=getUrlParameter(_0x18d565(0x183));_0x3d0a7b?(getAccessToken(_0x3d0a7b),console['log'](_0x18d565(0x128),_0x3d0a7b)):console['log'](_0x18d565(0x178));}function getUrlParameter(_0x515d4a){var _0x28ef57=a0_0x189ccb;_0x515d4a=_0x515d4a['replace'](/[\[]/,'\x5c[')[_0x28ef57(0x133)](/[\]]/,'\x5c]');var _0x4cc3c7=new RegExp(_0x28ef57(0x165)+_0x515d4a+_0x28ef57(0x17a)),_0x25620c=_0x4cc3c7['exec'](location[_0x28ef57(0x134)]);return _0x25620c===null?'':decodeURIComponent(_0x25620c[0x1][_0x28ef57(0x133)](/\+/g,'\x20'));}function getAccessToken(_0x5218cc){var _0x5ddfc2=a0_0x189ccb,_0x13c6b2=_0x5ddfc2(0x173),_0x58f86e=window[_0x5ddfc2(0x124)][_0x5ddfc2(0x15f)][_0x5ddfc2(0x150)]('?')[0x0],_0x296a23=new XMLHttpRequest();_0x296a23[_0x5ddfc2(0x185)](_0x5ddfc2(0x14c),_0x5ddfc2(0x12c)),_0x296a23[_0x5ddfc2(0x126)]('Content-Type',_0x5ddfc2(0x13e)),_0x296a23['onload']=function(){var _0x107de6=_0x5ddfc2;if(_0x296a23[_0x107de6(0x174)]===0xc8){var _0x3693c8=JSON[_0x107de6(0x154)](_0x296a23[_0x107de6(0x143)]),_0x214202=_0x3693c8[_0x107de6(0x182)],_0x2caa64=_0x3693c8['refresh_token'],_0x871569=_0x3693c8[_0x107de6(0x140)];localStorage[_0x107de6(0x16d)]('accessToken',_0x214202),localStorage[_0x107de6(0x16d)](_0x107de6(0x17e),_0x2caa64),localStorage['setItem']('uId',_0x871569);}else console['log'](_0x107de6(0x132));},_0x296a23[_0x5ddfc2(0x16e)](_0x5ddfc2(0x167)+_0x5218cc+_0x5ddfc2(0x17b)+_0x13c6b2+_0x5ddfc2(0x130)+clientId+'&client_secret='+clientSecret+_0x5ddfc2(0x176)+encodeURIComponent(_0x58f86e));}function a0_0x1122(_0x3067bb,_0x2e0dbe){var _0x584784=a0_0x5847();return a0_0x1122=function(_0x1122cc,_0x16198d){_0x1122cc=_0x1122cc-0x122;var _0xb3a0f6=_0x584784[_0x1122cc];return _0xb3a0f6;},a0_0x1122(_0x3067bb,_0x2e0dbe);}export async function dpCreateFolder(_0x457665){var _0x55e1db=a0_0x189ccb;const _0x407f36=localStorage['getItem'](_0x55e1db(0x151));let _0x5216ca=localStorage[_0x55e1db(0x15b)](_0x55e1db(0x155));const _0x1d6fcf='/'+_0x407f36+'/'+_0x457665,_0xe6817b=JSON[_0x55e1db(0x12d)]({'path':_0x1d6fcf,'autorename':![]});for(let _0x12c7bd=0x0;_0x12c7bd<0x2;_0x12c7bd++){try{const _0x562dae=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':'POST','headers':{'Authorization':'Bearer\x20'+_0x5216ca,'Content-Type':'application/json'},'body':_0xe6817b});if(_0x562dae['status']===0x191){const _0x36be7a=await dpRefreshToken();if(!_0x36be7a)throw new Error('Unable\x20to\x20refresh\x20token');_0x5216ca=localStorage['getItem'](_0x55e1db(0x155));continue;}if(_0x562dae[_0x55e1db(0x174)]===0x199)return{'message':_0x55e1db(0x13c),'path':_0x457665};if(!_0x562dae['ok'])throw new Error(_0x55e1db(0x14e)+_0x457665);const _0xd279ae=await _0x562dae[_0x55e1db(0x15e)]();return await lockNoti('Folder\x20created','',0xbb8),_0xd279ae;}catch(_0x185b65){if(_0x12c7bd===0x1)throw _0x185b65;}}return![];}export async function dpRefreshToken(){var _0x492fae=a0_0x189ccb;if(!localStorage[_0x492fae(0x15b)](_0x492fae(0x17e)))throw'No\x20refresh\x20token';try{const _0xc1283=await fetch(_0x492fae(0x162),{'method':_0x492fae(0x14c),'headers':{'Content-Type':_0x492fae(0x13e)},'body':_0x492fae(0x14b)+localStorage['getItem'](_0x492fae(0x17e))+_0x492fae(0x169)}),_0x2f5a4d=await _0xc1283[_0x492fae(0x15e)]();if(!_0x2f5a4d['error'])return localStorage[_0x492fae(0x16d)](_0x492fae(0x155),_0x2f5a4d['access_token']),await lockNoti(_0x492fae(0x144),'',0xbb8),await delay(0x3e8),!![];else alert(_0x2f5a4d[_0x492fae(0x179)]||_0x492fae(0x159));}catch(_0x1f1cf2){console['error']('Error\x20while\x20refreshing\x20token:',_0x1f1cf2);}return![];}export async function dpUploadFile(_0xf4ce04,_0x3ebaa1,_0x34e230){var _0x7b6594=a0_0x189ccb;const _0x38da00=localStorage[_0x7b6594(0x15b)]('uId');var _0x3f6f4b=JSON[_0x7b6594(0x12d)]({'autorename':!![],'mode':_0x7b6594(0x15a),'mute':!![],'strict_conflict':![],'path':'/'+_0x38da00+'/'+_0x34e230+'/'+_0xf4ce04}),_0x50cf31=new Blob([_0x3ebaa1],{'type':_0x7b6594(0x129)});for(var _0x5c2891=0x0;_0x5c2891<0x2;_0x5c2891++){var _0x2e99b4=await fetch(_0x7b6594(0x17f),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x7b6594(0x15b)](_0x7b6594(0x155)),'Dropbox-API-Arg':_0x3f6f4b,'Content-Type':'application/octet-stream'},'body':_0x50cf31});if(_0x2e99b4[_0x7b6594(0x174)]!=0xc8){if(_0x2e99b4['status']==0x191){var _0xedca0=await dpRefreshToken();if(!_0xedca0)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x7b6594(0x12e)+_0x2e99b4[_0x7b6594(0x174)];}else{var _0xb2e4cc=await _0x2e99b4[_0x7b6594(0x15e)]();return console['log'](_0x7b6594(0x163),_0xf4ce04),_0xb2e4cc;}}return![];}export async function dpDownloadFile(_0x3d7f7f,_0x340cf2){var _0x2aa698=a0_0x189ccb;const _0xba18f3=localStorage['getItem'](_0x2aa698(0x151));var _0x33c777=JSON['stringify']({'path':'/'+_0xba18f3+'/'+_0x340cf2+'/'+_0x3d7f7f});for(var _0x4e6829=0x0;_0x4e6829<0x2;_0x4e6829++){var _0x1c454e=await fetch(_0x2aa698(0x16f),{'method':_0x2aa698(0x14c),'headers':{'Authorization':_0x2aa698(0x13a)+localStorage['getItem'](_0x2aa698(0x155)),'Dropbox-API-Arg':_0x33c777}});if(_0x1c454e[_0x2aa698(0x174)]!=0xc8){if(_0x1c454e[_0x2aa698(0x174)]==0x191){var _0x414ef7=await dpRefreshToken();if(!_0x414ef7)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x2aa698(0x16c)+_0x1c454e[_0x2aa698(0x174)];}const _0x17822e=new File([await _0x1c454e[_0x2aa698(0x145)]()],_0x3d7f7f);return console[_0x2aa698(0x14f)](_0x2aa698(0x122),_0x17822e[_0x2aa698(0x16b)]),a0_0xd37301[_0x2aa698(0x14d)](_0x17822e,()=>{}),_0x17822e;}return![];}document[a0_0x189ccb(0x13d)](a0_0x189ccb(0x171),function(){var _0x12f668=a0_0x189ccb;dropboxRestore['addEventListener'](_0x12f668(0x180),async function(){var _0x45256b=_0x12f668;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x26a2e2=localStorage[_0x45256b(0x15b)]('uId'),_0x3c0227=['state',_0x45256b(0x15c),'screenshot'];if(!_0x26a2e2){window[_0x45256b(0x166)]('Cloud\x20login\x20required!');return;}let _0x221317=[];for(const _0xde8b76 of _0x3c0227){let _0x4049ab={'path':'/'+_0x26a2e2+'/'+_0xde8b76};for(let _0xe54b56=0x0;_0xe54b56<0x2;_0xe54b56++){let _0x4d63c4=await fetch(_0x45256b(0x157),{'method':_0x45256b(0x14c),'headers':{'Authorization':_0x45256b(0x13a)+localStorage[_0x45256b(0x15b)]('accessToken'),'Content-Type':_0x45256b(0x152)},'body':JSON[_0x45256b(0x12d)](_0x4049ab)});if(_0x4d63c4[_0x45256b(0x174)]===0xc8){let _0x1226ed=await _0x4d63c4[_0x45256b(0x15e)](),_0x223471=_0x1226ed[_0x45256b(0x138)][_0x45256b(0x175)](_0x12c592=>_0x12c592[_0x45256b(0x164)]===_0x45256b(0x161));_0x223471[_0x45256b(0x17d)]>0x0&&_0x221317[_0x45256b(0x149)](..._0x223471['map'](_0x49ecb3=>({'name':_0x49ecb3[_0x45256b(0x16b)],'folder':_0xde8b76})));break;}else{if(_0x4d63c4['status']===0x191){let _0x16cfa5=await dpRefreshToken();if(!_0x16cfa5)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x45256b(0x168)]('Download\x20failed\x20for\x20'+_0xde8b76+_0x45256b(0x160)+_0x4d63c4['status']);break;}}}}if(_0x221317['length']>0x0){const _0x4dc6e9=_0x45256b(0x139)+_0x221317[_0x45256b(0x17d)]+_0x45256b(0x184);if(window[_0x45256b(0x186)](_0x4dc6e9))for(const _0x2d9dcc of _0x221317){await lockNoti(_0x45256b(0x177),_0x2d9dcc['name'],0xbb8),await dpDownloadFile(_0x2d9dcc[_0x45256b(0x16b)],_0x2d9dcc['folder']);}else console['log'](_0x45256b(0x12f));}else console[_0x45256b(0x14f)](_0x45256b(0x127));}),dropboxBackup[_0x12f668(0x13d)](_0x12f668(0x180),async function(){var _0x2b152a=_0x12f668;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0xd68675=localStorage[_0x2b152a(0x15b)](_0x2b152a(0x151));if(_0xd68675===null||_0xd68675==='')window['alert'](_0x2b152a(0x16a));else{const _0x310107=['state',_0x2b152a(0x15c),_0x2b152a(0x15d)];for(const _0x50d89e of _0x310107){await dpCreateFolder(_0x50d89e);}let _0x4e971e=0x0;for(const _0x4b545a of _0x310107){const _0x4f16a0=a0_0xd37301[_0x2b152a(0x14a)](_0x4b545a+'s');_0x4e971e+=_0x4f16a0[_0x2b152a(0x17d)];}if(window[_0x2b152a(0x186)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x4e971e+'\x20files\x20in\x20Kabu?'))for(const _0x334cc1 of _0x310107){const _0xb01cf2=a0_0xd37301['listFiles'](_0x334cc1+'s');for(const _0x53f6bc of _0xb01cf2){const _0x129954=await a0_0xd37301[_0x2b152a(0x156)]('/data/'+_0x334cc1+'s/'+_0x53f6bc);try{await lockNoti(_0x2b152a(0x17c),_0x53f6bc,0xbb8),await dpUploadFile(_0x53f6bc,_0x129954,_0x334cc1);}catch(_0x1bb2b6){console[_0x2b152a(0x168)](_0x2b152a(0x13b)+_0x53f6bc+':',_0x1bb2b6);}}}else console['log'](_0x2b152a(0x12f));}}),dropboxCloud['addEventListener'](_0x12f668(0x180),function(){var _0x101299=_0x12f668;const _0x1a528d=localStorage[_0x101299(0x15b)]('uId');_0x1a528d===null||_0x1a528d===''?authorizeWithDropbox():window['confirm']('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x101299(0x16d)](_0x101299(0x151),''),dropboxRestore[_0x101299(0x125)]['remove']('active'),dropboxBackup['classList'][_0x101299(0x135)]('active'),dropboxCloud['classList'][_0x101299(0x135)](_0x101299(0x147)));}),handleDropboxCallback();});