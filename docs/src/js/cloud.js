var a0_0x383819=a0_0x3fe3;(function(_0x4aa6ed,_0x3b8377){var _0xdaf61a=a0_0x3fe3,_0x59dcd7=_0x4aa6ed();while(!![]){try{var _0x2005cc=-parseInt(_0xdaf61a(0xfa))/0x1*(-parseInt(_0xdaf61a(0xce))/0x2)+parseInt(_0xdaf61a(0x128))/0x3*(-parseInt(_0xdaf61a(0x10b))/0x4)+-parseInt(_0xdaf61a(0x12f))/0x5*(parseInt(_0xdaf61a(0xd7))/0x6)+parseInt(_0xdaf61a(0xdf))/0x7*(parseInt(_0xdaf61a(0x11e))/0x8)+-parseInt(_0xdaf61a(0xd9))/0x9*(-parseInt(_0xdaf61a(0x106))/0xa)+parseInt(_0xdaf61a(0x124))/0xb*(-parseInt(_0xdaf61a(0x109))/0xc)+-parseInt(_0xdaf61a(0x112))/0xd*(-parseInt(_0xdaf61a(0xe7))/0xe);if(_0x2005cc===_0x3b8377)break;else _0x59dcd7['push'](_0x59dcd7['shift']());}catch(_0x4c05ce){_0x59dcd7['push'](_0x59dcd7['shift']());}}}(a0_0x4fb2,0x900ed));import*as a0_0x557b2d from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x383819(0xd3),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x5ad632=a0_0x383819,_0x3acdee=window['location'][_0x5ad632(0xca)][_0x5ad632(0xcc)]('?')[0x0],_0x4da28a='code',_0x167e87='offline',_0x5267d2=_0x5ad632(0x100)+clientId+'&response_type='+_0x4da28a+_0x5ad632(0xd1)+_0x167e87+_0x5ad632(0x121)+encodeURIComponent(_0x3acdee);window[_0x5ad632(0x120)][_0x5ad632(0xca)]=_0x5267d2;}function handleDropboxCallback(){var _0x289d3a=a0_0x383819,_0xe88c49=getUrlParameter(_0x289d3a(0x11b));_0xe88c49?(getAccessToken(_0xe88c49),console['log'](_0x289d3a(0xe6),_0xe88c49)):console['log']('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x58a670){var _0x20d4b0=a0_0x383819;_0x58a670=_0x58a670[_0x20d4b0(0xdb)](/[\[]/,'\x5c[')[_0x20d4b0(0xdb)](/[\]]/,'\x5c]');var _0x26a58b=new RegExp(_0x20d4b0(0x105)+_0x58a670+_0x20d4b0(0x117)),_0x407a97=_0x26a58b[_0x20d4b0(0xfb)](location['search']);return _0x407a97===null?'':decodeURIComponent(_0x407a97[0x1][_0x20d4b0(0xdb)](/\+/g,'\x20'));}function getAccessToken(_0x3f482e){var _0x2e4aba=a0_0x383819,_0x1d0f6a=_0x2e4aba(0xec),_0x25d935=window[_0x2e4aba(0x120)][_0x2e4aba(0xca)]['split']('?')[0x0],_0x161e91=new XMLHttpRequest();_0x161e91[_0x2e4aba(0x125)](_0x2e4aba(0xee),'https://api.dropbox.com/oauth2/token'),_0x161e91['setRequestHeader']('Content-Type',_0x2e4aba(0xfe)),_0x161e91['onload']=function(){var _0x29f7ff=_0x2e4aba;if(_0x161e91[_0x29f7ff(0xe8)]===0xc8){var _0x54d898=JSON[_0x29f7ff(0x11c)](_0x161e91[_0x29f7ff(0xd0)]),_0x40141a=_0x54d898[_0x29f7ff(0xde)],_0x3d25ad=_0x54d898[_0x29f7ff(0xd8)],_0x54cbab=_0x54d898['uid'];localStorage[_0x29f7ff(0xf0)](_0x29f7ff(0xe3),_0x40141a),localStorage[_0x29f7ff(0xf0)](_0x29f7ff(0xe5),_0x3d25ad),localStorage[_0x29f7ff(0xf0)](_0x29f7ff(0xd4),_0x54cbab);}else console[_0x29f7ff(0xf5)](_0x29f7ff(0xcd));},_0x161e91[_0x2e4aba(0xcf)](_0x2e4aba(0xcb)+_0x3f482e+_0x2e4aba(0x11d)+_0x1d0f6a+'&client_id='+clientId+_0x2e4aba(0xf8)+clientSecret+_0x2e4aba(0x121)+encodeURIComponent(_0x25d935));}function a0_0x3fe3(_0xb7e845,_0x5e3f29){var _0x4fb2e2=a0_0x4fb2();return a0_0x3fe3=function(_0x3fe3b7,_0x147008){_0x3fe3b7=_0x3fe3b7-0xc9;var _0x7b9e11=_0x4fb2e2[_0x3fe3b7];return _0x7b9e11;},a0_0x3fe3(_0xb7e845,_0x5e3f29);}function a0_0x4fb2(){var _0x36c3d2=['https://api.dropboxapi.com/oauth2/token','\x20files\x20from\x20Cloud?','log','https://api.dropboxapi.com/2/files/list_folder','Unable\x20to\x20refresh\x20token','&client_secret=','Do\x20you\x20want\x20to\x20backup\x20','1kTGOcb','exec','Restoring...','Failed\x20to\x20refresh\x20Dropbox\x20token.','application/x-www-form-urlencoded','application/json','https://www.dropbox.com/oauth2/authorize?client_id=','name','https://content.dropboxapi.com/2/files/download','downloadFileInCloud','Bearer\x20','[\x5c?&#]','2666390tfDylz','Backing\x20up...','Folder\x20created','7520244xAEZdi','No\x20refresh\x20token','1022032DqsQDQ','stringify','Kabu\x20storage\x20↦\x20Cloud\x20◆','https://api.dropboxapi.com/2/files/create_folder_v2','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','push','confirm','6747zfEKiJ','entries','save','Refreshing\x20token...',',\x20status:\x20','=([^&#]*)','Do\x20you\x20want\x20to\x20restore\x20','file','Error\x20while\x20refreshing\x20token:','code','parse','&grant_type=','280QUloHg','listFiles','location','&redirect_uri=','overwrite','refresh_token=','11xLFoxy','open','length','error_description','12wtUHEi','state','uploadFileInCloud','https://content.dropboxapi.com/2/files/upload','Restore\x20canceled\x20by\x20user.','application/octet-stream','Wait\x20a\x20little\x20bit...','35rLnBIf','Cloud\x20login\x20required!','addEventListener','href','code=','split','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','258238KvrMcy','send','responseText','&token_access_type=','click','knh3uz2mx2hp2eu','uId','Upload\x20failed,\x20unknown\x20http\x20status:\x20','remove','919578vISpsX','refresh_token','18qhRMFv','.tag','replace','getItem','blob','access_token','121807UytkxM','alert','Download\x20failed\x20for\x20','No\x20files\x20found\x20to\x20restore.','accessToken','classList','refreshToken','Authorization\x20Code:','55034KzMurN','status','Do\x20you\x20want\x20to\x20logout?','Folder\x20already\x20exists','DOMContentLoaded','authorization_code','error','POST','json','setItem','screenshot','active'];a0_0x4fb2=function(){return _0x36c3d2;};return a0_0x4fb2();}export async function dpCreateFolder(_0x11abdf){var _0x4585fc=a0_0x383819;const _0x577d7d=localStorage[_0x4585fc(0xdc)](_0x4585fc(0xd4));let _0xf40cd6=localStorage['getItem']('accessToken');const _0x20a429='/'+_0x577d7d+'/'+_0x11abdf,_0x151296=JSON[_0x4585fc(0x10c)]({'path':_0x20a429,'autorename':![]});for(let _0x5c087d=0x0;_0x5c087d<0x2;_0x5c087d++){try{const _0x230b86=await fetch(_0x4585fc(0x10e),{'method':_0x4585fc(0xee),'headers':{'Authorization':_0x4585fc(0x104)+_0xf40cd6,'Content-Type':_0x4585fc(0xff)},'body':_0x151296});if(_0x230b86[_0x4585fc(0xe8)]===0x191){const _0x1f6e51=await dpRefreshToken();if(!_0x1f6e51)throw new Error(_0x4585fc(0xf7));_0xf40cd6=localStorage[_0x4585fc(0xdc)](_0x4585fc(0xe3));continue;}if(_0x230b86[_0x4585fc(0xe8)]===0x199)return{'message':_0x4585fc(0xea),'path':_0x11abdf};if(!_0x230b86['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x11abdf);const _0x4dc15b=await _0x230b86['json']();return await lockNoti(_0x4585fc(0x108),'',0xbb8),_0x4dc15b;}catch(_0x382b4f){if(_0x5c087d===0x1)throw _0x382b4f;}}return![];}export async function dpRefreshToken(){var _0x3d555a=a0_0x383819;if(!localStorage[_0x3d555a(0xdc)](_0x3d555a(0xe5)))throw _0x3d555a(0x10a);try{const _0x1aaf43=await fetch(_0x3d555a(0xf3),{'method':_0x3d555a(0xee),'headers':{'Content-Type':_0x3d555a(0xfe)},'body':_0x3d555a(0x123)+localStorage[_0x3d555a(0xdc)]('refreshToken')+_0x3d555a(0x10f)}),_0x287a60=await _0x1aaf43[_0x3d555a(0xef)]();if(!_0x287a60['error'])return localStorage[_0x3d555a(0xf0)](_0x3d555a(0xe3),_0x287a60['access_token']),await lockNoti(_0x3d555a(0x115),'',0xbb8),await delay(0x3e8),!![];else alert(_0x287a60[_0x3d555a(0x127)]||_0x3d555a(0xfd));}catch(_0x1f43c6){console[_0x3d555a(0xed)](_0x3d555a(0x11a),_0x1f43c6);}return![];}export async function dpUploadFile(_0x556c53,_0x1c456,_0xa39f0d){var _0x186b25=a0_0x383819;const _0x29344b=localStorage[_0x186b25(0xdc)](_0x186b25(0xd4));var _0x342aeb=JSON[_0x186b25(0x10c)]({'autorename':!![],'mode':_0x186b25(0x122),'mute':!![],'strict_conflict':![],'path':'/'+_0x29344b+'/'+_0xa39f0d+'/'+_0x556c53}),_0x4561e3=new Blob([_0x1c456],{'type':_0x186b25(0x12d)});for(var _0x36a121=0x0;_0x36a121<0x2;_0x36a121++){var _0x4cccba=await fetch(_0x186b25(0x12b),{'method':_0x186b25(0xee),'headers':{'Authorization':_0x186b25(0x104)+localStorage[_0x186b25(0xdc)](_0x186b25(0xe3)),'Dropbox-API-Arg':_0x342aeb,'Content-Type':_0x186b25(0x12d)},'body':_0x4561e3});if(_0x4cccba[_0x186b25(0xe8)]!=0xc8){if(_0x4cccba[_0x186b25(0xe8)]==0x191){var _0x19f8f2=await dpRefreshToken();if(!_0x19f8f2)throw _0x186b25(0xf7);continue;}else throw _0x186b25(0xd5)+_0x4cccba[_0x186b25(0xe8)];}else{var _0x35b7bf=await _0x4cccba[_0x186b25(0xef)]();return console[_0x186b25(0xf5)](_0x186b25(0x10d),_0x556c53),_0x35b7bf;}}return![];}export async function dpDownloadFile(_0x3f4201,_0x47d9c0){var _0x15b6e8=a0_0x383819;const _0x266867=localStorage['getItem']('uId');var _0x1c20ee=JSON[_0x15b6e8(0x10c)]({'path':'/'+_0x266867+'/'+_0x47d9c0+'/'+_0x3f4201});for(var _0x1c3f46=0x0;_0x1c3f46<0x2;_0x1c3f46++){var _0x79aa96=await fetch(_0x15b6e8(0x102),{'method':_0x15b6e8(0xee),'headers':{'Authorization':_0x15b6e8(0x104)+localStorage[_0x15b6e8(0xdc)](_0x15b6e8(0xe3)),'Dropbox-API-Arg':_0x1c20ee}});if(_0x79aa96[_0x15b6e8(0xe8)]!=0xc8){if(_0x79aa96['status']==0x191){var _0x13cd0a=await dpRefreshToken();if(!_0x13cd0a)throw _0x15b6e8(0xf7);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x79aa96['status'];}const _0x1c6b6e=new File([await _0x79aa96[_0x15b6e8(0xdd)]()],_0x3f4201);return console[_0x15b6e8(0xf5)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x1c6b6e[_0x15b6e8(0x101)]),a0_0x557b2d[_0x15b6e8(0x12a)](_0x1c6b6e,()=>{}),_0x1c6b6e;}return![];}document[a0_0x383819(0xc9)](a0_0x383819(0xeb),function(){var _0x39b86=a0_0x383819;dropboxRestore['addEventListener'](_0x39b86(0xd2),async function(){var _0x58cbbd=_0x39b86;await lockNoti(_0x58cbbd(0x12e),'',0x1388);const _0x13f57e=localStorage[_0x58cbbd(0xdc)](_0x58cbbd(0xd4)),_0x44766a=[_0x58cbbd(0x129),'save',_0x58cbbd(0xf1)];if(!_0x13f57e){window[_0x58cbbd(0xe0)](_0x58cbbd(0x130));return;}let _0x417791=[];for(const _0x5ef60d of _0x44766a){let _0x11cbf4={'path':'/'+_0x13f57e+'/'+_0x5ef60d};for(let _0xbff15f=0x0;_0xbff15f<0x2;_0xbff15f++){let _0x378a3a=await fetch(_0x58cbbd(0xf6),{'method':_0x58cbbd(0xee),'headers':{'Authorization':_0x58cbbd(0x104)+localStorage[_0x58cbbd(0xdc)](_0x58cbbd(0xe3)),'Content-Type':_0x58cbbd(0xff)},'body':JSON[_0x58cbbd(0x10c)](_0x11cbf4)});if(_0x378a3a['status']===0xc8){let _0x513fce=await _0x378a3a[_0x58cbbd(0xef)](),_0x1fdc26=_0x513fce[_0x58cbbd(0x113)]['filter'](_0x5ed023=>_0x5ed023[_0x58cbbd(0xda)]===_0x58cbbd(0x119));_0x1fdc26[_0x58cbbd(0x126)]>0x0&&_0x417791[_0x58cbbd(0x110)](..._0x1fdc26['map'](_0x852858=>({'name':_0x852858[_0x58cbbd(0x101)],'folder':_0x5ef60d})));break;}else{if(_0x378a3a[_0x58cbbd(0xe8)]===0x191){let _0x37132f=await dpRefreshToken();if(!_0x37132f)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x58cbbd(0xed)](_0x58cbbd(0xe1)+_0x5ef60d+_0x58cbbd(0x116)+_0x378a3a[_0x58cbbd(0xe8)]);break;}}}}if(_0x417791[_0x58cbbd(0x126)]>0x0){const _0x3914fd=_0x58cbbd(0x118)+_0x417791[_0x58cbbd(0x126)]+_0x58cbbd(0xf4);if(window[_0x58cbbd(0x111)](_0x3914fd))for(const _0x556405 of _0x417791){await lockNoti(_0x58cbbd(0xfc),_0x556405[_0x58cbbd(0x101)],0xbb8),await dpDownloadFile(_0x556405['name'],_0x556405['folder']);}else console[_0x58cbbd(0xf5)]('Restore\x20canceled\x20by\x20user.');}else console['log'](_0x58cbbd(0xe2));}),dropboxBackup['addEventListener'](_0x39b86(0xd2),async function(){var _0x44ea2a=_0x39b86;await lockNoti(_0x44ea2a(0x12e),'',0x1388);const _0x57898a=localStorage[_0x44ea2a(0xdc)](_0x44ea2a(0xd4));if(_0x57898a===null||_0x57898a==='')window['alert'](_0x44ea2a(0x130));else{const _0x4dc911=[_0x44ea2a(0x129),_0x44ea2a(0x114),_0x44ea2a(0xf1)];for(const _0x491855 of _0x4dc911){await dpCreateFolder(_0x491855);}let _0x3e3621=0x0;for(const _0x463c1e of _0x4dc911){const _0x282a3c=a0_0x557b2d[_0x44ea2a(0x11f)](_0x463c1e+'s');_0x3e3621+=_0x282a3c[_0x44ea2a(0x126)];}if(window[_0x44ea2a(0x111)](_0x44ea2a(0xf9)+_0x3e3621+'\x20files\x20in\x20Kabu?'))for(const _0x294fb0 of _0x4dc911){const _0x2b5b59=a0_0x557b2d[_0x44ea2a(0x11f)](_0x294fb0+'s');for(const _0x4954d3 of _0x2b5b59){const _0x446c3a=await a0_0x557b2d[_0x44ea2a(0x103)]('/data/'+_0x294fb0+'s/'+_0x4954d3);try{await lockNoti(_0x44ea2a(0x107),_0x4954d3,0xbb8),await dpUploadFile(_0x4954d3,_0x446c3a,_0x294fb0);}catch(_0x337db1){console['error']('Failed\x20to\x20upload\x20file\x20'+_0x4954d3+':',_0x337db1);}}}else console[_0x44ea2a(0xf5)](_0x44ea2a(0x12c));}}),dropboxCloud[_0x39b86(0xc9)](_0x39b86(0xd2),function(){var _0x88f243=_0x39b86;const _0x4b1316=localStorage[_0x88f243(0xdc)]('uId');_0x4b1316===null||_0x4b1316===''?authorizeWithDropbox():window[_0x88f243(0x111)](_0x88f243(0xe9))&&(localStorage[_0x88f243(0xf0)](_0x88f243(0xd4),''),dropboxRestore[_0x88f243(0xe4)][_0x88f243(0xd6)](_0x88f243(0xf2)),dropboxBackup['classList'][_0x88f243(0xd6)](_0x88f243(0xf2)),dropboxCloud[_0x88f243(0xe4)]['remove'](_0x88f243(0xf2)));}),handleDropboxCallback();});