var a0_0x4aedad=a0_0x5021;function a0_0x5021(_0x352d98,_0x37bb39){var _0x48b7a6=a0_0x48b7();return a0_0x5021=function(_0x502174,_0x16aef3){_0x502174=_0x502174-0x19d;var _0x2914b9=_0x48b7a6[_0x502174];return _0x2914b9;},a0_0x5021(_0x352d98,_0x37bb39);}(function(_0xbf8eb9,_0x59c10e){var _0x69fe06=a0_0x5021,_0x59d092=_0xbf8eb9();while(!![]){try{var _0xf5d332=-parseInt(_0x69fe06(0x1f2))/0x1+parseInt(_0x69fe06(0x1d1))/0x2*(-parseInt(_0x69fe06(0x1c4))/0x3)+-parseInt(_0x69fe06(0x1c8))/0x4*(parseInt(_0x69fe06(0x1e4))/0x5)+-parseInt(_0x69fe06(0x1b4))/0x6+parseInt(_0x69fe06(0x19e))/0x7+parseInt(_0x69fe06(0x1ca))/0x8*(parseInt(_0x69fe06(0x1cf))/0x9)+-parseInt(_0x69fe06(0x1aa))/0xa*(-parseInt(_0x69fe06(0x1f6))/0xb);if(_0xf5d332===_0x59c10e)break;else _0x59d092['push'](_0x59d092['shift']());}catch(_0x15b964){_0x59d092['push'](_0x59d092['shift']());}}}(a0_0x48b7,0x6dcdb));import*as a0_0x27969a from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x4ef872=a0_0x5021,_0x4cef4d=window[_0x4ef872(0x1e7)][_0x4ef872(0x1cb)][_0x4ef872(0x1b7)]('?')[0x0],_0xd46a08=_0x4ef872(0x1a8),_0x4ded74=_0x4ef872(0x1e2),_0x3c75f9=_0x4ef872(0x1a2)+clientId+'&response_type='+_0xd46a08+_0x4ef872(0x1eb)+_0x4ded74+_0x4ef872(0x1c5)+encodeURIComponent(_0x4cef4d);window['location'][_0x4ef872(0x1cb)]=_0x3c75f9;}function handleDropboxCallback(){var _0x5b280f=a0_0x5021,_0x684a51=getUrlParameter(_0x5b280f(0x1a8));_0x684a51?(getAccessToken(_0x684a51),console[_0x5b280f(0x1c3)](_0x5b280f(0x1ea),_0x684a51)):console[_0x5b280f(0x1c3)](_0x5b280f(0x1ee));}function getUrlParameter(_0x261b12){var _0x58d8b4=a0_0x5021;_0x261b12=_0x261b12['replace'](/[\[]/,'\x5c[')[_0x58d8b4(0x1c6)](/[\]]/,'\x5c]');var _0x44460d=new RegExp(_0x58d8b4(0x1f7)+_0x261b12+_0x58d8b4(0x1a7)),_0x4594dd=_0x44460d[_0x58d8b4(0x1c1)](location[_0x58d8b4(0x1ae)]);return _0x4594dd===null?'':decodeURIComponent(_0x4594dd[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x43c1d2){var _0x3f4c15=a0_0x5021,_0x321d9b=_0x3f4c15(0x1cd),_0xcd1187=window[_0x3f4c15(0x1e7)][_0x3f4c15(0x1cb)][_0x3f4c15(0x1b7)]('?')[0x0],_0x16262e=new XMLHttpRequest();_0x16262e[_0x3f4c15(0x1ce)](_0x3f4c15(0x1b5),_0x3f4c15(0x1b0)),_0x16262e[_0x3f4c15(0x1af)]('Content-Type',_0x3f4c15(0x1da)),_0x16262e[_0x3f4c15(0x1de)]=function(){var _0xaf5959=_0x3f4c15;if(_0x16262e[_0xaf5959(0x1b2)]===0xc8){var _0x33f796=JSON[_0xaf5959(0x1f1)](_0x16262e['responseText']),_0x27580e=_0x33f796[_0xaf5959(0x1a9)],_0x1ac21b=_0x33f796['refresh_token'],_0x1e98cd=_0x33f796['uid'];localStorage[_0xaf5959(0x1b8)](_0xaf5959(0x1f8),_0x27580e),localStorage[_0xaf5959(0x1b8)]('refreshToken',_0x1ac21b),localStorage[_0xaf5959(0x1b8)](_0xaf5959(0x1b3),_0x1e98cd);}else console[_0xaf5959(0x1c3)](_0xaf5959(0x1bd));},_0x16262e[_0x3f4c15(0x1c2)](_0x3f4c15(0x1d2)+_0x43c1d2+'&grant_type='+_0x321d9b+_0x3f4c15(0x1c9)+clientId+'&client_secret='+clientSecret+_0x3f4c15(0x1c5)+encodeURIComponent(_0xcd1187));}export async function dpCreateFolder(_0x5281e2){var _0x3df346=a0_0x5021;const _0x15e0c0=localStorage[_0x3df346(0x1c7)](_0x3df346(0x1b3));let _0xeadf4b=localStorage[_0x3df346(0x1c7)](_0x3df346(0x1f8));const _0x3b8d4b='/'+_0x15e0c0+'/'+_0x5281e2,_0x37f1d7=JSON[_0x3df346(0x1f3)]({'path':_0x3b8d4b,'autorename':![]});for(let _0x13e52f=0x0;_0x13e52f<0x2;_0x13e52f++){try{const _0x5241b9=await fetch(_0x3df346(0x1ec),{'method':_0x3df346(0x1b5),'headers':{'Authorization':_0x3df346(0x1cc)+_0xeadf4b,'Content-Type':_0x3df346(0x1e8)},'body':_0x37f1d7});if(_0x5241b9[_0x3df346(0x1b2)]===0x191){const _0x3e788b=await dpRefreshToken();if(!_0x3e788b)throw new Error(_0x3df346(0x1a1));_0xeadf4b=localStorage[_0x3df346(0x1c7)](_0x3df346(0x1f8));continue;}if(_0x5241b9['status']===0x199)return{'message':_0x3df346(0x1ab),'path':_0x5281e2};if(!_0x5241b9['ok'])throw new Error(_0x3df346(0x1d4)+_0x5281e2);const _0x4741b8=await _0x5241b9[_0x3df346(0x1bc)]();return await lockNoti('Folder\x20created','',0xbb8),_0x4741b8;}catch(_0x4f0878){if(_0x13e52f===0x1)throw _0x4f0878;}}return![];}export async function dpRefreshToken(){var _0x26e2bf=a0_0x5021;if(!localStorage['getItem']('refreshToken'))throw'No\x20refresh\x20token';try{const _0x57fdd9=await fetch(_0x26e2bf(0x1f9),{'method':_0x26e2bf(0x1b5),'headers':{'Content-Type':_0x26e2bf(0x1da)},'body':_0x26e2bf(0x1ed)+localStorage[_0x26e2bf(0x1c7)]('refreshToken')+_0x26e2bf(0x1bb)}),_0x173e40=await _0x57fdd9['json']();if(!_0x173e40['error'])return localStorage[_0x26e2bf(0x1b8)](_0x26e2bf(0x1f8),_0x173e40[_0x26e2bf(0x1a9)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x173e40['error_description']||_0x26e2bf(0x1b1));}catch(_0xaf6286){console['error'](_0x26e2bf(0x1f5),_0xaf6286);}return![];}function a0_0x48b7(){var _0x234525=['Unable\x20to\x20refresh\x20token','https://www.dropbox.com/oauth2/authorize?client_id=','Do\x20you\x20want\x20to\x20restore\x20','uploadFileInCloud','addEventListener','downloadFileInCloud','=([^&#]*)','code','access_token','430SiGkUj','Folder\x20already\x20exists','name',',\x20status:\x20','search','setRequestHeader','https://api.dropbox.com/oauth2/token','Failed\x20to\x20refresh\x20Dropbox\x20token.','status','uId','3510174qyxQdY','POST','application/octet-stream','split','setItem','DOMContentLoaded','error','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','json','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','https://content.dropboxapi.com/2/files/download','blob','Download\x20failed\x20for\x20','exec','send','log','1160007WScfpv','&redirect_uri=','replace','getItem','4RpcIDW','&client_id=','16yJhuuj','href','Bearer\x20','authorization_code','open','1549998DSQZPJ','Failed\x20to\x20upload\x20file\x20','2JmDKeg','code=','classList','Error\x20creating\x20folder\x20','Wait\x20a\x20little\x20bit...','state','Restoring...','https://content.dropboxapi.com/2/files/upload','Cloud\x20login\x20required!','application/x-www-form-urlencoded','length','file','alert','onload','remove','entries','Restore\x20canceled\x20by\x20user.','offline','Kabu\x20storage\x20↦\x20Cloud\x20◆','2813380DdkANl','push','confirm','location','application/json','save','Authorization\x20Code:','&token_access_type=','https://api.dropboxapi.com/2/files/create_folder_v2','refresh_token=','Do\x20not\x20receive\x20authorization','click','map','parse','22244QRdfUw','stringify','screenshot','Error\x20while\x20refreshing\x20token:','300278iLhjYR','[\x5c?&#]','accessToken','https://api.dropboxapi.com/oauth2/token','listFiles','3416805zDNiWh','\x20files\x20from\x20Cloud?','folder'];a0_0x48b7=function(){return _0x234525;};return a0_0x48b7();}export async function dpUploadFile(_0x38cdbc,_0xc6ed35,_0x82939b){var _0x44df19=a0_0x5021;const _0x18152b=localStorage[_0x44df19(0x1c7)](_0x44df19(0x1b3));var _0x31d2be=JSON[_0x44df19(0x1f3)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x18152b+'/'+_0x82939b+'/'+_0x38cdbc}),_0x3226ed=new Blob([_0xc6ed35],{'type':'application/octet-stream'});for(var _0x3c1679=0x0;_0x3c1679<0x2;_0x3c1679++){var _0x57e51f=await fetch(_0x44df19(0x1d8),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x44df19(0x1c7)]('accessToken'),'Dropbox-API-Arg':_0x31d2be,'Content-Type':_0x44df19(0x1b6)},'body':_0x3226ed});if(_0x57e51f[_0x44df19(0x1b2)]!=0xc8){if(_0x57e51f[_0x44df19(0x1b2)]==0x191){var _0x5ac6d4=await dpRefreshToken();if(!_0x5ac6d4)throw _0x44df19(0x1a1);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x57e51f[_0x44df19(0x1b2)];}else{var _0x3ac581=await _0x57e51f[_0x44df19(0x1bc)]();return console[_0x44df19(0x1c3)](_0x44df19(0x1e3),_0x38cdbc),_0x3ac581;}}return![];}export async function dpDownloadFile(_0xfe3507,_0x1883b9){var _0x3a36ce=a0_0x5021;const _0xfe81e9=localStorage[_0x3a36ce(0x1c7)](_0x3a36ce(0x1b3));var _0x588410=JSON['stringify']({'path':'/'+_0xfe81e9+'/'+_0x1883b9+'/'+_0xfe3507});for(var _0x22199c=0x0;_0x22199c<0x2;_0x22199c++){var _0x597b80=await fetch(_0x3a36ce(0x1be),{'method':_0x3a36ce(0x1b5),'headers':{'Authorization':_0x3a36ce(0x1cc)+localStorage[_0x3a36ce(0x1c7)]('accessToken'),'Dropbox-API-Arg':_0x588410}});if(_0x597b80[_0x3a36ce(0x1b2)]!=0xc8){if(_0x597b80[_0x3a36ce(0x1b2)]==0x191){var _0x33078d=await dpRefreshToken();if(!_0x33078d)throw _0x3a36ce(0x1a1);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x597b80[_0x3a36ce(0x1b2)];}const _0x5603a8=new File([await _0x597b80[_0x3a36ce(0x1bf)]()],_0xfe3507);return console[_0x3a36ce(0x1c3)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x5603a8[_0x3a36ce(0x1ac)]),a0_0x27969a[_0x3a36ce(0x1a4)](_0x5603a8,()=>{}),_0x5603a8;}return![];}document[a0_0x4aedad(0x1a5)](a0_0x4aedad(0x1b9),function(){var _0x1f0970=a0_0x4aedad;dropboxRestore[_0x1f0970(0x1a5)](_0x1f0970(0x1ef),async function(){var _0x3b2146=_0x1f0970;await lockNoti(_0x3b2146(0x1d5),'',0x1388);const _0xa4a2ab=localStorage[_0x3b2146(0x1c7)](_0x3b2146(0x1b3)),_0x29ef61=[_0x3b2146(0x1d6),_0x3b2146(0x1e9),'screenshot'];if(!_0xa4a2ab){window[_0x3b2146(0x1dd)](_0x3b2146(0x1d9));return;}let _0x4c20fc=[];for(const _0x367c42 of _0x29ef61){let _0x5350e0={'path':'/'+_0xa4a2ab+'/'+_0x367c42};for(let _0x39880f=0x0;_0x39880f<0x2;_0x39880f++){let _0x169b50=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x3b2146(0x1b5),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x3b2146(0x1f8)),'Content-Type':_0x3b2146(0x1e8)},'body':JSON[_0x3b2146(0x1f3)](_0x5350e0)});if(_0x169b50['status']===0xc8){let _0x594d9c=await _0x169b50['json'](),_0x15dedf=_0x594d9c[_0x3b2146(0x1e0)]['filter'](_0x4a4229=>_0x4a4229['.tag']===_0x3b2146(0x1dc));_0x15dedf[_0x3b2146(0x1db)]>0x0&&_0x4c20fc[_0x3b2146(0x1e5)](..._0x15dedf[_0x3b2146(0x1f0)](_0x3d0f2e=>({'name':_0x3d0f2e[_0x3b2146(0x1ac)],'folder':_0x367c42})));break;}else{if(_0x169b50[_0x3b2146(0x1b2)]===0x191){let _0x308a77=await dpRefreshToken();if(!_0x308a77)throw _0x3b2146(0x1a1);}else{console['error'](_0x3b2146(0x1c0)+_0x367c42+_0x3b2146(0x1ad)+_0x169b50[_0x3b2146(0x1b2)]);break;}}}}if(_0x4c20fc['length']>0x0){const _0x1ed152=_0x3b2146(0x1a3)+_0x4c20fc['length']+_0x3b2146(0x19f);if(window[_0x3b2146(0x1e6)](_0x1ed152))for(const _0x29e6cb of _0x4c20fc){await lockNoti(_0x3b2146(0x1d7),_0x29e6cb[_0x3b2146(0x1ac)],0xbb8),await dpDownloadFile(_0x29e6cb[_0x3b2146(0x1ac)],_0x29e6cb[_0x3b2146(0x1a0)]);}else console['log'](_0x3b2146(0x1e1));}else console[_0x3b2146(0x1c3)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x1f0970(0x1a5)]('click',async function(){var _0x1c8a6c=_0x1f0970;await lockNoti(_0x1c8a6c(0x1d5),'',0x1388);const _0x507bda=localStorage[_0x1c8a6c(0x1c7)](_0x1c8a6c(0x1b3));if(_0x507bda===null||_0x507bda==='')window[_0x1c8a6c(0x1dd)](_0x1c8a6c(0x1d9));else{const _0x17b45d=['state',_0x1c8a6c(0x1e9),_0x1c8a6c(0x1f4)];for(const _0x1167a3 of _0x17b45d){await dpCreateFolder(_0x1167a3);}let _0x7bf61a=0x0;for(const _0x47484f of _0x17b45d){const _0xbe3b82=a0_0x27969a[_0x1c8a6c(0x19d)](_0x47484f+'s');_0x7bf61a+=_0xbe3b82[_0x1c8a6c(0x1db)];}if(window[_0x1c8a6c(0x1e6)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x7bf61a+'\x20files\x20in\x20Kabu?'))for(const _0x33feb1 of _0x17b45d){const _0x1020d5=a0_0x27969a[_0x1c8a6c(0x19d)](_0x33feb1+'s');for(const _0x54a723 of _0x1020d5){const _0x446868=await a0_0x27969a[_0x1c8a6c(0x1a6)]('/data/'+_0x33feb1+'s/'+_0x54a723);try{await lockNoti('Backing\x20up...',_0x54a723,0xbb8),await dpUploadFile(_0x54a723,_0x446868,_0x33feb1);}catch(_0x347e91){console[_0x1c8a6c(0x1ba)](_0x1c8a6c(0x1d0)+_0x54a723+':',_0x347e91);}}}else console[_0x1c8a6c(0x1c3)](_0x1c8a6c(0x1e1));}}),dropboxCloud[_0x1f0970(0x1a5)](_0x1f0970(0x1ef),function(){var _0x5b76a4=_0x1f0970;const _0x533f16=localStorage[_0x5b76a4(0x1c7)](_0x5b76a4(0x1b3));_0x533f16===null||_0x533f16===''?authorizeWithDropbox():window['confirm']('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem']('uId',''),dropboxRestore[_0x5b76a4(0x1d3)][_0x5b76a4(0x1df)]('active'),dropboxBackup['classList'][_0x5b76a4(0x1df)]('active'),dropboxCloud['classList'][_0x5b76a4(0x1df)]('active'));}),handleDropboxCallback();});