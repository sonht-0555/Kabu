var a0_0x3c9ff6=a0_0x24eb;(function(_0x17d803,_0x8e97ca){var _0x161897=a0_0x24eb,_0x1eaa45=_0x17d803();while(!![]){try{var _0x553443=parseInt(_0x161897(0x1a9))/0x1*(parseInt(_0x161897(0x1cb))/0x2)+parseInt(_0x161897(0x1a7))/0x3*(-parseInt(_0x161897(0x1c1))/0x4)+parseInt(_0x161897(0x177))/0x5+-parseInt(_0x161897(0x1aa))/0x6*(parseInt(_0x161897(0x161))/0x7)+-parseInt(_0x161897(0x184))/0x8*(parseInt(_0x161897(0x1a1))/0x9)+-parseInt(_0x161897(0x165))/0xa+parseInt(_0x161897(0x199))/0xb*(parseInt(_0x161897(0x172))/0xc);if(_0x553443===_0x8e97ca)break;else _0x1eaa45['push'](_0x1eaa45['shift']());}catch(_0x586979){_0x1eaa45['push'](_0x1eaa45['shift']());}}}(a0_0x14a5,0x25cbc));import*as a0_0x269f51 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x3c9ff6(0x182),clientSecret=a0_0x3c9ff6(0x1a3);function authorizeWithDropbox(){var _0x55aa59=a0_0x3c9ff6,_0x3e6169=window[_0x55aa59(0x1a2)]['href'][_0x55aa59(0x181)]('?')[0x0],_0x3c37d0=_0x55aa59(0x163),_0x3a8982='offline',_0x3f6b29=_0x55aa59(0x188)+clientId+_0x55aa59(0x15e)+_0x3c37d0+_0x55aa59(0x17c)+_0x3a8982+_0x55aa59(0x170)+encodeURIComponent(_0x3e6169);window[_0x55aa59(0x1a2)][_0x55aa59(0x178)]=_0x3f6b29;}function handleDropboxCallback(){var _0x598934=a0_0x3c9ff6,_0x323f41=getUrlParameter('code');_0x323f41?(getAccessToken(_0x323f41),console['log'](_0x598934(0x195),_0x323f41)):console['log'](_0x598934(0x18c));}function getUrlParameter(_0x371cc3){var _0x3e621a=a0_0x3c9ff6;_0x371cc3=_0x371cc3[_0x3e621a(0x1c2)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x5469ec=new RegExp(_0x3e621a(0x1ab)+_0x371cc3+'=([^&#]*)'),_0x4ee18b=_0x5469ec[_0x3e621a(0x169)](location['search']);return _0x4ee18b===null?'':decodeURIComponent(_0x4ee18b[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x24be4c){var _0x3cdebf=a0_0x3c9ff6,_0xc4c63='authorization_code',_0x4cc691=window['location'][_0x3cdebf(0x178)]['split']('?')[0x0],_0x325e67=new XMLHttpRequest();_0x325e67['open'](_0x3cdebf(0x164),_0x3cdebf(0x191)),_0x325e67['setRequestHeader']('Content-Type',_0x3cdebf(0x16e)),_0x325e67['onload']=function(){var _0x45e492=_0x3cdebf;if(_0x325e67[_0x45e492(0x175)]===0xc8){var _0x20f46a=JSON['parse'](_0x325e67['responseText']),_0x523bb0=_0x20f46a['access_token'],_0x1dcbc3=_0x20f46a[_0x45e492(0x183)],_0x4561a5=_0x20f46a[_0x45e492(0x1c7)];localStorage[_0x45e492(0x19b)]('accessToken',_0x523bb0),localStorage[_0x45e492(0x19b)]('refreshToken',_0x1dcbc3),localStorage['setItem'](_0x45e492(0x1b0),_0x4561a5);}else console[_0x45e492(0x1a8)](_0x45e492(0x17b));},_0x325e67[_0x3cdebf(0x1ba)](_0x3cdebf(0x1c4)+_0x24be4c+_0x3cdebf(0x1a0)+_0xc4c63+_0x3cdebf(0x18d)+clientId+_0x3cdebf(0x1ad)+clientSecret+_0x3cdebf(0x170)+encodeURIComponent(_0x4cc691));}export async function dpRefreshToken(){var _0x101ce3=a0_0x3c9ff6;if(!localStorage['getItem']('refreshToken'))throw _0x101ce3(0x1c0);try{const _0x508961=await fetch(_0x101ce3(0x167),{'method':_0x101ce3(0x164),'headers':{'Content-Type':_0x101ce3(0x16e)},'body':'refresh_token='+localStorage[_0x101ce3(0x15f)](_0x101ce3(0x18b))+_0x101ce3(0x194)}),_0x3dc054=await _0x508961[_0x101ce3(0x1b5)]();if(!_0x3dc054[_0x101ce3(0x185)])return localStorage['setItem'](_0x101ce3(0x19d),_0x3dc054[_0x101ce3(0x1be)]),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0x3dc054[_0x101ce3(0x198)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x5bacd5){console[_0x101ce3(0x185)]('Error\x20while\x20refreshing\x20token:',_0x5bacd5);}return![];}export async function dpUploadFile(_0x3b3133,_0x3bd809){var _0x245297=a0_0x3c9ff6;const _0x2b7fbb=localStorage[_0x245297(0x15f)]('uId');var _0x4279c4=JSON[_0x245297(0x15d)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x2b7fbb+'/'+_0x3b3133}),_0x29165e=new Blob([_0x3bd809],{'type':_0x245297(0x16a)});for(var _0x4deff5=0x0;_0x4deff5<0x2;_0x4deff5++){var _0x5e8cbc=await fetch(_0x245297(0x173),{'method':_0x245297(0x164),'headers':{'Authorization':_0x245297(0x1b8)+localStorage[_0x245297(0x15f)]('accessToken'),'Dropbox-API-Arg':_0x4279c4,'Content-Type':_0x245297(0x16a)},'body':_0x29165e});if(_0x5e8cbc[_0x245297(0x175)]!=0xc8){if(_0x5e8cbc[_0x245297(0x175)]==0x191){var _0x1a1bc1=await dpRefreshToken();if(!_0x1a1bc1)throw _0x245297(0x16c);continue;}else throw _0x245297(0x19e)+_0x5e8cbc[_0x245297(0x175)];}else{var _0x4cc4de=await _0x5e8cbc[_0x245297(0x1b5)]();return console[_0x245297(0x1a8)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x3b3133),_0x4cc4de;}}return![];}async function dpDownloadFile(_0x2aa0c9){var _0x248ed1=a0_0x3c9ff6;const _0x12d69d=localStorage[_0x248ed1(0x15f)](_0x248ed1(0x1b0));var _0x626da4=JSON['stringify']({'path':'/'+_0x12d69d+'/'+_0x2aa0c9});for(var _0x574a60=0x0;_0x574a60<0x2;_0x574a60++){var _0x33a1f1=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x248ed1(0x164),'headers':{'Authorization':_0x248ed1(0x1b8)+localStorage['getItem'](_0x248ed1(0x19d)),'Dropbox-API-Arg':_0x626da4}});if(_0x33a1f1[_0x248ed1(0x175)]!=0xc8){if(_0x33a1f1['status']==0x191){var _0x314c40=await dpRefreshToken();if(!_0x314c40)throw _0x248ed1(0x16c);continue;}else throw _0x248ed1(0x18a)+_0x33a1f1[_0x248ed1(0x175)];}const _0x5ae814=new File([await _0x33a1f1['blob']()],_0x2aa0c9);console[_0x248ed1(0x1a8)](_0x248ed1(0x17a),_0x5ae814[_0x248ed1(0x168)]);if(_0x2aa0c9[_0x248ed1(0x180)]('.txt')){const _0x5b83cb=await _0x5ae814[_0x248ed1(0x19a)](),[_0x2b697,_0x5c1485]=_0x5b83cb[_0x248ed1(0x181)]('\x0a\x0a'),_0x4c0ba7=_0x2aa0c9[_0x248ed1(0x187)](0x0,_0x2aa0c9[_0x248ed1(0x174)](_0x248ed1(0x17e))+0x3),_0xccf8c6=_0x2aa0c9['charAt'](_0x2aa0c9['length']-0x5);localStorage[_0x248ed1(0x19b)](_0x4c0ba7+_0x248ed1(0x1b6)+_0xccf8c6,_0x5c1485),localStorage[_0x248ed1(0x19b)](_0x4c0ba7+'_imageState'+_0xccf8c6,_0x2b697);}else a0_0x269f51[_0x248ed1(0x1b9)](_0x5ae814,()=>{var _0xb2a272=_0x248ed1;localStorageFile(),Module[_0xb2a272(0x16f)]();});return _0x5ae814;}return![];}function a0_0x24eb(_0x5183ec,_0x185738){var _0x14a505=a0_0x14a5();return a0_0x24eb=function(_0x24eb14,_0x2c78da){_0x24eb14=_0x24eb14-0x15d;var _0x188fba=_0x14a505[_0x24eb14];return _0x188fba;},a0_0x24eb(_0x5183ec,_0x185738);}function a0_0x14a5(){var _0x435e89=['toUpperCase','file','/data/','66HPBSQS','stringify','&response_type=','getItem','list','78407rputKU','.tag','code','POST','2667990yaCvkG','alert','https://api.dropboxapi.com/oauth2/token','name','exec','application/octet-stream','.ss3','Unable\x20to\x20refresh\x20token','Cloud\x20login\x20required!','application/x-www-form-urlencoded','FSSync','&redirect_uri=','status:\x20','140808LSQrON','https://content.dropboxapi.com/2/files/upload','lastIndexOf','status','DOMContentLoaded','553710kwfMhW','href','slice','Cloud\x20↦\x20Kabu\x20storage\x20◆','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','&token_access_type=','.ss5','gba','.ss4','endsWith','split','knh3uz2mx2hp2eu','refresh_token','2152EQruBC','error','Download\x20failed,\x20unknown\x20http\x20status:\x20','substring','https://www.dropbox.com/oauth2/authorize?client_id=','.ss1','Download\x20failed,\x20unknown\x20http\x20status:','refreshToken','Do\x20not\x20receive\x20authorization','&client_id=','application/json','charAt','text/plain','https://api.dropbox.com/oauth2/token','Restore\x20canceled\x20by\x20user.','\x20files\x20in\x20Kabu?','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Authorization\x20Code:','downloadFileInCloud','addEventListener','error_description','737XfqJlN','text','setItem','Do\x20you\x20want\x20to\x20restore\x20','accessToken','Upload\x20failed,\x20unknown\x20http\x20status:\x20','click','&grant_type=','7335GqpLaW','location','nwb3dnfh09rhs31','.gba_dateState','.ss0','classList','29487SBMrGL','log','1543VQVNjL','96pQcFMB','[\x5c?&#]','.ss7','&client_secret=','Backing\x20up...','length','uId','.gba_slot','active','\x20files\x20in\x20Cloud?','filter','json','_dateState','confirm','Bearer\x20','uploadSaveOrSaveState','send','remove','.ss6','save','access_token','state','No\x20refresh\x20token','52dFXNfb','replace','.gba_imageState','code=','.txt','entries','uid'];a0_0x14a5=function(){return _0x435e89;};return a0_0x14a5();}document[a0_0x3c9ff6(0x197)](a0_0x3c9ff6(0x176),function(){var _0x2b1e94=a0_0x3c9ff6;dropboxRestore[_0x2b1e94(0x197)](_0x2b1e94(0x19f),async function(){var _0x6af17b=_0x2b1e94;const _0x346d20=localStorage[_0x6af17b(0x15f)](_0x6af17b(0x1b0));if(_0x346d20===null||_0x346d20==='')window[_0x6af17b(0x166)](_0x6af17b(0x16d));else{var _0x39a0b0={'path':'/'+_0x346d20};for(var _0xf57a61=0x0;_0xf57a61<0x2;_0xf57a61++){var _0x839e2c=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':'POST','headers':{'Authorization':_0x6af17b(0x1b8)+localStorage[_0x6af17b(0x15f)](_0x6af17b(0x19d)),'Content-Type':_0x6af17b(0x18e)},'body':JSON[_0x6af17b(0x15d)](_0x39a0b0)});console[_0x6af17b(0x1a8)](_0x6af17b(0x171),_0x839e2c[_0x6af17b(0x175)]);if(_0x839e2c[_0x6af17b(0x175)]!=0xc8){if(_0x839e2c[_0x6af17b(0x175)]==0x191){var _0x39ebed=await dpRefreshToken();if(!_0x39ebed)throw _0x6af17b(0x16c);continue;}else throw _0x6af17b(0x186)+_0x839e2c['status'];}else{const _0x38da74=await _0x839e2c[_0x6af17b(0x1b5)](),_0x3700c4=_0x38da74[_0x6af17b(0x1c6)][_0x6af17b(0x1b4)](_0x48615b=>_0x48615b['.tag']===_0x6af17b(0x1c9))[_0x6af17b(0x1af)],_0x316cc5=_0x6af17b(0x19c)+_0x3700c4+_0x6af17b(0x1b3);if(window[_0x6af17b(0x1b7)](_0x316cc5))for(const _0x34bb7f of _0x38da74[_0x6af17b(0x1c6)]){_0x34bb7f[_0x6af17b(0x162)]===_0x6af17b(0x1c9)&&(await lockNoti('Restoring...',_0x34bb7f[_0x6af17b(0x168)],0xbb8),await dpDownloadFile(_0x34bb7f[_0x6af17b(0x168)]));}else console[_0x6af17b(0x1a8)](_0x6af17b(0x192));return!![];}}return![];}}),dropboxBackup[_0x2b1e94(0x197)]('click',async function(){var _0x4d81fc=_0x2b1e94;const _0x555f1c=localStorage[_0x4d81fc(0x15f)](_0x4d81fc(0x1b0));if(_0x555f1c===null||_0x555f1c==='')window[_0x4d81fc(0x166)](_0x4d81fc(0x16d));else{const _0x3f1ba8=[_0x4d81fc(0x1bf),_0x4d81fc(0x1bd)];let _0x3b2293=0x0;for(const _0x27b8f4 of _0x3f1ba8){const _0x1e6fbf=a0_0x269f51[_0x4d81fc(0x160)+(_0x27b8f4[_0x4d81fc(0x18f)](0x0)[_0x4d81fc(0x1c8)]()+_0x27b8f4['slice'](0x1))]();_0x3b2293+=_0x1e6fbf['length'];}if(window[_0x4d81fc(0x1b7)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x3b2293+_0x4d81fc(0x193)))for(const _0x1438e2 of _0x3f1ba8){const _0x3cac79=a0_0x269f51['list'+(_0x1438e2[_0x4d81fc(0x18f)](0x0)['toUpperCase']()+_0x1438e2[_0x4d81fc(0x179)](0x1))]();for(const _0x1d47df of _0x3cac79){const _0x50ff8e=await a0_0x269f51[_0x4d81fc(0x196)](_0x4d81fc(0x1ca)+_0x1438e2+'s/'+_0x1d47df);try{await lockNoti(_0x4d81fc(0x1ae),_0x1d47df,0xbb8),await dpUploadFile(_0x1d47df,_0x50ff8e);if(_0x1d47df[_0x4d81fc(0x180)](_0x4d81fc(0x1a5))||_0x1d47df['endsWith'](_0x4d81fc(0x189))||_0x1d47df['endsWith']('.ss2')||_0x1d47df[_0x4d81fc(0x180)](_0x4d81fc(0x16b))||_0x1d47df['endsWith'](_0x4d81fc(0x17f))||_0x1d47df[_0x4d81fc(0x180)](_0x4d81fc(0x17d))||_0x1d47df[_0x4d81fc(0x180)](_0x4d81fc(0x1bc))||_0x1d47df['endsWith'](_0x4d81fc(0x1ac))){const _0x575462=_0x1d47df[_0x4d81fc(0x187)](0x0,_0x1d47df[_0x4d81fc(0x174)]('.')),_0x2b7c95=_0x1d47df[_0x4d81fc(0x18f)](_0x1d47df[_0x4d81fc(0x1af)]-0x1),_0x5db915=localStorage[_0x4d81fc(0x15f)](_0x575462+_0x4d81fc(0x1c3)+_0x2b7c95),_0x41e5ef=localStorage[_0x4d81fc(0x15f)](_0x575462+_0x4d81fc(0x1a4)+_0x2b7c95);if(_0x5db915!==null){const _0x3f4198=_0x5db915+'\x0a\x0a'+_0x41e5ef,_0x5bfc34=new Blob([_0x3f4198],{'type':_0x4d81fc(0x190)});await lockNoti(_0x4d81fc(0x1ae),_0x575462+_0x4d81fc(0x1b1)+_0x2b7c95+_0x4d81fc(0x1c5),0xbb8),await dpUploadFile(_0x575462+'.gba_slot'+_0x2b7c95+_0x4d81fc(0x1c5),_0x5bfc34);}}}catch(_0x43db70){console[_0x4d81fc(0x185)]('Failed\x20to\x20upload\x20file\x20'+_0x1d47df+':',_0x43db70);}}}else console[_0x4d81fc(0x1a8)](_0x4d81fc(0x192));}}),dropboxCloud[_0x2b1e94(0x197)]('click',function(){var _0x228ae6=_0x2b1e94;const _0x3a9b61=localStorage['getItem'](_0x228ae6(0x1b0));_0x3a9b61===null||_0x3a9b61===''?authorizeWithDropbox():window[_0x228ae6(0x1b7)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x228ae6(0x19b)](_0x228ae6(0x1b0),''),dropboxRestore[_0x228ae6(0x1a6)]['remove'](_0x228ae6(0x1b2)),dropboxBackup[_0x228ae6(0x1a6)][_0x228ae6(0x1bb)](_0x228ae6(0x1b2)),dropboxCloud['classList'][_0x228ae6(0x1bb)](_0x228ae6(0x1b2)));}),handleDropboxCallback();});