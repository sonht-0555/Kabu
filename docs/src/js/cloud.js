function a0_0x4595(_0x269e96,_0x1ccbc1){var _0x53b15e=a0_0x53b1();return a0_0x4595=function(_0x459534,_0x5f04c0){_0x459534=_0x459534-0x1e8;var _0x351c0d=_0x53b15e[_0x459534];return _0x351c0d;},a0_0x4595(_0x269e96,_0x1ccbc1);}var a0_0x4615c1=a0_0x4595;(function(_0x400b83,_0x3b6639){var _0x375a82=a0_0x4595,_0x17b14a=_0x400b83();while(!![]){try{var _0x12710f=-parseInt(_0x375a82(0x1f4))/0x1+parseInt(_0x375a82(0x1f5))/0x2*(parseInt(_0x375a82(0x1ea))/0x3)+parseInt(_0x375a82(0x1e8))/0x4+-parseInt(_0x375a82(0x228))/0x5+parseInt(_0x375a82(0x1fb))/0x6+parseInt(_0x375a82(0x22d))/0x7+parseInt(_0x375a82(0x1f1))/0x8*(parseInt(_0x375a82(0x237))/0x9);if(_0x12710f===_0x3b6639)break;else _0x17b14a['push'](_0x17b14a['shift']());}catch(_0x52dec5){_0x17b14a['push'](_0x17b14a['shift']());}}}(a0_0x53b1,0xe752b));import*as a0_0x3448c8 from'./main.js';import{localStorageFile}from'./storage.js';function a0_0x53b1(){var _0xad6aa3=['=([^&#]*)','status','send','classList','name','No\x20refresh\x20token','refreshToken','exec','alert','DOMContentLoaded',',\x20status:\x20','Authorization\x20Code:','confirm','Refreshing\x20token...','https://api.dropboxapi.com/2/files/create_folder_v2','application/octet-stream','search','uid','offline','state','5040240OBjGjb','href','Do\x20not\x20receive\x20authorization','Do\x20you\x20want\x20to\x20logout?','&client_secret=','4360118hLKyWJ','POST','code','Download\x20failed,\x20unknown\x20http\x20status:','split','addEventListener','&redirect_uri=','entries','knh3uz2mx2hp2eu','open','4850352xQJzsC','https://api.dropboxapi.com/oauth2/token','Download\x20failed\x20for\x20','Unable\x20to\x20refresh\x20token','Restore\x20canceled\x20by\x20user.','Bearer\x20','Folder\x20already\x20exists','Cloud\x20↦\x20Kabu\x20storage\x20◆','uId','log','Do\x20you\x20want\x20to\x20backup\x20','https://api.dropbox.com/oauth2/token','blob','stringify','2460216eHPYqD','access_token','863970LGdFmE','Cloud\x20login\x20required!','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','&grant_type=','click','Error\x20while\x20refreshing\x20token:','error','16thllNX','parse','replace','934246lTndGC','2dItMvi','Kabu\x20storage\x20↦\x20Cloud\x20◆','overwrite','remove','Content-Type','listFiles','1716114nlJrDW','Wait\x20a\x20little\x20bit...','https://content.dropboxapi.com/2/files/upload','Failed\x20to\x20refresh\x20Dropbox\x20token.','setRequestHeader','application/json','json','error_description','https://content.dropboxapi.com/2/files/download','active','.tag','Failed\x20to\x20upload\x20file\x20','Error\x20creating\x20folder\x20','application/x-www-form-urlencoded','accessToken','file','\x20files\x20from\x20Cloud?','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','length','location','screenshot','getItem','setItem','refresh_token','push'];a0_0x53b1=function(){return _0xad6aa3;};return a0_0x53b1();}var clientId=a0_0x4615c1(0x235),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0xdba48b=a0_0x4615c1,_0x7d3c41=window[_0xdba48b(0x20e)][_0xdba48b(0x229)][_0xdba48b(0x231)]('?')[0x0],_0x5e751a=_0xdba48b(0x22f),_0x5c82ca=_0xdba48b(0x226),_0x123123='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+'&response_type='+_0x5e751a+'&token_access_type='+_0x5c82ca+_0xdba48b(0x233)+encodeURIComponent(_0x7d3c41);window[_0xdba48b(0x20e)][_0xdba48b(0x229)]=_0x123123;}function handleDropboxCallback(){var _0x6bac64=a0_0x4615c1,_0x494f47=getUrlParameter(_0x6bac64(0x22f));_0x494f47?(getAccessToken(_0x494f47),console[_0x6bac64(0x240)](_0x6bac64(0x21f),_0x494f47)):console[_0x6bac64(0x240)](_0x6bac64(0x22a));}function getUrlParameter(_0x1c7e10){var _0x672b27=a0_0x4615c1;_0x1c7e10=_0x1c7e10[_0x672b27(0x1f3)](/[\[]/,'\x5c[')[_0x672b27(0x1f3)](/[\]]/,'\x5c]');var _0x34330a=new RegExp('[\x5c?&#]'+_0x1c7e10+_0x672b27(0x214)),_0x256910=_0x34330a[_0x672b27(0x21b)](location[_0x672b27(0x224)]);return _0x256910===null?'':decodeURIComponent(_0x256910[0x1][_0x672b27(0x1f3)](/\+/g,'\x20'));}function getAccessToken(_0x124a08){var _0x138308=a0_0x4615c1,_0x3f05ef='authorization_code',_0x4b95a3=window['location'][_0x138308(0x229)][_0x138308(0x231)]('?')[0x0],_0x3d42ed=new XMLHttpRequest();_0x3d42ed[_0x138308(0x236)](_0x138308(0x22e),_0x138308(0x242)),_0x3d42ed[_0x138308(0x1ff)](_0x138308(0x1f9),_0x138308(0x208)),_0x3d42ed['onload']=function(){var _0x5d1f6a=_0x138308;if(_0x3d42ed['status']===0xc8){var _0x27e7de=JSON[_0x5d1f6a(0x1f2)](_0x3d42ed['responseText']),_0x3c06c0=_0x27e7de[_0x5d1f6a(0x1e9)],_0x480c8a=_0x27e7de[_0x5d1f6a(0x212)],_0x4487b2=_0x27e7de[_0x5d1f6a(0x225)];localStorage[_0x5d1f6a(0x211)](_0x5d1f6a(0x209),_0x3c06c0),localStorage[_0x5d1f6a(0x211)](_0x5d1f6a(0x21a),_0x480c8a),localStorage[_0x5d1f6a(0x211)](_0x5d1f6a(0x23f),_0x4487b2);}else console[_0x5d1f6a(0x240)](_0x5d1f6a(0x1ec));},_0x3d42ed[_0x138308(0x216)]('code='+_0x124a08+_0x138308(0x1ed)+_0x3f05ef+'&client_id='+clientId+_0x138308(0x22c)+clientSecret+_0x138308(0x233)+encodeURIComponent(_0x4b95a3));}export async function dpCreateFolder(_0x3a0292){var _0xc080b5=a0_0x4615c1;const _0x3b4941=localStorage[_0xc080b5(0x210)](_0xc080b5(0x23f));let _0x3230e2=localStorage[_0xc080b5(0x210)](_0xc080b5(0x209));const _0x43e862='/'+_0x3b4941+'/'+_0x3a0292,_0x2ddfb1=JSON['stringify']({'path':_0x43e862,'autorename':![]});for(let _0x44b7a2=0x0;_0x44b7a2<0x2;_0x44b7a2++){try{const _0x5e0989=await fetch(_0xc080b5(0x222),{'method':_0xc080b5(0x22e),'headers':{'Authorization':_0xc080b5(0x23c)+_0x3230e2,'Content-Type':_0xc080b5(0x200)},'body':_0x2ddfb1});if(_0x5e0989[_0xc080b5(0x215)]===0x191){const _0x59de07=await dpRefreshToken();if(!_0x59de07)throw new Error(_0xc080b5(0x23a));_0x3230e2=localStorage[_0xc080b5(0x210)](_0xc080b5(0x209));continue;}if(_0x5e0989['status']===0x199)return{'message':_0xc080b5(0x23d),'path':_0x3a0292};if(!_0x5e0989['ok'])throw new Error(_0xc080b5(0x207)+_0x3a0292);const _0x3fa9c5=await _0x5e0989['json']();return await lockNoti('Folder\x20created','',0xbb8),_0x3fa9c5;}catch(_0x8b9a63){if(_0x44b7a2===0x1)throw _0x8b9a63;}}return![];}export async function dpRefreshToken(){var _0x33b83f=a0_0x4615c1;if(!localStorage[_0x33b83f(0x210)](_0x33b83f(0x21a)))throw _0x33b83f(0x219);try{const _0x59b12f=await fetch(_0x33b83f(0x238),{'method':_0x33b83f(0x22e),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x33b83f(0x210)](_0x33b83f(0x21a))+_0x33b83f(0x20c)}),_0x2d896d=await _0x59b12f[_0x33b83f(0x201)]();if(!_0x2d896d[_0x33b83f(0x1f0)])return localStorage[_0x33b83f(0x211)]('accessToken',_0x2d896d['access_token']),await lockNoti(_0x33b83f(0x221),'',0xbb8),await delay(0x3e8),!![];else alert(_0x2d896d[_0x33b83f(0x202)]||_0x33b83f(0x1fe));}catch(_0x5ba550){console[_0x33b83f(0x1f0)](_0x33b83f(0x1ef),_0x5ba550);}return![];}export async function dpUploadFile(_0x56d71d,_0x12665a,_0x2701a7){var _0x16e3d6=a0_0x4615c1;const _0xa7c83e=localStorage[_0x16e3d6(0x210)]('uId');var _0x43c757=JSON['stringify']({'autorename':!![],'mode':_0x16e3d6(0x1f7),'mute':!![],'strict_conflict':![],'path':'/'+_0xa7c83e+'/'+_0x2701a7+'/'+_0x56d71d}),_0x2ee078=new Blob([_0x12665a],{'type':_0x16e3d6(0x223)});for(var _0xaf0cf0=0x0;_0xaf0cf0<0x2;_0xaf0cf0++){var _0x132802=await fetch(_0x16e3d6(0x1fd),{'method':_0x16e3d6(0x22e),'headers':{'Authorization':_0x16e3d6(0x23c)+localStorage[_0x16e3d6(0x210)](_0x16e3d6(0x209)),'Dropbox-API-Arg':_0x43c757,'Content-Type':'application/octet-stream'},'body':_0x2ee078});if(_0x132802['status']!=0xc8){if(_0x132802[_0x16e3d6(0x215)]==0x191){var _0x4fdfcf=await dpRefreshToken();if(!_0x4fdfcf)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x132802[_0x16e3d6(0x215)];}else{var _0x1ed2d7=await _0x132802['json']();return console['log'](_0x16e3d6(0x1f6),_0x56d71d),_0x1ed2d7;}}return![];}export async function dpDownloadFile(_0x12a0c7,_0x289c64){var _0x107df7=a0_0x4615c1;const _0x4a3715=localStorage['getItem']('uId');var _0x3a9b29=JSON['stringify']({'path':'/'+_0x4a3715+'/'+_0x289c64+'/'+_0x12a0c7});for(var _0x5bef62=0x0;_0x5bef62<0x2;_0x5bef62++){var _0x22110f=await fetch(_0x107df7(0x203),{'method':_0x107df7(0x22e),'headers':{'Authorization':_0x107df7(0x23c)+localStorage[_0x107df7(0x210)](_0x107df7(0x209)),'Dropbox-API-Arg':_0x3a9b29}});if(_0x22110f['status']!=0xc8){if(_0x22110f[_0x107df7(0x215)]==0x191){var _0x498c63=await dpRefreshToken();if(!_0x498c63)throw _0x107df7(0x23a);continue;}else throw _0x107df7(0x230)+_0x22110f[_0x107df7(0x215)];}const _0x11d74e=new File([await _0x22110f[_0x107df7(0x243)]()],_0x12a0c7);return console[_0x107df7(0x240)](_0x107df7(0x23e),_0x11d74e[_0x107df7(0x218)]),a0_0x3448c8['uploadFileInCloud'](_0x11d74e,()=>{}),_0x11d74e;}return![];}document[a0_0x4615c1(0x232)](a0_0x4615c1(0x21d),function(){var _0x225340=a0_0x4615c1;dropboxRestore[_0x225340(0x232)](_0x225340(0x1ee),async function(){var _0x1a3a87=_0x225340;await lockNoti(_0x1a3a87(0x1fc),'',0x1388);const _0x723288=localStorage['getItem']('uId'),_0x1775ff=[_0x1a3a87(0x227),'save',_0x1a3a87(0x20f)];if(!_0x723288){window['alert'](_0x1a3a87(0x1eb));return;}let _0x3f7cf8=[];for(const _0x452730 of _0x1775ff){let _0x40bd51={'path':'/'+_0x723288+'/'+_0x452730};for(let _0x16bb90=0x0;_0x16bb90<0x2;_0x16bb90++){let _0x253b4d=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x1a3a87(0x22e),'headers':{'Authorization':_0x1a3a87(0x23c)+localStorage['getItem'](_0x1a3a87(0x209)),'Content-Type':_0x1a3a87(0x200)},'body':JSON[_0x1a3a87(0x244)](_0x40bd51)});if(_0x253b4d[_0x1a3a87(0x215)]===0xc8){let _0x166090=await _0x253b4d[_0x1a3a87(0x201)](),_0x3101ae=_0x166090[_0x1a3a87(0x234)]['filter'](_0x518beb=>_0x518beb[_0x1a3a87(0x205)]===_0x1a3a87(0x20a));_0x3101ae[_0x1a3a87(0x20d)]>0x0&&_0x3f7cf8[_0x1a3a87(0x213)](..._0x3101ae['map'](_0x25303c=>({'name':_0x25303c['name'],'folder':_0x452730})));break;}else{if(_0x253b4d['status']===0x191){let _0xd72a78=await dpRefreshToken();if(!_0xd72a78)throw _0x1a3a87(0x23a);}else{console[_0x1a3a87(0x1f0)](_0x1a3a87(0x239)+_0x452730+_0x1a3a87(0x21e)+_0x253b4d[_0x1a3a87(0x215)]);break;}}}}if(_0x3f7cf8[_0x1a3a87(0x20d)]>0x0){const _0x29e652='Do\x20you\x20want\x20to\x20restore\x20'+_0x3f7cf8[_0x1a3a87(0x20d)]+_0x1a3a87(0x20b);if(window[_0x1a3a87(0x220)](_0x29e652))for(const _0x2c6998 of _0x3f7cf8){await lockNoti('Restoring...',_0x2c6998[_0x1a3a87(0x218)],0xbb8),await dpDownloadFile(_0x2c6998[_0x1a3a87(0x218)],_0x2c6998['folder']);}else console[_0x1a3a87(0x240)](_0x1a3a87(0x23b));}else console[_0x1a3a87(0x240)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x225340(0x232)](_0x225340(0x1ee),async function(){var _0x59eed8=_0x225340;await lockNoti(_0x59eed8(0x1fc),'',0x1388);const _0x2b8f70=localStorage['getItem'](_0x59eed8(0x23f));if(_0x2b8f70===null||_0x2b8f70==='')window[_0x59eed8(0x21c)]('Cloud\x20login\x20required!');else{const _0x11f7dd=['state','save','screenshot'];for(const _0x2abdaa of _0x11f7dd){await dpCreateFolder(_0x2abdaa);}let _0x51f773=0x0;for(const _0x2182da of _0x11f7dd){const _0x575285=a0_0x3448c8[_0x59eed8(0x1fa)](_0x2182da+'s');_0x51f773+=_0x575285[_0x59eed8(0x20d)];}if(window['confirm'](_0x59eed8(0x241)+_0x51f773+'\x20files\x20in\x20Kabu?'))for(const _0x298da5 of _0x11f7dd){const _0x1c1437=a0_0x3448c8[_0x59eed8(0x1fa)](_0x298da5+'s');for(const _0x14275f of _0x1c1437){const _0xc65b2d=await a0_0x3448c8['downloadFileInCloud']('/data/'+_0x298da5+'s/'+_0x14275f);try{await lockNoti('Backing\x20up...',_0x14275f,0xbb8),await dpUploadFile(_0x14275f,_0xc65b2d,_0x298da5);}catch(_0xa7608){console[_0x59eed8(0x1f0)](_0x59eed8(0x206)+_0x14275f+':',_0xa7608);}}}else console[_0x59eed8(0x240)](_0x59eed8(0x23b));}}),dropboxCloud[_0x225340(0x232)](_0x225340(0x1ee),function(){var _0x3feca3=_0x225340;const _0x29ce84=localStorage[_0x3feca3(0x210)](_0x3feca3(0x23f));_0x29ce84===null||_0x29ce84===''?authorizeWithDropbox():window['confirm'](_0x3feca3(0x22b))&&(localStorage['setItem'](_0x3feca3(0x23f),''),dropboxRestore[_0x3feca3(0x217)]['remove'](_0x3feca3(0x204)),dropboxBackup[_0x3feca3(0x217)]['remove'](_0x3feca3(0x204)),dropboxCloud[_0x3feca3(0x217)][_0x3feca3(0x1f8)]('active'));}),handleDropboxCallback();});