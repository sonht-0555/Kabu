var a0_0x50cb15=a0_0x2bec;(function(_0x39ea19,_0xc9f946){var _0x132668=a0_0x2bec,_0x3e4523=_0x39ea19();while(!![]){try{var _0x457f71=-parseInt(_0x132668(0x160))/0x1*(parseInt(_0x132668(0x121))/0x2)+parseInt(_0x132668(0x10e))/0x3+-parseInt(_0x132668(0x114))/0x4+parseInt(_0x132668(0x14d))/0x5*(-parseInt(_0x132668(0x155))/0x6)+parseInt(_0x132668(0x115))/0x7+-parseInt(_0x132668(0x13b))/0x8*(parseInt(_0x132668(0x113))/0x9)+parseInt(_0x132668(0x15a))/0xa*(parseInt(_0x132668(0x161))/0xb);if(_0x457f71===_0xc9f946)break;else _0x3e4523['push'](_0x3e4523['shift']());}catch(_0xa38802){_0x3e4523['push'](_0x3e4523['shift']());}}}(a0_0x1663,0xad53a));import*as a0_0x2adfbb from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x50cb15(0x11c),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x2eb71a=a0_0x50cb15,_0x52dd56=window[_0x2eb71a(0x154)]['href']['split']('?')[0x0],_0x4781ce='code',_0x58718a='offline',_0x5df184=_0x2eb71a(0x149)+clientId+_0x2eb71a(0x14e)+_0x4781ce+_0x2eb71a(0xfc)+_0x58718a+_0x2eb71a(0x144)+encodeURIComponent(_0x52dd56);window[_0x2eb71a(0x154)][_0x2eb71a(0x107)]=_0x5df184;}function a0_0x1663(){var _0x411609=['code','status','remove','Download\x20failed,\x20unknown\x20http\x20status:','Bearer\x20','href','save','.ss0','Do\x20you\x20want\x20to\x20logout?','uploadSaveOrSaveState','gba','stringify','2479062gXKvpi','.gba_slot','DOMContentLoaded','uId','alert','1870326VypWZZ','3670364VEkMnL','8206576LUPCiW','.txt','active','.ss6','name','overwrite','refreshToken','knh3uz2mx2hp2eu','Restoring...','addEventListener','Cloud\x20↦\x20Kabu\x20storage\x20◆','log','10qRIdVz','search','substring','length','slice','classList','_imageState','accessToken','application/octet-stream','https://content.dropboxapi.com/2/files/download','filter','Restore\x20canceled\x20by\x20user.','status:\x20','toUpperCase','entries','application/x-www-form-urlencoded','setItem','getItem','Upload\x20failed,\x20unknown\x20http\x20status:\x20','FSSync','.ss5','.tag','Failed\x20to\x20refresh\x20Dropbox\x20token.','open','\x20files\x20in\x20Cloud?','responseText','24vVqTvj','code=','split','_dateState','click','text/plain','Backing\x20up...','send','access_token','&redirect_uri=','.gba_dateState','confirm','text','blob','https://www.dropbox.com/oauth2/authorize?client_id=','Download\x20failed,\x20unknown\x20http\x20status:\x20','POST','=([^&#]*)','886405fXVfSg','&response_type=','file','.ss3','application/json','&client_secret=','parse','location','6xkuTxO','list','endsWith','https://content.dropboxapi.com/2/files/upload','Content-Type','570unwVDV','error_description','charAt','lastIndexOf','https://api.dropbox.com/oauth2/token','Do\x20not\x20receive\x20authorization','12406fdBSKs','94864ivWTDl','Unable\x20to\x20refresh\x20token','Kabu\x20storage\x20↦\x20Cloud\x20◆','Error\x20while\x20refreshing\x20token:','replace','.gba_imageState','Refreshing\x20token...','json','onload','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','&token_access_type=','state','https://api.dropboxapi.com/2/files/list_folder','Cloud\x20login\x20required!','[\x5c?&#]','Failed\x20to\x20upload\x20file\x20'];a0_0x1663=function(){return _0x411609;};return a0_0x1663();}function handleDropboxCallback(){var _0x5a4611=a0_0x50cb15,_0x17d73e=getUrlParameter(_0x5a4611(0x102));_0x17d73e?(getAccessToken(_0x17d73e),console[_0x5a4611(0x120)]('Authorization\x20Code:',_0x17d73e)):console[_0x5a4611(0x120)](_0x5a4611(0x15f));}function getUrlParameter(_0x101829){var _0x4e774f=a0_0x50cb15;_0x101829=_0x101829['replace'](/[\[]/,'\x5c[')[_0x4e774f(0xf6)](/[\]]/,'\x5c]');var _0x5eabe6=new RegExp(_0x4e774f(0x100)+_0x101829+_0x4e774f(0x14c)),_0x2084ee=_0x5eabe6['exec'](location[_0x4e774f(0x122)]);return _0x2084ee===null?'':decodeURIComponent(_0x2084ee[0x1]['replace'](/\+/g,'\x20'));}function a0_0x2bec(_0x40ba2b,_0x211b77){var _0x1663a8=a0_0x1663();return a0_0x2bec=function(_0x2bec8a,_0xaf8dee){_0x2bec8a=_0x2bec8a-0xf5;var _0x362372=_0x1663a8[_0x2bec8a];return _0x362372;},a0_0x2bec(_0x40ba2b,_0x211b77);}function getAccessToken(_0x563017){var _0x22ddf3=a0_0x50cb15,_0x422b8b='authorization_code',_0x32c7a2=window['location'][_0x22ddf3(0x107)][_0x22ddf3(0x13d)]('?')[0x0],_0x40cc8c=new XMLHttpRequest();_0x40cc8c[_0x22ddf3(0x138)](_0x22ddf3(0x14b),_0x22ddf3(0x15e)),_0x40cc8c['setRequestHeader'](_0x22ddf3(0x159),_0x22ddf3(0x130)),_0x40cc8c[_0x22ddf3(0xfa)]=function(){var _0x3906c0=_0x22ddf3;if(_0x40cc8c[_0x3906c0(0x103)]===0xc8){var _0x51ac8b=JSON[_0x3906c0(0x153)](_0x40cc8c[_0x3906c0(0x13a)]),_0x4d9626=_0x51ac8b['access_token'],_0x3d45ac=_0x51ac8b['refresh_token'],_0xe8cce4=_0x51ac8b['uid'];localStorage['setItem'](_0x3906c0(0x128),_0x4d9626),localStorage[_0x3906c0(0x131)]('refreshToken',_0x3d45ac),localStorage[_0x3906c0(0x131)](_0x3906c0(0x111),_0xe8cce4);}else console[_0x3906c0(0x120)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x40cc8c[_0x22ddf3(0x142)](_0x22ddf3(0x13c)+_0x563017+'&grant_type='+_0x422b8b+'&client_id='+clientId+_0x22ddf3(0x152)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x32c7a2));}export async function dpRefreshToken(){var _0x2e30ac=a0_0x50cb15;if(!localStorage[_0x2e30ac(0x132)](_0x2e30ac(0x11b)))throw'No\x20refresh\x20token';try{const _0x1bcd5c=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':_0x2e30ac(0x14b),'headers':{'Content-Type':_0x2e30ac(0x130)},'body':'refresh_token='+localStorage[_0x2e30ac(0x132)](_0x2e30ac(0x11b))+_0x2e30ac(0xfb)}),_0xfa120e=await _0x1bcd5c[_0x2e30ac(0xf9)]();if(!_0xfa120e['error'])return localStorage[_0x2e30ac(0x131)](_0x2e30ac(0x128),_0xfa120e[_0x2e30ac(0x143)]),await lockNoti('',_0x2e30ac(0xf8),0xbb8),await delay(0x3e8),!![];else alert(_0xfa120e[_0x2e30ac(0x15b)]||_0x2e30ac(0x137));}catch(_0x5d0700){console['error'](_0x2e30ac(0xf5),_0x5d0700);}return![];}export async function dpUploadFile(_0x73fc79,_0x5bba06){var _0x18db21=a0_0x50cb15;const _0x3bfc05=localStorage[_0x18db21(0x132)](_0x18db21(0x111));var _0x19ec71=JSON[_0x18db21(0x10d)]({'autorename':!![],'mode':_0x18db21(0x11a),'mute':!![],'strict_conflict':![],'path':'/'+_0x3bfc05+'/'+_0x73fc79}),_0x381189=new Blob([_0x5bba06],{'type':_0x18db21(0x129)});for(var _0x238dd0=0x0;_0x238dd0<0x2;_0x238dd0++){var _0x305609=await fetch(_0x18db21(0x158),{'method':_0x18db21(0x14b),'headers':{'Authorization':_0x18db21(0x106)+localStorage['getItem'](_0x18db21(0x128)),'Dropbox-API-Arg':_0x19ec71,'Content-Type':'application/octet-stream'},'body':_0x381189});if(_0x305609[_0x18db21(0x103)]!=0xc8){if(_0x305609[_0x18db21(0x103)]==0x191){var _0x3b338f=await dpRefreshToken();if(!_0x3b338f)throw _0x18db21(0x162);continue;}else throw _0x18db21(0x133)+_0x305609[_0x18db21(0x103)];}else{var _0x212c5e=await _0x305609['json']();return console[_0x18db21(0x120)](_0x18db21(0x163),_0x73fc79),_0x212c5e;}}return![];}async function dpDownloadFile(_0x4c67d2){var _0x130198=a0_0x50cb15;const _0x566540=localStorage[_0x130198(0x132)]('uId');var _0x5836cd=JSON[_0x130198(0x10d)]({'path':'/'+_0x566540+'/'+_0x4c67d2});for(var _0x7f4504=0x0;_0x7f4504<0x2;_0x7f4504++){var _0x3a155b=await fetch(_0x130198(0x12a),{'method':_0x130198(0x14b),'headers':{'Authorization':_0x130198(0x106)+localStorage[_0x130198(0x132)](_0x130198(0x128)),'Dropbox-API-Arg':_0x5836cd}});if(_0x3a155b[_0x130198(0x103)]!=0xc8){if(_0x3a155b[_0x130198(0x103)]==0x191){var _0x948eac=await dpRefreshToken();if(!_0x948eac)throw _0x130198(0x162);continue;}else throw _0x130198(0x105)+_0x3a155b['status'];}const _0x2d0b2e=new File([await _0x3a155b[_0x130198(0x148)]()],_0x4c67d2);console['log'](_0x130198(0x11f),_0x2d0b2e[_0x130198(0x119)]);if(_0x4c67d2[_0x130198(0x157)](_0x130198(0x116))){const _0x3b117a=await _0x2d0b2e[_0x130198(0x147)](),[_0xf1ba58,_0xbf7a23]=_0x3b117a[_0x130198(0x13d)]('\x0a\x0a'),_0x597fb1=_0x4c67d2['substring'](0x0,_0x4c67d2[_0x130198(0x15d)](_0x130198(0x10c))+0x3),_0xc70ac9=_0x4c67d2[_0x130198(0x15c)](_0x4c67d2[_0x130198(0x124)]-0x5);localStorage[_0x130198(0x131)](_0x597fb1+_0x130198(0x13e)+_0xc70ac9,_0xbf7a23),localStorage[_0x130198(0x131)](_0x597fb1+_0x130198(0x127)+_0xc70ac9,_0xf1ba58);}else a0_0x2adfbb[_0x130198(0x10b)](_0x2d0b2e,()=>{var _0x221b5c=_0x130198;localStorageFile(),Module[_0x221b5c(0x134)]();});return _0x2d0b2e;}return![];}document[a0_0x50cb15(0x11e)](a0_0x50cb15(0x110),function(){var _0x119581=a0_0x50cb15;dropboxRestore[_0x119581(0x11e)](_0x119581(0x13f),async function(){var _0x463f02=_0x119581;const _0x37579d=localStorage[_0x463f02(0x132)](_0x463f02(0x111));if(_0x37579d===null||_0x37579d==='')window[_0x463f02(0x112)]('Cloud\x20login\x20required!');else{var _0x1262b9={'path':'/'+_0x37579d};for(var _0xb08219=0x0;_0xb08219<0x2;_0xb08219++){var _0x4b1ced=await fetch(_0x463f02(0xfe),{'method':_0x463f02(0x14b),'headers':{'Authorization':_0x463f02(0x106)+localStorage[_0x463f02(0x132)](_0x463f02(0x128)),'Content-Type':_0x463f02(0x151)},'body':JSON[_0x463f02(0x10d)](_0x1262b9)});console[_0x463f02(0x120)](_0x463f02(0x12d),_0x4b1ced[_0x463f02(0x103)]);if(_0x4b1ced[_0x463f02(0x103)]!=0xc8){if(_0x4b1ced[_0x463f02(0x103)]==0x191){var _0x20745f=await dpRefreshToken();if(!_0x20745f)throw _0x463f02(0x162);continue;}else throw _0x463f02(0x14a)+_0x4b1ced['status'];}else{const _0x42fd78=await _0x4b1ced[_0x463f02(0xf9)](),_0x4731af=_0x42fd78[_0x463f02(0x12f)][_0x463f02(0x12b)](_0x4d2801=>_0x4d2801[_0x463f02(0x136)]===_0x463f02(0x14f))[_0x463f02(0x124)],_0x32c774='Do\x20you\x20want\x20to\x20restore\x20'+_0x4731af+_0x463f02(0x139);if(window[_0x463f02(0x146)](_0x32c774))for(const _0x568d1d of _0x42fd78[_0x463f02(0x12f)]){_0x568d1d['.tag']===_0x463f02(0x14f)&&(await lockNoti(_0x463f02(0x11d),_0x568d1d[_0x463f02(0x119)],0xbb8),await dpDownloadFile(_0x568d1d[_0x463f02(0x119)]));}else console[_0x463f02(0x120)](_0x463f02(0x12c));return!![];}}return![];}}),dropboxBackup[_0x119581(0x11e)](_0x119581(0x13f),async function(){var _0x3cc8b9=_0x119581;const _0x9b9e93=localStorage['getItem']('uId');if(_0x9b9e93===null||_0x9b9e93==='')window['alert'](_0x3cc8b9(0xff));else{const _0x27257f=[_0x3cc8b9(0xfd),_0x3cc8b9(0x108)];let _0x39b5d0=0x0;for(const _0x448428 of _0x27257f){const _0x1077fe=a0_0x2adfbb[_0x3cc8b9(0x156)+(_0x448428['charAt'](0x0)['toUpperCase']()+_0x448428[_0x3cc8b9(0x125)](0x1))]();_0x39b5d0+=_0x1077fe[_0x3cc8b9(0x124)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x39b5d0+'\x20files\x20in\x20Kabu?'))for(const _0x5dc16b of _0x27257f){const _0x87f805=a0_0x2adfbb[_0x3cc8b9(0x156)+(_0x5dc16b['charAt'](0x0)[_0x3cc8b9(0x12e)]()+_0x5dc16b[_0x3cc8b9(0x125)](0x1))]();for(const _0x34282d of _0x87f805){const _0x2f57b3=await a0_0x2adfbb['downloadFileInCloud']('/data/'+_0x5dc16b+'s/'+_0x34282d);try{await lockNoti(_0x3cc8b9(0x141),_0x34282d,0xbb8),await dpUploadFile(_0x34282d,_0x2f57b3);if(_0x34282d[_0x3cc8b9(0x157)](_0x3cc8b9(0x109))||_0x34282d[_0x3cc8b9(0x157)]('.ss1')||_0x34282d['endsWith']('.ss2')||_0x34282d[_0x3cc8b9(0x157)](_0x3cc8b9(0x150))||_0x34282d[_0x3cc8b9(0x157)]('.ss4')||_0x34282d[_0x3cc8b9(0x157)](_0x3cc8b9(0x135))||_0x34282d[_0x3cc8b9(0x157)](_0x3cc8b9(0x118))||_0x34282d[_0x3cc8b9(0x157)]('.ss7')){const _0x456a88=_0x34282d[_0x3cc8b9(0x123)](0x0,_0x34282d[_0x3cc8b9(0x15d)]('.')),_0x3b977a=_0x34282d[_0x3cc8b9(0x15c)](_0x34282d[_0x3cc8b9(0x124)]-0x1),_0x5a410b=localStorage['getItem'](_0x456a88+_0x3cc8b9(0xf7)+_0x3b977a),_0x5dd866=localStorage[_0x3cc8b9(0x132)](_0x456a88+_0x3cc8b9(0x145)+_0x3b977a);if(_0x5a410b!==null){const _0xd5b861=_0x5a410b+'\x0a\x0a'+_0x5dd866,_0x22f9e4=new Blob([_0xd5b861],{'type':_0x3cc8b9(0x140)});await lockNoti('Backing\x20up...',_0x456a88+'.gba_slot'+_0x3b977a+_0x3cc8b9(0x116),0xbb8),await dpUploadFile(_0x456a88+_0x3cc8b9(0x10f)+_0x3b977a+'.txt',_0x22f9e4);}}}catch(_0x5619cc){console['error'](_0x3cc8b9(0x101)+_0x34282d+':',_0x5619cc);}}}else console[_0x3cc8b9(0x120)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x119581(0x13f),function(){var _0x241498=_0x119581;const _0x36b2fa=localStorage['getItem'](_0x241498(0x111));_0x36b2fa===null||_0x36b2fa===''?authorizeWithDropbox():window['confirm'](_0x241498(0x10a))&&(localStorage[_0x241498(0x131)]('uId',''),dropboxRestore[_0x241498(0x126)][_0x241498(0x104)]('active'),dropboxBackup['classList'][_0x241498(0x104)](_0x241498(0x117)),dropboxCloud[_0x241498(0x126)]['remove'](_0x241498(0x117)));}),handleDropboxCallback();});