var a0_0x1175c5=a0_0x17c0;(function(_0x2bc57a,_0x43ae9d){var _0x3cd0ae=a0_0x17c0,_0x3da8a6=_0x2bc57a();while(!![]){try{var _0x2bd5b1=parseInt(_0x3cd0ae(0x19a))/0x1+-parseInt(_0x3cd0ae(0x190))/0x2+parseInt(_0x3cd0ae(0x16f))/0x3+-parseInt(_0x3cd0ae(0x177))/0x4*(parseInt(_0x3cd0ae(0x187))/0x5)+-parseInt(_0x3cd0ae(0x13f))/0x6+parseInt(_0x3cd0ae(0x159))/0x7*(parseInt(_0x3cd0ae(0x171))/0x8)+parseInt(_0x3cd0ae(0x14f))/0x9;if(_0x2bd5b1===_0x43ae9d)break;else _0x3da8a6['push'](_0x3da8a6['shift']());}catch(_0x11a1ca){_0x3da8a6['push'](_0x3da8a6['shift']());}}}(a0_0x3c18,0xb0976));import*as a0_0x38ccbe from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x1175c5(0x172),clientSecret=a0_0x1175c5(0x195);function authorizeWithDropbox(){var _0x44fec7=a0_0x1175c5,_0xefb913=window['location']['href'][_0x44fec7(0x165)]('?')[0x0],_0x436c3f=_0x44fec7(0x16b),_0xafc015='offline',_0x1fcd42=_0x44fec7(0x19b)+clientId+_0x44fec7(0x175)+_0x436c3f+_0x44fec7(0x17d)+_0xafc015+_0x44fec7(0x149)+encodeURIComponent(_0xefb913);window[_0x44fec7(0x19e)][_0x44fec7(0x186)]=_0x1fcd42;}function a0_0x3c18(){var _0x4d69a0=['1660088lXRthO','knh3uz2mx2hp2eu','confirm','.txt','&response_type=','save','1220pLACqc','https://content.dropboxapi.com/2/files/download','Do\x20not\x20receive\x20authorization','.gba_imageState','blob','Bearer\x20','&token_access_type=','slice','https://api.dropbox.com/oauth2/token','/data/','addEventListener','application/x-www-form-urlencoded','getItem','application/octet-stream','Cloud\x20login\x20required!','href','9005qMFyDO','FSSync','Download\x20failed,\x20unknown\x20http\x20status:\x20','remove','parse','send','endsWith','refreshToken','.ss3','372378hOTyzm','exec','setItem','https://api.dropboxapi.com/oauth2/token','status','nwb3dnfh09rhs31','Unable\x20to\x20refresh\x20token','.ss7','accessToken','list','777539wIdIss','https://www.dropbox.com/oauth2/authorize?client_id=','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','.gba_dateState','location','toUpperCase','code=','downloadFileInCloud','gba','log','Failed\x20to\x20refresh\x20Dropbox\x20token.','refresh_token=','.ss2','search','uploadSaveOrSaveState','name','8458176yQtDgL','click','Download\x20failed,\x20unknown\x20http\x20status:','active','[\x5c?&#]','Do\x20you\x20want\x20to\x20restore\x20','.ss1','.ss0','https://api.dropboxapi.com/2/files/list_folder','lastIndexOf','&redirect_uri=','Error\x20while\x20refreshing\x20token:','=([^&#]*)','stringify','json','uid','4769280FWhlgG','.gba_slot','.ss6','substring','Authorization\x20Code:','authorization_code','replace','charAt','overwrite','_dateState','14ryXlXo','uId','Restoring...','alert','_imageState','access_token','error','application/json','filter','POST','file','text/plain','split','entries','length','.tag','Kabu\x20storage\x20↦\x20Cloud\x20◆','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','code','DOMContentLoaded','Backing\x20up...','.ss5','3438081pNAtoa','classList'];a0_0x3c18=function(){return _0x4d69a0;};return a0_0x3c18();}function handleDropboxCallback(){var _0x369661=a0_0x1175c5,_0x2a07cb=getUrlParameter(_0x369661(0x16b));_0x2a07cb?(getAccessToken(_0x2a07cb),console[_0x369661(0x1a3)](_0x369661(0x153),_0x2a07cb)):console[_0x369661(0x1a3)](_0x369661(0x179));}function getUrlParameter(_0x5d1b2d){var _0x728970=a0_0x1175c5;_0x5d1b2d=_0x5d1b2d[_0x728970(0x155)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x2d4246=new RegExp(_0x728970(0x143)+_0x5d1b2d+_0x728970(0x14b)),_0x3dfc2c=_0x2d4246[_0x728970(0x191)](location[_0x728970(0x13c)]);return _0x3dfc2c===null?'':decodeURIComponent(_0x3dfc2c[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x4311da){var _0x2b4367=a0_0x1175c5,_0x398f71=_0x2b4367(0x154),_0x1757cf=window['location'][_0x2b4367(0x186)]['split']('?')[0x0],_0xc2ae25=new XMLHttpRequest();_0xc2ae25['open'](_0x2b4367(0x162),_0x2b4367(0x17f)),_0xc2ae25['setRequestHeader']('Content-Type',_0x2b4367(0x182)),_0xc2ae25['onload']=function(){var _0x3433d4=_0x2b4367;if(_0xc2ae25['status']===0xc8){var _0x2123cf=JSON[_0x3433d4(0x18b)](_0xc2ae25['responseText']),_0x3f18f5=_0x2123cf[_0x3433d4(0x15e)],_0x4e70b5=_0x2123cf['refresh_token'],_0x38761f=_0x2123cf[_0x3433d4(0x14e)];localStorage[_0x3433d4(0x192)](_0x3433d4(0x198),_0x3f18f5),localStorage[_0x3433d4(0x192)](_0x3433d4(0x18e),_0x4e70b5),localStorage[_0x3433d4(0x192)](_0x3433d4(0x15a),_0x38761f);}else console[_0x3433d4(0x1a3)](_0x3433d4(0x19c));},_0xc2ae25[_0x2b4367(0x18c)](_0x2b4367(0x1a0)+_0x4311da+'&grant_type='+_0x398f71+'&client_id='+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0x1757cf));}export async function dpRefreshToken(){var _0xbf293c=a0_0x1175c5;if(!localStorage['getItem'](_0xbf293c(0x18e)))throw'No\x20refresh\x20token';try{const _0x1b6854=await fetch(_0xbf293c(0x193),{'method':_0xbf293c(0x162),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0xbf293c(0x1a5)+localStorage[_0xbf293c(0x183)](_0xbf293c(0x18e))+_0xbf293c(0x16a)}),_0x2de5c8=await _0x1b6854[_0xbf293c(0x14d)]();if(!_0x2de5c8['error'])return localStorage[_0xbf293c(0x192)](_0xbf293c(0x198),_0x2de5c8[_0xbf293c(0x15e)]),await lockNoti('','Refreshing\x20token...',0xbb8),await delay(0x3e8),!![];else alert(_0x2de5c8['error_description']||_0xbf293c(0x1a4));}catch(_0x303ffe){console[_0xbf293c(0x15f)](_0xbf293c(0x14a),_0x303ffe);}return![];}export async function dpUploadFile(_0x56de62,_0xa6c0bd){var _0x547629=a0_0x1175c5;const _0x5c8950=localStorage[_0x547629(0x183)](_0x547629(0x15a));var _0x1de98f=JSON[_0x547629(0x14c)]({'autorename':!![],'mode':_0x547629(0x157),'mute':!![],'strict_conflict':![],'path':'/'+_0x5c8950+'/'+_0x56de62}),_0x27b22c=new Blob([_0xa6c0bd],{'type':_0x547629(0x184)});for(var _0x18d7d1=0x0;_0x18d7d1<0x2;_0x18d7d1++){var _0x4cbc40=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x547629(0x162),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x547629(0x183)](_0x547629(0x198)),'Dropbox-API-Arg':_0x1de98f,'Content-Type':'application/octet-stream'},'body':_0x27b22c});if(_0x4cbc40[_0x547629(0x194)]!=0xc8){if(_0x4cbc40[_0x547629(0x194)]==0x191){var _0x3ab90f=await dpRefreshToken();if(!_0x3ab90f)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x4cbc40[_0x547629(0x194)];}else{var _0xbfb3c0=await _0x4cbc40[_0x547629(0x14d)]();return console[_0x547629(0x1a3)](_0x547629(0x169),_0x56de62),_0xbfb3c0;}}return![];}function a0_0x17c0(_0x59e691,_0x3d9516){var _0x3c18ff=a0_0x3c18();return a0_0x17c0=function(_0x17c007,_0x229310){_0x17c007=_0x17c007-0x13c;var _0x2371e0=_0x3c18ff[_0x17c007];return _0x2371e0;},a0_0x17c0(_0x59e691,_0x3d9516);}async function dpDownloadFile(_0x52ba71){var _0xa8f983=a0_0x1175c5;const _0x370bf1=localStorage['getItem'](_0xa8f983(0x15a));var _0x184794=JSON[_0xa8f983(0x14c)]({'path':'/'+_0x370bf1+'/'+_0x52ba71});for(var _0x2b93c6=0x0;_0x2b93c6<0x2;_0x2b93c6++){var _0x4c3976=await fetch(_0xa8f983(0x178),{'method':_0xa8f983(0x162),'headers':{'Authorization':_0xa8f983(0x17c)+localStorage[_0xa8f983(0x183)](_0xa8f983(0x198)),'Dropbox-API-Arg':_0x184794}});if(_0x4c3976[_0xa8f983(0x194)]!=0xc8){if(_0x4c3976[_0xa8f983(0x194)]==0x191){var _0x26e243=await dpRefreshToken();if(!_0x26e243)throw _0xa8f983(0x196);continue;}else throw _0xa8f983(0x141)+_0x4c3976[_0xa8f983(0x194)];}const _0x4c20ba=new File([await _0x4c3976[_0xa8f983(0x17b)]()],_0x52ba71);console[_0xa8f983(0x1a3)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x4c20ba['name']);if(_0x52ba71[_0xa8f983(0x18d)]('.txt')){const _0x30716f=await _0x4c20ba['text'](),[_0x3a7236,_0x41c57f]=_0x30716f[_0xa8f983(0x165)]('\x0a\x0a'),_0x333bf4=_0x52ba71[_0xa8f983(0x152)](0x0,_0x52ba71[_0xa8f983(0x148)](_0xa8f983(0x1a2))+0x3),_0x5dfe84=_0x52ba71[_0xa8f983(0x156)](_0x52ba71[_0xa8f983(0x167)]-0x5);localStorage[_0xa8f983(0x192)](_0x333bf4+_0xa8f983(0x158)+_0x5dfe84,_0x41c57f),localStorage[_0xa8f983(0x192)](_0x333bf4+_0xa8f983(0x15d)+_0x5dfe84,_0x3a7236);}else a0_0x38ccbe[_0xa8f983(0x13d)](_0x4c20ba,()=>{var _0x433b56=_0xa8f983;localStorageFile(),Module[_0x433b56(0x188)]();});return _0x4c20ba;}return![];}document[a0_0x1175c5(0x181)](a0_0x1175c5(0x16c),function(){var _0x261d80=a0_0x1175c5;dropboxRestore['addEventListener']('click',async function(){var _0x106c5c=a0_0x17c0;const _0x232ffc=localStorage[_0x106c5c(0x183)](_0x106c5c(0x15a));if(_0x232ffc===null||_0x232ffc==='')window[_0x106c5c(0x15c)](_0x106c5c(0x185));else{var _0x5ac8e5={'path':'/'+_0x232ffc};for(var _0x21646b=0x0;_0x21646b<0x2;_0x21646b++){var _0x48e5c5=await fetch(_0x106c5c(0x147),{'method':_0x106c5c(0x162),'headers':{'Authorization':_0x106c5c(0x17c)+localStorage[_0x106c5c(0x183)](_0x106c5c(0x198)),'Content-Type':_0x106c5c(0x160)},'body':JSON[_0x106c5c(0x14c)](_0x5ac8e5)});console[_0x106c5c(0x1a3)]('status:\x20',_0x48e5c5['status']);if(_0x48e5c5[_0x106c5c(0x194)]!=0xc8){if(_0x48e5c5[_0x106c5c(0x194)]==0x191){var _0x53769b=await dpRefreshToken();if(!_0x53769b)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x106c5c(0x189)+_0x48e5c5[_0x106c5c(0x194)];}else{const _0x448877=await _0x48e5c5['json'](),_0x2ac140=_0x448877[_0x106c5c(0x166)][_0x106c5c(0x161)](_0x4a297a=>_0x4a297a[_0x106c5c(0x168)]===_0x106c5c(0x163))[_0x106c5c(0x167)],_0x415942=_0x106c5c(0x144)+_0x2ac140+'\x20files\x20in\x20Cloud?';if(window[_0x106c5c(0x173)](_0x415942))for(const _0x125482 of _0x448877[_0x106c5c(0x166)]){_0x125482[_0x106c5c(0x168)]===_0x106c5c(0x163)&&(await lockNoti(_0x106c5c(0x15b),_0x125482[_0x106c5c(0x13e)],0xbb8),await dpDownloadFile(_0x125482['name']));}else console['log']('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup[_0x261d80(0x181)]('click',async function(){var _0x328549=_0x261d80;const _0x35c0c2=localStorage[_0x328549(0x183)](_0x328549(0x15a));if(_0x35c0c2===null||_0x35c0c2==='')window[_0x328549(0x15c)]('Cloud\x20login\x20required!');else{const _0x1c1b71=['state',_0x328549(0x176)];let _0x2a7fd0=0x0;for(const _0x21004d of _0x1c1b71){const _0x183d39=a0_0x38ccbe[_0x328549(0x199)+(_0x21004d[_0x328549(0x156)](0x0)[_0x328549(0x19f)]()+_0x21004d['slice'](0x1))]();_0x2a7fd0+=_0x183d39[_0x328549(0x167)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x2a7fd0+'\x20files\x20in\x20Kabu?'))for(const _0x2de115 of _0x1c1b71){const _0x3f6e57=a0_0x38ccbe[_0x328549(0x199)+(_0x2de115[_0x328549(0x156)](0x0)[_0x328549(0x19f)]()+_0x2de115[_0x328549(0x17e)](0x1))]();for(const _0x302e96 of _0x3f6e57){const _0x4678e3=await a0_0x38ccbe[_0x328549(0x1a1)](_0x328549(0x180)+_0x2de115+'s/'+_0x302e96);try{await lockNoti(_0x328549(0x16d),_0x302e96,0xbb8),await dpUploadFile(_0x302e96,_0x4678e3);if(_0x302e96['endsWith'](_0x328549(0x146))||_0x302e96['endsWith'](_0x328549(0x145))||_0x302e96[_0x328549(0x18d)](_0x328549(0x1a6))||_0x302e96[_0x328549(0x18d)](_0x328549(0x18f))||_0x302e96[_0x328549(0x18d)]('.ss4')||_0x302e96['endsWith'](_0x328549(0x16e))||_0x302e96[_0x328549(0x18d)](_0x328549(0x151))||_0x302e96[_0x328549(0x18d)](_0x328549(0x197))){const _0x3991aa=_0x302e96['substring'](0x0,_0x302e96[_0x328549(0x148)]('.')),_0x30cc08=_0x302e96[_0x328549(0x156)](_0x302e96[_0x328549(0x167)]-0x1),_0x5731eb=localStorage[_0x328549(0x183)](_0x3991aa+_0x328549(0x17a)+_0x30cc08),_0x5c3784=localStorage[_0x328549(0x183)](_0x3991aa+_0x328549(0x19d)+_0x30cc08);if(_0x5731eb!==null){const _0x2bca32=_0x5731eb+'\x0a\x0a'+_0x5c3784,_0x17e8eb=new Blob([_0x2bca32],{'type':_0x328549(0x164)});await lockNoti(_0x328549(0x16d),_0x3991aa+_0x328549(0x150)+_0x30cc08+_0x328549(0x174),0xbb8),await dpUploadFile(_0x3991aa+'.gba_slot'+_0x30cc08+_0x328549(0x174),_0x17e8eb);}}}catch(_0xe351a4){console['error']('Failed\x20to\x20upload\x20file\x20'+_0x302e96+':',_0xe351a4);}}}else console[_0x328549(0x1a3)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x261d80(0x181)](_0x261d80(0x140),function(){var _0x429385=_0x261d80;const _0xd49495=localStorage[_0x429385(0x183)](_0x429385(0x15a));_0xd49495===null||_0xd49495===''?authorizeWithDropbox():window[_0x429385(0x173)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x429385(0x192)](_0x429385(0x15a),''),dropboxRestore[_0x429385(0x170)][_0x429385(0x18a)](_0x429385(0x142)),dropboxBackup['classList']['remove']('active'),dropboxCloud['classList'][_0x429385(0x18a)](_0x429385(0x142)));}),handleDropboxCallback();});