var a0_0x2d85dd=a0_0x505a;(function(_0x43c5d9,_0xd56a12){var _0x17476a=a0_0x505a,_0x4d284e=_0x43c5d9();while(!![]){try{var _0x30f1d6=-parseInt(_0x17476a(0x217))/0x1*(-parseInt(_0x17476a(0x237))/0x2)+parseInt(_0x17476a(0x1f2))/0x3+parseInt(_0x17476a(0x230))/0x4+-parseInt(_0x17476a(0x1e9))/0x5+-parseInt(_0x17476a(0x232))/0x6*(parseInt(_0x17476a(0x209))/0x7)+parseInt(_0x17476a(0x1ef))/0x8*(parseInt(_0x17476a(0x1ff))/0x9)+parseInt(_0x17476a(0x22b))/0xa*(-parseInt(_0x17476a(0x1fa))/0xb);if(_0x30f1d6===_0xd56a12)break;else _0x4d284e['push'](_0x4d284e['shift']());}catch(_0x576ddb){_0x4d284e['push'](_0x4d284e['shift']());}}}(a0_0xc9e1,0x9acae));import*as a0_0x27f73b from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2d85dd(0x1fb),clientSecret=a0_0x2d85dd(0x20d);function a0_0xc9e1(){var _0x29ae2d=['Upload\x20failed,\x20unknown\x20http\x20status:\x20','https://content.dropboxapi.com/2/files/download','&client_id=','setItem','json','filter','Failed\x20to\x20refresh\x20Dropbox\x20token.','uploadFileInCloud','getItem','application/octet-stream','name','search','1373940DxbDJp','Authorization\x20Code:','error_description','https://api.dropboxapi.com/2/files/create_folder_v2','alert','classList','8gKrLyj','refresh_token','location','1194231gVJDgD','&client_secret=','stringify','.tag','Do\x20you\x20want\x20to\x20logout?','Do\x20you\x20want\x20to\x20backup\x20','Do\x20you\x20want\x20to\x20restore\x20','exec','2024979iesLcw','knh3uz2mx2hp2eu','parse','code','accessToken','10714959PfvXhT','error','status','No\x20refresh\x20token','Refreshing\x20token...','file','replace','Error\x20while\x20refreshing\x20token:','active','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','42jrOFOD','uid','remove','uId','nwb3dnfh09rhs31','\x20files\x20in\x20Kabu?','charAt','offline','length','Cloud\x20↦\x20Kabu\x20storage\x20◆','split','confirm','href','application/json','67gKwNLN','Content-Type','https://www.dropbox.com/oauth2/authorize?client_id=','open','state','Download\x20failed\x20for\x20','setRequestHeader','entries','/data/','[\x5c?&#]','\x20files\x20from\x20Cloud?','https://api.dropbox.com/oauth2/token','https://api.dropboxapi.com/oauth2/token','application/x-www-form-urlencoded','&redirect_uri=','Failed\x20to\x20upload\x20file\x20','downloadFileInCloud','folder','authorization_code','screenshot','60qoUuOt','No\x20files\x20found\x20to\x20restore.','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Backing\x20up...','Bearer\x20','4197432oqEfpe','slice','1099932afkHtY','=([^&#]*)','access_token','click',',\x20status:\x20','14188OYNHXN','Unable\x20to\x20refresh\x20token','POST','list','addEventListener','Download\x20failed,\x20unknown\x20http\x20status:','DOMContentLoaded','refreshToken','blob','https://api.dropboxapi.com/2/files/list_folder','Do\x20not\x20receive\x20authorization','log','save','Wait\x20a\x20little\x20bit...'];a0_0xc9e1=function(){return _0x29ae2d;};return a0_0xc9e1();}function authorizeWithDropbox(){var _0x5a4ed9=a0_0x2d85dd,_0x410124=window[_0x5a4ed9(0x1f1)][_0x5a4ed9(0x215)][_0x5a4ed9(0x213)]('?')[0x0],_0x25c7f4=_0x5a4ed9(0x1fd),_0x302dd3=_0x5a4ed9(0x210),_0x1ef61c=_0x5a4ed9(0x219)+clientId+'&response_type='+_0x25c7f4+'&token_access_type='+_0x302dd3+_0x5a4ed9(0x225)+encodeURIComponent(_0x410124);window['location'][_0x5a4ed9(0x215)]=_0x1ef61c;}function handleDropboxCallback(){var _0x117151=a0_0x2d85dd,_0x152482=getUrlParameter('code');_0x152482?(getAccessToken(_0x152482),console[_0x117151(0x242)](_0x117151(0x1ea),_0x152482)):console['log'](_0x117151(0x241));}function a0_0x505a(_0x17b040,_0x3d2f33){var _0xc9e1dc=a0_0xc9e1();return a0_0x505a=function(_0x505ac5,_0x1263b4){_0x505ac5=_0x505ac5-0x1e6;var _0x551575=_0xc9e1dc[_0x505ac5];return _0x551575;},a0_0x505a(_0x17b040,_0x3d2f33);}function getUrlParameter(_0x232b32){var _0x20c3cd=a0_0x2d85dd;_0x232b32=_0x232b32[_0x20c3cd(0x205)](/[\[]/,'\x5c[')[_0x20c3cd(0x205)](/[\]]/,'\x5c]');var _0xc456b9=new RegExp(_0x20c3cd(0x220)+_0x232b32+_0x20c3cd(0x233)),_0x4e2e1e=_0xc456b9[_0x20c3cd(0x1f9)](location[_0x20c3cd(0x1e8)]);return _0x4e2e1e===null?'':decodeURIComponent(_0x4e2e1e[0x1][_0x20c3cd(0x205)](/\+/g,'\x20'));}function getAccessToken(_0x1f4322){var _0xe8212d=a0_0x2d85dd,_0x14b375=_0xe8212d(0x229),_0x2d3797=window['location'][_0xe8212d(0x215)][_0xe8212d(0x213)]('?')[0x0],_0x56445b=new XMLHttpRequest();_0x56445b[_0xe8212d(0x21a)](_0xe8212d(0x239),_0xe8212d(0x222)),_0x56445b[_0xe8212d(0x21d)](_0xe8212d(0x218),_0xe8212d(0x224)),_0x56445b['onload']=function(){var _0x2febff=_0xe8212d;if(_0x56445b['status']===0xc8){var _0xc12c79=JSON[_0x2febff(0x1fc)](_0x56445b['responseText']),_0x1b30e9=_0xc12c79[_0x2febff(0x234)],_0x4e39d3=_0xc12c79[_0x2febff(0x1f0)],_0x25c8f3=_0xc12c79[_0x2febff(0x20a)];localStorage[_0x2febff(0x248)](_0x2febff(0x1fe),_0x1b30e9),localStorage['setItem'](_0x2febff(0x23e),_0x4e39d3),localStorage['setItem'](_0x2febff(0x20c),_0x25c8f3);}else console['log'](_0x2febff(0x208));},_0x56445b['send']('code='+_0x1f4322+'&grant_type='+_0x14b375+_0xe8212d(0x247)+clientId+_0xe8212d(0x1f3)+clientSecret+_0xe8212d(0x225)+encodeURIComponent(_0x2d3797));}export async function dpCreateFolder(_0x6302f0){var _0x57ba35=a0_0x2d85dd;const _0x473a11=localStorage['getItem'](_0x57ba35(0x20c));let _0x644fa1=localStorage[_0x57ba35(0x24d)](_0x57ba35(0x1fe));const _0x26ac3c='/'+_0x473a11+'/'+_0x6302f0,_0x370af2=JSON[_0x57ba35(0x1f4)]({'path':_0x26ac3c,'autorename':![]});for(let _0x50f3a7=0x0;_0x50f3a7<0x2;_0x50f3a7++){try{const _0x1b6aee=await fetch(_0x57ba35(0x1ec),{'method':_0x57ba35(0x239),'headers':{'Authorization':'Bearer\x20'+_0x644fa1,'Content-Type':_0x57ba35(0x216)},'body':_0x370af2});if(_0x1b6aee[_0x57ba35(0x201)]===0x191){const _0x1e5682=await dpRefreshToken();if(!_0x1e5682)throw new Error(_0x57ba35(0x238));_0x644fa1=localStorage[_0x57ba35(0x24d)]('accessToken');continue;}if(_0x1b6aee[_0x57ba35(0x201)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x6302f0};if(!_0x1b6aee['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x6302f0);const _0x4ed022=await _0x1b6aee[_0x57ba35(0x249)]();return await lockNoti('Folder\x20created','',0xbb8),_0x4ed022;}catch(_0x2ed021){if(_0x50f3a7===0x1)throw _0x2ed021;}}return![];}export async function dpRefreshToken(){var _0x47bf67=a0_0x2d85dd;if(!localStorage[_0x47bf67(0x24d)](_0x47bf67(0x23e)))throw _0x47bf67(0x202);try{const _0x801f3e=await fetch(_0x47bf67(0x223),{'method':_0x47bf67(0x239),'headers':{'Content-Type':_0x47bf67(0x224)},'body':'refresh_token='+localStorage[_0x47bf67(0x24d)]('refreshToken')+_0x47bf67(0x22d)}),_0x596fd6=await _0x801f3e[_0x47bf67(0x249)]();if(!_0x596fd6['error'])return localStorage['setItem']('accessToken',_0x596fd6[_0x47bf67(0x234)]),await lockNoti(_0x47bf67(0x203),'',0xbb8),await delay(0x3e8),!![];else alert(_0x596fd6[_0x47bf67(0x1eb)]||_0x47bf67(0x24b));}catch(_0x1c0d99){console[_0x47bf67(0x200)](_0x47bf67(0x206),_0x1c0d99);}return![];}export async function dpUploadFile(_0x22cb98,_0x5223d0,_0x4698ab){var _0xc46a6f=a0_0x2d85dd;const _0x30eb64=localStorage[_0xc46a6f(0x24d)]('uId');var _0x2592c3=JSON[_0xc46a6f(0x1f4)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x30eb64+'/'+_0x4698ab+'/'+_0x22cb98}),_0x138239=new Blob([_0x5223d0],{'type':_0xc46a6f(0x1e6)});for(var _0x1f58a6=0x0;_0x1f58a6<0x2;_0x1f58a6++){var _0x4b30d4=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0xc46a6f(0x239),'headers':{'Authorization':_0xc46a6f(0x22f)+localStorage['getItem'](_0xc46a6f(0x1fe)),'Dropbox-API-Arg':_0x2592c3,'Content-Type':_0xc46a6f(0x1e6)},'body':_0x138239});if(_0x4b30d4[_0xc46a6f(0x201)]!=0xc8){if(_0x4b30d4[_0xc46a6f(0x201)]==0x191){var _0x438aef=await dpRefreshToken();if(!_0x438aef)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0xc46a6f(0x245)+_0x4b30d4[_0xc46a6f(0x201)];}else{var _0x39a7ac=await _0x4b30d4[_0xc46a6f(0x249)]();return console[_0xc46a6f(0x242)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x22cb98),_0x39a7ac;}}return![];}export async function dpDownloadFile(_0x410bfc,_0xcde704){var _0x11d8ff=a0_0x2d85dd;const _0x5b9a3d=localStorage['getItem'](_0x11d8ff(0x20c));var _0x873fff=JSON[_0x11d8ff(0x1f4)]({'path':'/'+_0x5b9a3d+'/'+_0xcde704+'/'+_0x410bfc});for(var _0xec9227=0x0;_0xec9227<0x2;_0xec9227++){var _0x11930f=await fetch(_0x11d8ff(0x246),{'method':'POST','headers':{'Authorization':_0x11d8ff(0x22f)+localStorage[_0x11d8ff(0x24d)]('accessToken'),'Dropbox-API-Arg':_0x873fff}});if(_0x11930f[_0x11d8ff(0x201)]!=0xc8){if(_0x11930f[_0x11d8ff(0x201)]==0x191){var _0x57111f=await dpRefreshToken();if(!_0x57111f)throw _0x11d8ff(0x238);continue;}else throw _0x11d8ff(0x23c)+_0x11930f['status'];}const _0x5c121a=new File([await _0x11930f[_0x11d8ff(0x23f)]()],_0x410bfc);return console[_0x11d8ff(0x242)](_0x11d8ff(0x212),_0x5c121a[_0x11d8ff(0x1e7)]),a0_0x27f73b[_0x11d8ff(0x24c)](_0x5c121a,()=>{}),_0x5c121a;}return![];}document[a0_0x2d85dd(0x23b)](a0_0x2d85dd(0x23d),function(){var _0x4a049a=a0_0x2d85dd;dropboxRestore[_0x4a049a(0x23b)]('click',async function(){var _0x583832=_0x4a049a;await lockNoti(_0x583832(0x244),'',0x1388);const _0x33e45b=localStorage['getItem']('uId'),_0x3253ea=[_0x583832(0x21b),_0x583832(0x243),_0x583832(0x22a)];if(!_0x33e45b){window['alert']('Cloud\x20login\x20required!');return;}let _0x27f540=[];for(const _0x442bd5 of _0x3253ea){let _0x371337={'path':'/'+_0x33e45b+'/'+_0x442bd5};for(let _0x4cd847=0x0;_0x4cd847<0x2;_0x4cd847++){let _0xe997=await fetch(_0x583832(0x240),{'method':_0x583832(0x239),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x583832(0x24d)](_0x583832(0x1fe)),'Content-Type':'application/json'},'body':JSON['stringify'](_0x371337)});if(_0xe997['status']===0xc8){let _0x3ab460=await _0xe997['json'](),_0x182c03=_0x3ab460[_0x583832(0x21e)][_0x583832(0x24a)](_0x12826b=>_0x12826b[_0x583832(0x1f5)]===_0x583832(0x204));_0x182c03[_0x583832(0x211)]>0x0&&_0x27f540['push'](..._0x182c03['map'](_0x54a072=>({'name':_0x54a072[_0x583832(0x1e7)],'folder':_0x442bd5})));break;}else{if(_0xe997[_0x583832(0x201)]===0x191){let _0x31435f=await dpRefreshToken();if(!_0x31435f)throw'Unable\x20to\x20refresh\x20token';}else{console['error'](_0x583832(0x21c)+_0x442bd5+_0x583832(0x236)+_0xe997[_0x583832(0x201)]);break;}}}}if(_0x27f540[_0x583832(0x211)]>0x0){const _0x22205b=_0x583832(0x1f8)+_0x27f540[_0x583832(0x211)]+_0x583832(0x221);if(window[_0x583832(0x214)](_0x22205b))for(const _0x5c1adf of _0x27f540){await lockNoti('Restoring...',_0x5c1adf[_0x583832(0x1e7)],0xbb8),await dpDownloadFile(_0x5c1adf[_0x583832(0x1e7)],_0x5c1adf[_0x583832(0x228)]);}else console[_0x583832(0x242)]('Restore\x20canceled\x20by\x20user.');}else console[_0x583832(0x242)](_0x583832(0x22c));}),dropboxBackup[_0x4a049a(0x23b)](_0x4a049a(0x235),async function(){var _0x51eec3=_0x4a049a;await lockNoti(_0x51eec3(0x244),'',0x1388);const _0x598711=localStorage[_0x51eec3(0x24d)]('uId');if(_0x598711===null||_0x598711==='')window[_0x51eec3(0x1ed)]('Cloud\x20login\x20required!');else{const _0x49086e=[_0x51eec3(0x21b),_0x51eec3(0x243),_0x51eec3(0x22a)];for(const _0x3e18a1 of _0x49086e){await dpCreateFolder(_0x3e18a1);}let _0x1932cc=0x0;for(const _0x190a2f of _0x49086e){const _0x8775f2=a0_0x27f73b['list'+(_0x190a2f[_0x51eec3(0x20f)](0x0)['toUpperCase']()+_0x190a2f[_0x51eec3(0x231)](0x1))]();_0x1932cc+=_0x8775f2[_0x51eec3(0x211)];}if(window[_0x51eec3(0x214)](_0x51eec3(0x1f7)+_0x1932cc+_0x51eec3(0x20e)))for(const _0x467b88 of _0x49086e){const _0x23e488=a0_0x27f73b[_0x51eec3(0x23a)+(_0x467b88[_0x51eec3(0x20f)](0x0)['toUpperCase']()+_0x467b88[_0x51eec3(0x231)](0x1))]();for(const _0x13ad3c of _0x23e488){const _0x531fcf=await a0_0x27f73b[_0x51eec3(0x227)](_0x51eec3(0x21f)+_0x467b88+'s/'+_0x13ad3c);try{await lockNoti(_0x51eec3(0x22e),_0x13ad3c,0xbb8),await dpUploadFile(_0x13ad3c,_0x531fcf,_0x467b88);}catch(_0x802dc8){console[_0x51eec3(0x200)](_0x51eec3(0x226)+_0x13ad3c+':',_0x802dc8);}}}else console[_0x51eec3(0x242)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x4a049a(0x23b)](_0x4a049a(0x235),function(){var _0x67f19e=_0x4a049a;const _0x2b2ba0=localStorage[_0x67f19e(0x24d)](_0x67f19e(0x20c));_0x2b2ba0===null||_0x2b2ba0===''?authorizeWithDropbox():window[_0x67f19e(0x214)](_0x67f19e(0x1f6))&&(localStorage['setItem'](_0x67f19e(0x20c),''),dropboxRestore['classList'][_0x67f19e(0x20b)](_0x67f19e(0x207)),dropboxBackup[_0x67f19e(0x1ee)]['remove'](_0x67f19e(0x207)),dropboxCloud[_0x67f19e(0x1ee)][_0x67f19e(0x20b)](_0x67f19e(0x207)));}),handleDropboxCallback();});