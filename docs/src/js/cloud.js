var a0_0x22eaac=a0_0x5716;(function(_0x5b702d,_0x228c7b){var _0x2d5b03=a0_0x5716,_0x1941cf=_0x5b702d();while(!![]){try{var _0x1dda00=-parseInt(_0x2d5b03(0x104))/0x1+parseInt(_0x2d5b03(0xf2))/0x2+parseInt(_0x2d5b03(0x119))/0x3*(parseInt(_0x2d5b03(0x120))/0x4)+parseInt(_0x2d5b03(0x10e))/0x5+parseInt(_0x2d5b03(0x116))/0x6+-parseInt(_0x2d5b03(0x11c))/0x7+-parseInt(_0x2d5b03(0x14c))/0x8;if(_0x1dda00===_0x228c7b)break;else _0x1941cf['push'](_0x1941cf['shift']());}catch(_0x29504b){_0x1941cf['push'](_0x1941cf['shift']());}}}(a0_0x4f18,0x57662));import*as a0_0xfc70dc from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x22eaac(0x135),clientSecret=a0_0x22eaac(0x10a);function authorizeWithDropbox(){var _0x45ed0b=a0_0x22eaac,_0x2d8907=window[_0x45ed0b(0x112)][_0x45ed0b(0x110)][_0x45ed0b(0x13f)]('?')[0x0],_0x530473=_0x45ed0b(0xf4),_0x24f422=_0x45ed0b(0x10b),_0x26ba11=_0x45ed0b(0x126)+clientId+_0x45ed0b(0x123)+_0x530473+_0x45ed0b(0x10f)+_0x24f422+'&redirect_uri='+encodeURIComponent(_0x2d8907);window[_0x45ed0b(0x112)][_0x45ed0b(0x110)]=_0x26ba11;}function handleDropboxCallback(){var _0x5af86a=a0_0x22eaac,_0x337782=getUrlParameter(_0x5af86a(0xf4));_0x337782?(getAccessToken(_0x337782),console[_0x5af86a(0x14a)](_0x5af86a(0xf9),_0x337782)):console['log']('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x3d0d07){var _0x2d1216=a0_0x22eaac;_0x3d0d07=_0x3d0d07['replace'](/[\[]/,'\x5c[')[_0x2d1216(0x12c)](/[\]]/,'\x5c]');var _0x1f8b08=new RegExp(_0x2d1216(0x122)+_0x3d0d07+_0x2d1216(0x100)),_0x582cb6=_0x1f8b08[_0x2d1216(0x14b)](location[_0x2d1216(0xed)]);return _0x582cb6===null?'':decodeURIComponent(_0x582cb6[0x1][_0x2d1216(0x12c)](/\+/g,'\x20'));}function getAccessToken(_0x683af9){var _0x1b4bb1=a0_0x22eaac,_0x187dd1=_0x1b4bb1(0x13c),_0x3be50a=window[_0x1b4bb1(0x112)][_0x1b4bb1(0x110)][_0x1b4bb1(0x13f)]('?')[0x0],_0x104410=new XMLHttpRequest();_0x104410[_0x1b4bb1(0xee)]('POST','https://api.dropbox.com/oauth2/token'),_0x104410[_0x1b4bb1(0x145)]('Content-Type','application/x-www-form-urlencoded'),_0x104410[_0x1b4bb1(0xfc)]=function(){var _0x5f1df2=_0x1b4bb1;if(_0x104410[_0x5f1df2(0x12d)]===0xc8){var _0x251351=JSON[_0x5f1df2(0x115)](_0x104410['responseText']),_0x15e768=_0x251351['access_token'],_0x4ec393=_0x251351[_0x5f1df2(0x13e)],_0x5e3bc2=_0x251351[_0x5f1df2(0x133)];localStorage[_0x5f1df2(0xf0)](_0x5f1df2(0x113),_0x15e768),localStorage[_0x5f1df2(0xf0)](_0x5f1df2(0x124),_0x4ec393),localStorage[_0x5f1df2(0xf0)](_0x5f1df2(0x129),_0x5e3bc2);}else console[_0x5f1df2(0x14a)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x104410[_0x1b4bb1(0x134)](_0x1b4bb1(0xf7)+_0x683af9+_0x1b4bb1(0x146)+_0x187dd1+_0x1b4bb1(0x12a)+clientId+'&client_secret='+clientSecret+_0x1b4bb1(0xf1)+encodeURIComponent(_0x3be50a));}export async function dpCreateFolder(_0x53b41a){var _0x236ee2=a0_0x22eaac;const _0x25f9b1=localStorage[_0x236ee2(0x142)](_0x236ee2(0x129));let _0x59297c=localStorage[_0x236ee2(0x142)](_0x236ee2(0x113));const _0x72aa04='/'+_0x25f9b1+'/'+_0x53b41a,_0x3ca832=JSON[_0x236ee2(0x149)]({'path':_0x72aa04,'autorename':![]});for(let _0x2aedf5=0x0;_0x2aedf5<0x2;_0x2aedf5++){try{const _0xf9e00b=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x236ee2(0xfe),'headers':{'Authorization':_0x236ee2(0x107)+_0x59297c,'Content-Type':_0x236ee2(0x114)},'body':_0x3ca832});if(_0xf9e00b[_0x236ee2(0x12d)]===0x191){const _0x51924f=await dpRefreshToken();if(!_0x51924f)throw new Error(_0x236ee2(0xf6));_0x59297c=localStorage[_0x236ee2(0x142)](_0x236ee2(0x113));continue;}if(_0xf9e00b['status']===0x199)return{'message':_0x236ee2(0x131),'path':_0x53b41a};if(!_0xf9e00b['ok'])throw new Error(_0x236ee2(0xf5)+_0x53b41a);const _0xe9e11f=await _0xf9e00b[_0x236ee2(0x139)]();return await lockNoti(_0x236ee2(0x11d),'',0xbb8),_0xe9e11f;}catch(_0x2e1ccf){if(_0x2aedf5===0x1)throw _0x2e1ccf;}}return![];}export async function dpRefreshToken(){var _0x4d0f30=a0_0x22eaac;if(!localStorage[_0x4d0f30(0x142)](_0x4d0f30(0x124)))throw _0x4d0f30(0xf8);try{const _0x5d0d9a=await fetch(_0x4d0f30(0x13d),{'method':_0x4d0f30(0xfe),'headers':{'Content-Type':_0x4d0f30(0x10d)},'body':_0x4d0f30(0xef)+localStorage[_0x4d0f30(0x142)]('refreshToken')+_0x4d0f30(0x140)}),_0x15532d=await _0x5d0d9a[_0x4d0f30(0x139)]();if(!_0x15532d[_0x4d0f30(0x12b)])return localStorage[_0x4d0f30(0xf0)](_0x4d0f30(0x113),_0x15532d[_0x4d0f30(0x11e)]),await lockNoti(_0x4d0f30(0x11f),'',0xbb8),await delay(0x3e8),!![];else alert(_0x15532d[_0x4d0f30(0x143)]||_0x4d0f30(0x14d));}catch(_0x332f02){console[_0x4d0f30(0x12b)](_0x4d0f30(0x132),_0x332f02);}return![];}function a0_0x4f18(){var _0x168a3a=['authorization_code','https://api.dropboxapi.com/oauth2/token','refresh_token','split','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','application/octet-stream','getItem','error_description','filter','setRequestHeader','&grant_type=','file','No\x20files\x20found\x20to\x20restore.','stringify','log','exec','6166272Sdejyv','Failed\x20to\x20refresh\x20Dropbox\x20token.','click','save','classList','search','open','refresh_token=','setItem','&redirect_uri=','843094ePXRkO','active','code','Error\x20creating\x20folder\x20','Unable\x20to\x20refresh\x20token','code=','No\x20refresh\x20token','Authorization\x20Code:','.tag','https://api.dropboxapi.com/2/files/list_folder','onload','blob','POST','remove','=([^&#]*)',',\x20status:\x20','length','https://content.dropboxapi.com/2/files/upload','153951rQaXfI','name','screenshot','Bearer\x20','folder','uploadFileInCloud','nwb3dnfh09rhs31','offline','alert','application/x-www-form-urlencoded','3183955PaNSkL','&token_access_type=','href','push','location','accessToken','application/json','parse','2596854WvOmPA','downloadFileInCloud','Restoring...','525ZKfRGa','/data/','listFiles','2707257ATJEKE','Folder\x20created','access_token','Refreshing\x20token...','4076rLPjrK','addEventListener','[\x5c?&#]','&response_type=','refreshToken','Do\x20you\x20want\x20to\x20logout?','https://www.dropbox.com/oauth2/authorize?client_id=','Kabu\x20storage\x20↦\x20Cloud\x20◆','Do\x20you\x20want\x20to\x20backup\x20','uId','&client_id=','error','replace','status','map','Cloud\x20login\x20required!','confirm','Folder\x20already\x20exists','Error\x20while\x20refreshing\x20token:','uid','send','knh3uz2mx2hp2eu','Cloud\x20↦\x20Kabu\x20storage\x20◆','Do\x20you\x20want\x20to\x20restore\x20','Wait\x20a\x20little\x20bit...','json','state','Restore\x20canceled\x20by\x20user.'];a0_0x4f18=function(){return _0x168a3a;};return a0_0x4f18();}export async function dpUploadFile(_0x263179,_0x4a3ebc,_0x29784d){var _0x26831e=a0_0x22eaac;const _0x3de6fc=localStorage[_0x26831e(0x142)](_0x26831e(0x129));var _0x279dab=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x3de6fc+'/'+_0x29784d+'/'+_0x263179}),_0x22a505=new Blob([_0x4a3ebc],{'type':_0x26831e(0x141)});for(var _0x532f1d=0x0;_0x532f1d<0x2;_0x532f1d++){var _0x21f5cb=await fetch(_0x26831e(0x103),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x26831e(0x142)]('accessToken'),'Dropbox-API-Arg':_0x279dab,'Content-Type':_0x26831e(0x141)},'body':_0x22a505});if(_0x21f5cb[_0x26831e(0x12d)]!=0xc8){if(_0x21f5cb[_0x26831e(0x12d)]==0x191){var _0x4a9262=await dpRefreshToken();if(!_0x4a9262)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x21f5cb['status'];}else{var _0x3a3722=await _0x21f5cb[_0x26831e(0x139)]();return console['log'](_0x26831e(0x127),_0x263179),_0x3a3722;}}return![];}function a0_0x5716(_0xede02b,_0x26eae9){var _0x4f186e=a0_0x4f18();return a0_0x5716=function(_0x57163e,_0x3a4057){_0x57163e=_0x57163e-0xea;var _0x3769c8=_0x4f186e[_0x57163e];return _0x3769c8;},a0_0x5716(_0xede02b,_0x26eae9);}export async function dpDownloadFile(_0x25aa25,_0x32ce81){var _0x45505a=a0_0x22eaac;const _0xe5dd39=localStorage[_0x45505a(0x142)](_0x45505a(0x129));var _0x186131=JSON[_0x45505a(0x149)]({'path':'/'+_0xe5dd39+'/'+_0x32ce81+'/'+_0x25aa25});for(var _0x27ab63=0x0;_0x27ab63<0x2;_0x27ab63++){var _0x306933=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x45505a(0xfe),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x45505a(0x142)](_0x45505a(0x113)),'Dropbox-API-Arg':_0x186131}});if(_0x306933[_0x45505a(0x12d)]!=0xc8){if(_0x306933['status']==0x191){var _0x266db7=await dpRefreshToken();if(!_0x266db7)throw _0x45505a(0xf6);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x306933[_0x45505a(0x12d)];}const _0x526f33=new File([await _0x306933[_0x45505a(0xfd)]()],_0x25aa25);return console['log'](_0x45505a(0x136),_0x526f33[_0x45505a(0x105)]),a0_0xfc70dc[_0x45505a(0x109)](_0x526f33,()=>{}),_0x526f33;}return![];}document[a0_0x22eaac(0x121)]('DOMContentLoaded',function(){var _0x3223a7=a0_0x22eaac;dropboxRestore[_0x3223a7(0x121)](_0x3223a7(0xea),async function(){var _0x5ba985=_0x3223a7;await lockNoti(_0x5ba985(0x138),'',0x1388);const _0x228fd7=localStorage['getItem'](_0x5ba985(0x129)),_0x308277=[_0x5ba985(0x13a),_0x5ba985(0xeb),_0x5ba985(0x106)];if(!_0x228fd7){window[_0x5ba985(0x10c)](_0x5ba985(0x12f));return;}let _0x3bf462=[];for(const _0x37acec of _0x308277){let _0x2a49cb={'path':'/'+_0x228fd7+'/'+_0x37acec};for(let _0x31df94=0x0;_0x31df94<0x2;_0x31df94++){let _0x2888a0=await fetch(_0x5ba985(0xfb),{'method':_0x5ba985(0xfe),'headers':{'Authorization':_0x5ba985(0x107)+localStorage[_0x5ba985(0x142)](_0x5ba985(0x113)),'Content-Type':'application/json'},'body':JSON[_0x5ba985(0x149)](_0x2a49cb)});if(_0x2888a0[_0x5ba985(0x12d)]===0xc8){let _0x5c7a41=await _0x2888a0[_0x5ba985(0x139)](),_0x5decbe=_0x5c7a41['entries'][_0x5ba985(0x144)](_0x3d6043=>_0x3d6043[_0x5ba985(0xfa)]===_0x5ba985(0x147));_0x5decbe['length']>0x0&&_0x3bf462[_0x5ba985(0x111)](..._0x5decbe[_0x5ba985(0x12e)](_0x5cffa1=>({'name':_0x5cffa1['name'],'folder':_0x37acec})));break;}else{if(_0x2888a0[_0x5ba985(0x12d)]===0x191){let _0x245195=await dpRefreshToken();if(!_0x245195)throw _0x5ba985(0xf6);}else{console['error']('Download\x20failed\x20for\x20'+_0x37acec+_0x5ba985(0x101)+_0x2888a0[_0x5ba985(0x12d)]);break;}}}}if(_0x3bf462[_0x5ba985(0x102)]>0x0){const _0x35bafa=_0x5ba985(0x137)+_0x3bf462[_0x5ba985(0x102)]+'\x20files\x20from\x20Cloud?';if(window[_0x5ba985(0x130)](_0x35bafa))for(const _0x306fbc of _0x3bf462){await lockNoti(_0x5ba985(0x118),_0x306fbc[_0x5ba985(0x105)],0xbb8),await dpDownloadFile(_0x306fbc[_0x5ba985(0x105)],_0x306fbc[_0x5ba985(0x108)]);}else console['log'](_0x5ba985(0x13b));}else console['log'](_0x5ba985(0x148));}),dropboxBackup[_0x3223a7(0x121)]('click',async function(){var _0x52955d=_0x3223a7;await lockNoti(_0x52955d(0x138),'',0x1388);const _0x81d0e5=localStorage[_0x52955d(0x142)](_0x52955d(0x129));if(_0x81d0e5===null||_0x81d0e5==='')window['alert']('Cloud\x20login\x20required!');else{const _0x5de8cf=[_0x52955d(0x13a),_0x52955d(0xeb),'screenshot'];for(const _0x3810f2 of _0x5de8cf){await dpCreateFolder(_0x3810f2);}let _0x301a35=0x0;for(const _0x19c2d1 of _0x5de8cf){const _0x2f5268=a0_0xfc70dc[_0x52955d(0x11b)](_0x19c2d1+'s');_0x301a35+=_0x2f5268[_0x52955d(0x102)];}if(window['confirm'](_0x52955d(0x128)+_0x301a35+'\x20files\x20in\x20Kabu?'))for(const _0x10c6d9 of _0x5de8cf){const _0x5d9116=a0_0xfc70dc[_0x52955d(0x11b)](_0x10c6d9+'s');for(const _0x1c7a50 of _0x5d9116){const _0x2bffd6=await a0_0xfc70dc[_0x52955d(0x117)](_0x52955d(0x11a)+_0x10c6d9+'s/'+_0x1c7a50);try{await lockNoti('Backing\x20up...',_0x1c7a50,0xbb8),await dpUploadFile(_0x1c7a50,_0x2bffd6,_0x10c6d9);}catch(_0x19e4c3){console[_0x52955d(0x12b)]('Failed\x20to\x20upload\x20file\x20'+_0x1c7a50+':',_0x19e4c3);}}}else console[_0x52955d(0x14a)](_0x52955d(0x13b));}}),dropboxCloud['addEventListener'](_0x3223a7(0xea),function(){var _0x34ce5b=_0x3223a7;const _0x2d6284=localStorage['getItem'](_0x34ce5b(0x129));_0x2d6284===null||_0x2d6284===''?authorizeWithDropbox():window[_0x34ce5b(0x130)](_0x34ce5b(0x125))&&(localStorage[_0x34ce5b(0xf0)](_0x34ce5b(0x129),''),dropboxRestore[_0x34ce5b(0xec)][_0x34ce5b(0xff)](_0x34ce5b(0xf3)),dropboxBackup[_0x34ce5b(0xec)]['remove']('active'),dropboxCloud[_0x34ce5b(0xec)][_0x34ce5b(0xff)]('active'));}),handleDropboxCallback();});