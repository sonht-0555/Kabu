var a0_0x15d9bb=a0_0x59e4;(function(_0x55afa6,_0x281bda){var _0xac6af3=a0_0x59e4,_0x3f6c7c=_0x55afa6();while(!![]){try{var _0x5bcc4c=-parseInt(_0xac6af3(0x174))/0x1+-parseInt(_0xac6af3(0x164))/0x2*(-parseInt(_0xac6af3(0x1a0))/0x3)+-parseInt(_0xac6af3(0x15d))/0x4+-parseInt(_0xac6af3(0x15a))/0x5+-parseInt(_0xac6af3(0x14b))/0x6+parseInt(_0xac6af3(0x15c))/0x7+parseInt(_0xac6af3(0x152))/0x8*(parseInt(_0xac6af3(0x151))/0x9);if(_0x5bcc4c===_0x281bda)break;else _0x3f6c7c['push'](_0x3f6c7c['shift']());}catch(_0x5dff1d){_0x3f6c7c['push'](_0x3f6c7c['shift']());}}}(a0_0x42ba,0x5894e));import*as a0_0x1d7be7 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x15d9bb(0x150),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x220b78=a0_0x15d9bb,_0x1a14a1=window[_0x220b78(0x172)]['href'][_0x220b78(0x196)]('?')[0x0],_0xbccbe=_0x220b78(0x192),_0x2e5af7=_0x220b78(0x187),_0xe99950=_0x220b78(0x18c)+clientId+_0x220b78(0x14d)+_0xbccbe+'&token_access_type='+_0x2e5af7+'&redirect_uri='+encodeURIComponent(_0x1a14a1);window['location'][_0x220b78(0x19e)]=_0xe99950;}function handleDropboxCallback(){var _0x519e02=a0_0x15d9bb,_0x284ac6=getUrlParameter(_0x519e02(0x192));_0x284ac6?(getAccessToken(_0x284ac6),console[_0x519e02(0x19f)]('Authorization\x20Code:',_0x284ac6)):console['log'](_0x519e02(0x16a));}function getUrlParameter(_0x38eaf3){var _0x4b0b08=a0_0x15d9bb;_0x38eaf3=_0x38eaf3['replace'](/[\[]/,'\x5c[')[_0x4b0b08(0x177)](/[\]]/,'\x5c]');var _0x199a1b=new RegExp('[\x5c?&#]'+_0x38eaf3+_0x4b0b08(0x162)),_0x36e9d9=_0x199a1b[_0x4b0b08(0x18a)](location[_0x4b0b08(0x15f)]);return _0x36e9d9===null?'':decodeURIComponent(_0x36e9d9[0x1][_0x4b0b08(0x177)](/\+/g,'\x20'));}function getAccessToken(_0x283b56){var _0x26e166=a0_0x15d9bb,_0x1dacfc=_0x26e166(0x1a4),_0x1b326f=window[_0x26e166(0x172)][_0x26e166(0x19e)][_0x26e166(0x196)]('?')[0x0],_0x198746=new XMLHttpRequest();_0x198746[_0x26e166(0x198)](_0x26e166(0x180),'https://api.dropbox.com/oauth2/token'),_0x198746[_0x26e166(0x19c)](_0x26e166(0x193),_0x26e166(0x175)),_0x198746['onload']=function(){var _0x357fca=_0x26e166;if(_0x198746[_0x357fca(0x1a6)]===0xc8){var _0x4b793d=JSON[_0x357fca(0x1a1)](_0x198746[_0x357fca(0x173)]),_0x465333=_0x4b793d[_0x357fca(0x19b)],_0x4b2ee8=_0x4b793d[_0x357fca(0x14a)],_0x26d54e=_0x4b793d[_0x357fca(0x154)];localStorage[_0x357fca(0x197)]('accessToken',_0x465333),localStorage[_0x357fca(0x197)](_0x357fca(0x16c),_0x4b2ee8),localStorage[_0x357fca(0x197)](_0x357fca(0x1a3),_0x26d54e);}else console['log'](_0x357fca(0x16d));},_0x198746[_0x26e166(0x161)](_0x26e166(0x149)+_0x283b56+'&grant_type='+_0x1dacfc+_0x26e166(0x181)+clientId+'&client_secret='+clientSecret+'&redirect_uri='+encodeURIComponent(_0x1b326f));}export async function dpCreateFolder(_0x2b6c70){var _0x4c88d9=a0_0x15d9bb;const _0x373d48=localStorage['getItem'](_0x4c88d9(0x1a3));let _0x21b9a3=localStorage[_0x4c88d9(0x194)](_0x4c88d9(0x1a5));const _0x52efcc='/'+_0x373d48+'/'+_0x2b6c70,_0x35f77b=JSON[_0x4c88d9(0x1a2)]({'path':_0x52efcc,'autorename':![]});for(let _0x325f7f=0x0;_0x325f7f<0x2;_0x325f7f++){try{const _0x3e2905=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':'POST','headers':{'Authorization':'Bearer\x20'+_0x21b9a3,'Content-Type':_0x4c88d9(0x159)},'body':_0x35f77b});if(_0x3e2905[_0x4c88d9(0x1a6)]===0x191){const _0x5e9017=await dpRefreshToken();if(!_0x5e9017)throw new Error(_0x4c88d9(0x16f));_0x21b9a3=localStorage[_0x4c88d9(0x194)](_0x4c88d9(0x1a5));continue;}if(_0x3e2905[_0x4c88d9(0x1a6)]===0x199)return{'message':_0x4c88d9(0x153),'path':_0x2b6c70};if(!_0x3e2905['ok'])throw new Error(_0x4c88d9(0x189)+_0x2b6c70);const _0x1a8054=await _0x3e2905[_0x4c88d9(0x18d)]();return await lockNoti(_0x4c88d9(0x166),'',0xbb8),_0x1a8054;}catch(_0x32af50){if(_0x325f7f===0x1)throw _0x32af50;}}return![];}function a0_0x42ba(){var _0xe28e30=['code','Content-Type','getItem','folder','split','setItem','open','Download\x20failed,\x20unknown\x20http\x20status:','Failed\x20to\x20refresh\x20Dropbox\x20token.','access_token','setRequestHeader',',\x20status:\x20','href','log','27mKorGZ','parse','stringify','uId','authorization_code','accessToken','status','https://content.dropboxapi.com/2/files/download','code=','refresh_token','3306432epfxmy','.tag','&response_type=','confirm','Restore\x20canceled\x20by\x20user.','knh3uz2mx2hp2eu','9073989SOFuKs','8ySydri','Folder\x20already\x20exists','uid','uploadFileInCloud','refresh_token=','Cloud\x20login\x20required!','classList','application/json','1223975VKvDZO','/data/','1709785GVoCvJ','1106008QfrZkL','application/octet-stream','search','Error\x20while\x20refreshing\x20token:','send','=([^&#]*)','click','100358uTdrPa','Wait\x20a\x20little\x20bit...','Folder\x20created','push','Download\x20failed\x20for\x20','Bearer\x20','Do\x20not\x20receive\x20authorization','screenshot','refreshToken','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','alert','Unable\x20to\x20refresh\x20token','No\x20files\x20found\x20to\x20restore.','Backing\x20up...','location','responseText','268888Bdmebd','application/x-www-form-urlencoded','remove','replace','addEventListener','length','listFiles','error_description','name','Cloud\x20↦\x20Kabu\x20storage\x20◆','Kabu\x20storage\x20↦\x20Cloud\x20◆','active','POST','&client_id=','error','entries','filter','No\x20refresh\x20token','state','offline','save','Error\x20creating\x20folder\x20','exec','file','https://www.dropbox.com/oauth2/authorize?client_id=','json','https://content.dropboxapi.com/2/files/upload','Restoring...','https://api.dropboxapi.com/oauth2/token','\x20files\x20in\x20Kabu?'];a0_0x42ba=function(){return _0xe28e30;};return a0_0x42ba();}export async function dpRefreshToken(){var _0x30c8d5=a0_0x15d9bb;if(!localStorage[_0x30c8d5(0x194)](_0x30c8d5(0x16c)))throw _0x30c8d5(0x185);try{const _0x4b5921=await fetch(_0x30c8d5(0x190),{'method':'POST','headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x30c8d5(0x156)+localStorage[_0x30c8d5(0x194)](_0x30c8d5(0x16c))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x5a7357=await _0x4b5921[_0x30c8d5(0x18d)]();if(!_0x5a7357['error'])return localStorage[_0x30c8d5(0x197)](_0x30c8d5(0x1a5),_0x5a7357[_0x30c8d5(0x19b)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x5a7357[_0x30c8d5(0x17b)]||_0x30c8d5(0x19a));}catch(_0x57b351){console[_0x30c8d5(0x182)](_0x30c8d5(0x160),_0x57b351);}return![];}function a0_0x59e4(_0x411459,_0x2f1f64){var _0x42ba15=a0_0x42ba();return a0_0x59e4=function(_0x59e466,_0x3b678a){_0x59e466=_0x59e466-0x149;var _0x2b41b4=_0x42ba15[_0x59e466];return _0x2b41b4;},a0_0x59e4(_0x411459,_0x2f1f64);}export async function dpUploadFile(_0x3e3f56,_0x46ea7e,_0x4cd35b){var _0x459579=a0_0x15d9bb;const _0x141377=localStorage['getItem'](_0x459579(0x1a3));var _0x3fbaae=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x141377+'/'+_0x4cd35b+'/'+_0x3e3f56}),_0x231ef7=new Blob([_0x46ea7e],{'type':_0x459579(0x15e)});for(var _0x270ded=0x0;_0x270ded<0x2;_0x270ded++){var _0x5100e1=await fetch(_0x459579(0x18e),{'method':_0x459579(0x180),'headers':{'Authorization':_0x459579(0x169)+localStorage[_0x459579(0x194)]('accessToken'),'Dropbox-API-Arg':_0x3fbaae,'Content-Type':_0x459579(0x15e)},'body':_0x231ef7});if(_0x5100e1[_0x459579(0x1a6)]!=0xc8){if(_0x5100e1[_0x459579(0x1a6)]==0x191){var _0x3b4984=await dpRefreshToken();if(!_0x3b4984)throw _0x459579(0x16f);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x5100e1[_0x459579(0x1a6)];}else{var _0x4b7da2=await _0x5100e1[_0x459579(0x18d)]();return console[_0x459579(0x19f)](_0x459579(0x17e),_0x3e3f56),_0x4b7da2;}}return![];}export async function dpDownloadFile(_0x428379,_0x3af7dd){var _0x239a71=a0_0x15d9bb;const _0x244e96=localStorage[_0x239a71(0x194)](_0x239a71(0x1a3));var _0xe2270d=JSON['stringify']({'path':'/'+_0x244e96+'/'+_0x3af7dd+'/'+_0x428379});for(var _0x4ea68a=0x0;_0x4ea68a<0x2;_0x4ea68a++){var _0x3f5856=await fetch(_0x239a71(0x1a7),{'method':_0x239a71(0x180),'headers':{'Authorization':_0x239a71(0x169)+localStorage[_0x239a71(0x194)](_0x239a71(0x1a5)),'Dropbox-API-Arg':_0xe2270d}});if(_0x3f5856['status']!=0xc8){if(_0x3f5856[_0x239a71(0x1a6)]==0x191){var _0x1d880b=await dpRefreshToken();if(!_0x1d880b)throw _0x239a71(0x16f);continue;}else throw _0x239a71(0x199)+_0x3f5856['status'];}const _0x747a5b=new File([await _0x3f5856['blob']()],_0x428379);return console[_0x239a71(0x19f)](_0x239a71(0x17d),_0x747a5b[_0x239a71(0x17c)]),a0_0x1d7be7[_0x239a71(0x155)](_0x747a5b,()=>{}),_0x747a5b;}return![];}document[a0_0x15d9bb(0x178)]('DOMContentLoaded',function(){var _0x5dc9ac=a0_0x15d9bb;dropboxRestore[_0x5dc9ac(0x178)]('click',async function(){var _0x3ad0a0=_0x5dc9ac;await lockNoti(_0x3ad0a0(0x165),'',0x1388);const _0x1b40d6=localStorage['getItem']('uId'),_0x4d5846=[_0x3ad0a0(0x186),_0x3ad0a0(0x188),'screenshot'];if(!_0x1b40d6){window[_0x3ad0a0(0x16e)]('Cloud\x20login\x20required!');return;}let _0x207b17=[];for(const _0x27a6cd of _0x4d5846){let _0x5f03ce={'path':'/'+_0x1b40d6+'/'+_0x27a6cd};for(let _0xfc83e5=0x0;_0xfc83e5<0x2;_0xfc83e5++){let _0x3cdf76=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x3ad0a0(0x180),'headers':{'Authorization':_0x3ad0a0(0x169)+localStorage['getItem'](_0x3ad0a0(0x1a5)),'Content-Type':_0x3ad0a0(0x159)},'body':JSON[_0x3ad0a0(0x1a2)](_0x5f03ce)});if(_0x3cdf76[_0x3ad0a0(0x1a6)]===0xc8){let _0x231213=await _0x3cdf76['json'](),_0xe3e93a=_0x231213[_0x3ad0a0(0x183)][_0x3ad0a0(0x184)](_0x1ebabc=>_0x1ebabc[_0x3ad0a0(0x14c)]===_0x3ad0a0(0x18b));_0xe3e93a[_0x3ad0a0(0x179)]>0x0&&_0x207b17[_0x3ad0a0(0x167)](..._0xe3e93a['map'](_0x4f67b4=>({'name':_0x4f67b4['name'],'folder':_0x27a6cd})));break;}else{if(_0x3cdf76[_0x3ad0a0(0x1a6)]===0x191){let _0x438a23=await dpRefreshToken();if(!_0x438a23)throw _0x3ad0a0(0x16f);}else{console[_0x3ad0a0(0x182)](_0x3ad0a0(0x168)+_0x27a6cd+_0x3ad0a0(0x19d)+_0x3cdf76[_0x3ad0a0(0x1a6)]);break;}}}}if(_0x207b17[_0x3ad0a0(0x179)]>0x0){const _0x5471c6='Do\x20you\x20want\x20to\x20restore\x20'+_0x207b17[_0x3ad0a0(0x179)]+'\x20files\x20from\x20Cloud?';if(window[_0x3ad0a0(0x14e)](_0x5471c6))for(const _0x37087f of _0x207b17){await lockNoti(_0x3ad0a0(0x18f),_0x37087f[_0x3ad0a0(0x17c)],0xbb8),await dpDownloadFile(_0x37087f[_0x3ad0a0(0x17c)],_0x37087f[_0x3ad0a0(0x195)]);}else console[_0x3ad0a0(0x19f)](_0x3ad0a0(0x14f));}else console[_0x3ad0a0(0x19f)](_0x3ad0a0(0x170));}),dropboxBackup[_0x5dc9ac(0x178)]('click',async function(){var _0xbe33c4=_0x5dc9ac;await lockNoti(_0xbe33c4(0x165),'',0x1388);const _0x49673f=localStorage[_0xbe33c4(0x194)](_0xbe33c4(0x1a3));if(_0x49673f===null||_0x49673f==='')window[_0xbe33c4(0x16e)](_0xbe33c4(0x157));else{const _0x1385f3=[_0xbe33c4(0x186),_0xbe33c4(0x188),_0xbe33c4(0x16b)];for(const _0x3fb59e of _0x1385f3){await dpCreateFolder(_0x3fb59e);}let _0x475f7d=0x0;for(const _0x529595 of _0x1385f3){const _0x3a0c18=a0_0x1d7be7['listFiles'](_0x529595+'s');_0x475f7d+=_0x3a0c18['length'];}if(window[_0xbe33c4(0x14e)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x475f7d+_0xbe33c4(0x191)))for(const _0x1b6ba4 of _0x1385f3){const _0x170ce4=a0_0x1d7be7[_0xbe33c4(0x17a)](_0x1b6ba4+'s');for(const _0x5e2906 of _0x170ce4){const _0x49050e=await a0_0x1d7be7['downloadFileInCloud'](_0xbe33c4(0x15b)+_0x1b6ba4+'s/'+_0x5e2906);try{await lockNoti(_0xbe33c4(0x171),_0x5e2906,0xbb8),await dpUploadFile(_0x5e2906,_0x49050e,_0x1b6ba4);}catch(_0x16268a){console['error']('Failed\x20to\x20upload\x20file\x20'+_0x5e2906+':',_0x16268a);}}}else console[_0xbe33c4(0x19f)](_0xbe33c4(0x14f));}}),dropboxCloud['addEventListener'](_0x5dc9ac(0x163),function(){var _0x747062=_0x5dc9ac;const _0x4d77ae=localStorage[_0x747062(0x194)](_0x747062(0x1a3));_0x4d77ae===null||_0x4d77ae===''?authorizeWithDropbox():window[_0x747062(0x14e)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem'](_0x747062(0x1a3),''),dropboxRestore[_0x747062(0x158)]['remove']('active'),dropboxBackup[_0x747062(0x158)][_0x747062(0x176)](_0x747062(0x17f)),dropboxCloud[_0x747062(0x158)][_0x747062(0x176)](_0x747062(0x17f)));}),handleDropboxCallback();});