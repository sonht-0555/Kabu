var a0_0x2bc09a=a0_0x57be;(function(_0x598e89,_0x5a9bc0){var _0x4b4b96=a0_0x57be,_0x41f1bc=_0x598e89();while(!![]){try{var _0x50397e=parseInt(_0x4b4b96(0xa9))/0x1*(parseInt(_0x4b4b96(0xf9))/0x2)+-parseInt(_0x4b4b96(0xac))/0x3*(-parseInt(_0x4b4b96(0xd7))/0x4)+-parseInt(_0x4b4b96(0xc7))/0x5+parseInt(_0x4b4b96(0xb4))/0x6*(-parseInt(_0x4b4b96(0xaf))/0x7)+parseInt(_0x4b4b96(0xba))/0x8+parseInt(_0x4b4b96(0x94))/0x9*(-parseInt(_0x4b4b96(0xb7))/0xa)+-parseInt(_0x4b4b96(0x9b))/0xb*(-parseInt(_0x4b4b96(0xcb))/0xc);if(_0x50397e===_0x5a9bc0)break;else _0x41f1bc['push'](_0x41f1bc['shift']());}catch(_0x51a15e){_0x41f1bc['push'](_0x41f1bc['shift']());}}}(a0_0x5203,0x7e50b));import*as a0_0x41c225 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2bc09a(0x9d),clientSecret=a0_0x2bc09a(0xdf);function authorizeWithDropbox(){var _0x38993b=a0_0x2bc09a,_0x49097d=window[_0x38993b(0x96)][_0x38993b(0x99)][_0x38993b(0xed)]('?')[0x0],_0xe054c8='code',_0x3072c5='offline',_0x1f9211=_0x38993b(0xe2)+clientId+_0x38993b(0xa6)+_0xe054c8+_0x38993b(0xc2)+_0x3072c5+_0x38993b(0xa2)+encodeURIComponent(_0x49097d);window[_0x38993b(0x96)]['href']=_0x1f9211;}function handleDropboxCallback(){var _0x5f292e=a0_0x2bc09a,_0x9ab859=getUrlParameter(_0x5f292e(0xbb));_0x9ab859?(getAccessToken(_0x9ab859),console[_0x5f292e(0xa3)](_0x5f292e(0xcf),_0x9ab859)):console['log']('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x5a2284){var _0x84af94=a0_0x2bc09a;_0x5a2284=_0x5a2284[_0x84af94(0xaa)](/[\[]/,'\x5c[')[_0x84af94(0xaa)](/[\]]/,'\x5c]');var _0x27acc7=new RegExp(_0x84af94(0xb9)+_0x5a2284+_0x84af94(0xb1)),_0x520655=_0x27acc7[_0x84af94(0xc8)](location[_0x84af94(0xeb)]);return _0x520655===null?'':decodeURIComponent(_0x520655[0x1][_0x84af94(0xaa)](/\+/g,'\x20'));}function getAccessToken(_0x15585e){var _0x35279b=a0_0x2bc09a,_0x1c1aa3='authorization_code',_0x1a8769=window[_0x35279b(0x96)][_0x35279b(0x99)]['split']('?')[0x0],_0x9f37da=new XMLHttpRequest();_0x9f37da[_0x35279b(0xfb)](_0x35279b(0xbc),_0x35279b(0xec)),_0x9f37da[_0x35279b(0xc0)]('Content-Type',_0x35279b(0xe8)),_0x9f37da[_0x35279b(0xca)]=function(){var _0x1b0760=_0x35279b;if(_0x9f37da['status']===0xc8){var _0x3b50bd=JSON[_0x1b0760(0xe1)](_0x9f37da[_0x1b0760(0xb5)]),_0x2b70d2=_0x3b50bd[_0x1b0760(0xa8)],_0xef27ae=_0x3b50bd[_0x1b0760(0xa5)],_0x56a103=_0x3b50bd[_0x1b0760(0xf5)];localStorage['setItem']('accessToken',_0x2b70d2),localStorage['setItem'](_0x1b0760(0xa1),_0xef27ae),localStorage[_0x1b0760(0x9f)](_0x1b0760(0xf2),_0x56a103);}else console[_0x1b0760(0xa3)](_0x1b0760(0xd3));},_0x9f37da[_0x35279b(0xfa)](_0x35279b(0xd8)+_0x15585e+_0x35279b(0xdb)+_0x1c1aa3+_0x35279b(0xf1)+clientId+'&client_secret='+clientSecret+_0x35279b(0xa2)+encodeURIComponent(_0x1a8769));}export async function dpCreateFolder(_0x33ca9f){var _0x12850b=a0_0x2bc09a;const _0x32609d=localStorage[_0x12850b(0xef)]('uId');let _0x21822c=localStorage[_0x12850b(0xef)](_0x12850b(0xe6));const _0x18b7bc='/'+_0x32609d+'/'+_0x33ca9f,_0xd47dd3=JSON['stringify']({'path':_0x18b7bc,'autorename':![]});for(let _0x25ff5e=0x0;_0x25ff5e<0x2;_0x25ff5e++){try{const _0x1fd568=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x12850b(0xbc),'headers':{'Authorization':_0x12850b(0xd9)+_0x21822c,'Content-Type':_0x12850b(0xf3)},'body':_0xd47dd3});if(_0x1fd568[_0x12850b(0xa0)]===0x191){const _0x4f13e7=await dpRefreshToken();if(!_0x4f13e7)throw new Error(_0x12850b(0xc1));_0x21822c=localStorage[_0x12850b(0xef)]('accessToken');continue;}if(_0x1fd568['status']===0x199)return{'message':_0x12850b(0xb8),'path':_0x33ca9f};if(!_0x1fd568['ok'])throw new Error(_0x12850b(0xc5)+_0x33ca9f);const _0x4e634c=await _0x1fd568['json']();return await lockNoti(_0x12850b(0xe5),'',0xbb8),_0x4e634c;}catch(_0x4324f5){if(_0x25ff5e===0x1)throw _0x4324f5;}}return![];}function a0_0x5203(){var _0x2dfb51=['active','No\x20refresh\x20token','9fRNHnC','downloadFileInCloud','location','Upload\x20failed,\x20unknown\x20http\x20status:\x20','name','href','https://api.dropboxapi.com/2/files/list_folder','786907ombhqX','Cloud\x20login\x20required!','knh3uz2mx2hp2eu','\x20files\x20in\x20Kabu?','setItem','status','refreshToken','&redirect_uri=','log','click','refresh_token','&response_type=','Backing\x20up...','access_token','152261rjuOly','replace','https://content.dropboxapi.com/2/files/upload','261GrzFAX','listFiles','Failed\x20to\x20refresh\x20Dropbox\x20token.','210hNQhBt','state','=([^&#]*)','length','.tag','103656llkANp','responseText','stringify','5195290bBffKH','Folder\x20already\x20exists','[\x5c?&#]','8097144IwQxPV','code','POST','confirm','error','push','setRequestHeader','Unable\x20to\x20refresh\x20token','&token_access_type=','entries','blob','Error\x20creating\x20folder\x20','addEventListener','3766245lNjJUI','exec','json','onload','120RFFfRX','remove','Download\x20failed,\x20unknown\x20http\x20status:','application/octet-stream','Authorization\x20Code:','refresh_token=','save','\x20files\x20from\x20Cloud?','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','folder','filter','Do\x20you\x20want\x20to\x20logout?','5708QAOclh','code=','Bearer\x20',',\x20status:\x20','&grant_type=','overwrite','Refreshing\x20token...','Kabu\x20storage\x20↦\x20Cloud\x20◆','nwb3dnfh09rhs31','alert','parse','https://www.dropbox.com/oauth2/authorize?client_id=','Do\x20you\x20want\x20to\x20restore\x20','https://api.dropboxapi.com/oauth2/token','Folder\x20created','accessToken','uploadFileInCloud','application/x-www-form-urlencoded','Restore\x20canceled\x20by\x20user.','Error\x20while\x20refreshing\x20token:','search','https://api.dropbox.com/oauth2/token','split','classList','getItem','screenshot','&client_id=','uId','application/json','https://content.dropboxapi.com/2/files/download','uid','Do\x20you\x20want\x20to\x20backup\x20','Wait\x20a\x20little\x20bit...','DOMContentLoaded','6yXJDic','send','open'];a0_0x5203=function(){return _0x2dfb51;};return a0_0x5203();}export async function dpRefreshToken(){var _0x15d453=a0_0x2bc09a;if(!localStorage[_0x15d453(0xef)](_0x15d453(0xa1)))throw _0x15d453(0x93);try{const _0x3f112e=await fetch(_0x15d453(0xe4),{'method':_0x15d453(0xbc),'headers':{'Content-Type':_0x15d453(0xe8)},'body':_0x15d453(0xd0)+localStorage[_0x15d453(0xef)](_0x15d453(0xa1))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x22b410=await _0x3f112e['json']();if(!_0x22b410['error'])return localStorage[_0x15d453(0x9f)]('accessToken',_0x22b410[_0x15d453(0xa8)]),await lockNoti(_0x15d453(0xdd),'',0xbb8),await delay(0x3e8),!![];else alert(_0x22b410['error_description']||_0x15d453(0xae));}catch(_0x186cba){console[_0x15d453(0xbe)](_0x15d453(0xea),_0x186cba);}return![];}function a0_0x57be(_0x5c02de,_0xaea6c8){var _0x5203a4=a0_0x5203();return a0_0x57be=function(_0x57be1f,_0x3e3372){_0x57be1f=_0x57be1f-0x92;var _0x4243cb=_0x5203a4[_0x57be1f];return _0x4243cb;},a0_0x57be(_0x5c02de,_0xaea6c8);}export async function dpUploadFile(_0x5ce27d,_0x4b688a,_0xff6d56){var _0x163be4=a0_0x2bc09a;const _0x23b4c1=localStorage[_0x163be4(0xef)](_0x163be4(0xf2));var _0x334109=JSON[_0x163be4(0xb6)]({'autorename':!![],'mode':_0x163be4(0xdc),'mute':!![],'strict_conflict':![],'path':'/'+_0x23b4c1+'/'+_0xff6d56+'/'+_0x5ce27d}),_0xb25176=new Blob([_0x4b688a],{'type':_0x163be4(0xce)});for(var _0x138de0=0x0;_0x138de0<0x2;_0x138de0++){var _0x29c8c5=await fetch(_0x163be4(0xab),{'method':_0x163be4(0xbc),'headers':{'Authorization':_0x163be4(0xd9)+localStorage['getItem'](_0x163be4(0xe6)),'Dropbox-API-Arg':_0x334109,'Content-Type':_0x163be4(0xce)},'body':_0xb25176});if(_0x29c8c5[_0x163be4(0xa0)]!=0xc8){if(_0x29c8c5['status']==0x191){var _0x1c1e03=await dpRefreshToken();if(!_0x1c1e03)throw _0x163be4(0xc1);continue;}else throw _0x163be4(0x97)+_0x29c8c5['status'];}else{var _0x211ec2=await _0x29c8c5[_0x163be4(0xc9)]();return console[_0x163be4(0xa3)](_0x163be4(0xde),_0x5ce27d),_0x211ec2;}}return![];}export async function dpDownloadFile(_0x8a7400,_0x56c9f5){var _0xadee49=a0_0x2bc09a;const _0x3bf45b=localStorage[_0xadee49(0xef)]('uId');var _0x154520=JSON[_0xadee49(0xb6)]({'path':'/'+_0x3bf45b+'/'+_0x56c9f5+'/'+_0x8a7400});for(var _0x5414b8=0x0;_0x5414b8<0x2;_0x5414b8++){var _0x7397f2=await fetch(_0xadee49(0xf4),{'method':_0xadee49(0xbc),'headers':{'Authorization':'Bearer\x20'+localStorage[_0xadee49(0xef)](_0xadee49(0xe6)),'Dropbox-API-Arg':_0x154520}});if(_0x7397f2[_0xadee49(0xa0)]!=0xc8){if(_0x7397f2['status']==0x191){var _0x32c122=await dpRefreshToken();if(!_0x32c122)throw _0xadee49(0xc1);continue;}else throw _0xadee49(0xcd)+_0x7397f2[_0xadee49(0xa0)];}const _0x2cd971=new File([await _0x7397f2[_0xadee49(0xc4)]()],_0x8a7400);return console[_0xadee49(0xa3)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x2cd971[_0xadee49(0x98)]),a0_0x41c225[_0xadee49(0xe7)](_0x2cd971,()=>{}),_0x2cd971;}return![];}document['addEventListener'](a0_0x2bc09a(0xf8),function(){var _0x2fb6d1=a0_0x2bc09a;dropboxRestore[_0x2fb6d1(0xc6)](_0x2fb6d1(0xa4),async function(){var _0x27d219=_0x2fb6d1;await lockNoti(_0x27d219(0xf7),'',0x1388);const _0x1f7f0e=localStorage[_0x27d219(0xef)]('uId'),_0x34050a=[_0x27d219(0xb0),_0x27d219(0xd1),_0x27d219(0xf0)];if(!_0x1f7f0e){window[_0x27d219(0xe0)](_0x27d219(0x9c));return;}let _0x57f7ea=[];for(const _0x3035a3 of _0x34050a){let _0xed1d6a={'path':'/'+_0x1f7f0e+'/'+_0x3035a3};for(let _0x414121=0x0;_0x414121<0x2;_0x414121++){let _0x46f26=await fetch(_0x27d219(0x9a),{'method':_0x27d219(0xbc),'headers':{'Authorization':_0x27d219(0xd9)+localStorage[_0x27d219(0xef)](_0x27d219(0xe6)),'Content-Type':_0x27d219(0xf3)},'body':JSON[_0x27d219(0xb6)](_0xed1d6a)});if(_0x46f26['status']===0xc8){let _0xd925f=await _0x46f26[_0x27d219(0xc9)](),_0xf6aaad=_0xd925f[_0x27d219(0xc3)][_0x27d219(0xd5)](_0x273b9e=>_0x273b9e[_0x27d219(0xb3)]==='file');_0xf6aaad[_0x27d219(0xb2)]>0x0&&_0x57f7ea[_0x27d219(0xbf)](..._0xf6aaad['map'](_0x3aff54=>({'name':_0x3aff54[_0x27d219(0x98)],'folder':_0x3035a3})));break;}else{if(_0x46f26[_0x27d219(0xa0)]===0x191){let _0x3683da=await dpRefreshToken();if(!_0x3683da)throw _0x27d219(0xc1);}else{console['error']('Download\x20failed\x20for\x20'+_0x3035a3+_0x27d219(0xda)+_0x46f26[_0x27d219(0xa0)]);break;}}}}if(_0x57f7ea[_0x27d219(0xb2)]>0x0){const _0x39fd16=_0x27d219(0xe3)+_0x57f7ea[_0x27d219(0xb2)]+_0x27d219(0xd2);if(window[_0x27d219(0xbd)](_0x39fd16))for(const _0x3f8b31 of _0x57f7ea){await lockNoti('Restoring...',_0x3f8b31[_0x27d219(0x98)],0xbb8),await dpDownloadFile(_0x3f8b31[_0x27d219(0x98)],_0x3f8b31[_0x27d219(0xd4)]);}else console[_0x27d219(0xa3)]('Restore\x20canceled\x20by\x20user.');}else console[_0x27d219(0xa3)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x2fb6d1(0xc6)](_0x2fb6d1(0xa4),async function(){var _0x136080=_0x2fb6d1;await lockNoti(_0x136080(0xf7),'',0x1388);const _0x4b7c85=localStorage[_0x136080(0xef)](_0x136080(0xf2));if(_0x4b7c85===null||_0x4b7c85==='')window[_0x136080(0xe0)](_0x136080(0x9c));else{const _0x3a016d=[_0x136080(0xb0),'save',_0x136080(0xf0)];for(const _0x1ea9b7 of _0x3a016d){await dpCreateFolder(_0x1ea9b7);}let _0x3ad0b4=0x0;for(const _0x46ddf7 of _0x3a016d){const _0x3a9ca0=a0_0x41c225['listFiles'](_0x46ddf7+'s');_0x3ad0b4+=_0x3a9ca0[_0x136080(0xb2)];}if(window[_0x136080(0xbd)](_0x136080(0xf6)+_0x3ad0b4+_0x136080(0x9e)))for(const _0x3350bf of _0x3a016d){const _0x82c9b7=a0_0x41c225[_0x136080(0xad)](_0x3350bf+'s');for(const _0x54be5f of _0x82c9b7){const _0x256c0b=await a0_0x41c225[_0x136080(0x95)]('/data/'+_0x3350bf+'s/'+_0x54be5f);try{await lockNoti(_0x136080(0xa7),_0x54be5f,0xbb8),await dpUploadFile(_0x54be5f,_0x256c0b,_0x3350bf);}catch(_0x10db8c){console[_0x136080(0xbe)]('Failed\x20to\x20upload\x20file\x20'+_0x54be5f+':',_0x10db8c);}}}else console[_0x136080(0xa3)](_0x136080(0xe9));}}),dropboxCloud[_0x2fb6d1(0xc6)]('click',function(){var _0x1874c1=_0x2fb6d1;const _0x432ec7=localStorage[_0x1874c1(0xef)](_0x1874c1(0xf2));_0x432ec7===null||_0x432ec7===''?authorizeWithDropbox():window[_0x1874c1(0xbd)](_0x1874c1(0xd6))&&(localStorage[_0x1874c1(0x9f)](_0x1874c1(0xf2),''),dropboxRestore['classList'][_0x1874c1(0xcc)]('active'),dropboxBackup[_0x1874c1(0xee)]['remove'](_0x1874c1(0x92)),dropboxCloud['classList'][_0x1874c1(0xcc)](_0x1874c1(0x92)));}),handleDropboxCallback();});