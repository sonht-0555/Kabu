var a0_0x5ab002=a0_0x7e67;(function(_0x393f09,_0x1a8f13){var _0x29884d=a0_0x7e67,_0x32905c=_0x393f09();while(!![]){try{var _0x11edb0=parseInt(_0x29884d(0x215))/0x1*(-parseInt(_0x29884d(0x213))/0x2)+-parseInt(_0x29884d(0x22c))/0x3+parseInt(_0x29884d(0x214))/0x4*(-parseInt(_0x29884d(0x239))/0x5)+parseInt(_0x29884d(0x216))/0x6+-parseInt(_0x29884d(0x226))/0x7*(parseInt(_0x29884d(0x1f6))/0x8)+parseInt(_0x29884d(0x244))/0x9*(-parseInt(_0x29884d(0x20c))/0xa)+-parseInt(_0x29884d(0x254))/0xb*(-parseInt(_0x29884d(0x1f9))/0xc);if(_0x11edb0===_0x1a8f13)break;else _0x32905c['push'](_0x32905c['shift']());}catch(_0x17fb04){_0x32905c['push'](_0x32905c['shift']());}}}(a0_0x30da,0x84a05));import*as a0_0x523cae from'./main.js';import{localStorageFile}from'./storage.js';function a0_0x7e67(_0x53c9ca,_0x35265a){var _0x30da7f=a0_0x30da();return a0_0x7e67=function(_0x7e6793,_0x539802){_0x7e6793=_0x7e6793-0x1eb;var _0x2b51bb=_0x30da7f[_0x7e6793];return _0x2b51bb;},a0_0x7e67(_0x53c9ca,_0x35265a);}var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x5ab002(0x24a);function a0_0x30da(){var _0xb7443e=['accessToken','charAt','629559aCvNYj','Restoring...','code','list','code=','Bearer\x20','nwb3dnfh09rhs31','error_description','exec','endsWith','Do\x20you\x20want\x20to\x20backup\x20','.ss1','https://api.dropboxapi.com/oauth2/token','.tag','Do\x20not\x20receive\x20authorization','.ss7','730455AflQKQ','text/plain','refresh_token=','location','status','slice','Failed\x20to\x20refresh\x20Dropbox\x20token.','log','getItem','\x20files\x20in\x20Kabu?','length','application/octet-stream','7218912WGFbwd','click','&token_access_type=','552aZleRr','application/x-www-form-urlencoded','&redirect_uri=','Do\x20you\x20want\x20to\x20restore\x20','uId','.gba_imageState','=([^&#]*)','.ss6','.ss0','https://content.dropboxapi.com/2/files/upload','.gba_slot','.ss2','gba','alert','substring','addEventListener','uid','.ss4','Kabu\x20storage\x20↦\x20Cloud\x20◆','130qQCDaI','Download\x20failed,\x20unknown\x20http\x20status:','https://content.dropboxapi.com/2/files/download','stringify','Unable\x20to\x20refresh\x20token','.txt','https://api.dropboxapi.com/2/files/list_folder','2234Jtxrbf','2044xDrIil','382XphWMr','5741772QfwTQg','Refreshing\x20token...','replace','open','href','remove','offline','overwrite','application/json','Backing\x20up...','text','DOMContentLoaded','state','classList','.ss5','split','7MGEfaS','file','filter','error','Restore\x20canceled\x20by\x20user.','[\x5c?&#]','2014233VExnkH','Upload\x20failed,\x20unknown\x20http\x20status:\x20','https://www.dropbox.com/oauth2/authorize?client_id=','save','Content-Type','lastIndexOf','POST','_dateState','json','Download\x20failed,\x20unknown\x20http\x20status:\x20','blob','setItem','toUpperCase','5465XOsUtl','send','confirm','name','FSSync','Cloud\x20login\x20required!','\x20files\x20in\x20Cloud?','downloadFileInCloud','active'];a0_0x30da=function(){return _0xb7443e;};return a0_0x30da();}function authorizeWithDropbox(){var _0x22852e=a0_0x5ab002,_0x2c787f=window[_0x22852e(0x1ed)][_0x22852e(0x21a)][_0x22852e(0x225)]('?')[0x0],_0x5d537e=_0x22852e(0x246),_0x3c4374=_0x22852e(0x21c),_0x12e9cd=_0x22852e(0x22e)+clientId+'&response_type='+_0x5d537e+_0x22852e(0x1f8)+_0x3c4374+'&redirect_uri='+encodeURIComponent(_0x2c787f);window[_0x22852e(0x1ed)][_0x22852e(0x21a)]=_0x12e9cd;}function handleDropboxCallback(){var _0x4751a3=a0_0x5ab002,_0x71c3f7=getUrlParameter(_0x4751a3(0x246));_0x71c3f7?(getAccessToken(_0x71c3f7),console[_0x4751a3(0x1f1)]('Authorization\x20Code:',_0x71c3f7)):console[_0x4751a3(0x1f1)](_0x4751a3(0x252));}function getUrlParameter(_0x40ca44){var _0x1fe54f=a0_0x5ab002;_0x40ca44=_0x40ca44[_0x1fe54f(0x218)](/[\[]/,'\x5c[')[_0x1fe54f(0x218)](/[\]]/,'\x5c]');var _0x5c315b=new RegExp(_0x1fe54f(0x22b)+_0x40ca44+_0x1fe54f(0x1ff)),_0x30b86e=_0x5c315b[_0x1fe54f(0x24c)](location['search']);return _0x30b86e===null?'':decodeURIComponent(_0x30b86e[0x1][_0x1fe54f(0x218)](/\+/g,'\x20'));}function getAccessToken(_0x46d134){var _0x535a4b=a0_0x5ab002,_0x3f96fd='authorization_code',_0x65be72=window[_0x535a4b(0x1ed)][_0x535a4b(0x21a)]['split']('?')[0x0],_0x1cc665=new XMLHttpRequest();_0x1cc665[_0x535a4b(0x219)](_0x535a4b(0x232),'https://api.dropbox.com/oauth2/token'),_0x1cc665['setRequestHeader'](_0x535a4b(0x230),_0x535a4b(0x1fa)),_0x1cc665['onload']=function(){var _0x38797e=_0x535a4b;if(_0x1cc665[_0x38797e(0x1ee)]===0xc8){var _0x2a1cac=JSON['parse'](_0x1cc665['responseText']),_0x8e1b58=_0x2a1cac['access_token'],_0x20d69f=_0x2a1cac['refresh_token'],_0x1d7c29=_0x2a1cac[_0x38797e(0x209)];localStorage[_0x38797e(0x237)](_0x38797e(0x242),_0x8e1b58),localStorage[_0x38797e(0x237)]('refreshToken',_0x20d69f),localStorage['setItem']('uId',_0x1d7c29);}else console[_0x38797e(0x1f1)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x1cc665[_0x535a4b(0x23a)](_0x535a4b(0x248)+_0x46d134+'&grant_type='+_0x3f96fd+'&client_id='+clientId+'&client_secret='+clientSecret+_0x535a4b(0x1fb)+encodeURIComponent(_0x65be72));}export async function dpRefreshToken(){var _0x251d62=a0_0x5ab002;if(!localStorage[_0x251d62(0x1f2)]('refreshToken'))throw'No\x20refresh\x20token';try{const _0x44d9a4=await fetch(_0x251d62(0x250),{'method':'POST','headers':{'Content-Type':_0x251d62(0x1fa)},'body':_0x251d62(0x1ec)+localStorage['getItem']('refreshToken')+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x593b0c=await _0x44d9a4['json']();if(!_0x593b0c['error'])return localStorage['setItem'](_0x251d62(0x242),_0x593b0c['access_token']),await lockNoti('',_0x251d62(0x217),0xbb8),await delay(0x3e8),!![];else alert(_0x593b0c[_0x251d62(0x24b)]||_0x251d62(0x1f0));}catch(_0x514de3){console[_0x251d62(0x229)]('Error\x20while\x20refreshing\x20token:',_0x514de3);}return![];}export async function dpUploadFile(_0x27a4f1,_0x3e8176){var _0x251806=a0_0x5ab002;const _0xbdec93=localStorage[_0x251806(0x1f2)](_0x251806(0x1fd));var _0x27a5a1=JSON[_0x251806(0x20f)]({'autorename':!![],'mode':_0x251806(0x21d),'mute':!![],'strict_conflict':![],'path':'/'+_0xbdec93+'/'+_0x27a4f1}),_0x9c02e6=new Blob([_0x3e8176],{'type':_0x251806(0x1f5)});for(var _0x2bebec=0x0;_0x2bebec<0x2;_0x2bebec++){var _0x11b96b=await fetch(_0x251806(0x202),{'method':'POST','headers':{'Authorization':_0x251806(0x249)+localStorage[_0x251806(0x1f2)](_0x251806(0x242)),'Dropbox-API-Arg':_0x27a5a1,'Content-Type':_0x251806(0x1f5)},'body':_0x9c02e6});if(_0x11b96b[_0x251806(0x1ee)]!=0xc8){if(_0x11b96b['status']==0x191){var _0x226cc8=await dpRefreshToken();if(!_0x226cc8)throw _0x251806(0x210);continue;}else throw _0x251806(0x22d)+_0x11b96b[_0x251806(0x1ee)];}else{var _0x4c3815=await _0x11b96b[_0x251806(0x234)]();return console['log'](_0x251806(0x20b),_0x27a4f1),_0x4c3815;}}return![];}async function dpDownloadFile(_0x4576d8){var _0x1f8c8e=a0_0x5ab002;const _0x4de977=localStorage['getItem'](_0x1f8c8e(0x1fd));var _0x3b3a70=JSON[_0x1f8c8e(0x20f)]({'path':'/'+_0x4de977+'/'+_0x4576d8});for(var _0x5c8956=0x0;_0x5c8956<0x2;_0x5c8956++){var _0x56cad7=await fetch(_0x1f8c8e(0x20e),{'method':_0x1f8c8e(0x232),'headers':{'Authorization':_0x1f8c8e(0x249)+localStorage[_0x1f8c8e(0x1f2)](_0x1f8c8e(0x242)),'Dropbox-API-Arg':_0x3b3a70}});if(_0x56cad7[_0x1f8c8e(0x1ee)]!=0xc8){if(_0x56cad7[_0x1f8c8e(0x1ee)]==0x191){var _0x5d5251=await dpRefreshToken();if(!_0x5d5251)throw _0x1f8c8e(0x210);continue;}else throw _0x1f8c8e(0x20d)+_0x56cad7[_0x1f8c8e(0x1ee)];}const _0x461e38=new File([await _0x56cad7[_0x1f8c8e(0x236)]()],_0x4576d8);console[_0x1f8c8e(0x1f1)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x461e38[_0x1f8c8e(0x23c)]);if(_0x4576d8['endsWith']('.txt')){const _0x24f6db=await _0x461e38[_0x1f8c8e(0x220)](),[_0x4c1afd,_0x370a47]=_0x24f6db[_0x1f8c8e(0x225)]('\x0a\x0a'),_0x355056=_0x4576d8[_0x1f8c8e(0x207)](0x0,_0x4576d8[_0x1f8c8e(0x231)](_0x1f8c8e(0x205))+0x3),_0x909103=_0x4576d8[_0x1f8c8e(0x243)](_0x4576d8[_0x1f8c8e(0x1f4)]-0x5);localStorage[_0x1f8c8e(0x237)](_0x355056+_0x1f8c8e(0x233)+_0x909103,_0x370a47),localStorage['setItem'](_0x355056+'_imageState'+_0x909103,_0x4c1afd);}else a0_0x523cae['uploadSaveOrSaveState'](_0x461e38,()=>{var _0x5a8919=_0x1f8c8e;localStorageFile(),Module[_0x5a8919(0x23d)]();});return _0x461e38;}return![];}document[a0_0x5ab002(0x208)](a0_0x5ab002(0x221),function(){var _0x230bba=a0_0x5ab002;dropboxRestore[_0x230bba(0x208)](_0x230bba(0x1f7),async function(){var _0x23b166=_0x230bba;const _0x5bdf0c=localStorage[_0x23b166(0x1f2)](_0x23b166(0x1fd));if(_0x5bdf0c===null||_0x5bdf0c==='')window[_0x23b166(0x206)]('Cloud\x20login\x20required!');else{var _0x5e7aeb={'path':'/'+_0x5bdf0c};for(var _0x3b8c91=0x0;_0x3b8c91<0x2;_0x3b8c91++){var _0x382b85=await fetch(_0x23b166(0x212),{'method':_0x23b166(0x232),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x23b166(0x1f2)]('accessToken'),'Content-Type':_0x23b166(0x21e)},'body':JSON[_0x23b166(0x20f)](_0x5e7aeb)});console[_0x23b166(0x1f1)]('status:\x20',_0x382b85[_0x23b166(0x1ee)]);if(_0x382b85['status']!=0xc8){if(_0x382b85[_0x23b166(0x1ee)]==0x191){var _0x2fcaf0=await dpRefreshToken();if(!_0x2fcaf0)throw _0x23b166(0x210);continue;}else throw _0x23b166(0x235)+_0x382b85[_0x23b166(0x1ee)];}else{const _0x1eefc7=await _0x382b85['json'](),_0x3202c6=_0x1eefc7['entries'][_0x23b166(0x228)](_0x3a1482=>_0x3a1482[_0x23b166(0x251)]===_0x23b166(0x227))[_0x23b166(0x1f4)],_0x196ee0=_0x23b166(0x1fc)+_0x3202c6+_0x23b166(0x23f);if(window['confirm'](_0x196ee0))for(const _0x4d7c61 of _0x1eefc7['entries']){_0x4d7c61[_0x23b166(0x251)]==='file'&&(await lockNoti(_0x23b166(0x245),_0x4d7c61[_0x23b166(0x23c)],0xbb8),await dpDownloadFile(_0x4d7c61[_0x23b166(0x23c)]));}else console['log'](_0x23b166(0x22a));return!![];}}return![];}}),dropboxBackup[_0x230bba(0x208)](_0x230bba(0x1f7),async function(){var _0x49455c=_0x230bba;const _0x94f608=localStorage['getItem'](_0x49455c(0x1fd));if(_0x94f608===null||_0x94f608==='')window[_0x49455c(0x206)](_0x49455c(0x23e));else{const _0xb748ed=[_0x49455c(0x222),_0x49455c(0x22f)];let _0x5beb48=0x0;for(const _0x2ecf7e of _0xb748ed){const _0x556581=a0_0x523cae[_0x49455c(0x247)+(_0x2ecf7e[_0x49455c(0x243)](0x0)[_0x49455c(0x238)]()+_0x2ecf7e[_0x49455c(0x1ef)](0x1))]();_0x5beb48+=_0x556581[_0x49455c(0x1f4)];}if(window[_0x49455c(0x23b)](_0x49455c(0x24e)+_0x5beb48+_0x49455c(0x1f3)))for(const _0x306883 of _0xb748ed){const _0x1feb34=a0_0x523cae['list'+(_0x306883[_0x49455c(0x243)](0x0)[_0x49455c(0x238)]()+_0x306883['slice'](0x1))]();for(const _0x452aeb of _0x1feb34){const _0x368162=await a0_0x523cae[_0x49455c(0x240)]('/data/'+_0x306883+'s/'+_0x452aeb);try{await lockNoti(_0x49455c(0x21f),_0x452aeb,0xbb8),await dpUploadFile(_0x452aeb,_0x368162);if(_0x452aeb[_0x49455c(0x24d)](_0x49455c(0x201))||_0x452aeb['endsWith'](_0x49455c(0x24f))||_0x452aeb['endsWith'](_0x49455c(0x204))||_0x452aeb[_0x49455c(0x24d)]('.ss3')||_0x452aeb[_0x49455c(0x24d)](_0x49455c(0x20a))||_0x452aeb['endsWith'](_0x49455c(0x224))||_0x452aeb[_0x49455c(0x24d)](_0x49455c(0x200))||_0x452aeb[_0x49455c(0x24d)](_0x49455c(0x253))){const _0x125f79=_0x452aeb[_0x49455c(0x207)](0x0,_0x452aeb['lastIndexOf']('.')),_0x38ffd6=_0x452aeb[_0x49455c(0x243)](_0x452aeb[_0x49455c(0x1f4)]-0x1),_0x25ce88=localStorage[_0x49455c(0x1f2)](_0x125f79+_0x49455c(0x1fe)+_0x38ffd6),_0x35fd47=localStorage[_0x49455c(0x1f2)](_0x125f79+'.gba_dateState'+_0x38ffd6);if(_0x25ce88!==null){const _0x9e4432=_0x25ce88+'\x0a\x0a'+_0x35fd47,_0x539b05=new Blob([_0x9e4432],{'type':_0x49455c(0x1eb)});await lockNoti(_0x49455c(0x21f),_0x125f79+_0x49455c(0x203)+_0x38ffd6+_0x49455c(0x211),0xbb8),await dpUploadFile(_0x125f79+_0x49455c(0x203)+_0x38ffd6+_0x49455c(0x211),_0x539b05);}}}catch(_0x2057e1){console[_0x49455c(0x229)]('Failed\x20to\x20upload\x20file\x20'+_0x452aeb+':',_0x2057e1);}}}else console[_0x49455c(0x1f1)](_0x49455c(0x22a));}}),dropboxCloud[_0x230bba(0x208)](_0x230bba(0x1f7),function(){var _0x53d513=_0x230bba;const _0xb35d31=localStorage[_0x53d513(0x1f2)](_0x53d513(0x1fd));_0xb35d31===null||_0xb35d31===''?authorizeWithDropbox():window[_0x53d513(0x23b)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x53d513(0x237)](_0x53d513(0x1fd),''),dropboxRestore[_0x53d513(0x223)][_0x53d513(0x21b)](_0x53d513(0x241)),dropboxBackup['classList'][_0x53d513(0x21b)](_0x53d513(0x241)),dropboxCloud[_0x53d513(0x223)][_0x53d513(0x21b)](_0x53d513(0x241)));}),handleDropboxCallback();});