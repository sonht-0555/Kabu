function a0_0xfd2a(_0x382ce7,_0x213f95){var _0x15d616=a0_0x15d6();return a0_0xfd2a=function(_0xfd2a7c,_0x3b4c81){_0xfd2a7c=_0xfd2a7c-0x182;var _0x175cf4=_0x15d616[_0xfd2a7c];return _0x175cf4;},a0_0xfd2a(_0x382ce7,_0x213f95);}var a0_0xbcdede=a0_0xfd2a;(function(_0x16d59,_0x18b771){var _0x5cd505=a0_0xfd2a,_0x16b858=_0x16d59();while(!![]){try{var _0x35551f=parseInt(_0x5cd505(0x1b5))/0x1+-parseInt(_0x5cd505(0x19a))/0x2+parseInt(_0x5cd505(0x1a1))/0x3*(parseInt(_0x5cd505(0x1be))/0x4)+-parseInt(_0x5cd505(0x1c9))/0x5*(parseInt(_0x5cd505(0x1af))/0x6)+-parseInt(_0x5cd505(0x1eb))/0x7*(-parseInt(_0x5cd505(0x1e3))/0x8)+parseInt(_0x5cd505(0x1d3))/0x9*(-parseInt(_0x5cd505(0x1a7))/0xa)+parseInt(_0x5cd505(0x1c5))/0xb*(parseInt(_0x5cd505(0x1d0))/0xc);if(_0x35551f===_0x18b771)break;else _0x16b858['push'](_0x16b858['shift']());}catch(_0x2d5e27){_0x16b858['push'](_0x16b858['shift']());}}}(a0_0x15d6,0x878c4));import*as a0_0x23af77 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0xbcdede(0x193),clientSecret=a0_0xbcdede(0x1e1);function a0_0x15d6(){var _0x4933ec=['split','No\x20files\x20found\x20to\x20restore.','slice','parse','351454iFSxND','state','uId','POST','uploadFileInCloud','confirm','Backing\x20up...','156sVptbI','access_token','Unable\x20to\x20refresh\x20token','Bearer\x20','https://www.dropbox.com/oauth2/authorize?client_id=','Error\x20creating\x20folder\x20','4394360UMqJEF','log','search','Authorization\x20Code:','remove','responseText','active','Upload\x20failed,\x20unknown\x20http\x20status:\x20','69942dGhTuN','error_description','click','json','&client_secret=','map','788182HZIMLf','Cloud\x20login\x20required!','replace','\x20files\x20in\x20Kabu?','authorization_code','exec','save','folder','offline','716fLHdmw','\x20files\x20from\x20Cloud?','Failed\x20to\x20upload\x20file\x20','&redirect_uri=','getItem','downloadFileInCloud','addEventListener','66atzqRM','application/octet-stream','refresh_token','href','285efQosT','Folder\x20already\x20exists','code','https://api.dropbox.com/oauth2/token','Wait\x20a\x20little\x20bit...','accessToken','uid','1092804ZtNton','toUpperCase','classList','9vkLFVG','setItem','&grant_type=','error','status','application/json','code=','Do\x20you\x20want\x20to\x20logout?','open','list','alert','overwrite','Do\x20not\x20receive\x20authorization','https://content.dropboxapi.com/2/files/download','nwb3dnfh09rhs31','Kabu\x20storage\x20↦\x20Cloud\x20◆','2848smGQvg','screenshot','https://api.dropboxapi.com/oauth2/token','Content-Type','Do\x20you\x20want\x20to\x20backup\x20','Cloud\x20↦\x20Kabu\x20storage\x20◆','Restoring...','blob','9653AGPyRB','Error\x20while\x20refreshing\x20token:','application/x-www-form-urlencoded','Download\x20failed\x20for\x20','setRequestHeader','push','location','charAt','DOMContentLoaded','Failed\x20to\x20refresh\x20Dropbox\x20token.','filter','Refreshing\x20token...','length','.tag','Folder\x20created','refreshToken','Do\x20you\x20want\x20to\x20restore\x20','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','knh3uz2mx2hp2eu','stringify','name'];a0_0x15d6=function(){return _0x4933ec;};return a0_0x15d6();}function authorizeWithDropbox(){var _0x308405=a0_0xbcdede,_0x15037f=window['location']['href']['split']('?')[0x0],_0x30516d='code',_0x495c92=_0x308405(0x1bd),_0x303d29=_0x308405(0x1a5)+clientId+'&response_type='+_0x30516d+'&token_access_type='+_0x495c92+_0x308405(0x1c1)+encodeURIComponent(_0x15037f);window[_0x308405(0x187)][_0x308405(0x1c8)]=_0x303d29;}function handleDropboxCallback(){var _0x57ac8f=a0_0xbcdede,_0x338a66=getUrlParameter(_0x57ac8f(0x1cb));_0x338a66?(getAccessToken(_0x338a66),console[_0x57ac8f(0x1a8)](_0x57ac8f(0x1aa),_0x338a66)):console[_0x57ac8f(0x1a8)](_0x57ac8f(0x1df));}function getUrlParameter(_0xb3f696){var _0x11abb2=a0_0xbcdede;_0xb3f696=_0xb3f696['replace'](/[\[]/,'\x5c[')[_0x11abb2(0x1b7)](/[\]]/,'\x5c]');var _0x41637a=new RegExp('[\x5c?&#]'+_0xb3f696+'=([^&#]*)'),_0xe690c5=_0x41637a[_0x11abb2(0x1ba)](location[_0x11abb2(0x1a9)]);return _0xe690c5===null?'':decodeURIComponent(_0xe690c5[0x1][_0x11abb2(0x1b7)](/\+/g,'\x20'));}function getAccessToken(_0x37789d){var _0x413d62=a0_0xbcdede,_0x5a3eec=_0x413d62(0x1b9),_0x4cf83f=window[_0x413d62(0x187)][_0x413d62(0x1c8)][_0x413d62(0x196)]('?')[0x0],_0x4e6361=new XMLHttpRequest();_0x4e6361[_0x413d62(0x1db)](_0x413d62(0x19d),_0x413d62(0x1cc)),_0x4e6361[_0x413d62(0x185)](_0x413d62(0x1e6),_0x413d62(0x183)),_0x4e6361['onload']=function(){var _0x117387=_0x413d62;if(_0x4e6361['status']===0xc8){var _0x3a3d78=JSON[_0x117387(0x199)](_0x4e6361[_0x117387(0x1ac)]),_0x518e4c=_0x3a3d78['access_token'],_0xf99f=_0x3a3d78[_0x117387(0x1c7)],_0x3ad954=_0x3a3d78[_0x117387(0x1cf)];localStorage[_0x117387(0x1d4)](_0x117387(0x1ce),_0x518e4c),localStorage['setItem'](_0x117387(0x190),_0xf99f),localStorage[_0x117387(0x1d4)](_0x117387(0x19c),_0x3ad954);}else console['log']('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x4e6361['send'](_0x413d62(0x1d9)+_0x37789d+_0x413d62(0x1d5)+_0x5a3eec+'&client_id='+clientId+_0x413d62(0x1b3)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x4cf83f));}export async function dpCreateFolder(_0x52050b){var _0x1f07e9=a0_0xbcdede;const _0x6dc78f=localStorage[_0x1f07e9(0x1c2)](_0x1f07e9(0x19c));let _0x791bc5=localStorage[_0x1f07e9(0x1c2)](_0x1f07e9(0x1ce));const _0x1af926='/'+_0x6dc78f+'/'+_0x52050b,_0x540e23=JSON['stringify']({'path':_0x1af926,'autorename':![]});for(let _0x38655a=0x0;_0x38655a<0x2;_0x38655a++){try{const _0x1ad684=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x1f07e9(0x19d),'headers':{'Authorization':_0x1f07e9(0x1a4)+_0x791bc5,'Content-Type':_0x1f07e9(0x1d8)},'body':_0x540e23});if(_0x1ad684[_0x1f07e9(0x1d7)]===0x191){const _0xb132fa=await dpRefreshToken();if(!_0xb132fa)throw new Error(_0x1f07e9(0x1a3));_0x791bc5=localStorage['getItem'](_0x1f07e9(0x1ce));continue;}if(_0x1ad684[_0x1f07e9(0x1d7)]===0x199)return{'message':_0x1f07e9(0x1ca),'path':_0x52050b};if(!_0x1ad684['ok'])throw new Error(_0x1f07e9(0x1a6)+_0x52050b);const _0x50c1f3=await _0x1ad684[_0x1f07e9(0x1b2)]();return await lockNoti(_0x1f07e9(0x18f),'',0xbb8),_0x50c1f3;}catch(_0xd9ba69){if(_0x38655a===0x1)throw _0xd9ba69;}}return![];}export async function dpRefreshToken(){var _0x100486=a0_0xbcdede;if(!localStorage[_0x100486(0x1c2)]('refreshToken'))throw'No\x20refresh\x20token';try{const _0x4c44ac=await fetch(_0x100486(0x1e5),{'method':_0x100486(0x19d),'headers':{'Content-Type':_0x100486(0x183)},'body':'refresh_token='+localStorage[_0x100486(0x1c2)](_0x100486(0x190))+_0x100486(0x192)}),_0x476ca5=await _0x4c44ac['json']();if(!_0x476ca5[_0x100486(0x1d6)])return localStorage[_0x100486(0x1d4)](_0x100486(0x1ce),_0x476ca5[_0x100486(0x1a2)]),await lockNoti(_0x100486(0x18c),'',0xbb8),await delay(0x3e8),!![];else alert(_0x476ca5[_0x100486(0x1b0)]||_0x100486(0x18a));}catch(_0x487585){console[_0x100486(0x1d6)](_0x100486(0x182),_0x487585);}return![];}export async function dpUploadFile(_0x47589f,_0x34fc64,_0x149e50){var _0x4a2fc8=a0_0xbcdede;const _0x232c2a=localStorage['getItem']('uId');var _0x3e36f6=JSON[_0x4a2fc8(0x194)]({'autorename':!![],'mode':_0x4a2fc8(0x1de),'mute':!![],'strict_conflict':![],'path':'/'+_0x232c2a+'/'+_0x149e50+'/'+_0x47589f}),_0x2d2964=new Blob([_0x34fc64],{'type':'application/octet-stream'});for(var _0x2161e5=0x0;_0x2161e5<0x2;_0x2161e5++){var _0x3c300=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x4a2fc8(0x19d),'headers':{'Authorization':_0x4a2fc8(0x1a4)+localStorage['getItem']('accessToken'),'Dropbox-API-Arg':_0x3e36f6,'Content-Type':_0x4a2fc8(0x1c6)},'body':_0x2d2964});if(_0x3c300['status']!=0xc8){if(_0x3c300[_0x4a2fc8(0x1d7)]==0x191){var _0x5e7566=await dpRefreshToken();if(!_0x5e7566)throw _0x4a2fc8(0x1a3);continue;}else throw _0x4a2fc8(0x1ae)+_0x3c300[_0x4a2fc8(0x1d7)];}else{var _0x38114c=await _0x3c300[_0x4a2fc8(0x1b2)]();return console[_0x4a2fc8(0x1a8)](_0x4a2fc8(0x1e2),_0x47589f),_0x38114c;}}return![];}export async function dpDownloadFile(_0x5f4ce2,_0x52c731){var _0x536092=a0_0xbcdede;const _0x226eae=localStorage[_0x536092(0x1c2)](_0x536092(0x19c));var _0xcc8eb8=JSON[_0x536092(0x194)]({'path':'/'+_0x226eae+'/'+_0x52c731+'/'+_0x5f4ce2});for(var _0x1fedab=0x0;_0x1fedab<0x2;_0x1fedab++){var _0x58b849=await fetch(_0x536092(0x1e0),{'method':'POST','headers':{'Authorization':_0x536092(0x1a4)+localStorage['getItem'](_0x536092(0x1ce)),'Dropbox-API-Arg':_0xcc8eb8}});if(_0x58b849['status']!=0xc8){if(_0x58b849[_0x536092(0x1d7)]==0x191){var _0x321ca0=await dpRefreshToken();if(!_0x321ca0)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x58b849[_0x536092(0x1d7)];}const _0x1773c8=new File([await _0x58b849[_0x536092(0x1ea)]()],_0x5f4ce2);return console[_0x536092(0x1a8)](_0x536092(0x1e8),_0x1773c8['name']),a0_0x23af77[_0x536092(0x19e)](_0x1773c8,()=>{}),_0x1773c8;}return![];}document['addEventListener'](a0_0xbcdede(0x189),function(){var _0x10008b=a0_0xbcdede;dropboxRestore[_0x10008b(0x1c4)]('click',async function(){var _0x36578a=_0x10008b;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x4ffcee=localStorage[_0x36578a(0x1c2)](_0x36578a(0x19c)),_0x3f2411=[_0x36578a(0x19b),'save','screenshot'];if(!_0x4ffcee){window[_0x36578a(0x1dd)]('Cloud\x20login\x20required!');return;}let _0x1f51de=[];for(const _0x52da68 of _0x3f2411){let _0x1a0b8e={'path':'/'+_0x4ffcee+'/'+_0x52da68};for(let _0x3189cf=0x0;_0x3189cf<0x2;_0x3189cf++){let _0x5acd2b=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x36578a(0x19d),'headers':{'Authorization':_0x36578a(0x1a4)+localStorage[_0x36578a(0x1c2)]('accessToken'),'Content-Type':_0x36578a(0x1d8)},'body':JSON[_0x36578a(0x194)](_0x1a0b8e)});if(_0x5acd2b[_0x36578a(0x1d7)]===0xc8){let _0x9e19b2=await _0x5acd2b[_0x36578a(0x1b2)](),_0x4315e2=_0x9e19b2['entries'][_0x36578a(0x18b)](_0x2cb6e1=>_0x2cb6e1[_0x36578a(0x18e)]==='file');_0x4315e2[_0x36578a(0x18d)]>0x0&&_0x1f51de[_0x36578a(0x186)](..._0x4315e2[_0x36578a(0x1b4)](_0x425ced=>({'name':_0x425ced[_0x36578a(0x195)],'folder':_0x52da68})));break;}else{if(_0x5acd2b['status']===0x191){let _0x5abdc4=await dpRefreshToken();if(!_0x5abdc4)throw _0x36578a(0x1a3);}else{console[_0x36578a(0x1d6)](_0x36578a(0x184)+_0x52da68+',\x20status:\x20'+_0x5acd2b['status']);break;}}}}if(_0x1f51de[_0x36578a(0x18d)]>0x0){const _0x2f49f4=_0x36578a(0x191)+_0x1f51de[_0x36578a(0x18d)]+_0x36578a(0x1bf);if(window[_0x36578a(0x19f)](_0x2f49f4))for(const _0x4de391 of _0x1f51de){await lockNoti(_0x36578a(0x1e9),_0x4de391[_0x36578a(0x195)],0xbb8),await dpDownloadFile(_0x4de391[_0x36578a(0x195)],_0x4de391[_0x36578a(0x1bc)]);}else console[_0x36578a(0x1a8)]('Restore\x20canceled\x20by\x20user.');}else console[_0x36578a(0x1a8)](_0x36578a(0x197));}),dropboxBackup[_0x10008b(0x1c4)](_0x10008b(0x1b1),async function(){var _0x720f5a=_0x10008b;await lockNoti(_0x720f5a(0x1cd),'',0x1388);const _0x1c9dee=localStorage[_0x720f5a(0x1c2)](_0x720f5a(0x19c));if(_0x1c9dee===null||_0x1c9dee==='')window[_0x720f5a(0x1dd)](_0x720f5a(0x1b6));else{const _0x2d686c=[_0x720f5a(0x19b),_0x720f5a(0x1bb),_0x720f5a(0x1e4)];for(const _0x4d07a0 of _0x2d686c){await dpCreateFolder(_0x4d07a0);}let _0x311259=0x0;for(const _0xd27af9 of _0x2d686c){const _0x448ed3=a0_0x23af77['list'+(_0xd27af9[_0x720f5a(0x188)](0x0)[_0x720f5a(0x1d1)]()+_0xd27af9[_0x720f5a(0x198)](0x1))]();_0x311259+=_0x448ed3[_0x720f5a(0x18d)];}if(window[_0x720f5a(0x19f)](_0x720f5a(0x1e7)+_0x311259+_0x720f5a(0x1b8)))for(const _0x12aa6d of _0x2d686c){const _0x1acedc=a0_0x23af77[_0x720f5a(0x1dc)+(_0x12aa6d['charAt'](0x0)[_0x720f5a(0x1d1)]()+_0x12aa6d[_0x720f5a(0x198)](0x1))]();for(const _0x1469c5 of _0x1acedc){const _0xe538b0=await a0_0x23af77[_0x720f5a(0x1c3)]('/data/'+_0x12aa6d+'s/'+_0x1469c5);try{await lockNoti(_0x720f5a(0x1a0),_0x1469c5,0xbb8),await dpUploadFile(_0x1469c5,_0xe538b0,_0x12aa6d);}catch(_0x200c18){console[_0x720f5a(0x1d6)](_0x720f5a(0x1c0)+_0x1469c5+':',_0x200c18);}}}else console[_0x720f5a(0x1a8)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x10008b(0x1c4)](_0x10008b(0x1b1),function(){var _0x2e63d7=_0x10008b;const _0x4b7e17=localStorage[_0x2e63d7(0x1c2)](_0x2e63d7(0x19c));_0x4b7e17===null||_0x4b7e17===''?authorizeWithDropbox():window[_0x2e63d7(0x19f)](_0x2e63d7(0x1da))&&(localStorage[_0x2e63d7(0x1d4)](_0x2e63d7(0x19c),''),dropboxRestore[_0x2e63d7(0x1d2)][_0x2e63d7(0x1ab)](_0x2e63d7(0x1ad)),dropboxBackup['classList'][_0x2e63d7(0x1ab)](_0x2e63d7(0x1ad)),dropboxCloud['classList'][_0x2e63d7(0x1ab)]('active'));}),handleDropboxCallback();});