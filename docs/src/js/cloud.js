var a0_0x44f564=a0_0x2759;(function(_0x5eaf14,_0x19fa24){var _0x24636a=a0_0x2759,_0x2930db=_0x5eaf14();while(!![]){try{var _0x2fb806=-parseInt(_0x24636a(0x1eb))/0x1+-parseInt(_0x24636a(0x20f))/0x2+parseInt(_0x24636a(0x212))/0x3+parseInt(_0x24636a(0x1e0))/0x4+parseInt(_0x24636a(0x222))/0x5*(parseInt(_0x24636a(0x1c8))/0x6)+-parseInt(_0x24636a(0x224))/0x7+parseInt(_0x24636a(0x20e))/0x8;if(_0x2fb806===_0x19fa24)break;else _0x2930db['push'](_0x2930db['shift']());}catch(_0x283e4d){_0x2930db['push'](_0x2930db['shift']());}}}(a0_0x1c30,0x6560e));import*as a0_0xfcfae9 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x44f564(0x20a),clientSecret=a0_0x44f564(0x1cc);function a0_0x2759(_0xa5d878,_0x5c670d){var _0x1c30b8=a0_0x1c30();return a0_0x2759=function(_0x27594a,_0x1e1a7a){_0x27594a=_0x27594a-0x1c2;var _0x4692b7=_0x1c30b8[_0x27594a];return _0x4692b7;},a0_0x2759(_0xa5d878,_0x5c670d);}function authorizeWithDropbox(){var _0xfdb960=a0_0x44f564,_0x51bcbb=window[_0xfdb960(0x1f3)][_0xfdb960(0x1ee)][_0xfdb960(0x202)]('?')[0x0],_0x1c695f=_0xfdb960(0x1da),_0x14b994=_0xfdb960(0x1ed),_0x2d9575='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0xfdb960(0x204)+_0x1c695f+_0xfdb960(0x1f2)+_0x14b994+_0xfdb960(0x209)+encodeURIComponent(_0x51bcbb);window[_0xfdb960(0x1f3)][_0xfdb960(0x1ee)]=_0x2d9575;}function handleDropboxCallback(){var _0x2a6890=a0_0x44f564,_0x1e8a12=getUrlParameter('code');_0x1e8a12?(getAccessToken(_0x1e8a12),console[_0x2a6890(0x1fe)](_0x2a6890(0x1e8),_0x1e8a12)):console[_0x2a6890(0x1fe)](_0x2a6890(0x1c5));}function getUrlParameter(_0x242f7a){var _0x4c57b1=a0_0x44f564;_0x242f7a=_0x242f7a[_0x4c57b1(0x1e1)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x158dce=new RegExp('[\x5c?&#]'+_0x242f7a+_0x4c57b1(0x1f4)),_0x3f83f1=_0x158dce['exec'](location[_0x4c57b1(0x213)]);return _0x3f83f1===null?'':decodeURIComponent(_0x3f83f1[0x1][_0x4c57b1(0x1e1)](/\+/g,'\x20'));}function getAccessToken(_0x5cfd94){var _0x490597=a0_0x44f564,_0x41b973=_0x490597(0x1c2),_0xf67817=window[_0x490597(0x1f3)][_0x490597(0x1ee)]['split']('?')[0x0],_0x41d737=new XMLHttpRequest();_0x41d737[_0x490597(0x205)](_0x490597(0x211),_0x490597(0x1cf)),_0x41d737[_0x490597(0x1df)]('Content-Type',_0x490597(0x1d2)),_0x41d737[_0x490597(0x1d0)]=function(){var _0xe06941=_0x490597;if(_0x41d737[_0xe06941(0x20b)]===0xc8){var _0x1acd13=JSON[_0xe06941(0x1d6)](_0x41d737['responseText']),_0x5c7b6f=_0x1acd13[_0xe06941(0x21d)],_0x349c78=_0x1acd13['refresh_token'],_0x102f86=_0x1acd13['uid'];localStorage[_0xe06941(0x1d5)](_0xe06941(0x1ec),_0x5c7b6f),localStorage[_0xe06941(0x1d5)]('refreshToken',_0x349c78),localStorage[_0xe06941(0x1d5)](_0xe06941(0x1fd),_0x102f86);}else console['log'](_0xe06941(0x1f9));},_0x41d737['send'](_0x490597(0x21f)+_0x5cfd94+_0x490597(0x1ea)+_0x41b973+_0x490597(0x1cd)+clientId+_0x490597(0x221)+clientSecret+_0x490597(0x209)+encodeURIComponent(_0xf67817));}export async function dpCreateFolder(_0x5f3abc){var _0x7136f=a0_0x44f564;const _0x38244b=localStorage[_0x7136f(0x1d1)]('uId');let _0x593ac0=localStorage['getItem'](_0x7136f(0x1ec));const _0x2c504c='/'+_0x38244b+'/'+_0x5f3abc,_0x49b4ca=JSON[_0x7136f(0x216)]({'path':_0x2c504c,'autorename':![]});for(let _0x23071c=0x0;_0x23071c<0x2;_0x23071c++){try{const _0x5df6d5=await fetch(_0x7136f(0x217),{'method':_0x7136f(0x211),'headers':{'Authorization':_0x7136f(0x201)+_0x593ac0,'Content-Type':'application/json'},'body':_0x49b4ca});if(_0x5df6d5[_0x7136f(0x20b)]===0x191){const _0x27527a=await dpRefreshToken();if(!_0x27527a)throw new Error(_0x7136f(0x210));_0x593ac0=localStorage[_0x7136f(0x1d1)](_0x7136f(0x1ec));continue;}if(_0x5df6d5['status']===0x199)return{'message':'Folder\x20already\x20exists','path':_0x5f3abc};if(!_0x5df6d5['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x5f3abc);const _0x47a8d9=await _0x5df6d5[_0x7136f(0x1d8)]();return await lockNoti('Folder\x20created','',0xbb8),_0x47a8d9;}catch(_0x4c91ae){if(_0x23071c===0x1)throw _0x4c91ae;}}return![];}export async function dpRefreshToken(){var _0x3a773e=a0_0x44f564;if(!localStorage['getItem'](_0x3a773e(0x1d3)))throw _0x3a773e(0x1e3);try{const _0x17b43b=await fetch(_0x3a773e(0x203),{'method':'POST','headers':{'Content-Type':_0x3a773e(0x1d2)},'body':_0x3a773e(0x223)+localStorage[_0x3a773e(0x1d1)](_0x3a773e(0x1d3))+_0x3a773e(0x20c)}),_0x5a9071=await _0x17b43b[_0x3a773e(0x1d8)]();if(!_0x5a9071[_0x3a773e(0x1dd)])return localStorage[_0x3a773e(0x1d5)]('accessToken',_0x5a9071['access_token']),await lockNoti(_0x3a773e(0x20d),'',0xbb8),await delay(0x3e8),!![];else alert(_0x5a9071[_0x3a773e(0x1c9)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x902185){console['error'](_0x3a773e(0x219),_0x902185);}return![];}function a0_0x1c30(){var _0x3c5c89=['&grant_type=','353779jcdFRW','accessToken','offline','href','uploadFileInCloud','screenshot','length','&token_access_type=','location','=([^&#]*)','https://content.dropboxapi.com/2/files/upload','Cloud\x20↦\x20Kabu\x20storage\x20◆','/data/','file','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','slice','filter',',\x20status:\x20','uId','log','Restoring...','https://api.dropboxapi.com/2/files/list_folder','Bearer\x20','split','https://api.dropboxapi.com/oauth2/token','&response_type=','open','.tag','alert','Download\x20failed,\x20unknown\x20http\x20status:','&redirect_uri=','knh3uz2mx2hp2eu','status','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Refreshing\x20token...','7819008WlFzgJ','988574cDSQzW','Unable\x20to\x20refresh\x20token','POST','551418WpRGbs','search','Restore\x20canceled\x20by\x20user.','active','stringify','https://api.dropboxapi.com/2/files/create_folder_v2','list','Error\x20while\x20refreshing\x20token:','state','Download\x20failed\x20for\x20','application/octet-stream','access_token','Do\x20you\x20want\x20to\x20restore\x20','code=','name','&client_secret=','2297895mHQqly','refresh_token=','4177362kVRBlY','authorization_code','application/json','click','Do\x20not\x20receive\x20authorization','save','https://content.dropboxapi.com/2/files/download','6bRfyCU','error_description','Backing\x20up...','charAt','nwb3dnfh09rhs31','&client_id=','toUpperCase','https://api.dropbox.com/oauth2/token','onload','getItem','application/x-www-form-urlencoded','refreshToken','remove','setItem','parse','downloadFileInCloud','json','DOMContentLoaded','code','confirm','Cloud\x20login\x20required!','error','Kabu\x20storage\x20↦\x20Cloud\x20◆','setRequestHeader','957268cqgyco','replace','Wait\x20a\x20little\x20bit...','No\x20refresh\x20token','map','classList','\x20files\x20in\x20Kabu?','addEventListener','Authorization\x20Code:','\x20files\x20from\x20Cloud?'];a0_0x1c30=function(){return _0x3c5c89;};return a0_0x1c30();}export async function dpUploadFile(_0x24f0b6,_0x2cf8ab,_0x15b863){var _0x33ef2f=a0_0x44f564;const _0x1e337c=localStorage[_0x33ef2f(0x1d1)](_0x33ef2f(0x1fd));var _0x595184=JSON[_0x33ef2f(0x216)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x1e337c+'/'+_0x15b863+'/'+_0x24f0b6}),_0x5b4a64=new Blob([_0x2cf8ab],{'type':_0x33ef2f(0x21c)});for(var _0x1c6e77=0x0;_0x1c6e77<0x2;_0x1c6e77++){var _0x42207d=await fetch(_0x33ef2f(0x1f5),{'method':_0x33ef2f(0x211),'headers':{'Authorization':_0x33ef2f(0x201)+localStorage[_0x33ef2f(0x1d1)](_0x33ef2f(0x1ec)),'Dropbox-API-Arg':_0x595184,'Content-Type':_0x33ef2f(0x21c)},'body':_0x5b4a64});if(_0x42207d[_0x33ef2f(0x20b)]!=0xc8){if(_0x42207d['status']==0x191){var _0x194cde=await dpRefreshToken();if(!_0x194cde)throw _0x33ef2f(0x210);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x42207d[_0x33ef2f(0x20b)];}else{var _0x275469=await _0x42207d[_0x33ef2f(0x1d8)]();return console['log'](_0x33ef2f(0x1de),_0x24f0b6),_0x275469;}}return![];}export async function dpDownloadFile(_0x412a3b,_0x1eafcb){var _0x363b65=a0_0x44f564;const _0x211d4c=localStorage[_0x363b65(0x1d1)](_0x363b65(0x1fd));var _0x1cf498=JSON['stringify']({'path':'/'+_0x211d4c+'/'+_0x1eafcb+'/'+_0x412a3b});for(var _0x2182d3=0x0;_0x2182d3<0x2;_0x2182d3++){var _0x3dc030=await fetch(_0x363b65(0x1c7),{'method':_0x363b65(0x211),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x363b65(0x1d1)](_0x363b65(0x1ec)),'Dropbox-API-Arg':_0x1cf498}});if(_0x3dc030[_0x363b65(0x20b)]!=0xc8){if(_0x3dc030['status']==0x191){var _0x16c248=await dpRefreshToken();if(!_0x16c248)throw _0x363b65(0x210);continue;}else throw _0x363b65(0x208)+_0x3dc030[_0x363b65(0x20b)];}const _0x49751a=new File([await _0x3dc030['blob']()],_0x412a3b);return console[_0x363b65(0x1fe)](_0x363b65(0x1f6),_0x49751a['name']),a0_0xfcfae9[_0x363b65(0x1ef)](_0x49751a,()=>{}),_0x49751a;}return![];}document[a0_0x44f564(0x1e7)](a0_0x44f564(0x1d9),function(){var _0x3a86af=a0_0x44f564;dropboxRestore[_0x3a86af(0x1e7)](_0x3a86af(0x1c4),async function(){var _0x4c5da9=_0x3a86af;await lockNoti(_0x4c5da9(0x1e2),'',0x1388);const _0x1fabcf=localStorage[_0x4c5da9(0x1d1)](_0x4c5da9(0x1fd)),_0x4e2189=[_0x4c5da9(0x21a),_0x4c5da9(0x1c6),'screenshot'];if(!_0x1fabcf){window[_0x4c5da9(0x207)](_0x4c5da9(0x1dc));return;}let _0x3ce284=[];for(const _0x13fcb1 of _0x4e2189){let _0x24a548={'path':'/'+_0x1fabcf+'/'+_0x13fcb1};for(let _0x374e95=0x0;_0x374e95<0x2;_0x374e95++){let _0xedb2d4=await fetch(_0x4c5da9(0x200),{'method':_0x4c5da9(0x211),'headers':{'Authorization':_0x4c5da9(0x201)+localStorage['getItem'](_0x4c5da9(0x1ec)),'Content-Type':_0x4c5da9(0x1c3)},'body':JSON[_0x4c5da9(0x216)](_0x24a548)});if(_0xedb2d4[_0x4c5da9(0x20b)]===0xc8){let _0x3c9624=await _0xedb2d4[_0x4c5da9(0x1d8)](),_0x584d4f=_0x3c9624['entries'][_0x4c5da9(0x1fb)](_0x156dde=>_0x156dde[_0x4c5da9(0x206)]===_0x4c5da9(0x1f8));_0x584d4f[_0x4c5da9(0x1f1)]>0x0&&_0x3ce284['push'](..._0x584d4f[_0x4c5da9(0x1e4)](_0x426545=>({'name':_0x426545[_0x4c5da9(0x220)],'folder':_0x13fcb1})));break;}else{if(_0xedb2d4[_0x4c5da9(0x20b)]===0x191){let _0x30421d=await dpRefreshToken();if(!_0x30421d)throw _0x4c5da9(0x210);}else{console[_0x4c5da9(0x1dd)](_0x4c5da9(0x21b)+_0x13fcb1+_0x4c5da9(0x1fc)+_0xedb2d4[_0x4c5da9(0x20b)]);break;}}}}if(_0x3ce284[_0x4c5da9(0x1f1)]>0x0){const _0xb93f9e=_0x4c5da9(0x21e)+_0x3ce284[_0x4c5da9(0x1f1)]+_0x4c5da9(0x1e9);if(window[_0x4c5da9(0x1db)](_0xb93f9e))for(const _0x572e3c of _0x3ce284){await lockNoti(_0x4c5da9(0x1ff),_0x572e3c['name'],0xbb8),await dpDownloadFile(_0x572e3c[_0x4c5da9(0x220)],_0x572e3c['folder']);}else console[_0x4c5da9(0x1fe)]('Restore\x20canceled\x20by\x20user.');}else console[_0x4c5da9(0x1fe)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x3a86af(0x1e7)](_0x3a86af(0x1c4),async function(){var _0x2b91d3=_0x3a86af;await lockNoti(_0x2b91d3(0x1e2),'',0x1388);const _0xaab078=localStorage[_0x2b91d3(0x1d1)](_0x2b91d3(0x1fd));if(_0xaab078===null||_0xaab078==='')window[_0x2b91d3(0x207)](_0x2b91d3(0x1dc));else{const _0x30f609=[_0x2b91d3(0x21a),'save',_0x2b91d3(0x1f0)];for(const _0x3d262a of _0x30f609){await dpCreateFolder(_0x3d262a);}let _0x2ad126=0x0;for(const _0x3678ae of _0x30f609){const _0x44ed50=a0_0xfcfae9[_0x2b91d3(0x218)+(_0x3678ae[_0x2b91d3(0x1cb)](0x0)[_0x2b91d3(0x1ce)]()+_0x3678ae[_0x2b91d3(0x1fa)](0x1))]();_0x2ad126+=_0x44ed50[_0x2b91d3(0x1f1)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x2ad126+_0x2b91d3(0x1e6)))for(const _0x250f3a of _0x30f609){const _0x179fe7=a0_0xfcfae9['list'+(_0x250f3a[_0x2b91d3(0x1cb)](0x0)[_0x2b91d3(0x1ce)]()+_0x250f3a[_0x2b91d3(0x1fa)](0x1))]();for(const _0x1d4476 of _0x179fe7){const _0xdd1a04=await a0_0xfcfae9[_0x2b91d3(0x1d7)](_0x2b91d3(0x1f7)+_0x250f3a+'s/'+_0x1d4476);try{await lockNoti(_0x2b91d3(0x1ca),_0x1d4476,0xbb8),await dpUploadFile(_0x1d4476,_0xdd1a04,_0x250f3a);}catch(_0xb04e80){console[_0x2b91d3(0x1dd)]('Failed\x20to\x20upload\x20file\x20'+_0x1d4476+':',_0xb04e80);}}}else console[_0x2b91d3(0x1fe)](_0x2b91d3(0x214));}}),dropboxCloud[_0x3a86af(0x1e7)](_0x3a86af(0x1c4),function(){var _0x587891=_0x3a86af;const _0x42b047=localStorage[_0x587891(0x1d1)](_0x587891(0x1fd));_0x42b047===null||_0x42b047===''?authorizeWithDropbox():window[_0x587891(0x1db)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x587891(0x1d5)](_0x587891(0x1fd),''),dropboxRestore[_0x587891(0x1e5)]['remove'](_0x587891(0x215)),dropboxBackup[_0x587891(0x1e5)][_0x587891(0x1d4)]('active'),dropboxCloud[_0x587891(0x1e5)][_0x587891(0x1d4)](_0x587891(0x215)));}),handleDropboxCallback();});