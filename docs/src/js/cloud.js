var a0_0x3676f1=a0_0xa756;(function(_0xb45618,_0x35e2a1){var _0x55c044=a0_0xa756,_0x2221af=_0xb45618();while(!![]){try{var _0x56ff34=-parseInt(_0x55c044(0xc2))/0x1*(-parseInt(_0x55c044(0x111))/0x2)+parseInt(_0x55c044(0x119))/0x3*(-parseInt(_0x55c044(0xfc))/0x4)+-parseInt(_0x55c044(0xdb))/0x5+parseInt(_0x55c044(0xe2))/0x6*(parseInt(_0x55c044(0xeb))/0x7)+parseInt(_0x55c044(0xf2))/0x8*(parseInt(_0x55c044(0x125))/0x9)+parseInt(_0x55c044(0xc3))/0xa*(-parseInt(_0x55c044(0x112))/0xb)+-parseInt(_0x55c044(0x11b))/0xc*(-parseInt(_0x55c044(0x12e))/0xd);if(_0x56ff34===_0x35e2a1)break;else _0x2221af['push'](_0x2221af['shift']());}catch(_0x17b948){_0x2221af['push'](_0x2221af['shift']());}}}(a0_0x218d,0x6c77f));import*as a0_0x4d1d98 from'./main.js';import{localStorageFile}from'./storage.js';function a0_0x218d(){var _0x5364dc=['8812IDkHFQ','authorization_code','confirm','.gba_slot','accessToken','Kabu\x20storage\x20↦\x20Cloud\x20◆','error_description','.gba_imageState','state','Error\x20while\x20refreshing\x20token:','click','list','Download\x20failed,\x20unknown\x20http\x20status:','overwrite','gba','getItem','status','Bearer\x20','classList','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','text/plain','2nhykzA','609653MIxVMo','href','https://www.dropbox.com/oauth2/authorize?client_id=','Content-Type','DOMContentLoaded','.ss0','=([^&#]*)','426onnEpw','log','53256QbvzWb','stringify','slice','code','active','blob','nwb3dnfh09rhs31','Cloud\x20login\x20required!','.tag','Restoring...','4122LfagWj','.ss5','onload','uploadSaveOrSaveState','Do\x20you\x20want\x20to\x20restore\x20','https://api.dropboxapi.com/oauth2/token','offline','entries','knh3uz2mx2hp2eu','3679uPjkKE','.ss7','send','Backing\x20up...','&grant_type=','&token_access_type=','.ss4','setItem','108121pjgsuf','100UUQXde','https://content.dropboxapi.com/2/files/upload','name','[\x5c?&#]','https://api.dropboxapi.com/2/files/list_folder','length','refresh_token=','error','.txt','text','toUpperCase','Upload\x20failed,\x20unknown\x20http\x20status:\x20','Failed\x20to\x20refresh\x20Dropbox\x20token.','_imageState','Do\x20not\x20receive\x20authorization','Unable\x20to\x20refresh\x20token','&redirect_uri=','&client_secret=','https://api.dropbox.com/oauth2/token','https://content.dropboxapi.com/2/files/download','Refreshing\x20token...','uId','lastIndexOf','Cloud\x20↦\x20Kabu\x20storage\x20◆','4121425MjmosE','refresh_token','refreshToken','.ss3','endsWith','POST','alert','6Gkdpfc','_dateState','location','addEventListener','downloadFileInCloud','\x20files\x20in\x20Cloud?','remove','json','code=','5115537IrFBXx','file','charAt','application/json','substring','FSSync','filter','712cCwIjq','&client_id=','access_token','status:\x20','exec','No\x20refresh\x20token','Do\x20you\x20want\x20to\x20logout?','uid','\x20files\x20in\x20Kabu?','application/x-www-form-urlencoded'];a0_0x218d=function(){return _0x5364dc;};return a0_0x218d();}var clientId=a0_0x3676f1(0x12d),clientSecret=a0_0x3676f1(0x121);function authorizeWithDropbox(){var _0x2b8732=a0_0x3676f1,_0x46cb0c=window[_0x2b8732(0xe4)][_0x2b8732(0x113)]['split']('?')[0x0],_0x228ee3='code',_0x3f80fa=_0x2b8732(0x12b),_0x19b383=_0x2b8732(0x114)+clientId+'&response_type='+_0x228ee3+_0x2b8732(0x133)+_0x3f80fa+_0x2b8732(0xd3)+encodeURIComponent(_0x46cb0c);window[_0x2b8732(0xe4)]['href']=_0x19b383;}function handleDropboxCallback(){var _0x5b6aea=a0_0x3676f1,_0x2f34c2=getUrlParameter(_0x5b6aea(0x11e));_0x2f34c2?(getAccessToken(_0x2f34c2),console[_0x5b6aea(0x11a)]('Authorization\x20Code:',_0x2f34c2)):console[_0x5b6aea(0x11a)](_0x5b6aea(0xd1));}function a0_0xa756(_0x340ae4,_0x290b46){var _0x218d7d=a0_0x218d();return a0_0xa756=function(_0xa75636,_0x61110b){_0xa75636=_0xa75636-0xc0;var _0x40d1e4=_0x218d7d[_0xa75636];return _0x40d1e4;},a0_0xa756(_0x340ae4,_0x290b46);}function getUrlParameter(_0x330908){var _0x57d569=a0_0x3676f1;_0x330908=_0x330908['replace'](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x446dfc=new RegExp(_0x57d569(0xc6)+_0x330908+_0x57d569(0x118)),_0x4601b7=_0x446dfc[_0x57d569(0xf6)](location['search']);return _0x4601b7===null?'':decodeURIComponent(_0x4601b7[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x41e346){var _0x37a31f=a0_0x3676f1,_0x34aa3a=_0x37a31f(0xfd),_0x459c87=window[_0x37a31f(0xe4)][_0x37a31f(0x113)]['split']('?')[0x0],_0x517c60=new XMLHttpRequest();_0x517c60['open'](_0x37a31f(0xe0),_0x37a31f(0xd5)),_0x517c60['setRequestHeader'](_0x37a31f(0x115),'application/x-www-form-urlencoded'),_0x517c60[_0x37a31f(0x127)]=function(){var _0x1273e6=_0x37a31f;if(_0x517c60[_0x1273e6(0x10c)]===0xc8){var _0x129489=JSON['parse'](_0x517c60['responseText']),_0x19f730=_0x129489['access_token'],_0x1393bf=_0x129489[_0x1273e6(0xdc)],_0x1c4a76=_0x129489[_0x1273e6(0xf9)];localStorage[_0x1273e6(0xc1)](_0x1273e6(0x100),_0x19f730),localStorage['setItem']('refreshToken',_0x1393bf),localStorage[_0x1273e6(0xc1)](_0x1273e6(0xd8),_0x1c4a76);}else console[_0x1273e6(0x11a)](_0x1273e6(0x10f));},_0x517c60[_0x37a31f(0x130)](_0x37a31f(0xea)+_0x41e346+_0x37a31f(0x132)+_0x34aa3a+_0x37a31f(0xf3)+clientId+_0x37a31f(0xd4)+clientSecret+_0x37a31f(0xd3)+encodeURIComponent(_0x459c87));}export async function dpRefreshToken(){var _0x57f5dc=a0_0x3676f1;if(!localStorage[_0x57f5dc(0x10b)](_0x57f5dc(0xdd)))throw _0x57f5dc(0xf7);try{const _0x3496ea=await fetch(_0x57f5dc(0x12a),{'method':_0x57f5dc(0xe0),'headers':{'Content-Type':_0x57f5dc(0xfb)},'body':_0x57f5dc(0xc9)+localStorage[_0x57f5dc(0x10b)](_0x57f5dc(0xdd))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x3faaef=await _0x3496ea[_0x57f5dc(0xe9)]();if(!_0x3faaef[_0x57f5dc(0xca)])return localStorage['setItem'](_0x57f5dc(0x100),_0x3faaef[_0x57f5dc(0xf4)]),await lockNoti('',_0x57f5dc(0xd7),0xbb8),await delay(0x3e8),!![];else alert(_0x3faaef[_0x57f5dc(0x102)]||_0x57f5dc(0xcf));}catch(_0x2081b4){console[_0x57f5dc(0xca)](_0x57f5dc(0x105),_0x2081b4);}return![];}export async function dpUploadFile(_0x4b374a,_0x5a3aca){var _0x3dc02e=a0_0x3676f1;const _0x37ff50=localStorage['getItem']('uId');var _0x581da5=JSON[_0x3dc02e(0x11c)]({'autorename':!![],'mode':_0x3dc02e(0x109),'mute':!![],'strict_conflict':![],'path':'/'+_0x37ff50+'/'+_0x4b374a}),_0x59e044=new Blob([_0x5a3aca],{'type':'application/octet-stream'});for(var _0x556208=0x0;_0x556208<0x2;_0x556208++){var _0x21eac2=await fetch(_0x3dc02e(0xc4),{'method':'POST','headers':{'Authorization':_0x3dc02e(0x10d)+localStorage[_0x3dc02e(0x10b)](_0x3dc02e(0x100)),'Dropbox-API-Arg':_0x581da5,'Content-Type':'application/octet-stream'},'body':_0x59e044});if(_0x21eac2[_0x3dc02e(0x10c)]!=0xc8){if(_0x21eac2[_0x3dc02e(0x10c)]==0x191){var _0x45a1b6=await dpRefreshToken();if(!_0x45a1b6)throw _0x3dc02e(0xd2);continue;}else throw _0x3dc02e(0xce)+_0x21eac2[_0x3dc02e(0x10c)];}else{var _0x4e924a=await _0x21eac2[_0x3dc02e(0xe9)]();return console[_0x3dc02e(0x11a)](_0x3dc02e(0x101),_0x4b374a),_0x4e924a;}}return![];}async function dpDownloadFile(_0x2cc0c1){var _0x1c20d9=a0_0x3676f1;const _0x3c80e2=localStorage[_0x1c20d9(0x10b)](_0x1c20d9(0xd8));var _0x4082ea=JSON[_0x1c20d9(0x11c)]({'path':'/'+_0x3c80e2+'/'+_0x2cc0c1});for(var _0xeb34b0=0x0;_0xeb34b0<0x2;_0xeb34b0++){var _0xa71cc4=await fetch(_0x1c20d9(0xd6),{'method':'POST','headers':{'Authorization':_0x1c20d9(0x10d)+localStorage[_0x1c20d9(0x10b)](_0x1c20d9(0x100)),'Dropbox-API-Arg':_0x4082ea}});if(_0xa71cc4[_0x1c20d9(0x10c)]!=0xc8){if(_0xa71cc4[_0x1c20d9(0x10c)]==0x191){var _0x3a587f=await dpRefreshToken();if(!_0x3a587f)throw _0x1c20d9(0xd2);continue;}else throw _0x1c20d9(0x108)+_0xa71cc4[_0x1c20d9(0x10c)];}const _0x2249e3=new File([await _0xa71cc4[_0x1c20d9(0x120)]()],_0x2cc0c1);console[_0x1c20d9(0x11a)](_0x1c20d9(0xda),_0x2249e3[_0x1c20d9(0xc5)]);if(_0x2cc0c1[_0x1c20d9(0xdf)]('.txt')){const _0x6d67b2=await _0x2249e3[_0x1c20d9(0xcc)](),[_0x10f005,_0xb8ccf8]=_0x6d67b2['split']('\x0a\x0a'),_0x2c41ef=_0x2cc0c1[_0x1c20d9(0xef)](0x0,_0x2cc0c1[_0x1c20d9(0xd9)](_0x1c20d9(0x10a))+0x3),_0x501010=_0x2cc0c1[_0x1c20d9(0xed)](_0x2cc0c1['length']-0x5);localStorage[_0x1c20d9(0xc1)](_0x2c41ef+_0x1c20d9(0xe3)+_0x501010,_0xb8ccf8),localStorage[_0x1c20d9(0xc1)](_0x2c41ef+_0x1c20d9(0xd0)+_0x501010,_0x10f005);}else a0_0x4d1d98[_0x1c20d9(0x128)](_0x2249e3,()=>{var _0x1861ca=_0x1c20d9;localStorageFile(),Module[_0x1861ca(0xf0)]();});return _0x2249e3;}return![];}document[a0_0x3676f1(0xe5)](a0_0x3676f1(0x116),function(){var _0x59d49d=a0_0x3676f1;dropboxRestore['addEventListener'](_0x59d49d(0x106),async function(){var _0x15557d=_0x59d49d;const _0x201f96=localStorage['getItem'](_0x15557d(0xd8));if(_0x201f96===null||_0x201f96==='')window[_0x15557d(0xe1)](_0x15557d(0x122));else{var _0xbfb200={'path':'/'+_0x201f96};for(var _0x4934cd=0x0;_0x4934cd<0x2;_0x4934cd++){var _0xc34d61=await fetch(_0x15557d(0xc7),{'method':'POST','headers':{'Authorization':_0x15557d(0x10d)+localStorage[_0x15557d(0x10b)](_0x15557d(0x100)),'Content-Type':_0x15557d(0xee)},'body':JSON[_0x15557d(0x11c)](_0xbfb200)});console[_0x15557d(0x11a)](_0x15557d(0xf5),_0xc34d61[_0x15557d(0x10c)]);if(_0xc34d61['status']!=0xc8){if(_0xc34d61[_0x15557d(0x10c)]==0x191){var _0x328c38=await dpRefreshToken();if(!_0x328c38)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:\x20'+_0xc34d61['status'];}else{const _0x407b95=await _0xc34d61[_0x15557d(0xe9)](),_0x1f7920=_0x407b95[_0x15557d(0x12c)][_0x15557d(0xf1)](_0x4a3987=>_0x4a3987[_0x15557d(0x123)]===_0x15557d(0xec))[_0x15557d(0xc8)],_0x1ed7b7=_0x15557d(0x129)+_0x1f7920+_0x15557d(0xe7);if(window[_0x15557d(0xfe)](_0x1ed7b7))for(const _0x30ec01 of _0x407b95['entries']){_0x30ec01['.tag']===_0x15557d(0xec)&&(await lockNoti(_0x15557d(0x124),_0x30ec01[_0x15557d(0xc5)],0xbb8),await dpDownloadFile(_0x30ec01[_0x15557d(0xc5)]));}else console[_0x15557d(0x11a)]('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup['addEventListener'](_0x59d49d(0x106),async function(){var _0x4ac1df=_0x59d49d;const _0x94cd9b=localStorage['getItem'](_0x4ac1df(0xd8));if(_0x94cd9b===null||_0x94cd9b==='')window[_0x4ac1df(0xe1)]('Cloud\x20login\x20required!');else{const _0x41bdea=[_0x4ac1df(0x104),'save'];let _0x5d3aec=0x0;for(const _0x599f2a of _0x41bdea){const _0x231653=a0_0x4d1d98[_0x4ac1df(0x107)+(_0x599f2a['charAt'](0x0)[_0x4ac1df(0xcd)]()+_0x599f2a['slice'](0x1))]();_0x5d3aec+=_0x231653[_0x4ac1df(0xc8)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x5d3aec+_0x4ac1df(0xfa)))for(const _0x5f11b7 of _0x41bdea){const _0x1e58f4=a0_0x4d1d98[_0x4ac1df(0x107)+(_0x5f11b7['charAt'](0x0)[_0x4ac1df(0xcd)]()+_0x5f11b7[_0x4ac1df(0x11d)](0x1))]();for(const _0x35779e of _0x1e58f4){const _0x2c6364=await a0_0x4d1d98[_0x4ac1df(0xe6)]('/data/'+_0x5f11b7+'s/'+_0x35779e);try{await lockNoti(_0x4ac1df(0x131),_0x35779e,0xbb8),await dpUploadFile(_0x35779e,_0x2c6364);if(_0x35779e[_0x4ac1df(0xdf)](_0x4ac1df(0x117))||_0x35779e[_0x4ac1df(0xdf)]('.ss1')||_0x35779e['endsWith']('.ss2')||_0x35779e['endsWith'](_0x4ac1df(0xde))||_0x35779e[_0x4ac1df(0xdf)](_0x4ac1df(0xc0))||_0x35779e[_0x4ac1df(0xdf)](_0x4ac1df(0x126))||_0x35779e[_0x4ac1df(0xdf)]('.ss6')||_0x35779e[_0x4ac1df(0xdf)](_0x4ac1df(0x12f))){const _0x1d427c=_0x35779e[_0x4ac1df(0xef)](0x0,_0x35779e[_0x4ac1df(0xd9)]('.')),_0x2a99a7=_0x35779e[_0x4ac1df(0xed)](_0x35779e[_0x4ac1df(0xc8)]-0x1),_0x209c8b=localStorage['getItem'](_0x1d427c+_0x4ac1df(0x103)+_0x2a99a7),_0x1c5888=localStorage[_0x4ac1df(0x10b)](_0x1d427c+'.gba_dateState'+_0x2a99a7);if(_0x209c8b!==null){const _0x318252=_0x209c8b+'\x0a\x0a'+_0x1c5888,_0x32b014=new Blob([_0x318252],{'type':_0x4ac1df(0x110)});await lockNoti(_0x4ac1df(0x131),_0x1d427c+_0x4ac1df(0xff)+_0x2a99a7+_0x4ac1df(0xcb),0xbb8),await dpUploadFile(_0x1d427c+_0x4ac1df(0xff)+_0x2a99a7+_0x4ac1df(0xcb),_0x32b014);}}}catch(_0xa2b08a){console['error']('Failed\x20to\x20upload\x20file\x20'+_0x35779e+':',_0xa2b08a);}}}else console[_0x4ac1df(0x11a)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x59d49d(0x106),function(){var _0x1b82b6=_0x59d49d;const _0x21fee9=localStorage[_0x1b82b6(0x10b)]('uId');_0x21fee9===null||_0x21fee9===''?authorizeWithDropbox():window[_0x1b82b6(0xfe)](_0x1b82b6(0xf8))&&(localStorage['setItem'](_0x1b82b6(0xd8),''),dropboxRestore['classList'][_0x1b82b6(0xe8)](_0x1b82b6(0x11f)),dropboxBackup[_0x1b82b6(0x10e)][_0x1b82b6(0xe8)](_0x1b82b6(0x11f)),dropboxCloud[_0x1b82b6(0x10e)][_0x1b82b6(0xe8)]('active'));}),handleDropboxCallback();});