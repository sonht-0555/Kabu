var a0_0x2077fe=a0_0x3a9e;(function(_0x2c34db,_0x2f225d){var _0x5ec6d2=a0_0x3a9e,_0x5bb9e4=_0x2c34db();while(!![]){try{var _0x278402=-parseInt(_0x5ec6d2(0x1f4))/0x1*(parseInt(_0x5ec6d2(0x208))/0x2)+-parseInt(_0x5ec6d2(0x1f6))/0x3+-parseInt(_0x5ec6d2(0x1f7))/0x4+-parseInt(_0x5ec6d2(0x209))/0x5*(-parseInt(_0x5ec6d2(0x20a))/0x6)+parseInt(_0x5ec6d2(0x1e0))/0x7+parseInt(_0x5ec6d2(0x1c9))/0x8*(-parseInt(_0x5ec6d2(0x1bf))/0x9)+-parseInt(_0x5ec6d2(0x1ec))/0xa*(-parseInt(_0x5ec6d2(0x1f3))/0xb);if(_0x278402===_0x2f225d)break;else _0x5bb9e4['push'](_0x5bb9e4['shift']());}catch(_0x4d6ae6){_0x5bb9e4['push'](_0x5bb9e4['shift']());}}}(a0_0x3c78,0x73bfe));import*as a0_0x85b71b from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2077fe(0x212),clientSecret=a0_0x2077fe(0x20b);function authorizeWithDropbox(){var _0x202525=a0_0x2077fe,_0x5596c5=window[_0x202525(0x215)][_0x202525(0x1f0)]['split']('?')[0x0],_0x537b85=_0x202525(0x1c1),_0x505123=_0x202525(0x1f8),_0xc8a912=_0x202525(0x213)+clientId+'&response_type='+_0x537b85+_0x202525(0x1c4)+_0x505123+_0x202525(0x1b9)+encodeURIComponent(_0x5596c5);window[_0x202525(0x215)][_0x202525(0x1f0)]=_0xc8a912;}function handleDropboxCallback(){var _0x27e33d=a0_0x2077fe,_0x2d97e4=getUrlParameter(_0x27e33d(0x1c1));_0x2d97e4?(getAccessToken(_0x2d97e4),console[_0x27e33d(0x21f)](_0x27e33d(0x1e5),_0x2d97e4)):console[_0x27e33d(0x21f)](_0x27e33d(0x1c3));}function a0_0x3c78(){var _0x59b91d=['save','Bearer\x20','open','file','Authorization\x20Code:','active','remove','refresh_token','Do\x20you\x20want\x20to\x20backup\x20','Download\x20failed,\x20unknown\x20http\x20status:','Backing\x20up...','13027450knkJqy','Do\x20you\x20want\x20to\x20restore\x20','entries','https://api.dropbox.com/oauth2/token','href','onload','send','11aVvxVm','281563arfpEy','Error\x20while\x20refreshing\x20token:','2090631pMaNsL','1226444CESGbP','offline','\x20files\x20from\x20Cloud?','Cloud\x20login\x20required!','split','Content-Type','accessToken','confirm','length','https://api.dropboxapi.com/oauth2/token','setItem','application/x-www-form-urlencoded','exec','No\x20files\x20found\x20to\x20restore.','authorization_code','state','addEventListener','2NGVqIL','5jMjCiw','2083056bkHtFd','nwb3dnfh09rhs31','Cloud\x20↦\x20Kabu\x20storage\x20◆','classList','&client_secret=','replace','listFiles','push','knh3uz2mx2hp2eu','https://www.dropbox.com/oauth2/authorize?client_id=','downloadFileInCloud','location','folder','\x20files\x20in\x20Kabu?','blob','status','Folder\x20created','.tag','error_description','map','Wait\x20a\x20little\x20bit...','log','Failed\x20to\x20upload\x20file\x20','&redirect_uri=','error','click','json','Folder\x20already\x20exists','=([^&#]*)','82206wWHeba','https://content.dropboxapi.com/2/files/upload','code','responseText','Do\x20not\x20receive\x20authorization','&token_access_type=','overwrite','setRequestHeader','getItem','Restoring...','184DhNkKi','application/json','name','Unable\x20to\x20refresh\x20token','Kabu\x20storage\x20↦\x20Cloud\x20◆','No\x20refresh\x20token','alert','Refreshing\x20token...','refreshToken','https://content.dropboxapi.com/2/files/download','application/octet-stream','access_token','POST',',\x20status:\x20','uploadFileInCloud','Restore\x20canceled\x20by\x20user.','search','parse','uId','stringify','screenshot','[\x5c?&#]','code=','2235254fDoEDt'];a0_0x3c78=function(){return _0x59b91d;};return a0_0x3c78();}function getUrlParameter(_0x6c962c){var _0x28a232=a0_0x2077fe;_0x6c962c=_0x6c962c[_0x28a232(0x20f)](/[\[]/,'\x5c[')[_0x28a232(0x20f)](/[\]]/,'\x5c]');var _0x10fb32=new RegExp(_0x28a232(0x1de)+_0x6c962c+_0x28a232(0x1be)),_0x35efbe=_0x10fb32[_0x28a232(0x203)](location[_0x28a232(0x1d9)]);return _0x35efbe===null?'':decodeURIComponent(_0x35efbe[0x1][_0x28a232(0x20f)](/\+/g,'\x20'));}function getAccessToken(_0x52013b){var _0x22c240=a0_0x2077fe,_0x22c24d=_0x22c240(0x205),_0x1a0ad5=window[_0x22c240(0x215)][_0x22c240(0x1f0)][_0x22c240(0x1fb)]('?')[0x0],_0xd97ba=new XMLHttpRequest();_0xd97ba[_0x22c240(0x1e3)]('POST',_0x22c240(0x1ef)),_0xd97ba[_0x22c240(0x1c6)](_0x22c240(0x1fc),_0x22c240(0x202)),_0xd97ba[_0x22c240(0x1f1)]=function(){var _0x220d16=_0x22c240;if(_0xd97ba[_0x220d16(0x219)]===0xc8){var _0xf183f3=JSON[_0x220d16(0x1da)](_0xd97ba[_0x220d16(0x1c2)]),_0x41bedd=_0xf183f3['access_token'],_0x28f92e=_0xf183f3[_0x220d16(0x1e8)],_0x3fc821=_0xf183f3['uid'];localStorage[_0x220d16(0x201)]('accessToken',_0x41bedd),localStorage[_0x220d16(0x201)]('refreshToken',_0x28f92e),localStorage[_0x220d16(0x201)]('uId',_0x3fc821);}else console[_0x220d16(0x21f)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0xd97ba[_0x22c240(0x1f2)](_0x22c240(0x1df)+_0x52013b+'&grant_type='+_0x22c24d+'&client_id='+clientId+_0x22c240(0x20e)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x1a0ad5));}export async function dpCreateFolder(_0x3e776a){var _0x4fa82b=a0_0x2077fe;const _0x50e0cf=localStorage[_0x4fa82b(0x1c7)]('uId');let _0x155dc5=localStorage[_0x4fa82b(0x1c7)](_0x4fa82b(0x1fd));const _0x1f13c3='/'+_0x50e0cf+'/'+_0x3e776a,_0x2f6ea2=JSON[_0x4fa82b(0x1dc)]({'path':_0x1f13c3,'autorename':![]});for(let _0x1079a5=0x0;_0x1079a5<0x2;_0x1079a5++){try{const _0x159927=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x4fa82b(0x1d5),'headers':{'Authorization':'Bearer\x20'+_0x155dc5,'Content-Type':_0x4fa82b(0x1ca)},'body':_0x2f6ea2});if(_0x159927[_0x4fa82b(0x219)]===0x191){const _0x5e1fd0=await dpRefreshToken();if(!_0x5e1fd0)throw new Error('Unable\x20to\x20refresh\x20token');_0x155dc5=localStorage['getItem']('accessToken');continue;}if(_0x159927[_0x4fa82b(0x219)]===0x199)return{'message':_0x4fa82b(0x1bd),'path':_0x3e776a};if(!_0x159927['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x3e776a);const _0x96f5b9=await _0x159927[_0x4fa82b(0x1bc)]();return await lockNoti(_0x4fa82b(0x21a),'',0xbb8),_0x96f5b9;}catch(_0x1ae27d){if(_0x1079a5===0x1)throw _0x1ae27d;}}return![];}function a0_0x3a9e(_0x3b1da5,_0x200f6c){var _0x3c7854=a0_0x3c78();return a0_0x3a9e=function(_0x3a9eca,_0x411a37){_0x3a9eca=_0x3a9eca-0x1b8;var _0x2d4898=_0x3c7854[_0x3a9eca];return _0x2d4898;},a0_0x3a9e(_0x3b1da5,_0x200f6c);}export async function dpRefreshToken(){var _0x5c8568=a0_0x2077fe;if(!localStorage['getItem'](_0x5c8568(0x1d1)))throw _0x5c8568(0x1ce);try{const _0xd8f934=await fetch(_0x5c8568(0x200),{'method':_0x5c8568(0x1d5),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'refresh_token='+localStorage[_0x5c8568(0x1c7)]('refreshToken')+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x5cb0ea=await _0xd8f934[_0x5c8568(0x1bc)]();if(!_0x5cb0ea['error'])return localStorage['setItem'](_0x5c8568(0x1fd),_0x5cb0ea[_0x5c8568(0x1d4)]),await lockNoti(_0x5c8568(0x1d0),'',0xbb8),await delay(0x3e8),!![];else alert(_0x5cb0ea[_0x5c8568(0x21c)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x4b4f8e){console[_0x5c8568(0x1ba)](_0x5c8568(0x1f5),_0x4b4f8e);}return![];}export async function dpUploadFile(_0x5ed2ab,_0x53f1f4,_0x50869d){var _0x279fd7=a0_0x2077fe;const _0x56c035=localStorage[_0x279fd7(0x1c7)]('uId');var _0x16755a=JSON[_0x279fd7(0x1dc)]({'autorename':!![],'mode':_0x279fd7(0x1c5),'mute':!![],'strict_conflict':![],'path':'/'+_0x56c035+'/'+_0x50869d+'/'+_0x5ed2ab}),_0x968edb=new Blob([_0x53f1f4],{'type':_0x279fd7(0x1d3)});for(var _0x691380=0x0;_0x691380<0x2;_0x691380++){var _0x195ddc=await fetch(_0x279fd7(0x1c0),{'method':'POST','headers':{'Authorization':_0x279fd7(0x1e2)+localStorage['getItem'](_0x279fd7(0x1fd)),'Dropbox-API-Arg':_0x16755a,'Content-Type':_0x279fd7(0x1d3)},'body':_0x968edb});if(_0x195ddc[_0x279fd7(0x219)]!=0xc8){if(_0x195ddc[_0x279fd7(0x219)]==0x191){var _0x48914a=await dpRefreshToken();if(!_0x48914a)throw _0x279fd7(0x1cc);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x195ddc[_0x279fd7(0x219)];}else{var _0x4dccb3=await _0x195ddc[_0x279fd7(0x1bc)]();return console[_0x279fd7(0x21f)](_0x279fd7(0x1cd),_0x5ed2ab),_0x4dccb3;}}return![];}export async function dpDownloadFile(_0xf104d4,_0x3c2866){var _0x31f106=a0_0x2077fe;const _0x279e5a=localStorage[_0x31f106(0x1c7)](_0x31f106(0x1db));var _0x2e2c76=JSON['stringify']({'path':'/'+_0x279e5a+'/'+_0x3c2866+'/'+_0xf104d4});for(var _0x190c9b=0x0;_0x190c9b<0x2;_0x190c9b++){var _0x11db38=await fetch(_0x31f106(0x1d2),{'method':'POST','headers':{'Authorization':_0x31f106(0x1e2)+localStorage[_0x31f106(0x1c7)]('accessToken'),'Dropbox-API-Arg':_0x2e2c76}});if(_0x11db38[_0x31f106(0x219)]!=0xc8){if(_0x11db38[_0x31f106(0x219)]==0x191){var _0x179300=await dpRefreshToken();if(!_0x179300)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x31f106(0x1ea)+_0x11db38[_0x31f106(0x219)];}const _0x17ba14=new File([await _0x11db38[_0x31f106(0x218)]()],_0xf104d4);return console[_0x31f106(0x21f)](_0x31f106(0x20c),_0x17ba14[_0x31f106(0x1cb)]),a0_0x85b71b[_0x31f106(0x1d7)](_0x17ba14,()=>{}),_0x17ba14;}return![];}document[a0_0x2077fe(0x207)]('DOMContentLoaded',function(){var _0x1f19d1=a0_0x2077fe;dropboxRestore[_0x1f19d1(0x207)](_0x1f19d1(0x1bb),async function(){var _0x205e13=_0x1f19d1;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x1cf06a=localStorage[_0x205e13(0x1c7)](_0x205e13(0x1db)),_0x7ae52e=[_0x205e13(0x206),'save',_0x205e13(0x1dd)];if(!_0x1cf06a){window[_0x205e13(0x1cf)]('Cloud\x20login\x20required!');return;}let _0x51dfd1=[];for(const _0x21069f of _0x7ae52e){let _0x14db31={'path':'/'+_0x1cf06a+'/'+_0x21069f};for(let _0x336b7c=0x0;_0x336b7c<0x2;_0x336b7c++){let _0x23d9a6=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x205e13(0x1d5),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x205e13(0x1fd)),'Content-Type':'application/json'},'body':JSON[_0x205e13(0x1dc)](_0x14db31)});if(_0x23d9a6[_0x205e13(0x219)]===0xc8){let _0xb36cf4=await _0x23d9a6['json'](),_0x1db6bd=_0xb36cf4[_0x205e13(0x1ee)]['filter'](_0x3f8857=>_0x3f8857[_0x205e13(0x21b)]===_0x205e13(0x1e4));_0x1db6bd[_0x205e13(0x1ff)]>0x0&&_0x51dfd1[_0x205e13(0x211)](..._0x1db6bd[_0x205e13(0x21d)](_0x22f792=>({'name':_0x22f792[_0x205e13(0x1cb)],'folder':_0x21069f})));break;}else{if(_0x23d9a6[_0x205e13(0x219)]===0x191){let _0x248b71=await dpRefreshToken();if(!_0x248b71)throw _0x205e13(0x1cc);}else{console[_0x205e13(0x1ba)]('Download\x20failed\x20for\x20'+_0x21069f+_0x205e13(0x1d6)+_0x23d9a6[_0x205e13(0x219)]);break;}}}}if(_0x51dfd1[_0x205e13(0x1ff)]>0x0){const _0x3ef204=_0x205e13(0x1ed)+_0x51dfd1['length']+_0x205e13(0x1f9);if(window['confirm'](_0x3ef204))for(const _0x2d08a1 of _0x51dfd1){await lockNoti(_0x205e13(0x1c8),_0x2d08a1[_0x205e13(0x1cb)],0xbb8),await dpDownloadFile(_0x2d08a1[_0x205e13(0x1cb)],_0x2d08a1[_0x205e13(0x216)]);}else console[_0x205e13(0x21f)]('Restore\x20canceled\x20by\x20user.');}else console[_0x205e13(0x21f)](_0x205e13(0x204));}),dropboxBackup['addEventListener']('click',async function(){var _0x51d451=_0x1f19d1;await lockNoti(_0x51d451(0x21e),'',0x1388);const _0x2d1334=localStorage[_0x51d451(0x1c7)]('uId');if(_0x2d1334===null||_0x2d1334==='')window['alert'](_0x51d451(0x1fa));else{const _0x7ccfc=[_0x51d451(0x206),_0x51d451(0x1e1),_0x51d451(0x1dd)];for(const _0x191d9d of _0x7ccfc){await dpCreateFolder(_0x191d9d);}let _0x330090=0x0;for(const _0x22bff5 of _0x7ccfc){const _0x23a2e2=a0_0x85b71b[_0x51d451(0x210)](_0x22bff5+'s');_0x330090+=_0x23a2e2[_0x51d451(0x1ff)];}if(window[_0x51d451(0x1fe)](_0x51d451(0x1e9)+_0x330090+_0x51d451(0x217)))for(const _0x245017 of _0x7ccfc){const _0xb08673=a0_0x85b71b['listFiles'](_0x245017+'s');for(const _0xd63c6a of _0xb08673){const _0x172b2f=await a0_0x85b71b[_0x51d451(0x214)]('/data/'+_0x245017+'s/'+_0xd63c6a);try{await lockNoti(_0x51d451(0x1eb),_0xd63c6a,0xbb8),await dpUploadFile(_0xd63c6a,_0x172b2f,_0x245017);}catch(_0x3baa89){console[_0x51d451(0x1ba)](_0x51d451(0x1b8)+_0xd63c6a+':',_0x3baa89);}}}else console[_0x51d451(0x21f)](_0x51d451(0x1d8));}}),dropboxCloud[_0x1f19d1(0x207)]('click',function(){var _0x2c2522=_0x1f19d1;const _0x456c93=localStorage[_0x2c2522(0x1c7)]('uId');_0x456c93===null||_0x456c93===''?authorizeWithDropbox():window[_0x2c2522(0x1fe)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x2c2522(0x201)](_0x2c2522(0x1db),''),dropboxRestore['classList'][_0x2c2522(0x1e7)](_0x2c2522(0x1e6)),dropboxBackup[_0x2c2522(0x20d)][_0x2c2522(0x1e7)](_0x2c2522(0x1e6)),dropboxCloud[_0x2c2522(0x20d)][_0x2c2522(0x1e7)](_0x2c2522(0x1e6)));}),handleDropboxCallback();});