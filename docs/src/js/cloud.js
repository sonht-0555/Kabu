var a0_0x5f3467=a0_0x3787;(function(_0x403839,_0x5d1dde){var _0x1fa03c=a0_0x3787,_0x2dc50f=_0x403839();while(!![]){try{var _0x39bd70=-parseInt(_0x1fa03c(0x1c5))/0x1*(-parseInt(_0x1fa03c(0x1af))/0x2)+parseInt(_0x1fa03c(0x19b))/0x3*(parseInt(_0x1fa03c(0x184))/0x4)+-parseInt(_0x1fa03c(0x196))/0x5+parseInt(_0x1fa03c(0x1ca))/0x6*(-parseInt(_0x1fa03c(0x1da))/0x7)+parseInt(_0x1fa03c(0x1d8))/0x8+-parseInt(_0x1fa03c(0x1a2))/0x9+-parseInt(_0x1fa03c(0x1e3))/0xa;if(_0x39bd70===_0x5d1dde)break;else _0x2dc50f['push'](_0x2dc50f['shift']());}catch(_0xda2192){_0x2dc50f['push'](_0x2dc50f['shift']());}}}(a0_0x449c,0x9e5ff));import*as a0_0x2067cc from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x5f3467(0x19e),clientSecret=a0_0x5f3467(0x1b6);function authorizeWithDropbox(){var _0x42833f=a0_0x5f3467,_0x2d03c4=window[_0x42833f(0x1c2)][_0x42833f(0x1dc)][_0x42833f(0x186)]('?')[0x0],_0x482a76=_0x42833f(0x1d5),_0x3d7a7f=_0x42833f(0x19f),_0x151ff7='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x42833f(0x1db)+_0x482a76+'&token_access_type='+_0x3d7a7f+'&redirect_uri='+encodeURIComponent(_0x2d03c4);window['location'][_0x42833f(0x1dc)]=_0x151ff7;}function handleDropboxCallback(){var _0x26cd83=a0_0x5f3467,_0x371a34=getUrlParameter(_0x26cd83(0x1d5));_0x371a34?(getAccessToken(_0x371a34),console[_0x26cd83(0x1d4)](_0x26cd83(0x1e2),_0x371a34)):console['log'](_0x26cd83(0x181));}function getUrlParameter(_0x51fc89){var _0x247151=a0_0x5f3467;_0x51fc89=_0x51fc89[_0x247151(0x199)](/[\[]/,'\x5c[')[_0x247151(0x199)](/[\]]/,'\x5c]');var _0x4ea4a9=new RegExp(_0x247151(0x1cb)+_0x51fc89+_0x247151(0x1ae)),_0x437593=_0x4ea4a9[_0x247151(0x1b0)](location[_0x247151(0x1d0)]);return _0x437593===null?'':decodeURIComponent(_0x437593[0x1][_0x247151(0x199)](/\+/g,'\x20'));}function getAccessToken(_0x4e6602){var _0x595f72=a0_0x5f3467,_0x281e36=_0x595f72(0x178),_0x497905=window[_0x595f72(0x1c2)][_0x595f72(0x1dc)][_0x595f72(0x186)]('?')[0x0],_0x2f217a=new XMLHttpRequest();_0x2f217a[_0x595f72(0x18a)]('POST',_0x595f72(0x18c)),_0x2f217a[_0x595f72(0x1bc)]('Content-Type',_0x595f72(0x1b9)),_0x2f217a['onload']=function(){var _0x56b861=_0x595f72;if(_0x2f217a[_0x56b861(0x1de)]===0xc8){var _0x38822c=JSON[_0x56b861(0x17a)](_0x2f217a['responseText']),_0x948e47=_0x38822c[_0x56b861(0x1ad)],_0x165a68=_0x38822c[_0x56b861(0x1c7)],_0x210198=_0x38822c[_0x56b861(0x189)];localStorage['setItem'](_0x56b861(0x1a3),_0x948e47),localStorage[_0x56b861(0x1cc)](_0x56b861(0x193),_0x165a68),localStorage['setItem'](_0x56b861(0x198),_0x210198);}else console[_0x56b861(0x1d4)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x2f217a[_0x595f72(0x1cd)]('code='+_0x4e6602+_0x595f72(0x18d)+_0x281e36+_0x595f72(0x195)+clientId+_0x595f72(0x1a5)+clientSecret+_0x595f72(0x1b1)+encodeURIComponent(_0x497905));}export async function dpRefreshToken(){var _0x28b3fc=a0_0x5f3467;if(!localStorage[_0x28b3fc(0x18e)](_0x28b3fc(0x193)))throw _0x28b3fc(0x1b2);try{const _0xb6f9af=await fetch(_0x28b3fc(0x1b7),{'method':_0x28b3fc(0x1c8),'headers':{'Content-Type':_0x28b3fc(0x1b9)},'body':'refresh_token='+localStorage[_0x28b3fc(0x18e)](_0x28b3fc(0x193))+_0x28b3fc(0x182)}),_0x4755f7=await _0xb6f9af[_0x28b3fc(0x187)]();if(!_0x4755f7[_0x28b3fc(0x19a)])return localStorage[_0x28b3fc(0x1cc)](_0x28b3fc(0x1a3),_0x4755f7[_0x28b3fc(0x1ad)]),await lockNoti('',_0x28b3fc(0x180),0xbb8),await delay(0x3e8),!![];else alert(_0x4755f7[_0x28b3fc(0x1d1)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x38c58b){console[_0x28b3fc(0x19a)](_0x28b3fc(0x1ce),_0x38c58b);}return![];}function a0_0x449c(){var _0x41d004=['POST','text/plain','2706ZzRSyZ','[\x5c?&#]','setItem','send','Error\x20while\x20refreshing\x20token:','endsWith','search','error_description','file','Do\x20you\x20want\x20to\x20backup\x20','log','code','gba','entries','9860224GOhCgl','https://content.dropboxapi.com/2/files/download','6818lqBaKk','&response_type=','href','downloadFileInCloud','status','Cloud\x20login\x20required!','state','.txt','Authorization\x20Code:','2911370nMBjQJ','blob','.gba_dateState','.ss6','length','alert','.ss2','authorization_code','Do\x20you\x20want\x20to\x20restore\x20','parse','classList','save','DOMContentLoaded','FSSync','Backing\x20up...','Refreshing\x20token...','Do\x20not\x20receive\x20authorization','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','status:\x20','4UQyxQF','.gba_slot','split','json','Do\x20you\x20want\x20to\x20logout?','uid','open','.ss5','https://api.dropbox.com/oauth2/token','&grant_type=','getItem','click','substring','stringify','active','refreshToken','remove','&client_id=','4162570kBpMaq','Cloud\x20↦\x20Kabu\x20storage\x20◆','uId','replace','error','871077ouXpYn','charAt','.ss3','knh3uz2mx2hp2eu','offline','.ss1','filter','3095874PLqvsi','accessToken','.gba_imageState','&client_secret=','\x20files\x20in\x20Kabu?','lastIndexOf','list','.ss4','text','Download\x20failed,\x20unknown\x20http\x20status:','slice','access_token','=([^&#]*)','2065454xMvHvd','exec','&redirect_uri=','No\x20refresh\x20token','application/json','https://content.dropboxapi.com/2/files/upload','Upload\x20failed,\x20unknown\x20http\x20status:\x20','nwb3dnfh09rhs31','https://api.dropboxapi.com/oauth2/token','confirm','application/x-www-form-urlencoded','.tag','_dateState','setRequestHeader','application/octet-stream','overwrite','.ss7','toUpperCase','\x20files\x20in\x20Cloud?','location','.ss0','Bearer\x20','1baBAez','Restore\x20canceled\x20by\x20user.','refresh_token'];a0_0x449c=function(){return _0x41d004;};return a0_0x449c();}function a0_0x3787(_0x2fffc5,_0x296291){var _0x449c76=a0_0x449c();return a0_0x3787=function(_0x37872c,_0x419c96){_0x37872c=_0x37872c-0x175;var _0x32b880=_0x449c76[_0x37872c];return _0x32b880;},a0_0x3787(_0x2fffc5,_0x296291);}export async function dpUploadFile(_0x226feb,_0xf72871){var _0x4c30ea=a0_0x5f3467;const _0x4997a3=localStorage['getItem'](_0x4c30ea(0x198));var _0x28caaf=JSON[_0x4c30ea(0x191)]({'autorename':!![],'mode':_0x4c30ea(0x1be),'mute':!![],'strict_conflict':![],'path':'/'+_0x4997a3+'/'+_0x226feb}),_0xf455c=new Blob([_0xf72871],{'type':_0x4c30ea(0x1bd)});for(var _0x23538c=0x0;_0x23538c<0x2;_0x23538c++){var _0x13451d=await fetch(_0x4c30ea(0x1b4),{'method':_0x4c30ea(0x1c8),'headers':{'Authorization':_0x4c30ea(0x1c4)+localStorage['getItem'](_0x4c30ea(0x1a3)),'Dropbox-API-Arg':_0x28caaf,'Content-Type':_0x4c30ea(0x1bd)},'body':_0xf455c});if(_0x13451d[_0x4c30ea(0x1de)]!=0xc8){if(_0x13451d[_0x4c30ea(0x1de)]==0x191){var _0x35c34f=await dpRefreshToken();if(!_0x35c34f)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x4c30ea(0x1b5)+_0x13451d['status'];}else{var _0xe647df=await _0x13451d[_0x4c30ea(0x187)]();return console[_0x4c30ea(0x1d4)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x226feb),_0xe647df;}}return![];}async function dpDownloadFile(_0x314c8f){var _0x4a2bc3=a0_0x5f3467;const _0x374466=localStorage['getItem']('uId');var _0x2d6625=JSON['stringify']({'path':'/'+_0x374466+'/'+_0x314c8f});for(var _0x5d23d8=0x0;_0x5d23d8<0x2;_0x5d23d8++){var _0x1fd4c9=await fetch(_0x4a2bc3(0x1d9),{'method':_0x4a2bc3(0x1c8),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x4a2bc3(0x18e)](_0x4a2bc3(0x1a3)),'Dropbox-API-Arg':_0x2d6625}});if(_0x1fd4c9[_0x4a2bc3(0x1de)]!=0xc8){if(_0x1fd4c9['status']==0x191){var _0x3a38ea=await dpRefreshToken();if(!_0x3a38ea)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x4a2bc3(0x1ab)+_0x1fd4c9['status'];}const _0x31859b=new File([await _0x1fd4c9[_0x4a2bc3(0x1e4)]()],_0x314c8f);console[_0x4a2bc3(0x1d4)](_0x4a2bc3(0x197),_0x31859b['name']);if(_0x314c8f[_0x4a2bc3(0x1cf)](_0x4a2bc3(0x1e1))){const _0x27d2e9=await _0x31859b[_0x4a2bc3(0x1aa)](),[_0x3daf6d,_0x3fbca7]=_0x27d2e9['split']('\x0a\x0a'),_0x1c73fb=_0x314c8f['substring'](0x0,_0x314c8f['lastIndexOf'](_0x4a2bc3(0x1d6))+0x3),_0x2b9250=_0x314c8f[_0x4a2bc3(0x19c)](_0x314c8f['length']-0x5);localStorage[_0x4a2bc3(0x1cc)](_0x1c73fb+_0x4a2bc3(0x1bb)+_0x2b9250,_0x3fbca7),localStorage[_0x4a2bc3(0x1cc)](_0x1c73fb+'_imageState'+_0x2b9250,_0x3daf6d);}else a0_0x2067cc['uploadSaveOrSaveState'](_0x31859b,()=>{var _0x3842de=_0x4a2bc3;localStorageFile(),Module[_0x3842de(0x17e)]();});return _0x31859b;}return![];}document['addEventListener'](a0_0x5f3467(0x17d),function(){var _0x19788a=a0_0x5f3467;dropboxRestore['addEventListener']('click',async function(){var _0x5b299a=a0_0x3787;const _0x11dcfa=localStorage[_0x5b299a(0x18e)]('uId');if(_0x11dcfa===null||_0x11dcfa==='')window[_0x5b299a(0x176)](_0x5b299a(0x1df));else{var _0xdbfa83={'path':'/'+_0x11dcfa};for(var _0x2b272d=0x0;_0x2b272d<0x2;_0x2b272d++){var _0xcb334c=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x5b299a(0x1c8),'headers':{'Authorization':_0x5b299a(0x1c4)+localStorage[_0x5b299a(0x18e)](_0x5b299a(0x1a3)),'Content-Type':_0x5b299a(0x1b3)},'body':JSON[_0x5b299a(0x191)](_0xdbfa83)});console[_0x5b299a(0x1d4)](_0x5b299a(0x183),_0xcb334c[_0x5b299a(0x1de)]);if(_0xcb334c[_0x5b299a(0x1de)]!=0xc8){if(_0xcb334c[_0x5b299a(0x1de)]==0x191){var _0x50f3f4=await dpRefreshToken();if(!_0x50f3f4)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:\x20'+_0xcb334c[_0x5b299a(0x1de)];}else{const _0x54a8cb=await _0xcb334c[_0x5b299a(0x187)](),_0x2c2814=_0x54a8cb[_0x5b299a(0x1d7)][_0x5b299a(0x1a1)](_0x3317cf=>_0x3317cf[_0x5b299a(0x1ba)]===_0x5b299a(0x1d2))[_0x5b299a(0x175)],_0x4091ea=_0x5b299a(0x179)+_0x2c2814+_0x5b299a(0x1c1);if(window[_0x5b299a(0x1b8)](_0x4091ea))for(const _0x512b68 of _0x54a8cb[_0x5b299a(0x1d7)]){_0x512b68[_0x5b299a(0x1ba)]===_0x5b299a(0x1d2)&&(await lockNoti('Restoring...',_0x512b68['name'],0xbb8),await dpDownloadFile(_0x512b68['name']));}else console[_0x5b299a(0x1d4)](_0x5b299a(0x1c6));return!![];}}return![];}}),dropboxBackup['addEventListener']('click',async function(){var _0x2576af=a0_0x3787;const _0x5a73f6=localStorage['getItem']('uId');if(_0x5a73f6===null||_0x5a73f6==='')window[_0x2576af(0x176)]('Cloud\x20login\x20required!');else{const _0x26eb7e=[_0x2576af(0x1e0),_0x2576af(0x17c)];let _0x5799b3=0x0;for(const _0x4b183e of _0x26eb7e){const _0x19afec=a0_0x2067cc[_0x2576af(0x1a8)+(_0x4b183e[_0x2576af(0x19c)](0x0)[_0x2576af(0x1c0)]()+_0x4b183e[_0x2576af(0x1ac)](0x1))]();_0x5799b3+=_0x19afec[_0x2576af(0x175)];}if(window[_0x2576af(0x1b8)](_0x2576af(0x1d3)+_0x5799b3+_0x2576af(0x1a6)))for(const _0x1b4a86 of _0x26eb7e){const _0x1257fc=a0_0x2067cc[_0x2576af(0x1a8)+(_0x1b4a86[_0x2576af(0x19c)](0x0)[_0x2576af(0x1c0)]()+_0x1b4a86[_0x2576af(0x1ac)](0x1))]();for(const _0x251d03 of _0x1257fc){const _0x6c4d81=await a0_0x2067cc[_0x2576af(0x1dd)]('/data/'+_0x1b4a86+'s/'+_0x251d03);try{await lockNoti(_0x2576af(0x17f),_0x251d03,0xbb8),await dpUploadFile(_0x251d03,_0x6c4d81);if(_0x251d03['endsWith'](_0x2576af(0x1c3))||_0x251d03[_0x2576af(0x1cf)](_0x2576af(0x1a0))||_0x251d03[_0x2576af(0x1cf)](_0x2576af(0x177))||_0x251d03[_0x2576af(0x1cf)](_0x2576af(0x19d))||_0x251d03['endsWith'](_0x2576af(0x1a9))||_0x251d03[_0x2576af(0x1cf)](_0x2576af(0x18b))||_0x251d03[_0x2576af(0x1cf)](_0x2576af(0x1e6))||_0x251d03[_0x2576af(0x1cf)](_0x2576af(0x1bf))){const _0x2409cc=_0x251d03[_0x2576af(0x190)](0x0,_0x251d03[_0x2576af(0x1a7)]('.')),_0x11e757=_0x251d03['charAt'](_0x251d03[_0x2576af(0x175)]-0x1),_0x4dec62=localStorage[_0x2576af(0x18e)](_0x2409cc+_0x2576af(0x1a4)+_0x11e757),_0xa359a0=localStorage[_0x2576af(0x18e)](_0x2409cc+_0x2576af(0x1e5)+_0x11e757);if(_0x4dec62!==null){const _0x4f5d3d=_0x4dec62+'\x0a\x0a'+_0xa359a0,_0x267490=new Blob([_0x4f5d3d],{'type':_0x2576af(0x1c9)});await lockNoti(_0x2576af(0x17f),_0x2409cc+_0x2576af(0x185)+_0x11e757+_0x2576af(0x1e1),0xbb8),await dpUploadFile(_0x2409cc+_0x2576af(0x185)+_0x11e757+'.txt',_0x267490);}}}catch(_0x3b1c95){console[_0x2576af(0x19a)]('Failed\x20to\x20upload\x20file\x20'+_0x251d03+':',_0x3b1c95);}}}else console[_0x2576af(0x1d4)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x19788a(0x18f),function(){var _0x546fe2=_0x19788a;const _0x1d187a=localStorage[_0x546fe2(0x18e)](_0x546fe2(0x198));_0x1d187a===null||_0x1d187a===''?authorizeWithDropbox():window[_0x546fe2(0x1b8)](_0x546fe2(0x188))&&(localStorage[_0x546fe2(0x1cc)](_0x546fe2(0x198),''),dropboxRestore[_0x546fe2(0x17b)][_0x546fe2(0x194)](_0x546fe2(0x192)),dropboxBackup['classList']['remove'](_0x546fe2(0x192)),dropboxCloud[_0x546fe2(0x17b)][_0x546fe2(0x194)](_0x546fe2(0x192)));}),handleDropboxCallback();});