var a0_0x1a6e12=a0_0x40c8;(function(_0x22ad46,_0x5b8f0f){var _0x5be268=a0_0x40c8,_0x382130=_0x22ad46();while(!![]){try{var _0x37055=parseInt(_0x5be268(0x12a))/0x1+parseInt(_0x5be268(0x121))/0x2+-parseInt(_0x5be268(0x120))/0x3*(-parseInt(_0x5be268(0x168))/0x4)+parseInt(_0x5be268(0x140))/0x5*(-parseInt(_0x5be268(0x13a))/0x6)+-parseInt(_0x5be268(0x118))/0x7+parseInt(_0x5be268(0x112))/0x8+parseInt(_0x5be268(0x153))/0x9*(parseInt(_0x5be268(0x115))/0xa);if(_0x37055===_0x5b8f0f)break;else _0x382130['push'](_0x382130['shift']());}catch(_0x33a43c){_0x382130['push'](_0x382130['shift']());}}}(a0_0x54d7,0x4b63e));import*as a0_0x69afa0 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x1a6e12(0x150),clientSecret=a0_0x1a6e12(0x167);function a0_0x40c8(_0x33ffdb,_0x2d9185){var _0x54d7be=a0_0x54d7();return a0_0x40c8=function(_0x40c85c,_0x5b93f1){_0x40c85c=_0x40c85c-0x10f;var _0x77fbe2=_0x54d7be[_0x40c85c];return _0x77fbe2;},a0_0x40c8(_0x33ffdb,_0x2d9185);}function authorizeWithDropbox(){var _0x1d60f0=a0_0x1a6e12,_0xafa813=window[_0x1d60f0(0x11c)][_0x1d60f0(0x129)][_0x1d60f0(0x14c)]('?')[0x0],_0x2ebb00=_0x1d60f0(0x12e),_0x3f8f1a='offline',_0x2a9122=_0x1d60f0(0x16a)+clientId+_0x1d60f0(0x170)+_0x2ebb00+'&token_access_type='+_0x3f8f1a+_0x1d60f0(0x155)+encodeURIComponent(_0xafa813);window[_0x1d60f0(0x11c)]['href']=_0x2a9122;}function handleDropboxCallback(){var _0x1c9d77=a0_0x1a6e12,_0x52f245=getUrlParameter(_0x1c9d77(0x12e));_0x52f245?(getAccessToken(_0x52f245),console[_0x1c9d77(0x164)]('Authorization\x20Code:',_0x52f245)):console['log']('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x961b3){var _0x50bcab=a0_0x1a6e12;_0x961b3=_0x961b3[_0x50bcab(0x151)](/[\[]/,'\x5c[')[_0x50bcab(0x151)](/[\]]/,'\x5c]');var _0x1a9016=new RegExp(_0x50bcab(0x171)+_0x961b3+_0x50bcab(0x13b)),_0x740274=_0x1a9016[_0x50bcab(0x13e)](location['search']);return _0x740274===null?'':decodeURIComponent(_0x740274[0x1][_0x50bcab(0x151)](/\+/g,'\x20'));}function getAccessToken(_0x27b799){var _0x35f72c=a0_0x1a6e12,_0x2d4b82=_0x35f72c(0x149),_0x13f221=window[_0x35f72c(0x11c)][_0x35f72c(0x129)][_0x35f72c(0x14c)]('?')[0x0],_0x19b6e8=new XMLHttpRequest();_0x19b6e8[_0x35f72c(0x15d)](_0x35f72c(0x13d),_0x35f72c(0x16d)),_0x19b6e8['setRequestHeader'](_0x35f72c(0x11d),'application/x-www-form-urlencoded'),_0x19b6e8['onload']=function(){var _0x3edeb1=_0x35f72c;if(_0x19b6e8[_0x3edeb1(0x11f)]===0xc8){var _0x23c4ac=JSON[_0x3edeb1(0x133)](_0x19b6e8['responseText']),_0xd707ac=_0x23c4ac['access_token'],_0x17346c=_0x23c4ac[_0x3edeb1(0x141)],_0x58605c=_0x23c4ac[_0x3edeb1(0x166)];localStorage[_0x3edeb1(0x16b)](_0x3edeb1(0x163),_0xd707ac),localStorage[_0x3edeb1(0x16b)](_0x3edeb1(0x160),_0x17346c),localStorage[_0x3edeb1(0x16b)]('uId',_0x58605c);}else console['log']('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x19b6e8[_0x35f72c(0x15a)](_0x35f72c(0x119)+_0x27b799+'&grant_type='+_0x2d4b82+_0x35f72c(0x15c)+clientId+_0x35f72c(0x137)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x13f221));}export async function dpCreateFolder(_0x34b015){var _0x5c233c=a0_0x1a6e12;const _0x1792ee=localStorage[_0x5c233c(0x117)]('uId');let _0x6c00bf=localStorage[_0x5c233c(0x117)]('accessToken');const _0x11b781='/'+_0x1792ee+'/'+_0x34b015,_0xe6f57b=JSON[_0x5c233c(0x12c)]({'path':_0x11b781,'autorename':![]});for(let _0x11faa5=0x0;_0x11faa5<0x2;_0x11faa5++){try{const _0x2f96e8=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x5c233c(0x13d),'headers':{'Authorization':_0x5c233c(0x13f)+_0x6c00bf,'Content-Type':_0x5c233c(0x144)},'body':_0xe6f57b});if(_0x2f96e8['status']===0x191){const _0x524345=await dpRefreshToken();if(!_0x524345)throw new Error(_0x5c233c(0x159));_0x6c00bf=localStorage['getItem'](_0x5c233c(0x163));continue;}if(_0x2f96e8[_0x5c233c(0x11f)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x34b015};if(!_0x2f96e8['ok'])throw new Error(_0x5c233c(0x14a)+_0x34b015);const _0x48ae84=await _0x2f96e8[_0x5c233c(0x145)]();return await lockNoti(_0x5c233c(0x12f),'',0xbb8),_0x48ae84;}catch(_0x32b290){if(_0x11faa5===0x1)throw _0x32b290;}}return![];}function a0_0x54d7(){var _0x1077e3=['Cloud\x20login\x20required!','status','3PLxLtg','111834pDGPAn','https://api.dropboxapi.com/2/files/list_folder','slice','DOMContentLoaded','Download\x20failed\x20for\x20','Wait\x20a\x20little\x20bit...','\x20files\x20in\x20Kabu?','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','href','180737vHggng','Failed\x20to\x20refresh\x20Dropbox\x20token.','stringify','\x20files\x20from\x20Cloud?','code','Folder\x20created','filter','Upload\x20failed,\x20unknown\x20http\x20status:\x20','active','parse','FSSync',',\x20status:\x20','alert','&client_secret=','length','remove','3425586hKBZTo','=([^&#]*)','https://api.dropboxapi.com/oauth2/token','POST','exec','Bearer\x20','5BnmaFK','refresh_token','Do\x20you\x20want\x20to\x20restore\x20','save','application/json','json','error','Restoring...','map','authorization_code','Error\x20creating\x20folder\x20','classList','split','https://content.dropboxapi.com/2/files/download','Backing\x20up...','name','knh3uz2mx2hp2eu','replace','Do\x20you\x20want\x20to\x20logout?','1885059aFoRJH','application/octet-stream','&redirect_uri=','screenshot','downloadFileInCloud','Download\x20failed,\x20unknown\x20http\x20status:','Unable\x20to\x20refresh\x20token','send','uploadFileInCloud','&client_id=','open','file','click','refreshToken','charAt','https://content.dropboxapi.com/2/files/upload','accessToken','log','addEventListener','uid','nwb3dnfh09rhs31','1073972YQsBOb','Restore\x20canceled\x20by\x20user.','https://www.dropbox.com/oauth2/authorize?client_id=','setItem','uId','https://api.dropbox.com/oauth2/token','refresh_token=','state','&response_type=','[\x5c?&#]','No\x20files\x20found\x20to\x20restore.','folder','list','3069360uBToCc','toUpperCase','application/x-www-form-urlencoded','10oYyrPG','access_token','getItem','1529773oplgGN','code=','confirm','error_description','location','Content-Type'];a0_0x54d7=function(){return _0x1077e3;};return a0_0x54d7();}export async function dpRefreshToken(){var _0x4a664e=a0_0x1a6e12;if(!localStorage['getItem'](_0x4a664e(0x160)))throw'No\x20refresh\x20token';try{const _0x2b6709=await fetch(_0x4a664e(0x13c),{'method':_0x4a664e(0x13d),'headers':{'Content-Type':_0x4a664e(0x114)},'body':_0x4a664e(0x16e)+localStorage[_0x4a664e(0x117)](_0x4a664e(0x160))+_0x4a664e(0x128)}),_0x5af79e=await _0x2b6709[_0x4a664e(0x145)]();if(!_0x5af79e[_0x4a664e(0x146)])return localStorage['setItem']('accessToken',_0x5af79e[_0x4a664e(0x116)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x5af79e[_0x4a664e(0x11b)]||_0x4a664e(0x12b));}catch(_0x23b6bd){console[_0x4a664e(0x146)]('Error\x20while\x20refreshing\x20token:',_0x23b6bd);}return![];}export async function dpUploadFile(_0x4f5d7d,_0x114e33,_0x537691){var _0x39113f=a0_0x1a6e12;const _0x5018d1=localStorage['getItem'](_0x39113f(0x16c));var _0x5d5bd5=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x5018d1+'/'+_0x537691+'/'+_0x4f5d7d}),_0x12f169=new Blob([_0x114e33],{'type':_0x39113f(0x154)});for(var _0x2f7e93=0x0;_0x2f7e93<0x2;_0x2f7e93++){var _0x42902b=await fetch(_0x39113f(0x162),{'method':_0x39113f(0x13d),'headers':{'Authorization':_0x39113f(0x13f)+localStorage[_0x39113f(0x117)](_0x39113f(0x163)),'Dropbox-API-Arg':_0x5d5bd5,'Content-Type':_0x39113f(0x154)},'body':_0x12f169});if(_0x42902b[_0x39113f(0x11f)]!=0xc8){if(_0x42902b[_0x39113f(0x11f)]==0x191){var _0x83f490=await dpRefreshToken();if(!_0x83f490)throw _0x39113f(0x159);continue;}else throw _0x39113f(0x131)+_0x42902b['status'];}else{var _0x4b019f=await _0x42902b[_0x39113f(0x145)]();return console[_0x39113f(0x164)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x4f5d7d),_0x4b019f;}}return![];}export async function dpDownloadFile(_0x53cab2,_0x39d146){var _0x3a4a5e=a0_0x1a6e12;const _0x4240ca=localStorage[_0x3a4a5e(0x117)](_0x3a4a5e(0x16c));var _0x5b3bd3=JSON[_0x3a4a5e(0x12c)]({'path':'/'+_0x4240ca+'/'+_0x39d146+'/'+_0x53cab2});for(var _0x2cd7df=0x0;_0x2cd7df<0x2;_0x2cd7df++){var _0x45c056=await fetch(_0x3a4a5e(0x14d),{'method':_0x3a4a5e(0x13d),'headers':{'Authorization':_0x3a4a5e(0x13f)+localStorage['getItem'](_0x3a4a5e(0x163)),'Dropbox-API-Arg':_0x5b3bd3}});if(_0x45c056['status']!=0xc8){if(_0x45c056[_0x3a4a5e(0x11f)]==0x191){var _0x350e1f=await dpRefreshToken();if(!_0x350e1f)throw _0x3a4a5e(0x159);continue;}else throw _0x3a4a5e(0x158)+_0x45c056['status'];}const _0x305033=new File([await _0x45c056['blob']()],_0x53cab2);return console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x305033[_0x3a4a5e(0x14f)]),a0_0x69afa0[_0x3a4a5e(0x15b)](_0x305033,()=>{var _0x21ec85=_0x3a4a5e;localStorageFile(),Module[_0x21ec85(0x134)]();}),_0x305033;}return![];}document['addEventListener'](a0_0x1a6e12(0x124),function(){var _0x13aa30=a0_0x1a6e12;dropboxRestore[_0x13aa30(0x165)](_0x13aa30(0x15f),async function(){var _0x17d0f3=_0x13aa30;await lockNoti(_0x17d0f3(0x126),'',0x1388);const _0x54f615=localStorage['getItem'](_0x17d0f3(0x16c)),_0x3f5d75=[_0x17d0f3(0x16f),_0x17d0f3(0x143),_0x17d0f3(0x156)];if(!_0x54f615){window[_0x17d0f3(0x136)]('Cloud\x20login\x20required!');return;}let _0x31ead3=[];for(const _0x203e57 of _0x3f5d75){let _0x1679ec={'path':'/'+_0x54f615+'/'+_0x203e57};for(let _0x12fa25=0x0;_0x12fa25<0x2;_0x12fa25++){let _0xb5de5=await fetch(_0x17d0f3(0x122),{'method':_0x17d0f3(0x13d),'headers':{'Authorization':_0x17d0f3(0x13f)+localStorage[_0x17d0f3(0x117)](_0x17d0f3(0x163)),'Content-Type':_0x17d0f3(0x144)},'body':JSON[_0x17d0f3(0x12c)](_0x1679ec)});if(_0xb5de5[_0x17d0f3(0x11f)]===0xc8){let _0x546d45=await _0xb5de5[_0x17d0f3(0x145)](),_0x16769e=_0x546d45['entries'][_0x17d0f3(0x130)](_0x11d84c=>_0x11d84c['.tag']===_0x17d0f3(0x15e));_0x16769e['length']>0x0&&_0x31ead3['push'](..._0x16769e[_0x17d0f3(0x148)](_0xd02b01=>({'name':_0xd02b01[_0x17d0f3(0x14f)],'folder':_0x203e57})));break;}else{if(_0xb5de5[_0x17d0f3(0x11f)]===0x191){let _0x170c7f=await dpRefreshToken();if(!_0x170c7f)throw _0x17d0f3(0x159);}else{console[_0x17d0f3(0x146)](_0x17d0f3(0x125)+_0x203e57+_0x17d0f3(0x135)+_0xb5de5[_0x17d0f3(0x11f)]);break;}}}}if(_0x31ead3[_0x17d0f3(0x138)]>0x0){const _0x15e7ed=_0x17d0f3(0x142)+_0x31ead3[_0x17d0f3(0x138)]+_0x17d0f3(0x12d);if(window[_0x17d0f3(0x11a)](_0x15e7ed))for(const _0x4eb126 of _0x31ead3){await lockNoti(_0x17d0f3(0x147),_0x4eb126['name'],0xbb8),await dpDownloadFile(_0x4eb126[_0x17d0f3(0x14f)],_0x4eb126[_0x17d0f3(0x110)]);}else console[_0x17d0f3(0x164)](_0x17d0f3(0x169));}else console[_0x17d0f3(0x164)](_0x17d0f3(0x10f));}),dropboxBackup[_0x13aa30(0x165)](_0x13aa30(0x15f),async function(){var _0x552211=_0x13aa30;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x5da737=localStorage[_0x552211(0x117)](_0x552211(0x16c));if(_0x5da737===null||_0x5da737==='')window[_0x552211(0x136)](_0x552211(0x11e));else{const _0x4c6fa8=[_0x552211(0x16f),_0x552211(0x143),_0x552211(0x156)];for(const _0x3eaf03 of _0x4c6fa8){await dpCreateFolder(_0x3eaf03);}let _0x1a6e9b=0x0;for(const _0x59135f of _0x4c6fa8){const _0x20520e=a0_0x69afa0[_0x552211(0x111)+(_0x59135f[_0x552211(0x161)](0x0)['toUpperCase']()+_0x59135f[_0x552211(0x123)](0x1))]();_0x1a6e9b+=_0x20520e[_0x552211(0x138)];}if(window[_0x552211(0x11a)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x1a6e9b+_0x552211(0x127)))for(const _0x310d7f of _0x4c6fa8){const _0x94ae7b=a0_0x69afa0['list'+(_0x310d7f[_0x552211(0x161)](0x0)[_0x552211(0x113)]()+_0x310d7f['slice'](0x1))]();for(const _0x289f0d of _0x94ae7b){const _0x3c1ae8=await a0_0x69afa0[_0x552211(0x157)]('/data/'+_0x310d7f+'s/'+_0x289f0d);try{await lockNoti(_0x552211(0x14e),_0x289f0d,0xbb8),await dpUploadFile(_0x289f0d,_0x3c1ae8,_0x310d7f);}catch(_0x5ad426){console['error']('Failed\x20to\x20upload\x20file\x20'+_0x289f0d+':',_0x5ad426);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x13aa30(0x15f),function(){var _0x12abb4=_0x13aa30;const _0x48b426=localStorage[_0x12abb4(0x117)]('uId');_0x48b426===null||_0x48b426===''?authorizeWithDropbox():window[_0x12abb4(0x11a)](_0x12abb4(0x152))&&(localStorage['setItem']('uId',''),dropboxRestore[_0x12abb4(0x14b)][_0x12abb4(0x139)](_0x12abb4(0x132)),dropboxBackup[_0x12abb4(0x14b)][_0x12abb4(0x139)](_0x12abb4(0x132)),dropboxCloud[_0x12abb4(0x14b)][_0x12abb4(0x139)](_0x12abb4(0x132)));}),handleDropboxCallback();});