var a0_0x317b48=a0_0x1bad;(function(_0x442009,_0x10397e){var _0x43916a=a0_0x1bad,_0x4b2d1e=_0x442009();while(!![]){try{var _0x577b0f=-parseInt(_0x43916a(0xb7))/0x1*(-parseInt(_0x43916a(0xde))/0x2)+-parseInt(_0x43916a(0xbd))/0x3+-parseInt(_0x43916a(0x84))/0x4*(-parseInt(_0x43916a(0x80))/0x5)+-parseInt(_0x43916a(0xc1))/0x6*(parseInt(_0x43916a(0xcb))/0x7)+parseInt(_0x43916a(0xe5))/0x8*(parseInt(_0x43916a(0xc3))/0x9)+-parseInt(_0x43916a(0xdc))/0xa*(parseInt(_0x43916a(0xe7))/0xb)+parseInt(_0x43916a(0xa0))/0xc;if(_0x577b0f===_0x10397e)break;else _0x4b2d1e['push'](_0x4b2d1e['shift']());}catch(_0x115aa2){_0x4b2d1e['push'](_0x4b2d1e['shift']());}}}(a0_0x5a7b,0xe0ed0));import*as a0_0x372390 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x317b48(0xbe),clientSecret=a0_0x317b48(0xaf);function authorizeWithDropbox(){var _0x11f739=a0_0x317b48,_0x37d4f3=window[_0x11f739(0x92)][_0x11f739(0x81)]['split']('?')[0x0],_0x4ca6cf=_0x11f739(0x8a),_0x373d4e=_0x11f739(0x86),_0x48c809=_0x11f739(0xab)+clientId+'&response_type='+_0x4ca6cf+_0x11f739(0xcf)+_0x373d4e+_0x11f739(0xd9)+encodeURIComponent(_0x37d4f3);window[_0x11f739(0x92)][_0x11f739(0x81)]=_0x48c809;}function handleDropboxCallback(){var _0x5eac74=a0_0x317b48,_0x356d79=getUrlParameter(_0x5eac74(0x8a));_0x356d79?(getAccessToken(_0x356d79),console[_0x5eac74(0xac)](_0x5eac74(0xcc),_0x356d79)):console['log'](_0x5eac74(0x7d));}function a0_0x5a7b(){var _0x1e02e6=['14tuFKqd','Authorization\x20Code:','[\x5c?&#]','Error\x20while\x20refreshing\x20token:','&token_access_type=','.gba_dateState','.ss1','https://api.dropboxapi.com/2/files/list_folder','exec','replace','open','Do\x20you\x20want\x20to\x20logout?','status:\x20','Restore\x20canceled\x20by\x20user.','&redirect_uri=','alert','list','8548550YGtBnG','filter','326tlVrXt','&client_secret=','access_token','responseText','https://api.dropbox.com/oauth2/token','Bearer\x20','.ss5','108040aMThrG','substring','22IgEUaN','refreshToken','.txt','toUpperCase','Cloud\x20login\x20required!','Unable\x20to\x20refresh\x20token','application/json','authorization_code','stringify','Do\x20not\x20receive\x20authorization','name','state','5416535PilOjW','href','&grant_type=','lastIndexOf','4zfdCXU','https://api.dropboxapi.com/oauth2/token','offline','uid','click','classList','code','setItem','Do\x20you\x20want\x20to\x20restore\x20','.ss4','getItem','.ss0','POST','https://content.dropboxapi.com/2/files/upload','location','charAt','application/octet-stream','.ss3','https://content.dropboxapi.com/2/files/download','_imageState','file','accessToken','split','refresh_token=','remove','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','parse','Refreshing\x20token...','8117892yQqvwC','blob','onload','length','\x20files\x20in\x20Kabu?','gba','send','text','overwrite','slice','status','https://www.dropbox.com/oauth2/authorize?client_id=','log','.tag','uploadSaveOrSaveState','nwb3dnfh09rhs31','Failed\x20to\x20upload\x20file\x20','endsWith','entries','.ss7','refresh_token','.ss2','confirm','9327cuehaS','addEventListener','Download\x20failed,\x20unknown\x20http\x20status:\x20','.gba_slot','active','json','2179146dZEnQo','knh3uz2mx2hp2eu','Backing\x20up...','uId','537918VieTzZ','error','171lqFUmW','/data/','search','application/x-www-form-urlencoded','=([^&#]*)','Failed\x20to\x20refresh\x20Dropbox\x20token.','&client_id=','No\x20refresh\x20token'];a0_0x5a7b=function(){return _0x1e02e6;};return a0_0x5a7b();}function a0_0x1bad(_0x12c126,_0x261658){var _0x5a7bb3=a0_0x5a7b();return a0_0x1bad=function(_0x1bad16,_0x4417a2){_0x1bad16=_0x1bad16-0x7c;var _0x101c46=_0x5a7bb3[_0x1bad16];return _0x101c46;},a0_0x1bad(_0x12c126,_0x261658);}function getUrlParameter(_0x43f003){var _0x149a96=a0_0x317b48;_0x43f003=_0x43f003[_0x149a96(0xd4)](/[\[]/,'\x5c[')[_0x149a96(0xd4)](/[\]]/,'\x5c]');var _0x4fea9f=new RegExp(_0x149a96(0xcd)+_0x43f003+_0x149a96(0xc7)),_0x537419=_0x4fea9f[_0x149a96(0xd3)](location[_0x149a96(0xc5)]);return _0x537419===null?'':decodeURIComponent(_0x537419[0x1][_0x149a96(0xd4)](/\+/g,'\x20'));}function getAccessToken(_0x4f3d7c){var _0x5dd296=a0_0x317b48,_0x111fba=_0x5dd296(0xee),_0x3a8d8b=window[_0x5dd296(0x92)][_0x5dd296(0x81)]['split']('?')[0x0],_0x5bb51f=new XMLHttpRequest();_0x5bb51f[_0x5dd296(0xd5)](_0x5dd296(0x90),_0x5dd296(0xe2)),_0x5bb51f['setRequestHeader']('Content-Type',_0x5dd296(0xc6)),_0x5bb51f[_0x5dd296(0xa2)]=function(){var _0x6d34dd=_0x5dd296;if(_0x5bb51f[_0x6d34dd(0xaa)]===0xc8){var _0x481a4e=JSON[_0x6d34dd(0x9e)](_0x5bb51f[_0x6d34dd(0xe1)]),_0x585d28=_0x481a4e[_0x6d34dd(0xe0)],_0xd29ca4=_0x481a4e[_0x6d34dd(0xb4)],_0x56a963=_0x481a4e[_0x6d34dd(0x87)];localStorage['setItem'](_0x6d34dd(0x99),_0x585d28),localStorage[_0x6d34dd(0x8b)](_0x6d34dd(0xe8),_0xd29ca4),localStorage[_0x6d34dd(0x8b)](_0x6d34dd(0xc0),_0x56a963);}else console[_0x6d34dd(0xac)](_0x6d34dd(0x9d));},_0x5bb51f[_0x5dd296(0xa6)]('code='+_0x4f3d7c+_0x5dd296(0x82)+_0x111fba+_0x5dd296(0xc9)+clientId+_0x5dd296(0xdf)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x3a8d8b));}export async function dpRefreshToken(){var _0x58fb76=a0_0x317b48;if(!localStorage['getItem'](_0x58fb76(0xe8)))throw _0x58fb76(0xca);try{const _0x2d3d1a=await fetch(_0x58fb76(0x85),{'method':'POST','headers':{'Content-Type':_0x58fb76(0xc6)},'body':_0x58fb76(0x9b)+localStorage[_0x58fb76(0x8e)](_0x58fb76(0xe8))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x323964=await _0x2d3d1a[_0x58fb76(0xbc)]();if(!_0x323964[_0x58fb76(0xc2)])return localStorage[_0x58fb76(0x8b)](_0x58fb76(0x99),_0x323964[_0x58fb76(0xe0)]),await lockNoti('',_0x58fb76(0x9f),0xbb8),await delay(0x3e8),!![];else alert(_0x323964['error_description']||_0x58fb76(0xc8));}catch(_0x5c151f){console['error'](_0x58fb76(0xce),_0x5c151f);}return![];}export async function dpUploadFile(_0x2422fd,_0x3256d6){var _0x3c3683=a0_0x317b48;const _0x442498=localStorage[_0x3c3683(0x8e)]('uId');var _0x18dac6=JSON[_0x3c3683(0x7c)]({'autorename':!![],'mode':_0x3c3683(0xa8),'mute':!![],'strict_conflict':![],'path':'/'+_0x442498+'/'+_0x2422fd}),_0x3bf62d=new Blob([_0x3256d6],{'type':_0x3c3683(0x94)});for(var _0x4e7fb0=0x0;_0x4e7fb0<0x2;_0x4e7fb0++){var _0x3e681a=await fetch(_0x3c3683(0x91),{'method':_0x3c3683(0x90),'headers':{'Authorization':_0x3c3683(0xe3)+localStorage[_0x3c3683(0x8e)](_0x3c3683(0x99)),'Dropbox-API-Arg':_0x18dac6,'Content-Type':_0x3c3683(0x94)},'body':_0x3bf62d});if(_0x3e681a['status']!=0xc8){if(_0x3e681a[_0x3c3683(0xaa)]==0x191){var _0x46a630=await dpRefreshToken();if(!_0x46a630)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x3e681a['status'];}else{var _0x5e59b0=await _0x3e681a[_0x3c3683(0xbc)]();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x2422fd),_0x5e59b0;}}return![];}async function dpDownloadFile(_0x13a01e){var _0x4ca137=a0_0x317b48;const _0x53575a=localStorage[_0x4ca137(0x8e)](_0x4ca137(0xc0));var _0x2efa10=JSON['stringify']({'path':'/'+_0x53575a+'/'+_0x13a01e});for(var _0x2c8c60=0x0;_0x2c8c60<0x2;_0x2c8c60++){var _0x2d2ca9=await fetch(_0x4ca137(0x96),{'method':_0x4ca137(0x90),'headers':{'Authorization':_0x4ca137(0xe3)+localStorage[_0x4ca137(0x8e)](_0x4ca137(0x99)),'Dropbox-API-Arg':_0x2efa10}});if(_0x2d2ca9[_0x4ca137(0xaa)]!=0xc8){if(_0x2d2ca9['status']==0x191){var _0x362cb0=await dpRefreshToken();if(!_0x362cb0)throw _0x4ca137(0xec);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x2d2ca9[_0x4ca137(0xaa)];}const _0x4427e=new File([await _0x2d2ca9[_0x4ca137(0xa1)]()],_0x13a01e);console[_0x4ca137(0xac)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x4427e[_0x4ca137(0x7e)]);if(_0x13a01e[_0x4ca137(0xb1)](_0x4ca137(0xe9))){const _0x546ef3=await _0x4427e[_0x4ca137(0xa7)](),[_0x3b748a,_0x1c2062]=_0x546ef3[_0x4ca137(0x9a)]('\x0a\x0a'),_0x57dbea=_0x13a01e[_0x4ca137(0xe6)](0x0,_0x13a01e['lastIndexOf'](_0x4ca137(0xa5))+0x3),_0x15bff8=_0x13a01e['charAt'](_0x13a01e[_0x4ca137(0xa3)]-0x5);localStorage[_0x4ca137(0x8b)](_0x57dbea+'_dateState'+_0x15bff8,_0x1c2062),localStorage[_0x4ca137(0x8b)](_0x57dbea+_0x4ca137(0x97)+_0x15bff8,_0x3b748a);}else a0_0x372390[_0x4ca137(0xae)](_0x4427e,()=>{localStorageFile(),Module['FSSync']();});return _0x4427e;}return![];}document['addEventListener']('DOMContentLoaded',function(){var _0x55ea6a=a0_0x317b48;dropboxRestore['addEventListener']('click',async function(){var _0x1b3aaf=a0_0x1bad;const _0x2ac5a5=localStorage[_0x1b3aaf(0x8e)](_0x1b3aaf(0xc0));if(_0x2ac5a5===null||_0x2ac5a5==='')window['alert'](_0x1b3aaf(0xeb));else{var _0x5d3430={'path':'/'+_0x2ac5a5};for(var _0x53167f=0x0;_0x53167f<0x2;_0x53167f++){var _0x45aa09=await fetch(_0x1b3aaf(0xd2),{'method':_0x1b3aaf(0x90),'headers':{'Authorization':_0x1b3aaf(0xe3)+localStorage[_0x1b3aaf(0x8e)](_0x1b3aaf(0x99)),'Content-Type':_0x1b3aaf(0xed)},'body':JSON[_0x1b3aaf(0x7c)](_0x5d3430)});console[_0x1b3aaf(0xac)](_0x1b3aaf(0xd7),_0x45aa09[_0x1b3aaf(0xaa)]);if(_0x45aa09[_0x1b3aaf(0xaa)]!=0xc8){if(_0x45aa09['status']==0x191){var _0x3fc1cf=await dpRefreshToken();if(!_0x3fc1cf)throw _0x1b3aaf(0xec);continue;}else throw _0x1b3aaf(0xb9)+_0x45aa09['status'];}else{const _0x5d1cbe=await _0x45aa09[_0x1b3aaf(0xbc)](),_0x1f8da5=_0x5d1cbe['entries'][_0x1b3aaf(0xdd)](_0x27a7b7=>_0x27a7b7['.tag']===_0x1b3aaf(0x98))['length'],_0x251803=_0x1b3aaf(0x8c)+_0x1f8da5+'\x20files\x20in\x20Cloud?';if(window[_0x1b3aaf(0xb6)](_0x251803))for(const _0xef12ec of _0x5d1cbe[_0x1b3aaf(0xb2)]){_0xef12ec[_0x1b3aaf(0xad)]==='file'&&(await lockNoti('Restoring...',_0xef12ec[_0x1b3aaf(0x7e)],0xbb8),await dpDownloadFile(_0xef12ec['name']));}else console[_0x1b3aaf(0xac)](_0x1b3aaf(0xd8));return!![];}}return![];}}),dropboxBackup[_0x55ea6a(0xb8)](_0x55ea6a(0x88),async function(){var _0xd3912d=_0x55ea6a;const _0x4618e0=localStorage[_0xd3912d(0x8e)]('uId');if(_0x4618e0===null||_0x4618e0==='')window[_0xd3912d(0xda)](_0xd3912d(0xeb));else{const _0x493961=[_0xd3912d(0x7f),'save'];let _0x53db25=0x0;for(const _0x40a3e1 of _0x493961){const _0x4fff24=a0_0x372390['list'+(_0x40a3e1[_0xd3912d(0x93)](0x0)[_0xd3912d(0xea)]()+_0x40a3e1[_0xd3912d(0xa9)](0x1))]();_0x53db25+=_0x4fff24[_0xd3912d(0xa3)];}if(window[_0xd3912d(0xb6)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x53db25+_0xd3912d(0xa4)))for(const _0x399b64 of _0x493961){const _0x1e1ac8=a0_0x372390[_0xd3912d(0xdb)+(_0x399b64[_0xd3912d(0x93)](0x0)[_0xd3912d(0xea)]()+_0x399b64[_0xd3912d(0xa9)](0x1))]();for(const _0x4168b9 of _0x1e1ac8){const _0x5e4c72=await a0_0x372390['downloadFileInCloud'](_0xd3912d(0xc4)+_0x399b64+'s/'+_0x4168b9);try{await lockNoti(_0xd3912d(0xbf),_0x4168b9,0xbb8),await dpUploadFile(_0x4168b9,_0x5e4c72);if(_0x4168b9[_0xd3912d(0xb1)](_0xd3912d(0x8f))||_0x4168b9[_0xd3912d(0xb1)](_0xd3912d(0xd1))||_0x4168b9[_0xd3912d(0xb1)](_0xd3912d(0xb5))||_0x4168b9['endsWith'](_0xd3912d(0x95))||_0x4168b9[_0xd3912d(0xb1)](_0xd3912d(0x8d))||_0x4168b9[_0xd3912d(0xb1)](_0xd3912d(0xe4))||_0x4168b9['endsWith']('.ss6')||_0x4168b9[_0xd3912d(0xb1)](_0xd3912d(0xb3))){const _0x16fb5c=_0x4168b9['substring'](0x0,_0x4168b9[_0xd3912d(0x83)]('.')),_0x36c1be=_0x4168b9[_0xd3912d(0x93)](_0x4168b9['length']-0x1),_0x1789ab=localStorage[_0xd3912d(0x8e)](_0x16fb5c+'.gba_imageState'+_0x36c1be),_0x32d29d=localStorage[_0xd3912d(0x8e)](_0x16fb5c+_0xd3912d(0xd0)+_0x36c1be);if(_0x1789ab!==null){const _0xb2f6dc=_0x1789ab+'\x0a\x0a'+_0x32d29d,_0x58469a=new Blob([_0xb2f6dc],{'type':'text/plain'});await lockNoti('Backing\x20up...',_0x16fb5c+_0xd3912d(0xba)+_0x36c1be+_0xd3912d(0xe9),0xbb8),await dpUploadFile(_0x16fb5c+_0xd3912d(0xba)+_0x36c1be+'.txt',_0x58469a);}}}catch(_0x427459){console[_0xd3912d(0xc2)](_0xd3912d(0xb0)+_0x4168b9+':',_0x427459);}}}else console['log'](_0xd3912d(0xd8));}}),dropboxCloud[_0x55ea6a(0xb8)](_0x55ea6a(0x88),function(){var _0x137a59=_0x55ea6a;const _0x3c7a4f=localStorage['getItem'](_0x137a59(0xc0));_0x3c7a4f===null||_0x3c7a4f===''?authorizeWithDropbox():window['confirm'](_0x137a59(0xd6))&&(localStorage[_0x137a59(0x8b)](_0x137a59(0xc0),''),dropboxRestore[_0x137a59(0x89)]['remove'](_0x137a59(0xbb)),dropboxBackup[_0x137a59(0x89)][_0x137a59(0x9c)](_0x137a59(0xbb)),dropboxCloud['classList']['remove']('active'));}),handleDropboxCallback();});