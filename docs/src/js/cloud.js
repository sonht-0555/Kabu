var a0_0x340122=a0_0x3a7a;function a0_0x47d5(){var _0x465673=['active','Do\x20you\x20want\x20to\x20backup\x20','Cloud\x20login\x20required!','949572oMQmpp','424881WdOCJt','Wait\x20a\x20little\x20bit...','push','search','code','Do\x20you\x20want\x20to\x20logout?','&grant_type=','parse','4GdqOtK','&client_id=','split','DOMContentLoaded','uid','replace','https://api.dropboxapi.com/2/files/list_folder','uId','classList','filter','Failed\x20to\x20upload\x20file\x20','117840CHvXPG','map','7bBLHLa','screenshot','folder','986905gyIfez','downloadFileInCloud','application/octet-stream','save','state','confirm','href','error','log','remove','4610jwdOzl','Unable\x20to\x20refresh\x20token','code=','Upload\x20failed,\x20unknown\x20http\x20status:\x20','No\x20refresh\x20token','nwb3dnfh09rhs31','listFiles','POST','accessToken','application/x-www-form-urlencoded','https://content.dropboxapi.com/2/files/download','responseText','&redirect_uri=','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','https://www.dropbox.com/oauth2/authorize?client_id=','access_token','length','8BdLAAZ','Bearer\x20','status','[\x5c?&#]','exec','Kabu\x20storage\x20↦\x20Cloud\x20◆','Folder\x20already\x20exists','Refreshing\x20token...','Backing\x20up...','Do\x20not\x20receive\x20authorization','Download\x20failed,\x20unknown\x20http\x20status:','Restore\x20canceled\x20by\x20user.','No\x20files\x20found\x20to\x20restore.','setItem','&token_access_type=','Restoring...','Error\x20creating\x20folder\x20','refresh_token=','82923HBttdT','refresh_token','Authorization\x20Code:','Download\x20failed\x20for\x20','click','refreshToken','https://content.dropboxapi.com/2/files/upload','4136HBHbOX','https://api.dropboxapi.com/2/files/create_folder_v2','Cloud\x20↦\x20Kabu\x20storage\x20◆','Do\x20you\x20want\x20to\x20restore\x20','alert','100141nhWjmm','location','2XtIBME','Content-Type','stringify','name','json',',\x20status:\x20','file','Failed\x20to\x20refresh\x20Dropbox\x20token.','addEventListener','overwrite','getItem','application/json'];a0_0x47d5=function(){return _0x465673;};return a0_0x47d5();}(function(_0x35f516,_0x20bdb6){var _0x3fcb2e=a0_0x3a7a,_0x3efaff=_0x35f516();while(!![]){try{var _0x5723cc=-parseInt(_0x3fcb2e(0xce))/0x1+-parseInt(_0x3fcb2e(0xd0))/0x2*(-parseInt(_0x3fcb2e(0xc2))/0x3)+-parseInt(_0x3fcb2e(0xe8))/0x4*(-parseInt(_0x3fcb2e(0xf8))/0x5)+parseInt(_0x3fcb2e(0xdf))/0x6*(-parseInt(_0x3fcb2e(0xf5))/0x7)+parseInt(_0x3fcb2e(0xb0))/0x8*(-parseInt(_0x3fcb2e(0xe0))/0x9)+parseInt(_0x3fcb2e(0x9f))/0xa*(parseInt(_0x3fcb2e(0xc9))/0xb)+parseInt(_0x3fcb2e(0xf3))/0xc;if(_0x5723cc===_0x20bdb6)break;else _0x3efaff['push'](_0x3efaff['shift']());}catch(_0x5e7223){_0x3efaff['push'](_0x3efaff['shift']());}}}(a0_0x47d5,0x190a6));import*as a0_0x5482b2 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x340122(0xa4);function authorizeWithDropbox(){var _0x4755ce=a0_0x340122,_0x5f4afb=window[_0x4755ce(0xcf)][_0x4755ce(0x9b)][_0x4755ce(0xea)]('?')[0x0],_0x414dc9='code',_0xf21035='offline',_0x35b4b4=_0x4755ce(0xad)+clientId+'&response_type='+_0x414dc9+_0x4755ce(0xbe)+_0xf21035+'&redirect_uri='+encodeURIComponent(_0x5f4afb);window['location'][_0x4755ce(0x9b)]=_0x35b4b4;}function a0_0x3a7a(_0x23bb9b,_0x159381){var _0x47d532=a0_0x47d5();return a0_0x3a7a=function(_0x3a7a76,_0x2f7f5e){_0x3a7a76=_0x3a7a76-0x97;var _0x25b536=_0x47d532[_0x3a7a76];return _0x25b536;},a0_0x3a7a(_0x23bb9b,_0x159381);}function handleDropboxCallback(){var _0x22455d=a0_0x340122,_0x8ced39=getUrlParameter(_0x22455d(0xe4));_0x8ced39?(getAccessToken(_0x8ced39),console['log'](_0x22455d(0xc4),_0x8ced39)):console['log'](_0x22455d(0xb9));}function getUrlParameter(_0xbac8ef){var _0x25dbfd=a0_0x340122;_0xbac8ef=_0xbac8ef['replace'](/[\[]/,'\x5c[')[_0x25dbfd(0xed)](/[\]]/,'\x5c]');var _0x35050e=new RegExp(_0x25dbfd(0xb3)+_0xbac8ef+'=([^&#]*)'),_0x49328e=_0x35050e[_0x25dbfd(0xb4)](location[_0x25dbfd(0xe3)]);return _0x49328e===null?'':decodeURIComponent(_0x49328e[0x1][_0x25dbfd(0xed)](/\+/g,'\x20'));}function getAccessToken(_0x363eeb){var _0x1d9c4c=a0_0x340122,_0x3f1c92='authorization_code',_0x43afc3=window[_0x1d9c4c(0xcf)][_0x1d9c4c(0x9b)][_0x1d9c4c(0xea)]('?')[0x0],_0x3e6a35=new XMLHttpRequest();_0x3e6a35['open'](_0x1d9c4c(0xa6),'https://api.dropbox.com/oauth2/token'),_0x3e6a35['setRequestHeader'](_0x1d9c4c(0xd1),_0x1d9c4c(0xa8)),_0x3e6a35['onload']=function(){var _0x2a45b8=_0x1d9c4c;if(_0x3e6a35[_0x2a45b8(0xb2)]===0xc8){var _0xffb791=JSON[_0x2a45b8(0xe7)](_0x3e6a35[_0x2a45b8(0xaa)]),_0x3afe50=_0xffb791['access_token'],_0x46ef16=_0xffb791[_0x2a45b8(0xc3)],_0x2bb886=_0xffb791[_0x2a45b8(0xec)];localStorage[_0x2a45b8(0xbd)](_0x2a45b8(0xa7),_0x3afe50),localStorage['setItem']('refreshToken',_0x46ef16),localStorage[_0x2a45b8(0xbd)](_0x2a45b8(0xef),_0x2bb886);}else console[_0x2a45b8(0x9d)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x3e6a35['send'](_0x1d9c4c(0xa1)+_0x363eeb+_0x1d9c4c(0xe6)+_0x3f1c92+_0x1d9c4c(0xe9)+clientId+'&client_secret='+clientSecret+_0x1d9c4c(0xab)+encodeURIComponent(_0x43afc3));}export async function dpCreateFolder(_0x577157){var _0xf96a7e=a0_0x340122;const _0x26767e=localStorage['getItem'](_0xf96a7e(0xef));let _0x432a63=localStorage[_0xf96a7e(0xda)]('accessToken');const _0x6a433c='/'+_0x26767e+'/'+_0x577157,_0x5f3134=JSON[_0xf96a7e(0xd2)]({'path':_0x6a433c,'autorename':![]});for(let _0x524df0=0x0;_0x524df0<0x2;_0x524df0++){try{const _0x22381f=await fetch(_0xf96a7e(0xca),{'method':_0xf96a7e(0xa6),'headers':{'Authorization':_0xf96a7e(0xb1)+_0x432a63,'Content-Type':_0xf96a7e(0xdb)},'body':_0x5f3134});if(_0x22381f[_0xf96a7e(0xb2)]===0x191){const _0x5c2b58=await dpRefreshToken();if(!_0x5c2b58)throw new Error(_0xf96a7e(0xa0));_0x432a63=localStorage[_0xf96a7e(0xda)](_0xf96a7e(0xa7));continue;}if(_0x22381f[_0xf96a7e(0xb2)]===0x199)return{'message':_0xf96a7e(0xb6),'path':_0x577157};if(!_0x22381f['ok'])throw new Error(_0xf96a7e(0xc0)+_0x577157);const _0x86f547=await _0x22381f[_0xf96a7e(0xd4)]();return await lockNoti('Folder\x20created','',0xbb8),_0x86f547;}catch(_0x5c48bc){if(_0x524df0===0x1)throw _0x5c48bc;}}return![];}export async function dpRefreshToken(){var _0x2cc23b=a0_0x340122;if(!localStorage[_0x2cc23b(0xda)](_0x2cc23b(0xc7)))throw _0x2cc23b(0xa3);try{const _0xb46fb0=await fetch('https://api.dropboxapi.com/oauth2/token',{'method':'POST','headers':{'Content-Type':_0x2cc23b(0xa8)},'body':_0x2cc23b(0xc1)+localStorage[_0x2cc23b(0xda)](_0x2cc23b(0xc7))+_0x2cc23b(0xac)}),_0xac567b=await _0xb46fb0[_0x2cc23b(0xd4)]();if(!_0xac567b['error'])return localStorage[_0x2cc23b(0xbd)](_0x2cc23b(0xa7),_0xac567b[_0x2cc23b(0xae)]),await lockNoti(_0x2cc23b(0xb7),'',0xbb8),await delay(0x3e8),!![];else alert(_0xac567b['error_description']||_0x2cc23b(0xd7));}catch(_0x150a5c){console[_0x2cc23b(0x9c)]('Error\x20while\x20refreshing\x20token:',_0x150a5c);}return![];}export async function dpUploadFile(_0x5dbae7,_0x209e83,_0x2636cc){var _0x477276=a0_0x340122;const _0x1de968=localStorage[_0x477276(0xda)]('uId');var _0xa22785=JSON[_0x477276(0xd2)]({'autorename':!![],'mode':_0x477276(0xd9),'mute':!![],'strict_conflict':![],'path':'/'+_0x1de968+'/'+_0x2636cc+'/'+_0x5dbae7}),_0x333044=new Blob([_0x209e83],{'type':_0x477276(0x97)});for(var _0x4b4b18=0x0;_0x4b4b18<0x2;_0x4b4b18++){var _0x54c4bf=await fetch(_0x477276(0xc8),{'method':_0x477276(0xa6),'headers':{'Authorization':_0x477276(0xb1)+localStorage[_0x477276(0xda)](_0x477276(0xa7)),'Dropbox-API-Arg':_0xa22785,'Content-Type':'application/octet-stream'},'body':_0x333044});if(_0x54c4bf['status']!=0xc8){if(_0x54c4bf['status']==0x191){var _0x446229=await dpRefreshToken();if(!_0x446229)throw _0x477276(0xa0);continue;}else throw _0x477276(0xa2)+_0x54c4bf[_0x477276(0xb2)];}else{var _0x4bf9b0=await _0x54c4bf[_0x477276(0xd4)]();return console['log'](_0x477276(0xb5),_0x5dbae7),_0x4bf9b0;}}return![];}export async function dpDownloadFile(_0x3c2f76,_0x454a07){var _0x222141=a0_0x340122;const _0x3d8e4d=localStorage[_0x222141(0xda)](_0x222141(0xef));var _0x53a049=JSON[_0x222141(0xd2)]({'path':'/'+_0x3d8e4d+'/'+_0x454a07+'/'+_0x3c2f76});for(var _0x1d35d9=0x0;_0x1d35d9<0x2;_0x1d35d9++){var _0x3ee06f=await fetch(_0x222141(0xa9),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x222141(0xda)](_0x222141(0xa7)),'Dropbox-API-Arg':_0x53a049}});if(_0x3ee06f[_0x222141(0xb2)]!=0xc8){if(_0x3ee06f[_0x222141(0xb2)]==0x191){var _0x51aab6=await dpRefreshToken();if(!_0x51aab6)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x222141(0xba)+_0x3ee06f['status'];}const _0x18e6ca=new File([await _0x3ee06f['blob']()],_0x3c2f76);return console['log'](_0x222141(0xcb),_0x18e6ca[_0x222141(0xd3)]),a0_0x5482b2['uploadFileInCloud'](_0x18e6ca,()=>{}),_0x18e6ca;}return![];}document[a0_0x340122(0xd8)](a0_0x340122(0xeb),function(){var _0xe28dfb=a0_0x340122;dropboxRestore[_0xe28dfb(0xd8)](_0xe28dfb(0xc6),async function(){var _0x3ba5c6=_0xe28dfb;await lockNoti(_0x3ba5c6(0xe1),'',0x1388);const _0x34521b=localStorage[_0x3ba5c6(0xda)]('uId'),_0xa9451f=[_0x3ba5c6(0x99),_0x3ba5c6(0x98),'screenshot'];if(!_0x34521b){window[_0x3ba5c6(0xcd)]('Cloud\x20login\x20required!');return;}let _0x27358b=[];for(const _0x160b3c of _0xa9451f){let _0x56e7c0={'path':'/'+_0x34521b+'/'+_0x160b3c};for(let _0x434296=0x0;_0x434296<0x2;_0x434296++){let _0x1b1187=await fetch(_0x3ba5c6(0xee),{'method':'POST','headers':{'Authorization':_0x3ba5c6(0xb1)+localStorage[_0x3ba5c6(0xda)](_0x3ba5c6(0xa7)),'Content-Type':_0x3ba5c6(0xdb)},'body':JSON[_0x3ba5c6(0xd2)](_0x56e7c0)});if(_0x1b1187[_0x3ba5c6(0xb2)]===0xc8){let _0x31c113=await _0x1b1187[_0x3ba5c6(0xd4)](),_0x3fbe99=_0x31c113['entries'][_0x3ba5c6(0xf1)](_0x208fdc=>_0x208fdc['.tag']===_0x3ba5c6(0xd6));_0x3fbe99['length']>0x0&&_0x27358b[_0x3ba5c6(0xe2)](..._0x3fbe99[_0x3ba5c6(0xf4)](_0x416938=>({'name':_0x416938[_0x3ba5c6(0xd3)],'folder':_0x160b3c})));break;}else{if(_0x1b1187[_0x3ba5c6(0xb2)]===0x191){let _0x11f30d=await dpRefreshToken();if(!_0x11f30d)throw _0x3ba5c6(0xa0);}else{console[_0x3ba5c6(0x9c)](_0x3ba5c6(0xc5)+_0x160b3c+_0x3ba5c6(0xd5)+_0x1b1187[_0x3ba5c6(0xb2)]);break;}}}}if(_0x27358b[_0x3ba5c6(0xaf)]>0x0){const _0x3ad4be=_0x3ba5c6(0xcc)+_0x27358b['length']+'\x20files\x20from\x20Cloud?';if(window[_0x3ba5c6(0x9a)](_0x3ad4be))for(const _0x4cc0bb of _0x27358b){await lockNoti(_0x3ba5c6(0xbf),_0x4cc0bb[_0x3ba5c6(0xd3)],0xbb8),await dpDownloadFile(_0x4cc0bb[_0x3ba5c6(0xd3)],_0x4cc0bb[_0x3ba5c6(0xf7)]);}else console[_0x3ba5c6(0x9d)](_0x3ba5c6(0xbb));}else console[_0x3ba5c6(0x9d)](_0x3ba5c6(0xbc));}),dropboxBackup[_0xe28dfb(0xd8)](_0xe28dfb(0xc6),async function(){var _0x2b171f=_0xe28dfb;await lockNoti(_0x2b171f(0xe1),'',0x1388);const _0x321399=localStorage[_0x2b171f(0xda)](_0x2b171f(0xef));if(_0x321399===null||_0x321399==='')window[_0x2b171f(0xcd)](_0x2b171f(0xde));else{const _0x5cf185=[_0x2b171f(0x99),_0x2b171f(0x98),_0x2b171f(0xf6)];for(const _0xe5f133 of _0x5cf185){await dpCreateFolder(_0xe5f133);}let _0x7d79ab=0x0;for(const _0xc97300 of _0x5cf185){const _0x1a952f=a0_0x5482b2[_0x2b171f(0xa5)](_0xc97300+'s');_0x7d79ab+=_0x1a952f[_0x2b171f(0xaf)];}if(window[_0x2b171f(0x9a)](_0x2b171f(0xdd)+_0x7d79ab+'\x20files\x20in\x20Kabu?'))for(const _0x32ae1f of _0x5cf185){const _0x1ed603=a0_0x5482b2[_0x2b171f(0xa5)](_0x32ae1f+'s');for(const _0x1d1c8d of _0x1ed603){const _0xa71627=await a0_0x5482b2[_0x2b171f(0xf9)]('/data/'+_0x32ae1f+'s/'+_0x1d1c8d);try{await lockNoti(_0x2b171f(0xb8),_0x1d1c8d,0xbb8),await dpUploadFile(_0x1d1c8d,_0xa71627,_0x32ae1f);}catch(_0x5604d5){console['error'](_0x2b171f(0xf2)+_0x1d1c8d+':',_0x5604d5);}}}else console['log'](_0x2b171f(0xbb));}}),dropboxCloud[_0xe28dfb(0xd8)](_0xe28dfb(0xc6),function(){var _0xfd5676=_0xe28dfb;const _0xdaf3d0=localStorage[_0xfd5676(0xda)](_0xfd5676(0xef));_0xdaf3d0===null||_0xdaf3d0===''?authorizeWithDropbox():window[_0xfd5676(0x9a)](_0xfd5676(0xe5))&&(localStorage[_0xfd5676(0xbd)](_0xfd5676(0xef),''),dropboxRestore[_0xfd5676(0xf0)][_0xfd5676(0x9e)](_0xfd5676(0xdc)),dropboxBackup[_0xfd5676(0xf0)][_0xfd5676(0x9e)](_0xfd5676(0xdc)),dropboxCloud['classList'][_0xfd5676(0x9e)](_0xfd5676(0xdc)));}),handleDropboxCallback();});