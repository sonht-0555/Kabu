var a0_0x692c4e=a0_0x3d0d;function a0_0x2831(){var _0xcff46c=['Authorization\x20Code:','uploadFileInCloud','3225288goNdHZ','https://api.dropboxapi.com/2/files/create_folder_v2','length','authorization_code','Kabu\x20storage\x20↦\x20Cloud\x20◆','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token',',\x20status:\x20','\x20files\x20in\x20Kabu?','\x20files\x20from\x20Cloud?','Do\x20you\x20want\x20to\x20restore\x20','https://www.dropbox.com/oauth2/authorize?client_id=','Upload\x20failed,\x20unknown\x20http\x20status:\x20','Unable\x20to\x20refresh\x20token','replace','&response_type=','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','overwrite','open','log','Error\x20while\x20refreshing\x20token:','responseText','DOMContentLoaded','Failed\x20to\x20upload\x20file\x20','Wait\x20a\x20little\x20bit...','name','error','nwb3dnfh09rhs31','Do\x20not\x20receive\x20authorization','Restoring...','alert','downloadFileInCloud','screenshot','blob','classList','Error\x20creating\x20folder\x20','application/octet-stream','stringify','uId','setItem','423342tZDvZo','&redirect_uri=','search','remove','code=','/data/','https://content.dropboxapi.com/2/files/download','filter','save','Bearer\x20','Do\x20you\x20want\x20to\x20logout?','&grant_type=','854827JCeyDX','exec','push','entries','&token_access_type=','Folder\x20already\x20exists','200caVHcl','error_description','access_token','send','6519TEunjB','POST','code','Content-Type','.tag','Cloud\x20↦\x20Kabu\x20storage\x20◆','split','22voJRNK','setRequestHeader','No\x20refresh\x20token','click','folder','[\x5c?&#]','listFiles','No\x20files\x20found\x20to\x20restore.','https://api.dropboxapi.com/2/files/list_folder','https://api.dropboxapi.com/oauth2/token','=([^&#]*)','https://api.dropbox.com/oauth2/token','href','11116701bEoItv','uid','1521630dOOLYw','state','offline','Cloud\x20login\x20required!','knh3uz2mx2hp2eu','getItem','refresh_token','application/json','https://content.dropboxapi.com/2/files/upload','addEventListener','accessToken','Folder\x20created','active','status','Refreshing\x20token...','location','&client_id=','json','confirm','refreshToken','Download\x20failed,\x20unknown\x20http\x20status:','application/x-www-form-urlencoded','refresh_token=','130676BdjSlt','Restore\x20canceled\x20by\x20user.'];a0_0x2831=function(){return _0xcff46c;};return a0_0x2831();}(function(_0x38f493,_0x542214){var _0xf12c9d=a0_0x3d0d,_0x3ecc3f=_0x38f493();while(!![]){try{var _0x3c8b01=-parseInt(_0xf12c9d(0x142))/0x1+-parseInt(_0xf12c9d(0xe5))/0x2*(parseInt(_0xf12c9d(0xde))/0x3)+parseInt(_0xf12c9d(0x10f))/0x4+-parseInt(_0xf12c9d(0xf4))/0x5+parseInt(_0xf12c9d(0x136))/0x6+-parseInt(_0xf12c9d(0x10b))/0x7*(parseInt(_0xf12c9d(0xda))/0x8)+parseInt(_0xf12c9d(0xf2))/0x9;if(_0x3c8b01===_0x542214)break;else _0x3ecc3f['push'](_0x3ecc3f['shift']());}catch(_0x541175){_0x3ecc3f['push'](_0x3ecc3f['shift']());}}}(a0_0x2831,0x70de8));import*as a0_0x51b6ac from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x692c4e(0xf8),clientSecret=a0_0x692c4e(0x129);function a0_0x3d0d(_0x486fee,_0x102c61){var _0x28314c=a0_0x2831();return a0_0x3d0d=function(_0x3d0d4e,_0x14ff60){_0x3d0d4e=_0x3d0d4e-0xd8;var _0x55b62c=_0x28314c[_0x3d0d4e];return _0x55b62c;},a0_0x3d0d(_0x486fee,_0x102c61);}function authorizeWithDropbox(){var _0xf0e7d2=a0_0x692c4e,_0x33f025=window['location'][_0xf0e7d2(0xf1)][_0xf0e7d2(0xe4)]('?')[0x0],_0x528591=_0xf0e7d2(0xe0),_0x2809b1=_0xf0e7d2(0xf6),_0x123fbc=_0xf0e7d2(0x119)+clientId+_0xf0e7d2(0x11d)+_0x528591+_0xf0e7d2(0xd8)+_0x2809b1+_0xf0e7d2(0x137)+encodeURIComponent(_0x33f025);window[_0xf0e7d2(0x103)][_0xf0e7d2(0xf1)]=_0x123fbc;}function handleDropboxCallback(){var _0x19b2a8=a0_0x692c4e,_0x1e9493=getUrlParameter(_0x19b2a8(0xe0));_0x1e9493?(getAccessToken(_0x1e9493),console[_0x19b2a8(0x121)](_0x19b2a8(0x10d),_0x1e9493)):console[_0x19b2a8(0x121)](_0x19b2a8(0x12a));}function getUrlParameter(_0x263e60){var _0x493f39=a0_0x692c4e;_0x263e60=_0x263e60[_0x493f39(0x11c)](/[\[]/,'\x5c[')[_0x493f39(0x11c)](/[\]]/,'\x5c]');var _0x20545a=new RegExp(_0x493f39(0xea)+_0x263e60+_0x493f39(0xef)),_0x37e963=_0x20545a[_0x493f39(0x143)](location[_0x493f39(0x138)]);return _0x37e963===null?'':decodeURIComponent(_0x37e963[0x1][_0x493f39(0x11c)](/\+/g,'\x20'));}function getAccessToken(_0x5f0f88){var _0x58167c=a0_0x692c4e,_0xc74d97=_0x58167c(0x112),_0x355c9c=window[_0x58167c(0x103)][_0x58167c(0xf1)][_0x58167c(0xe4)]('?')[0x0],_0x1f92e0=new XMLHttpRequest();_0x1f92e0[_0x58167c(0x120)](_0x58167c(0xdf),_0x58167c(0xf0)),_0x1f92e0[_0x58167c(0xe6)](_0x58167c(0xe1),_0x58167c(0x109)),_0x1f92e0['onload']=function(){var _0x2f4022=_0x58167c;if(_0x1f92e0['status']===0xc8){var _0x5a91cb=JSON['parse'](_0x1f92e0[_0x2f4022(0x123)]),_0x173096=_0x5a91cb['access_token'],_0x34cdb2=_0x5a91cb[_0x2f4022(0xfa)],_0x25f9df=_0x5a91cb[_0x2f4022(0xf3)];localStorage[_0x2f4022(0x135)]('accessToken',_0x173096),localStorage[_0x2f4022(0x135)]('refreshToken',_0x34cdb2),localStorage['setItem'](_0x2f4022(0x134),_0x25f9df);}else console[_0x2f4022(0x121)](_0x2f4022(0x114));},_0x1f92e0[_0x58167c(0xdd)](_0x58167c(0x13a)+_0x5f0f88+_0x58167c(0x141)+_0xc74d97+_0x58167c(0x104)+clientId+'&client_secret='+clientSecret+_0x58167c(0x137)+encodeURIComponent(_0x355c9c));}export async function dpCreateFolder(_0x460636){var _0x2c6622=a0_0x692c4e;const _0x53ffb1=localStorage[_0x2c6622(0xf9)]('uId');let _0x307502=localStorage[_0x2c6622(0xf9)](_0x2c6622(0xfe));const _0x5241ee='/'+_0x53ffb1+'/'+_0x460636,_0x9dc7aa=JSON['stringify']({'path':_0x5241ee,'autorename':![]});for(let _0x444fe8=0x0;_0x444fe8<0x2;_0x444fe8++){try{const _0x4c6450=await fetch(_0x2c6622(0x110),{'method':_0x2c6622(0xdf),'headers':{'Authorization':_0x2c6622(0x13f)+_0x307502,'Content-Type':_0x2c6622(0xfb)},'body':_0x9dc7aa});if(_0x4c6450['status']===0x191){const _0x103f2e=await dpRefreshToken();if(!_0x103f2e)throw new Error(_0x2c6622(0x11b));_0x307502=localStorage['getItem']('accessToken');continue;}if(_0x4c6450[_0x2c6622(0x101)]===0x199)return{'message':_0x2c6622(0xd9),'path':_0x460636};if(!_0x4c6450['ok'])throw new Error(_0x2c6622(0x131)+_0x460636);const _0x4d7e13=await _0x4c6450['json']();return await lockNoti(_0x2c6622(0xff),'',0xbb8),_0x4d7e13;}catch(_0x2fd062){if(_0x444fe8===0x1)throw _0x2fd062;}}return![];}export async function dpRefreshToken(){var _0x40da0c=a0_0x692c4e;if(!localStorage[_0x40da0c(0xf9)]('refreshToken'))throw _0x40da0c(0xe7);try{const _0x578231=await fetch(_0x40da0c(0xee),{'method':_0x40da0c(0xdf),'headers':{'Content-Type':_0x40da0c(0x109)},'body':_0x40da0c(0x10a)+localStorage[_0x40da0c(0xf9)](_0x40da0c(0x107))+_0x40da0c(0x11e)}),_0x3c15a7=await _0x578231[_0x40da0c(0x105)]();if(!_0x3c15a7[_0x40da0c(0x128)])return localStorage[_0x40da0c(0x135)]('accessToken',_0x3c15a7[_0x40da0c(0xdc)]),await lockNoti(_0x40da0c(0x102),'',0xbb8),await delay(0x3e8),!![];else alert(_0x3c15a7[_0x40da0c(0xdb)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x3a6d0d){console[_0x40da0c(0x128)](_0x40da0c(0x122),_0x3a6d0d);}return![];}export async function dpUploadFile(_0xaac780,_0x40cd46,_0x524c4b){var _0x3fb73e=a0_0x692c4e;const _0x271aec=localStorage[_0x3fb73e(0xf9)]('uId');var _0x583ac4=JSON[_0x3fb73e(0x133)]({'autorename':!![],'mode':_0x3fb73e(0x11f),'mute':!![],'strict_conflict':![],'path':'/'+_0x271aec+'/'+_0x524c4b+'/'+_0xaac780}),_0x4e4fd4=new Blob([_0x40cd46],{'type':'application/octet-stream'});for(var _0x5bf014=0x0;_0x5bf014<0x2;_0x5bf014++){var _0x313929=await fetch(_0x3fb73e(0xfc),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x3fb73e(0xf9)](_0x3fb73e(0xfe)),'Dropbox-API-Arg':_0x583ac4,'Content-Type':_0x3fb73e(0x132)},'body':_0x4e4fd4});if(_0x313929[_0x3fb73e(0x101)]!=0xc8){if(_0x313929[_0x3fb73e(0x101)]==0x191){var _0x8b4bb5=await dpRefreshToken();if(!_0x8b4bb5)throw _0x3fb73e(0x11b);continue;}else throw _0x3fb73e(0x11a)+_0x313929['status'];}else{var _0x27ad6d=await _0x313929[_0x3fb73e(0x105)]();return console[_0x3fb73e(0x121)](_0x3fb73e(0x113),_0xaac780),_0x27ad6d;}}return![];}export async function dpDownloadFile(_0x4429b3,_0x4aa1e0){var _0x48d6a9=a0_0x692c4e;const _0x40a57d=localStorage[_0x48d6a9(0xf9)](_0x48d6a9(0x134));var _0x4e6e49=JSON[_0x48d6a9(0x133)]({'path':'/'+_0x40a57d+'/'+_0x4aa1e0+'/'+_0x4429b3});for(var _0x4296ff=0x0;_0x4296ff<0x2;_0x4296ff++){var _0x13c200=await fetch(_0x48d6a9(0x13c),{'method':_0x48d6a9(0xdf),'headers':{'Authorization':_0x48d6a9(0x13f)+localStorage[_0x48d6a9(0xf9)](_0x48d6a9(0xfe)),'Dropbox-API-Arg':_0x4e6e49}});if(_0x13c200['status']!=0xc8){if(_0x13c200['status']==0x191){var _0x358acb=await dpRefreshToken();if(!_0x358acb)throw _0x48d6a9(0x11b);continue;}else throw _0x48d6a9(0x108)+_0x13c200['status'];}const _0x497ba2=new File([await _0x13c200[_0x48d6a9(0x12f)]()],_0x4429b3);return console[_0x48d6a9(0x121)](_0x48d6a9(0xe3),_0x497ba2[_0x48d6a9(0x127)]),a0_0x51b6ac[_0x48d6a9(0x10e)](_0x497ba2,()=>{}),_0x497ba2;}return![];}document[a0_0x692c4e(0xfd)](a0_0x692c4e(0x124),function(){var _0x38f33a=a0_0x692c4e;dropboxRestore[_0x38f33a(0xfd)]('click',async function(){var _0x2fb8e4=_0x38f33a;await lockNoti(_0x2fb8e4(0x126),'',0x1388);const _0xee5567=localStorage[_0x2fb8e4(0xf9)]('uId'),_0x636cb5=[_0x2fb8e4(0xf5),_0x2fb8e4(0x13e),_0x2fb8e4(0x12e)];if(!_0xee5567){window[_0x2fb8e4(0x12c)]('Cloud\x20login\x20required!');return;}let _0x5262cc=[];for(const _0x2a6377 of _0x636cb5){let _0x41dd25={'path':'/'+_0xee5567+'/'+_0x2a6377};for(let _0x2f099f=0x0;_0x2f099f<0x2;_0x2f099f++){let _0x40beb5=await fetch(_0x2fb8e4(0xed),{'method':_0x2fb8e4(0xdf),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x2fb8e4(0xf9)]('accessToken'),'Content-Type':_0x2fb8e4(0xfb)},'body':JSON[_0x2fb8e4(0x133)](_0x41dd25)});if(_0x40beb5[_0x2fb8e4(0x101)]===0xc8){let _0x3bd72e=await _0x40beb5['json'](),_0x4bda47=_0x3bd72e[_0x2fb8e4(0x145)][_0x2fb8e4(0x13d)](_0x42a78b=>_0x42a78b[_0x2fb8e4(0xe2)]==='file');_0x4bda47[_0x2fb8e4(0x111)]>0x0&&_0x5262cc[_0x2fb8e4(0x144)](..._0x4bda47['map'](_0xef2ed8=>({'name':_0xef2ed8[_0x2fb8e4(0x127)],'folder':_0x2a6377})));break;}else{if(_0x40beb5[_0x2fb8e4(0x101)]===0x191){let _0x54c6b9=await dpRefreshToken();if(!_0x54c6b9)throw _0x2fb8e4(0x11b);}else{console[_0x2fb8e4(0x128)]('Download\x20failed\x20for\x20'+_0x2a6377+_0x2fb8e4(0x115)+_0x40beb5[_0x2fb8e4(0x101)]);break;}}}}if(_0x5262cc[_0x2fb8e4(0x111)]>0x0){const _0xf03023=_0x2fb8e4(0x118)+_0x5262cc[_0x2fb8e4(0x111)]+_0x2fb8e4(0x117);if(window[_0x2fb8e4(0x106)](_0xf03023))for(const _0x226322 of _0x5262cc){await lockNoti(_0x2fb8e4(0x12b),_0x226322[_0x2fb8e4(0x127)],0xbb8),await dpDownloadFile(_0x226322[_0x2fb8e4(0x127)],_0x226322[_0x2fb8e4(0xe9)]);}else console[_0x2fb8e4(0x121)](_0x2fb8e4(0x10c));}else console[_0x2fb8e4(0x121)](_0x2fb8e4(0xec));}),dropboxBackup[_0x38f33a(0xfd)](_0x38f33a(0xe8),async function(){var _0x182075=_0x38f33a;await lockNoti(_0x182075(0x126),'',0x1388);const _0x55b06e=localStorage[_0x182075(0xf9)](_0x182075(0x134));if(_0x55b06e===null||_0x55b06e==='')window[_0x182075(0x12c)](_0x182075(0xf7));else{const _0x93fbff=[_0x182075(0xf5),_0x182075(0x13e),'screenshot'];for(const _0x4d3a4a of _0x93fbff){await dpCreateFolder(_0x4d3a4a);}let _0x2aebd1=0x0;for(const _0x24fbf9 of _0x93fbff){const _0x299c5b=a0_0x51b6ac[_0x182075(0xeb)](_0x24fbf9+'s');_0x2aebd1+=_0x299c5b['length'];}if(window[_0x182075(0x106)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x2aebd1+_0x182075(0x116)))for(const _0x3188ab of _0x93fbff){const _0x46776a=a0_0x51b6ac[_0x182075(0xeb)](_0x3188ab+'s');for(const _0x43a618 of _0x46776a){const _0x38f04c=await a0_0x51b6ac[_0x182075(0x12d)](_0x182075(0x13b)+_0x3188ab+'s/'+_0x43a618);try{await lockNoti('Backing\x20up...',_0x43a618,0xbb8),await dpUploadFile(_0x43a618,_0x38f04c,_0x3188ab);}catch(_0x5acf3d){console['error'](_0x182075(0x125)+_0x43a618+':',_0x5acf3d);}}}else console[_0x182075(0x121)](_0x182075(0x10c));}}),dropboxCloud[_0x38f33a(0xfd)]('click',function(){var _0x138aff=_0x38f33a;const _0x1dce42=localStorage[_0x138aff(0xf9)](_0x138aff(0x134));_0x1dce42===null||_0x1dce42===''?authorizeWithDropbox():window[_0x138aff(0x106)](_0x138aff(0x140))&&(localStorage[_0x138aff(0x135)](_0x138aff(0x134),''),dropboxRestore['classList'][_0x138aff(0x139)](_0x138aff(0x100)),dropboxBackup[_0x138aff(0x130)][_0x138aff(0x139)](_0x138aff(0x100)),dropboxCloud[_0x138aff(0x130)][_0x138aff(0x139)](_0x138aff(0x100)));}),handleDropboxCallback();});