var a0_0x57711b=a0_0x2319;(function(_0x287212,_0x282501){var _0x1c6f34=a0_0x2319,_0x57bb53=_0x287212();while(!![]){try{var _0x484be8=parseInt(_0x1c6f34(0x174))/0x1+-parseInt(_0x1c6f34(0x171))/0x2+parseInt(_0x1c6f34(0x128))/0x3+parseInt(_0x1c6f34(0x177))/0x4*(parseInt(_0x1c6f34(0x15e))/0x5)+parseInt(_0x1c6f34(0x161))/0x6+parseInt(_0x1c6f34(0x126))/0x7*(-parseInt(_0x1c6f34(0x14a))/0x8)+-parseInt(_0x1c6f34(0x16c))/0x9*(-parseInt(_0x1c6f34(0x17e))/0xa);if(_0x484be8===_0x282501)break;else _0x57bb53['push'](_0x57bb53['shift']());}catch(_0x15f310){_0x57bb53['push'](_0x57bb53['shift']());}}}(a0_0x451a,0x21cb2));import*as a0_0x566cd5 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x57711b(0x156),clientSecret=a0_0x57711b(0x17a);function authorizeWithDropbox(){var _0x247295=a0_0x57711b,_0x4fa02e=window[_0x247295(0x169)]['href'][_0x247295(0x145)]('?')[0x0],_0x522974=_0x247295(0x139),_0x16a496=_0x247295(0x17b),_0x21f596=_0x247295(0x11e)+clientId+_0x247295(0x136)+_0x522974+'&token_access_type='+_0x16a496+_0x247295(0x176)+encodeURIComponent(_0x4fa02e);window[_0x247295(0x169)][_0x247295(0x160)]=_0x21f596;}function a0_0x451a(){var _0x109d0b=['onload','downloadFileInCloud','classList','POST','Unable\x20to\x20refresh\x20token','application/octet-stream','replace','Restoring...','exec','&response_type=','listFiles','https://api.dropboxapi.com/oauth2/token','code','name','Authorization\x20Code:','Error\x20while\x20refreshing\x20token:','screenshot','length','uploadFileInCloud','refreshToken','state','application/x-www-form-urlencoded','=([^&#]*)','error_description','split','application/json','Upload\x20failed,\x20unknown\x20http\x20status:\x20','\x20files\x20in\x20Kabu?','Folder\x20created','1562760FBFgbc','Restore\x20canceled\x20by\x20user.','Cloud\x20↦\x20Kabu\x20storage\x20◆','responseText','setItem','remove','Bearer\x20','parse','\x20files\x20from\x20Cloud?','uid','Refreshing\x20token...','Failed\x20to\x20refresh\x20Dropbox\x20token.','knh3uz2mx2hp2eu','json','https://content.dropboxapi.com/2/files/download','filter','addEventListener','https://api.dropbox.com/oauth2/token','DOMContentLoaded','.tag','9355IAVGkz',',\x20status:\x20','href','718410pShrpK','Download\x20failed,\x20unknown\x20http\x20status:','confirm','uId','log','Backing\x20up...','search','Cloud\x20login\x20required!','location','folder','https://api.dropboxapi.com/2/files/list_folder','104886oNlvzi','Kabu\x20storage\x20↦\x20Cloud\x20◆','error','stringify','accessToken','350674wADdyL','code=','getItem','27477PVUlKO','Error\x20creating\x20folder\x20','&redirect_uri=','52jpVfLk','status','save','nwb3dnfh09rhs31','offline','No\x20files\x20found\x20to\x20restore.','&grant_type=','220brgefs','entries','[\x5c?&#]','https://www.dropbox.com/oauth2/authorize?client_id=','access_token','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','alert','click','active','refresh_token=','7ZLYwXe','map','243531skynqF','blob','Do\x20you\x20want\x20to\x20logout?','overwrite','/data/'];a0_0x451a=function(){return _0x109d0b;};return a0_0x451a();}function handleDropboxCallback(){var _0x3385af=a0_0x57711b,_0x46d2ac=getUrlParameter(_0x3385af(0x139));_0x46d2ac?(getAccessToken(_0x46d2ac),console[_0x3385af(0x165)](_0x3385af(0x13b),_0x46d2ac)):console[_0x3385af(0x165)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x31e176){var _0x17cfd0=a0_0x57711b;_0x31e176=_0x31e176[_0x17cfd0(0x133)](/[\[]/,'\x5c[')[_0x17cfd0(0x133)](/[\]]/,'\x5c]');var _0x47d224=new RegExp(_0x17cfd0(0x11d)+_0x31e176+_0x17cfd0(0x143)),_0x1eceba=_0x47d224[_0x17cfd0(0x135)](location[_0x17cfd0(0x167)]);return _0x1eceba===null?'':decodeURIComponent(_0x1eceba[0x1][_0x17cfd0(0x133)](/\+/g,'\x20'));}function getAccessToken(_0x42a1e5){var _0x4a5ac8=a0_0x57711b,_0x3a88ae='authorization_code',_0x640064=window[_0x4a5ac8(0x169)]['href'][_0x4a5ac8(0x145)]('?')[0x0],_0x23ea2b=new XMLHttpRequest();_0x23ea2b['open'](_0x4a5ac8(0x130),_0x4a5ac8(0x15b)),_0x23ea2b['setRequestHeader']('Content-Type',_0x4a5ac8(0x142)),_0x23ea2b[_0x4a5ac8(0x12d)]=function(){var _0x3530ee=_0x4a5ac8;if(_0x23ea2b[_0x3530ee(0x178)]===0xc8){var _0x382231=JSON[_0x3530ee(0x151)](_0x23ea2b[_0x3530ee(0x14d)]),_0x4132fa=_0x382231[_0x3530ee(0x11f)],_0x49482a=_0x382231['refresh_token'],_0x1186dc=_0x382231[_0x3530ee(0x153)];localStorage[_0x3530ee(0x14e)](_0x3530ee(0x170),_0x4132fa),localStorage[_0x3530ee(0x14e)](_0x3530ee(0x140),_0x49482a),localStorage['setItem'](_0x3530ee(0x164),_0x1186dc);}else console[_0x3530ee(0x165)](_0x3530ee(0x120));},_0x23ea2b['send'](_0x4a5ac8(0x172)+_0x42a1e5+_0x4a5ac8(0x17d)+_0x3a88ae+'&client_id='+clientId+'&client_secret='+clientSecret+_0x4a5ac8(0x176)+encodeURIComponent(_0x640064));}export async function dpCreateFolder(_0x5713a9){var _0x5cb9b8=a0_0x57711b;const _0x4e0ef6=localStorage[_0x5cb9b8(0x173)]('uId');let _0x299b66=localStorage[_0x5cb9b8(0x173)](_0x5cb9b8(0x170));const _0x5ba772='/'+_0x4e0ef6+'/'+_0x5713a9,_0x3dd73a=JSON[_0x5cb9b8(0x16f)]({'path':_0x5ba772,'autorename':![]});for(let _0x3a057b=0x0;_0x3a057b<0x2;_0x3a057b++){try{const _0x15e5c9=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x5cb9b8(0x130),'headers':{'Authorization':_0x5cb9b8(0x150)+_0x299b66,'Content-Type':'application/json'},'body':_0x3dd73a});if(_0x15e5c9[_0x5cb9b8(0x178)]===0x191){const _0x48e834=await dpRefreshToken();if(!_0x48e834)throw new Error(_0x5cb9b8(0x131));_0x299b66=localStorage[_0x5cb9b8(0x173)]('accessToken');continue;}if(_0x15e5c9[_0x5cb9b8(0x178)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x5713a9};if(!_0x15e5c9['ok'])throw new Error(_0x5cb9b8(0x175)+_0x5713a9);const _0x428fd1=await _0x15e5c9[_0x5cb9b8(0x157)]();return await lockNoti(_0x5cb9b8(0x149),'',0xbb8),_0x428fd1;}catch(_0x289d85){if(_0x3a057b===0x1)throw _0x289d85;}}return![];}export async function dpRefreshToken(){var _0x1e7795=a0_0x57711b;if(!localStorage['getItem'](_0x1e7795(0x140)))throw'No\x20refresh\x20token';try{const _0x10bb36=await fetch(_0x1e7795(0x138),{'method':_0x1e7795(0x130),'headers':{'Content-Type':_0x1e7795(0x142)},'body':_0x1e7795(0x125)+localStorage[_0x1e7795(0x173)]('refreshToken')+_0x1e7795(0x121)}),_0x25df23=await _0x10bb36[_0x1e7795(0x157)]();if(!_0x25df23['error'])return localStorage[_0x1e7795(0x14e)](_0x1e7795(0x170),_0x25df23['access_token']),await lockNoti(_0x1e7795(0x154),'',0xbb8),await delay(0x3e8),!![];else alert(_0x25df23[_0x1e7795(0x144)]||_0x1e7795(0x155));}catch(_0x260dfa){console[_0x1e7795(0x16e)](_0x1e7795(0x13c),_0x260dfa);}return![];}export async function dpUploadFile(_0x34c9cf,_0x44decc,_0x32858e){var _0x1bd93f=a0_0x57711b;const _0x35147e=localStorage[_0x1bd93f(0x173)](_0x1bd93f(0x164));var _0x58b0d5=JSON[_0x1bd93f(0x16f)]({'autorename':!![],'mode':_0x1bd93f(0x12b),'mute':!![],'strict_conflict':![],'path':'/'+_0x35147e+'/'+_0x32858e+'/'+_0x34c9cf}),_0x93f982=new Blob([_0x44decc],{'type':_0x1bd93f(0x132)});for(var _0x30637c=0x0;_0x30637c<0x2;_0x30637c++){var _0x159bb1=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x1bd93f(0x130),'headers':{'Authorization':_0x1bd93f(0x150)+localStorage['getItem'](_0x1bd93f(0x170)),'Dropbox-API-Arg':_0x58b0d5,'Content-Type':_0x1bd93f(0x132)},'body':_0x93f982});if(_0x159bb1['status']!=0xc8){if(_0x159bb1['status']==0x191){var _0x473390=await dpRefreshToken();if(!_0x473390)throw _0x1bd93f(0x131);continue;}else throw _0x1bd93f(0x147)+_0x159bb1['status'];}else{var _0x360932=await _0x159bb1[_0x1bd93f(0x157)]();return console['log'](_0x1bd93f(0x16d),_0x34c9cf),_0x360932;}}return![];}function a0_0x2319(_0x476511,_0x2a11f){var _0x451ae6=a0_0x451a();return a0_0x2319=function(_0x2319b2,_0x5e4630){_0x2319b2=_0x2319b2-0x11c;var _0x4ae3b6=_0x451ae6[_0x2319b2];return _0x4ae3b6;},a0_0x2319(_0x476511,_0x2a11f);}export async function dpDownloadFile(_0x5e2e40,_0x285146){var _0x2188f7=a0_0x57711b;const _0x2e7809=localStorage[_0x2188f7(0x173)]('uId');var _0x136c9c=JSON[_0x2188f7(0x16f)]({'path':'/'+_0x2e7809+'/'+_0x285146+'/'+_0x5e2e40});for(var _0x553a86=0x0;_0x553a86<0x2;_0x553a86++){var _0x100a59=await fetch(_0x2188f7(0x158),{'method':_0x2188f7(0x130),'headers':{'Authorization':_0x2188f7(0x150)+localStorage['getItem']('accessToken'),'Dropbox-API-Arg':_0x136c9c}});if(_0x100a59[_0x2188f7(0x178)]!=0xc8){if(_0x100a59[_0x2188f7(0x178)]==0x191){var _0x21506c=await dpRefreshToken();if(!_0x21506c)throw _0x2188f7(0x131);continue;}else throw _0x2188f7(0x162)+_0x100a59[_0x2188f7(0x178)];}const _0x5beffd=new File([await _0x100a59[_0x2188f7(0x129)]()],_0x5e2e40);return console[_0x2188f7(0x165)](_0x2188f7(0x14c),_0x5beffd[_0x2188f7(0x13a)]),a0_0x566cd5[_0x2188f7(0x13f)](_0x5beffd,()=>{}),_0x5beffd;}return![];}document['addEventListener'](a0_0x57711b(0x15c),function(){var _0x32006e=a0_0x57711b;dropboxRestore[_0x32006e(0x15a)](_0x32006e(0x123),async function(){var _0x5bae6d=_0x32006e;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x5312f4=localStorage[_0x5bae6d(0x173)]('uId'),_0x1336b6=[_0x5bae6d(0x141),_0x5bae6d(0x179),_0x5bae6d(0x13d)];if(!_0x5312f4){window[_0x5bae6d(0x122)](_0x5bae6d(0x168));return;}let _0x2aa343=[];for(const _0x427e70 of _0x1336b6){let _0x30931a={'path':'/'+_0x5312f4+'/'+_0x427e70};for(let _0x152bed=0x0;_0x152bed<0x2;_0x152bed++){let _0x26451e=await fetch(_0x5bae6d(0x16b),{'method':_0x5bae6d(0x130),'headers':{'Authorization':_0x5bae6d(0x150)+localStorage[_0x5bae6d(0x173)](_0x5bae6d(0x170)),'Content-Type':_0x5bae6d(0x146)},'body':JSON['stringify'](_0x30931a)});if(_0x26451e[_0x5bae6d(0x178)]===0xc8){let _0x587495=await _0x26451e['json'](),_0x4ecb46=_0x587495[_0x5bae6d(0x11c)][_0x5bae6d(0x159)](_0xe2996c=>_0xe2996c[_0x5bae6d(0x15d)]==='file');_0x4ecb46[_0x5bae6d(0x13e)]>0x0&&_0x2aa343['push'](..._0x4ecb46[_0x5bae6d(0x127)](_0x2cfb3f=>({'name':_0x2cfb3f[_0x5bae6d(0x13a)],'folder':_0x427e70})));break;}else{if(_0x26451e[_0x5bae6d(0x178)]===0x191){let _0x1d0695=await dpRefreshToken();if(!_0x1d0695)throw _0x5bae6d(0x131);}else{console[_0x5bae6d(0x16e)]('Download\x20failed\x20for\x20'+_0x427e70+_0x5bae6d(0x15f)+_0x26451e['status']);break;}}}}if(_0x2aa343['length']>0x0){const _0x55a123='Do\x20you\x20want\x20to\x20restore\x20'+_0x2aa343[_0x5bae6d(0x13e)]+_0x5bae6d(0x152);if(window[_0x5bae6d(0x163)](_0x55a123))for(const _0x4d554d of _0x2aa343){await lockNoti(_0x5bae6d(0x134),_0x4d554d[_0x5bae6d(0x13a)],0xbb8),await dpDownloadFile(_0x4d554d['name'],_0x4d554d[_0x5bae6d(0x16a)]);}else console[_0x5bae6d(0x165)]('Restore\x20canceled\x20by\x20user.');}else console['log'](_0x5bae6d(0x17c));}),dropboxBackup[_0x32006e(0x15a)](_0x32006e(0x123),async function(){var _0x4b9a62=_0x32006e;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x26c461=localStorage[_0x4b9a62(0x173)](_0x4b9a62(0x164));if(_0x26c461===null||_0x26c461==='')window[_0x4b9a62(0x122)]('Cloud\x20login\x20required!');else{const _0x8c1cf2=['state','save',_0x4b9a62(0x13d)];for(const _0x2e1c5e of _0x8c1cf2){await dpCreateFolder(_0x2e1c5e);}let _0x37612f=0x0;for(const _0x22b8b7 of _0x8c1cf2){const _0x24f1c7=a0_0x566cd5[_0x4b9a62(0x137)](_0x22b8b7+'s');_0x37612f+=_0x24f1c7[_0x4b9a62(0x13e)];}if(window['confirm']('Do\x20you\x20want\x20to\x20backup\x20'+_0x37612f+_0x4b9a62(0x148)))for(const _0x9f9347 of _0x8c1cf2){const _0x422b7a=a0_0x566cd5[_0x4b9a62(0x137)](_0x9f9347+'s');for(const _0x4a0c77 of _0x422b7a){const _0x1f4238=await a0_0x566cd5[_0x4b9a62(0x12e)](_0x4b9a62(0x12c)+_0x9f9347+'s/'+_0x4a0c77);try{await lockNoti(_0x4b9a62(0x166),_0x4a0c77,0xbb8),await dpUploadFile(_0x4a0c77,_0x1f4238,_0x9f9347);}catch(_0x4bd6ac){console[_0x4b9a62(0x16e)]('Failed\x20to\x20upload\x20file\x20'+_0x4a0c77+':',_0x4bd6ac);}}}else console[_0x4b9a62(0x165)](_0x4b9a62(0x14b));}}),dropboxCloud['addEventListener'](_0x32006e(0x123),function(){var _0x4ce449=_0x32006e;const _0x268fda=localStorage[_0x4ce449(0x173)](_0x4ce449(0x164));_0x268fda===null||_0x268fda===''?authorizeWithDropbox():window['confirm'](_0x4ce449(0x12a))&&(localStorage['setItem'](_0x4ce449(0x164),''),dropboxRestore[_0x4ce449(0x12f)]['remove'](_0x4ce449(0x124)),dropboxBackup[_0x4ce449(0x12f)]['remove'](_0x4ce449(0x124)),dropboxCloud['classList'][_0x4ce449(0x14f)](_0x4ce449(0x124)));}),handleDropboxCallback();});