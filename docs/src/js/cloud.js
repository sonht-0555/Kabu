var a0_0x15fbd4=a0_0x12e7;(function(_0x3927ec,_0x25c31d){var _0x450952=a0_0x12e7,_0x6aa4d=_0x3927ec();while(!![]){try{var _0x1f300a=parseInt(_0x450952(0x1a3))/0x1*(-parseInt(_0x450952(0x15e))/0x2)+-parseInt(_0x450952(0x19e))/0x3+parseInt(_0x450952(0x184))/0x4+parseInt(_0x450952(0x164))/0x5+parseInt(_0x450952(0x155))/0x6*(-parseInt(_0x450952(0x1a6))/0x7)+-parseInt(_0x450952(0x157))/0x8*(parseInt(_0x450952(0x192))/0x9)+parseInt(_0x450952(0x176))/0xa;if(_0x1f300a===_0x25c31d)break;else _0x6aa4d['push'](_0x6aa4d['shift']());}catch(_0x4ca8e7){_0x6aa4d['push'](_0x6aa4d['shift']());}}}(a0_0x52dc,0x619ca));import*as a0_0x39bae9 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x15fbd4(0x165);function authorizeWithDropbox(){var _0x3695d3=a0_0x15fbd4,_0x4127a9=window[_0x3695d3(0x152)][_0x3695d3(0x182)]['split']('?')[0x0],_0x4a9c84=_0x3695d3(0x15b),_0x1005ff=_0x3695d3(0x14c),_0x4fa320=_0x3695d3(0x181)+clientId+_0x3695d3(0x154)+_0x4a9c84+_0x3695d3(0x186)+_0x1005ff+'&redirect_uri='+encodeURIComponent(_0x4127a9);window['location'][_0x3695d3(0x182)]=_0x4fa320;}function handleDropboxCallback(){var _0x3e95e2=a0_0x15fbd4,_0x2201d2=getUrlParameter(_0x3e95e2(0x15b));_0x2201d2?(getAccessToken(_0x2201d2),console[_0x3e95e2(0x198)](_0x3e95e2(0x196),_0x2201d2)):console[_0x3e95e2(0x198)](_0x3e95e2(0x153));}function a0_0x12e7(_0x1711c4,_0x365a44){var _0x52dc7b=a0_0x52dc();return a0_0x12e7=function(_0x12e71b,_0xdf2aa9){_0x12e71b=_0x12e71b-0x147;var _0x15f85b=_0x52dc7b[_0x12e71b];return _0x15f85b;},a0_0x12e7(_0x1711c4,_0x365a44);}function a0_0x52dc(){var _0xf31ec7=['onload','state','push','18847NqMDXy','authorization_code','refresh_token=','280yHXggh','Failed\x20to\x20upload\x20file\x20','remove','application/json','active','&redirect_uri=','Refreshing\x20token...','addEventListener','offline','https://api.dropboxapi.com/2/files/list_folder','blob','&client_secret=','refreshToken','listFiles','location','Do\x20not\x20receive\x20authorization','&response_type=','20016UCFLXC','stringify','8120TPIKSK','Kabu\x20storage\x20↦\x20Cloud\x20◆','Folder\x20already\x20exists','.tag','code','Folder\x20created','alert','66jetgIe','access_token','json','POST','length','screenshot','1007815sduGbB','nwb3dnfh09rhs31','https://api.dropboxapi.com/oauth2/token','Content-Type','overwrite','https://content.dropboxapi.com/2/files/upload','replace','split','application/octet-stream','getItem','Cloud\x20login\x20required!','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','accessToken','error','Backing\x20up...','send','Restoring...','Restore\x20canceled\x20by\x20user.','9123280OzanZU','https://api.dropbox.com/oauth2/token','parse','Failed\x20to\x20refresh\x20Dropbox\x20token.','/data/','status','click','&grant_type=','name','Unable\x20to\x20refresh\x20token','Download\x20failed,\x20unknown\x20http\x20status:','https://www.dropbox.com/oauth2/authorize?client_id=','href','Wait\x20a\x20little\x20bit...','2228296YjhdEm','classList','&token_access_type=','=([^&#]*)','error_description','refresh_token','uploadFileInCloud','folder','setRequestHeader','open','Do\x20you\x20want\x20to\x20restore\x20','responseText','\x20files\x20in\x20Kabu?','setItem','369ZqOBqp','code=','[\x5c?&#]','confirm','Authorization\x20Code:','filter','log','No\x20files\x20found\x20to\x20restore.','uid','Bearer\x20','entries','uId','1422423wWvRlh','save'];a0_0x52dc=function(){return _0xf31ec7;};return a0_0x52dc();}function getUrlParameter(_0x3df965){var _0x14611f=a0_0x15fbd4;_0x3df965=_0x3df965[_0x14611f(0x16a)](/[\[]/,'\x5c[')[_0x14611f(0x16a)](/[\]]/,'\x5c]');var _0x53ba90=new RegExp(_0x14611f(0x194)+_0x3df965+_0x14611f(0x187)),_0x2d2858=_0x53ba90['exec'](location['search']);return _0x2d2858===null?'':decodeURIComponent(_0x2d2858[0x1][_0x14611f(0x16a)](/\+/g,'\x20'));}function getAccessToken(_0x5011a2){var _0x4a58ec=a0_0x15fbd4,_0x4b0128=_0x4a58ec(0x1a4),_0x23e894=window[_0x4a58ec(0x152)]['href'][_0x4a58ec(0x16b)]('?')[0x0],_0x25cefc=new XMLHttpRequest();_0x25cefc[_0x4a58ec(0x18d)](_0x4a58ec(0x161),_0x4a58ec(0x177)),_0x25cefc[_0x4a58ec(0x18c)](_0x4a58ec(0x167),'application/x-www-form-urlencoded'),_0x25cefc[_0x4a58ec(0x1a0)]=function(){var _0x4c0b48=_0x4a58ec;if(_0x25cefc[_0x4c0b48(0x17b)]===0xc8){var _0x3d103c=JSON[_0x4c0b48(0x178)](_0x25cefc[_0x4c0b48(0x18f)]),_0x32cd6c=_0x3d103c['access_token'],_0x13f3f4=_0x3d103c[_0x4c0b48(0x189)],_0x3ed46a=_0x3d103c[_0x4c0b48(0x19a)];localStorage[_0x4c0b48(0x191)](_0x4c0b48(0x170),_0x32cd6c),localStorage[_0x4c0b48(0x191)](_0x4c0b48(0x150),_0x13f3f4),localStorage[_0x4c0b48(0x191)](_0x4c0b48(0x19d),_0x3ed46a);}else console[_0x4c0b48(0x198)](_0x4c0b48(0x16f));},_0x25cefc[_0x4a58ec(0x173)](_0x4a58ec(0x193)+_0x5011a2+_0x4a58ec(0x17d)+_0x4b0128+'&client_id='+clientId+_0x4a58ec(0x14f)+clientSecret+_0x4a58ec(0x149)+encodeURIComponent(_0x23e894));}export async function dpCreateFolder(_0x453c3c){var _0xdf4165=a0_0x15fbd4;const _0x1cc04f=localStorage[_0xdf4165(0x16d)](_0xdf4165(0x19d));let _0x50c863=localStorage['getItem'](_0xdf4165(0x170));const _0x54763a='/'+_0x1cc04f+'/'+_0x453c3c,_0x376b6c=JSON[_0xdf4165(0x156)]({'path':_0x54763a,'autorename':![]});for(let _0x2343ff=0x0;_0x2343ff<0x2;_0x2343ff++){try{const _0x5f28c9=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0xdf4165(0x161),'headers':{'Authorization':'Bearer\x20'+_0x50c863,'Content-Type':'application/json'},'body':_0x376b6c});if(_0x5f28c9['status']===0x191){const _0x5ea019=await dpRefreshToken();if(!_0x5ea019)throw new Error(_0xdf4165(0x17f));_0x50c863=localStorage['getItem'](_0xdf4165(0x170));continue;}if(_0x5f28c9[_0xdf4165(0x17b)]===0x199)return{'message':_0xdf4165(0x159),'path':_0x453c3c};if(!_0x5f28c9['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x453c3c);const _0x6f6567=await _0x5f28c9[_0xdf4165(0x160)]();return await lockNoti(_0xdf4165(0x15c),'',0xbb8),_0x6f6567;}catch(_0x1bb214){if(_0x2343ff===0x1)throw _0x1bb214;}}return![];}export async function dpRefreshToken(){var _0x467460=a0_0x15fbd4;if(!localStorage[_0x467460(0x16d)](_0x467460(0x150)))throw'No\x20refresh\x20token';try{const _0x126e11=await fetch(_0x467460(0x166),{'method':_0x467460(0x161),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x467460(0x1a5)+localStorage[_0x467460(0x16d)](_0x467460(0x150))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x1f2e45=await _0x126e11['json']();if(!_0x1f2e45[_0x467460(0x171)])return localStorage[_0x467460(0x191)](_0x467460(0x170),_0x1f2e45[_0x467460(0x15f)]),await lockNoti(_0x467460(0x14a),'',0xbb8),await delay(0x3e8),!![];else alert(_0x1f2e45[_0x467460(0x188)]||_0x467460(0x179));}catch(_0x1299f8){console[_0x467460(0x171)]('Error\x20while\x20refreshing\x20token:',_0x1299f8);}return![];}export async function dpUploadFile(_0x33e81e,_0xbc4529,_0xea790a){var _0x8f8de3=a0_0x15fbd4;const _0x1e2581=localStorage['getItem'](_0x8f8de3(0x19d));var _0x297a54=JSON[_0x8f8de3(0x156)]({'autorename':!![],'mode':_0x8f8de3(0x168),'mute':!![],'strict_conflict':![],'path':'/'+_0x1e2581+'/'+_0xea790a+'/'+_0x33e81e}),_0x4eda97=new Blob([_0xbc4529],{'type':_0x8f8de3(0x16c)});for(var _0x51699b=0x0;_0x51699b<0x2;_0x51699b++){var _0x199993=await fetch(_0x8f8de3(0x169),{'method':_0x8f8de3(0x161),'headers':{'Authorization':_0x8f8de3(0x19b)+localStorage[_0x8f8de3(0x16d)]('accessToken'),'Dropbox-API-Arg':_0x297a54,'Content-Type':_0x8f8de3(0x16c)},'body':_0x4eda97});if(_0x199993[_0x8f8de3(0x17b)]!=0xc8){if(_0x199993['status']==0x191){var _0x58071c=await dpRefreshToken();if(!_0x58071c)throw _0x8f8de3(0x17f);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x199993[_0x8f8de3(0x17b)];}else{var _0x3b2fcb=await _0x199993[_0x8f8de3(0x160)]();return console[_0x8f8de3(0x198)](_0x8f8de3(0x158),_0x33e81e),_0x3b2fcb;}}return![];}export async function dpDownloadFile(_0x5ee91d,_0x318839){var _0x11f629=a0_0x15fbd4;const _0x22c851=localStorage[_0x11f629(0x16d)]('uId');var _0x37cbb8=JSON['stringify']({'path':'/'+_0x22c851+'/'+_0x318839+'/'+_0x5ee91d});for(var _0x187ee6=0x0;_0x187ee6<0x2;_0x187ee6++){var _0x1664c6=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x11f629(0x161),'headers':{'Authorization':_0x11f629(0x19b)+localStorage[_0x11f629(0x16d)](_0x11f629(0x170)),'Dropbox-API-Arg':_0x37cbb8}});if(_0x1664c6[_0x11f629(0x17b)]!=0xc8){if(_0x1664c6[_0x11f629(0x17b)]==0x191){var _0xc8a388=await dpRefreshToken();if(!_0xc8a388)throw _0x11f629(0x17f);continue;}else throw _0x11f629(0x180)+_0x1664c6[_0x11f629(0x17b)];}const _0x3a7256=new File([await _0x1664c6[_0x11f629(0x14e)]()],_0x5ee91d);return console['log']('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x3a7256[_0x11f629(0x17e)]),a0_0x39bae9[_0x11f629(0x18a)](_0x3a7256,()=>{}),_0x3a7256;}return![];}document[a0_0x15fbd4(0x14b)]('DOMContentLoaded',function(){var _0x1878dc=a0_0x15fbd4;dropboxRestore[_0x1878dc(0x14b)](_0x1878dc(0x17c),async function(){var _0xe1dfd2=_0x1878dc;await lockNoti(_0xe1dfd2(0x183),'',0x1388);const _0x46a152=localStorage['getItem']('uId'),_0xcdac7=[_0xe1dfd2(0x1a1),_0xe1dfd2(0x19f),_0xe1dfd2(0x163)];if(!_0x46a152){window['alert']('Cloud\x20login\x20required!');return;}let _0x213369=[];for(const _0x47a35d of _0xcdac7){let _0xa97fa0={'path':'/'+_0x46a152+'/'+_0x47a35d};for(let _0x5a26a8=0x0;_0x5a26a8<0x2;_0x5a26a8++){let _0x345dbf=await fetch(_0xe1dfd2(0x14d),{'method':'POST','headers':{'Authorization':_0xe1dfd2(0x19b)+localStorage[_0xe1dfd2(0x16d)]('accessToken'),'Content-Type':_0xe1dfd2(0x147)},'body':JSON[_0xe1dfd2(0x156)](_0xa97fa0)});if(_0x345dbf['status']===0xc8){let _0x1985e0=await _0x345dbf[_0xe1dfd2(0x160)](),_0x4b833b=_0x1985e0[_0xe1dfd2(0x19c)][_0xe1dfd2(0x197)](_0x404308=>_0x404308[_0xe1dfd2(0x15a)]==='file');_0x4b833b[_0xe1dfd2(0x162)]>0x0&&_0x213369[_0xe1dfd2(0x1a2)](..._0x4b833b['map'](_0xcdfa04=>({'name':_0xcdfa04['name'],'folder':_0x47a35d})));break;}else{if(_0x345dbf['status']===0x191){let _0x363114=await dpRefreshToken();if(!_0x363114)throw _0xe1dfd2(0x17f);}else{console[_0xe1dfd2(0x171)]('Download\x20failed\x20for\x20'+_0x47a35d+',\x20status:\x20'+_0x345dbf[_0xe1dfd2(0x17b)]);break;}}}}if(_0x213369[_0xe1dfd2(0x162)]>0x0){const _0x493135=_0xe1dfd2(0x18e)+_0x213369[_0xe1dfd2(0x162)]+'\x20files\x20from\x20Cloud?';if(window[_0xe1dfd2(0x195)](_0x493135))for(const _0x5286af of _0x213369){await lockNoti(_0xe1dfd2(0x174),_0x5286af[_0xe1dfd2(0x17e)],0xbb8),await dpDownloadFile(_0x5286af[_0xe1dfd2(0x17e)],_0x5286af[_0xe1dfd2(0x18b)]);}else console[_0xe1dfd2(0x198)](_0xe1dfd2(0x175));}else console[_0xe1dfd2(0x198)](_0xe1dfd2(0x199));}),dropboxBackup[_0x1878dc(0x14b)]('click',async function(){var _0x19c630=_0x1878dc;await lockNoti(_0x19c630(0x183),'',0x1388);const _0x12b1bd=localStorage[_0x19c630(0x16d)](_0x19c630(0x19d));if(_0x12b1bd===null||_0x12b1bd==='')window[_0x19c630(0x15d)](_0x19c630(0x16e));else{const _0x363145=[_0x19c630(0x1a1),_0x19c630(0x19f),_0x19c630(0x163)];for(const _0x580ef5 of _0x363145){await dpCreateFolder(_0x580ef5);}let _0x439adc=0x0;for(const _0x2e7dba of _0x363145){const _0x4a5784=a0_0x39bae9[_0x19c630(0x151)](_0x2e7dba+'s');_0x439adc+=_0x4a5784[_0x19c630(0x162)];}if(window[_0x19c630(0x195)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x439adc+_0x19c630(0x190)))for(const _0x315350 of _0x363145){const _0x38e766=a0_0x39bae9[_0x19c630(0x151)](_0x315350+'s');for(const _0x136ea0 of _0x38e766){const _0x4f962e=await a0_0x39bae9['downloadFileInCloud'](_0x19c630(0x17a)+_0x315350+'s/'+_0x136ea0);try{await lockNoti(_0x19c630(0x172),_0x136ea0,0xbb8),await dpUploadFile(_0x136ea0,_0x4f962e,_0x315350);}catch(_0x48851a){console[_0x19c630(0x171)](_0x19c630(0x1a7)+_0x136ea0+':',_0x48851a);}}}else console[_0x19c630(0x198)](_0x19c630(0x175));}}),dropboxCloud[_0x1878dc(0x14b)](_0x1878dc(0x17c),function(){var _0x31018e=_0x1878dc;const _0x5d5303=localStorage['getItem']('uId');_0x5d5303===null||_0x5d5303===''?authorizeWithDropbox():window[_0x31018e(0x195)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x31018e(0x191)](_0x31018e(0x19d),''),dropboxRestore['classList'][_0x31018e(0x1a8)](_0x31018e(0x148)),dropboxBackup[_0x31018e(0x185)][_0x31018e(0x1a8)](_0x31018e(0x148)),dropboxCloud['classList'][_0x31018e(0x1a8)]('active'));}),handleDropboxCallback();});