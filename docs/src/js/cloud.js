var a0_0x5d627e=a0_0x5173;(function(_0x908f8b,_0x836790){var _0x458359=a0_0x5173,_0x2fa525=_0x908f8b();while(!![]){try{var _0x5c2762=-parseInt(_0x458359(0xa2))/0x1+parseInt(_0x458359(0x8a))/0x2+parseInt(_0x458359(0xaa))/0x3+parseInt(_0x458359(0xcd))/0x4+-parseInt(_0x458359(0xae))/0x5*(-parseInt(_0x458359(0xb3))/0x6)+-parseInt(_0x458359(0xa3))/0x7+-parseInt(_0x458359(0xd4))/0x8*(parseInt(_0x458359(0x99))/0x9);if(_0x5c2762===_0x836790)break;else _0x2fa525['push'](_0x2fa525['shift']());}catch(_0x4984bd){_0x2fa525['push'](_0x2fa525['shift']());}}}(a0_0x407e,0x2e0d7));import*as a0_0x5aac07 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x5d627e(0x91);function authorizeWithDropbox(){var _0x57654b=a0_0x5d627e,_0x48eac5=window['location'][_0x57654b(0x85)][_0x57654b(0x8d)]('?')[0x0],_0x5303a5=_0x57654b(0x9e),_0x52e350=_0x57654b(0x87),_0x1ca337='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x57654b(0x7d)+_0x5303a5+_0x57654b(0xd2)+_0x52e350+_0x57654b(0xd1)+encodeURIComponent(_0x48eac5);window[_0x57654b(0xce)]['href']=_0x1ca337;}function handleDropboxCallback(){var _0x1056d7=a0_0x5d627e,_0x12a2f9=getUrlParameter(_0x1056d7(0x9e));_0x12a2f9?(getAccessToken(_0x12a2f9),console['log']('Authorization\x20Code:',_0x12a2f9)):console['log'](_0x1056d7(0xc4));}function a0_0x407e(){var _0x38a887=['overwrite','stringify','871254RwKimn','setRequestHeader','log','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Do\x20you\x20want\x20to\x20logout?','code','screenshot','Wait\x20a\x20little\x20bit...','refresh_token','210338DvtGdQ','253806sJXRla','https://content.dropboxapi.com/2/files/upload','file','onload','send','Refreshing\x20token...','Bearer\x20','352563QJDLcG',',\x20status:\x20','&grant_type=','Folder\x20already\x20exists','411310USgNGq','[\x5c?&#]','json','.tag','replace','18WdxrTY','addEventListener','\x20files\x20from\x20Cloud?','No\x20files\x20found\x20to\x20restore.','Cloud\x20login\x20required!','Backing\x20up...','Folder\x20created','setItem','Download\x20failed,\x20unknown\x20http\x20status:','blob','Error\x20while\x20refreshing\x20token:','Failed\x20to\x20upload\x20file\x20','\x20files\x20in\x20Kabu?','Do\x20you\x20want\x20to\x20backup\x20','Upload\x20failed,\x20unknown\x20http\x20status:\x20','confirm','state','Do\x20not\x20receive\x20authorization','length','Unable\x20to\x20refresh\x20token','&client_secret=','name','Cloud\x20↦\x20Kabu\x20storage\x20◆','&client_id=','Error\x20creating\x20folder\x20','application/json','865728YHswvx','location','application/octet-stream','authorization_code','&redirect_uri=','&token_access_type=','No\x20refresh\x20token','24Rxkrqw','exec','remove','status','folder','DOMContentLoaded','getItem','=([^&#]*)','Restoring...','parse','uid','map','listFiles','Content-Type','Do\x20you\x20want\x20to\x20restore\x20','application/x-www-form-urlencoded','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','/data/','&response_type=','refreshToken','open','save','Kabu\x20storage\x20↦\x20Cloud\x20◆','Restore\x20canceled\x20by\x20user.','alert','code=','href','access_token','offline','https://api.dropboxapi.com/2/files/create_folder_v2','uId','289812SFHIMP','click','entries','split','accessToken','classList','https://api.dropboxapi.com/oauth2/token','nwb3dnfh09rhs31','error','active','POST','error_description','https://api.dropboxapi.com/2/files/list_folder'];a0_0x407e=function(){return _0x38a887;};return a0_0x407e();}function getUrlParameter(_0x19cfc2){var _0x5286d9=a0_0x5d627e;_0x19cfc2=_0x19cfc2[_0x5286d9(0xb2)](/[\[]/,'\x5c[')[_0x5286d9(0xb2)](/[\]]/,'\x5c]');var _0x4abaf5=new RegExp(_0x5286d9(0xaf)+_0x19cfc2+_0x5286d9(0x72)),_0x2e4e2b=_0x4abaf5[_0x5286d9(0xd5)](location['search']);return _0x2e4e2b===null?'':decodeURIComponent(_0x2e4e2b[0x1][_0x5286d9(0xb2)](/\+/g,'\x20'));}function getAccessToken(_0x49d817){var _0x97863e=a0_0x5d627e,_0x3eafeb=_0x97863e(0xd0),_0x3e3ff9=window[_0x97863e(0xce)][_0x97863e(0x85)][_0x97863e(0x8d)]('?')[0x0],_0x4d8c7b=new XMLHttpRequest();_0x4d8c7b[_0x97863e(0x7f)]('POST','https://api.dropbox.com/oauth2/token'),_0x4d8c7b[_0x97863e(0x9a)](_0x97863e(0x78),'application/x-www-form-urlencoded'),_0x4d8c7b[_0x97863e(0xa6)]=function(){var _0x5ee46c=_0x97863e;if(_0x4d8c7b[_0x5ee46c(0x6e)]===0xc8){var _0x8f17ef=JSON[_0x5ee46c(0x74)](_0x4d8c7b['responseText']),_0x7dd3ef=_0x8f17ef[_0x5ee46c(0x86)],_0xc71508=_0x8f17ef[_0x5ee46c(0xa1)],_0x159197=_0x8f17ef[_0x5ee46c(0x75)];localStorage['setItem']('accessToken',_0x7dd3ef),localStorage['setItem'](_0x5ee46c(0x7e),_0xc71508),localStorage[_0x5ee46c(0xba)](_0x5ee46c(0x89),_0x159197);}else console[_0x5ee46c(0x9b)](_0x5ee46c(0x9c));},_0x4d8c7b[_0x97863e(0xa7)](_0x97863e(0x84)+_0x49d817+_0x97863e(0xac)+_0x3eafeb+_0x97863e(0xca)+clientId+_0x97863e(0xc7)+clientSecret+_0x97863e(0xd1)+encodeURIComponent(_0x3e3ff9));}export async function dpCreateFolder(_0x1173bc){var _0x373510=a0_0x5d627e;const _0x1ed3dc=localStorage['getItem'](_0x373510(0x89));let _0x24bd95=localStorage[_0x373510(0x71)]('accessToken');const _0x253fa1='/'+_0x1ed3dc+'/'+_0x1173bc,_0x3460bc=JSON[_0x373510(0x98)]({'path':_0x253fa1,'autorename':![]});for(let _0xe2ed60=0x0;_0xe2ed60<0x2;_0xe2ed60++){try{const _0x257423=await fetch(_0x373510(0x88),{'method':_0x373510(0x94),'headers':{'Authorization':'Bearer\x20'+_0x24bd95,'Content-Type':_0x373510(0xcc)},'body':_0x3460bc});if(_0x257423[_0x373510(0x6e)]===0x191){const _0x5d3e70=await dpRefreshToken();if(!_0x5d3e70)throw new Error(_0x373510(0xc6));_0x24bd95=localStorage['getItem'](_0x373510(0x8e));continue;}if(_0x257423['status']===0x199)return{'message':_0x373510(0xad),'path':_0x1173bc};if(!_0x257423['ok'])throw new Error(_0x373510(0xcb)+_0x1173bc);const _0x438ecb=await _0x257423[_0x373510(0xb0)]();return await lockNoti(_0x373510(0xb9),'',0xbb8),_0x438ecb;}catch(_0x11a169){if(_0xe2ed60===0x1)throw _0x11a169;}}return![];}export async function dpRefreshToken(){var _0x585339=a0_0x5d627e;if(!localStorage['getItem'](_0x585339(0x7e)))throw _0x585339(0xd3);try{const _0x124d5b=await fetch(_0x585339(0x90),{'method':_0x585339(0x94),'headers':{'Content-Type':_0x585339(0x7a)},'body':'refresh_token='+localStorage[_0x585339(0x71)](_0x585339(0x7e))+_0x585339(0x7b)}),_0x20d8d2=await _0x124d5b[_0x585339(0xb0)]();if(!_0x20d8d2[_0x585339(0x92)])return localStorage[_0x585339(0xba)](_0x585339(0x8e),_0x20d8d2['access_token']),await lockNoti(_0x585339(0xa8),'',0xbb8),await delay(0x3e8),!![];else alert(_0x20d8d2[_0x585339(0x95)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x5c18e3){console['error'](_0x585339(0xbd),_0x5c18e3);}return![];}export async function dpUploadFile(_0x32d35e,_0x4c4d52,_0x582973){var _0x1756d2=a0_0x5d627e;const _0x449912=localStorage[_0x1756d2(0x71)](_0x1756d2(0x89));var _0xd43ea2=JSON[_0x1756d2(0x98)]({'autorename':!![],'mode':_0x1756d2(0x97),'mute':!![],'strict_conflict':![],'path':'/'+_0x449912+'/'+_0x582973+'/'+_0x32d35e}),_0x171524=new Blob([_0x4c4d52],{'type':_0x1756d2(0xcf)});for(var _0xe53c02=0x0;_0xe53c02<0x2;_0xe53c02++){var _0x582435=await fetch(_0x1756d2(0xa4),{'method':'POST','headers':{'Authorization':_0x1756d2(0xa9)+localStorage['getItem'](_0x1756d2(0x8e)),'Dropbox-API-Arg':_0xd43ea2,'Content-Type':_0x1756d2(0xcf)},'body':_0x171524});if(_0x582435[_0x1756d2(0x6e)]!=0xc8){if(_0x582435[_0x1756d2(0x6e)]==0x191){var _0x1d8a7e=await dpRefreshToken();if(!_0x1d8a7e)throw _0x1756d2(0xc6);continue;}else throw _0x1756d2(0xc1)+_0x582435[_0x1756d2(0x6e)];}else{var _0x1b04a8=await _0x582435[_0x1756d2(0xb0)]();return console[_0x1756d2(0x9b)](_0x1756d2(0x81),_0x32d35e),_0x1b04a8;}}return![];}function a0_0x5173(_0x12c9df,_0x5f329d){var _0x407eed=a0_0x407e();return a0_0x5173=function(_0x51730f,_0x8b70aa){_0x51730f=_0x51730f-0x6d;var _0x2e1ed2=_0x407eed[_0x51730f];return _0x2e1ed2;},a0_0x5173(_0x12c9df,_0x5f329d);}export async function dpDownloadFile(_0xd4c3d4,_0x1c84e6){var _0x136e7c=a0_0x5d627e;const _0x17c76f=localStorage[_0x136e7c(0x71)](_0x136e7c(0x89));var _0xcb8252=JSON[_0x136e7c(0x98)]({'path':'/'+_0x17c76f+'/'+_0x1c84e6+'/'+_0xd4c3d4});for(var _0x10acff=0x0;_0x10acff<0x2;_0x10acff++){var _0x1fc67c=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x136e7c(0x94),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x136e7c(0x71)](_0x136e7c(0x8e)),'Dropbox-API-Arg':_0xcb8252}});if(_0x1fc67c['status']!=0xc8){if(_0x1fc67c['status']==0x191){var _0x254391=await dpRefreshToken();if(!_0x254391)throw _0x136e7c(0xc6);continue;}else throw _0x136e7c(0xbb)+_0x1fc67c['status'];}const _0x2366f4=new File([await _0x1fc67c[_0x136e7c(0xbc)]()],_0xd4c3d4);return console[_0x136e7c(0x9b)](_0x136e7c(0xc9),_0x2366f4['name']),a0_0x5aac07['uploadFileInCloud'](_0x2366f4,()=>{}),_0x2366f4;}return![];}document['addEventListener'](a0_0x5d627e(0x70),function(){var _0x2d6af6=a0_0x5d627e;dropboxRestore[_0x2d6af6(0xb4)](_0x2d6af6(0x8b),async function(){var _0x32f914=_0x2d6af6;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x4ed537=localStorage['getItem'](_0x32f914(0x89)),_0x10c708=[_0x32f914(0xc3),_0x32f914(0x80),_0x32f914(0x9f)];if(!_0x4ed537){window['alert'](_0x32f914(0xb7));return;}let _0x506e72=[];for(const _0x238c69 of _0x10c708){let _0x42ed6e={'path':'/'+_0x4ed537+'/'+_0x238c69};for(let _0x1af2b4=0x0;_0x1af2b4<0x2;_0x1af2b4++){let _0x53ebbc=await fetch(_0x32f914(0x96),{'method':'POST','headers':{'Authorization':_0x32f914(0xa9)+localStorage[_0x32f914(0x71)](_0x32f914(0x8e)),'Content-Type':'application/json'},'body':JSON[_0x32f914(0x98)](_0x42ed6e)});if(_0x53ebbc[_0x32f914(0x6e)]===0xc8){let _0x9a0c8f=await _0x53ebbc[_0x32f914(0xb0)](),_0x1471a0=_0x9a0c8f[_0x32f914(0x8c)]['filter'](_0x31afb5=>_0x31afb5[_0x32f914(0xb1)]===_0x32f914(0xa5));_0x1471a0[_0x32f914(0xc5)]>0x0&&_0x506e72['push'](..._0x1471a0[_0x32f914(0x76)](_0x30dc8e=>({'name':_0x30dc8e[_0x32f914(0xc8)],'folder':_0x238c69})));break;}else{if(_0x53ebbc[_0x32f914(0x6e)]===0x191){let _0x3c7416=await dpRefreshToken();if(!_0x3c7416)throw _0x32f914(0xc6);}else{console['error']('Download\x20failed\x20for\x20'+_0x238c69+_0x32f914(0xab)+_0x53ebbc[_0x32f914(0x6e)]);break;}}}}if(_0x506e72[_0x32f914(0xc5)]>0x0){const _0x3374a2=_0x32f914(0x79)+_0x506e72[_0x32f914(0xc5)]+_0x32f914(0xb5);if(window[_0x32f914(0xc2)](_0x3374a2))for(const _0x518119 of _0x506e72){await lockNoti(_0x32f914(0x73),_0x518119[_0x32f914(0xc8)],0xbb8),await dpDownloadFile(_0x518119[_0x32f914(0xc8)],_0x518119[_0x32f914(0x6f)]);}else console[_0x32f914(0x9b)]('Restore\x20canceled\x20by\x20user.');}else console[_0x32f914(0x9b)](_0x32f914(0xb6));}),dropboxBackup[_0x2d6af6(0xb4)](_0x2d6af6(0x8b),async function(){var _0x30c006=_0x2d6af6;await lockNoti(_0x30c006(0xa0),'',0x1388);const _0x2ece8e=localStorage[_0x30c006(0x71)](_0x30c006(0x89));if(_0x2ece8e===null||_0x2ece8e==='')window[_0x30c006(0x83)]('Cloud\x20login\x20required!');else{const _0x2ef4a2=[_0x30c006(0xc3),'save',_0x30c006(0x9f)];for(const _0x4bc65c of _0x2ef4a2){await dpCreateFolder(_0x4bc65c);}let _0x2d7ab7=0x0;for(const _0x12a08b of _0x2ef4a2){const _0x53f631=a0_0x5aac07['listFiles'](_0x12a08b+'s');_0x2d7ab7+=_0x53f631[_0x30c006(0xc5)];}if(window[_0x30c006(0xc2)](_0x30c006(0xc0)+_0x2d7ab7+_0x30c006(0xbf)))for(const _0x9a0ea1 of _0x2ef4a2){const _0x43a847=a0_0x5aac07[_0x30c006(0x77)](_0x9a0ea1+'s');for(const _0x142313 of _0x43a847){const _0x1939d4=await a0_0x5aac07['downloadFileInCloud'](_0x30c006(0x7c)+_0x9a0ea1+'s/'+_0x142313);try{await lockNoti(_0x30c006(0xb8),_0x142313,0xbb8),await dpUploadFile(_0x142313,_0x1939d4,_0x9a0ea1);}catch(_0x1a6827){console[_0x30c006(0x92)](_0x30c006(0xbe)+_0x142313+':',_0x1a6827);}}}else console['log'](_0x30c006(0x82));}}),dropboxCloud[_0x2d6af6(0xb4)](_0x2d6af6(0x8b),function(){var _0x5bb483=_0x2d6af6;const _0x4cab26=localStorage[_0x5bb483(0x71)]('uId');_0x4cab26===null||_0x4cab26===''?authorizeWithDropbox():window[_0x5bb483(0xc2)](_0x5bb483(0x9d))&&(localStorage[_0x5bb483(0xba)](_0x5bb483(0x89),''),dropboxRestore[_0x5bb483(0x8f)][_0x5bb483(0x6d)](_0x5bb483(0x93)),dropboxBackup[_0x5bb483(0x8f)]['remove']('active'),dropboxCloud[_0x5bb483(0x8f)]['remove']('active'));}),handleDropboxCallback();});