var a0_0x20ade9=a0_0x4789;(function(_0x43779a,_0x23b7b4){var _0x2d887b=a0_0x4789,_0x586257=_0x43779a();while(!![]){try{var _0x200f32=parseInt(_0x2d887b(0x1e1))/0x1+parseInt(_0x2d887b(0x1c5))/0x2*(parseInt(_0x2d887b(0x1fc))/0x3)+parseInt(_0x2d887b(0x1b6))/0x4*(parseInt(_0x2d887b(0x1d5))/0x5)+parseInt(_0x2d887b(0x1f9))/0x6+-parseInt(_0x2d887b(0x1e5))/0x7+parseInt(_0x2d887b(0x1d6))/0x8+parseInt(_0x2d887b(0x1c3))/0x9*(-parseInt(_0x2d887b(0x1c4))/0xa);if(_0x200f32===_0x23b7b4)break;else _0x586257['push'](_0x586257['shift']());}catch(_0xcd4ed3){_0x586257['push'](_0x586257['shift']());}}}(a0_0x3cb8,0x3fb30));import*as a0_0x50b89b from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x20ade9(0x1e2);function authorizeWithDropbox(){var _0x4336fa=a0_0x20ade9,_0x274a4b=window['location'][_0x4336fa(0x200)]['split']('?')[0x0],_0x5eddb0='code',_0xf91b2c=_0x4336fa(0x201),_0xb6d4d5=_0x4336fa(0x1cc)+clientId+_0x4336fa(0x1ee)+_0x5eddb0+_0x4336fa(0x1a5)+_0xf91b2c+_0x4336fa(0x1f2)+encodeURIComponent(_0x274a4b);window[_0x4336fa(0x1e4)][_0x4336fa(0x200)]=_0xb6d4d5;}function handleDropboxCallback(){var _0xec2236=a0_0x20ade9,_0x37e06a=getUrlParameter('code');_0x37e06a?(getAccessToken(_0x37e06a),console[_0xec2236(0x1d4)](_0xec2236(0x1bc),_0x37e06a)):console['log'](_0xec2236(0x203));}function getUrlParameter(_0x37e099){var _0xd51ce0=a0_0x20ade9;_0x37e099=_0x37e099[_0xd51ce0(0x1dc)](/[\[]/,'\x5c[')[_0xd51ce0(0x1dc)](/[\]]/,'\x5c]');var _0x567a07=new RegExp(_0xd51ce0(0x206)+_0x37e099+'=([^&#]*)'),_0x44285e=_0x567a07[_0xd51ce0(0x1db)](location[_0xd51ce0(0x1ea)]);return _0x44285e===null?'':decodeURIComponent(_0x44285e[0x1][_0xd51ce0(0x1dc)](/\+/g,'\x20'));}function getAccessToken(_0x1bab10){var _0x6bb179=a0_0x20ade9,_0x328c0e=_0x6bb179(0x1ae),_0x563a61=window[_0x6bb179(0x1e4)][_0x6bb179(0x200)]['split']('?')[0x0],_0x396f5b=new XMLHttpRequest();_0x396f5b[_0x6bb179(0x1a4)]('POST',_0x6bb179(0x1ca)),_0x396f5b[_0x6bb179(0x1ad)](_0x6bb179(0x1f4),_0x6bb179(0x1b3)),_0x396f5b[_0x6bb179(0x1c6)]=function(){var _0x534e6b=_0x6bb179;if(_0x396f5b[_0x534e6b(0x1c2)]===0xc8){var _0x3d2595=JSON[_0x534e6b(0x1ec)](_0x396f5b[_0x534e6b(0x1c0)]),_0x155ffb=_0x3d2595[_0x534e6b(0x1c1)],_0x5bde39=_0x3d2595['refresh_token'],_0x1e1199=_0x3d2595[_0x534e6b(0x1bb)];localStorage[_0x534e6b(0x1d2)](_0x534e6b(0x1da),_0x155ffb),localStorage[_0x534e6b(0x1d2)](_0x534e6b(0x1e6),_0x5bde39),localStorage[_0x534e6b(0x1d2)](_0x534e6b(0x209),_0x1e1199);}else console[_0x534e6b(0x1d4)](_0x534e6b(0x207));},_0x396f5b[_0x6bb179(0x1cb)]('code='+_0x1bab10+_0x6bb179(0x1f5)+_0x328c0e+_0x6bb179(0x1ff)+clientId+'&client_secret='+clientSecret+_0x6bb179(0x1f2)+encodeURIComponent(_0x563a61));}function a0_0x4789(_0x25556d,_0x7b475){var _0x3cb8d3=a0_0x3cb8();return a0_0x4789=function(_0x478925,_0x230cee){_0x478925=_0x478925-0x1a4;var _0x5da9f6=_0x3cb8d3[_0x478925];return _0x5da9f6;},a0_0x4789(_0x25556d,_0x7b475);}export async function dpCreateFolder(_0x5a9baa){var _0x82e088=a0_0x20ade9;const _0x127b54=localStorage['getItem'](_0x82e088(0x209));let _0x448ee2=localStorage[_0x82e088(0x1e0)](_0x82e088(0x1da));const _0x3b635c='/'+_0x127b54+'/'+_0x5a9baa,_0x291d46=JSON[_0x82e088(0x1b8)]({'path':_0x3b635c,'autorename':![]});for(let _0x219359=0x0;_0x219359<0x2;_0x219359++){try{const _0x1a2abd=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':_0x82e088(0x1fb),'headers':{'Authorization':'Bearer\x20'+_0x448ee2,'Content-Type':_0x82e088(0x1b7)},'body':_0x291d46});if(_0x1a2abd[_0x82e088(0x1c2)]===0x191){const _0x26a77e=await dpRefreshToken();if(!_0x26a77e)throw new Error(_0x82e088(0x1f3));_0x448ee2=localStorage[_0x82e088(0x1e0)](_0x82e088(0x1da));continue;}if(_0x1a2abd[_0x82e088(0x1c2)]===0x199)return{'message':_0x82e088(0x1f1),'path':_0x5a9baa};if(!_0x1a2abd['ok'])throw new Error(_0x82e088(0x1ab)+_0x5a9baa);const _0x692a7c=await _0x1a2abd[_0x82e088(0x1d8)]();return await lockNoti(_0x82e088(0x1ef),'',0xbb8),_0x692a7c;}catch(_0x5158b3){if(_0x219359===0x1)throw _0x5158b3;}}return![];}export async function dpRefreshToken(){var _0x2bb241=a0_0x20ade9;if(!localStorage[_0x2bb241(0x1e0)](_0x2bb241(0x1e6)))throw _0x2bb241(0x1d0);try{const _0xd623d3=await fetch(_0x2bb241(0x1de),{'method':_0x2bb241(0x1fb),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x2bb241(0x1be)+localStorage['getItem'](_0x2bb241(0x1e6))+_0x2bb241(0x1c8)}),_0x23d2d8=await _0xd623d3['json']();if(!_0x23d2d8['error'])return localStorage[_0x2bb241(0x1d2)](_0x2bb241(0x1da),_0x23d2d8['access_token']),await lockNoti(_0x2bb241(0x1fd),'',0xbb8),await delay(0x3e8),!![];else alert(_0x23d2d8[_0x2bb241(0x1a7)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x194ff5){console[_0x2bb241(0x1b5)](_0x2bb241(0x1bd),_0x194ff5);}return![];}function a0_0x3cb8(){var _0x5d43f7=['https://api.dropboxapi.com/2/files/list_folder','uId','open','&token_access_type=','downloadFileInCloud','error_description','application/octet-stream','Download\x20failed\x20for\x20','Restore\x20canceled\x20by\x20user.','Error\x20creating\x20folder\x20','alert','setRequestHeader','authorization_code','Bearer\x20','overwrite','remove','DOMContentLoaded','application/x-www-form-urlencoded','Do\x20you\x20want\x20to\x20logout?','error','16kdwHlL','application/json','stringify','listFiles','addEventListener','uid','Authorization\x20Code:','Error\x20while\x20refreshing\x20token:','refresh_token=','/data/','responseText','access_token','status','208746wOPOMR','380YEpLPq','55222FexXdU','onload','Do\x20you\x20want\x20to\x20restore\x20','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Failed\x20to\x20upload\x20file\x20','https://api.dropbox.com/oauth2/token','send','https://www.dropbox.com/oauth2/authorize?client_id=','save','Cloud\x20↦\x20Kabu\x20storage\x20◆','uploadFileInCloud','No\x20refresh\x20token','active','setItem','name','log','630845gzMWIs','1888664DAZVjp','screenshot','json','filter','accessToken','exec','replace',',\x20status:\x20','https://api.dropboxapi.com/oauth2/token','Do\x20you\x20want\x20to\x20backup\x20','getItem','419773XZsVXp','nwb3dnfh09rhs31','https://content.dropboxapi.com/2/files/download','location','3439058BERzzv','refreshToken','confirm','Wait\x20a\x20little\x20bit...','Restoring...','search','Backing\x20up...','parse','\x20files\x20from\x20Cloud?','&response_type=','Folder\x20created','Download\x20failed,\x20unknown\x20http\x20status:','Folder\x20already\x20exists','&redirect_uri=','Unable\x20to\x20refresh\x20token','Content-Type','&grant_type=','classList','length','push','21954SSTBLe','state','POST','51jZHNGZ','Refreshing\x20token...','Cloud\x20login\x20required!','&client_id=','href','offline','No\x20files\x20found\x20to\x20restore.','Do\x20not\x20receive\x20authorization','map','click','[\x5c?&#]','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token'];a0_0x3cb8=function(){return _0x5d43f7;};return a0_0x3cb8();}export async function dpUploadFile(_0x473a0c,_0x1e63e1,_0x398338){var _0x2cad4a=a0_0x20ade9;const _0x309674=localStorage[_0x2cad4a(0x1e0)]('uId');var _0x1bf905=JSON[_0x2cad4a(0x1b8)]({'autorename':!![],'mode':_0x2cad4a(0x1b0),'mute':!![],'strict_conflict':![],'path':'/'+_0x309674+'/'+_0x398338+'/'+_0x473a0c}),_0x26e25d=new Blob([_0x1e63e1],{'type':_0x2cad4a(0x1a8)});for(var _0x4bcab3=0x0;_0x4bcab3<0x2;_0x4bcab3++){var _0x5b89a0=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':'POST','headers':{'Authorization':_0x2cad4a(0x1af)+localStorage[_0x2cad4a(0x1e0)](_0x2cad4a(0x1da)),'Dropbox-API-Arg':_0x1bf905,'Content-Type':_0x2cad4a(0x1a8)},'body':_0x26e25d});if(_0x5b89a0[_0x2cad4a(0x1c2)]!=0xc8){if(_0x5b89a0[_0x2cad4a(0x1c2)]==0x191){var _0xce4df=await dpRefreshToken();if(!_0xce4df)throw _0x2cad4a(0x1f3);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x5b89a0[_0x2cad4a(0x1c2)];}else{var _0x21f5d7=await _0x5b89a0['json']();return console['log']('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x473a0c),_0x21f5d7;}}return![];}export async function dpDownloadFile(_0x57ac4d,_0x2afb96){var _0x118916=a0_0x20ade9;const _0x115cdd=localStorage[_0x118916(0x1e0)](_0x118916(0x209));var _0x55e3ca=JSON[_0x118916(0x1b8)]({'path':'/'+_0x115cdd+'/'+_0x2afb96+'/'+_0x57ac4d});for(var _0x4f77f2=0x0;_0x4f77f2<0x2;_0x4f77f2++){var _0x5d1ff2=await fetch(_0x118916(0x1e3),{'method':_0x118916(0x1fb),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x118916(0x1da)),'Dropbox-API-Arg':_0x55e3ca}});if(_0x5d1ff2['status']!=0xc8){if(_0x5d1ff2[_0x118916(0x1c2)]==0x191){var _0x29eacd=await dpRefreshToken();if(!_0x29eacd)throw _0x118916(0x1f3);continue;}else throw _0x118916(0x1f0)+_0x5d1ff2['status'];}const _0x56b64b=new File([await _0x5d1ff2['blob']()],_0x57ac4d);return console[_0x118916(0x1d4)](_0x118916(0x1ce),_0x56b64b[_0x118916(0x1d3)]),a0_0x50b89b[_0x118916(0x1cf)](_0x56b64b,()=>{}),_0x56b64b;}return![];}document[a0_0x20ade9(0x1ba)](a0_0x20ade9(0x1b2),function(){var _0x3eade4=a0_0x20ade9;dropboxRestore[_0x3eade4(0x1ba)](_0x3eade4(0x205),async function(){var _0x2edd6c=_0x3eade4;await lockNoti(_0x2edd6c(0x1e8),'',0x1388);const _0x2dcad6=localStorage[_0x2edd6c(0x1e0)]('uId'),_0x410c32=[_0x2edd6c(0x1fa),_0x2edd6c(0x1cd),_0x2edd6c(0x1d7)];if(!_0x2dcad6){window['alert'](_0x2edd6c(0x1fe));return;}let _0x2a67c0=[];for(const _0x39768b of _0x410c32){let _0x4eeb65={'path':'/'+_0x2dcad6+'/'+_0x39768b};for(let _0x397864=0x0;_0x397864<0x2;_0x397864++){let _0xc4d274=await fetch(_0x2edd6c(0x208),{'method':_0x2edd6c(0x1fb),'headers':{'Authorization':_0x2edd6c(0x1af)+localStorage[_0x2edd6c(0x1e0)](_0x2edd6c(0x1da)),'Content-Type':'application/json'},'body':JSON['stringify'](_0x4eeb65)});if(_0xc4d274[_0x2edd6c(0x1c2)]===0xc8){let _0x3821ba=await _0xc4d274[_0x2edd6c(0x1d8)](),_0x16d67a=_0x3821ba['entries'][_0x2edd6c(0x1d9)](_0x56be18=>_0x56be18['.tag']==='file');_0x16d67a['length']>0x0&&_0x2a67c0[_0x2edd6c(0x1f8)](..._0x16d67a[_0x2edd6c(0x204)](_0x4e402a=>({'name':_0x4e402a[_0x2edd6c(0x1d3)],'folder':_0x39768b})));break;}else{if(_0xc4d274['status']===0x191){let _0x1629a8=await dpRefreshToken();if(!_0x1629a8)throw'Unable\x20to\x20refresh\x20token';}else{console['error'](_0x2edd6c(0x1a9)+_0x39768b+_0x2edd6c(0x1dd)+_0xc4d274['status']);break;}}}}if(_0x2a67c0[_0x2edd6c(0x1f7)]>0x0){const _0x468277=_0x2edd6c(0x1c7)+_0x2a67c0[_0x2edd6c(0x1f7)]+_0x2edd6c(0x1ed);if(window[_0x2edd6c(0x1e7)](_0x468277))for(const _0x1f8847 of _0x2a67c0){await lockNoti(_0x2edd6c(0x1e9),_0x1f8847[_0x2edd6c(0x1d3)],0xbb8),await dpDownloadFile(_0x1f8847[_0x2edd6c(0x1d3)],_0x1f8847['folder']);}else console[_0x2edd6c(0x1d4)](_0x2edd6c(0x1aa));}else console[_0x2edd6c(0x1d4)](_0x2edd6c(0x202));}),dropboxBackup[_0x3eade4(0x1ba)](_0x3eade4(0x205),async function(){var _0x201dfd=_0x3eade4;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x27d3e8=localStorage[_0x201dfd(0x1e0)](_0x201dfd(0x209));if(_0x27d3e8===null||_0x27d3e8==='')window[_0x201dfd(0x1ac)](_0x201dfd(0x1fe));else{const _0x14912f=[_0x201dfd(0x1fa),_0x201dfd(0x1cd),_0x201dfd(0x1d7)];for(const _0x1f3743 of _0x14912f){await dpCreateFolder(_0x1f3743);}let _0x20eee2=0x0;for(const _0x1e06f7 of _0x14912f){const _0x22b32f=a0_0x50b89b[_0x201dfd(0x1b9)](_0x1e06f7+'s');_0x20eee2+=_0x22b32f[_0x201dfd(0x1f7)];}if(window['confirm'](_0x201dfd(0x1df)+_0x20eee2+'\x20files\x20in\x20Kabu?'))for(const _0x598b52 of _0x14912f){const _0x2b0e61=a0_0x50b89b[_0x201dfd(0x1b9)](_0x598b52+'s');for(const _0x17ef89 of _0x2b0e61){const _0x470eef=await a0_0x50b89b[_0x201dfd(0x1a6)](_0x201dfd(0x1bf)+_0x598b52+'s/'+_0x17ef89);try{await lockNoti(_0x201dfd(0x1eb),_0x17ef89,0xbb8),await dpUploadFile(_0x17ef89,_0x470eef,_0x598b52);}catch(_0x47c11a){console['error'](_0x201dfd(0x1c9)+_0x17ef89+':',_0x47c11a);}}}else console[_0x201dfd(0x1d4)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x3eade4(0x1ba)](_0x3eade4(0x205),function(){var _0x8f3353=_0x3eade4;const _0x30d5f9=localStorage[_0x8f3353(0x1e0)](_0x8f3353(0x209));_0x30d5f9===null||_0x30d5f9===''?authorizeWithDropbox():window['confirm'](_0x8f3353(0x1b4))&&(localStorage[_0x8f3353(0x1d2)](_0x8f3353(0x209),''),dropboxRestore[_0x8f3353(0x1f6)][_0x8f3353(0x1b1)](_0x8f3353(0x1d1)),dropboxBackup[_0x8f3353(0x1f6)][_0x8f3353(0x1b1)](_0x8f3353(0x1d1)),dropboxCloud[_0x8f3353(0x1f6)]['remove']('active'));}),handleDropboxCallback();});