function a0_0x2bc9(_0x595430,_0x380c36){var _0x3cad04=a0_0x3cad();return a0_0x2bc9=function(_0x2bc9c3,_0x76a43){_0x2bc9c3=_0x2bc9c3-0x19c;var _0x109f13=_0x3cad04[_0x2bc9c3];return _0x109f13;},a0_0x2bc9(_0x595430,_0x380c36);}var a0_0x4c4f7a=a0_0x2bc9;(function(_0x292ec7,_0x4f9b68){var _0x447177=a0_0x2bc9,_0x598586=_0x292ec7();while(!![]){try{var _0x2f8ac5=parseInt(_0x447177(0x1d4))/0x1+-parseInt(_0x447177(0x1b7))/0x2+parseInt(_0x447177(0x1c5))/0x3+parseInt(_0x447177(0x1f4))/0x4+-parseInt(_0x447177(0x1a2))/0x5+-parseInt(_0x447177(0x19f))/0x6*(parseInt(_0x447177(0x1e1))/0x7)+parseInt(_0x447177(0x1bb))/0x8;if(_0x2f8ac5===_0x4f9b68)break;else _0x598586['push'](_0x598586['shift']());}catch(_0x59d884){_0x598586['push'](_0x598586['shift']());}}}(a0_0x3cad,0xe8b71));import*as a0_0x32f9c2 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x4c4f7a(0x1aa);function authorizeWithDropbox(){var _0x19078=a0_0x4c4f7a,_0x5b7128=window[_0x19078(0x1f7)]['href']['split']('?')[0x0],_0x2cfba7=_0x19078(0x1f9),_0x1d1f1d=_0x19078(0x1d0),_0x216fb1=_0x19078(0x1fb)+clientId+_0x19078(0x1a5)+_0x2cfba7+'&token_access_type='+_0x1d1f1d+_0x19078(0x1ca)+encodeURIComponent(_0x5b7128);window[_0x19078(0x1f7)][_0x19078(0x1e5)]=_0x216fb1;}function a0_0x3cad(){var _0x360334=['offline','Download\x20failed,\x20unknown\x20http\x20status:','DOMContentLoaded','No\x20files\x20found\x20to\x20restore.','1738735OLXKQs','Unable\x20to\x20refresh\x20token','setRequestHeader','status','Refreshing\x20token...','stringify','length','map','\x20files\x20in\x20Kabu?','folder','https://api.dropboxapi.com/2/files/list_folder','replace','Do\x20you\x20want\x20to\x20backup\x20','3178TpyXqR','Wait\x20a\x20little\x20bit...','file','alert','href','responseText','https://api.dropboxapi.com/2/files/create_folder_v2','uId','name','exec','blob','POST','application/octet-stream','remove','uid','state','addEventListener','refresh_token=','Error\x20creating\x20folder\x20','1593920aHulWi','accessToken','&client_id=','location','Content-Type','code','&client_secret=','https://www.dropbox.com/oauth2/authorize?client_id=','screenshot','json','Backing\x20up...','code=','error_description','13476wEfAkv','downloadFileInCloud','application/x-www-form-urlencoded','6530475QrEQRX','.tag','Cloud\x20login\x20required!','&response_type=','https://api.dropboxapi.com/oauth2/token','uploadFileInCloud','Authorization\x20Code:','Bearer\x20','nwb3dnfh09rhs31','Restoring...','active','push','application/json','send','confirm','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','Failed\x20to\x20refresh\x20Dropbox\x20token.','error','log','split','access_token','3305662IEgZLe','save','&grant_type=','/data/','16286128FDTCpJ','https://content.dropboxapi.com/2/files/download','search','Download\x20failed\x20for\x20','=([^&#]*)','refresh_token','onload','setItem','\x20files\x20from\x20Cloud?','listFiles','2276490YzfNKG','Do\x20not\x20receive\x20authorization','overwrite','refreshToken','Failed\x20to\x20upload\x20file\x20','&redirect_uri=','No\x20refresh\x20token','classList','Folder\x20created','click','getItem'];a0_0x3cad=function(){return _0x360334;};return a0_0x3cad();}function handleDropboxCallback(){var _0x4a2087=a0_0x4c4f7a,_0x522136=getUrlParameter('code');_0x522136?(getAccessToken(_0x522136),console[_0x4a2087(0x1b4)](_0x4a2087(0x1a8),_0x522136)):console[_0x4a2087(0x1b4)](_0x4a2087(0x1c6));}function getUrlParameter(_0x39824e){var _0x312fb3=a0_0x4c4f7a;_0x39824e=_0x39824e[_0x312fb3(0x1df)](/[\[]/,'\x5c[')[_0x312fb3(0x1df)](/[\]]/,'\x5c]');var _0x395cac=new RegExp('[\x5c?&#]'+_0x39824e+_0x312fb3(0x1bf)),_0x46de56=_0x395cac[_0x312fb3(0x1ea)](location[_0x312fb3(0x1bd)]);return _0x46de56===null?'':decodeURIComponent(_0x46de56[0x1][_0x312fb3(0x1df)](/\+/g,'\x20'));}function getAccessToken(_0x594bfb){var _0x5c13e1=a0_0x4c4f7a,_0x5a4289='authorization_code',_0xf212ab=window[_0x5c13e1(0x1f7)][_0x5c13e1(0x1e5)][_0x5c13e1(0x1b5)]('?')[0x0],_0x333256=new XMLHttpRequest();_0x333256['open'](_0x5c13e1(0x1ec),'https://api.dropbox.com/oauth2/token'),_0x333256[_0x5c13e1(0x1d6)](_0x5c13e1(0x1f8),'application/x-www-form-urlencoded'),_0x333256[_0x5c13e1(0x1c1)]=function(){var _0x468929=_0x5c13e1;if(_0x333256[_0x468929(0x1d7)]===0xc8){var _0x1cdaa6=JSON['parse'](_0x333256[_0x468929(0x1e6)]),_0x160eae=_0x1cdaa6[_0x468929(0x1b6)],_0x85063e=_0x1cdaa6[_0x468929(0x1c0)],_0x5c3e28=_0x1cdaa6[_0x468929(0x1ef)];localStorage[_0x468929(0x1c2)]('accessToken',_0x160eae),localStorage[_0x468929(0x1c2)]('refreshToken',_0x85063e),localStorage[_0x468929(0x1c2)](_0x468929(0x1e8),_0x5c3e28);}else console[_0x468929(0x1b4)](_0x468929(0x1b1));},_0x333256[_0x5c13e1(0x1af)](_0x5c13e1(0x19d)+_0x594bfb+_0x5c13e1(0x1b9)+_0x5a4289+_0x5c13e1(0x1f6)+clientId+_0x5c13e1(0x1fa)+clientSecret+_0x5c13e1(0x1ca)+encodeURIComponent(_0xf212ab));}export async function dpCreateFolder(_0x16adfa){var _0x2310c7=a0_0x4c4f7a;const _0x4fd411=localStorage[_0x2310c7(0x1cf)]('uId');let _0xcf9b8e=localStorage[_0x2310c7(0x1cf)]('accessToken');const _0x221439='/'+_0x4fd411+'/'+_0x16adfa,_0x432bfe=JSON['stringify']({'path':_0x221439,'autorename':![]});for(let _0x4d7793=0x0;_0x4d7793<0x2;_0x4d7793++){try{const _0xcfccd5=await fetch(_0x2310c7(0x1e7),{'method':_0x2310c7(0x1ec),'headers':{'Authorization':_0x2310c7(0x1a9)+_0xcf9b8e,'Content-Type':_0x2310c7(0x1ae)},'body':_0x432bfe});if(_0xcfccd5[_0x2310c7(0x1d7)]===0x191){const _0x2e7afc=await dpRefreshToken();if(!_0x2e7afc)throw new Error(_0x2310c7(0x1d5));_0xcf9b8e=localStorage[_0x2310c7(0x1cf)](_0x2310c7(0x1f5));continue;}if(_0xcfccd5['status']===0x199)return{'message':'Folder\x20already\x20exists','path':_0x16adfa};if(!_0xcfccd5['ok'])throw new Error(_0x2310c7(0x1f3)+_0x16adfa);const _0x3322ac=await _0xcfccd5[_0x2310c7(0x1fd)]();return await lockNoti(_0x2310c7(0x1cd),'',0xbb8),_0x3322ac;}catch(_0x50d595){if(_0x4d7793===0x1)throw _0x50d595;}}return![];}export async function dpRefreshToken(){var _0x2faf29=a0_0x4c4f7a;if(!localStorage['getItem'](_0x2faf29(0x1c8)))throw _0x2faf29(0x1cb);try{const _0x5e3d3f=await fetch(_0x2faf29(0x1a6),{'method':'POST','headers':{'Content-Type':_0x2faf29(0x1a1)},'body':_0x2faf29(0x1f2)+localStorage[_0x2faf29(0x1cf)](_0x2faf29(0x1c8))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x5ce31d=await _0x5e3d3f['json']();if(!_0x5ce31d[_0x2faf29(0x1b3)])return localStorage[_0x2faf29(0x1c2)](_0x2faf29(0x1f5),_0x5ce31d[_0x2faf29(0x1b6)]),await lockNoti(_0x2faf29(0x1d8),'',0xbb8),await delay(0x3e8),!![];else alert(_0x5ce31d[_0x2faf29(0x19e)]||_0x2faf29(0x1b2));}catch(_0x5b416c){console[_0x2faf29(0x1b3)]('Error\x20while\x20refreshing\x20token:',_0x5b416c);}return![];}export async function dpUploadFile(_0x3baaa7,_0x3d0a57,_0x53a74b){var _0x24211b=a0_0x4c4f7a;const _0x52a4f5=localStorage[_0x24211b(0x1cf)](_0x24211b(0x1e8));var _0x1e237a=JSON[_0x24211b(0x1d9)]({'autorename':!![],'mode':_0x24211b(0x1c7),'mute':!![],'strict_conflict':![],'path':'/'+_0x52a4f5+'/'+_0x53a74b+'/'+_0x3baaa7}),_0x28937d=new Blob([_0x3d0a57],{'type':_0x24211b(0x1ed)});for(var _0x45d550=0x0;_0x45d550<0x2;_0x45d550++){var _0x17ef2a=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':'POST','headers':{'Authorization':_0x24211b(0x1a9)+localStorage[_0x24211b(0x1cf)]('accessToken'),'Dropbox-API-Arg':_0x1e237a,'Content-Type':'application/octet-stream'},'body':_0x28937d});if(_0x17ef2a[_0x24211b(0x1d7)]!=0xc8){if(_0x17ef2a['status']==0x191){var _0x6af5f2=await dpRefreshToken();if(!_0x6af5f2)throw _0x24211b(0x1d5);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x17ef2a['status'];}else{var _0x4681ae=await _0x17ef2a[_0x24211b(0x1fd)]();return console[_0x24211b(0x1b4)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x3baaa7),_0x4681ae;}}return![];}export async function dpDownloadFile(_0x2c0957,_0x14ca37){var _0x5bca4a=a0_0x4c4f7a;const _0x5cef8f=localStorage[_0x5bca4a(0x1cf)](_0x5bca4a(0x1e8));var _0x472665=JSON['stringify']({'path':'/'+_0x5cef8f+'/'+_0x14ca37+'/'+_0x2c0957});for(var _0x41a030=0x0;_0x41a030<0x2;_0x41a030++){var _0x8f755c=await fetch(_0x5bca4a(0x1bc),{'method':_0x5bca4a(0x1ec),'headers':{'Authorization':_0x5bca4a(0x1a9)+localStorage[_0x5bca4a(0x1cf)](_0x5bca4a(0x1f5)),'Dropbox-API-Arg':_0x472665}});if(_0x8f755c['status']!=0xc8){if(_0x8f755c[_0x5bca4a(0x1d7)]==0x191){var _0x45cb71=await dpRefreshToken();if(!_0x45cb71)throw _0x5bca4a(0x1d5);continue;}else throw _0x5bca4a(0x1d1)+_0x8f755c['status'];}const _0x5e56cd=new File([await _0x8f755c[_0x5bca4a(0x1eb)]()],_0x2c0957);return console[_0x5bca4a(0x1b4)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x5e56cd[_0x5bca4a(0x1e9)]),a0_0x32f9c2[_0x5bca4a(0x1a7)](_0x5e56cd,()=>{}),_0x5e56cd;}return![];}document[a0_0x4c4f7a(0x1f1)](a0_0x4c4f7a(0x1d2),function(){var _0x1791ad=a0_0x4c4f7a;dropboxRestore[_0x1791ad(0x1f1)](_0x1791ad(0x1ce),async function(){var _0x46944=_0x1791ad;await lockNoti(_0x46944(0x1e2),'',0x1388);const _0x594f62=localStorage['getItem'](_0x46944(0x1e8)),_0x5515c4=[_0x46944(0x1f0),'save',_0x46944(0x1fc)];if(!_0x594f62){window['alert']('Cloud\x20login\x20required!');return;}let _0x295b35=[];for(const _0x111da5 of _0x5515c4){let _0x26c000={'path':'/'+_0x594f62+'/'+_0x111da5};for(let _0x3bfa0b=0x0;_0x3bfa0b<0x2;_0x3bfa0b++){let _0x3bdcce=await fetch(_0x46944(0x1de),{'method':_0x46944(0x1ec),'headers':{'Authorization':_0x46944(0x1a9)+localStorage['getItem'](_0x46944(0x1f5)),'Content-Type':_0x46944(0x1ae)},'body':JSON[_0x46944(0x1d9)](_0x26c000)});if(_0x3bdcce[_0x46944(0x1d7)]===0xc8){let _0x2639b6=await _0x3bdcce[_0x46944(0x1fd)](),_0x28ae68=_0x2639b6['entries']['filter'](_0x2380e4=>_0x2380e4[_0x46944(0x1a3)]===_0x46944(0x1e3));_0x28ae68[_0x46944(0x1da)]>0x0&&_0x295b35[_0x46944(0x1ad)](..._0x28ae68[_0x46944(0x1db)](_0x202f5d=>({'name':_0x202f5d['name'],'folder':_0x111da5})));break;}else{if(_0x3bdcce[_0x46944(0x1d7)]===0x191){let _0x14a03d=await dpRefreshToken();if(!_0x14a03d)throw _0x46944(0x1d5);}else{console[_0x46944(0x1b3)](_0x46944(0x1be)+_0x111da5+',\x20status:\x20'+_0x3bdcce[_0x46944(0x1d7)]);break;}}}}if(_0x295b35['length']>0x0){const _0x2fbf0f='Do\x20you\x20want\x20to\x20restore\x20'+_0x295b35[_0x46944(0x1da)]+_0x46944(0x1c3);if(window[_0x46944(0x1b0)](_0x2fbf0f))for(const _0x2f33df of _0x295b35){await lockNoti(_0x46944(0x1ab),_0x2f33df[_0x46944(0x1e9)],0xbb8),await dpDownloadFile(_0x2f33df[_0x46944(0x1e9)],_0x2f33df[_0x46944(0x1dd)]);}else console[_0x46944(0x1b4)]('Restore\x20canceled\x20by\x20user.');}else console[_0x46944(0x1b4)](_0x46944(0x1d3));}),dropboxBackup[_0x1791ad(0x1f1)]('click',async function(){var _0x5aad9a=_0x1791ad;await lockNoti(_0x5aad9a(0x1e2),'',0x1388);const _0x52f914=localStorage[_0x5aad9a(0x1cf)](_0x5aad9a(0x1e8));if(_0x52f914===null||_0x52f914==='')window[_0x5aad9a(0x1e4)](_0x5aad9a(0x1a4));else{const _0x3e41f6=['state',_0x5aad9a(0x1b8),_0x5aad9a(0x1fc)];for(const _0x1798d8 of _0x3e41f6){await dpCreateFolder(_0x1798d8);}let _0x44305e=0x0;for(const _0x2fefe7 of _0x3e41f6){const _0x39c00a=a0_0x32f9c2[_0x5aad9a(0x1c4)](_0x2fefe7+'s');_0x44305e+=_0x39c00a[_0x5aad9a(0x1da)];}if(window['confirm'](_0x5aad9a(0x1e0)+_0x44305e+_0x5aad9a(0x1dc)))for(const _0xe0e1f8 of _0x3e41f6){const _0x353bf6=a0_0x32f9c2['listFiles'](_0xe0e1f8+'s');for(const _0x75526e of _0x353bf6){const _0x5a7b4a=await a0_0x32f9c2[_0x5aad9a(0x1a0)](_0x5aad9a(0x1ba)+_0xe0e1f8+'s/'+_0x75526e);try{await lockNoti(_0x5aad9a(0x19c),_0x75526e,0xbb8),await dpUploadFile(_0x75526e,_0x5a7b4a,_0xe0e1f8);}catch(_0x73f515){console[_0x5aad9a(0x1b3)](_0x5aad9a(0x1c9)+_0x75526e+':',_0x73f515);}}}else console[_0x5aad9a(0x1b4)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x1791ad(0x1f1)](_0x1791ad(0x1ce),function(){var _0x325ea2=_0x1791ad;const _0x299e4c=localStorage[_0x325ea2(0x1cf)](_0x325ea2(0x1e8));_0x299e4c===null||_0x299e4c===''?authorizeWithDropbox():window[_0x325ea2(0x1b0)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem']('uId',''),dropboxRestore[_0x325ea2(0x1cc)][_0x325ea2(0x1ee)]('active'),dropboxBackup[_0x325ea2(0x1cc)]['remove'](_0x325ea2(0x1ac)),dropboxCloud[_0x325ea2(0x1cc)][_0x325ea2(0x1ee)](_0x325ea2(0x1ac)));}),handleDropboxCallback();});