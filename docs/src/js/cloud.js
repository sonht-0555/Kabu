var a0_0x52e626=a0_0x4970;(function(_0x1a9d49,_0x44c34b){var _0x164a17=a0_0x4970,_0x2d82bb=_0x1a9d49();while(!![]){try{var _0x263e0c=parseInt(_0x164a17(0x1f7))/0x1+-parseInt(_0x164a17(0x1bc))/0x2*(parseInt(_0x164a17(0x214))/0x3)+parseInt(_0x164a17(0x1d1))/0x4+parseInt(_0x164a17(0x1f1))/0x5*(parseInt(_0x164a17(0x1cf))/0x6)+-parseInt(_0x164a17(0x1e7))/0x7+-parseInt(_0x164a17(0x202))/0x8*(parseInt(_0x164a17(0x1b7))/0x9)+-parseInt(_0x164a17(0x1c9))/0xa*(-parseInt(_0x164a17(0x20e))/0xb);if(_0x263e0c===_0x44c34b)break;else _0x2d82bb['push'](_0x2d82bb['shift']());}catch(_0x225823){_0x2d82bb['push'](_0x2d82bb['shift']());}}}(a0_0x120f,0xd57e6));import*as a0_0x5e3852 from'./main.js';import{localStorageFile}from'./storage.js';function a0_0x120f(){var _0x3c840f=['confirm','.tag','&response_type=','entries','https://content.dropboxapi.com/2/files/download','offline','.ss1','Failed\x20to\x20refresh\x20Dropbox\x20token.','name','error_description','uid','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','setRequestHeader','location','.ss2','_dateState','7368284tCyTNq','.gba_slot','endsWith','Backing\x20up...','.ss4','Cloud\x20login\x20required!','uploadSaveOrSaveState','.gba_dateState','json','_imageState','47190pJgIMi','split','code','text/plain','downloadFileInCloud','exec','15773yPQwWM','toUpperCase','charAt','&redirect_uri=','status','send','access_token','responseText','code=','getItem','Unable\x20to\x20refresh\x20token','77712vvcqcj','uId','stringify','Bearer\x20','=([^&#]*)','FSSync','accessToken','Restore\x20canceled\x20by\x20user.','replace','addEventListener','Authorization\x20Code:','length','118393ysvfOF','Do\x20you\x20want\x20to\x20backup\x20','refresh_token=','search','file','list','4435323JJKKac','.txt','Download\x20failed,\x20unknown\x20http\x20status:','overwrite','href','authorization_code','.ss3','https://api.dropboxapi.com/oauth2/token','blob','log','\x20files\x20in\x20Kabu?','state','classList','active','792JFOSsz','filter','alert','substring','Do\x20not\x20receive\x20authorization','2TuGjzk','Download\x20failed,\x20unknown\x20http\x20status:\x20','slice','click','\x20files\x20in\x20Cloud?','https://www.dropbox.com/oauth2/authorize?client_id=','remove','refresh_token','gba','onload','setItem','Refreshing\x20token...','refreshToken','2780MMPooZ','application/octet-stream','Cloud\x20↦\x20Kabu\x20storage\x20◆','Do\x20you\x20want\x20to\x20restore\x20','Upload\x20failed,\x20unknown\x20http\x20status:\x20','error','444aYKTof','&token_access_type=','2216224xXgfJI','application/x-www-form-urlencoded','POST','lastIndexOf','.ss0','Error\x20while\x20refreshing\x20token:'];a0_0x120f=function(){return _0x3c840f;};return a0_0x120f();}var clientId='knh3uz2mx2hp2eu',clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0x4554b9=a0_0x4970,_0x1e67da=window[_0x4554b9(0x1e4)]['href'][_0x4554b9(0x1f2)]('?')[0x0],_0xd462da=_0x4554b9(0x1f3),_0x49547b=_0x4554b9(0x1dc),_0x21e4ba=_0x4554b9(0x1c1)+clientId+_0x4554b9(0x1d9)+_0xd462da+_0x4554b9(0x1d0)+_0x49547b+_0x4554b9(0x1fa)+encodeURIComponent(_0x1e67da);window[_0x4554b9(0x1e4)][_0x4554b9(0x218)]=_0x21e4ba;}function handleDropboxCallback(){var _0x52764b=a0_0x4970,_0x39280d=getUrlParameter('code');_0x39280d?(getAccessToken(_0x39280d),console[_0x52764b(0x1b2)](_0x52764b(0x20c),_0x39280d)):console['log'](_0x52764b(0x1bb));}function getUrlParameter(_0x27caa3){var _0x58c68e=a0_0x4970;_0x27caa3=_0x27caa3['replace'](/[\[]/,'\x5c[')[_0x58c68e(0x20a)](/[\]]/,'\x5c]');var _0x4ebade=new RegExp('[\x5c?&#]'+_0x27caa3+_0x58c68e(0x206)),_0x28e326=_0x4ebade[_0x58c68e(0x1f6)](location[_0x58c68e(0x211)]);return _0x28e326===null?'':decodeURIComponent(_0x28e326[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x2d59f4){var _0x376f90=a0_0x4970,_0x2fe3a2=_0x376f90(0x219),_0x6da96=window[_0x376f90(0x1e4)][_0x376f90(0x218)][_0x376f90(0x1f2)]('?')[0x0],_0x1457ea=new XMLHttpRequest();_0x1457ea['open'](_0x376f90(0x1d3),'https://api.dropbox.com/oauth2/token'),_0x1457ea[_0x376f90(0x1e3)]('Content-Type',_0x376f90(0x1d2)),_0x1457ea[_0x376f90(0x1c5)]=function(){var _0x108b09=_0x376f90;if(_0x1457ea[_0x108b09(0x1fb)]===0xc8){var _0x2bd8db=JSON['parse'](_0x1457ea[_0x108b09(0x1fe)]),_0x35655c=_0x2bd8db[_0x108b09(0x1fd)],_0x1c172c=_0x2bd8db[_0x108b09(0x1c3)],_0x5bfbdc=_0x2bd8db[_0x108b09(0x1e1)];localStorage[_0x108b09(0x1c6)](_0x108b09(0x208),_0x35655c),localStorage['setItem'](_0x108b09(0x1c8),_0x1c172c),localStorage['setItem'](_0x108b09(0x203),_0x5bfbdc);}else console[_0x108b09(0x1b2)](_0x108b09(0x1e2));},_0x1457ea[_0x376f90(0x1fc)](_0x376f90(0x1ff)+_0x2d59f4+'&grant_type='+_0x2fe3a2+'&client_id='+clientId+'&client_secret='+clientSecret+_0x376f90(0x1fa)+encodeURIComponent(_0x6da96));}export async function dpRefreshToken(){var _0x28975d=a0_0x4970;if(!localStorage[_0x28975d(0x200)](_0x28975d(0x1c8)))throw'No\x20refresh\x20token';try{const _0x4abc77=await fetch(_0x28975d(0x1b0),{'method':_0x28975d(0x1d3),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x28975d(0x210)+localStorage[_0x28975d(0x200)](_0x28975d(0x1c8))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x5f0832=await _0x4abc77['json']();if(!_0x5f0832[_0x28975d(0x1ce)])return localStorage[_0x28975d(0x1c6)]('accessToken',_0x5f0832['access_token']),await lockNoti('',_0x28975d(0x1c7),0xbb8),await delay(0x3e8),!![];else alert(_0x5f0832[_0x28975d(0x1e0)]||_0x28975d(0x1de));}catch(_0x263be4){console[_0x28975d(0x1ce)](_0x28975d(0x1d6),_0x263be4);}return![];}export async function dpUploadFile(_0x418861,_0x4aac98){var _0x106e03=a0_0x4970;const _0x186961=localStorage['getItem'](_0x106e03(0x203));var _0x3511b2=JSON[_0x106e03(0x204)]({'autorename':!![],'mode':_0x106e03(0x217),'mute':!![],'strict_conflict':![],'path':'/'+_0x186961+'/'+_0x418861}),_0x25919d=new Blob([_0x4aac98],{'type':'application/octet-stream'});for(var _0x58466b=0x0;_0x58466b<0x2;_0x58466b++){var _0xd20abc=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x106e03(0x1d3),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x106e03(0x200)]('accessToken'),'Dropbox-API-Arg':_0x3511b2,'Content-Type':_0x106e03(0x1ca)},'body':_0x25919d});if(_0xd20abc[_0x106e03(0x1fb)]!=0xc8){if(_0xd20abc[_0x106e03(0x1fb)]==0x191){var _0x44fde2=await dpRefreshToken();if(!_0x44fde2)throw _0x106e03(0x201);continue;}else throw _0x106e03(0x1cd)+_0xd20abc[_0x106e03(0x1fb)];}else{var _0x495d7a=await _0xd20abc[_0x106e03(0x1ef)]();return console[_0x106e03(0x1b2)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x418861),_0x495d7a;}}return![];}async function dpDownloadFile(_0x566631){var _0x3050b6=a0_0x4970;const _0x25b88e=localStorage[_0x3050b6(0x200)](_0x3050b6(0x203));var _0x4d414a=JSON['stringify']({'path':'/'+_0x25b88e+'/'+_0x566631});for(var _0x374081=0x0;_0x374081<0x2;_0x374081++){var _0x350c00=await fetch(_0x3050b6(0x1db),{'method':_0x3050b6(0x1d3),'headers':{'Authorization':_0x3050b6(0x205)+localStorage[_0x3050b6(0x200)](_0x3050b6(0x208)),'Dropbox-API-Arg':_0x4d414a}});if(_0x350c00[_0x3050b6(0x1fb)]!=0xc8){if(_0x350c00[_0x3050b6(0x1fb)]==0x191){var _0x203fc2=await dpRefreshToken();if(!_0x203fc2)throw _0x3050b6(0x201);continue;}else throw _0x3050b6(0x216)+_0x350c00['status'];}const _0x538581=new File([await _0x350c00[_0x3050b6(0x1b1)]()],_0x566631);console[_0x3050b6(0x1b2)](_0x3050b6(0x1cb),_0x538581[_0x3050b6(0x1df)]);if(_0x566631[_0x3050b6(0x1e9)](_0x3050b6(0x215))){const _0x3b81e3=await _0x538581['text'](),[_0x57c589,_0x1959e9]=_0x3b81e3['split']('\x0a\x0a'),_0x38e5c2=_0x566631[_0x3050b6(0x1ba)](0x0,_0x566631[_0x3050b6(0x1d4)](_0x3050b6(0x1c4))+0x3),_0x19d7b2=_0x566631[_0x3050b6(0x1f9)](_0x566631[_0x3050b6(0x20d)]-0x5);localStorage[_0x3050b6(0x1c6)](_0x38e5c2+_0x3050b6(0x1e6)+_0x19d7b2,_0x1959e9),localStorage[_0x3050b6(0x1c6)](_0x38e5c2+_0x3050b6(0x1f0)+_0x19d7b2,_0x57c589);}else a0_0x5e3852[_0x3050b6(0x1ed)](_0x538581,()=>{var _0x31f674=_0x3050b6;localStorageFile(),Module[_0x31f674(0x207)]();});return _0x538581;}return![];}function a0_0x4970(_0x49161e,_0x5c6e18){var _0x120ff8=a0_0x120f();return a0_0x4970=function(_0x49709c,_0x22ee72){_0x49709c=_0x49709c-0x1b0;var _0x42c9b3=_0x120ff8[_0x49709c];return _0x42c9b3;},a0_0x4970(_0x49161e,_0x5c6e18);}document[a0_0x52e626(0x20b)]('DOMContentLoaded',function(){var _0x1e7659=a0_0x52e626;dropboxRestore[_0x1e7659(0x20b)](_0x1e7659(0x1bf),async function(){var _0x46e4fe=_0x1e7659;const _0x317a89=localStorage[_0x46e4fe(0x200)](_0x46e4fe(0x203));if(_0x317a89===null||_0x317a89==='')window[_0x46e4fe(0x1b9)](_0x46e4fe(0x1ec));else{var _0x178a9b={'path':'/'+_0x317a89};for(var _0x822c29=0x0;_0x822c29<0x2;_0x822c29++){var _0x268a84=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x46e4fe(0x1d3),'headers':{'Authorization':_0x46e4fe(0x205)+localStorage[_0x46e4fe(0x200)](_0x46e4fe(0x208)),'Content-Type':'application/json'},'body':JSON[_0x46e4fe(0x204)](_0x178a9b)});console[_0x46e4fe(0x1b2)]('status:\x20',_0x268a84[_0x46e4fe(0x1fb)]);if(_0x268a84[_0x46e4fe(0x1fb)]!=0xc8){if(_0x268a84[_0x46e4fe(0x1fb)]==0x191){var _0x4301dc=await dpRefreshToken();if(!_0x4301dc)throw _0x46e4fe(0x201);continue;}else throw _0x46e4fe(0x1bd)+_0x268a84[_0x46e4fe(0x1fb)];}else{const _0x3e60ab=await _0x268a84[_0x46e4fe(0x1ef)](),_0x314655=_0x3e60ab[_0x46e4fe(0x1da)][_0x46e4fe(0x1b8)](_0x2da82b=>_0x2da82b['.tag']===_0x46e4fe(0x212))[_0x46e4fe(0x20d)],_0x479f6c=_0x46e4fe(0x1cc)+_0x314655+_0x46e4fe(0x1c0);if(window[_0x46e4fe(0x1d7)](_0x479f6c))for(const _0x2d48d7 of _0x3e60ab[_0x46e4fe(0x1da)]){_0x2d48d7[_0x46e4fe(0x1d8)]===_0x46e4fe(0x212)&&(await lockNoti('Restoring...',_0x2d48d7[_0x46e4fe(0x1df)],0xbb8),await dpDownloadFile(_0x2d48d7['name']));}else console[_0x46e4fe(0x1b2)](_0x46e4fe(0x209));return!![];}}return![];}}),dropboxBackup[_0x1e7659(0x20b)](_0x1e7659(0x1bf),async function(){var _0x4bd66a=_0x1e7659;const _0x4d382a=localStorage[_0x4bd66a(0x200)]('uId');if(_0x4d382a===null||_0x4d382a==='')window['alert'](_0x4bd66a(0x1ec));else{const _0x32b6ac=[_0x4bd66a(0x1b4),'save'];let _0x227a95=0x0;for(const _0xb67b3c of _0x32b6ac){const _0x16ed7f=a0_0x5e3852[_0x4bd66a(0x213)+(_0xb67b3c['charAt'](0x0)[_0x4bd66a(0x1f8)]()+_0xb67b3c[_0x4bd66a(0x1be)](0x1))]();_0x227a95+=_0x16ed7f[_0x4bd66a(0x20d)];}if(window[_0x4bd66a(0x1d7)](_0x4bd66a(0x20f)+_0x227a95+_0x4bd66a(0x1b3)))for(const _0x7a8041 of _0x32b6ac){const _0x2428fa=a0_0x5e3852['list'+(_0x7a8041[_0x4bd66a(0x1f9)](0x0)[_0x4bd66a(0x1f8)]()+_0x7a8041[_0x4bd66a(0x1be)](0x1))]();for(const _0x5a628e of _0x2428fa){const _0x3c3500=await a0_0x5e3852[_0x4bd66a(0x1f5)]('/data/'+_0x7a8041+'s/'+_0x5a628e);try{await lockNoti(_0x4bd66a(0x1ea),_0x5a628e,0xbb8),await dpUploadFile(_0x5a628e,_0x3c3500);if(_0x5a628e['endsWith'](_0x4bd66a(0x1d5))||_0x5a628e[_0x4bd66a(0x1e9)](_0x4bd66a(0x1dd))||_0x5a628e[_0x4bd66a(0x1e9)](_0x4bd66a(0x1e5))||_0x5a628e[_0x4bd66a(0x1e9)](_0x4bd66a(0x21a))||_0x5a628e[_0x4bd66a(0x1e9)](_0x4bd66a(0x1eb))||_0x5a628e[_0x4bd66a(0x1e9)]('.ss5')||_0x5a628e[_0x4bd66a(0x1e9)]('.ss6')||_0x5a628e['endsWith']('.ss7')){const _0x48e04e=_0x5a628e[_0x4bd66a(0x1ba)](0x0,_0x5a628e['lastIndexOf']('.')),_0x3ffd5c=_0x5a628e[_0x4bd66a(0x1f9)](_0x5a628e['length']-0x1),_0x22053e=localStorage[_0x4bd66a(0x200)](_0x48e04e+'.gba_imageState'+_0x3ffd5c),_0x1e9057=localStorage[_0x4bd66a(0x200)](_0x48e04e+_0x4bd66a(0x1ee)+_0x3ffd5c);if(_0x22053e!==null){const _0x1c5b29=_0x22053e+'\x0a\x0a'+_0x1e9057,_0x545535=new Blob([_0x1c5b29],{'type':_0x4bd66a(0x1f4)});await lockNoti('Backing\x20up...',_0x48e04e+'.gba_slot'+_0x3ffd5c+_0x4bd66a(0x215),0xbb8),await dpUploadFile(_0x48e04e+_0x4bd66a(0x1e8)+_0x3ffd5c+_0x4bd66a(0x215),_0x545535);}}}catch(_0x51ea79){console[_0x4bd66a(0x1ce)]('Failed\x20to\x20upload\x20file\x20'+_0x5a628e+':',_0x51ea79);}}}else console[_0x4bd66a(0x1b2)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener']('click',function(){var _0x14540e=_0x1e7659;const _0x81097e=localStorage[_0x14540e(0x200)](_0x14540e(0x203));_0x81097e===null||_0x81097e===''?authorizeWithDropbox():window['confirm']('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x14540e(0x1c6)](_0x14540e(0x203),''),dropboxRestore[_0x14540e(0x1b5)][_0x14540e(0x1c2)](_0x14540e(0x1b6)),dropboxBackup[_0x14540e(0x1b5)]['remove'](_0x14540e(0x1b6)),dropboxCloud[_0x14540e(0x1b5)]['remove'](_0x14540e(0x1b6)));}),handleDropboxCallback();});