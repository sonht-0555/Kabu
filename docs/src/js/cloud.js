var a0_0xf5b4db=a0_0x4909;(function(_0x2253a7,_0x59959e){var _0x38ce38=a0_0x4909,_0x15e3f9=_0x2253a7();while(!![]){try{var _0x149599=-parseInt(_0x38ce38(0xf2))/0x1*(parseInt(_0x38ce38(0x12b))/0x2)+parseInt(_0x38ce38(0x110))/0x3+-parseInt(_0x38ce38(0x101))/0x4*(parseInt(_0x38ce38(0x122))/0x5)+-parseInt(_0x38ce38(0xfb))/0x6+parseInt(_0x38ce38(0x116))/0x7+parseInt(_0x38ce38(0x11f))/0x8*(-parseInt(_0x38ce38(0xf8))/0x9)+parseInt(_0x38ce38(0x113))/0xa;if(_0x149599===_0x59959e)break;else _0x15e3f9['push'](_0x15e3f9['shift']());}catch(_0x296abc){_0x15e3f9['push'](_0x15e3f9['shift']());}}}(a0_0x2c04,0xe66de));import*as a0_0x26d7da from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0xf5b4db(0x12e),clientSecret=a0_0xf5b4db(0xe6);function a0_0x4909(_0x2aba23,_0xa61f94){var _0x2c0438=a0_0x2c04();return a0_0x4909=function(_0x49095b,_0x56b8c6){_0x49095b=_0x49095b-0xe1;var _0x512f7f=_0x2c0438[_0x49095b];return _0x512f7f;},a0_0x4909(_0x2aba23,_0xa61f94);}function authorizeWithDropbox(){var _0x3410b6=a0_0xf5b4db,_0x3f4d76=window[_0x3410b6(0x145)]['href'][_0x3410b6(0xf9)]('?')[0x0],_0x33681f=_0x3410b6(0x13c),_0x37add2=_0x3410b6(0x135),_0x3b1c71=_0x3410b6(0x12d)+clientId+'&response_type='+_0x33681f+_0x3410b6(0x131)+_0x37add2+'&redirect_uri='+encodeURIComponent(_0x3f4d76);window[_0x3410b6(0x145)][_0x3410b6(0x107)]=_0x3b1c71;}function a0_0x2c04(){var _0x1c3d7a=['Cloud\x20login\x20required!','list','file','Kabu\x20storage\x20↦\x20Cloud\x20◆','Folder\x20created','12eSJJGP','name','https://www.dropbox.com/oauth2/authorize?client_id=','knh3uz2mx2hp2eu','\x20files\x20from\x20Cloud?','Bearer\x20','&token_access_type=','replace','status','Download\x20failed\x20for\x20','offline','Do\x20you\x20want\x20to\x20backup\x20','refreshToken','state','addEventListener','https://api.dropboxapi.com/2/files/create_folder_v2','Cloud\x20↦\x20Kabu\x20storage\x20◆','code','application/octet-stream','entries','Download\x20failed,\x20unknown\x20http\x20status:','getItem','filter','log','charAt','setItem','location','=([^&#]*)','uId','Wait\x20a\x20little\x20bit...','refresh_token','click','confirm','nwb3dnfh09rhs31','parse','https://api.dropboxapi.com/oauth2/token','[\x5c?&#]','remove','map','blob','downloadFileInCloud','error','Failed\x20to\x20refresh\x20Dropbox\x20token.','search','alert','106432ogBcSv','Error\x20creating\x20folder\x20','&redirect_uri=','https://content.dropboxapi.com/2/files/upload','DOMContentLoaded','active','9oLzeEC','split','access_token','6090018dbdhZa','https://content.dropboxapi.com/2/files/download','screenshot','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','classList','application/x-www-form-urlencoded','2044688FkAtpR','&client_secret=','Do\x20not\x20receive\x20authorization','onload','.tag','Unable\x20to\x20refresh\x20token','href','No\x20refresh\x20token','uploadFileInCloud','Do\x20you\x20want\x20to\x20restore\x20',',\x20status:\x20','length','&grant_type=','refresh_token=','accessToken','1498689JivvyY','slice','json','38057750NzEyEy','POST','/data/','2764986nMhaTB','save','push','Refreshing\x20token...','send','open','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Restore\x20canceled\x20by\x20user.','stringify','8644472QUjRGx','&client_id=','Restoring...','10FMDQcb','Do\x20you\x20want\x20to\x20logout?','application/json','folder'];a0_0x2c04=function(){return _0x1c3d7a;};return a0_0x2c04();}function handleDropboxCallback(){var _0x3d318a=a0_0xf5b4db,_0x4c4430=getUrlParameter(_0x3d318a(0x13c));_0x4c4430?(getAccessToken(_0x4c4430),console[_0x3d318a(0x142)]('Authorization\x20Code:',_0x4c4430)):console['log'](_0x3d318a(0x103));}function getUrlParameter(_0x592366){var _0x4bee71=a0_0xf5b4db;_0x592366=_0x592366[_0x4bee71(0x132)](/[\[]/,'\x5c[')[_0x4bee71(0x132)](/[\]]/,'\x5c]');var _0x369ce9=new RegExp(_0x4bee71(0xe9)+_0x592366+_0x4bee71(0x146)),_0x5c32e0=_0x369ce9['exec'](location[_0x4bee71(0xf0)]);return _0x5c32e0===null?'':decodeURIComponent(_0x5c32e0[0x1][_0x4bee71(0x132)](/\+/g,'\x20'));}function getAccessToken(_0x2291d5){var _0x3359b0=a0_0xf5b4db,_0x2e830d='authorization_code',_0x1b3d0b=window[_0x3359b0(0x145)][_0x3359b0(0x107)][_0x3359b0(0xf9)]('?')[0x0],_0x10ccc2=new XMLHttpRequest();_0x10ccc2[_0x3359b0(0x11b)]('POST','https://api.dropbox.com/oauth2/token'),_0x10ccc2['setRequestHeader']('Content-Type',_0x3359b0(0x100)),_0x10ccc2[_0x3359b0(0x104)]=function(){var _0x5293a7=_0x3359b0;if(_0x10ccc2['status']===0xc8){var _0xba9efc=JSON[_0x5293a7(0xe7)](_0x10ccc2['responseText']),_0x2d188f=_0xba9efc[_0x5293a7(0xfa)],_0x2c1a57=_0xba9efc[_0x5293a7(0xe3)],_0x50e50b=_0xba9efc['uid'];localStorage[_0x5293a7(0x144)](_0x5293a7(0x10f),_0x2d188f),localStorage['setItem'](_0x5293a7(0x137),_0x2c1a57),localStorage['setItem'](_0x5293a7(0xe1),_0x50e50b);}else console['log'](_0x5293a7(0xfe));},_0x10ccc2[_0x3359b0(0x11a)]('code='+_0x2291d5+_0x3359b0(0x10d)+_0x2e830d+_0x3359b0(0x120)+clientId+_0x3359b0(0x102)+clientSecret+_0x3359b0(0xf4)+encodeURIComponent(_0x1b3d0b));}export async function dpCreateFolder(_0x2d254c){var _0x347bc0=a0_0xf5b4db;const _0x23cbe1=localStorage[_0x347bc0(0x140)](_0x347bc0(0xe1));let _0x4d2130=localStorage[_0x347bc0(0x140)](_0x347bc0(0x10f));const _0x1b56ec='/'+_0x23cbe1+'/'+_0x2d254c,_0x3a5933=JSON['stringify']({'path':_0x1b56ec,'autorename':![]});for(let _0x47381d=0x0;_0x47381d<0x2;_0x47381d++){try{const _0x5bb0b6=await fetch(_0x347bc0(0x13a),{'method':_0x347bc0(0x114),'headers':{'Authorization':_0x347bc0(0x130)+_0x4d2130,'Content-Type':_0x347bc0(0x124)},'body':_0x3a5933});if(_0x5bb0b6[_0x347bc0(0x133)]===0x191){const _0x4e9108=await dpRefreshToken();if(!_0x4e9108)throw new Error(_0x347bc0(0x106));_0x4d2130=localStorage['getItem'](_0x347bc0(0x10f));continue;}if(_0x5bb0b6[_0x347bc0(0x133)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x2d254c};if(!_0x5bb0b6['ok'])throw new Error(_0x347bc0(0xf3)+_0x2d254c);const _0x280972=await _0x5bb0b6['json']();return await lockNoti(_0x347bc0(0x12a),'',0xbb8),_0x280972;}catch(_0x1870aa){if(_0x47381d===0x1)throw _0x1870aa;}}return![];}export async function dpRefreshToken(){var _0x2b8c8e=a0_0xf5b4db;if(!localStorage['getItem'](_0x2b8c8e(0x137)))throw _0x2b8c8e(0x108);try{const _0x1eb510=await fetch(_0x2b8c8e(0xe8),{'method':_0x2b8c8e(0x114),'headers':{'Content-Type':_0x2b8c8e(0x100)},'body':_0x2b8c8e(0x10e)+localStorage[_0x2b8c8e(0x140)](_0x2b8c8e(0x137))+_0x2b8c8e(0x11c)}),_0x1c531a=await _0x1eb510['json']();if(!_0x1c531a[_0x2b8c8e(0xee)])return localStorage['setItem'](_0x2b8c8e(0x10f),_0x1c531a[_0x2b8c8e(0xfa)]),await lockNoti(_0x2b8c8e(0x119),'',0xbb8),await delay(0x3e8),!![];else alert(_0x1c531a['error_description']||_0x2b8c8e(0xef));}catch(_0x3a1d3f){console[_0x2b8c8e(0xee)]('Error\x20while\x20refreshing\x20token:',_0x3a1d3f);}return![];}export async function dpUploadFile(_0x1df233,_0x11ddcb,_0x4c3734){var _0x317d17=a0_0xf5b4db;const _0x71fe22=localStorage['getItem']('uId');var _0x2aeefb=JSON[_0x317d17(0x11e)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x71fe22+'/'+_0x4c3734+'/'+_0x1df233}),_0x3f5eda=new Blob([_0x11ddcb],{'type':_0x317d17(0x13d)});for(var _0x146dff=0x0;_0x146dff<0x2;_0x146dff++){var _0x189b01=await fetch(_0x317d17(0xf5),{'method':'POST','headers':{'Authorization':_0x317d17(0x130)+localStorage[_0x317d17(0x140)]('accessToken'),'Dropbox-API-Arg':_0x2aeefb,'Content-Type':_0x317d17(0x13d)},'body':_0x3f5eda});if(_0x189b01[_0x317d17(0x133)]!=0xc8){if(_0x189b01[_0x317d17(0x133)]==0x191){var _0x1ab627=await dpRefreshToken();if(!_0x1ab627)throw _0x317d17(0x106);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x189b01[_0x317d17(0x133)];}else{var _0xf63f72=await _0x189b01[_0x317d17(0x112)]();return console[_0x317d17(0x142)](_0x317d17(0x129),_0x1df233),_0xf63f72;}}return![];}export async function dpDownloadFile(_0x3adf2f,_0x276958){var _0x5821cd=a0_0xf5b4db;const _0x281a2a=localStorage[_0x5821cd(0x140)](_0x5821cd(0xe1));var _0x5edc97=JSON['stringify']({'path':'/'+_0x281a2a+'/'+_0x276958+'/'+_0x3adf2f});for(var _0x2ed703=0x0;_0x2ed703<0x2;_0x2ed703++){var _0x402c80=await fetch(_0x5821cd(0xfc),{'method':_0x5821cd(0x114),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x5821cd(0x140)](_0x5821cd(0x10f)),'Dropbox-API-Arg':_0x5edc97}});if(_0x402c80[_0x5821cd(0x133)]!=0xc8){if(_0x402c80[_0x5821cd(0x133)]==0x191){var _0x42b7d6=await dpRefreshToken();if(!_0x42b7d6)throw _0x5821cd(0x106);continue;}else throw _0x5821cd(0x13f)+_0x402c80['status'];}const _0x21a803=new File([await _0x402c80[_0x5821cd(0xec)]()],_0x3adf2f);return console[_0x5821cd(0x142)](_0x5821cd(0x13b),_0x21a803[_0x5821cd(0x12c)]),a0_0x26d7da[_0x5821cd(0x109)](_0x21a803,()=>{}),_0x21a803;}return![];}document[a0_0xf5b4db(0x139)](a0_0xf5b4db(0xf6),function(){var _0x175e9e=a0_0xf5b4db;dropboxRestore[_0x175e9e(0x139)]('click',async function(){var _0x3dc42e=_0x175e9e;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x5d44d2=localStorage[_0x3dc42e(0x140)]('uId'),_0x440297=[_0x3dc42e(0x138),'save',_0x3dc42e(0xfd)];if(!_0x5d44d2){window[_0x3dc42e(0xf1)]('Cloud\x20login\x20required!');return;}let _0x2a0ad5=[];for(const _0x317707 of _0x440297){let _0x133801={'path':'/'+_0x5d44d2+'/'+_0x317707};for(let _0x4b0ee2=0x0;_0x4b0ee2<0x2;_0x4b0ee2++){let _0x5dbbe1=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':'POST','headers':{'Authorization':_0x3dc42e(0x130)+localStorage['getItem']('accessToken'),'Content-Type':_0x3dc42e(0x124)},'body':JSON[_0x3dc42e(0x11e)](_0x133801)});if(_0x5dbbe1[_0x3dc42e(0x133)]===0xc8){let _0x1e70f1=await _0x5dbbe1['json'](),_0x1aa59d=_0x1e70f1[_0x3dc42e(0x13e)][_0x3dc42e(0x141)](_0x38adbe=>_0x38adbe[_0x3dc42e(0x105)]===_0x3dc42e(0x128));_0x1aa59d[_0x3dc42e(0x10c)]>0x0&&_0x2a0ad5[_0x3dc42e(0x118)](..._0x1aa59d[_0x3dc42e(0xeb)](_0x13595d=>({'name':_0x13595d[_0x3dc42e(0x12c)],'folder':_0x317707})));break;}else{if(_0x5dbbe1['status']===0x191){let _0x3517ee=await dpRefreshToken();if(!_0x3517ee)throw _0x3dc42e(0x106);}else{console[_0x3dc42e(0xee)](_0x3dc42e(0x134)+_0x317707+_0x3dc42e(0x10b)+_0x5dbbe1[_0x3dc42e(0x133)]);break;}}}}if(_0x2a0ad5[_0x3dc42e(0x10c)]>0x0){const _0xc7a26c=_0x3dc42e(0x10a)+_0x2a0ad5['length']+_0x3dc42e(0x12f);if(window[_0x3dc42e(0xe5)](_0xc7a26c))for(const _0x10a702 of _0x2a0ad5){await lockNoti(_0x3dc42e(0x121),_0x10a702[_0x3dc42e(0x12c)],0xbb8),await dpDownloadFile(_0x10a702[_0x3dc42e(0x12c)],_0x10a702[_0x3dc42e(0x125)]);}else console['log'](_0x3dc42e(0x11d));}else console[_0x3dc42e(0x142)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x175e9e(0x139)](_0x175e9e(0xe4),async function(){var _0x45c68c=_0x175e9e;await lockNoti(_0x45c68c(0xe2),'',0x1388);const _0x2bc56c=localStorage['getItem'](_0x45c68c(0xe1));if(_0x2bc56c===null||_0x2bc56c==='')window[_0x45c68c(0xf1)](_0x45c68c(0x126));else{const _0x778e2a=[_0x45c68c(0x138),_0x45c68c(0x117),_0x45c68c(0xfd)];for(const _0x4d103d of _0x778e2a){await dpCreateFolder(_0x4d103d);}let _0x270608=0x0;for(const _0x32bb01 of _0x778e2a){const _0x40346f=a0_0x26d7da[_0x45c68c(0x127)+(_0x32bb01['charAt'](0x0)['toUpperCase']()+_0x32bb01[_0x45c68c(0x111)](0x1))]();_0x270608+=_0x40346f[_0x45c68c(0x10c)];}if(window['confirm'](_0x45c68c(0x136)+_0x270608+'\x20files\x20in\x20Kabu?'))for(const _0x59db01 of _0x778e2a){const _0x2a3c63=a0_0x26d7da[_0x45c68c(0x127)+(_0x59db01[_0x45c68c(0x143)](0x0)['toUpperCase']()+_0x59db01[_0x45c68c(0x111)](0x1))]();for(const _0x1d8528 of _0x2a3c63){const _0x4aee3d=await a0_0x26d7da[_0x45c68c(0xed)](_0x45c68c(0x115)+_0x59db01+'s/'+_0x1d8528);try{await lockNoti('Backing\x20up...',_0x1d8528,0xbb8),await dpUploadFile(_0x1d8528,_0x4aee3d,_0x59db01);}catch(_0x461bbc){console[_0x45c68c(0xee)]('Failed\x20to\x20upload\x20file\x20'+_0x1d8528+':',_0x461bbc);}}}else console[_0x45c68c(0x142)](_0x45c68c(0x11d));}}),dropboxCloud[_0x175e9e(0x139)](_0x175e9e(0xe4),function(){var _0x43bacb=_0x175e9e;const _0x598642=localStorage[_0x43bacb(0x140)](_0x43bacb(0xe1));_0x598642===null||_0x598642===''?authorizeWithDropbox():window[_0x43bacb(0xe5)](_0x43bacb(0x123))&&(localStorage[_0x43bacb(0x144)]('uId',''),dropboxRestore[_0x43bacb(0xff)][_0x43bacb(0xea)](_0x43bacb(0xf7)),dropboxBackup[_0x43bacb(0xff)][_0x43bacb(0xea)](_0x43bacb(0xf7)),dropboxCloud[_0x43bacb(0xff)][_0x43bacb(0xea)](_0x43bacb(0xf7)));}),handleDropboxCallback();});