var a0_0x563abf=a0_0x1c07;(function(_0x4840fd,_0x4e61a8){var _0xdf1f50=a0_0x1c07,_0x116fb6=_0x4840fd();while(!![]){try{var _0x4cdd7b=parseInt(_0xdf1f50(0xc6))/0x1+parseInt(_0xdf1f50(0x10d))/0x2*(-parseInt(_0xdf1f50(0xb2))/0x3)+-parseInt(_0xdf1f50(0xfe))/0x4*(-parseInt(_0xdf1f50(0xb6))/0x5)+parseInt(_0xdf1f50(0x105))/0x6+-parseInt(_0xdf1f50(0xcc))/0x7*(-parseInt(_0xdf1f50(0xcb))/0x8)+parseInt(_0xdf1f50(0xe2))/0x9+-parseInt(_0xdf1f50(0xd4))/0xa*(parseInt(_0xdf1f50(0xe5))/0xb);if(_0x4cdd7b===_0x4e61a8)break;else _0x116fb6['push'](_0x116fb6['shift']());}catch(_0x23735c){_0x116fb6['push'](_0x116fb6['shift']());}}}(a0_0x3e53,0xec7a1));import*as a0_0x334e7c from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x563abf(0xaf),clientSecret=a0_0x563abf(0xd5);function authorizeWithDropbox(){var _0x27f0a2=a0_0x563abf,_0x536376=window['location'][_0x27f0a2(0xe3)][_0x27f0a2(0xd9)]('?')[0x0],_0x524ed7='code',_0x86b05=_0x27f0a2(0xdb),_0xf37277=_0x27f0a2(0xdf)+clientId+'&response_type='+_0x524ed7+_0x27f0a2(0xc5)+_0x86b05+_0x27f0a2(0xdd)+encodeURIComponent(_0x536376);window[_0x27f0a2(0xe4)][_0x27f0a2(0xe3)]=_0xf37277;}function handleDropboxCallback(){var _0x444072=a0_0x563abf,_0x1d35b1=getUrlParameter(_0x444072(0xf6));_0x1d35b1?(getAccessToken(_0x1d35b1),console[_0x444072(0xd3)](_0x444072(0xed),_0x1d35b1)):console['log'](_0x444072(0x108));}function getUrlParameter(_0x1ff79e){var _0x576b59=a0_0x563abf;_0x1ff79e=_0x1ff79e[_0x576b59(0xad)](/[\[]/,'\x5c[')[_0x576b59(0xad)](/[\]]/,'\x5c]');var _0x25b6b6=new RegExp(_0x576b59(0xdc)+_0x1ff79e+_0x576b59(0xca)),_0x4b3299=_0x25b6b6[_0x576b59(0xe0)](location[_0x576b59(0xf4)]);return _0x4b3299===null?'':decodeURIComponent(_0x4b3299[0x1][_0x576b59(0xad)](/\+/g,'\x20'));}function getAccessToken(_0x4045d0){var _0x33dd53=a0_0x563abf,_0x1cac5e=_0x33dd53(0xd6),_0x526cea=window[_0x33dd53(0xe4)][_0x33dd53(0xe3)][_0x33dd53(0xd9)]('?')[0x0],_0x48e07b=new XMLHttpRequest();_0x48e07b[_0x33dd53(0xde)](_0x33dd53(0xb0),_0x33dd53(0xd7)),_0x48e07b[_0x33dd53(0x10b)](_0x33dd53(0x100),_0x33dd53(0xf2)),_0x48e07b['onload']=function(){var _0x5d78dd=_0x33dd53;if(_0x48e07b[_0x5d78dd(0xf7)]===0xc8){var _0x506836=JSON[_0x5d78dd(0xee)](_0x48e07b['responseText']),_0x584d57=_0x506836[_0x5d78dd(0xf9)],_0x348893=_0x506836[_0x5d78dd(0xbf)],_0x4f4af8=_0x506836[_0x5d78dd(0xc4)];localStorage['setItem']('accessToken',_0x584d57),localStorage[_0x5d78dd(0xe9)](_0x5d78dd(0xe8),_0x348893),localStorage[_0x5d78dd(0xe9)](_0x5d78dd(0xd8),_0x4f4af8);}else console['log'](_0x5d78dd(0xae));},_0x48e07b[_0x33dd53(0xda)](_0x33dd53(0xa8)+_0x4045d0+_0x33dd53(0xcf)+_0x1cac5e+_0x33dd53(0x10e)+clientId+_0x33dd53(0xec)+clientSecret+_0x33dd53(0xdd)+encodeURIComponent(_0x526cea));}export async function dpCreateFolder(_0x35cb65){var _0x373267=a0_0x563abf;const _0xe686b=localStorage['getItem'](_0x373267(0xd8));let _0x16e143=localStorage[_0x373267(0xff)]('accessToken');const _0x5f1038='/'+_0xe686b+'/'+_0x35cb65,_0x54cd37=JSON[_0x373267(0x106)]({'path':_0x5f1038,'autorename':![]});for(let _0x3620cd=0x0;_0x3620cd<0x2;_0x3620cd++){try{const _0x2c038a=await fetch('https://api.dropboxapi.com/2/files/create_folder_v2',{'method':'POST','headers':{'Authorization':'Bearer\x20'+_0x16e143,'Content-Type':_0x373267(0xc2)},'body':_0x54cd37});if(_0x2c038a[_0x373267(0xf7)]===0x191){const _0x7c982d=await dpRefreshToken();if(!_0x7c982d)throw new Error(_0x373267(0xba));_0x16e143=localStorage['getItem'](_0x373267(0xab));continue;}if(_0x2c038a[_0x373267(0xf7)]===0x199)return{'message':_0x373267(0xbc),'path':_0x35cb65};if(!_0x2c038a['ok'])throw new Error(_0x373267(0xc1)+_0x35cb65);const _0xd3ee12=await _0x2c038a['json']();return await lockNoti('Folder\x20created','',0xbb8),_0xd3ee12;}catch(_0x20cb9d){if(_0x3620cd===0x1)throw _0x20cb9d;}}return![];}export async function dpRefreshToken(){var _0x4bd02b=a0_0x563abf;if(!localStorage[_0x4bd02b(0xff)](_0x4bd02b(0xe8)))throw'No\x20refresh\x20token';try{const _0x36becf=await fetch(_0x4bd02b(0xeb),{'method':'POST','headers':{'Content-Type':_0x4bd02b(0xf2)},'body':_0x4bd02b(0xb7)+localStorage[_0x4bd02b(0xff)](_0x4bd02b(0xe8))+_0x4bd02b(0xce)}),_0x293aa5=await _0x36becf['json']();if(!_0x293aa5[_0x4bd02b(0xd1)])return localStorage[_0x4bd02b(0xe9)](_0x4bd02b(0xab),_0x293aa5[_0x4bd02b(0xf9)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x293aa5['error_description']||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0xbd4e29){console[_0x4bd02b(0xd1)]('Error\x20while\x20refreshing\x20token:',_0xbd4e29);}return![];}export async function dpUploadFile(_0xe0ad56,_0x132d6a,_0x2ab5a8){var _0x4143ce=a0_0x563abf;const _0x22cc28=localStorage[_0x4143ce(0xff)](_0x4143ce(0xd8));var _0x4f92e1=JSON[_0x4143ce(0x106)]({'autorename':!![],'mode':_0x4143ce(0xb1),'mute':!![],'strict_conflict':![],'path':'/'+_0x22cc28+'/'+_0x2ab5a8+'/'+_0xe0ad56}),_0x3d5879=new Blob([_0x132d6a],{'type':'application/octet-stream'});for(var _0xc33009=0x0;_0xc33009<0x2;_0xc33009++){var _0x214c99=await fetch(_0x4143ce(0xfd),{'method':'POST','headers':{'Authorization':_0x4143ce(0xb9)+localStorage[_0x4143ce(0xff)]('accessToken'),'Dropbox-API-Arg':_0x4f92e1,'Content-Type':_0x4143ce(0xc3)},'body':_0x3d5879});if(_0x214c99[_0x4143ce(0xf7)]!=0xc8){if(_0x214c99[_0x4143ce(0xf7)]==0x191){var _0x836c1f=await dpRefreshToken();if(!_0x836c1f)throw _0x4143ce(0xba);continue;}else throw _0x4143ce(0x104)+_0x214c99['status'];}else{var _0xe577=await _0x214c99[_0x4143ce(0xe7)]();return console[_0x4143ce(0xd3)](_0x4143ce(0x107),_0xe0ad56),_0xe577;}}return![];}function a0_0x1c07(_0x17e5b7,_0x1f43f2){var _0x3e536d=a0_0x3e53();return a0_0x1c07=function(_0x1c0730,_0x5e67b2){_0x1c0730=_0x1c0730-0xa5;var _0x2f9d91=_0x3e536d[_0x1c0730];return _0x2f9d91;},a0_0x1c07(_0x17e5b7,_0x1f43f2);}function a0_0x3e53(){var _0x42875f=['&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','&grant_type=','downloadFileInCloud','error','save','log','640JmtyeC','nwb3dnfh09rhs31','authorization_code','https://api.dropbox.com/oauth2/token','uId','split','send','offline','[\x5c?&#]','&redirect_uri=','open','https://www.dropbox.com/oauth2/authorize?client_id=','exec','Download\x20failed\x20for\x20','16764003fegqWM','href','location','957396HYyWXn','/data/','json','refreshToken','setItem','entries','https://api.dropboxapi.com/oauth2/token','&client_secret=','Authorization\x20Code:','parse','Restoring...','addEventListener','slice','application/x-www-form-urlencoded','Do\x20you\x20want\x20to\x20restore\x20','search','name','code','status','active','access_token','map','classList','confirm','https://content.dropboxapi.com/2/files/upload','1902980YCPvdm','getItem','Content-Type','folder','Backing\x20up...','alert','Upload\x20failed,\x20unknown\x20http\x20status:\x20','10514250LlChXF','stringify','Kabu\x20storage\x20↦\x20Cloud\x20◆','Do\x20not\x20receive\x20authorization','remove','Cloud\x20login\x20required!','setRequestHeader','charAt','74UQEeCw','&client_id=','filter','Do\x20you\x20want\x20to\x20backup\x20','DOMContentLoaded','code=','push','Wait\x20a\x20little\x20bit...','accessToken','screenshot','replace','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','knh3uz2mx2hp2eu','POST','overwrite','4578GLjfNW','Restore\x20canceled\x20by\x20user.','list','No\x20files\x20found\x20to\x20restore.','10MUHiOX','refresh_token=','Do\x20you\x20want\x20to\x20logout?','Bearer\x20','Unable\x20to\x20refresh\x20token','.tag','Folder\x20already\x20exists','\x20files\x20from\x20Cloud?',',\x20status:\x20','refresh_token','length','Error\x20creating\x20folder\x20','application/json','application/octet-stream','uid','&token_access_type=','476472CaVwnS','toUpperCase','click','https://content.dropboxapi.com/2/files/download','=([^&#]*)','24hdLxlh','3622199mluZro','Cloud\x20↦\x20Kabu\x20storage\x20◆'];a0_0x3e53=function(){return _0x42875f;};return a0_0x3e53();}export async function dpDownloadFile(_0x44a367,_0x2109f1){var _0x9ac941=a0_0x563abf;const _0x15e361=localStorage[_0x9ac941(0xff)](_0x9ac941(0xd8));var _0x5bf621=JSON[_0x9ac941(0x106)]({'path':'/'+_0x15e361+'/'+_0x2109f1+'/'+_0x44a367});for(var _0x7b561f=0x0;_0x7b561f<0x2;_0x7b561f++){var _0x2cd49d=await fetch(_0x9ac941(0xc9),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x9ac941(0xab)),'Dropbox-API-Arg':_0x5bf621}});if(_0x2cd49d[_0x9ac941(0xf7)]!=0xc8){if(_0x2cd49d[_0x9ac941(0xf7)]==0x191){var _0x1e4f52=await dpRefreshToken();if(!_0x1e4f52)throw _0x9ac941(0xba);continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x2cd49d['status'];}const _0x1023fa=new File([await _0x2cd49d['blob']()],_0x44a367);return console[_0x9ac941(0xd3)](_0x9ac941(0xcd),_0x1023fa[_0x9ac941(0xf5)]),a0_0x334e7c['uploadFileInCloud'](_0x1023fa,()=>{}),_0x1023fa;}return![];}document['addEventListener'](a0_0x563abf(0xa7),function(){var _0x1f9c0c=a0_0x563abf;dropboxRestore[_0x1f9c0c(0xf0)]('click',async function(){var _0x266b53=_0x1f9c0c;await lockNoti(_0x266b53(0xaa),'',0x1388);const _0x4498c1=localStorage[_0x266b53(0xff)](_0x266b53(0xd8)),_0x5ac834=['state',_0x266b53(0xd2),_0x266b53(0xac)];if(!_0x4498c1){window['alert'](_0x266b53(0x10a));return;}let _0x3350ca=[];for(const _0x7537b5 of _0x5ac834){let _0x23132b={'path':'/'+_0x4498c1+'/'+_0x7537b5};for(let _0x4f72bb=0x0;_0x4f72bb<0x2;_0x4f72bb++){let _0x5eeb4a=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x266b53(0xb0),'headers':{'Authorization':_0x266b53(0xb9)+localStorage[_0x266b53(0xff)](_0x266b53(0xab)),'Content-Type':_0x266b53(0xc2)},'body':JSON[_0x266b53(0x106)](_0x23132b)});if(_0x5eeb4a[_0x266b53(0xf7)]===0xc8){let _0x496fd3=await _0x5eeb4a[_0x266b53(0xe7)](),_0x4afd6d=_0x496fd3[_0x266b53(0xea)][_0x266b53(0xa5)](_0x42cdb6=>_0x42cdb6[_0x266b53(0xbb)]==='file');_0x4afd6d[_0x266b53(0xc0)]>0x0&&_0x3350ca[_0x266b53(0xa9)](..._0x4afd6d[_0x266b53(0xfa)](_0x2f1a69=>({'name':_0x2f1a69[_0x266b53(0xf5)],'folder':_0x7537b5})));break;}else{if(_0x5eeb4a['status']===0x191){let _0x5aa7b5=await dpRefreshToken();if(!_0x5aa7b5)throw _0x266b53(0xba);}else{console[_0x266b53(0xd1)](_0x266b53(0xe1)+_0x7537b5+_0x266b53(0xbe)+_0x5eeb4a['status']);break;}}}}if(_0x3350ca['length']>0x0){const _0x123afa=_0x266b53(0xf3)+_0x3350ca[_0x266b53(0xc0)]+_0x266b53(0xbd);if(window[_0x266b53(0xfc)](_0x123afa))for(const _0x44290c of _0x3350ca){await lockNoti(_0x266b53(0xef),_0x44290c['name'],0xbb8),await dpDownloadFile(_0x44290c[_0x266b53(0xf5)],_0x44290c[_0x266b53(0x101)]);}else console[_0x266b53(0xd3)](_0x266b53(0xb3));}else console[_0x266b53(0xd3)](_0x266b53(0xb5));}),dropboxBackup[_0x1f9c0c(0xf0)](_0x1f9c0c(0xc8),async function(){var _0x5e8132=_0x1f9c0c;await lockNoti(_0x5e8132(0xaa),'',0x1388);const _0xb51879=localStorage[_0x5e8132(0xff)]('uId');if(_0xb51879===null||_0xb51879==='')window[_0x5e8132(0x103)](_0x5e8132(0x10a));else{const _0x1ca707=['state',_0x5e8132(0xd2),_0x5e8132(0xac)];for(const _0x3b7159 of _0x1ca707){await dpCreateFolder(_0x3b7159);}let _0x22ae48=0x0;for(const _0x2413ab of _0x1ca707){const _0x135748=a0_0x334e7c['list'+(_0x2413ab[_0x5e8132(0x10c)](0x0)[_0x5e8132(0xc7)]()+_0x2413ab[_0x5e8132(0xf1)](0x1))]();_0x22ae48+=_0x135748[_0x5e8132(0xc0)];}if(window[_0x5e8132(0xfc)](_0x5e8132(0xa6)+_0x22ae48+'\x20files\x20in\x20Kabu?'))for(const _0x457654 of _0x1ca707){const _0x50b3a3=a0_0x334e7c[_0x5e8132(0xb4)+(_0x457654[_0x5e8132(0x10c)](0x0)[_0x5e8132(0xc7)]()+_0x457654[_0x5e8132(0xf1)](0x1))]();for(const _0x52e9b5 of _0x50b3a3){const _0x5980cf=await a0_0x334e7c[_0x5e8132(0xd0)](_0x5e8132(0xe6)+_0x457654+'s/'+_0x52e9b5);try{await lockNoti(_0x5e8132(0x102),_0x52e9b5,0xbb8),await dpUploadFile(_0x52e9b5,_0x5980cf,_0x457654);}catch(_0x59d33d){console[_0x5e8132(0xd1)]('Failed\x20to\x20upload\x20file\x20'+_0x52e9b5+':',_0x59d33d);}}}else console[_0x5e8132(0xd3)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x1f9c0c(0xf0)](_0x1f9c0c(0xc8),function(){var _0x163ff0=_0x1f9c0c;const _0xeab55d=localStorage[_0x163ff0(0xff)](_0x163ff0(0xd8));_0xeab55d===null||_0xeab55d===''?authorizeWithDropbox():window[_0x163ff0(0xfc)](_0x163ff0(0xb8))&&(localStorage[_0x163ff0(0xe9)]('uId',''),dropboxRestore['classList'][_0x163ff0(0x109)]('active'),dropboxBackup[_0x163ff0(0xfb)]['remove'](_0x163ff0(0xf8)),dropboxCloud[_0x163ff0(0xfb)][_0x163ff0(0x109)](_0x163ff0(0xf8)));}),handleDropboxCallback();});