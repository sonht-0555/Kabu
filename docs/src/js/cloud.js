var a0_0x4fdaf5=a0_0x2015;(function(_0x377496,_0x5ce048){var _0x17cde7=a0_0x2015,_0x59288c=_0x377496();while(!![]){try{var _0x3c5bc3=-parseInt(_0x17cde7(0x1d5))/0x1+parseInt(_0x17cde7(0x1e9))/0x2*(-parseInt(_0x17cde7(0x219))/0x3)+parseInt(_0x17cde7(0x1ea))/0x4+-parseInt(_0x17cde7(0x1ed))/0x5*(-parseInt(_0x17cde7(0x214))/0x6)+parseInt(_0x17cde7(0x1db))/0x7+-parseInt(_0x17cde7(0x1d0))/0x8+parseInt(_0x17cde7(0x1d3))/0x9*(parseInt(_0x17cde7(0x1fc))/0xa);if(_0x3c5bc3===_0x5ce048)break;else _0x59288c['push'](_0x59288c['shift']());}catch(_0x1a0ef4){_0x59288c['push'](_0x59288c['shift']());}}}(a0_0x2ee0,0xe139e));import*as a0_0x3e42c9 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x4fdaf5(0x20c),clientSecret=a0_0x4fdaf5(0x1e5);function a0_0x2ee0(){var _0x2e4eb3=['save','getItem','folder','split','uploadFileInCloud','https://api.dropboxapi.com/2/files/create_folder_v2','error','Cloud\x20login\x20required!','knh3uz2mx2hp2eu','Authorization\x20Code:','status','code=','Failed\x20to\x20upload\x20file\x20','https://www.dropbox.com/oauth2/authorize?client_id=','href','location','354WlecPt','refresh_token=','Content-Type','entries','screenshot','228yQTQKu','alert','Restore\x20canceled\x20by\x20user.','accessToken','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','https://content.dropboxapi.com/2/files/upload','search','Error\x20creating\x20folder\x20','application/x-www-form-urlencoded','Wait\x20a\x20little\x20bit...','Do\x20you\x20want\x20to\x20logout?','Cloud\x20↦\x20Kabu\x20storage\x20◆','\x20files\x20from\x20Cloud?','access_token','addEventListener','name','length','log','Error\x20while\x20refreshing\x20token:','https://api.dropboxapi.com/oauth2/token','downloadFileInCloud','Folder\x20created','code','4673352djZBEk','refreshToken','push','278028ggUkHB','Bearer\x20','919205Urxxms','Download\x20failed\x20for\x20','onload','classList','responseText','https://api.dropboxapi.com/2/files/list_folder','8828057DYJmZU','Do\x20not\x20receive\x20authorization','No\x20refresh\x20token','&redirect_uri=','https://api.dropbox.com/oauth2/token','setItem','DOMContentLoaded','parse','replace','json','nwb3dnfh09rhs31','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','uId','remove','35418ajGVzu','5410836uMPuCt','Failed\x20to\x20refresh\x20Dropbox\x20token.','application/octet-stream','32680ZiPEbm','application/json','/data/','active','Refreshing\x20token...','confirm','uid','refresh_token','Backing\x20up...','[\x5c?&#]','&client_id=','POST','stringify','setRequestHeader','open','250LkzNdv','Unable\x20to\x20refresh\x20token','Folder\x20already\x20exists','click','overwrite','No\x20files\x20found\x20to\x20restore.','file',',\x20status:\x20'];a0_0x2ee0=function(){return _0x2e4eb3;};return a0_0x2ee0();}function authorizeWithDropbox(){var _0x50e669=a0_0x4fdaf5,_0x5bdab8=window['location'][_0x50e669(0x212)][_0x50e669(0x207)]('?')[0x0],_0x5f2613=_0x50e669(0x1cf),_0xa26953='offline',_0x1cca4e=_0x50e669(0x211)+clientId+'&response_type='+_0x5f2613+'&token_access_type='+_0xa26953+_0x50e669(0x1de)+encodeURIComponent(_0x5bdab8);window[_0x50e669(0x213)]['href']=_0x1cca4e;}function handleDropboxCallback(){var _0x209de7=a0_0x4fdaf5,_0x58cf35=getUrlParameter(_0x209de7(0x1cf));_0x58cf35?(getAccessToken(_0x58cf35),console['log'](_0x209de7(0x20d),_0x58cf35)):console[_0x209de7(0x22a)](_0x209de7(0x1dc));}function getUrlParameter(_0x347cce){var _0x188a11=a0_0x4fdaf5;_0x347cce=_0x347cce[_0x188a11(0x1e3)](/[\[]/,'\x5c[')[_0x188a11(0x1e3)](/[\]]/,'\x5c]');var _0x35e5d6=new RegExp(_0x188a11(0x1f6)+_0x347cce+'=([^&#]*)'),_0x424981=_0x35e5d6['exec'](location[_0x188a11(0x21f)]);return _0x424981===null?'':decodeURIComponent(_0x424981[0x1][_0x188a11(0x1e3)](/\+/g,'\x20'));}function getAccessToken(_0x385145){var _0x3a7922=a0_0x4fdaf5,_0x19d059='authorization_code',_0x25a04d=window[_0x3a7922(0x213)][_0x3a7922(0x212)][_0x3a7922(0x207)]('?')[0x0],_0x3a7af3=new XMLHttpRequest();_0x3a7af3[_0x3a7922(0x1fb)]('POST',_0x3a7922(0x1df)),_0x3a7af3[_0x3a7922(0x1fa)](_0x3a7922(0x216),_0x3a7922(0x221)),_0x3a7af3[_0x3a7922(0x1d7)]=function(){var _0x4329ee=_0x3a7922;if(_0x3a7af3[_0x4329ee(0x20e)]===0xc8){var _0x275349=JSON[_0x4329ee(0x1e2)](_0x3a7af3[_0x4329ee(0x1d9)]),_0x11c678=_0x275349[_0x4329ee(0x226)],_0x1c14ce=_0x275349[_0x4329ee(0x1f4)],_0x457d36=_0x275349[_0x4329ee(0x1f3)];localStorage['setItem'](_0x4329ee(0x21c),_0x11c678),localStorage['setItem']('refreshToken',_0x1c14ce),localStorage[_0x4329ee(0x1e0)](_0x4329ee(0x1e7),_0x457d36);}else console[_0x4329ee(0x22a)](_0x4329ee(0x1e6));},_0x3a7af3['send'](_0x3a7922(0x20f)+_0x385145+'&grant_type='+_0x19d059+_0x3a7922(0x1f7)+clientId+'&client_secret='+clientSecret+_0x3a7922(0x1de)+encodeURIComponent(_0x25a04d));}export async function dpCreateFolder(_0x27e249){var _0x2dd2a9=a0_0x4fdaf5;const _0x489772=localStorage[_0x2dd2a9(0x205)](_0x2dd2a9(0x1e7));let _0x5d272f=localStorage[_0x2dd2a9(0x205)]('accessToken');const _0x4906f9='/'+_0x489772+'/'+_0x27e249,_0x4a3acb=JSON['stringify']({'path':_0x4906f9,'autorename':![]});for(let _0x5d9240=0x0;_0x5d9240<0x2;_0x5d9240++){try{const _0x81c705=await fetch(_0x2dd2a9(0x209),{'method':'POST','headers':{'Authorization':_0x2dd2a9(0x1d4)+_0x5d272f,'Content-Type':'application/json'},'body':_0x4a3acb});if(_0x81c705['status']===0x191){const _0x3a0503=await dpRefreshToken();if(!_0x3a0503)throw new Error(_0x2dd2a9(0x1fd));_0x5d272f=localStorage[_0x2dd2a9(0x205)](_0x2dd2a9(0x21c));continue;}if(_0x81c705[_0x2dd2a9(0x20e)]===0x199)return{'message':_0x2dd2a9(0x1fe),'path':_0x27e249};if(!_0x81c705['ok'])throw new Error(_0x2dd2a9(0x220)+_0x27e249);const _0xbe712=await _0x81c705['json']();return await lockNoti(_0x2dd2a9(0x22e),'',0xbb8),_0xbe712;}catch(_0x168526){if(_0x5d9240===0x1)throw _0x168526;}}return![];}export async function dpRefreshToken(){var _0x3c0968=a0_0x4fdaf5;if(!localStorage['getItem'](_0x3c0968(0x1d1)))throw _0x3c0968(0x1dd);try{const _0x18e7df=await fetch(_0x3c0968(0x22c),{'method':'POST','headers':{'Content-Type':_0x3c0968(0x221)},'body':_0x3c0968(0x215)+localStorage[_0x3c0968(0x205)](_0x3c0968(0x1d1))+_0x3c0968(0x21d)}),_0x5cb68c=await _0x18e7df['json']();if(!_0x5cb68c[_0x3c0968(0x20a)])return localStorage['setItem'](_0x3c0968(0x21c),_0x5cb68c[_0x3c0968(0x226)]),await lockNoti(_0x3c0968(0x1f1),'',0xbb8),await delay(0x3e8),!![];else alert(_0x5cb68c['error_description']||_0x3c0968(0x1eb));}catch(_0x226264){console[_0x3c0968(0x20a)](_0x3c0968(0x22b),_0x226264);}return![];}export async function dpUploadFile(_0x33d503,_0xa92e8d,_0xa298c5){var _0x55ddaf=a0_0x4fdaf5;const _0x34cfbe=localStorage['getItem']('uId');var _0x22b520=JSON['stringify']({'autorename':!![],'mode':_0x55ddaf(0x200),'mute':!![],'strict_conflict':![],'path':'/'+_0x34cfbe+'/'+_0xa298c5+'/'+_0x33d503}),_0x48b3ee=new Blob([_0xa92e8d],{'type':_0x55ddaf(0x1ec)});for(var _0x34d038=0x0;_0x34d038<0x2;_0x34d038++){var _0x4eeddd=await fetch(_0x55ddaf(0x21e),{'method':'POST','headers':{'Authorization':_0x55ddaf(0x1d4)+localStorage[_0x55ddaf(0x205)](_0x55ddaf(0x21c)),'Dropbox-API-Arg':_0x22b520,'Content-Type':_0x55ddaf(0x1ec)},'body':_0x48b3ee});if(_0x4eeddd['status']!=0xc8){if(_0x4eeddd[_0x55ddaf(0x20e)]==0x191){var _0x5177a2=await dpRefreshToken();if(!_0x5177a2)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x4eeddd[_0x55ddaf(0x20e)];}else{var _0x4fd3a1=await _0x4eeddd[_0x55ddaf(0x1e4)]();return console[_0x55ddaf(0x22a)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x33d503),_0x4fd3a1;}}return![];}export async function dpDownloadFile(_0x6a1fd,_0x33c295){var _0x4a712c=a0_0x4fdaf5;const _0x45e2ab=localStorage[_0x4a712c(0x205)](_0x4a712c(0x1e7));var _0x4f7baa=JSON[_0x4a712c(0x1f9)]({'path':'/'+_0x45e2ab+'/'+_0x33c295+'/'+_0x6a1fd});for(var _0x507e30=0x0;_0x507e30<0x2;_0x507e30++){var _0x49bbe0=await fetch('https://content.dropboxapi.com/2/files/download',{'method':_0x4a712c(0x1f8),'headers':{'Authorization':_0x4a712c(0x1d4)+localStorage['getItem'](_0x4a712c(0x21c)),'Dropbox-API-Arg':_0x4f7baa}});if(_0x49bbe0[_0x4a712c(0x20e)]!=0xc8){if(_0x49bbe0[_0x4a712c(0x20e)]==0x191){var _0x4932d4=await dpRefreshToken();if(!_0x4932d4)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Download\x20failed,\x20unknown\x20http\x20status:'+_0x49bbe0[_0x4a712c(0x20e)];}const _0x587212=new File([await _0x49bbe0['blob']()],_0x6a1fd);return console['log'](_0x4a712c(0x224),_0x587212[_0x4a712c(0x228)]),a0_0x3e42c9[_0x4a712c(0x208)](_0x587212,()=>{}),_0x587212;}return![];}function a0_0x2015(_0x249335,_0x1b2f7b){var _0x2ee0fa=a0_0x2ee0();return a0_0x2015=function(_0x201521,_0x1510f3){_0x201521=_0x201521-0x1cf;var _0x2a438e=_0x2ee0fa[_0x201521];return _0x2a438e;},a0_0x2015(_0x249335,_0x1b2f7b);}document[a0_0x4fdaf5(0x227)](a0_0x4fdaf5(0x1e1),function(){var _0x5ec119=a0_0x4fdaf5;dropboxRestore[_0x5ec119(0x227)](_0x5ec119(0x1ff),async function(){var _0x4ac69f=_0x5ec119;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x2d7297=localStorage[_0x4ac69f(0x205)](_0x4ac69f(0x1e7)),_0xd91337=['state',_0x4ac69f(0x204),_0x4ac69f(0x218)];if(!_0x2d7297){window[_0x4ac69f(0x21a)]('Cloud\x20login\x20required!');return;}let _0x1e5a06=[];for(const _0x31faab of _0xd91337){let _0x34c086={'path':'/'+_0x2d7297+'/'+_0x31faab};for(let _0x15c90c=0x0;_0x15c90c<0x2;_0x15c90c++){let _0x51ed20=await fetch(_0x4ac69f(0x1da),{'method':_0x4ac69f(0x1f8),'headers':{'Authorization':_0x4ac69f(0x1d4)+localStorage[_0x4ac69f(0x205)](_0x4ac69f(0x21c)),'Content-Type':_0x4ac69f(0x1ee)},'body':JSON['stringify'](_0x34c086)});if(_0x51ed20[_0x4ac69f(0x20e)]===0xc8){let _0x1d32e8=await _0x51ed20[_0x4ac69f(0x1e4)](),_0x53ec7b=_0x1d32e8[_0x4ac69f(0x217)]['filter'](_0x1df3ff=>_0x1df3ff['.tag']===_0x4ac69f(0x202));_0x53ec7b['length']>0x0&&_0x1e5a06[_0x4ac69f(0x1d2)](..._0x53ec7b['map'](_0x389630=>({'name':_0x389630[_0x4ac69f(0x228)],'folder':_0x31faab})));break;}else{if(_0x51ed20[_0x4ac69f(0x20e)]===0x191){let _0xb2ea5b=await dpRefreshToken();if(!_0xb2ea5b)throw _0x4ac69f(0x1fd);}else{console[_0x4ac69f(0x20a)](_0x4ac69f(0x1d6)+_0x31faab+_0x4ac69f(0x203)+_0x51ed20[_0x4ac69f(0x20e)]);break;}}}}if(_0x1e5a06[_0x4ac69f(0x229)]>0x0){const _0x4a5129='Do\x20you\x20want\x20to\x20restore\x20'+_0x1e5a06[_0x4ac69f(0x229)]+_0x4ac69f(0x225);if(window['confirm'](_0x4a5129))for(const _0x429ac3 of _0x1e5a06){await lockNoti('Restoring...',_0x429ac3['name'],0xbb8),await dpDownloadFile(_0x429ac3['name'],_0x429ac3[_0x4ac69f(0x206)]);}else console[_0x4ac69f(0x22a)](_0x4ac69f(0x21b));}else console[_0x4ac69f(0x22a)](_0x4ac69f(0x201));}),dropboxBackup[_0x5ec119(0x227)](_0x5ec119(0x1ff),async function(){var _0x391bbc=_0x5ec119;await lockNoti(_0x391bbc(0x222),'',0x1388);const _0x115d10=localStorage[_0x391bbc(0x205)]('uId');if(_0x115d10===null||_0x115d10==='')window['alert'](_0x391bbc(0x20b));else{const _0x1c2d5b=['state',_0x391bbc(0x204),_0x391bbc(0x218)];for(const _0xc792a6 of _0x1c2d5b){await dpCreateFolder(_0xc792a6);}let _0x2a291d=0x0;for(const _0x5cec61 of _0x1c2d5b){const _0x2a8f82=a0_0x3e42c9['listFiles'](_0x5cec61+'s');_0x2a291d+=_0x2a8f82[_0x391bbc(0x229)];}if(window[_0x391bbc(0x1f2)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x2a291d+'\x20files\x20in\x20Kabu?'))for(const _0x290970 of _0x1c2d5b){const _0x3cced5=a0_0x3e42c9['listFiles'](_0x290970+'s');for(const _0x4f071f of _0x3cced5){const _0x9ef82f=await a0_0x3e42c9[_0x391bbc(0x22d)](_0x391bbc(0x1ef)+_0x290970+'s/'+_0x4f071f);try{await lockNoti(_0x391bbc(0x1f5),_0x4f071f,0xbb8),await dpUploadFile(_0x4f071f,_0x9ef82f,_0x290970);}catch(_0x4bed9c){console[_0x391bbc(0x20a)](_0x391bbc(0x210)+_0x4f071f+':',_0x4bed9c);}}}else console[_0x391bbc(0x22a)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x5ec119(0x227)]('click',function(){var _0x3385a7=_0x5ec119;const _0x331c3f=localStorage[_0x3385a7(0x205)]('uId');_0x331c3f===null||_0x331c3f===''?authorizeWithDropbox():window[_0x3385a7(0x1f2)](_0x3385a7(0x223))&&(localStorage[_0x3385a7(0x1e0)](_0x3385a7(0x1e7),''),dropboxRestore[_0x3385a7(0x1d8)][_0x3385a7(0x1e8)](_0x3385a7(0x1f0)),dropboxBackup[_0x3385a7(0x1d8)][_0x3385a7(0x1e8)]('active'),dropboxCloud[_0x3385a7(0x1d8)]['remove'](_0x3385a7(0x1f0)));}),handleDropboxCallback();});