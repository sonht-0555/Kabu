var a0_0x38ea73=a0_0x1a00;function a0_0x2c42(){var _0x4ff386=['Refreshing\x20token...','Download\x20failed\x20for\x20','Failed\x20to\x20upload\x20file\x20','confirm','length','open','4330bCSsuh','[\x5c?&#]','parse','error_description','4365369QMsRax','Do\x20not\x20receive\x20authorization','file','setItem','\x20files\x20in\x20Kabu?','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','Do\x20you\x20want\x20to\x20restore\x20','&redirect_uri=','Authorization\x20Code:','https://api.dropboxapi.com/oauth2/token','split','downloadFileInCloud','knh3uz2mx2hp2eu','Restore\x20canceled\x20by\x20user.','refreshToken','remove','addEventListener','code','22eKWFAx','&response_type=','active','\x20files\x20from\x20Cloud?','accessToken','5406680OpVDBX','Kabu\x20storage\x20↦\x20Cloud\x20◆','Bearer\x20','name','uploadFileInCloud','DOMContentLoaded','save','&client_secret=','href','state','stringify','location','336IThksz','status','https://www.dropbox.com/oauth2/authorize?client_id=','uId','588652MutlIx','exec','https://api.dropbox.com/oauth2/token',',\x20status:\x20','Content-Type','Download\x20failed,\x20unknown\x20http\x20status:','json','log','map','alert','=([^&#]*)','&grant_type=','blob','No\x20files\x20found\x20to\x20restore.','https://api.dropboxapi.com/2/files/create_folder_v2','https://api.dropboxapi.com/2/files/list_folder','Unable\x20to\x20refresh\x20token','25mFkyjr','offline','replace','send','233412pBKTeo','Cloud\x20↦\x20Kabu\x20storage\x20◆','access_token','https://content.dropboxapi.com/2/files/upload','Folder\x20created','Restoring...','https://content.dropboxapi.com/2/files/download','.tag','Do\x20you\x20want\x20to\x20backup\x20','Backing\x20up...','4015CdWiPC','application/x-www-form-urlencoded','classList','214844iJLjDc','No\x20refresh\x20token','uid','POST','/data/','authorization_code','2439TEcULt','click','error','nwb3dnfh09rhs31','push','setRequestHeader','Folder\x20already\x20exists','154562pAqcPn','listFiles','folder','getItem','entries','application/octet-stream','screenshot','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token'];a0_0x2c42=function(){return _0x4ff386;};return a0_0x2c42();}(function(_0x310953,_0x13deee){var _0x2d4339=a0_0x1a00,_0x59a016=_0x310953();while(!![]){try{var _0x287c83=-parseInt(_0x2d4339(0x23f))/0x1*(parseInt(_0x2d4339(0x1fb))/0x2)+-parseInt(_0x2d4339(0x251))/0x3+parseInt(_0x2d4339(0x210))/0x4*(-parseInt(_0x2d4339(0x221))/0x5)+-parseInt(_0x2d4339(0x20c))/0x6*(parseInt(_0x2d4339(0x232))/0x7)+-parseInt(_0x2d4339(0x200))/0x8+parseInt(_0x2d4339(0x238))/0x9*(parseInt(_0x2d4339(0x24d))/0xa)+parseInt(_0x2d4339(0x22f))/0xb*(parseInt(_0x2d4339(0x225))/0xc);if(_0x287c83===_0x13deee)break;else _0x59a016['push'](_0x59a016['shift']());}catch(_0x4d62bd){_0x59a016['push'](_0x59a016['shift']());}}}(a0_0x2c42,0xe35b3));import*as a0_0x93d3da from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x38ea73(0x1f5),clientSecret=a0_0x38ea73(0x23b);function authorizeWithDropbox(){var _0x3ffd65=a0_0x38ea73,_0x4b3276=window[_0x3ffd65(0x20b)][_0x3ffd65(0x208)][_0x3ffd65(0x1f3)]('?')[0x0],_0x2c8e82=_0x3ffd65(0x1fa),_0x2d1d32=_0x3ffd65(0x222),_0x4c0e93=_0x3ffd65(0x20e)+clientId+_0x3ffd65(0x1fc)+_0x2c8e82+'&token_access_type='+_0x2d1d32+_0x3ffd65(0x1f0)+encodeURIComponent(_0x4b3276);window[_0x3ffd65(0x20b)][_0x3ffd65(0x208)]=_0x4c0e93;}function handleDropboxCallback(){var _0x2df517=a0_0x38ea73,_0x3ed812=getUrlParameter(_0x2df517(0x1fa));_0x3ed812?(getAccessToken(_0x3ed812),console['log'](_0x2df517(0x1f1),_0x3ed812)):console[_0x2df517(0x217)](_0x2df517(0x252));}function getUrlParameter(_0x2705d2){var _0xf63970=a0_0x38ea73;_0x2705d2=_0x2705d2[_0xf63970(0x223)](/[\[]/,'\x5c[')[_0xf63970(0x223)](/[\]]/,'\x5c]');var _0x345828=new RegExp(_0xf63970(0x24e)+_0x2705d2+_0xf63970(0x21a)),_0x4b250d=_0x345828[_0xf63970(0x211)](location['search']);return _0x4b250d===null?'':decodeURIComponent(_0x4b250d[0x1][_0xf63970(0x223)](/\+/g,'\x20'));}function getAccessToken(_0x436794){var _0x1f89c6=a0_0x38ea73,_0x6c664=_0x1f89c6(0x237),_0x1fc942=window[_0x1f89c6(0x20b)][_0x1f89c6(0x208)][_0x1f89c6(0x1f3)]('?')[0x0],_0x231c3b=new XMLHttpRequest();_0x231c3b[_0x1f89c6(0x24c)](_0x1f89c6(0x235),_0x1f89c6(0x212)),_0x231c3b[_0x1f89c6(0x23d)](_0x1f89c6(0x214),_0x1f89c6(0x230)),_0x231c3b['onload']=function(){var _0x474175=_0x1f89c6;if(_0x231c3b[_0x474175(0x20d)]===0xc8){var _0x499f0a=JSON[_0x474175(0x24f)](_0x231c3b['responseText']),_0x4c2b85=_0x499f0a[_0x474175(0x227)],_0x1af53d=_0x499f0a['refresh_token'],_0x565580=_0x499f0a[_0x474175(0x234)];localStorage[_0x474175(0x1ec)]('accessToken',_0x4c2b85),localStorage[_0x474175(0x1ec)](_0x474175(0x1f7),_0x1af53d),localStorage[_0x474175(0x1ec)](_0x474175(0x20f),_0x565580);}else console[_0x474175(0x217)](_0x474175(0x246));},_0x231c3b[_0x1f89c6(0x224)]('code='+_0x436794+_0x1f89c6(0x21b)+_0x6c664+'&client_id='+clientId+_0x1f89c6(0x207)+clientSecret+_0x1f89c6(0x1f0)+encodeURIComponent(_0x1fc942));}function a0_0x1a00(_0x532f8f,_0x5bf322){var _0x2c4202=a0_0x2c42();return a0_0x1a00=function(_0x1a0084,_0x4e2fde){_0x1a0084=_0x1a0084-0x1eb;var _0x575cff=_0x2c4202[_0x1a0084];return _0x575cff;},a0_0x1a00(_0x532f8f,_0x5bf322);}export async function dpCreateFolder(_0x2a57a7){var _0x56c3e9=a0_0x38ea73;const _0x20f16b=localStorage[_0x56c3e9(0x242)](_0x56c3e9(0x20f));let _0x42b4ce=localStorage[_0x56c3e9(0x242)](_0x56c3e9(0x1ff));const _0x37a569='/'+_0x20f16b+'/'+_0x2a57a7,_0x196636=JSON[_0x56c3e9(0x20a)]({'path':_0x37a569,'autorename':![]});for(let _0x515df1=0x0;_0x515df1<0x2;_0x515df1++){try{const _0x3c328b=await fetch(_0x56c3e9(0x21e),{'method':_0x56c3e9(0x235),'headers':{'Authorization':_0x56c3e9(0x202)+_0x42b4ce,'Content-Type':'application/json'},'body':_0x196636});if(_0x3c328b['status']===0x191){const _0x5675b1=await dpRefreshToken();if(!_0x5675b1)throw new Error(_0x56c3e9(0x220));_0x42b4ce=localStorage[_0x56c3e9(0x242)](_0x56c3e9(0x1ff));continue;}if(_0x3c328b['status']===0x199)return{'message':_0x56c3e9(0x23e),'path':_0x2a57a7};if(!_0x3c328b['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x2a57a7);const _0x46e519=await _0x3c328b[_0x56c3e9(0x216)]();return await lockNoti(_0x56c3e9(0x229),'',0xbb8),_0x46e519;}catch(_0x11ee06){if(_0x515df1===0x1)throw _0x11ee06;}}return![];}export async function dpRefreshToken(){var _0x343929=a0_0x38ea73;if(!localStorage['getItem']('refreshToken'))throw _0x343929(0x233);try{const _0xf98d52=await fetch(_0x343929(0x1f2),{'method':_0x343929(0x235),'headers':{'Content-Type':_0x343929(0x230)},'body':'refresh_token='+localStorage[_0x343929(0x242)](_0x343929(0x1f7))+_0x343929(0x1ee)}),_0x1db6e9=await _0xf98d52[_0x343929(0x216)]();if(!_0x1db6e9[_0x343929(0x23a)])return localStorage[_0x343929(0x1ec)](_0x343929(0x1ff),_0x1db6e9[_0x343929(0x227)]),await lockNoti(_0x343929(0x247),'',0xbb8),await delay(0x3e8),!![];else alert(_0x1db6e9[_0x343929(0x250)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x2acb4f){console[_0x343929(0x23a)]('Error\x20while\x20refreshing\x20token:',_0x2acb4f);}return![];}export async function dpUploadFile(_0x2d7022,_0x5aa92c,_0x14e5a1){var _0x480a17=a0_0x38ea73;const _0x45f456=localStorage[_0x480a17(0x242)](_0x480a17(0x20f));var _0x219d0c=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x45f456+'/'+_0x14e5a1+'/'+_0x2d7022}),_0x360e30=new Blob([_0x5aa92c],{'type':_0x480a17(0x244)});for(var _0x4ddb02=0x0;_0x4ddb02<0x2;_0x4ddb02++){var _0x92b99f=await fetch(_0x480a17(0x228),{'method':'POST','headers':{'Authorization':_0x480a17(0x202)+localStorage[_0x480a17(0x242)](_0x480a17(0x1ff)),'Dropbox-API-Arg':_0x219d0c,'Content-Type':_0x480a17(0x244)},'body':_0x360e30});if(_0x92b99f['status']!=0xc8){if(_0x92b99f['status']==0x191){var _0x16f417=await dpRefreshToken();if(!_0x16f417)throw _0x480a17(0x220);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x92b99f[_0x480a17(0x20d)];}else{var _0xe0eeac=await _0x92b99f[_0x480a17(0x216)]();return console['log'](_0x480a17(0x201),_0x2d7022),_0xe0eeac;}}return![];}export async function dpDownloadFile(_0x421a82,_0x5d9900){var _0x5bdf33=a0_0x38ea73;const _0x1d9be1=localStorage[_0x5bdf33(0x242)](_0x5bdf33(0x20f));var _0x20266f=JSON[_0x5bdf33(0x20a)]({'path':'/'+_0x1d9be1+'/'+_0x5d9900+'/'+_0x421a82});for(var _0x1de0fa=0x0;_0x1de0fa<0x2;_0x1de0fa++){var _0x58cc28=await fetch(_0x5bdf33(0x22b),{'method':'POST','headers':{'Authorization':_0x5bdf33(0x202)+localStorage[_0x5bdf33(0x242)](_0x5bdf33(0x1ff)),'Dropbox-API-Arg':_0x20266f}});if(_0x58cc28[_0x5bdf33(0x20d)]!=0xc8){if(_0x58cc28['status']==0x191){var _0x1857d8=await dpRefreshToken();if(!_0x1857d8)throw _0x5bdf33(0x220);continue;}else throw _0x5bdf33(0x215)+_0x58cc28[_0x5bdf33(0x20d)];}const _0x370888=new File([await _0x58cc28[_0x5bdf33(0x21c)]()],_0x421a82);return console[_0x5bdf33(0x217)](_0x5bdf33(0x226),_0x370888[_0x5bdf33(0x203)]),a0_0x93d3da[_0x5bdf33(0x204)](_0x370888,()=>{}),_0x370888;}return![];}document['addEventListener'](a0_0x38ea73(0x205),function(){var _0x96718=a0_0x38ea73;dropboxRestore[_0x96718(0x1f9)](_0x96718(0x239),async function(){var _0x4958b9=_0x96718;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x25fdaf=localStorage['getItem'](_0x4958b9(0x20f)),_0x4b1fc3=[_0x4958b9(0x209),_0x4958b9(0x206),'screenshot'];if(!_0x25fdaf){window[_0x4958b9(0x219)]('Cloud\x20login\x20required!');return;}let _0x1069f6=[];for(const _0xa0e2bb of _0x4b1fc3){let _0x57aaa0={'path':'/'+_0x25fdaf+'/'+_0xa0e2bb};for(let _0x342ebc=0x0;_0x342ebc<0x2;_0x342ebc++){let _0x33b18e=await fetch(_0x4958b9(0x21f),{'method':'POST','headers':{'Authorization':_0x4958b9(0x202)+localStorage[_0x4958b9(0x242)](_0x4958b9(0x1ff)),'Content-Type':'application/json'},'body':JSON[_0x4958b9(0x20a)](_0x57aaa0)});if(_0x33b18e[_0x4958b9(0x20d)]===0xc8){let _0x504076=await _0x33b18e[_0x4958b9(0x216)](),_0x17815d=_0x504076[_0x4958b9(0x243)]['filter'](_0x40b38d=>_0x40b38d[_0x4958b9(0x22c)]===_0x4958b9(0x1eb));_0x17815d[_0x4958b9(0x24b)]>0x0&&_0x1069f6[_0x4958b9(0x23c)](..._0x17815d[_0x4958b9(0x218)](_0x37d33e=>({'name':_0x37d33e[_0x4958b9(0x203)],'folder':_0xa0e2bb})));break;}else{if(_0x33b18e['status']===0x191){let _0x2b42bb=await dpRefreshToken();if(!_0x2b42bb)throw _0x4958b9(0x220);}else{console['error'](_0x4958b9(0x248)+_0xa0e2bb+_0x4958b9(0x213)+_0x33b18e[_0x4958b9(0x20d)]);break;}}}}if(_0x1069f6[_0x4958b9(0x24b)]>0x0){const _0x10761d=_0x4958b9(0x1ef)+_0x1069f6[_0x4958b9(0x24b)]+_0x4958b9(0x1fe);if(window[_0x4958b9(0x24a)](_0x10761d))for(const _0x5ec208 of _0x1069f6){await lockNoti(_0x4958b9(0x22a),_0x5ec208[_0x4958b9(0x203)],0xbb8),await dpDownloadFile(_0x5ec208[_0x4958b9(0x203)],_0x5ec208[_0x4958b9(0x241)]);}else console[_0x4958b9(0x217)](_0x4958b9(0x1f6));}else console[_0x4958b9(0x217)](_0x4958b9(0x21d));}),dropboxBackup[_0x96718(0x1f9)](_0x96718(0x239),async function(){var _0x5ae4b4=_0x96718;await lockNoti('Wait\x20a\x20little\x20bit...','',0x1388);const _0x54cbdb=localStorage[_0x5ae4b4(0x242)](_0x5ae4b4(0x20f));if(_0x54cbdb===null||_0x54cbdb==='')window[_0x5ae4b4(0x219)]('Cloud\x20login\x20required!');else{const _0x2c3a20=['state',_0x5ae4b4(0x206),_0x5ae4b4(0x245)];for(const _0x2f3ef3 of _0x2c3a20){await dpCreateFolder(_0x2f3ef3);}let _0x3d9664=0x0;for(const _0x238c15 of _0x2c3a20){const _0x688afc=a0_0x93d3da[_0x5ae4b4(0x240)](_0x238c15+'s');_0x3d9664+=_0x688afc[_0x5ae4b4(0x24b)];}if(window['confirm'](_0x5ae4b4(0x22d)+_0x3d9664+_0x5ae4b4(0x1ed)))for(const _0x14e9e9 of _0x2c3a20){const _0x2daa4d=a0_0x93d3da['listFiles'](_0x14e9e9+'s');for(const _0x468167 of _0x2daa4d){const _0x4352e0=await a0_0x93d3da[_0x5ae4b4(0x1f4)](_0x5ae4b4(0x236)+_0x14e9e9+'s/'+_0x468167);try{await lockNoti(_0x5ae4b4(0x22e),_0x468167,0xbb8),await dpUploadFile(_0x468167,_0x4352e0,_0x14e9e9);}catch(_0x146538){console[_0x5ae4b4(0x23a)](_0x5ae4b4(0x249)+_0x468167+':',_0x146538);}}}else console[_0x5ae4b4(0x217)](_0x5ae4b4(0x1f6));}}),dropboxCloud[_0x96718(0x1f9)](_0x96718(0x239),function(){var _0xf37e8e=_0x96718;const _0x475921=localStorage['getItem'](_0xf37e8e(0x20f));_0x475921===null||_0x475921===''?authorizeWithDropbox():window[_0xf37e8e(0x24a)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0xf37e8e(0x1ec)](_0xf37e8e(0x20f),''),dropboxRestore[_0xf37e8e(0x231)][_0xf37e8e(0x1f8)](_0xf37e8e(0x1fd)),dropboxBackup[_0xf37e8e(0x231)]['remove'](_0xf37e8e(0x1fd)),dropboxCloud[_0xf37e8e(0x231)]['remove'](_0xf37e8e(0x1fd)));}),handleDropboxCallback();});