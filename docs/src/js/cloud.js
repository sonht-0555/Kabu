var a0_0x44e2c3=a0_0x5c45;function a0_0x414d(){var _0x338571=['uId','blob','accessToken','Restore\x20canceled\x20by\x20user.','/data/','filter','href','Do\x20not\x20receive\x20authorization','classList','203jLrJjg','https://api.dropboxapi.com/2/files/create_folder_v2','access_token','getItem','nwb3dnfh09rhs31','&client_secret=','&client_id=','&response_type=','671ixuUZb','screenshot','application/octet-stream','error','remove','setRequestHeader','overwrite','232lWCTjT','https://content.dropboxapi.com/2/files/download','Do\x20you\x20want\x20to\x20logout?','open','269652FGnnRs',',\x20status:\x20','Refreshing\x20token...','length','12199010QZXauJ','parse','40HTfRAG','refreshToken','listFiles','https://www.dropbox.com/oauth2/authorize?client_id=','Unable\x20to\x20refresh\x20token','6182604Kxyjuo','json','DOMContentLoaded','Bearer\x20','https://api.dropboxapi.com/oauth2/token','Wait\x20a\x20little\x20bit...','Content-Type','click','uploadFileInCloud','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','1956315VQyyPJ','Cloud\x20login\x20required!','alert','Authorization\x20Code:','folder','state','code=','status','map','refresh_token=','confirm','push','POST','https://api.dropbox.com/oauth2/token','&redirect_uri=','9222zHQSaI','location','9lwFmYJ','save','&grant_type=','Folder\x20already\x20exists','https://api.dropboxapi.com/2/files/list_folder','Failed\x20to\x20upload\x20file\x20','error_description','active','Download\x20failed,\x20unknown\x20http\x20status:','[\x5c?&#]','offline','name','setItem','29195farVcl','No\x20refresh\x20token','https://content.dropboxapi.com/2/files/upload','log','Upload\x20failed,\x20unknown\x20http\x20status:\x20','stringify','addEventListener','code','exec','152936OHMzdr','authorization_code','replace','=([^&#]*)','onload','Do\x20you\x20want\x20to\x20backup\x20','application/json','search','Error\x20creating\x20folder\x20'];a0_0x414d=function(){return _0x338571;};return a0_0x414d();}(function(_0x2d8840,_0x79d38){var _0x2460b7=a0_0x5c45,_0x5f2dbc=_0x2d8840();while(!![]){try{var _0x1f2147=parseInt(_0x2460b7(0xc5))/0x1*(parseInt(_0x2460b7(0x9d))/0x2)+-parseInt(_0x2460b7(0xb6))/0x3+-parseInt(_0x2460b7(0xa7))/0x4*(-parseInt(_0x2460b7(0x73))/0x5)+parseInt(_0x2460b7(0xac))/0x6+-parseInt(_0x2460b7(0x8e))/0x7*(parseInt(_0x2460b7(0x7c))/0x8)+-parseInt(_0x2460b7(0xc7))/0x9*(-parseInt(_0x2460b7(0xa5))/0xa)+parseInt(_0x2460b7(0x96))/0xb*(-parseInt(_0x2460b7(0xa1))/0xc);if(_0x1f2147===_0x79d38)break;else _0x5f2dbc['push'](_0x5f2dbc['shift']());}catch(_0x13975e){_0x5f2dbc['push'](_0x5f2dbc['shift']());}}}(a0_0x414d,0xc39e0));import*as a0_0x1c07e7 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x44e2c3(0x92);function authorizeWithDropbox(){var _0x1ce624=a0_0x44e2c3,_0x44ed30=window[_0x1ce624(0xc6)]['href']['split']('?')[0x0],_0x52d889=_0x1ce624(0x7a),_0xff12f9=_0x1ce624(0x70),_0x469312=_0x1ce624(0xaa)+clientId+_0x1ce624(0x95)+_0x52d889+'&token_access_type='+_0xff12f9+_0x1ce624(0xc4)+encodeURIComponent(_0x44ed30);window[_0x1ce624(0xc6)][_0x1ce624(0x8b)]=_0x469312;}function handleDropboxCallback(){var _0xdfe2ed=a0_0x44e2c3,_0x40ac37=getUrlParameter(_0xdfe2ed(0x7a));_0x40ac37?(getAccessToken(_0x40ac37),console[_0xdfe2ed(0x76)](_0xdfe2ed(0xb9),_0x40ac37)):console['log'](_0xdfe2ed(0x8c));}function getUrlParameter(_0x2cb970){var _0x9e6ac1=a0_0x44e2c3;_0x2cb970=_0x2cb970[_0x9e6ac1(0x7e)](/[\[]/,'\x5c[')[_0x9e6ac1(0x7e)](/[\]]/,'\x5c]');var _0x35e8a4=new RegExp(_0x9e6ac1(0x6f)+_0x2cb970+_0x9e6ac1(0x7f)),_0x5870a7=_0x35e8a4[_0x9e6ac1(0x7b)](location[_0x9e6ac1(0x83)]);return _0x5870a7===null?'':decodeURIComponent(_0x5870a7[0x1][_0x9e6ac1(0x7e)](/\+/g,'\x20'));}function getAccessToken(_0x66dd09){var _0x5082f7=a0_0x44e2c3,_0x1c9332=_0x5082f7(0x7d),_0x3e580b=window[_0x5082f7(0xc6)][_0x5082f7(0x8b)]['split']('?')[0x0],_0xd4e696=new XMLHttpRequest();_0xd4e696[_0x5082f7(0xa0)](_0x5082f7(0xc2),_0x5082f7(0xc3)),_0xd4e696[_0x5082f7(0x9b)](_0x5082f7(0xb2),'application/x-www-form-urlencoded'),_0xd4e696[_0x5082f7(0x80)]=function(){var _0x5c6cca=_0x5082f7;if(_0xd4e696['status']===0xc8){var _0x43351e=JSON[_0x5c6cca(0xa6)](_0xd4e696['responseText']),_0x1b4dc5=_0x43351e[_0x5c6cca(0x90)],_0x1d1b31=_0x43351e['refresh_token'],_0x48ceb0=_0x43351e['uid'];localStorage[_0x5c6cca(0x72)]('accessToken',_0x1b4dc5),localStorage[_0x5c6cca(0x72)](_0x5c6cca(0xa8),_0x1d1b31),localStorage[_0x5c6cca(0x72)](_0x5c6cca(0x85),_0x48ceb0);}else console[_0x5c6cca(0x76)](_0x5c6cca(0xb5));},_0xd4e696['send'](_0x5082f7(0xbc)+_0x66dd09+_0x5082f7(0xc9)+_0x1c9332+_0x5082f7(0x94)+clientId+_0x5082f7(0x93)+clientSecret+_0x5082f7(0xc4)+encodeURIComponent(_0x3e580b));}export async function dpCreateFolder(_0x5aef9f){var _0x43fc32=a0_0x44e2c3;const _0x51361b=localStorage['getItem'](_0x43fc32(0x85));let _0x1d4e30=localStorage[_0x43fc32(0x91)]('accessToken');const _0x4e9485='/'+_0x51361b+'/'+_0x5aef9f,_0x1def1b=JSON[_0x43fc32(0x78)]({'path':_0x4e9485,'autorename':![]});for(let _0x30db4c=0x0;_0x30db4c<0x2;_0x30db4c++){try{const _0x38741b=await fetch(_0x43fc32(0x8f),{'method':_0x43fc32(0xc2),'headers':{'Authorization':_0x43fc32(0xaf)+_0x1d4e30,'Content-Type':_0x43fc32(0x82)},'body':_0x1def1b});if(_0x38741b[_0x43fc32(0xbd)]===0x191){const _0x35251b=await dpRefreshToken();if(!_0x35251b)throw new Error('Unable\x20to\x20refresh\x20token');_0x1d4e30=localStorage[_0x43fc32(0x91)]('accessToken');continue;}if(_0x38741b[_0x43fc32(0xbd)]===0x199)return{'message':_0x43fc32(0xca),'path':_0x5aef9f};if(!_0x38741b['ok'])throw new Error(_0x43fc32(0x84)+_0x5aef9f);const _0xe15fa2=await _0x38741b[_0x43fc32(0xad)]();return await lockNoti('Folder\x20created','',0xbb8),_0xe15fa2;}catch(_0x473100){if(_0x30db4c===0x1)throw _0x473100;}}return![];}export async function dpRefreshToken(){var _0x23e9d9=a0_0x44e2c3;if(!localStorage[_0x23e9d9(0x91)]('refreshToken'))throw _0x23e9d9(0x74);try{const _0xbbb00f=await fetch(_0x23e9d9(0xb0),{'method':_0x23e9d9(0xc2),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x23e9d9(0xbf)+localStorage[_0x23e9d9(0x91)](_0x23e9d9(0xa8))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x39359d=await _0xbbb00f[_0x23e9d9(0xad)]();if(!_0x39359d['error'])return localStorage[_0x23e9d9(0x72)](_0x23e9d9(0x87),_0x39359d[_0x23e9d9(0x90)]),await lockNoti(_0x23e9d9(0xa3),'',0xbb8),await delay(0x3e8),!![];else alert(_0x39359d[_0x23e9d9(0x6c)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x319f40){console['error']('Error\x20while\x20refreshing\x20token:',_0x319f40);}return![];}export async function dpUploadFile(_0x5ef310,_0x4c29a1,_0x26225d){var _0xe15ddd=a0_0x44e2c3;const _0x565a7d=localStorage['getItem']('uId');var _0x48f279=JSON[_0xe15ddd(0x78)]({'autorename':!![],'mode':_0xe15ddd(0x9c),'mute':!![],'strict_conflict':![],'path':'/'+_0x565a7d+'/'+_0x26225d+'/'+_0x5ef310}),_0x4bacdb=new Blob([_0x4c29a1],{'type':'application/octet-stream'});for(var _0x584ce9=0x0;_0x584ce9<0x2;_0x584ce9++){var _0x47ea19=await fetch(_0xe15ddd(0x75),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0xe15ddd(0x91)]('accessToken'),'Dropbox-API-Arg':_0x48f279,'Content-Type':_0xe15ddd(0x98)},'body':_0x4bacdb});if(_0x47ea19['status']!=0xc8){if(_0x47ea19[_0xe15ddd(0xbd)]==0x191){var _0x1cf1cd=await dpRefreshToken();if(!_0x1cf1cd)throw _0xe15ddd(0xab);continue;}else throw _0xe15ddd(0x77)+_0x47ea19[_0xe15ddd(0xbd)];}else{var _0x48c7da=await _0x47ea19['json']();return console[_0xe15ddd(0x76)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x5ef310),_0x48c7da;}}return![];}export async function dpDownloadFile(_0x37f7e7,_0x5ca2f4){var _0x28b5d1=a0_0x44e2c3;const _0x2a67d6=localStorage[_0x28b5d1(0x91)](_0x28b5d1(0x85));var _0x104214=JSON[_0x28b5d1(0x78)]({'path':'/'+_0x2a67d6+'/'+_0x5ca2f4+'/'+_0x37f7e7});for(var _0x1c3a1b=0x0;_0x1c3a1b<0x2;_0x1c3a1b++){var _0xe785e6=await fetch(_0x28b5d1(0x9e),{'method':_0x28b5d1(0xc2),'headers':{'Authorization':_0x28b5d1(0xaf)+localStorage[_0x28b5d1(0x91)](_0x28b5d1(0x87)),'Dropbox-API-Arg':_0x104214}});if(_0xe785e6['status']!=0xc8){if(_0xe785e6[_0x28b5d1(0xbd)]==0x191){var _0x56a7fc=await dpRefreshToken();if(!_0x56a7fc)throw _0x28b5d1(0xab);continue;}else throw _0x28b5d1(0x6e)+_0xe785e6['status'];}const _0x3f86b2=new File([await _0xe785e6[_0x28b5d1(0x86)]()],_0x37f7e7);return console[_0x28b5d1(0x76)]('Cloud\x20↦\x20Kabu\x20storage\x20◆',_0x3f86b2['name']),a0_0x1c07e7[_0x28b5d1(0xb4)](_0x3f86b2,()=>{}),_0x3f86b2;}return![];}function a0_0x5c45(_0x8dbb54,_0xd087fe){var _0x414dcf=a0_0x414d();return a0_0x5c45=function(_0x5c4577,_0x27a433){_0x5c4577=_0x5c4577-0x6a;var _0x28ead6=_0x414dcf[_0x5c4577];return _0x28ead6;},a0_0x5c45(_0x8dbb54,_0xd087fe);}document[a0_0x44e2c3(0x79)](a0_0x44e2c3(0xae),function(){var _0x250511=a0_0x44e2c3;dropboxRestore['addEventListener'](_0x250511(0xb3),async function(){var _0x5efe9f=_0x250511;await lockNoti(_0x5efe9f(0xb1),'',0x1388);const _0xcdbe59=localStorage['getItem'](_0x5efe9f(0x85)),_0x2590ea=[_0x5efe9f(0xbb),_0x5efe9f(0xc8),_0x5efe9f(0x97)];if(!_0xcdbe59){window[_0x5efe9f(0xb8)](_0x5efe9f(0xb7));return;}let _0x2ea5e1=[];for(const _0x48daf0 of _0x2590ea){let _0x5b9149={'path':'/'+_0xcdbe59+'/'+_0x48daf0};for(let _0x9134dd=0x0;_0x9134dd<0x2;_0x9134dd++){let _0x2217a4=await fetch(_0x5efe9f(0x6a),{'method':_0x5efe9f(0xc2),'headers':{'Authorization':_0x5efe9f(0xaf)+localStorage['getItem'](_0x5efe9f(0x87)),'Content-Type':_0x5efe9f(0x82)},'body':JSON['stringify'](_0x5b9149)});if(_0x2217a4['status']===0xc8){let _0x308a3d=await _0x2217a4['json'](),_0x11467e=_0x308a3d['entries'][_0x5efe9f(0x8a)](_0x93587e=>_0x93587e['.tag']==='file');_0x11467e[_0x5efe9f(0xa4)]>0x0&&_0x2ea5e1[_0x5efe9f(0xc1)](..._0x11467e[_0x5efe9f(0xbe)](_0x43d09e=>({'name':_0x43d09e[_0x5efe9f(0x71)],'folder':_0x48daf0})));break;}else{if(_0x2217a4[_0x5efe9f(0xbd)]===0x191){let _0x350568=await dpRefreshToken();if(!_0x350568)throw _0x5efe9f(0xab);}else{console['error']('Download\x20failed\x20for\x20'+_0x48daf0+_0x5efe9f(0xa2)+_0x2217a4['status']);break;}}}}if(_0x2ea5e1['length']>0x0){const _0x4fe6b5='Do\x20you\x20want\x20to\x20restore\x20'+_0x2ea5e1[_0x5efe9f(0xa4)]+'\x20files\x20from\x20Cloud?';if(window[_0x5efe9f(0xc0)](_0x4fe6b5))for(const _0x4b3280 of _0x2ea5e1){await lockNoti('Restoring...',_0x4b3280[_0x5efe9f(0x71)],0xbb8),await dpDownloadFile(_0x4b3280[_0x5efe9f(0x71)],_0x4b3280[_0x5efe9f(0xba)]);}else console[_0x5efe9f(0x76)](_0x5efe9f(0x88));}else console[_0x5efe9f(0x76)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x250511(0x79)](_0x250511(0xb3),async function(){var _0x393e32=_0x250511;await lockNoti(_0x393e32(0xb1),'',0x1388);const _0x1a0753=localStorage[_0x393e32(0x91)](_0x393e32(0x85));if(_0x1a0753===null||_0x1a0753==='')window['alert'](_0x393e32(0xb7));else{const _0x4dae0b=[_0x393e32(0xbb),'save',_0x393e32(0x97)];for(const _0x3f6e33 of _0x4dae0b){await dpCreateFolder(_0x3f6e33);}let _0x51832e=0x0;for(const _0x6f474 of _0x4dae0b){const _0x177bc2=a0_0x1c07e7[_0x393e32(0xa9)](_0x6f474+'s');_0x51832e+=_0x177bc2['length'];}if(window[_0x393e32(0xc0)](_0x393e32(0x81)+_0x51832e+'\x20files\x20in\x20Kabu?'))for(const _0x4cf317 of _0x4dae0b){const _0x38cdc4=a0_0x1c07e7['listFiles'](_0x4cf317+'s');for(const _0x1dfba1 of _0x38cdc4){const _0x12f90c=await a0_0x1c07e7['downloadFileInCloud'](_0x393e32(0x89)+_0x4cf317+'s/'+_0x1dfba1);try{await lockNoti('Backing\x20up...',_0x1dfba1,0xbb8),await dpUploadFile(_0x1dfba1,_0x12f90c,_0x4cf317);}catch(_0x7ce937){console[_0x393e32(0x99)](_0x393e32(0x6b)+_0x1dfba1+':',_0x7ce937);}}}else console['log'](_0x393e32(0x88));}}),dropboxCloud['addEventListener'](_0x250511(0xb3),function(){var _0x532204=_0x250511;const _0x27bc14=localStorage[_0x532204(0x91)](_0x532204(0x85));_0x27bc14===null||_0x27bc14===''?authorizeWithDropbox():window['confirm'](_0x532204(0x9f))&&(localStorage[_0x532204(0x72)](_0x532204(0x85),''),dropboxRestore[_0x532204(0x8d)][_0x532204(0x9a)]('active'),dropboxBackup[_0x532204(0x8d)][_0x532204(0x9a)](_0x532204(0x6d)),dropboxCloud[_0x532204(0x8d)]['remove']('active'));}),handleDropboxCallback();});