var a0_0x17c0c3=a0_0x6b73;function a0_0x6b73(_0x218497,_0x3fcf99){var _0x1a59d4=a0_0x1a59();return a0_0x6b73=function(_0x6b7366,_0x458745){_0x6b7366=_0x6b7366-0xce;var _0x245c69=_0x1a59d4[_0x6b7366];return _0x245c69;},a0_0x6b73(_0x218497,_0x3fcf99);}(function(_0x215398,_0x639dfe){var _0x5e4c5c=a0_0x6b73,_0x36fd3c=_0x215398();while(!![]){try{var _0x79472a=-parseInt(_0x5e4c5c(0x10a))/0x1*(-parseInt(_0x5e4c5c(0x123))/0x2)+parseInt(_0x5e4c5c(0x116))/0x3+-parseInt(_0x5e4c5c(0x100))/0x4+parseInt(_0x5e4c5c(0x118))/0x5+-parseInt(_0x5e4c5c(0x119))/0x6*(parseInt(_0x5e4c5c(0xdc))/0x7)+parseInt(_0x5e4c5c(0x108))/0x8*(parseInt(_0x5e4c5c(0xf2))/0x9)+parseInt(_0x5e4c5c(0x126))/0xa*(parseInt(_0x5e4c5c(0xfd))/0xb);if(_0x79472a===_0x639dfe)break;else _0x36fd3c['push'](_0x36fd3c['shift']());}catch(_0xb3dbf){_0x36fd3c['push'](_0x36fd3c['shift']());}}}(a0_0x1a59,0x6da0f));import*as a0_0x1d21c8 from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x17c0c3(0x120);function authorizeWithDropbox(){var _0xc0c0c4=a0_0x17c0c3,_0xb0749f=window['location'][_0xc0c0c4(0x103)][_0xc0c0c4(0xd6)]('?')[0x0],_0x34f8cb=_0xc0c0c4(0xd8),_0x5e15e3=_0xc0c0c4(0xcf),_0xd2ad77=_0xc0c0c4(0x130)+clientId+'&response_type='+_0x34f8cb+_0xc0c0c4(0x101)+_0x5e15e3+'&redirect_uri='+encodeURIComponent(_0xb0749f);window[_0xc0c0c4(0x12f)][_0xc0c0c4(0x103)]=_0xd2ad77;}function handleDropboxCallback(){var _0x439db3=a0_0x17c0c3,_0x5e5695=getUrlParameter(_0x439db3(0xd8));_0x5e5695?(getAccessToken(_0x5e5695),console[_0x439db3(0xd4)](_0x439db3(0xe8),_0x5e5695)):console[_0x439db3(0xd4)](_0x439db3(0x11b));}function getUrlParameter(_0x3b95d2){var _0x107ac2=a0_0x17c0c3;_0x3b95d2=_0x3b95d2[_0x107ac2(0xec)](/[\[]/,'\x5c[')['replace'](/[\]]/,'\x5c]');var _0x167d7b=new RegExp(_0x107ac2(0x12e)+_0x3b95d2+_0x107ac2(0x125)),_0xffe055=_0x167d7b[_0x107ac2(0xef)](location[_0x107ac2(0x113)]);return _0xffe055===null?'':decodeURIComponent(_0xffe055[0x1][_0x107ac2(0xec)](/\+/g,'\x20'));}function getAccessToken(_0x32339c){var _0x157406=a0_0x17c0c3,_0x1e83bf=_0x157406(0xd3),_0x1372f7=window[_0x157406(0x12f)][_0x157406(0x103)]['split']('?')[0x0],_0x8bc244=new XMLHttpRequest();_0x8bc244[_0x157406(0x11f)](_0x157406(0xfa),_0x157406(0x10d)),_0x8bc244[_0x157406(0xeb)]('Content-Type',_0x157406(0x11e)),_0x8bc244[_0x157406(0x109)]=function(){var _0x2c0f2f=_0x157406;if(_0x8bc244[_0x2c0f2f(0x10e)]===0xc8){var _0x1307db=JSON[_0x2c0f2f(0xe9)](_0x8bc244[_0x2c0f2f(0xe6)]),_0x19b785=_0x1307db[_0x2c0f2f(0xf7)],_0x4dd55b=_0x1307db[_0x2c0f2f(0x10c)],_0x112da5=_0x1307db[_0x2c0f2f(0xd0)];localStorage['setItem'](_0x2c0f2f(0xfe),_0x19b785),localStorage['setItem'](_0x2c0f2f(0x106),_0x4dd55b),localStorage['setItem'](_0x2c0f2f(0x111),_0x112da5);}else console[_0x2c0f2f(0xd4)]('Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token');},_0x8bc244[_0x157406(0xdb)]('code='+_0x32339c+'&grant_type='+_0x1e83bf+_0x157406(0xda)+clientId+_0x157406(0x10b)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x1372f7));}function a0_0x1a59(){var _0x58bd7d=['responseText','Failed\x20to\x20upload\x20file\x20','Authorization\x20Code:','parse','entries','setRequestHeader','replace','classList','state','exec','click','setItem','2450493ublDKZ','Do\x20you\x20want\x20to\x20restore\x20','Do\x20you\x20want\x20to\x20backup\x20','blob','push','access_token','Folder\x20created','error_description','POST','error','Cloud\x20login\x20required!','697455qlPUzi','accessToken','refresh_token=','2629592EgRTeb','&token_access_type=','Folder\x20already\x20exists','href','alert','getItem','refreshToken','addEventListener','8kXMLUD','onload','53195lBYMJr','&client_secret=','refresh_token','https://api.dropbox.com/oauth2/token','status','Download\x20failed,\x20unknown\x20http\x20status:','Unable\x20to\x20refresh\x20token','uId','filter','search','file','https://api.dropboxapi.com/2/files/create_folder_v2','2007150uGvhWv','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','2992670TeOCGU','624qwtYti','map','Do\x20not\x20receive\x20authorization','Bearer\x20','application/octet-stream','application/x-www-form-urlencoded','open','nwb3dnfh09rhs31','.tag','Wait\x20a\x20little\x20bit...','6UNtMPd','Do\x20you\x20want\x20to\x20logout?','=([^&#]*)','30tsYZgB','No\x20refresh\x20token','Backing\x20up...','https://api.dropboxapi.com/oauth2/token','save','length','Download\x20failed\x20for\x20','name','[\x5c?&#]','location','https://www.dropbox.com/oauth2/authorize?client_id=',',\x20status:\x20','downloadFileInCloud','offline','uid','Restore\x20canceled\x20by\x20user.','https://api.dropboxapi.com/2/files/list_folder','authorization_code','log','remove','split','screenshot','code','overwrite','&client_id=','send','52717SCKaQy','stringify','\x20files\x20from\x20Cloud?','listFiles','uploadFileInCloud','active','Cloud\x20↦\x20Kabu\x20storage\x20◆','Restoring...','json','confirm'];a0_0x1a59=function(){return _0x58bd7d;};return a0_0x1a59();}export async function dpCreateFolder(_0x4e80dc){var _0x15ebb4=a0_0x17c0c3;const _0x39ce91=localStorage[_0x15ebb4(0x105)]('uId');let _0x4798a6=localStorage[_0x15ebb4(0x105)](_0x15ebb4(0xfe));const _0x32b8ba='/'+_0x39ce91+'/'+_0x4e80dc,_0x27c705=JSON[_0x15ebb4(0xdd)]({'path':_0x32b8ba,'autorename':![]});for(let _0x25997a=0x0;_0x25997a<0x2;_0x25997a++){try{const _0xfb271c=await fetch(_0x15ebb4(0x115),{'method':'POST','headers':{'Authorization':'Bearer\x20'+_0x4798a6,'Content-Type':'application/json'},'body':_0x27c705});if(_0xfb271c[_0x15ebb4(0x10e)]===0x191){const _0x400f10=await dpRefreshToken();if(!_0x400f10)throw new Error('Unable\x20to\x20refresh\x20token');_0x4798a6=localStorage[_0x15ebb4(0x105)](_0x15ebb4(0xfe));continue;}if(_0xfb271c['status']===0x199)return{'message':_0x15ebb4(0x102),'path':_0x4e80dc};if(!_0xfb271c['ok'])throw new Error('Error\x20creating\x20folder\x20'+_0x4e80dc);const _0x294967=await _0xfb271c[_0x15ebb4(0xe4)]();return await lockNoti(_0x15ebb4(0xf8),'',0xbb8),_0x294967;}catch(_0x469291){if(_0x25997a===0x1)throw _0x469291;}}return![];}export async function dpRefreshToken(){var _0x1ccd0d=a0_0x17c0c3;if(!localStorage['getItem'](_0x1ccd0d(0x106)))throw _0x1ccd0d(0x127);try{const _0x1ff8ed=await fetch(_0x1ccd0d(0x129),{'method':'POST','headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':_0x1ccd0d(0xff)+localStorage[_0x1ccd0d(0x105)]('refreshToken')+_0x1ccd0d(0x117)}),_0x114eeb=await _0x1ff8ed[_0x1ccd0d(0xe4)]();if(!_0x114eeb[_0x1ccd0d(0xfb)])return localStorage[_0x1ccd0d(0xf1)](_0x1ccd0d(0xfe),_0x114eeb[_0x1ccd0d(0xf7)]),await lockNoti('Refreshing\x20token...','',0xbb8),await delay(0x3e8),!![];else alert(_0x114eeb[_0x1ccd0d(0xf9)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0xcd1802){console['error']('Error\x20while\x20refreshing\x20token:',_0xcd1802);}return![];}export async function dpUploadFile(_0x570833,_0x5c30cb,_0x36a27a){var _0x1980b0=a0_0x17c0c3;const _0x4a407b=localStorage['getItem'](_0x1980b0(0x111));var _0x45b1b0=JSON[_0x1980b0(0xdd)]({'autorename':!![],'mode':_0x1980b0(0xd9),'mute':!![],'strict_conflict':![],'path':'/'+_0x4a407b+'/'+_0x36a27a+'/'+_0x570833}),_0x29e9cc=new Blob([_0x5c30cb],{'type':_0x1980b0(0x11d)});for(var _0x737b88=0x0;_0x737b88<0x2;_0x737b88++){var _0x4a35d6=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x1980b0(0xfa),'headers':{'Authorization':'Bearer\x20'+localStorage[_0x1980b0(0x105)](_0x1980b0(0xfe)),'Dropbox-API-Arg':_0x45b1b0,'Content-Type':_0x1980b0(0x11d)},'body':_0x29e9cc});if(_0x4a35d6[_0x1980b0(0x10e)]!=0xc8){if(_0x4a35d6['status']==0x191){var _0x53e8c0=await dpRefreshToken();if(!_0x53e8c0)throw _0x1980b0(0x110);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x4a35d6[_0x1980b0(0x10e)];}else{var _0x31e5e5=await _0x4a35d6['json']();return console[_0x1980b0(0xd4)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x570833),_0x31e5e5;}}return![];}export async function dpDownloadFile(_0x508d0e,_0x3080f4){var _0x2790ca=a0_0x17c0c3;const _0x26998e=localStorage[_0x2790ca(0x105)](_0x2790ca(0x111));var _0x415d62=JSON[_0x2790ca(0xdd)]({'path':'/'+_0x26998e+'/'+_0x3080f4+'/'+_0x508d0e});for(var _0x1d1b23=0x0;_0x1d1b23<0x2;_0x1d1b23++){var _0x541aa2=await fetch('https://content.dropboxapi.com/2/files/download',{'method':'POST','headers':{'Authorization':_0x2790ca(0x11c)+localStorage[_0x2790ca(0x105)](_0x2790ca(0xfe)),'Dropbox-API-Arg':_0x415d62}});if(_0x541aa2[_0x2790ca(0x10e)]!=0xc8){if(_0x541aa2[_0x2790ca(0x10e)]==0x191){var _0x8f58b7=await dpRefreshToken();if(!_0x8f58b7)throw _0x2790ca(0x110);continue;}else throw _0x2790ca(0x10f)+_0x541aa2[_0x2790ca(0x10e)];}const _0x1e5d62=new File([await _0x541aa2[_0x2790ca(0xf5)]()],_0x508d0e);return console['log'](_0x2790ca(0xe2),_0x1e5d62[_0x2790ca(0x12d)]),a0_0x1d21c8[_0x2790ca(0xe0)](_0x1e5d62,()=>{}),_0x1e5d62;}return![];}document[a0_0x17c0c3(0x107)]('DOMContentLoaded',function(){var _0x195846=a0_0x17c0c3;dropboxRestore[_0x195846(0x107)](_0x195846(0xf0),async function(){var _0x21b0a0=_0x195846;await lockNoti(_0x21b0a0(0x122),'',0x1388);const _0x19cf27=localStorage['getItem'](_0x21b0a0(0x111)),_0x215c9e=[_0x21b0a0(0xee),_0x21b0a0(0x12a),_0x21b0a0(0xd7)];if(!_0x19cf27){window[_0x21b0a0(0x104)](_0x21b0a0(0xfc));return;}let _0x4acda8=[];for(const _0x5d19a0 of _0x215c9e){let _0x4fab98={'path':'/'+_0x19cf27+'/'+_0x5d19a0};for(let _0x60ecdb=0x0;_0x60ecdb<0x2;_0x60ecdb++){let _0x7894df=await fetch(_0x21b0a0(0xd2),{'method':'POST','headers':{'Authorization':_0x21b0a0(0x11c)+localStorage[_0x21b0a0(0x105)](_0x21b0a0(0xfe)),'Content-Type':'application/json'},'body':JSON[_0x21b0a0(0xdd)](_0x4fab98)});if(_0x7894df[_0x21b0a0(0x10e)]===0xc8){let _0x3e7a1d=await _0x7894df['json'](),_0x284937=_0x3e7a1d[_0x21b0a0(0xea)][_0x21b0a0(0x112)](_0xb81bf7=>_0xb81bf7[_0x21b0a0(0x121)]===_0x21b0a0(0x114));_0x284937['length']>0x0&&_0x4acda8[_0x21b0a0(0xf6)](..._0x284937[_0x21b0a0(0x11a)](_0x2d66b4=>({'name':_0x2d66b4[_0x21b0a0(0x12d)],'folder':_0x5d19a0})));break;}else{if(_0x7894df[_0x21b0a0(0x10e)]===0x191){let _0x38589b=await dpRefreshToken();if(!_0x38589b)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x21b0a0(0xfb)](_0x21b0a0(0x12c)+_0x5d19a0+_0x21b0a0(0x131)+_0x7894df[_0x21b0a0(0x10e)]);break;}}}}if(_0x4acda8[_0x21b0a0(0x12b)]>0x0){const _0x514f9a=_0x21b0a0(0xf3)+_0x4acda8[_0x21b0a0(0x12b)]+_0x21b0a0(0xde);if(window[_0x21b0a0(0xe5)](_0x514f9a))for(const _0x1fde3c of _0x4acda8){await lockNoti(_0x21b0a0(0xe3),_0x1fde3c['name'],0xbb8),await dpDownloadFile(_0x1fde3c[_0x21b0a0(0x12d)],_0x1fde3c['folder']);}else console[_0x21b0a0(0xd4)](_0x21b0a0(0xd1));}else console[_0x21b0a0(0xd4)]('No\x20files\x20found\x20to\x20restore.');}),dropboxBackup[_0x195846(0x107)]('click',async function(){var _0x287c63=_0x195846;await lockNoti(_0x287c63(0x122),'',0x1388);const _0x5e3779=localStorage[_0x287c63(0x105)]('uId');if(_0x5e3779===null||_0x5e3779==='')window['alert'](_0x287c63(0xfc));else{const _0x38aaa6=['state','save','screenshot'];for(const _0x41b638 of _0x38aaa6){await dpCreateFolder(_0x41b638);}let _0x60b17b=0x0;for(const _0x34837b of _0x38aaa6){const _0x5c9d41=a0_0x1d21c8[_0x287c63(0xdf)](_0x34837b+'s');_0x60b17b+=_0x5c9d41[_0x287c63(0x12b)];}if(window[_0x287c63(0xe5)](_0x287c63(0xf4)+_0x60b17b+'\x20files\x20in\x20Kabu?'))for(const _0x1b735b of _0x38aaa6){const _0x5960c6=a0_0x1d21c8[_0x287c63(0xdf)](_0x1b735b+'s');for(const _0x55f90b of _0x5960c6){const _0x534d1c=await a0_0x1d21c8[_0x287c63(0xce)]('/data/'+_0x1b735b+'s/'+_0x55f90b);try{await lockNoti(_0x287c63(0x128),_0x55f90b,0xbb8),await dpUploadFile(_0x55f90b,_0x534d1c,_0x1b735b);}catch(_0x33418f){console[_0x287c63(0xfb)](_0x287c63(0xe7)+_0x55f90b+':',_0x33418f);}}}else console[_0x287c63(0xd4)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud[_0x195846(0x107)](_0x195846(0xf0),function(){var _0x44df63=_0x195846;const _0xe48ba=localStorage['getItem'](_0x44df63(0x111));_0xe48ba===null||_0xe48ba===''?authorizeWithDropbox():window['confirm'](_0x44df63(0x124))&&(localStorage[_0x44df63(0xf1)](_0x44df63(0x111),''),dropboxRestore['classList']['remove']('active'),dropboxBackup[_0x44df63(0xed)][_0x44df63(0xd5)]('active'),dropboxCloud[_0x44df63(0xed)][_0x44df63(0xd5)](_0x44df63(0xe1)));}),handleDropboxCallback();});