function a0_0xd0cf(_0xa990ba,_0x22a0c9){var _0x55799d=a0_0x5579();return a0_0xd0cf=function(_0xd0cf6e,_0x211bfe){_0xd0cf6e=_0xd0cf6e-0xbc;var _0x35b855=_0x55799d[_0xd0cf6e];return _0x35b855;},a0_0xd0cf(_0xa990ba,_0x22a0c9);}var a0_0x917e47=a0_0xd0cf;(function(_0x3a6e62,_0x42d99c){var _0x130566=a0_0xd0cf,_0x4b7c07=_0x3a6e62();while(!![]){try{var _0x5e7621=parseInt(_0x130566(0xd9))/0x1*(parseInt(_0x130566(0xe3))/0x2)+parseInt(_0x130566(0x11d))/0x3+parseInt(_0x130566(0xe9))/0x4*(parseInt(_0x130566(0xf4))/0x5)+parseInt(_0x130566(0xcb))/0x6+-parseInt(_0x130566(0xe6))/0x7+-parseInt(_0x130566(0x120))/0x8*(-parseInt(_0x130566(0xd3))/0x9)+-parseInt(_0x130566(0xe8))/0xa;if(_0x5e7621===_0x42d99c)break;else _0x4b7c07['push'](_0x4b7c07['shift']());}catch(_0x1df309){_0x4b7c07['push'](_0x4b7c07['shift']());}}}(a0_0x5579,0x3464d));import*as a0_0x36d5c0 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x917e47(0x103),clientSecret=a0_0x917e47(0xf8);function authorizeWithDropbox(){var _0x37fb83=a0_0x917e47,_0xa7a8ed=window['location']['href'][_0x37fb83(0xf9)]('?')[0x0],_0x551552='code',_0x291742='offline',_0x4ba5e8=_0x37fb83(0x115)+clientId+_0x37fb83(0x109)+_0x551552+_0x37fb83(0x10c)+_0x291742+_0x37fb83(0xfa)+encodeURIComponent(_0xa7a8ed);window[_0x37fb83(0xfc)]['href']=_0x4ba5e8;}function handleDropboxCallback(){var _0x3eca1b=a0_0x917e47,_0x20d557=getUrlParameter(_0x3eca1b(0xf6));_0x20d557?(getAccessToken(_0x20d557),console[_0x3eca1b(0xf2)]('Authorization\x20Code:',_0x20d557)):console[_0x3eca1b(0xf2)]('Do\x20not\x20receive\x20authorization');}function getUrlParameter(_0x3b495e){var _0x52b60f=a0_0x917e47;_0x3b495e=_0x3b495e[_0x52b60f(0x101)](/[\[]/,'\x5c[')[_0x52b60f(0x101)](/[\]]/,'\x5c]');var _0x342e48=new RegExp('[\x5c?&#]'+_0x3b495e+'=([^&#]*)'),_0x3ebd70=_0x342e48[_0x52b60f(0xe7)](location[_0x52b60f(0xea)]);return _0x3ebd70===null?'':decodeURIComponent(_0x3ebd70[0x1]['replace'](/\+/g,'\x20'));}function getAccessToken(_0x281773){var _0x426567=a0_0x917e47,_0xc11080=_0x426567(0xcc),_0x52d8cb=window[_0x426567(0xfc)]['href'][_0x426567(0xf9)]('?')[0x0],_0x2736c5=new XMLHttpRequest();_0x2736c5[_0x426567(0xe4)]('POST','https://api.dropbox.com/oauth2/token'),_0x2736c5['setRequestHeader'](_0x426567(0x100),_0x426567(0xbf)),_0x2736c5['onload']=function(){var _0x38d50d=_0x426567;if(_0x2736c5[_0x38d50d(0xc1)]===0xc8){var _0x1f3ad8=JSON[_0x38d50d(0x118)](_0x2736c5[_0x38d50d(0xc5)]),_0x206509=_0x1f3ad8[_0x38d50d(0xeb)],_0x2c8d24=_0x1f3ad8[_0x38d50d(0x112)],_0x4f34c2=_0x1f3ad8[_0x38d50d(0xd5)];localStorage[_0x38d50d(0xec)]('accessToken',_0x206509),localStorage[_0x38d50d(0xec)](_0x38d50d(0xca),_0x2c8d24),localStorage[_0x38d50d(0xec)](_0x38d50d(0xfb),_0x4f34c2);}else console[_0x38d50d(0xf2)](_0x38d50d(0xc9));},_0x2736c5['send'](_0x426567(0xff)+_0x281773+'&grant_type='+_0xc11080+_0x426567(0x11c)+clientId+_0x426567(0xc7)+clientSecret+_0x426567(0xfa)+encodeURIComponent(_0x52d8cb));}export async function dpRefreshToken(){var _0x193d04=a0_0x917e47;if(!localStorage[_0x193d04(0x113)](_0x193d04(0xca)))throw _0x193d04(0xfe);try{const _0x46ea1f=await fetch(_0x193d04(0x102),{'method':_0x193d04(0xd2),'headers':{'Content-Type':_0x193d04(0xbf)},'body':_0x193d04(0xe5)+localStorage[_0x193d04(0x113)]('refreshToken')+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x3dc39e=await _0x46ea1f[_0x193d04(0xf3)]();if(!_0x3dc39e[_0x193d04(0xd7)])return localStorage['setItem'](_0x193d04(0xd0),_0x3dc39e[_0x193d04(0xeb)]),await lockNoti('',_0x193d04(0xdf),0xbb8),await delay(0x3e8),!![];else alert(_0x3dc39e['error_description']||_0x193d04(0xcf));}catch(_0x1b6949){console[_0x193d04(0xd7)](_0x193d04(0x107),_0x1b6949);}return![];}export async function dpUploadFile(_0x11c89e,_0x5b72dd){var _0x52b9c3=a0_0x917e47;const _0xe5085f=localStorage[_0x52b9c3(0x113)](_0x52b9c3(0xfb));var _0x20a3f3=JSON['stringify']({'autorename':!![],'mode':_0x52b9c3(0xcd),'mute':!![],'strict_conflict':![],'path':'/'+_0xe5085f+'/'+_0x11c89e}),_0x3bac11=new Blob([_0x5b72dd],{'type':'application/octet-stream'});for(var _0x1b7949=0x0;_0x1b7949<0x2;_0x1b7949++){var _0x512c88=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x52b9c3(0xd2),'headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x52b9c3(0xd0)),'Dropbox-API-Arg':_0x20a3f3,'Content-Type':_0x52b9c3(0xdc)},'body':_0x3bac11});if(_0x512c88['status']!=0xc8){if(_0x512c88[_0x52b9c3(0xc1)]==0x191){var _0x3487c5=await dpRefreshToken();if(!_0x3487c5)throw'Unable\x20to\x20refresh\x20token';continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x512c88[_0x52b9c3(0xc1)];}else{var _0x4ad786=await _0x512c88[_0x52b9c3(0xf3)]();return console['log'](_0x52b9c3(0x10d),_0x11c89e),_0x4ad786;}}return![];}async function dpDownloadFile(_0x2a4832){var _0x5cdf31=a0_0x917e47;const _0x179455=localStorage['getItem'](_0x5cdf31(0xfb));var _0x2bfa17=JSON[_0x5cdf31(0xbe)]({'path':'/'+_0x179455+'/'+_0x2a4832});for(var _0x277875=0x0;_0x277875<0x2;_0x277875++){var _0x155d2c=await fetch(_0x5cdf31(0x117),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x5cdf31(0x113)]('accessToken'),'Dropbox-API-Arg':_0x2bfa17}});if(_0x155d2c[_0x5cdf31(0xc1)]!=0xc8){if(_0x155d2c[_0x5cdf31(0xc1)]==0x191){var _0x345a5a=await dpRefreshToken();if(!_0x345a5a)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x5cdf31(0xda)+_0x155d2c[_0x5cdf31(0xc1)];}const _0x1a5cdd=new File([await _0x155d2c[_0x5cdf31(0x121)]()],_0x2a4832);console[_0x5cdf31(0xf2)](_0x5cdf31(0xbc),_0x1a5cdd[_0x5cdf31(0x116)]);if(_0x2a4832[_0x5cdf31(0xc2)](_0x5cdf31(0x105))){const _0x2c1998=await _0x1a5cdd[_0x5cdf31(0xfd)](),[_0x265371,_0x2a92fb]=_0x2c1998['split']('\x0a\x0a'),_0x211ac0=_0x2a4832['substring'](0x0,_0x2a4832['lastIndexOf']('gba')+0x3),_0x1b77aa=_0x2a4832[_0x5cdf31(0x10b)](_0x2a4832[_0x5cdf31(0xc8)]-0x5);localStorage[_0x5cdf31(0xec)](_0x211ac0+'_dateState'+_0x1b77aa,_0x2a92fb),localStorage[_0x5cdf31(0xec)](_0x211ac0+_0x5cdf31(0xdb)+_0x1b77aa,_0x265371);}else a0_0x36d5c0[_0x5cdf31(0xef)](_0x1a5cdd,()=>{var _0x2a8a28=_0x5cdf31;localStorageFile(),Module[_0x2a8a28(0x104)]();});return _0x1a5cdd;}return![];}function a0_0x5579(){var _0x1231d5=['uId','location','text','No\x20refresh\x20token','code=','Content-Type','replace','https://api.dropboxapi.com/oauth2/token','knh3uz2mx2hp2eu','FSSync','.txt','.gba_imageState','Error\x20while\x20refreshing\x20token:','Download\x20failed,\x20unknown\x20http\x20status:\x20','&response_type=','classList','charAt','&token_access_type=','Kabu\x20storage\x20↦\x20Cloud\x20◆','text/plain','.ss6','\x20files\x20in\x20Cloud?','.tag','refresh_token','getItem','Unable\x20to\x20refresh\x20token','https://www.dropbox.com/oauth2/authorize?client_id=','name','https://content.dropboxapi.com/2/files/download','parse','.ss4','DOMContentLoaded','Backing\x20up...','&client_id=','228153qmYvfK','list','entries','211160kVdxHl','blob','Cloud\x20↦\x20Kabu\x20storage\x20◆','application/json','stringify','application/x-www-form-urlencoded','substring','status','endsWith','https://api.dropboxapi.com/2/files/list_folder','addEventListener','responseText','Restoring...','&client_secret=','length','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','refreshToken','2065656JizEdn','authorization_code','overwrite','active','Failed\x20to\x20refresh\x20Dropbox\x20token.','accessToken','.ss0','POST','36eKmXsI','slice','uid','file','error','alert','1zHmcQh','Download\x20failed,\x20unknown\x20http\x20status:','_imageState','application/octet-stream','Failed\x20to\x20upload\x20file\x20','remove','Refreshing\x20token...','Bearer\x20','status:\x20','.gba_slot','593196fDLvKz','open','refresh_token=','1699922vWIyWu','exec','4467020PavZKG','56kECwTZ','search','access_token','setItem','click','Cloud\x20login\x20required!','uploadSaveOrSaveState','confirm','downloadFileInCloud','log','json','29160DdTfeH','.ss7','code','toUpperCase','nwb3dnfh09rhs31','split','&redirect_uri='];a0_0x5579=function(){return _0x1231d5;};return a0_0x5579();}document[a0_0x917e47(0xc4)](a0_0x917e47(0x11a),function(){var _0x20cfac=a0_0x917e47;dropboxRestore[_0x20cfac(0xc4)](_0x20cfac(0xed),async function(){var _0x300960=_0x20cfac;const _0x486d55=localStorage[_0x300960(0x113)](_0x300960(0xfb));if(_0x486d55===null||_0x486d55==='')window['alert'](_0x300960(0xee));else{var _0x4f3389={'path':'/'+_0x486d55};for(var _0x509dfd=0x0;_0x509dfd<0x2;_0x509dfd++){var _0x4ddbdd=await fetch(_0x300960(0xc3),{'method':_0x300960(0xd2),'headers':{'Authorization':_0x300960(0xe0)+localStorage['getItem'](_0x300960(0xd0)),'Content-Type':_0x300960(0xbd)},'body':JSON[_0x300960(0xbe)](_0x4f3389)});console[_0x300960(0xf2)](_0x300960(0xe1),_0x4ddbdd[_0x300960(0xc1)]);if(_0x4ddbdd[_0x300960(0xc1)]!=0xc8){if(_0x4ddbdd[_0x300960(0xc1)]==0x191){var _0x16376e=await dpRefreshToken();if(!_0x16376e)throw _0x300960(0x114);continue;}else throw _0x300960(0x108)+_0x4ddbdd[_0x300960(0xc1)];}else{const _0x2f0664=await _0x4ddbdd[_0x300960(0xf3)](),_0x24c7bc=_0x2f0664['entries']['filter'](_0xe8bedc=>_0xe8bedc['.tag']===_0x300960(0xd6))[_0x300960(0xc8)],_0x319d81='Do\x20you\x20want\x20to\x20restore\x20'+_0x24c7bc+_0x300960(0x110);if(window[_0x300960(0xf0)](_0x319d81))for(const _0x3195d4 of _0x2f0664[_0x300960(0x11f)]){_0x3195d4[_0x300960(0x111)]==='file'&&(await lockNoti(_0x300960(0xc6),_0x3195d4[_0x300960(0x116)],0xbb8),await dpDownloadFile(_0x3195d4[_0x300960(0x116)]));}else console[_0x300960(0xf2)]('Restore\x20canceled\x20by\x20user.');return!![];}}return![];}}),dropboxBackup[_0x20cfac(0xc4)](_0x20cfac(0xed),async function(){var _0x39a1b5=_0x20cfac;const _0x4a19cc=localStorage[_0x39a1b5(0x113)](_0x39a1b5(0xfb));if(_0x4a19cc===null||_0x4a19cc==='')window[_0x39a1b5(0xd8)](_0x39a1b5(0xee));else{const _0x2395b2=['state','save'];let _0x55c379=0x0;for(const _0x54e197 of _0x2395b2){const _0x4f170e=a0_0x36d5c0[_0x39a1b5(0x11e)+(_0x54e197[_0x39a1b5(0x10b)](0x0)[_0x39a1b5(0xf7)]()+_0x54e197[_0x39a1b5(0xd4)](0x1))]();_0x55c379+=_0x4f170e['length'];}if(window[_0x39a1b5(0xf0)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x55c379+'\x20files\x20in\x20Kabu?'))for(const _0x7a8bc0 of _0x2395b2){const _0x287b45=a0_0x36d5c0[_0x39a1b5(0x11e)+(_0x7a8bc0[_0x39a1b5(0x10b)](0x0)[_0x39a1b5(0xf7)]()+_0x7a8bc0['slice'](0x1))]();for(const _0x58afa0 of _0x287b45){const _0x1f6245=await a0_0x36d5c0[_0x39a1b5(0xf1)]('/data/'+_0x7a8bc0+'s/'+_0x58afa0);try{await lockNoti(_0x39a1b5(0x11b),_0x58afa0,0xbb8),await dpUploadFile(_0x58afa0,_0x1f6245);if(_0x58afa0['endsWith'](_0x39a1b5(0xd1))||_0x58afa0['endsWith']('.ss1')||_0x58afa0[_0x39a1b5(0xc2)]('.ss2')||_0x58afa0['endsWith']('.ss3')||_0x58afa0[_0x39a1b5(0xc2)](_0x39a1b5(0x119))||_0x58afa0[_0x39a1b5(0xc2)]('.ss5')||_0x58afa0[_0x39a1b5(0xc2)](_0x39a1b5(0x10f))||_0x58afa0[_0x39a1b5(0xc2)](_0x39a1b5(0xf5))){const _0xd01bdd=_0x58afa0[_0x39a1b5(0xc0)](0x0,_0x58afa0['lastIndexOf']('.')),_0x4ac72e=_0x58afa0['charAt'](_0x58afa0[_0x39a1b5(0xc8)]-0x1),_0x3b6ecc=localStorage['getItem'](_0xd01bdd+_0x39a1b5(0x106)+_0x4ac72e),_0x11a3e7=localStorage[_0x39a1b5(0x113)](_0xd01bdd+'.gba_dateState'+_0x4ac72e);if(_0x3b6ecc!==null){const _0x263342=_0x3b6ecc+'\x0a\x0a'+_0x11a3e7,_0x1aab28=new Blob([_0x263342],{'type':_0x39a1b5(0x10e)});await lockNoti(_0x39a1b5(0x11b),_0xd01bdd+_0x39a1b5(0xe2)+_0x4ac72e+_0x39a1b5(0x105),0xbb8),await dpUploadFile(_0xd01bdd+_0x39a1b5(0xe2)+_0x4ac72e+_0x39a1b5(0x105),_0x1aab28);}}}catch(_0x13c957){console['error'](_0x39a1b5(0xdd)+_0x58afa0+':',_0x13c957);}}}else console[_0x39a1b5(0xf2)]('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener']('click',function(){var _0xed9c=_0x20cfac;const _0x5d76e5=localStorage[_0xed9c(0x113)](_0xed9c(0xfb));_0x5d76e5===null||_0x5d76e5===''?authorizeWithDropbox():window[_0xed9c(0xf0)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage['setItem'](_0xed9c(0xfb),''),dropboxRestore[_0xed9c(0x10a)][_0xed9c(0xde)](_0xed9c(0xce)),dropboxBackup[_0xed9c(0x10a)][_0xed9c(0xde)](_0xed9c(0xce)),dropboxCloud[_0xed9c(0x10a)]['remove'](_0xed9c(0xce)));}),handleDropboxCallback();});