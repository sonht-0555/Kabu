var a0_0x33ab01=a0_0x2840;(function(_0x27798b,_0x594451){var _0x26145c=a0_0x2840,_0x32d099=_0x27798b();while(!![]){try{var _0x271d63=parseInt(_0x26145c(0x143))/0x1*(-parseInt(_0x26145c(0x199))/0x2)+parseInt(_0x26145c(0x189))/0x3*(-parseInt(_0x26145c(0x165))/0x4)+parseInt(_0x26145c(0x19d))/0x5+parseInt(_0x26145c(0x151))/0x6+parseInt(_0x26145c(0x187))/0x7*(-parseInt(_0x26145c(0x148))/0x8)+parseInt(_0x26145c(0x156))/0x9+parseInt(_0x26145c(0x14b))/0xa;if(_0x271d63===_0x594451)break;else _0x32d099['push'](_0x32d099['shift']());}catch(_0x2b7007){_0x32d099['push'](_0x32d099['shift']());}}}(a0_0x53fa,0x5f433));import*as a0_0x2399c9 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x33ab01(0x18d),clientSecret='nwb3dnfh09rhs31';function authorizeWithDropbox(){var _0xadc1e7=a0_0x33ab01,_0x40a0c4=window[_0xadc1e7(0x174)][_0xadc1e7(0x154)]['split']('?')[0x0],_0x2cff17='code',_0x4fef1b=_0xadc1e7(0x141),_0x5e1ac0=_0xadc1e7(0x14f)+clientId+'&response_type='+_0x2cff17+'&token_access_type='+_0x4fef1b+'&redirect_uri='+encodeURIComponent(_0x40a0c4);window[_0xadc1e7(0x174)][_0xadc1e7(0x154)]=_0x5e1ac0;}function handleDropboxCallback(){var _0x628dae=a0_0x33ab01,_0xe78426=getUrlParameter(_0x628dae(0x15c));_0xe78426?(getAccessToken(_0xe78426),console[_0x628dae(0x17d)](_0x628dae(0x159),_0xe78426)):console[_0x628dae(0x17d)](_0x628dae(0x14d));}function getUrlParameter(_0x53da83){var _0x177c41=a0_0x33ab01;_0x53da83=_0x53da83[_0x177c41(0x185)](/[\[]/,'\x5c[')[_0x177c41(0x185)](/[\]]/,'\x5c]');var _0x591444=new RegExp(_0x177c41(0x166)+_0x53da83+_0x177c41(0x188)),_0x3953cd=_0x591444[_0x177c41(0x14e)](location[_0x177c41(0x153)]);return _0x3953cd===null?'':decodeURIComponent(_0x3953cd[0x1][_0x177c41(0x185)](/\+/g,'\x20'));}function a0_0x2840(_0x81ccc5,_0x4e82e1){var _0x53fa48=a0_0x53fa();return a0_0x2840=function(_0x284081,_0x5f47e3){_0x284081=_0x284081-0x13d;var _0x2c22be=_0x53fa48[_0x284081];return _0x2c22be;},a0_0x2840(_0x81ccc5,_0x4e82e1);}function getAccessToken(_0x333c1f){var _0x36914f=a0_0x33ab01,_0xbde869=_0x36914f(0x176),_0x524ff6=window[_0x36914f(0x174)][_0x36914f(0x154)]['split']('?')[0x0],_0x163c47=new XMLHttpRequest();_0x163c47[_0x36914f(0x195)]('POST','https://api.dropbox.com/oauth2/token'),_0x163c47[_0x36914f(0x15b)]('Content-Type',_0x36914f(0x15e)),_0x163c47[_0x36914f(0x193)]=function(){var _0x12e148=_0x36914f;if(_0x163c47['status']===0xc8){var _0x108d22=JSON[_0x12e148(0x157)](_0x163c47['responseText']),_0x3e4144=_0x108d22[_0x12e148(0x198)],_0x15c4ec=_0x108d22[_0x12e148(0x13f)],_0x27c43a=_0x108d22[_0x12e148(0x16b)];localStorage[_0x12e148(0x15a)](_0x12e148(0x14c),_0x3e4144),localStorage[_0x12e148(0x15a)]('refreshToken',_0x15c4ec),localStorage[_0x12e148(0x15a)](_0x12e148(0x14a),_0x27c43a);}else console[_0x12e148(0x17d)](_0x12e148(0x163));},_0x163c47[_0x36914f(0x17a)]('code='+_0x333c1f+'&grant_type='+_0xbde869+_0x36914f(0x19a)+clientId+_0x36914f(0x149)+clientSecret+_0x36914f(0x181)+encodeURIComponent(_0x524ff6));}export async function dpCreateFolder(_0x4fc974){var _0x4f6f12=a0_0x33ab01;const _0x1d6a9e=localStorage['getItem']('uId');let _0x206290=localStorage[_0x4f6f12(0x162)](_0x4f6f12(0x14c));const _0x1e001a='/'+_0x1d6a9e+'/'+_0x4fc974,_0x4f0c37=JSON[_0x4f6f12(0x197)]({'path':_0x1e001a,'autorename':![]});for(let _0x21570b=0x0;_0x21570b<0x2;_0x21570b++){try{const _0x157a0f=await fetch(_0x4f6f12(0x161),{'method':_0x4f6f12(0x16c),'headers':{'Authorization':'Bearer\x20'+_0x206290,'Content-Type':'application/json'},'body':_0x4f0c37});if(_0x157a0f['status']===0x191){const _0x4c9351=await dpRefreshToken();if(!_0x4c9351)throw new Error('Unable\x20to\x20refresh\x20token');_0x206290=localStorage[_0x4f6f12(0x162)]('accessToken');continue;}if(_0x157a0f[_0x4f6f12(0x19c)]===0x199)return{'message':'Folder\x20already\x20exists','path':_0x4fc974};if(!_0x157a0f['ok'])throw new Error(_0x4f6f12(0x16a)+_0x4fc974);const _0x15f1d6=await _0x157a0f['json']();return await lockNoti(_0x4f6f12(0x171),'',0xbb8),_0x15f1d6;}catch(_0x3deb08){if(_0x21570b===0x1)throw _0x3deb08;}}return![];}function a0_0x53fa(){var _0x134ac2=[',\x20status:\x20','25PHPUcP','remove','push','folder','Failed\x20to\x20upload\x20file\x20','632BEtVHw','&client_secret=','uId','1208080OmmmjY','accessToken','Do\x20not\x20receive\x20authorization','exec','https://www.dropbox.com/oauth2/authorize?client_id=','Cloud\x20login\x20required!','4382766RKFpoL','json','search','href','confirm','2149362sFFeQZ','parse','entries','Authorization\x20Code:','setItem','setRequestHeader','code','screenshot','application/x-www-form-urlencoded','map','name','https://api.dropboxapi.com/2/files/create_folder_v2','getItem','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','application/octet-stream','4wCxlGF','[\x5c?&#]','https://api.dropboxapi.com/2/files/list_folder','listFiles','Restoring...','Error\x20creating\x20folder\x20','uid','POST','DOMContentLoaded','application/json','active','Error\x20while\x20refreshing\x20token:','Folder\x20created','\x20files\x20in\x20Kabu?','/data/','location','Do\x20you\x20want\x20to\x20backup\x20','authorization_code','No\x20files\x20found\x20to\x20restore.','https://content.dropboxapi.com/2/files/download','Cloud\x20↦\x20Kabu\x20storage\x20◆','send','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','save','log','.tag','Do\x20you\x20want\x20to\x20restore\x20','classList','&redirect_uri=','addEventListener','Bearer\x20','state','replace','Wait\x20a\x20little\x20bit...','56798BweHXc','=([^&#]*)','494154iowJXz','error','alert','Failed\x20to\x20refresh\x20Dropbox\x20token.','knh3uz2mx2hp2eu','Download\x20failed,\x20unknown\x20http\x20status:','blob','refresh_token=','length','refreshToken','onload','Restore\x20canceled\x20by\x20user.','open','Refreshing\x20token...','stringify','access_token','5000scDpmT','&client_id=','https://api.dropboxapi.com/oauth2/token','status','841660DNDFnl','Upload\x20failed,\x20unknown\x20http\x20status:\x20','Unable\x20to\x20refresh\x20token','refresh_token','click','offline'];a0_0x53fa=function(){return _0x134ac2;};return a0_0x53fa();}export async function dpRefreshToken(){var _0x3148bd=a0_0x33ab01;if(!localStorage['getItem'](_0x3148bd(0x192)))throw'No\x20refresh\x20token';try{const _0x3f25fe=await fetch(_0x3148bd(0x19b),{'method':'POST','headers':{'Content-Type':_0x3148bd(0x15e)},'body':_0x3148bd(0x190)+localStorage[_0x3148bd(0x162)](_0x3148bd(0x192))+_0x3148bd(0x17b)}),_0x135760=await _0x3f25fe[_0x3148bd(0x152)]();if(!_0x135760[_0x3148bd(0x18a)])return localStorage[_0x3148bd(0x15a)](_0x3148bd(0x14c),_0x135760[_0x3148bd(0x198)]),await lockNoti(_0x3148bd(0x196),'',0xbb8),await delay(0x3e8),!![];else alert(_0x135760['error_description']||_0x3148bd(0x18c));}catch(_0x348e89){console['error'](_0x3148bd(0x170),_0x348e89);}return![];}export async function dpUploadFile(_0x143608,_0x543092,_0x2cebb1){var _0x3e2403=a0_0x33ab01;const _0x329ff3=localStorage[_0x3e2403(0x162)](_0x3e2403(0x14a));var _0x1000e3=JSON['stringify']({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x329ff3+'/'+_0x2cebb1+'/'+_0x143608}),_0xf18cbf=new Blob([_0x543092],{'type':_0x3e2403(0x164)});for(var _0x22caf3=0x0;_0x22caf3<0x2;_0x22caf3++){var _0x56e47a=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage[_0x3e2403(0x162)](_0x3e2403(0x14c)),'Dropbox-API-Arg':_0x1000e3,'Content-Type':_0x3e2403(0x164)},'body':_0xf18cbf});if(_0x56e47a[_0x3e2403(0x19c)]!=0xc8){if(_0x56e47a[_0x3e2403(0x19c)]==0x191){var _0x138b11=await dpRefreshToken();if(!_0x138b11)throw _0x3e2403(0x13e);continue;}else throw _0x3e2403(0x13d)+_0x56e47a[_0x3e2403(0x19c)];}else{var _0x3033fb=await _0x56e47a['json']();return console[_0x3e2403(0x17d)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x143608),_0x3033fb;}}return![];}export async function dpDownloadFile(_0x4815b6,_0x4d9891){var _0x107aa1=a0_0x33ab01;const _0x5befad=localStorage[_0x107aa1(0x162)]('uId');var _0x59b96a=JSON['stringify']({'path':'/'+_0x5befad+'/'+_0x4d9891+'/'+_0x4815b6});for(var _0x470e05=0x0;_0x470e05<0x2;_0x470e05++){var _0x8eb1c=await fetch(_0x107aa1(0x178),{'method':'POST','headers':{'Authorization':_0x107aa1(0x183)+localStorage[_0x107aa1(0x162)](_0x107aa1(0x14c)),'Dropbox-API-Arg':_0x59b96a}});if(_0x8eb1c[_0x107aa1(0x19c)]!=0xc8){if(_0x8eb1c[_0x107aa1(0x19c)]==0x191){var _0x553ed7=await dpRefreshToken();if(!_0x553ed7)throw _0x107aa1(0x13e);continue;}else throw _0x107aa1(0x18e)+_0x8eb1c[_0x107aa1(0x19c)];}const _0x15b2ea=new File([await _0x8eb1c[_0x107aa1(0x18f)]()],_0x4815b6);return console[_0x107aa1(0x17d)](_0x107aa1(0x179),_0x15b2ea[_0x107aa1(0x160)]),a0_0x2399c9['uploadFileInCloud'](_0x15b2ea,()=>{}),_0x15b2ea;}return![];}document[a0_0x33ab01(0x182)](a0_0x33ab01(0x16d),function(){var _0x43315c=a0_0x33ab01;dropboxRestore[_0x43315c(0x182)](_0x43315c(0x140),async function(){var _0x7e46b6=_0x43315c;await lockNoti(_0x7e46b6(0x186),'',0x1388);const _0x4b1ab0=localStorage['getItem']('uId'),_0x64c57a=[_0x7e46b6(0x184),_0x7e46b6(0x17c),_0x7e46b6(0x15d)];if(!_0x4b1ab0){window['alert'](_0x7e46b6(0x150));return;}let _0x18ac89=[];for(const _0xf429f0 of _0x64c57a){let _0x390ec9={'path':'/'+_0x4b1ab0+'/'+_0xf429f0};for(let _0xd17769=0x0;_0xd17769<0x2;_0xd17769++){let _0x55b6ef=await fetch(_0x7e46b6(0x167),{'method':'POST','headers':{'Authorization':_0x7e46b6(0x183)+localStorage[_0x7e46b6(0x162)](_0x7e46b6(0x14c)),'Content-Type':_0x7e46b6(0x16e)},'body':JSON[_0x7e46b6(0x197)](_0x390ec9)});if(_0x55b6ef['status']===0xc8){let _0x2d02d8=await _0x55b6ef[_0x7e46b6(0x152)](),_0x2fcb23=_0x2d02d8[_0x7e46b6(0x158)]['filter'](_0x2fa4bb=>_0x2fa4bb[_0x7e46b6(0x17e)]==='file');_0x2fcb23[_0x7e46b6(0x191)]>0x0&&_0x18ac89[_0x7e46b6(0x145)](..._0x2fcb23[_0x7e46b6(0x15f)](_0x57ee66=>({'name':_0x57ee66[_0x7e46b6(0x160)],'folder':_0xf429f0})));break;}else{if(_0x55b6ef[_0x7e46b6(0x19c)]===0x191){let _0x57135c=await dpRefreshToken();if(!_0x57135c)throw _0x7e46b6(0x13e);}else{console[_0x7e46b6(0x18a)]('Download\x20failed\x20for\x20'+_0xf429f0+_0x7e46b6(0x142)+_0x55b6ef[_0x7e46b6(0x19c)]);break;}}}}if(_0x18ac89['length']>0x0){const _0x120788=_0x7e46b6(0x17f)+_0x18ac89[_0x7e46b6(0x191)]+'\x20files\x20from\x20Cloud?';if(window[_0x7e46b6(0x155)](_0x120788))for(const _0x32ee4e of _0x18ac89){await lockNoti(_0x7e46b6(0x169),_0x32ee4e[_0x7e46b6(0x160)],0xbb8),await dpDownloadFile(_0x32ee4e[_0x7e46b6(0x160)],_0x32ee4e[_0x7e46b6(0x146)]);}else console[_0x7e46b6(0x17d)](_0x7e46b6(0x194));}else console['log'](_0x7e46b6(0x177));}),dropboxBackup[_0x43315c(0x182)]('click',async function(){var _0xdeeda8=_0x43315c;await lockNoti(_0xdeeda8(0x186),'',0x1388);const _0x1669c2=localStorage[_0xdeeda8(0x162)](_0xdeeda8(0x14a));if(_0x1669c2===null||_0x1669c2==='')window[_0xdeeda8(0x18b)](_0xdeeda8(0x150));else{const _0x2acfee=[_0xdeeda8(0x184),_0xdeeda8(0x17c),_0xdeeda8(0x15d)];for(const _0x57147f of _0x2acfee){await dpCreateFolder(_0x57147f);}let _0x25e6a1=0x0;for(const _0x3539cc of _0x2acfee){const _0x244df9=a0_0x2399c9[_0xdeeda8(0x168)](_0x3539cc+'s');_0x25e6a1+=_0x244df9[_0xdeeda8(0x191)];}if(window[_0xdeeda8(0x155)](_0xdeeda8(0x175)+_0x25e6a1+_0xdeeda8(0x172)))for(const _0x2c8949 of _0x2acfee){const _0x38de06=a0_0x2399c9[_0xdeeda8(0x168)](_0x2c8949+'s');for(const _0x616036 of _0x38de06){const _0x211cb4=await a0_0x2399c9['downloadFileInCloud'](_0xdeeda8(0x173)+_0x2c8949+'s/'+_0x616036);try{await lockNoti('Backing\x20up...',_0x616036,0xbb8),await dpUploadFile(_0x616036,_0x211cb4,_0x2c8949);}catch(_0xe823a3){console[_0xdeeda8(0x18a)](_0xdeeda8(0x147)+_0x616036+':',_0xe823a3);}}}else console[_0xdeeda8(0x17d)](_0xdeeda8(0x194));}}),dropboxCloud['addEventListener'](_0x43315c(0x140),function(){var _0x7b2542=_0x43315c;const _0x1eaf94=localStorage[_0x7b2542(0x162)](_0x7b2542(0x14a));_0x1eaf94===null||_0x1eaf94===''?authorizeWithDropbox():window[_0x7b2542(0x155)]('Do\x20you\x20want\x20to\x20logout?')&&(localStorage[_0x7b2542(0x15a)](_0x7b2542(0x14a),''),dropboxRestore['classList'][_0x7b2542(0x144)]('active'),dropboxBackup[_0x7b2542(0x180)][_0x7b2542(0x144)]('active'),dropboxCloud[_0x7b2542(0x180)][_0x7b2542(0x144)](_0x7b2542(0x16f)));}),handleDropboxCallback();});