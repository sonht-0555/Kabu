var a0_0x29a31f=a0_0x5ba6;(function(_0x5bbccd,_0x17a8e4){var _0x59409e=a0_0x5ba6,_0x16ea8f=_0x5bbccd();while(!![]){try{var _0x437832=-parseInt(_0x59409e(0xc1))/0x1+-parseInt(_0x59409e(0xc7))/0x2+parseInt(_0x59409e(0xac))/0x3*(parseInt(_0x59409e(0x7e))/0x4)+parseInt(_0x59409e(0xc6))/0x5+-parseInt(_0x59409e(0xbf))/0x6*(parseInt(_0x59409e(0x9d))/0x7)+parseInt(_0x59409e(0xcd))/0x8*(-parseInt(_0x59409e(0x98))/0x9)+parseInt(_0x59409e(0xa8))/0xa;if(_0x437832===_0x17a8e4)break;else _0x16ea8f['push'](_0x16ea8f['shift']());}catch(_0x499aba){_0x16ea8f['push'](_0x16ea8f['shift']());}}}(a0_0x3008,0x19763));import*as a0_0x3336ea from'./main.js';import{localStorageFile}from'./storage.js';var clientId='knh3uz2mx2hp2eu',clientSecret=a0_0x29a31f(0xb4);function authorizeWithDropbox(){var _0x32726b=a0_0x29a31f,_0x5a1981=window['location'][_0x32726b(0xbe)][_0x32726b(0xc3)]('?')[0x0],_0x456d39='code',_0x553d5c=_0x32726b(0x94),_0x4cf75b=_0x32726b(0xba)+clientId+'&response_type='+_0x456d39+_0x32726b(0xb9)+_0x553d5c+_0x32726b(0x81)+encodeURIComponent(_0x5a1981);window[_0x32726b(0xa4)][_0x32726b(0xbe)]=_0x4cf75b;}function handleDropboxCallback(){var _0x333e75=a0_0x29a31f,_0x51c9c6=getUrlParameter('code');_0x51c9c6?(getAccessToken(_0x51c9c6),console[_0x333e75(0x9b)](_0x333e75(0x99),_0x51c9c6)):console[_0x333e75(0x9b)](_0x333e75(0xc4));}function getUrlParameter(_0x3e2a8f){var _0x314fc1=a0_0x29a31f;_0x3e2a8f=_0x3e2a8f[_0x314fc1(0x77)](/[\[]/,'\x5c[')[_0x314fc1(0x77)](/[\]]/,'\x5c]');var _0x5d97d7=new RegExp(_0x314fc1(0xd6)+_0x3e2a8f+_0x314fc1(0xa2)),_0x3efb96=_0x5d97d7[_0x314fc1(0x9e)](location[_0x314fc1(0xa6)]);return _0x3efb96===null?'':decodeURIComponent(_0x3efb96[0x1][_0x314fc1(0x77)](/\+/g,'\x20'));}function getAccessToken(_0x589fac){var _0x50c313=a0_0x29a31f,_0xaececd=_0x50c313(0xbc),_0x57c659=window[_0x50c313(0xa4)][_0x50c313(0xbe)][_0x50c313(0xc3)]('?')[0x0],_0x5122ed=new XMLHttpRequest();_0x5122ed['open'](_0x50c313(0xdb),'https://api.dropbox.com/oauth2/token'),_0x5122ed['setRequestHeader'](_0x50c313(0xc0),_0x50c313(0x83)),_0x5122ed[_0x50c313(0x8d)]=function(){var _0x5e7fb8=_0x50c313;if(_0x5122ed[_0x5e7fb8(0xb6)]===0xc8){var _0x529e16=JSON[_0x5e7fb8(0xd1)](_0x5122ed['responseText']),_0x337510=_0x529e16['access_token'],_0x982f74=_0x529e16[_0x5e7fb8(0xdc)],_0x2ee940=_0x529e16[_0x5e7fb8(0x7a)];localStorage[_0x5e7fb8(0xaa)](_0x5e7fb8(0xd7),_0x337510),localStorage[_0x5e7fb8(0xaa)](_0x5e7fb8(0xda),_0x982f74),localStorage[_0x5e7fb8(0xaa)](_0x5e7fb8(0xd9),_0x2ee940);}else console['log'](_0x5e7fb8(0xb8));},_0x5122ed[_0x50c313(0xdd)]('code='+_0x589fac+_0x50c313(0x95)+_0xaececd+_0x50c313(0x8b)+clientId+'&client_secret='+clientSecret+_0x50c313(0x81)+encodeURIComponent(_0x57c659));}export async function dpCreateFolder(_0x16c0cd){var _0x1c5aae=a0_0x29a31f;const _0x422e3b=localStorage[_0x1c5aae(0xce)](_0x1c5aae(0xd9));let _0x24cf32=localStorage[_0x1c5aae(0xce)](_0x1c5aae(0xd7));const _0x14b773='/'+_0x422e3b+'/'+_0x16c0cd,_0x4388e5=JSON['stringify']({'path':_0x14b773,'autorename':![]});for(let _0x229e92=0x0;_0x229e92<0x2;_0x229e92++){try{const _0x37b285=await fetch(_0x1c5aae(0x87),{'method':_0x1c5aae(0xdb),'headers':{'Authorization':_0x1c5aae(0x97)+_0x24cf32,'Content-Type':_0x1c5aae(0x9f)},'body':_0x4388e5});if(_0x37b285[_0x1c5aae(0xb6)]===0x191){const _0x3eb68b=await dpRefreshToken();if(!_0x3eb68b)throw new Error(_0x1c5aae(0x96));_0x24cf32=localStorage[_0x1c5aae(0xce)]('accessToken');continue;}if(_0x37b285[_0x1c5aae(0xb6)]===0x199)return{'message':_0x1c5aae(0xbd),'path':_0x16c0cd};if(!_0x37b285['ok'])throw new Error(_0x1c5aae(0xa0)+_0x16c0cd);const _0x45312c=await _0x37b285['json']();return await lockNoti(_0x1c5aae(0xcc),'',0xbb8),_0x45312c;}catch(_0x5b12d2){if(_0x229e92===0x1)throw _0x5b12d2;}}return![];}function a0_0x5ba6(_0xf575ef,_0x5efb38){var _0x3008e8=a0_0x3008();return a0_0x5ba6=function(_0x5ba628,_0x13083a){_0x5ba628=_0x5ba628-0x77;var _0x365b05=_0x3008e8[_0x5ba628];return _0x365b05;},a0_0x5ba6(_0xf575ef,_0x5efb38);}export async function dpRefreshToken(){var _0x22bea4=a0_0x29a31f;if(!localStorage[_0x22bea4(0xce)](_0x22bea4(0xda)))throw _0x22bea4(0xc9);try{const _0x4c5036=await fetch(_0x22bea4(0x88),{'method':'POST','headers':{'Content-Type':_0x22bea4(0x83)},'body':_0x22bea4(0xc5)+localStorage['getItem'](_0x22bea4(0xda))+_0x22bea4(0x90)}),_0x5091fc=await _0x4c5036['json']();if(!_0x5091fc['error'])return localStorage[_0x22bea4(0xaa)](_0x22bea4(0xd7),_0x5091fc[_0x22bea4(0x86)]),await lockNoti('',_0x22bea4(0x89),0xbb8),await delay(0x3e8),!![];else alert(_0x5091fc[_0x22bea4(0x92)]||_0x22bea4(0x85));}catch(_0x2b7f27){console[_0x22bea4(0xde)](_0x22bea4(0xae),_0x2b7f27);}return![];}export async function dpUploadFile(_0xf06cd,_0xd7041c,_0x4ab51e){var _0x67c301=a0_0x29a31f;const _0x389388=localStorage['getItem'](_0x67c301(0xd9));var _0x39ad52=JSON[_0x67c301(0x7f)]({'autorename':!![],'mode':'overwrite','mute':!![],'strict_conflict':![],'path':'/'+_0x389388+'/'+_0x4ab51e+'/'+_0xf06cd}),_0x687177=new Blob([_0xd7041c],{'type':_0x67c301(0xd3)});for(var _0x4173cc=0x0;_0x4173cc<0x2;_0x4173cc++){var _0x26c17c=await fetch('https://content.dropboxapi.com/2/files/upload',{'method':_0x67c301(0xdb),'headers':{'Authorization':_0x67c301(0x97)+localStorage[_0x67c301(0xce)](_0x67c301(0xd7)),'Dropbox-API-Arg':_0x39ad52,'Content-Type':_0x67c301(0xd3)},'body':_0x687177});if(_0x26c17c[_0x67c301(0xb6)]!=0xc8){if(_0x26c17c[_0x67c301(0xb6)]==0x191){var _0x445301=await dpRefreshToken();if(!_0x445301)throw _0x67c301(0x96);continue;}else throw _0x67c301(0x9a)+_0x26c17c[_0x67c301(0xb6)];}else{var _0x325ca8=await _0x26c17c[_0x67c301(0xc8)]();return console[_0x67c301(0x9b)](_0x67c301(0x8c),_0xf06cd),_0x325ca8;}}return![];}function a0_0x3008(){var _0x4c74dc=['119976rpyfTQ','json','No\x20refresh\x20token','name','list','Folder\x20created','112ZsJkqA','getItem','remove','file','parse','\x20files\x20from\x20Cloud?','application/octet-stream','Restore\x20canceled\x20by\x20user.','click','[\x5c?&#]','accessToken','toUpperCase','uId','refreshToken','POST','refresh_token','send','error','replace','active','blob','uid','Cloud\x20login\x20required!','confirm','Cloud\x20↦\x20Kabu\x20storage\x20◆','4172EBchxn','stringify','alert','&redirect_uri=','slice','application/x-www-form-urlencoded','downloadFileInCloud','Failed\x20to\x20refresh\x20Dropbox\x20token.','access_token','https://api.dropboxapi.com/2/files/create_folder_v2','https://api.dropboxapi.com/oauth2/token','Refreshing\x20token...','save','&client_id=','Kabu\x20storage\x20↦\x20Cloud\x20◆','onload','length','map','&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31','state','error_description','push','offline','&grant_type=','Unable\x20to\x20refresh\x20token','Bearer\x20','92169QmBzzc','Authorization\x20Code:','Upload\x20failed,\x20unknown\x20http\x20status:\x20','log','folder','4347KUqPXZ','exec','application/json','Error\x20creating\x20folder\x20','uploadFileInCloud','=([^&#]*)','https://content.dropboxapi.com/2/files/download','location',',\x20status:\x20','search','Download\x20failed,\x20unknown\x20http\x20status:','4540350SyLHKi','Do\x20you\x20want\x20to\x20logout?','setItem','Wait\x20a\x20little\x20bit...','30nSpbrF','screenshot','Error\x20while\x20refreshing\x20token:','No\x20files\x20found\x20to\x20restore.','Do\x20you\x20want\x20to\x20restore\x20','classList','\x20files\x20in\x20Kabu?','Backing\x20up...','nwb3dnfh09rhs31','charAt','status','addEventListener','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','&token_access_type=','https://www.dropbox.com/oauth2/authorize?client_id=','filter','authorization_code','Folder\x20already\x20exists','href','558CoVPLV','Content-Type','167847AWsoxm','Download\x20failed\x20for\x20','split','Do\x20not\x20receive\x20authorization','refresh_token=','343940cGNbnq'];a0_0x3008=function(){return _0x4c74dc;};return a0_0x3008();}export async function dpDownloadFile(_0x45ae49,_0x4eced6){var _0x5f43c5=a0_0x29a31f;const _0x3edf71=localStorage['getItem'](_0x5f43c5(0xd9));var _0x561c10=JSON['stringify']({'path':'/'+_0x3edf71+'/'+_0x4eced6+'/'+_0x45ae49});for(var _0x3cf536=0x0;_0x3cf536<0x2;_0x3cf536++){var _0x3530ff=await fetch(_0x5f43c5(0xa3),{'method':_0x5f43c5(0xdb),'headers':{'Authorization':_0x5f43c5(0x97)+localStorage[_0x5f43c5(0xce)]('accessToken'),'Dropbox-API-Arg':_0x561c10}});if(_0x3530ff[_0x5f43c5(0xb6)]!=0xc8){if(_0x3530ff['status']==0x191){var _0x1e6fc1=await dpRefreshToken();if(!_0x1e6fc1)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x5f43c5(0xa7)+_0x3530ff['status'];}const _0x1b8311=new File([await _0x3530ff[_0x5f43c5(0x79)]()],_0x45ae49);return console[_0x5f43c5(0x9b)](_0x5f43c5(0x7d),_0x1b8311[_0x5f43c5(0xca)]),a0_0x3336ea[_0x5f43c5(0xa1)](_0x1b8311,()=>{localStorageFile(),Module['FSSync']();}),_0x1b8311;}return![];}document[a0_0x29a31f(0xb7)]('DOMContentLoaded',function(){var _0x52af58=a0_0x29a31f;dropboxRestore['addEventListener'](_0x52af58(0xd5),async function(){var _0x197b3e=_0x52af58;await lockNoti(_0x197b3e(0xab),'',0x1388);const _0xb20b5e=localStorage['getItem'](_0x197b3e(0xd9)),_0x148795=[_0x197b3e(0x91),_0x197b3e(0x8a),_0x197b3e(0xad)];if(!_0xb20b5e){window[_0x197b3e(0x80)](_0x197b3e(0x7b));return;}let _0x54c041=[];for(const _0x1364f5 of _0x148795){let _0x269100={'path':'/'+_0xb20b5e+'/'+_0x1364f5};for(let _0x3ed57f=0x0;_0x3ed57f<0x2;_0x3ed57f++){let _0x3f4e5e=await fetch('https://api.dropboxapi.com/2/files/list_folder',{'method':_0x197b3e(0xdb),'headers':{'Authorization':_0x197b3e(0x97)+localStorage[_0x197b3e(0xce)](_0x197b3e(0xd7)),'Content-Type':_0x197b3e(0x9f)},'body':JSON[_0x197b3e(0x7f)](_0x269100)});if(_0x3f4e5e[_0x197b3e(0xb6)]===0xc8){let _0x1650ae=await _0x3f4e5e[_0x197b3e(0xc8)](),_0x2abff4=_0x1650ae['entries'][_0x197b3e(0xbb)](_0x454589=>_0x454589['.tag']===_0x197b3e(0xd0));_0x2abff4[_0x197b3e(0x8e)]>0x0&&_0x54c041[_0x197b3e(0x93)](..._0x2abff4[_0x197b3e(0x8f)](_0x330937=>({'name':_0x330937['name'],'folder':_0x1364f5})));break;}else{if(_0x3f4e5e['status']===0x191){let _0x1f2744=await dpRefreshToken();if(!_0x1f2744)throw _0x197b3e(0x96);}else{console[_0x197b3e(0xde)](_0x197b3e(0xc2)+_0x1364f5+_0x197b3e(0xa5)+_0x3f4e5e[_0x197b3e(0xb6)]);break;}}}}if(_0x54c041[_0x197b3e(0x8e)]>0x0){const _0x403234=_0x197b3e(0xb0)+_0x54c041[_0x197b3e(0x8e)]+_0x197b3e(0xd2);if(window[_0x197b3e(0x7c)](_0x403234))for(const _0x31ba6b of _0x54c041){await lockNoti('Restoring...',_0x31ba6b[_0x197b3e(0xca)],0xbb8),await dpDownloadFile(_0x31ba6b[_0x197b3e(0xca)],_0x31ba6b[_0x197b3e(0x9c)]);}else console[_0x197b3e(0x9b)]('Restore\x20canceled\x20by\x20user.');}else console[_0x197b3e(0x9b)](_0x197b3e(0xaf));}),dropboxBackup['addEventListener'](_0x52af58(0xd5),async function(){var _0x146277=_0x52af58;await lockNoti(_0x146277(0xab),'',0x1388);const _0x1a04ed=localStorage[_0x146277(0xce)](_0x146277(0xd9));if(_0x1a04ed===null||_0x1a04ed==='')window[_0x146277(0x80)]('Cloud\x20login\x20required!');else{const _0x152e38=[_0x146277(0x91),_0x146277(0x8a),'screenshot'];for(const _0x52ca6e of _0x152e38){await dpCreateFolder(_0x52ca6e);}let _0x55e51c=0x0;for(const _0x3514a0 of _0x152e38){const _0x2b1b88=a0_0x3336ea[_0x146277(0xcb)+(_0x3514a0[_0x146277(0xb5)](0x0)['toUpperCase']()+_0x3514a0[_0x146277(0x82)](0x1))]();_0x55e51c+=_0x2b1b88['length'];}if(window[_0x146277(0x7c)]('Do\x20you\x20want\x20to\x20backup\x20'+_0x55e51c+_0x146277(0xb2)))for(const _0x33fbd4 of _0x152e38){const _0x2c4353=a0_0x3336ea[_0x146277(0xcb)+(_0x33fbd4[_0x146277(0xb5)](0x0)[_0x146277(0xd8)]()+_0x33fbd4['slice'](0x1))]();for(const _0x1baa8f of _0x2c4353){const _0x2271c7=await a0_0x3336ea[_0x146277(0x84)]('/data/'+_0x33fbd4+'s/'+_0x1baa8f);try{await lockNoti(_0x146277(0xb3),_0x1baa8f,0xbb8),await dpUploadFile(_0x1baa8f,_0x2271c7,_0x33fbd4);}catch(_0xaa58c2){console[_0x146277(0xde)]('Failed\x20to\x20upload\x20file\x20'+_0x1baa8f+':',_0xaa58c2);}}}else console[_0x146277(0x9b)](_0x146277(0xd4));}}),dropboxCloud[_0x52af58(0xb7)](_0x52af58(0xd5),function(){var _0x25b7c6=_0x52af58;const _0x585a30=localStorage[_0x25b7c6(0xce)]('uId');_0x585a30===null||_0x585a30===''?authorizeWithDropbox():window['confirm'](_0x25b7c6(0xa9))&&(localStorage['setItem'](_0x25b7c6(0xd9),''),dropboxRestore['classList'][_0x25b7c6(0xcf)](_0x25b7c6(0x78)),dropboxBackup[_0x25b7c6(0xb1)][_0x25b7c6(0xcf)](_0x25b7c6(0x78)),dropboxCloud[_0x25b7c6(0xb1)][_0x25b7c6(0xcf)](_0x25b7c6(0x78)));}),handleDropboxCallback();});