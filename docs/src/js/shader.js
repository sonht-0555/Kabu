const a0_0x39a55f=a0_0x3fce;(function(_0x5317fa,_0x23df2e){const _0x43af20=a0_0x3fce,_0x909074=_0x5317fa();while(!![]){try{const _0x5dcc07=parseInt(_0x43af20(0x207))/0x1+parseInt(_0x43af20(0x1dd))/0x2+parseInt(_0x43af20(0x208))/0x3+parseInt(_0x43af20(0x1f3))/0x4*(-parseInt(_0x43af20(0x1f9))/0x5)+-parseInt(_0x43af20(0x1da))/0x6*(parseInt(_0x43af20(0x1bf))/0x7)+parseInt(_0x43af20(0x1bb))/0x8*(-parseInt(_0x43af20(0x1fb))/0x9)+parseInt(_0x43af20(0x1e5))/0xa;if(_0x5dcc07===_0x23df2e)break;else _0x909074['push'](_0x909074['shift']());}catch(_0x5459ad){_0x909074['push'](_0x909074['shift']());}}}(a0_0x57f4,0x51b68));import*as a0_0x3a0f65 from'./main.js';let gl=null,program=null,systemType,clientWidth,upscaleFactor=0x3,upscaleShader,gameWidth,gameHeight,gameStride,texture,integerScaling,ctx2d=null,lut64=null,lut64Streng=null,lut64Profile=null;const textured=document[a0_0x39a55f(0x1f5)]('textured'),bufferCanvas=document[a0_0x39a55f(0x1f5)](a0_0x39a55f(0x1d8)),canvasContainer=document[a0_0x39a55f(0x1f5)](a0_0x39a55f(0x20c)),imgShader=document['getElementById'](a0_0x39a55f(0x215)),settingContainer=document[a0_0x39a55f(0x211)]('.setting-container'),messageContainer=document[a0_0x39a55f(0x211)](a0_0x39a55f(0x206)),stateTitle=document[a0_0x39a55f(0x211)](a0_0x39a55f(0x1d3));let imageDataObj=null;async function loadLUT64(){const _0x382a55=a0_0x39a55f;systemType=gameName[_0x382a55(0x20b)](-0x3);const _0x46ce22=localStorage[_0x382a55(0x1f7)](gameName+'_streng')||_0x382a55(0x1d2),_0x38d578=(localStorage[_0x382a55(0x1f7)](gameName+_0x382a55(0x1e8))||_0x382a55(0x1e4))[_0x382a55(0x1b8)]();if(!lut64||lut64Streng!==_0x46ce22||lut64Profile!==_0x38d578){const _0x2f9edd=_0x382a55(0x1c4)+_0x38d578+'_'+_0x46ce22+_0x382a55(0x1bd);console[_0x382a55(0x1ea)](_0x2f9edd);const _0x14a949=await fetch(_0x2f9edd),_0x475993=await _0x14a949[_0x382a55(0x1bc)]();lut64=new Uint8Array(_0x475993),lut64Streng=_0x46ce22,lut64Profile=_0x38d578;}}async function loadShaderSource(_0x46b340){const _0x391100=await fetch(_0x46b340);return await _0x391100['text']();}function setupStyle(_0x15f1a5){const _0x16220a=a0_0x39a55f;clientWidth=document[_0x16220a(0x1be)][_0x16220a(0x1c3)];const _0x5c0dcb=window[_0x16220a(0x214)];systemType===_0x16220a(0x1e3)?(gameWidth=0xa0,gameHeight=0x90,gameStride=0x100,upscaleShader=0x3,integerScaling=Math[_0x16220a(0x1f8)](clientWidth*_0x5c0dcb/gameWidth),localStorage[_0x16220a(0x1d4)]('screenSize',_0x16220a(0x1ba)+gameWidth*(integerScaling/_0x5c0dcb)+','+gameHeight*(integerScaling/_0x5c0dcb))):(gameWidth=0xf0,gameHeight=0xa0,gameStride=0xf0,upscaleShader=0x2,integerScaling=Math['floor'](clientWidth*_0x5c0dcb/gameWidth),localStorage[_0x16220a(0x1d4)](_0x16220a(0x1d5),_0x16220a(0x1ba)+gameWidth*(integerScaling/_0x5c0dcb)+','+gameHeight*(integerScaling/_0x5c0dcb)));if(_0x15f1a5==='2d')bufferCanvas[_0x16220a(0x1ec)]=gameWidth,bufferCanvas[_0x16220a(0x1ef)]=gameHeight,bufferCanvas[_0x16220a(0x1c2)][_0x16220a(0x209)]=''+integerScaling/_0x5c0dcb,bufferCanvas[_0x16220a(0x1c2)]['imageRendering']='crisp-edges',canvasContainer[_0x16220a(0x1c2)]['width']=gameWidth*(integerScaling/_0x5c0dcb)+'px',canvasContainer[_0x16220a(0x1c2)][_0x16220a(0x1ef)]=gameHeight*(integerScaling/_0x5c0dcb)+'px',textured[_0x16220a(0x1c2)][_0x16220a(0x1ec)]=gameWidth*(integerScaling/_0x5c0dcb)+'px',textured[_0x16220a(0x1c2)]['height']=gameHeight*(integerScaling/_0x5c0dcb)+'px',imgShader[_0x16220a(0x1c2)][_0x16220a(0x1e2)]='scale('+integerScaling/_0x5c0dcb/upscaleShader+')',settingContainer[_0x16220a(0x1ca)](function(_0x310515){const _0x28d6a1=_0x16220a;_0x310515['style']['width']=gameWidth*(integerScaling/_0x5c0dcb)+'px',_0x310515[_0x28d6a1(0x1c2)][_0x28d6a1(0x1ef)]=gameHeight*(integerScaling/_0x5c0dcb)+'px';}),messageContainer[_0x16220a(0x1ca)](function(_0x15ce1a){const _0x34f19d=_0x16220a;_0x15ce1a[_0x34f19d(0x1c2)][_0x34f19d(0x1ec)]=gameWidth+'px',_0x15ce1a[_0x34f19d(0x1c2)][_0x34f19d(0x1ef)]=gameHeight+'px',_0x15ce1a[_0x34f19d(0x1c2)][_0x34f19d(0x209)]=''+integerScaling/_0x5c0dcb;}),stateTitle[_0x16220a(0x1ca)](function(_0x1b7819){const _0x190ad0=_0x16220a;_0x1b7819[_0x190ad0(0x1eb)][_0x190ad0(0x1fd)](_0x190ad0(0x1db));});else _0x15f1a5==='webgl2'&&(bufferCanvas[_0x16220a(0x1ec)]=clientWidth*upscaleFactor,bufferCanvas[_0x16220a(0x1ef)]=clientWidth*upscaleFactor*(gameHeight/gameWidth),bufferCanvas[_0x16220a(0x1c2)][_0x16220a(0x209)]=''+0x1/upscaleFactor,bufferCanvas[_0x16220a(0x1c2)][_0x16220a(0x1b6)]='',canvasContainer['style']['width']=clientWidth+'px',canvasContainer[_0x16220a(0x1c2)][_0x16220a(0x1ef)]=clientWidth*(gameHeight/gameWidth)+'px',textured[_0x16220a(0x1c2)][_0x16220a(0x1ec)]=clientWidth+'px',textured[_0x16220a(0x1c2)]['height']=clientWidth*(gameHeight/gameWidth)+'px',imgShader[_0x16220a(0x1c2)][_0x16220a(0x1e2)]=_0x16220a(0x218)+clientWidth/gameWidth/upscaleShader+')',settingContainer[_0x16220a(0x1ca)](function(_0x280d94){const _0x2d7723=_0x16220a;_0x280d94[_0x2d7723(0x1c2)][_0x2d7723(0x1ec)]=clientWidth+'px',_0x280d94[_0x2d7723(0x1c2)][_0x2d7723(0x1ef)]=clientWidth*(gameHeight/gameWidth)+'px';}),messageContainer[_0x16220a(0x1ca)](function(_0x39b33b){const _0x78863f=_0x16220a;_0x39b33b[_0x78863f(0x1c2)][_0x78863f(0x1ec)]=gameWidth+'px',_0x39b33b[_0x78863f(0x1c2)][_0x78863f(0x1ef)]=gameHeight+'px',_0x39b33b[_0x78863f(0x1c2)][_0x78863f(0x209)]=''+clientWidth/gameWidth;}),stateTitle[_0x16220a(0x1ca)](function(_0x3e0748){const _0x1bb239=_0x16220a;_0x3e0748[_0x1bb239(0x1eb)]['add'](_0x1bb239(0x1db));}));imgShader[_0x16220a(0x1c2)]['width']=gameWidth*upscaleShader+'px',imgShader['style']['height']=gameHeight*upscaleShader+'px',imgShader['style'][_0x16220a(0x1f2)]=_0x16220a(0x20d),imgShader[_0x16220a(0x1c2)][_0x16220a(0x1e1)](_0x16220a(0x1e6),upscaleShader+_0x16220a(0x1e7)+upscaleShader+'px');}function setupWebGL(){const _0x5e9599=a0_0x39a55f;gl=bufferCanvas['getContext'](_0x5e9599(0x201));if(!gl)return console[_0x5e9599(0x212)](_0x5e9599(0x1d0)),null;gl[_0x5e9599(0x1cf)](0x0,0x0,bufferCanvas[_0x5e9599(0x1ec)],bufferCanvas['height']);}function createShader(_0x252618,_0x2a95b8){const _0x497876=a0_0x39a55f,_0x4ba763=gl[_0x497876(0x20e)](_0x252618);gl['shaderSource'](_0x4ba763,_0x2a95b8),gl['compileShader'](_0x4ba763);if(!gl[_0x497876(0x1c8)](_0x4ba763,gl['COMPILE_STATUS']))return console[_0x497876(0x212)](gl['getShaderInfoLog'](_0x4ba763)),gl['deleteShader'](_0x4ba763),null;return _0x4ba763;}async function setupShaders(){const _0x2cb996=a0_0x39a55f,_0x5aac97=await loadShaderSource(_0x2cb996(0x1dc)),_0x3acb0b=await loadShaderSource('./src/shaders/fragmentShader.glsl'),_0x4fa584=createShader(gl['VERTEX_SHADER'],_0x5aac97),_0x471e68=createShader(gl[_0x2cb996(0x1f6)],_0x3acb0b);return program=gl[_0x2cb996(0x1c7)](),gl['attachShader'](program,_0x4fa584),gl['attachShader'](program,_0x471e68),gl['linkProgram'](program),gl[_0x2cb996(0x1b7)](program),program;}function setupTexture(){const _0x1c920b=a0_0x39a55f;texture=gl[_0x1c920b(0x1e0)](),gl['bindTexture'](gl['TEXTURE_2D'],texture),gl[_0x1c920b(0x1fc)](gl[_0x1c920b(0x203)],gl['TEXTURE_MIN_FILTER'],gl[_0x1c920b(0x20f)]),gl[_0x1c920b(0x1fc)](gl['TEXTURE_2D'],gl[_0x1c920b(0x1cd)],gl[_0x1c920b(0x20f)]),gl['texParameteri'](gl[_0x1c920b(0x203)],gl[_0x1c920b(0x1d1)],gl[_0x1c920b(0x1d9)]),gl[_0x1c920b(0x1fc)](gl[_0x1c920b(0x203)],gl[_0x1c920b(0x20a)],gl[_0x1c920b(0x1d9)]),gl[_0x1c920b(0x1df)](gl[_0x1c920b(0x213)](program,_0x1c920b(0x217)),gameWidth,gameHeight),gl[_0x1c920b(0x1df)](gl[_0x1c920b(0x213)](program,_0x1c920b(0x1b9)),gl['canvas']['width'],gl['canvas']['height']),gl[_0x1c920b(0x1ed)](gl[_0x1c920b(0x213)](program,_0x1c920b(0x1f0)),gameWidth/gl[_0x1c920b(0x1d8)][_0x1c920b(0x1ec)]),gl[_0x1c920b(0x1ed)](gl[_0x1c920b(0x213)](program,'smooth_height'),gameHeight/gl[_0x1c920b(0x1d8)]['height']);}function setupBuffers(){const _0x231cc6=a0_0x39a55f,_0x598ec6=gl[_0x231cc6(0x1fe)]();gl[_0x231cc6(0x204)](gl['ARRAY_BUFFER'],_0x598ec6),gl[_0x231cc6(0x1cc)](gl[_0x231cc6(0x1f1)],new Float32Array([-0x1,-0x1,0x1,-0x1,-0x1,0x1,0x1,0x1]),gl[_0x231cc6(0x210)]);const _0x1a66ae=gl[_0x231cc6(0x1e9)](program,_0x231cc6(0x219));gl[_0x231cc6(0x1d7)](_0x1a66ae),gl['vertexAttribPointer'](_0x1a66ae,0x2,gl[_0x231cc6(0x1ff)],![],0x0,0x0);const _0x2922a4=gl[_0x231cc6(0x1fe)]();gl[_0x231cc6(0x204)](gl[_0x231cc6(0x1f1)],_0x2922a4),gl[_0x231cc6(0x1cc)](gl['ARRAY_BUFFER'],new Float32Array([0x0,0x1,0x1,0x1,0x0,0x0,0x1,0x0]),gl[_0x231cc6(0x210)]);const _0x12e38c=gl[_0x231cc6(0x1e9)](program,_0x231cc6(0x1d6));gl[_0x231cc6(0x1d7)](_0x12e38c),gl[_0x231cc6(0x200)](_0x12e38c,0x2,gl[_0x231cc6(0x1ff)],![],0x0,0x0);}let indexLUT=null;async function loadIndexLUT(){const _0x5464a1=a0_0x39a55f;if(indexLUT)return;try{const _0x4cd490=_0x5464a1(0x1de)+systemType+_0x5464a1(0x1bd),_0x299107=await fetch(_0x4cd490),_0x5558f6=await _0x299107[_0x5464a1(0x1bc)]();indexLUT=new Int32Array(_0x5558f6),console[_0x5464a1(0x1ea)](_0x5464a1(0x1c1)+systemType);}catch(_0xaa883f){console[_0x5464a1(0x212)](_0x5464a1(0x205),_0xaa883f),createIndexLUTInline();}}function createIndexLUTInline(){const _0x47a9da=a0_0x39a55f;indexLUT=new Int32Array(gameWidth*gameHeight*0x2);let _0x63850c=0x0;for(let _0x54e550=0x0;_0x54e550<gameHeight;_0x54e550++){for(let _0x496354=0x0;_0x496354<gameWidth;_0x496354++){indexLUT[_0x63850c++]=_0x54e550*gameStride+_0x496354,indexLUT[_0x63850c++]=(_0x54e550*gameWidth+_0x496354)*0x4;}}console[_0x47a9da(0x1ea)]('Đã\x20tạo\x20index\x20LUT\x20inline');}function a0_0x57f4(){const _0x1b6255=['canvas-container','top\x20center','createShader','NEAREST','STATIC_DRAW','querySelectorAll','error','getUniformLocation','devicePixelRatio','img-shader','texImage2D','game_size','scale(','position','imageRendering','useProgram','toLowerCase','render_size','0,0,','55976kymJMg','arrayBuffer','.bin','documentElement','525GgCsRh','drawArrays','Đã\x20tải\x20index\x20LUT\x20cho\x20','style','clientWidth','./src/lut/lut64_','COLOR_BUFFER_BIT','imageSmoothingEnabled','createProgram','getShaderParameter','RGBA','forEach','set','bufferData','TEXTURE_MAG_FILTER','getPixelData','viewport','WebGL2\x20not\x20supported','TEXTURE_WRAP_S','4.0','.stateTitle,\x20.stateDate','setItem','screenSize','texcoord','enableVertexAttribArray','canvas','CLAMP_TO_EDGE','31128tgipTo','fefs','./src/shaders/vertexShader.glsl','1305316OgKzGP','./src/lut/index_lut_','uniform2f','createTexture','setProperty','transform','gbc','warm','147070jGJNgV','--bg-size','px\x20','_temperature','getAttribLocation','log','classList','width','uniform1f','getContext','height','smooth_width','ARRAY_BUFFER','transformOrigin','712GgpvOv','TRIANGLE_STRIP','getElementById','FRAGMENT_SHADER','getItem','floor','12055zPoFMo','putImageData','81FptgAj','texParameteri','remove','createBuffer','FLOAT','vertexAttribPointer','webgl2','DOMContentLoaded','TEXTURE_2D','bindBuffer','Lỗi\x20khi\x20tải\x20index\x20LUT:','.message-container','152235SnUzOw','1188981lPiiUH','zoom','TEXTURE_WRAP_T','slice'];a0_0x57f4=function(){return _0x1b6255;};return a0_0x57f4();}function a0_0x3fce(_0x11c918,_0x36e85b){const _0x57f4e2=a0_0x57f4();return a0_0x3fce=function(_0x3fced5,_0x335767){_0x3fced5=_0x3fced5-0x1b6;let _0x22ab08=_0x57f4e2[_0x3fced5];return _0x22ab08;},a0_0x3fce(_0x11c918,_0x36e85b);}async function renderPixel(_0x21029c){const _0x343462=a0_0x39a55f,_0x1125bd=a0_0x3a0f65[_0x343462(0x1ce)]();if(!_0x1125bd)return;await loadLUT64();const _0x4930b5=new Uint8ClampedArray(gameWidth*gameHeight*0x4),_0x1d97ac=gameWidth*gameHeight;for(let _0x190d98=0x0,_0x4fe8ea=0x0;_0x190d98<_0x1d97ac;_0x190d98++,_0x4fe8ea+=0x2){const _0x7547ee=indexLUT[_0x4fe8ea],_0x1b85c3=indexLUT[_0x4fe8ea+0x1],_0x2ae307=_0x1125bd[_0x7547ee],_0x206abf=(_0x2ae307&0xff)>>0x2,_0x25e203=(_0x2ae307>>0x8&0xff)>>0x2,_0x4f19a5=(_0x2ae307>>0x10&0xff)>>0x2,_0x31e77f=(_0x206abf*0x40*0x40+_0x25e203*0x40+_0x4f19a5)*0x3;_0x4930b5[_0x1b85c3]=lut64[_0x31e77f],_0x4930b5[_0x1b85c3+0x1]=lut64[_0x31e77f+0x1],_0x4930b5[_0x1b85c3+0x2]=lut64[_0x31e77f+0x2],_0x4930b5[_0x1b85c3+0x3]=0xff;}if(_0x21029c==='webgl2')gl['bindTexture'](gl['TEXTURE_2D'],texture),gl[_0x343462(0x216)](gl[_0x343462(0x203)],0x0,gl[_0x343462(0x1c9)],gameWidth,gameHeight,0x0,gl[_0x343462(0x1c9)],gl['UNSIGNED_BYTE'],_0x4930b5),gl['clear'](gl[_0x343462(0x1c5)]),gl[_0x343462(0x1c0)](gl[_0x343462(0x1f4)],0x0,0x4);else _0x21029c==='2d'&&(!ctx2d&&(ctx2d=bufferCanvas[_0x343462(0x1ee)]('2d',{'alpha':![]}),ctx2d[_0x343462(0x1c6)]=![]),!imageDataObj&&(imageDataObj=new ImageData(gameWidth,gameHeight)),imageDataObj['data'][_0x343462(0x1cb)](_0x4930b5),ctx2d[_0x343462(0x1fa)](imageDataObj,0x0,0x0));requestAnimationFrame(()=>renderPixel(_0x21029c));}export async function switchRenderMode(_0x3af65b){const _0x15f474=a0_0x39a55f;systemType=gameName['slice'](-0x3);systemType==='gbc'?(gameWidth=0xa0,gameHeight=0x90,gameStride=0x100):(gameWidth=0xf0,gameHeight=0xa0,gameStride=0xf0);await loadIndexLUT();if(_0x3af65b==='2d')setupStyle('2d'),renderPixel('2d');else _0x3af65b===_0x15f474(0x201)&&(setupStyle('webgl2'),setupWebGL(),await setupShaders(),setupTexture(),setupBuffers(),renderPixel('webgl2'));}document['addEventListener'](a0_0x39a55f(0x202),function(){});