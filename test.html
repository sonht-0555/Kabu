<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Scroll Div</title>
</head>
<body>
  <script>function detectLanguage(textContent) {
    var apiUrl = "https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&dt=ld&q=" + encodeURIComponent(textContent);
    return fetch(apiUrl)
        .then(response => response.json())
        .then(result => {
            if (Array.isArray(result) && result.length > 0 && Array.isArray(result[8]) && result[8].length > 0) {
                var detectedLanguage = result[8][0][0];
                console.log("Detected language:", detectedLanguage);
                return detectedLanguage;
            } else {
                throw new Error("Unable to detect language");
            }
        })
        .catch(error => {
            console.error("Error detecting language:", error);
            throw error;
        });
}

function translateText(textContent, sourceLang, targetLang) {
    var apiUrl = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=${targetLang}&dt=t&q=${encodeURIComponent(textContent)}`;
    return fetch(apiUrl)
        .then(response => response.json())
        .then(result => {
            if (Array.isArray(result) && result.length > 0 && Array.isArray(result[0])) {
                var translatedText = result[0].map(sentence => sentence[0]).join(' ');
                const cleanData = translatedText.replace(/ {2,}/g, ' ');
                console.log("Cleaned translated text:", cleanData);
                return cleanData;
            } else {
                throw new Error("Invalid translation result format");
            }
        })
        .catch(error => {
            console.error("Error translating text:", error);
            throw error;
        });
}

function translateWithLogic(textContent) {
    detectLanguage(textContent)
        .then(detectedLanguage => {
            if (detectedLanguage === 'en') {
                console.log("Detected language is English. Translating directly to Vietnamese.");
                return translateText(textContent, 'en', 'vi');
            } else {
                console.log(`Detected language is ${detectedLanguage}. Translating to English first.`);
                return translateText(textContent, detectedLanguage, 'en')
                    .then(intermediateText => {
                        console.log("Intermediate text (translated to English):", intermediateText);
                        return translateText(intermediateText, 'en', 'vi');
                    });
            }
        })
        .then(finalTranslation => {
            console.log("Final translated text:", finalTranslation);
        })
        .catch(error => {
            console.error("Error in translation process:", error);
        });
}

let textContent = "はじめまして! あなたは? おとこのこ! おんなのこ!";
console.log("Original text:", textContent);
translateWithLogic(textContent);
    
  </script>
</body>
</html>